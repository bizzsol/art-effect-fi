<?php
bolt_decrypt( __FILE__ , '8JZXzR'); return 0;
##!!!##Cgp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcSW52ZW50b3J5TW9kZWxzXEludmVudG9yeUxvZ3M7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xSZXF1aXNpdGlvbjsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXENhdGVnb3J5Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcU3VwcGxpZXJMb2c7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xTdXBwbGllclJhdGluZ3M7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVyOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcQXR0cmlidXRlOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcQXR0cmlidXRlT3B0aW9uOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHJvZHVjdEF0dHJpYnV0ZTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFByb2R1Y3Q7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xOb3RpZmljYXRpb247CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDb3N0Q2VudHJlOwp1c2UgQXBwXE1vZGVsc1xNeVByb2plY3RcUHJvZ3JhbTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXE1lbnVcU3ViTWVudTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXE1lbnVcQWNjb3VudHNTdWJNZW51Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcTWVudVxNZW51Owp1c2UgXEFwcFxNb2RlbHNcTXlQcm9qZWN0XERlcGVuZGVuY3k7CnVzZSBBcHBcVXNlcjsKdXNlIElsbHVtaW5hdGVcU3VwcG9ydFxGYWNhZGVzXEF1dGg7CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xEQjsKdXNlIElsbHVtaW5hdGVcU3VwcG9ydFxGYWNhZGVzXFJlcXVlc3Q7CgppbmNsdWRlICdEYXNoYm9hcmRIZWxwZXIucGhwJzsKCmZ1bmN0aW9uIHNlbmRFbWFpbCgkdmlldywgJGRhdGEsICRzdWJqZWN0LCAkZW1haWxzKXsKCS8vIGFycmF5X3B1c2goJGVtYWlscywgImFud2FydWxsYWg4MzRAZ21haWwuY29tIik7CgkvLyBhcnJheV9wdXNoKCRlbWFpbHMsICJwcm9ncmFtbWVyLmFyYWZhdGFud2FyQGdtYWlsLmNvbSIpOwoKICBcTWFpbDo6c2VuZCgkdmlldywgJGRhdGEsIGZ1bmN0aW9uICgkbXNnKSB1c2UgKCRzdWJqZWN0LCAkZW1haWxzKXsKICAgICRtc2cKICAgICAgLT50bygkZW1haWxzKQogICAgICAtPnN1YmplY3QoJHN1YmplY3QpOwogIH0pOwp9CgpmdW5jdGlvbiBzYXZlU3VwcGxpZXJMb2coJHN1cHBsaWVyX2lkLCAkZGF0ZSwgJHRvcGljLCAkdGV4dCwgJGlkID0gMCl7CgkkbG9nID0gU3VwcGxpZXJMb2c6OmZpbmQoJGlkKTsKCWlmKGlzc2V0KCRsb2ctPmlkKSl7CgkJJGxvZy0+ZGF0ZSA9ICRkYXRlOwoJCSRsb2ctPnRvcGljID0gJHRvcGljOwoJCSRsb2ctPmxvZyA9ICR0ZXh0OwoJCSRsb2ctPnNhdmUoKTsKCX1lbHNlewoJCSRsb2cgPSBTdXBwbGllckxvZzo6Y3JlYXRlKFsKCQkJJ3N1cHBsaWVyX2lkJyA9PiAkc3VwcGxpZXJfaWQsCgkJCSdkYXRlJyA9PiAkZGF0ZSwKCQkJJ3RvcGljJyA9PiAkdG9waWMsCgkJCSdsb2cnID0+ICR0ZXh0LAoJCV0pOwoJfQoKCXJldHVybiAkbG9nOwp9CgpmdW5jdGlvbiBnZXRNZXJnZWRSZXF1aXNpc2lvbklEKCRjb25kaXRpb24xLCAkY29uZGl0aW9uMil7CglyZXR1cm4gYXJyYXlfdW5pcXVlKGFycmF5X21lcmdlKFJlcXVpc2l0aW9uOjp3aGVyZSgkY29uZGl0aW9uMSktPnBsdWNrKCdpZCcpLT50b0FycmF5KCksIFJlcXVpc2l0aW9uOjp3aGVyZSgkY29uZGl0aW9uMiktPnBsdWNrKCdpZCcpLT50b0FycmF5KCkpKTsKfQoKZnVuY3Rpb24gZ2V0VHlwZVdpc2VSZXF1aXNpc3Rpb25Db3VudCgkdHlwZT0nJykKewoJcmV0dXJuIFJlcXVpc2l0aW9uOjp3aGVuKGlzc2V0KEF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfZGVwYXJ0bWVudF9pZCksCgkJZnVuY3Rpb24oJHF1ZXJ5KXsKCQkJcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFVzZXJzTGlzdC5lbXBsb3llZScsZnVuY3Rpb24oJHF1ZXJ5KXsKCQkJCXJldHVybiAkcXVlcnktPndoZXJlKCdhc19kZXBhcnRtZW50X2lkJyxBdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX2RlcGFydG1lbnRfaWQpOwoJCQl9KTsKCQl9KQoJLT53aGVyZSgnc3RhdHVzJywkdHlwZSkKCS0+Y291bnQoKTsKfQoKZnVuY3Rpb24gaW52ZW50b3J5U3RhdHVzKCR0eXBlID0gJycsICR3YXJlaG91c2VfaWQgPSAwKQp7CglyZXR1cm4gSW52ZW50b3J5TG9nczo6d2hlcmUoJ3R5cGUnLCAkdHlwZSkKCS0+d2hlbigkd2FyZWhvdXNlX2lkID4gMCwgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHdhcmVob3VzZV9pZCl7CgkJcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3dhcmVob3VzZV9pZCcsICR3YXJlaG91c2VfaWQpOwoJfSkKCS0+Y291bnQoKTsKfQoKZnVuY3Rpb24gUXVhbGl0eUVuc3VyZUxpc3QoJHR5cGUpCnsKCXJldHVybiBQdXJjaGFzZU9yZGVyOjp3aGVyZSgnaXNfc2VuZCcsJ3llcycpCgktPndoZXJlSGFzKCdyZWxHb29kUmVjZWl2ZU5vdGUucmVsR29vZHNSZWNlaXZlZEl0ZW1zJyxmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJHR5cGUpewoJCXJldHVybiAkcXVlcnktPndoZXJlKCdxdWFsaXR5X2Vuc3VyZScsJHR5cGUpOwoJfSktPmNvdW50KCk7Cn0KCgpmdW5jdGlvbiBzcGFjZXMoJHZhbHVlLCAkZXh0cmEgPSAwLCAkbm9TcGFjZXMgPSB0cnVlKXsKCWlmKCRub1NwYWNlcyl7CgkJcmV0dXJuICgkdmFsdWUrJGV4dHJhKSsyOwoJfQoJCgkkc3BhY2VzID0gJyc7Cglmb3IgKCRpPTA7ICRpIDwgKCR2YWx1ZSskZXh0cmEpKjY7ICRpKyspIHsgCgkJJHNwYWNlcyAuPSAiJm5ic3A7IjsKCX0KCXJldHVybiAkc3BhY2VzOwp9CgpmdW5jdGlvbiBjYXRlZ29yeUxpc3QoKXsKCXJldHVybiBDYXRlZ29yeTo6d2hlcmUoJ3BhcmVudF9pZCcsbnVsbCktPmdldCgpOwp9CgpmdW5jdGlvbiBjYXRlZ29yeU9wdGlvbnMoJHN1YkNhdGVnb3JpZXMsICRjaG9zZW4gPSAwLCAkc3RlcCA9IDAsICRpc19maXhlZF9hc3NldCA9IDAsICRpc19jd2lwID0gMCwgJGFsbFN1YkNhdGVnb3JpZXMgPSBbXSwgJGFsbENhdGVnb3J5QXR0cmlidXRlcyA9IFtdKXsKCWlmKCRzdGVwID09IDApewoJCSRhbGxTdWJDYXRlZ29yaWVzID0gQ2F0ZWdvcnk6OndpdGgoWwoJCQknY2F0ZWdvcnknLCAnc3ViQ2F0ZWdvcnknLAoJCV0pCgkJLy8gLT53aGVyZSgnaXNfZml4ZWRfYXNzZXQnLCAkaXNfZml4ZWRfYXNzZXQpCgkJLy8gLT53aGVyZSgnaXNfY3dpcCcsICRpc19jd2lwKQoJCS0+b3JkZXJCeSgnY29kZScpLT5nZXQoKTsKCQkkYWxsQ2F0ZWdvcnlBdHRyaWJ1dGVzID0gXEFwcFxNb2RlbHNcUG1zTW9kZWxzXENhdGVnb3J5QXR0cmlidXRlOjphbGwoKTsKCgkJJHN1YkNhdGVnb3JpZXMgPSAkYWxsU3ViQ2F0ZWdvcmllcy0+d2hlcmUoJ3BhcmVudF9pZCcsIDApOwoJfQoKCSRkYXRhID0gJyc7CglpZigkc3ViQ2F0ZWdvcmllcy0+Y291bnQoKSA+IDApewoJCWZvcmVhY2ggKCRzdWJDYXRlZ29yaWVzIGFzICRrZXkgPT4gJHN1YkNhdGVnb3J5KSB7CgkJCSRjYXRlZ29yeUF0dHJpYnV0ZXMgPSAkYWxsQ2F0ZWdvcnlBdHRyaWJ1dGVzLT53aGVyZSgnY2F0ZWdvcnlfaWQnLCAkc3ViQ2F0ZWdvcnktPmlkKTsKCQkJJGF0dHJpYnV0ZXMgPSBbXTsKCQkJJGF0dHJpYnV0ZU9wdGlvbnMgPSBbXTsKCQkJaWYoJGNhdGVnb3J5QXR0cmlidXRlcy0+Y291bnQoKSA+IDApewoJCQkJZm9yZWFjaCgkY2F0ZWdvcnlBdHRyaWJ1dGVzIGFzICRrZXkgPT4gJGNhdGVnb3J5QXR0cmlidXRlKXsKCQkJCQlhcnJheV9wdXNoKCRhdHRyaWJ1dGVzLCAkY2F0ZWdvcnlBdHRyaWJ1dGUtPmF0dHJpYnV0ZV9pZCk7CgkJCQkJJGF0dHJpYnV0ZU9wdGlvbnMgPSBhcnJheV9tZXJnZSgkYXR0cmlidXRlT3B0aW9ucywgKGlzX2FycmF5KGpzb25fZGVjb2RlKCRjYXRlZ29yeUF0dHJpYnV0ZS0+b3B0aW9ucywgdHJ1ZSkpID8ganNvbl9kZWNvZGUoJGNhdGVnb3J5QXR0cmlidXRlLT5vcHRpb25zLCB0cnVlKSA6IFtdKSk7CgkJCQl9CgkJCX0KCQkJJGF0dHJpYnV0ZXMgPSBpbXBsb2RlKCcsJywgJGF0dHJpYnV0ZXMpOwoJCQkkYXR0cmlidXRlT3B0aW9ucyA9IGltcGxvZGUoJywnLCAkYXR0cmlidXRlT3B0aW9ucyk7CgkJCSRzdWJDYXRlZ29yaWVzID0gJGFsbFN1YkNhdGVnb3JpZXMtPndoZXJlKCdwYXJlbnRfaWQnLCAkc3ViQ2F0ZWdvcnktPmlkKTsKCQkJJGRhdGEgLj0gICAgJzxvcHRpb24gdmFsdWU9IicuJHN1YkNhdGVnb3J5LT5pZC4nIiAnLigkY2hvc2VuID09ICRzdWJDYXRlZ29yeS0+aWQgPyAnc2VsZWN0ZWQnIDogJycpLicgJy4oJHN1YkNhdGVnb3J5LT5zdWJDYXRlZ29yeS0+Y291bnQoKSA+IDAgPyAnZGlzYWJsZWQnIDogJycpLicgZGF0YS1hdHRyaWJ1dGVzPSInLiRhdHRyaWJ1dGVzLiciIGRhdGEtYXR0cmlidXRlLW9wdGlvbnM9IicuJGF0dHJpYnV0ZU9wdGlvbnMuJyIgaW52ZW50b3J5X2FjY291bnRfaWQ9IicuJHN1YkNhdGVnb3J5LT5pbnZlbnRvcnlfYWNjb3VudF9pZC4nIiBjd2lwX2Fzc2V0X2FjY291bnRfaWQ9IicuJHN1YkNhdGVnb3J5LT5jd2lwX2Fzc2V0X2FjY291bnRfaWQuJyIgY29nc19hY2NvdW50X2lkPSInLiRzdWJDYXRlZ29yeS0+Y29nc19hY2NvdW50X2lkLiciIGludmVudG9yeV9hZGp1c3RtZW50c19hY2NvdW50X2lkPSInLiRzdWJDYXRlZ29yeS0+aW52ZW50b3J5X2FkanVzdG1lbnRzX2FjY291bnRfaWQuJyIgaXNfZml4ZWRfYXNzZXQ9IicuJHN1YkNhdGVnb3J5LT5pc19maXhlZF9hc3NldC4nIiBpc19jd2lwPSInLiRzdWJDYXRlZ29yeS0+aXNfY3dpcC4nIiBkZXByZWNpYXRpb25fcmF0ZT0iJy4kc3ViQ2F0ZWdvcnktPmRlcHJlY2lhdGlvbl9yYXRlLiciIHNhbGVzX2FjY291bnRfaWQ9IicuJHN1YkNhdGVnb3J5LT5zYWxlc19hY2NvdW50X2lkLiciIGRlcHJlY2lhdGlvbl9jb3N0X2FjY291bnRfaWQ9IicuJHN1YkNhdGVnb3J5LT5kZXByZWNpYXRpb25fY29zdF9hY2NvdW50X2lkLiciIGRlcHJlY2lhdGlvbl9kaXNwb3NhbF9hY2NvdW50X2lkPSInLiRzdWJDYXRlZ29yeS0+ZGVwcmVjaWF0aW9uX2Rpc3Bvc2FsX2FjY291bnRfaWQuJyIgZGF0YS1wcm9kdWN0LXR5cGU9IicuKCRzdWJDYXRlZ29yeS0+aXNfZml4ZWRfYXNzZXQgPT0gMSA/ICdmaXhlZF9hc3NldCcgOiAoJHN1YkNhdGVnb3J5LT5pc19jd2lwID09IDEgPyAnY3dpcCcgOiAncHJvZHVjdHMnKSkuJyIgZGF0YS1zZXJ2aWNlPSInLigkc3ViQ2F0ZWdvcnktPmlzX3NlcnZpY2UpLiciPicuc3BhY2VzKCRzdGVwKS4kc3ViQ2F0ZWdvcnktPm5hbWUuJyAnLigkc3ViQ2F0ZWdvcmllcy0+Y291bnQoKSA+IDAgPyAnKCcuKCRzdWJDYXRlZ29yeS0+aXNfZml4ZWRfYXNzZXQgPT0gMSA/ICdGaXhlZCBBc3NldCcgOiAoJHN1YkNhdGVnb3J5LT5pc19jd2lwID09IDEgPyAnQ1dJUCcgOiAnUHJvZHVjdHMnKSkuJyknIDogJycpLic8L29wdGlvbj4nOwoJCQlpZigkc3ViQ2F0ZWdvcmllcy0+Y291bnQoKSA+IDApewoJCQkJJGRhdGEgLj0gY2F0ZWdvcnlPcHRpb25zKCRzdWJDYXRlZ29yaWVzLCAkY2hvc2VuLCAkc3RlcCsxLCAkaXNfZml4ZWRfYXNzZXQsICRpc19jd2lwLCAkYWxsU3ViQ2F0ZWdvcmllcywgJGFsbENhdGVnb3J5QXR0cmlidXRlcyk7CgkJCX0KCQl9Cgl9CgoJcmV0dXJuICRkYXRhOwp9CgpmdW5jdGlvbiBnZXRQcm9kdWN0QXR0cmlidXRlcygkcHJvZHVjdF9pZCl7CgkkYXR0cmlidXRlcyA9IFByb2R1Y3RBdHRyaWJ1dGU6OndpdGgoWydhdHRyaWJ1dGVPcHRpb24nLCAnYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZSddKQoJLT53aGVyZSgncHJvZHVjdF9pZCcsICRwcm9kdWN0X2lkKQoJLT5vcmRlckJ5KCdzZXJpYWxfbm8nLCAnYXNjJykKCS0+Z2V0KCk7Cgkkb3B0aW9ucyA9IFtdOwoJaWYoaXNzZXQoJGF0dHJpYnV0ZXNbMF0pKXsKCQlmb3JlYWNoKCRhdHRyaWJ1dGVzIGFzICRrZXkgPT4gJGF0dHJpYnV0ZSl7CgkJCWlmKGlzc2V0KCRhdHRyaWJ1dGUtPmF0dHJpYnV0ZU9wdGlvbi0+YXR0cmlidXRlLT5jb2RlKSl7CgkJCQlhcnJheV9wdXNoKCRvcHRpb25zLCAoaXNzZXQoJGF0dHJpYnV0ZS0+YXR0cmlidXRlT3B0aW9uLT5hdHRyaWJ1dGUtPmNvZGUpPyRhdHRyaWJ1dGUtPmF0dHJpYnV0ZU9wdGlvbi0+YXR0cmlidXRlLT5jb2RlOicnKS4nOicuKGlzc2V0KCRhdHRyaWJ1dGUtPmF0dHJpYnV0ZU9wdGlvbi0+bmFtZSk/JGF0dHJpYnV0ZS0+YXR0cmlidXRlT3B0aW9uLT5uYW1lOicnKSk7CgkJCX0KCQl9Cgl9CglyZXR1cm4gaXNzZXQoJG9wdGlvbnNbMF0pID8gJygnLmltcGxvZGUoJywgJywgJG9wdGlvbnMpLicpJyA6ICcnOwp9CgpmdW5jdGlvbiBnZXRQcm9kdWN0QXR0cmlidXRlc0Zhc3RlcigkcHJvZHVjdCl7Cgkkb3B0aW9ucyA9IFtdOwoJaWYoaXNzZXQoJHByb2R1Y3QtPmF0dHJpYnV0ZXNbMF0pKXsKCQlmb3JlYWNoKCRwcm9kdWN0LT5hdHRyaWJ1dGVzIGFzICRrZXkgPT4gJGF0dHJpYnV0ZSl7CgkJCWlmKGlzc2V0KCRhdHRyaWJ1dGUtPmF0dHJpYnV0ZU9wdGlvbi0+YXR0cmlidXRlLT5jb2RlKSl7CgkJCQlhcnJheV9wdXNoKCRvcHRpb25zLCAoaXNzZXQoJGF0dHJpYnV0ZS0+YXR0cmlidXRlT3B0aW9uLT5hdHRyaWJ1dGUtPmNvZGUpPyRhdHRyaWJ1dGUtPmF0dHJpYnV0ZU9wdGlvbi0+YXR0cmlidXRlLT5jb2RlOicnKS4nOicuKGlzc2V0KCRhdHRyaWJ1dGUtPmF0dHJpYnV0ZU9wdGlvbi0+bmFtZSk/JGF0dHJpYnV0ZS0+YXR0cmlidXRlT3B0aW9uLT5uYW1lOicnKSk7CgkJCX0KCQl9Cgl9CglyZXR1cm4gaXNzZXQoJG9wdGlvbnNbMF0pID8gJygnLmltcGxvZGUoJywgJywgJG9wdGlvbnMpLicpJyA6ICcnOwp9CgpmdW5jdGlvbiBzZWxlY3RlZFByb2R1Y3RBdHRyaWJ1dGVzKCRwcm9kdWN0X2lkLCAkYXR0cmlidXRlT3B0aW9ucyl7CgkkcHJvZHVjdEF0dHJpYnV0ZXMgPSBQcm9kdWN0QXR0cmlidXRlOjp3aGVyZSgncHJvZHVjdF9pZCcsICRwcm9kdWN0X2lkKS0+b3JkZXJCeSgnc2VyaWFsX25vJywgJ2FzYycpLT5nZXQoKTsKCSRkYXRhID0gJyc7CglpZihpc3NldCgkcHJvZHVjdEF0dHJpYnV0ZXNbMF0pKXsKCQlmb3JlYWNoKCRwcm9kdWN0QXR0cmlidXRlcyBhcyAka2V5ID0+ICRhdHRyaWJ1dGUpewoJCQkkZGF0YSAuPSAoJGtleSA+IDAgPyAnLCAnIDogJycpOwoJCQkkZGF0YSAuPSAoaW5fYXJyYXkoJGF0dHJpYnV0ZS0+YXR0cmlidXRlX29wdGlvbl9pZCwgJGF0dHJpYnV0ZU9wdGlvbnMpID8gJzxzdHJvbmc+Jy4oaXNzZXQoJGF0dHJpYnV0ZS0+YXR0cmlidXRlT3B0aW9uLT5hdHRyaWJ1dGUtPmNvZGUpPyRhdHRyaWJ1dGUtPmF0dHJpYnV0ZU9wdGlvbi0+YXR0cmlidXRlLT5jb2RlOicnKS4nOicuKGlzc2V0KCRhdHRyaWJ1dGUtPmF0dHJpYnV0ZU9wdGlvbi0+bmFtZSk/JGF0dHJpYnV0ZS0+YXR0cmlidXRlT3B0aW9uLT5uYW1lOicnKS4nPC9zdHJvbmc+JyA6IChpc3NldCgkYXR0cmlidXRlLT5hdHRyaWJ1dGVPcHRpb24tPm5hbWUpPyRhdHRyaWJ1dGUtPmF0dHJpYnV0ZU9wdGlvbi0+bmFtZTonJykpOwoJCX0KCX0KCglyZXR1cm4gJGRhdGE7Cn0KCmZ1bmN0aW9uIHVuaXROYW1lKCRpZCl7CglyZXR1cm4gXEFwcFxNb2RlbHNcSHJcVW5pdDo6d2hlcmUoJ2hyX3VuaXRfaWQnLCRpZCktPmZpcnN0KCk7Cn0KCmZ1bmN0aW9uIHVucmVhZE5vdGlmaWNhdGlvbigpewoJcmV0dXJuIE5vdGlmaWNhdGlvbjo6d2hlcmUoJ3VzZXJfaWQnLGF1dGgoKS0+dXNlcigpLT5pZCkKCS0+d2hlcmUoJ3R5cGUnLCd1bnJlYWQnKQoJLT5vcmRlckJ5KCdpZCcsICdkZXNjJykKCS0+Z2V0KCk7Cn0KCmZ1bmN0aW9uIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCRtZXNzYWdlcywgJHR5cGUsICRpdGVtX2lkID0gbnVsbCwgJHVzZXJzID0gW10sICRzdGF0dXMgPSBudWxsLCAkaWQgPSAwKXsKCWlmKGlzc2V0KCR1c2Vyc1swXSkpewoJCSRub3RpZmljYXRpb25zID0gW107CgkJZm9yZWFjaCAoJHVzZXJzIGFzICRrZXkgPT4gJHVzZXJfaWQpIHsKCQkJYXJyYXlfcHVzaCgkbm90aWZpY2F0aW9ucywgWwoJCQkJJ3VzZXJfaWQnID0+ICR1c2VyX2lkLAoJCQkJJ3JlcXVpc2l0aW9uX2l0ZW1faWQnID0+ICRpdGVtX2lkLAoJCQkJJ21lc3NhZ2VzJyA9PiAkbWVzc2FnZXMsCgkJCQkndHlwZScgPT4gJHR5cGUsCgkJCQknc3RhdHVzJyA9PiAkc3RhdHVzLAoJCQkJJ2NyZWF0ZWRfYnknID0+IGF1dGgoKS0+dXNlcigpLT5pZCwKCQkJCSdjcmVhdGVkX2F0JyA9PiBkYXRlKCdZLW0tZCBIOmk6cycpCgkJCV0pOwoJCX0KCQlOb3RpZmljYXRpb246Omluc2VydCgkbm90aWZpY2F0aW9ucyk7CgkJc2VuZEVtYWlsKCdtYWlscy5pbmRleCcsIFsKCQkJJ3RleHQnID0+ICRtZXNzYWdlcwoJCV0sICJOb3RpZmljYXRpb24gRnJvbSBCaXp6cGFjayIsIFxBcHBcVXNlcjo6d2hlcmVJbignaWQnLCAkdXNlcnMpLT5wbHVjaygnZW1haWwnKS0+dG9BcnJheSgpKTsKCQlyZXR1cm4gdHJ1ZTsKCX0KCQoJcmV0dXJuIGZhbHNlOwp9CgpmdW5jdGlvbiBjaGVja1BvQXR0YWNobWVudCgkcG9faWQsICRiaWxsX3R5cGU9bnVsbCwgJGdybl9pZD1udWxsKXsKCSRwbyA9IFxBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVyOjpmaW5kT3JGYWlsKCRwb19pZCk7CglpZigkcG8tPmlzX2Nsb3NlZCA9PSAwKXsKCQkkbm9uQmlsbGVkID0gXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEdyblxHb29kc1JlY2VpdmVkTm90ZTo6d2hlcmVEb2VzbnRIYXZlKCdyZWxQb0F0dGFjaG1lbnQnLCBmdW5jdGlvbigkcXVlcnkpewoJCQlyZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdzdGF0dXMnLCBbJ2FwcHJvdmVkJ10pLT53aGVyZSgnYmlsbF90eXBlJywncG8nKTsgCgkJfSkKCQktPndoZXJlKCdwdXJjaGFzZV9vcmRlcl9pZCcsICRwb19pZCkKCQktPmNvdW50KCk7CgkJaWYoJG5vbkJpbGxlZCA+IDApewoJCQkkY291bnQgPSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VcUHVyY2hhc2VPcmRlckF0dGFjaG1lbnQ6OndoZXJlKCdwdXJjaGFzZV9vcmRlcl9pZCcsJHBvX2lkKS0+d2hlcmVJbignc3RhdHVzJywgWydwZW5kaW5nJywnaGFsdCddKS0+d2hlcmUoJ2JpbGxfdHlwZScsJ3BvJyktPmNvdW50KCk7CgoJCQlpZiAoJGNvdW50ID4gMCkgewoJCQkJcmV0dXJuICgkYmlsbF90eXBlID09ICJwbyIgPyB0cnVlIDogKFxBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVyQXR0YWNobWVudDo6d2hlcmUoJ3B1cmNoYXNlX29yZGVyX2lkJywkcG9faWQpLT53aGVyZUluKCdzdGF0dXMnLCBbJ3BlbmRpbmcnLCdhcHByb3ZlZCddKS0+d2hlcmUoJ2JpbGxfdHlwZScsJ3BvJyktPmNvdW50KCkgPj0gMSA/IGZhbHNlIDogdHJ1ZSkpOwoJCQl9ZWxzZXsKCQkJCXJldHVybiAoXEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXJBdHRhY2htZW50Ojp3aGVyZSgncHVyY2hhc2Vfb3JkZXJfaWQnLCRwb19pZCktPndoZXJlSW4oJ3N0YXR1cycsIFsncGVuZGluZycsJ2FwcHJvdmVkJ10pLT53aGVyZSgnYmlsbF90eXBlJywncG8nKS0+Y291bnQoKSA+PSAxID8gZmFsc2UgOiB0cnVlKTsKCQkJfQoKCQkJcmV0dXJuIHRydWU7CgkJfQoJfQoKCXJldHVybiBmYWxzZTsKfQoKZnVuY3Rpb24gY2hlY2tQb0dybkF0dGFjaG1lbnQoJHBvX2lkLCAkZ3JuX2lkKXsKCSRwbyA9IFxBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVyOjpmaW5kT3JGYWlsKCRwb19pZCk7CglpZigkcG8tPmlzX2Nsb3NlZCA9PSAwKXsKCQkkY291bnQgPSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VcUHVyY2hhc2VPcmRlckF0dGFjaG1lbnQ6OndoZXJlKCdwdXJjaGFzZV9vcmRlcl9pZCcsICRwb19pZCkKCQktPndoZXJlKCdnb29kc19yZWNlaXZlZF9ub3RlX2lkJywgJGdybl9pZCkKCQktPndoZXJlKCdzdGF0dXMnLCdhcHByb3ZlZCcpCgkJLT53aGVyZSgnYmlsbF90eXBlJywnZ3JuJykKCQktPmNvdW50KCk7CgoJCXJldHVybiAoJGNvdW50ID4gMCA/IGZhbHNlIDogdHJ1ZSk7Cgl9CgoJcmV0dXJuIGZhbHNlOwp9CgoKZnVuY3Rpb24gY2FsY3VsYXRlR3JuUXR5QWdhaW5zdFB1cmNoYXNlT3JkZXIoJHB1cmNoYXNlT3JkZXIpewoJZm9yZWFjaCAoJHB1cmNoYXNlT3JkZXIgYXMgJGtleT0+JHZhbCl7CgkJaWYgKGlzc2V0KCR2YWwtPnJlbEdvb2RSZWNlaXZlTm90ZSkpewoJCQkkZ3JuUXR5ID0gJHZhbC0+cmVsR29vZFJlY2VpdmVOb3RlLT5lYWNoKGZ1bmN0aW9uICgkaXRlbSwkaSl7CgkJCQkkaXRlbVsnZ3JuX3F0eSddPSAkaXRlbS0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5zdW0oJ3F0eScpOwoJCQl9KTsKCQkJJHZhbFsndG90YWxfZ3JuX3F0eSddPSR2YWwtPnJlbEdvb2RSZWNlaXZlTm90ZS0+c3VtKCdncm5fcXR5Jyk7CgkJfQoJfQoKCXJldHVybiAkcHVyY2hhc2VPcmRlcjsKfQoKZnVuY3Rpb24gc3RhdHVzKCl7CglyZXR1cm4gYXJyYXkoCgkJImFjdGl2ZSI9PidBY3RpdmUnLAoJCSJpbmFjdGl2ZSI9PidJbmFjdGl2ZScsCgkJImNhbmNlbCI9PidDYW5jZWwnLAoJKTsKfQoKZnVuY3Rpb24gc3RhdHVzQXJyYXkoKXsKCXJldHVybiBhcnJheSgKCQkwID0+ICJQZW5kaW5nIiwKCQkxID0+ICJBcHByb3ZlZCIsCgkJMiA9PiAiSGFsdCIsCgkpOwp9CgpmdW5jdGlvbiByZXF1aXNpdGlvblN0YXR1cygpewoJcmV0dXJuIGFycmF5KAoJCTMgPT4gIkRyYWZ0IiwKCQkwID0+ICJQZW5kaW5nIiwKCQkxID0+ICJBcHByb3ZlZCIsCgkpOwp9CgpmdW5jdGlvbiBzdGF0dXNBcnJheUZvckhlYWQoKXsKCXJldHVybiBhcnJheSgKCQkwID0+ICJQZW5kaW5nIiwKCQkxID0+ICJBY2tub3dsZWRnZSIsCgkJMiA9PiAiSGFsdCIsCgkpOwp9CgpmdW5jdGlvbiBzdHJpbmdTdGF0dXNBcnJheSgkYXVkaXRlZCA9IGZhbHNlKXsKCWlmKCRhdWRpdGVkKXsKCQlyZXR1cm4gYXJyYXkoCgkJCSdwZW5kaW5nJyA9PiAiUGVuZGluZyIsCgkJCSdhdWRpdGVkJyA9PiAiQXBwcm92ZWQiLAoJCQknY2FuY2VsZWQnID0+ICJIYWx0IiwKCQkpOwoJfWVsc2V7CgkJcmV0dXJuIGFycmF5KAoJCQkncGVuZGluZycgPT4gIlBlbmRpbmciLAoJCQknYXBwcm92ZWQnID0+ICJBcHByb3ZlZCIsCgkJCSdoYWx0JyA9PiAiSGFsdCIsCgkJKTsKCX0KfQoKZnVuY3Rpb24gZGVsaXZlcnlTdGF0dXMoKXsKCXJldHVybiBhcnJheSgKCQkncHJvY2Vzc2luZycgPT4gIlByb2Nlc3NpbmciLAoJCSdjb25maXJtZWQnID0+ICJDb25maXJtZWQiLAoJCSdwdXJjaGFzZScgPT4gIlB1cmNoYXNlIiwKCQknZGVsaXZlcmVkJyA9PiAiRGVsaXZlcmVkIiwKCQkncGFydGlhbC1kZWxpdmVyZWQnID0+ICJQZXJjaWFsLURlbGl2ZXJ5IiwKCQknY2VuY2VsJyA9PiAiQ2VuY2VsIiwKCSk7Cn0KCmZ1bmN0aW9uIG1hcml0YWxTdGF0dXMoKXsKCXJldHVybiBhcnJheSgKCQknU2luZ2xlJywKCQknTWFycmllZCcsCgkJJ0Rpdm9yY2VkJywKCSk7Cn0KCmZ1bmN0aW9uIGJsb29kR3JvdXBzKCl7CglyZXR1cm4gYXJyYXkoCgkJJ04vQScsCgkJJ0ErJywKCQknQS0nLAoJCSdCKycsCgkJJ0ItJywKCQknTysnLAoJCSdPLScsCgkJJ0FCKycsCgkJJ0FCLScsCgkpOwp9CgpmdW5jdGlvbiB3ZWVrRGF5cygpewoJcmV0dXJuIGFycmF5KAoJCSJTYXR1cmRheSIsCgkJIlN1bmRheSIsCgkJIk1vbmRheSIsCgkJIlR1ZXNkYXkiLAoJCSJXZWRuZXNkYXkiLAoJCSJUaHVyc2RheSIsCgkJIkZyaWRheSIsCgkpOwp9CgpmdW5jdGlvbiB3ZWVrRGF5c0luZGV4KCl7CglyZXR1cm4gYXJyYXkoCgkJIlNhdHVyZGF5IiA9PiAwLAoJCSJTdW5kYXkiID0+IDEsCgkJIk1vbmRheSIgPT4gMiwKCQkiVHVlc2RheSIgPT4gMywKCQkiV2VkbmVzZGF5IiA9PiA0LAoJCSJUaHVyc2RheSIgPT4gNSwKCQkiRnJpZGF5IiA9PiA2LAoJKTsKfQoKZnVuY3Rpb24gZGF5c0RpZmZlcmVuY2UoJGZyb20sICR0bykKewoJJGZyb20gPSBuZXcgRGF0ZVRpbWUoJGZyb20pOwoJJHRvID0gbmV3IERhdGVUaW1lKCR0byk7CgkkZGlmZmVyZW5jZSA9ICRmcm9tLT5kaWZmKCR0byk7CglyZXR1cm4gJGRpZmZlcmVuY2UtPmRheXMrMTsKfQoKZnVuY3Rpb24gbWludXRlc0RpZmZlcmVuY2UoJGZyb20sJHRvKQp7Cgkkc3RhcnRfZGF0ZSA9IG5ldyBEYXRlVGltZSgkZnJvbSk7Cgkkc2luY2Vfc3RhcnQgPSAkc3RhcnRfZGF0ZS0+ZGlmZihuZXcgRGF0ZVRpbWUoJHRvKSk7CgkkbWludXRlcyA9ICRzaW5jZV9zdGFydC0+ZGF5cyAqIDI0ICogNjA7CgkkbWludXRlcyArPSAkc2luY2Vfc3RhcnQtPmggKiA2MDsKCSRtaW51dGVzICs9ICRzaW5jZV9zdGFydC0+aTsKCXJldHVybiAkbWludXRlczsKfQoKZnVuY3Rpb24gcHJpbWFyeUFwcHJvdmFscygpewoJcmV0dXJuIFsKCQlbCgkJCSduYW1lJyA9PiAnUHJvY2Vzc2luZycsCgkJCSdjbGFzcycgPT4gJ3dhcm5pbmcnCgkJXSwKCQlbCgkJCSduYW1lJyA9PiAnQXBwcm92ZWQnLAoJCQknY2xhc3MnID0+ICdzdWNjZXNzJwoJCV0sCgkJWwoJCQknbmFtZScgPT4gJ1JlamVjdGVkJywKCQkJJ2NsYXNzJyA9PiAnZGFuZ2VyJwoJCV0sCgldOwp9CgpmdW5jdGlvbiB1bmlxdWVDb2RlKCRsZW5ndGgsJHByZWZpeCwkdGFibGUsJGZpZWxkKXsKCSRwcmVmaXhfbGVuZ3RoID0gc3RybGVuKCRwcmVmaXgpOwoJJG1heF9pZCA9IERCOjp0YWJsZSgkdGFibGUpLT5tYXgoJGZpZWxkKTsKCSRuZXcgPSAoaW50KSgkbWF4X2lkKTsKCSRuZXcrKzsKCSRudW1iZXJfb2ZfemVybyA9ICRsZW5ndGgtJHByZWZpeF9sZW5ndGgtc3RybGVuKCRuZXcpOwoJJHplcm8gPSBzdHJfcmVwZWF0KCIwIiwgJG51bWJlcl9vZl96ZXJvKTsKCSRtYWRlX2lkID0gJHByZWZpeC4kemVyby4kbmV3OwoJcmV0dXJuICRtYWRlX2lkOwp9CgpmdW5jdGlvbiBlbnRyeVVuaXF1ZUNvZGUoJGxlbmd0aCwkcHJlZml4LCR0YWJsZSwkZmllbGQpewoJJHByZWZpeF9sZW5ndGggPSBzdHJsZW4oJHByZWZpeCk7CgkkbWF4X2lkID0gREI6OnRhYmxlKCR0YWJsZSktPndoZXJlKERCOjpyYXcoJ3N1YnN0cihgJy4kZmllbGQuJ2AsIDEsICcuc3RybGVuKCRwcmVmaXgpLicpJyksICRwcmVmaXgpLT5tYXgoJGZpZWxkKTsKCSRuZXcgPSAoaW50KShzdHJfcmVwbGFjZSgkcHJlZml4LCAnJywgJG1heF9pZCkpOwoJJG5ldysrOwoJJG51bWJlcl9vZl96ZXJvID0gJGxlbmd0aC0kcHJlZml4X2xlbmd0aC1zdHJsZW4oJG5ldyk7CgkkemVybyA9IHN0cl9yZXBlYXQoIjAiLCAkbnVtYmVyX29mX3plcm8pOwoJJG1hZGVfaWQgPSAkcHJlZml4LiR6ZXJvLiRuZXc7CglyZXR1cm4gJG1hZGVfaWQ7Cn0KCmZ1bmN0aW9uIHVuaXF1ZUNvZGVXaXRob3V0UHJlZml4KCRsZW5ndGgsJHRhYmxlLCRmaWVsZCl7CgkkbWF4ID0gREI6OnRhYmxlKCR0YWJsZSktPm1heCgkZmllbGQpOwoJJG5ldz0oaW50KSgkbWF4KTsKCSRuZXcrKzsKCSRudW1iZXJfb2ZfemVybz0kbGVuZ3RoLXN0cmxlbigkbmV3KTsKCSR6ZXJvPXN0cl9yZXBlYXQoIjAiLCAkbnVtYmVyX29mX3plcm8gPCAwID8gMCA6ICRudW1iZXJfb2ZfemVybyk7CgkkbWFkZV9pZD0kemVyby4kbmV3OwoJcmV0dXJuICRtYWRlX2lkOwp9CgoKZnVuY3Rpb24gdW5pcXVlU3RyaW5nR2VuZXJhdG9yKCl7CgkkcyA9ICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eic7CgkkcyA9IHN0cl9zaHVmZmxlKCRzKTsKCSRsID0gJ0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaJzsKCSRsID0gc3RyX3NodWZmbGUoJGwpOwoJJHNwYyA9ICdAXyMtJzsKCSRzcGMgPSBzdHJfc2h1ZmZsZSgkc3BjKTsKCSRudW0gPSAnMDEyMzQ1Njc4OSc7CgkkbnVtID0gc3RyX3NodWZmbGUoJG51bSk7CglyZXR1cm4gJG51bS5zdWJzdHIoJHNwYywwLDEpLnN0cl9zaHVmZmxlKHN1YnN0cigkbCwwLDIpLnN1YnN0cigkcywwLDIpKS50aW1lKCk7ICAKfQoKZnVuY3Rpb24gcmF0aW5nR2VuZXJhdGUoJHRvdGFsU2NvcmU9JycsJHRvdGFsQ291bnQ9JycsJGlzUGRmPWZhbHNlKQp7CglpZiAoJHRvdGFsU2NvcmUgPiAwICYmICR0b3RhbENvdW50ID4wKSB7CgkJLy8kdG90YWxNYXhEZWNpbmFsU2NvcmUgPSAkdG90YWxTY29yZS9Db2x1bW5Db3VudCgnc3VwcGxpZXJfcmF0dGluZ3MnKTsKCQkkYXZlcmFnZVJhdGluZyA9ICR0b3RhbFNjb3JlLyR0b3RhbENvdW50OwoJfWVsc2V7CgkJJGF2ZXJhZ2VSYXRpbmcgPSAwLjAwOwoJfQoKCSRmb3JtYXRlZFZhbCA9IG51bWJlcl9mb3JtYXQoJGF2ZXJhZ2VSYXRpbmcsMik7CgkkcGllY2VzID0gZXhwbG9kZSgiLiIsICRmb3JtYXRlZFZhbCk7CgoJaWYgKCRpc1BkZikgewoJCSRzdGFyX2xpc3QgPSBzdHJfcmVwZWF0KCcmIzk3MzM7JywgbnVtYmVyX2Zvcm1hdCgkcGllY2VzWzBdKSk7Cgl9ZWxzZXsKCgkJJHN0YXJfbGlzdCA9IHN0cl9yZXBlYXQoJzxpIGNsYXNzPSJmYSBmYS1zdGFyIHJhdGluZy1jb2xvciIgYXJpYS1oaWRkZW49InRydWUiPjwvaT4nLCBudW1iZXJfZm9ybWF0KCRwaWVjZXNbMF0pKTsKCX0KCglpZiAoJHBpZWNlc1sxXT4wKSB7CgkJJGhhbGZTdGFydCA9ICgkaXNQZGYpPyAnJiMxMDAzMTsnIDogJzxpIGNsYXNzPSJmYSBmYS1zdGFyLWhhbGYtbyByYXRpbmctY29sb3IiIGFyaWEtaGlkZGVuPSJ0cnVlIj48L2k+JzsKCX1lbHNlewoJCSRoYWxmU3RhcnQ9Jyc7Cgl9CgoJJGJsYW5rU3Rhcj0oNS0kZm9ybWF0ZWRWYWwpOwoKCSRwcmludFJhdGluZz0nJzsKCglmb3IoJGo9MTsgJGogPD0kYmxhbmtTdGFyOyRqKyspewoJCSRwcmludFJhdGluZyAuPSgkaXNQZGYpPyAnJiM5NzM0Oyc6JzxpIGNsYXNzPSJmYSBmYS1zdGFyIj48L2k+JzsKCX0KCQoJcmV0dXJuICRzdGFyX2xpc3QuJycuJGhhbGZTdGFydC4nJy4kcHJpbnRSYXRpbmc7Cn0KCmZ1bmN0aW9uIHNpbmdsZVJhdGluZ0dlbmVyYXRlKCR0b3RhbFNjb3JlPScnLCR0b3RhbENvdW50PScnKQp7CglpZiAoJHRvdGFsU2NvcmUgPiAwICYmICR0b3RhbENvdW50ID4wKSB7CgkJJGF2ZXJhZ2VSYXRpbmcgPSAkdG90YWxTY29yZS8kdG90YWxDb3VudDsKCX1lbHNlewoJCSRhdmVyYWdlUmF0aW5nID0gMC4wMDsKCX0KCgkkZm9ybWF0ZWRWYWwgPSBudW1iZXJfZm9ybWF0KCRhdmVyYWdlUmF0aW5nLDIpOwoJJHBpZWNlcyA9IGV4cGxvZGUoIi4iLCAkZm9ybWF0ZWRWYWwpOwoKCSRzdGFyX2xpc3QgPSBzdHJfcmVwZWF0KCc8aSBjbGFzcz0iZmEgZmEtc3RhciByYXRpbmctY29sb3IiIGFyaWEtaGlkZGVuPSJ0cnVlIj48L2k+JywgbnVtYmVyX2Zvcm1hdCgkcGllY2VzWzBdKSk7CgoJaWYgKCRwaWVjZXNbMV0+MCkgewoJCSRoYWxmU3RhcnQgPSAnPGkgY2xhc3M9ImZhIGZhLXN0YXItaGFsZi1vIHJhdGluZy1jb2xvciIgYXJpYS1oaWRkZW49InRydWUiPjwvaT4nOwoJfWVsc2V7CgkJJGhhbGZTdGFydD0nJzsKCX0KCgkkYmxhbmtTdGFyPSg1LSRmb3JtYXRlZFZhbCk7CgoJJHByaW50UmF0aW5nPScnOwoKCWZvcigkaj0xOyAkaiA8PSRibGFua1N0YXI7JGorKyl7CgkJJHByaW50UmF0aW5nIC49JzxpIGNsYXNzPSJmYSBmYS1zdGFyIj48L2k+JzsKCX0KCglyZXR1cm4gJHN0YXJfbGlzdC4nJy4kaGFsZlN0YXJ0LicnLiRwcmludFJhdGluZzsKfQoKZnVuY3Rpb24gQ29sdW1uQ291bnQoJHRhYmxlKQp7CgkkY29sdW1uID0gY291bnQoXElsbHVtaW5hdGVcU3VwcG9ydFxGYWNhZGVzXFNjaGVtYTo6Z2V0Q29sdW1uTGlzdGluZygkdGFibGUpKTsKCXJldHVybiAkcmVtb3ZlRXh0cmFDb2x1bW49JGNvbHVtbi0xMDsKfQoKCmZ1bmN0aW9uIHN1cHBsaWVyUGF5bWVudFRlcm0oKXsKCglyZXR1cm4gXEFwcFxNb2RlbHNcUG1zTW9kZWxzXFBheW1lbnRUZXJtOjpzZWxlY3QoJ3Rlcm0nLCdpZCcpLT5nZXQoKTsKfQoKZnVuY3Rpb24gc3VwcGxpZXJSZWNlaXZlZFRlcm0oKXsKCXJldHVybiBbCgkJJ3BhcnRpYWwnPT4nUGFydGlhbCBSZWNlaXZlZCcsCgkJJ2Z1bGwnPT4nRnVsbCBSZWNlaXZlZCcsCgldOwp9CgpmdW5jdGlvbiBzdXBwbGllckNyaXRlcmlhKCRzdXBwbGllcikKewoJJGRhdGEgPSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xTY2hlbWE6OmdldENvbHVtbkxpc3RpbmcoJ3N1cHBsaWVyX3JhdHRpbmdzJyk7CgkkZGVsZXRlRGVmYXVsdCA9IFswLDEsOSwxMCwxMSwxMiwxMywxNCwxNSwxNl07Cgkka2V5cyA9IGFycmF5X2RpZmYoYXJyYXlfa2V5cygkZGF0YSksJGRlbGV0ZURlZmF1bHQpOwoJJGNvbHVtbnMgPSBbXTsKCSRsb29wPTA7Cglmb3JlYWNoICgka2V5cyBhcyAkaT0+ICR2YWx1ZSl7CgkJJGxvb3ArKzsKCQkkc3VwcGxpZXJEYXRhID0gKG9iamVjdClbCgkJCSduYW1lJyA9PiB1Y3dvcmRzKHN0cl9yZXBsYWNlKCdfJywnICcsJGRhdGFbJHZhbHVlXSkpLAoJCQkncmF0aW5nJyA9PiBzaW5nbGVSYXRpbmdHZW5lcmF0ZSgkc3VwcGxpZXItPlN1cHBsaWVyUmF0aW5ncygpLT5zdW0oJGRhdGFbJHZhbHVlXSksJHN1cHBsaWVyLT5TdXBwbGllclJhdGluZ3MoKS0+Y291bnQoKSksCgkJCSdwb2ludCcgPT4gbnVtYmVyX2Zvcm1hdCgoJHN1cHBsaWVyLT5TdXBwbGllclJhdGluZ3MoKS0+c3VtKCRkYXRhWyR2YWx1ZV0pLyRzdXBwbGllci0+U3VwcGxpZXJSYXRpbmdzKCktPmNvdW50KCkpLDIpCgkJXTsKCQkkdmlldyA9ICc8dHI+CgkJPHRoPicuJGxvb3AuJzwvdGg+CgkJPHRkPicuJHN1cHBsaWVyRGF0YS0+bmFtZS4nPC90ZD4KCQk8dGQ+Jy4kc3VwcGxpZXJEYXRhLT5yYXRpbmcuJzwvdGQ+CgkJPHRkPicuJHN1cHBsaWVyRGF0YS0+cG9pbnQuJzwvdGQ+CgkJPC90cj4nOwoJCSRjb2x1bW5zW10gPSAkdmlldzsKCX0KCXJldHVybiBpbXBsb2RlKCcgJywkY29sdW1ucyk7Cn0KCmZ1bmN0aW9uIHN1cHBsaWVyQ3JpdGVyaWFDb2x1bW5zKCl7CgkkZGF0YSA9IFxJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xTY2hlbWE6OmdldENvbHVtbkxpc3RpbmcoJ3N1cHBsaWVyX3JhdHRpbmdzJyk7CgoJJGRlbGV0ZURlZmF1bHQgPSBbMCwxLDksMTAsMTEsMTIsMTMsMTQsMTUsMTYsMTcsMTgsIDE5XTsKCSRrZXlzID0gYXJyYXlfZGlmZihhcnJheV9rZXlzKCRkYXRhKSwkZGVsZXRlRGVmYXVsdCk7CgkkY29sdW1ucyA9IFtdOwoJZm9yZWFjaCAoJGtleXMgYXMgJGtleT0+JHYpewoJCSRjb2x1bW5zWyRrZXldPSAkZGF0YVskdl07Cgl9CgoJcmV0dXJuICRjb2x1bW5zOwp9CgpmdW5jdGlvbiBzdXBwbGllck9wZW5pbmdCYWxhbmNlKCRzdXBwbGllcl9pZCwgJGRhdGUgPSBudWxsKXsKCSRxdWVyeSA9IFxBcHBcTW9kZWxzXFBtc01vZGVsc1xTdXBwbGllckxlZGdlcnM6OndoZXJlKCdzdXBwbGllcl9pZCcsICRzdXBwbGllcl9pZCk7CgoJcmV0dXJuIFsKCQknZGViaXQnID0+ICRxdWVyeS0+c3VtKCdkZWJpdCcpLAoJCSdjcmVkaXQnID0+ICRxdWVyeS0+c3VtKCdjcmVkaXQnKSwKCQknYmFsYW5jZScgPT4gKC0xKiRxdWVyeS0+c3VtKCdkZWJpdCcpKSskcXVlcnktPnN1bSgnY3JlZGl0JyksCgldOwp9CgpmdW5jdGlvbiBjdXN0b21lck9wZW5pbmdCYWxhbmNlKCRjdXN0b21lcl9pZCwgJGRhdGUgPSBudWxsKXsKCSRxdWVyeSA9IFxBcHBcTW9kZWxzXFNhbGVzXEN1c3RvbWVyTGVkZ2VyOjp3aGVyZSgnY3VzdG9tZXJfaWQnLCAkY3VzdG9tZXJfaWQpOwoKCXJldHVybiBbCgkJJ2RlYml0JyA9PiAkcXVlcnktPnN1bSgnZGViaXQnKSwKCQknY3JlZGl0JyA9PiAkcXVlcnktPnN1bSgnY3JlZGl0JyksCgkJJ2JhbGFuY2UnID0+ICgtMSokcXVlcnktPnN1bSgnZGViaXQnKSkrJHF1ZXJ5LT5zdW0oJ2NyZWRpdCcpLAoJXTsKfQoKZnVuY3Rpb24gZGVsaXZlcmFibGVXaXNlQnVkZ2V0KCRwcm9qZWN0X2lkLCAkZGVsaXZlcmFibGVfaWQpCnsKCSR0b3RhbENvc3QgPSAwOwoJJGNkciA9IFtdOwoJLy8kcmVxdWlzaXRpb25zID0gUmVxdWlzaXRpb246OndoZXJlKFsncHJvamVjdF9pZCcgPT4gJHByb2plY3RfaWQsICdkZWxpdmVyYWJsZV9pZCcgPT4gJGRlbGl2ZXJhYmxlX2lkXSktPmdldCgpOwoKCSRyZXF1aXNpdGlvbnMgPSBSZXF1aXNpdGlvbjo6d2hlcmVIYXMoJ3Byb2plY3RUYXNrLnN1YkRlbGl2ZXJhYmxlLmRlbGl2ZXJhYmxlJywgZnVuY3Rpb24oJHF1ZXJ5KSAKCQl1c2UoJHByb2plY3RfaWQpeyAKCQkJcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3Byb2plY3RfaWQnLCAkcHJvamVjdF9pZCk7CiAgICAgICAgfSkKCQktPndoZXJlSGFzKCdwcm9qZWN0VGFzay5zdWJEZWxpdmVyYWJsZS5kZWxpdmVyYWJsZScsIGZ1bmN0aW9uKCRxdWVyeSkgCgkJdXNlKCRkZWxpdmVyYWJsZV9pZCl7IAoJCQlyZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaWQnLCAkZGVsaXZlcmFibGVfaWQpOwogICAgICAgIH0pLT5nZXQoKTsKCglpZigkcmVxdWlzaXRpb25zLT5jb3VudCgpID4gMCkgewoJCWZvcmVhY2ggKCRyZXF1aXNpdGlvbnMgYXMgJHJlcXVpc2l0aW9uKSB7CgkJCWZvcmVhY2ggKCRyZXF1aXNpdGlvbi0+cmVsUmVxdWlzaXRpb25EZWxpdmVyeSBhcyAkZGVsaXZlcnkpIHsKCQkJCSRjZHJbXSA9ICRkZWxpdmVyeS0+cmVmZXJlbmNlX25vOwoJCQl9CgkJfQoJCSRjZCA9IGFycmF5X3VuaXF1ZSgkY2RyKTsKCQkkdG90YWxDb3N0ID0gSW52ZW50b3J5TG9nczo6d2hlcmVJbigncmVmZXJlbmNlJywgJGNkKS0+c3VtKCd0b3RhbF9wcmljZScpOwoJfQoJcmV0dXJuICR0b3RhbENvc3Q7Cn0KCmZ1bmN0aW9uIGNvbnN1bWVkQnVkZ2V0KCRwcm9qZWN0X2lkKQp7CgkkdG90YWxDb3N0ID0gMDsKCSRjZHIgPSBbXTsKCgkvLyRyZXF1aXNpdGlvbnMgPSBSZXF1aXNpdGlvbjo6d2hlcmUoJ3Byb2plY3RfaWQnLCAkcHJvamVjdF9pZCktPmdldCgpOwoJJHJlcXVpc2l0aW9ucyA9IFJlcXVpc2l0aW9uOjp3aGVyZUhhcygncHJvamVjdFRhc2suc3ViRGVsaXZlcmFibGUuZGVsaXZlcmFibGUnLCBmdW5jdGlvbigkcXVlcnkpIAoJCXVzZSgkcHJvamVjdF9pZCl7IAoJCQlyZXR1cm4gJHF1ZXJ5LT53aGVyZSgncHJvamVjdF9pZCcsICRwcm9qZWN0X2lkKTsKICAgICAgICB9KS0+Z2V0KCk7CgoJaWYoJHJlcXVpc2l0aW9ucy0+Y291bnQoKSA+IDApIHsKCQlmb3JlYWNoICgkcmVxdWlzaXRpb25zIGFzICRyZXF1aXNpdGlvbikgewoJCQlmb3JlYWNoICgkcmVxdWlzaXRpb24tPnJlbFJlcXVpc2l0aW9uRGVsaXZlcnkgYXMgJGRlbGl2ZXJ5KSB7CgkJCQkkY2RyW10gPSAkZGVsaXZlcnktPnJlZmVyZW5jZV9ubzsKCQkJfQoJCX0KCQkkY2QgPSBhcnJheV91bmlxdWUoJGNkcik7CgkJJHRvdGFsQ29zdCA9IEludmVudG9yeUxvZ3M6OndoZXJlSW4oJ3JlZmVyZW5jZScsICRjZCktPnN1bSgndG90YWxfcHJpY2UnKTsKCX0KCXJldHVybiAkdG90YWxDb3N0Owp9CgpmdW5jdGlvbiBkb3dubG9hZFBERigkbmFtZSwkZGF0YSwkdmlldywkcGFwZXIsJG9yaWVudGF0aW9uKXsKCXJldHVybiBcUERGOjpsb2FkVmlldygkdmlldywgJGRhdGEpLT5zZXRQYXBlcigkcGFwZXIsICRvcmllbnRhdGlvbiktPnNldE9wdGlvbnMoWydkZWZhdWx0Rm9udCcgPT4gJ3NhbnMtc2VyaWYnXSktPnNldE9wdGlvbnMoYXJyYXkoJ2lzUmVtb3RlRW5hYmxlZCcgPT4gdHJ1ZSkpLT5zZXRPcHRpb25zKGFycmF5KCdET01QREZfRU5BQkxFX0NTU19GTE9BVCAnID0+IHRydWUpKS0+ZG93bmxvYWQoJG5hbWUuJy0oJy5kYXRlKCdGIGosWSBnOmkgYScpLicpLnBkZicpOwp9CgpmdW5jdGlvbiBkb3dubG9hZEV4Y2VsKCR2aWV3LCAkZGF0YSwgJG5hbWUsICR0eXBlID0gJ3hsc3gnKXsKICAgIHJldHVybiBcRXhjZWw6OmRvd25sb2FkKG5ldyBcQXBwXEV4cG9ydHNcRXhjZWwoJHZpZXcsICRkYXRhKSwgJG5hbWUuJygnLmRhdGUoJ0YgaixZIGc6aSBhJykuJyknLicuJy4kdHlwZSk7Cn0KCmZ1bmN0aW9uIGdldERlcGFydG1lbnRIZWFkKCR1c2VyX2lkKXsKCSR1c2VyID0gVXNlcjo6ZmluZCgkdXNlcl9pZCk7CgkkdXNlcnMgPSBVc2VyOjp3aGVyZUhhcygnZW1wbG95ZWUnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkdXNlcil7CgkJcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2FzX3VuaXRfaWQnLCAkdXNlci0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpCgkJLT53aGVyZSgnYXNfZGVwYXJ0bWVudF9pZCcsICR1c2VyLT5lbXBsb3llZS0+YXNfZGVwYXJ0bWVudF9pZCk7Cgl9KS0+Z2V0KCk7CgoJJGhlYWRzID0gW107CglpZihpc3NldCgkdXNlcnNbMF0pKXsKCQlmb3JlYWNoKCR1c2VycyBhcyAkdXNlcil7CgkJCWlmKCR1c2VyLT5oYXNSb2xlKCdEZXBhcnRtZW50LUhlYWQnKSl7CgkJCQlhcnJheV9wdXNoKCRoZWFkcywgJHVzZXItPmlkKTsKCQkJfQoJCX0KCX0KCgkkdXNlckRhdGEgPSBVc2VyOjp3aGVyZUluKCdpZCcsICRoZWFkcyktPndoZXJlSGFzKCdlbXBsb3llZScsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCR1c2VyKXsKCQlyZXR1cm4gJHF1ZXJ5LT53aGVyZSgnYXNfdW5pdF9pZCcsICR1c2VyLT5lbXBsb3llZS0+YXNfdW5pdF9pZCkKCQktPndoZXJlKCdhc19kZXBhcnRtZW50X2lkJywgJHVzZXItPmVtcGxveWVlLT5hc19kZXBhcnRtZW50X2lkKTsKCX0pLT5maXJzdCgpOwoKCXJldHVybiBpc3NldCgkdXNlckRhdGEtPmlkKSA/ICR1c2VyRGF0YS0+aWQgOiAwOwp9CgpmdW5jdGlvbiBnZXRNYW5hZ2VySW5mbygkcm9sZXNfbmFtZSwgJHVuaXRfaWQgPSBudWxsLCAkYWxsID0gZmFsc2UpCnsKCSR1bml0X2lkID0gKCR1bml0X2lkICE9IG51bGwgPyAkdW5pdF9pZCA6IGF1dGgoKS0+dXNlcigpLT5wcmlvcml0aWVzLT5wbHVjaygnaHJfdW5pdF9pZCcpLT50b0FycmF5KClbMF0pOwoJJHN1cGVyUGVybWlzc2lvbj1bJ1B1cmNoYXNlLURlcGFydG1lbnQnLCdNYW5hZ2VtZW50JywnQmlsbGluZycsJ0F1ZGl0JywnQWNjb3VudHMnLCdHYXRlIFBlcm1pc3Npb24nLCdRdWFsaXR5LUVuc3VyZScsICdTdG9yZS1NYW5hZ2VyJywgJ1NCVSBIZWFkJywnU3BvbnNvciddOwoKCWlmKGluX2FycmF5KCRyb2xlc19uYW1lLCRzdXBlclBlcm1pc3Npb24pKXsKCQkkdXNlcnM9VXNlcjo6d2hlbighZW1wdHkoJHVuaXRfaWQpLGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgkdW5pdF9pZCl7CgkJCXJldHVybiAkcXVlcnktPndoZXJlSGFzKCdwcmlvcml0aWVzJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCR1bml0X2lkKXsKCQkJCXJldHVybiAkcXVlcnktPndoZXJlKCdocl91bml0X2lkJywgJHVuaXRfaWQpOwoJCQl9KTsKCQl9KS0+Z2V0KCk7Cgl9ZWxzZXsKCQkkdXNlcnM9VXNlcjo6d2hlbihpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpLGZ1bmN0aW9uICgkcXVlcnkpewoJCQlyZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncHJpb3JpdGllcycsIGZ1bmN0aW9uICgkcXVlcnkpewoJCQkJcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX3VuaXRfaWQnLCBhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpCgkJCQktPndoZXJlKCdocl9kZXBhcnRtZW50X2lkJywgYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc19kZXBhcnRtZW50X2lkKTsKCQkJfSk7CgkJfSktPmdldCgpOwoJfQoJCgkkaGVhZHMgPSBbXTsKCWlmKGlzc2V0KCR1c2Vyc1swXSkpewoJCWZvcmVhY2goJHVzZXJzIGFzICR1c2VyKXsKCQkJaWYoJHVzZXItPmhhc1JvbGUoJHJvbGVzX25hbWUpKXsKCQkJCWFycmF5X3B1c2goJGhlYWRzLCAkdXNlci0+aWQpOwoJCQl9CgkJfQoJfQoKCWlmKCRhbGwpewoJCXJldHVybiBVc2VyOjp3aGVyZUluKCdpZCcsICRoZWFkcyktPnBsdWNrKCdpZCcpLT50b0FycmF5KCk7Cgl9CgoJJHVzZXJEYXRhID0gVXNlcjo6d2hlcmVJbignaWQnLCAkaGVhZHMpLT5maXJzdCgpOwoJCglyZXR1cm4gaXNzZXQoJHVzZXJEYXRhLT5pZCkgPyAkdXNlckRhdGEtPmlkIDogMDsKfQoKZnVuY3Rpb24gZ2V0RGVwYXJ0bWVudEhlYWRJbmZvKCR1bml0X2lkLCAkZGVwYXJ0bWVudF9pZCkKewoJJHVzZXJzID0gVXNlcjo6d2hlcmVIYXMoJ3ByaW9yaXRpZXMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJHVuaXRfaWQsICRkZXBhcnRtZW50X2lkKXsKCQkJcmV0dXJuICRxdWVyeS0+d2hlcmUoWwoJCQkJJ2hyX3VuaXRfaWQnID0+ICR1bml0X2lkLAoJCQkJJ2hyX2RlcGFydG1lbnRfaWQnID0+ICRkZXBhcnRtZW50X2lkLAoJCQldKTsKCX0pLT5nZXQoKTsKCQoJJGhlYWRzID0gW107CglpZihpc3NldCgkdXNlcnNbMF0pKXsKCQlmb3JlYWNoKCR1c2VycyBhcyAkdXNlcil7CgkJCWlmKCR1c2VyLT5oYXNSb2xlKCdEZXBhcnRtZW50LUhlYWQnKSl7CgkJCQlhcnJheV9wdXNoKCRoZWFkcywgJHVzZXItPmlkKTsKCQkJfQoJCX0KCX0KCgkkdXNlckRhdGEgPSBVc2VyOjp3aGVyZUluKCdpZCcsICRoZWFkcyktPmZpcnN0KCk7CgkKCXJldHVybiBpc3NldCgkdXNlckRhdGEtPmlkKSA/ICR1c2VyRGF0YS0+aWQgOiAwOwp9CgpmdW5jdGlvbiBpbldvcmQoJG51bWJlcikgewogICAgJGh5cGhlbiAgICAgID0gJy0nOwogICAgJGNvbmp1bmN0aW9uID0gJyBhbmQgJzsKICAgICRzZXBhcmF0b3IgICA9ICcsICc7CiAgICAkbmVnYXRpdmUgICAgPSAnbmVnYXRpdmUgJzsKICAgICRkZWNpbWFsICAgICA9ICcgcG9pbnQgJzsKICAgICRkaWN0aW9uYXJ5ICA9IGFycmF5KAogICAgICAgIDAgICAgICAgICAgICAgICAgICAgPT4gJ3plcm8nLAogICAgICAgIDEgICAgICAgICAgICAgICAgICAgPT4gJ29uZScsCiAgICAgICAgMiAgICAgICAgICAgICAgICAgICA9PiAndHdvJywKICAgICAgICAzICAgICAgICAgICAgICAgICAgID0+ICd0aHJlZScsCiAgICAgICAgNCAgICAgICAgICAgICAgICAgICA9PiAnZm91cicsCiAgICAgICAgNSAgICAgICAgICAgICAgICAgICA9PiAnZml2ZScsCiAgICAgICAgNiAgICAgICAgICAgICAgICAgICA9PiAnc2l4JywKICAgICAgICA3ICAgICAgICAgICAgICAgICAgID0+ICdzZXZlbicsCiAgICAgICAgOCAgICAgICAgICAgICAgICAgICA9PiAnZWlnaHQnLAogICAgICAgIDkgICAgICAgICAgICAgICAgICAgPT4gJ25pbmUnLAogICAgICAgIDEwICAgICAgICAgICAgICAgICAgPT4gJ3RlbicsCiAgICAgICAgMTEgICAgICAgICAgICAgICAgICA9PiAnZWxldmVuJywKICAgICAgICAxMiAgICAgICAgICAgICAgICAgID0+ICd0d2VsdmUnLAogICAgICAgIDEzICAgICAgICAgICAgICAgICAgPT4gJ3RoaXJ0ZWVuJywKICAgICAgICAxNCAgICAgICAgICAgICAgICAgID0+ICdmb3VydGVlbicsCiAgICAgICAgMTUgICAgICAgICAgICAgICAgICA9PiAnZmlmdGVlbicsCiAgICAgICAgMTYgICAgICAgICAgICAgICAgICA9PiAnc2l4dGVlbicsCiAgICAgICAgMTcgICAgICAgICAgICAgICAgICA9PiAnc2V2ZW50ZWVuJywKICAgICAgICAxOCAgICAgICAgICAgICAgICAgID0+ICdlaWdodGVlbicsCiAgICAgICAgMTkgICAgICAgICAgICAgICAgICA9PiAnbmluZXRlZW4nLAogICAgICAgIDIwICAgICAgICAgICAgICAgICAgPT4gJ3R3ZW50eScsCiAgICAgICAgMzAgICAgICAgICAgICAgICAgICA9PiAndGhpcnR5JywKICAgICAgICA0MCAgICAgICAgICAgICAgICAgID0+ICdmb3VydHknLAogICAgICAgIDUwICAgICAgICAgICAgICAgICAgPT4gJ2ZpZnR5JywKICAgICAgICA2MCAgICAgICAgICAgICAgICAgID0+ICdzaXh0eScsCiAgICAgICAgNzAgICAgICAgICAgICAgICAgICA9PiAnc2V2ZW50eScsCiAgICAgICAgODAgICAgICAgICAgICAgICAgICA9PiAnZWlnaHR5JywKICAgICAgICA5MCAgICAgICAgICAgICAgICAgID0+ICduaW5ldHknLAogICAgICAgIDEwMCAgICAgICAgICAgICAgICAgPT4gJ2h1bmRyZWQnLAogICAgICAgIDEwMDAgICAgICAgICAgICAgICAgPT4gJ3Rob3VzYW5kJywKICAgICAgICAxMDAwMDAwICAgICAgICAgICAgID0+ICdtaWxsaW9uJywKICAgICAgICAxMDAwMDAwMDAwICAgICAgICAgID0+ICdiaWxsaW9uJywKICAgICAgICAxMDAwMDAwMDAwMDAwICAgICAgID0+ICd0cmlsbGlvbicsCiAgICAgICAgMTAwMDAwMDAwMDAwMDAwMCAgICA9PiAncXVhZHJpbGxpb24nLAogICAgICAgIDEwMDAwMDAwMDAwMDAwMDAwMDAgPT4gJ3F1aW50aWxsaW9uJwogICAgKTsKCiAgICBpZiAoIWlzX251bWVyaWMoJG51bWJlcikpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgaWYgKCgkbnVtYmVyID49IDAgJiYgKGludCkgJG51bWJlciA8IDApIHx8IChpbnQpICRudW1iZXIgPCAwIC0gUEhQX0lOVF9NQVgpIHsKICAgICAgICAvLyBvdmVyZmxvdwogICAgICAgIHRyaWdnZXJfZXJyb3IoCiAgICAgICAgICAgICdTeXN0ZW0gb25seSBhY2NlcHRzIG51bWJlcnMgYmV0d2VlbiAtJyAuIFBIUF9JTlRfTUFYIC4gJyBhbmQgJyAuIFBIUF9JTlRfTUFYLAogICAgICAgICAgICBFX1VTRVJfV0FSTklORwogICAgICAgICk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGlmICgkbnVtYmVyIDwgMCkgewogICAgICAgIHJldHVybiAkbmVnYXRpdmUgLiBpbldvcmQoYWJzKCRudW1iZXIpKTsKICAgIH0KCiAgICAkc3RyaW5nID0gJGZyYWN0aW9uID0gbnVsbDsKCiAgICBpZiAoc3RycG9zKCRudW1iZXIsICcuJykgIT09IGZhbHNlKSB7CiAgICAgICAgbGlzdCgkbnVtYmVyLCAkZnJhY3Rpb24pID0gZXhwbG9kZSgnLicsICRudW1iZXIpOwogICAgfQoKICAgIHN3aXRjaCAodHJ1ZSkgewogICAgICAgIGNhc2UgJG51bWJlciA8IDIxOgogICAgICAgICAgICAkc3RyaW5nID0gJGRpY3Rpb25hcnlbJG51bWJlcl07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJG51bWJlciA8IDEwMDoKICAgICAgICAgICAgJHRlbnMgICA9ICgoaW50KSAoJG51bWJlciAvIDEwKSkgKiAxMDsKICAgICAgICAgICAgJHVuaXRzICA9ICRudW1iZXIgJSAxMDsKICAgICAgICAgICAgJHN0cmluZyA9ICRkaWN0aW9uYXJ5WyR0ZW5zXTsKICAgICAgICAgICAgaWYgKCR1bml0cykgewogICAgICAgICAgICAgICAgJHN0cmluZyAuPSAkaHlwaGVuIC4gJGRpY3Rpb25hcnlbJHVuaXRzXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICRudW1iZXIgPCAxMDAwOgogICAgICAgICAgICAkaHVuZHJlZHMgID0gJG51bWJlciAvIDEwMDsKICAgICAgICAgICAgJHJlbWFpbmRlciA9ICRudW1iZXIgJSAxMDA7CiAgICAgICAgICAgICRzdHJpbmcgPSAkZGljdGlvbmFyeVskaHVuZHJlZHNdIC4gJyAnIC4gJGRpY3Rpb25hcnlbMTAwXTsKICAgICAgICAgICAgaWYgKCRyZW1haW5kZXIpIHsKICAgICAgICAgICAgICAgICRzdHJpbmcgLj0gJGNvbmp1bmN0aW9uIC4gaW5Xb3JkKCRyZW1haW5kZXIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICRiYXNlVW5pdCA9IHBvdygxMDAwLCBmbG9vcihsb2coJG51bWJlciwgMTAwMCkpKTsKICAgICAgICAgICAgJG51bUJhc2VVbml0cyA9IChpbnQpICgkbnVtYmVyIC8gJGJhc2VVbml0KTsKICAgICAgICAgICAgJHJlbWFpbmRlciA9ICRudW1iZXIgJSAkYmFzZVVuaXQ7CiAgICAgICAgICAgICRzdHJpbmcgPSBpbldvcmQoJG51bUJhc2VVbml0cykgLiAnICcgLiAkZGljdGlvbmFyeVskYmFzZVVuaXRdOwogICAgICAgICAgICBpZiAoJHJlbWFpbmRlcikgewogICAgICAgICAgICAgICAgJHN0cmluZyAuPSAkcmVtYWluZGVyIDwgMTAwID8gJGNvbmp1bmN0aW9uIDogJHNlcGFyYXRvcjsKICAgICAgICAgICAgICAgICRzdHJpbmcgLj0gaW5Xb3JkKCRyZW1haW5kZXIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgfQoKICAgIGlmIChudWxsICE9PSAkZnJhY3Rpb24gJiYgaXNfbnVtZXJpYygkZnJhY3Rpb24pKSB7CiAgICAgICAgJHN0cmluZyAuPSAkZGVjaW1hbDsKICAgICAgICAkd29yZHMgPSBhcnJheSgpOwogICAgICAgIGZvcmVhY2ggKHN0cl9zcGxpdCgoc3RyaW5nKSAkZnJhY3Rpb24pIGFzICRudW1iZXIpIHsKICAgICAgICAgICAgJHdvcmRzW10gPSAkZGljdGlvbmFyeVskbnVtYmVyXTsKICAgICAgICB9CiAgICAgICAgJHN0cmluZyAuPSBpbXBsb2RlKCcgJywgJHdvcmRzKTsKICAgIH0KCiAgICByZXR1cm4gdWNmaXJzdCgkc3RyaW5nKTsKfQoKZnVuY3Rpb24gaW5Xb3JkQm4oJG51bWJlciwgJHRha2EgPSB0cnVlLCAkY3VycmVuY3kgPSAndGFrYScsICRjdXJyZW5jeV9odW5kcmVkcyA9ICdwYWlzYScpIAp7IAogICAgaWYgKCgkbnVtYmVyIDwgMCkgfHwgKCRudW1iZXIgPiA5OTk5OTk5OTk5OTkpKSB7IAogICAgCXJldHVybiAnJzsKICAgIH0KCiAgICAkZnJhY3Rpb24gPSBudWxsOwogICAgaWYgKHN0cnBvcygkbnVtYmVyLCAnLicpICE9PSBmYWxzZSkgewogICAgICAgIGxpc3QoJG51bWJlciwgJGZyYWN0aW9uKSA9IGV4cGxvZGUoJy4nLCAkbnVtYmVyKTsKICAgIH0KCiAgICAkYmwgPSBmbG9vcigkbnVtYmVyIC8gMTAwMDAwMDAwMCk7IC8qIGJpbGxpb24gKi8KICAgICRudW1iZXIgLT0gJGJsICogMTAwMDAwMDA7CiAgICAkS3QgPSBmbG9vcigkbnVtYmVyIC8gMTAwMDAwMDApOyAvKiBLb3RpICovCiAgICAkbnVtYmVyIC09ICRLdCAqIDEwMDAwMDAwOwogICAgJEduID0gZmxvb3IoJG51bWJlciAvIDEwMDAwMCk7ICAvKiBsYWtoICAqLyAKICAgICRudW1iZXIgLT0gJEduICogMTAwMDAwOyAKICAgICRrbiA9IGZsb29yKCRudW1iZXIgLyAxMDAwKTsgICAgIC8qIFRob3VzYW5kcyAoa2lsbykgKi8gCiAgICAkbnVtYmVyIC09ICRrbiAqIDEwMDA7IAogICAgJEhuID0gZmxvb3IoJG51bWJlciAvIDEwMCk7ICAgICAgLyogSHVuZHJlZHMgKGhlY3RvKSAqLyAKICAgICRudW1iZXIgLT0gJEhuICogMTAwOyAKICAgICREbiA9IGZsb29yKCRudW1iZXIgLyAxMCk7ICAgICAgIC8qIFRlbnMgKGRlY2EpICovIAogICAgJG4gPSAkbnVtYmVyICUgMTA7ICAgICAgICAgICAgICAgLyogT25lcyAqLwoKICAgICRyZXMgPSAiIjsgCgogICAgaWYgKCRibCkgeyAKICAgICAgICAkcmVzIC49IGluV29yZEJuKCRibCwgZmFsc2UsICRjdXJyZW5jeSwgJGN1cnJlbmN5X2h1bmRyZWRzKSAuICIgYmlsbGlvbiAiOyAKICAgIH0gCgogICAgaWYgKCRLdCkgeyAKICAgICAgICAkcmVzIC49IGluV29yZEJuKCRLdCwgZmFsc2UsICRjdXJyZW5jeSwgJGN1cnJlbmN5X2h1bmRyZWRzKSAuICIgY29yZSAiOyAKICAgIH0gCgogICAgaWYgKCRHbikgeyAKICAgICAgICAkcmVzIC49IGluV29yZEJuKCRHbiwgZmFsc2UsICRjdXJyZW5jeSwgJGN1cnJlbmN5X2h1bmRyZWRzKSAuICIgbGFjIjsgCiAgICB9IAoKICAgIGlmICgka24pIHsgCiAgICAgICAgJHJlcyAuPSAoZW1wdHkoJHJlcykgPyAiIiA6ICIgIikgLiAKICAgICAgICAgICAgaW5Xb3JkQm4oJGtuLCBmYWxzZSwgJGN1cnJlbmN5LCAkY3VycmVuY3lfaHVuZHJlZHMpIC4gIiBUaG91c2FuZCI7IAogICAgfSAKCiAgICBpZiAoJEhuKSB7IAogICAgICAgICRyZXMgLj0gKGVtcHR5KCRyZXMpID8gIiIgOiAiICIpIC4gCiAgICAgICAgICAgIGluV29yZEJuKCRIbiwgZmFsc2UsICRjdXJyZW5jeSwgJGN1cnJlbmN5X2h1bmRyZWRzKSAuICIgSHVuZHJlZCI7IAogICAgfSAKCiAgICAkb25lcyA9IGFycmF5KCIiLCAiT25lIiwgIlR3byIsICJUaHJlZSIsICJGb3VyIiwgIkZpdmUiLCAiU2l4IiwgCiAgICAgICAgIlNldmVuIiwgIkVpZ2h0IiwgIk5pbmUiLCAiVGVuIiwgIkVsZXZlbiIsICJUd2VsdmUiLCAiVGhpcnRlZW4iLCAKICAgICAgICAiRm91cnRlZW4iLCAiRmlmdGVlbiIsICJTaXh0ZWVuIiwgIlNldmVudGVlbiIsICJFaWdodHRlZW4iLCAKICAgICAgICAiTmluZXRlZW4iKTsgCiAgICAkdGVucyA9IGFycmF5KCIiLCAiIiwgIlR3ZW50eSIsICJUaGlydHkiLCAiRm91cnR5IiwgIkZpZnR5IiwgIlNpeHR5IiwgCiAgICAgICAgIlNldmVudHkiLCAiRWlndGh5IiwgIk5pbmV0eSIpOyAKCiAgICBpZiAoJERuIHx8ICRuKSB7IAogICAgICAgIGlmICghZW1wdHkoJHJlcykpIHsgCiAgICAgICAgICAgICRyZXMgLj0gIiAiOyAKICAgICAgICB9IAoKICAgICAgICBpZiAoJERuIDwgMikgeyAKICAgICAgICAgICAgJHJlcyAuPSAkb25lc1skRG4gKiAxMCArICRuXTsgCiAgICAgICAgfSBlbHNlIHsgCiAgICAgICAgICAgICRyZXMgLj0gJHRlbnNbJERuXTsgCiAgICAgICAgICAgIGlmICgkbikgeyAKICAgICAgICAgICAgICAgICRyZXMgLj0gIi0iIC4gJG9uZXNbJG5dOyAKICAgICAgICAgICAgfSAKICAgICAgICB9IAogICAgfSAKCiAgICBpZiAoZW1wdHkoJHJlcykpeyAKICAgICAgICAkcmVzID0gInplcm8iOyAKICAgIH0gCgogICAgaWYoJHRha2EpewogICAgCSRyZXMgLj0gJyAnLiRjdXJyZW5jeS4nICc7CiAgICB9CgogICAgaWYgKG51bGwgIT09ICRmcmFjdGlvbiAmJiBpc19udW1lcmljKCRmcmFjdGlvbikgJiYgJGZyYWN0aW9uID4gMCkgewogICAgCSRyZXMgLj0gJyBhbmQgJzsKICAgIAkkZnJhY3Rpb24gPSBzdWJzdHIoJGZyYWN0aW9uLCAwLCAyKTsKICAgIAkkZnJhY3Rpb24gPSBzdHJsZW4oJGZyYWN0aW9uKSA9PSAxID8gKGludCkoJGZyYWN0aW9uKSoxMCA6IChpbnQpKCRmcmFjdGlvbik7CiAgICAJaWYoJGZyYWN0aW9uID4gMCl7CiAgICAgICAgCSRyZXMgLj0gaW5Xb3JkQm4oJGZyYWN0aW9uLCBmYWxzZSwgJGN1cnJlbmN5LCAkY3VycmVuY3lfaHVuZHJlZHMpLicgJy4kY3VycmVuY3lfaHVuZHJlZHM7CiAgICAJfQogICAgfQoKICAgIHJldHVybiB1Y3dvcmRzKHN0cl9yZXBsYWNlKCctJywgJyAnLCAkcmVzKSk7IAp9CgpmdW5jdGlvbiB2aWV3TVBERigkdmlldywgJGRhdGEsICR0aXRsZSwgJGZpbGVuYW1lLCAkZm9ybWF0ID0gJ2E0JywgJG9yaWVudGF0aW9uID0gJ1AnKXsKCVxQREY6OmxvYWRWaWV3KCR2aWV3LCAkZGF0YSwgW10sIFsKICAgICAgJ3RpdGxlJyAgICAgID0+ICR0aXRsZSwKICAgICAgJ21hcmdpbl90b3AnID0+IDAsCiAgICAgICdzaG93SW1hZ2VFcnJvcnMnID0+IHRydWUsCiAgICAgICdmb3JtYXQnID0+ICRmb3JtYXQsCiAgICAgICdvcmllbnRhdGlvbicgPT4gJG9yaWVudGF0aW9uLAogICAgICAvLydzaG93X3dhdGVybWFya19pbWFnZScgPT4gdHJ1ZSwKICAgICAgLy8nZGlzcGxheV9tb2RlJyA9PiAnZnVsbHBhZ2UnLAogICAgICAvLyd3YXRlcm1hcmtfaW1hZ2VfcGF0aCcgPT4gcHVibGljX3BhdGgoJy9hc3NldHMvaWRjYXJkL2xldHRlcmhlYWQvbWJtX2xldHRlcmhlYWQucG5nJyksCiAgICAgIC8vJ3dhdGVybWFya19pbWFnZV9zaXplJyAgICAgICA9PiAnRCcsCiAgICBdKS0+c3RyZWFtKCRmaWxlbmFtZS4nLnBkZicpOwp9CgpmdW5jdGlvbiBvdXRwdXRNUERGKCR2aWV3LCAkZGF0YSwgJHRpdGxlLCAkZmlsZW5hbWUsICRmb3JtYXQgPSAnYTQnLCAkb3JpZW50YXRpb24gPSAnUCcpewoJcmV0dXJuIFxQREY6OmxvYWRWaWV3KCR2aWV3LCAkZGF0YSwgW10sIFsKICAgICAgJ3RpdGxlJyAgICAgID0+ICR0aXRsZSwKICAgICAgJ21hcmdpbl90b3AnID0+IDAsCiAgICAgICdzaG93SW1hZ2VFcnJvcnMnID0+IHRydWUsCiAgICAgICdmb3JtYXQnID0+ICRmb3JtYXQsCiAgICBdKS0+b3V0cHV0KCk7Cn0KCmZ1bmN0aW9uIGRvd25sb2FkTVBERigkdmlldywgJGRhdGEsICR0aXRsZSwgJGZpbGVuYW1lLCAkZm9ybWF0ID0gJ2E0JywgJG9yaWVudGF0aW9uID0gJ1AnKXsKCVxQREY6OmxvYWRWaWV3KCR2aWV3LCAkZGF0YSwgW10sIFsKICAgICAgJ3RpdGxlJyAgICAgID0+ICR0aXRsZSwKICAgICAgJ21hcmdpbl90b3AnID0+IDAsCiAgICAgICdzaG93SW1hZ2VFcnJvcnMnID0+IHRydWUsCiAgICAgICdvcmllbnRhdGlvbicgPT4gJG9yaWVudGF0aW9uCiAgICBdKS0+ZG93bmxvYWQoJGZpbGVuYW1lLidfJy5kYXRlKCdZLW0tZCBnOmkgYScpLicucGRmJyk7Cn0KCmZ1bmN0aW9uIHByaW50QmFyY29kZSgkYmFyY29kZSwgJHN0eWxlPScnLCAkbGV0dGVyX3NwYWNpbmc9JzEycHgnKXsKCXJldHVybiAnPGRpdiBjbGFzcz0idGV4dC1jZW50ZXIiIHN0eWxlPSInLiRzdHlsZS4nIj4KCQk8aW1nIHNyYz0iZGF0YTppbWFnZS9wbmc7YmFzZTY0LCcuRE5TMUQ6OmdldEJhcmNvZGVQTkcoJGJhcmNvZGUsICdDMzknLDEsMzMpLiciIGFsdD0iJy4kYmFyY29kZS4nIi8+CgkJPGJyPgoJCTxzcGFuIHN0eWxlPSJsZXR0ZXItc3BhY2luZzogJy4kbGV0dGVyX3NwYWNpbmcuJzsiPicuJGJhcmNvZGUuJzwvc3Bhbj4KCTwvZGl2Pic7Cn0KCmZ1bmN0aW9uIHdvcmRSZXN0cmljdGlvbnMoKXsKCSR3b3JkcyA9IFtdOwoJJHJvbGVzID0gXFNwYXRpZVxQZXJtaXNzaW9uXE1vZGVsc1xSb2xlOjp3aGVyZUluKCduYW1lJywgYXV0aCgpLT51c2VyKCktPmdldFJvbGVOYW1lcygpKS0+Z2V0KCk7CglpZihpc3NldCgkcm9sZXNbMF0pKXsKCQlmb3JlYWNoKCRyb2xlcyBhcyAka2V5ID0+ICRyb2xlKXsKCQkJJHJlc3RyaWN0aW9ucyA9IGFycmF5X21hcChmdW5jdGlvbigkdmFsdWUpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0cnRvbG93ZXIoJHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSwgaXNzZXQoanNvbl9kZWNvZGUoJHJvbGUtPndvcmRfcmVzdHJpY3Rpb25zLCB0cnVlKVswXSkgPyBqc29uX2RlY29kZSgkcm9sZS0+d29yZF9yZXN0cmljdGlvbnMsIHRydWUpIDogW10pOwoJCQlpZihpc3NldCgkcmVzdHJpY3Rpb25zWzBdKSl7CgkJCQlmb3JlYWNoKCRyZXN0cmljdGlvbnMgYXMgJGtleSA9PiAkcmVzdHJpY3Rpb24pewoJCQkJCWFycmF5X3B1c2goJHdvcmRzLCAkcmVzdHJpY3Rpb24pOwoJCQkJfQoJCQl9CgkJfQoJfQoKCXJldHVybiBhcnJheV91bmlxdWUoJHdvcmRzKTsKfQoKCgpmdW5jdGlvbiBpc1N1cHBsaWVyUmF0aW5nKCRrZXksJHZhbHVlLCAkdHlwZSkKewoJJHN1cHBsaWVyUmF0aW5ncz1TdXBwbGllclJhdGluZ3M6OndoZXJlKCdrZXknLCAka2V5KS0+d2hlcmUoJ3ZhbHVlJywkdmFsdWUpLT53aGVyZSgndHlwZScsJHR5cGUpLT5maXJzdCgpOwoJaWYoaXNzZXQoJHN1cHBsaWVyUmF0aW5ncy0+aWQpKXsKCQlyZXR1cm4gdHJ1ZTsKCX0KCXJldHVybiBmYWxzZTsKfQoKZnVuY3Rpb24gcmVxdWlzaXRpb25IYXNTdG9jaygkcmVxdWlzaXRpb25faWQpewoJJHJlcXVpc2l0aW9uID0gXEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uOjpmaW5kKCRyZXF1aXNpdGlvbl9pZCk7CglpZighaXNzZXQoJHJlcXVpc2l0aW9uLT5pZCkpewoJCXJldHVybiBmYWxzZTsKCX0KCQoJaWYoJHJlcXVpc2l0aW9uLT5pc19zZW5kX3RvX3JmcCA9PSAneWVzJyl7CgkJJHN0b2NrcyA9IFxBcHBcTW9kZWxzXFBtc01vZGVsc1xHcm5cR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luOjp3aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlci5wdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHJlcXVpc2l0aW9uKXsKCQkJcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3JlcXVpc2l0aW9uX2lkJywgJHJlcXVpc2l0aW9uLT5pZCk7CgkJfSkKCQktPnN1bSgncmVjZWl2ZWRfcXR5Jyk7CgkJaWYoJHN0b2NrcyA8PSAwKXsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCX0KCglyZXR1cm4gdHJ1ZTsKfQoKZnVuY3Rpb24gbGF0ZXN0UHJvZHVjdFByaWNlVXBkYXRlKCRwcm9kdWN0SWQsJHVuaXRQcmljZSl7CgkkcHJvZHVjdD1Qcm9kdWN0OjpmaW5kT3JGYWlsKCRwcm9kdWN0SWQpOwoJaWYgKGlzc2V0KCRwcm9kdWN0LT5pZCkpIHsKCQkkcHJvZHVjdC0+dXBkYXRlKFsndW5pdF9wcmljZSc9PiR1bml0UHJpY2VdKTsKCQlyZXR1cm4gdHJ1ZTsKCX0KCXJldHVybiBmYWxzZTsKfQoKZnVuY3Rpb24gaW5jbHVkZVVzZXJzKCl7CgkkdXNlclVuaXRzID0gYXV0aCgpLT51c2VyKCktPnByaW9yaXRpZXMtPnBsdWNrKCdocl91bml0X2lkJyktPnRvQXJyYXkoKTsKCSR1c2VyRGVwYXJ0bWVudHMgPSBhdXRoKCktPnVzZXIoKS0+cHJpb3JpdGllcy0+cGx1Y2soJ2hyX2RlcGFydG1lbnRfaWQnKS0+dG9BcnJheSgpOwoJJHVzZXJTZWN0aW9ucyA9IGF1dGgoKS0+dXNlcigpLT5wcmlvcml0aWVzLT5wbHVjaygnaHJfc2VjdGlvbl9pZCcpLT50b0FycmF5KCk7CgoJaWYoYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0RlcGFydG1lbnQtSGVhZCcpKXsKCQlyZXR1cm4gXEFwcFxVc2VyOjp3aGVyZU5vdEluKCdpZCcsIFthdXRoKCktPnVzZXIoKS0+aWRdKQoJCS0+d2hlcmVIYXMoJ2VtcGxveWVlJyxmdW5jdGlvbigkcXVlcnkpIHVzZSgkdXNlclVuaXRzLCAkdXNlckRlcGFydG1lbnRzLCAkdXNlclNlY3Rpb25zKXsKCQkJcmV0dXJuICRxdWVyeS0+d2hlcmVJbignYXNfdW5pdF9pZCcsICR1c2VyVW5pdHMpCgkJCS0+d2hlcmVJbignYXNfZGVwYXJ0bWVudF9pZCcsICR1c2VyRGVwYXJ0bWVudHMpOwoJCQkvLyAtPndoZXJlSW4oJ2FzX3NlY3Rpb25faWQnLCAkdXNlclNlY3Rpb25zKTsKICAgICAgICB9KQoJCS0+d2hlcmVEb2VzbnRIYXZlKCdtb2RlbEhhc1JvbGVzLnJvbGUnLCBmdW5jdGlvbigkcXVlcnkpewoJCQlyZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCduYW1lJywgWydEZXBhcnRtZW50LUhlYWQnLCAnU0JVIEhlYWQnLCAnTWFuYWdlbWVudCddKTsKCQl9KQogICAgICAgIC0+cGx1Y2soJ2lkJyktPnRvQXJyYXkoKTsKCX1lbHNlaWYoYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ1NCVSBIZWFkJykpewoJCXJldHVybiBcQXBwXFVzZXI6OndoZXJlTm90SW4oJ2lkJywgW2F1dGgoKS0+dXNlcigpLT5pZF0pCgkJLT53aGVyZUhhcygnZW1wbG95ZWUnLGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCR1c2VyVW5pdHMpewoJCQlyZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdhc191bml0X2lkJywgJHVzZXJVbml0cyk7CiAgICAgICAgfSkKICAgICAgICAtPndoZXJlSGFzKCdtb2RlbEhhc1JvbGVzLnJvbGUnLCBmdW5jdGlvbigkcXVlcnkpewoJCQlyZXR1cm4gJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdEZXBhcnRtZW50LUhlYWQnKTsKCQl9KQoJCS0+cGx1Y2soJ2lkJyktPnRvQXJyYXkoKTsKCX1lbHNlewoJCXJldHVybiBcQXBwXFVzZXI6OndoZXJlTm90SW4oJ2lkJywgW2F1dGgoKS0+dXNlcigpLT5pZF0pCgkJLT53aGVyZUhhcygnbW9kZWxIYXNSb2xlcy5yb2xlJywgZnVuY3Rpb24oJHF1ZXJ5KXsKCQkJcmV0dXJuICRxdWVyeS0+d2hlcmVJbignbmFtZScsIFsnU0JVIEhlYWQnLCAnTWFuYWdlbWVudCddKTsKCQl9KS0+cGx1Y2soJ2lkJyktPnRvQXJyYXkoKTsKCX0KCglyZXR1cm4gW107Cn0KCmZ1bmN0aW9uIGdldER1cmF0aW9uKCRmcm9tLCAkdG8pewogICAgJGRheXMgPSByb3VuZCgoKHN0cnRvdGltZSgkdG8pIC0gc3RydG90aW1lKCRmcm9tKSkpIC8gKDYwICogNjAgKiAyNCkpOwogICAgcmV0dXJuICgkZGF5cyA+PSAxID8gKCRmcm9tID09ICR0byA/IDEgOiAkZGF5cysxKSA6IDEpOwp9CgpmdW5jdGlvbiBnZXRQcm9ncmVzc0Zhc3RlcigkdGFza3MsICRuZWVkbGVzID0gWzAsIDAsIDAsIDBdKXsKCSR0YXNrcyA9IGNvbGxlY3QoJHRhc2tzKTsKCglpZigkbmVlZGxlc1swXSA+IDApewoJCSR0YXNrcyA9ICR0YXNrcy0+ZmlsdGVyKGZ1bmN0aW9uICgkdGFzaywgJGtleSkgdXNlKCRuZWVkbGVzKSB7CgkJICAgIHJldHVybiAkdGFzay0+c3ViRGVsaXZlcmFibGUtPmRlbGl2ZXJhYmxlLT5wcm9qZWN0X2lkID09ICRuZWVkbGVzWzBdOwoJCX0pOwoJCSAKCQkkdGFza3MtPmFsbCgpOwoJfQoKCWlmKCRuZWVkbGVzWzFdID4gMCl7CgkJJHRhc2tzID0gJHRhc2tzLT5maWx0ZXIoZnVuY3Rpb24gKCR0YXNrLCAka2V5KSB1c2UoJG5lZWRsZXMpIHsKCQkgICAgcmV0dXJuICR0YXNrLT5zdWJEZWxpdmVyYWJsZS0+ZGVsaXZlcmFibGVfaWQgPT0gJG5lZWRsZXNbMV07CgkJfSk7CgkJIAoJCSR0YXNrcy0+YWxsKCk7Cgl9CgoJaWYoJG5lZWRsZXNbMl0gPiAwKXsKCQkkdGFza3MgPSAkdGFza3MtPmZpbHRlcihmdW5jdGlvbiAoJHRhc2ssICRrZXkpIHVzZSgkbmVlZGxlcykgewoJCSAgICByZXR1cm4gJHRhc2stPnN1Yl9kZWxpdmVyYWJsZV9pZCA9PSAkbmVlZGxlc1syXTsKCQl9KTsKCQkgCgkJJHRhc2tzLT5hbGwoKTsKCX0KCglpZigkbmVlZGxlc1szXSA+IDApewoJCSR0YXNrcyA9ICR0YXNrcy0+ZmlsdGVyKGZ1bmN0aW9uICgkdGFzaywgJGtleSkgdXNlKCRuZWVkbGVzKSB7CgkJICAgIHJldHVybiAkdGFzay0+aWQgPT0gJG5lZWRsZXNbM107CgkJfSk7CgkJIAoJCSR0YXNrcy0+YWxsKCk7Cgl9CgkKICAgICR0b3RhbFRhc2tzID0gJHRhc2tzLT5jb3VudCgpOwogICAgJGNvbXBsZXRlZFRhc2tzID0gJHRhc2tzLT53aGVyZSgnc3RhdHVzJywgJ2RvbmUnKS0+Y291bnQoKTsKCiAgICByZXR1cm4gJHRvdGFsVGFza3MgPiAwICYmICRjb21wbGV0ZWRUYXNrcyA+IDAgPyAoJGNvbXBsZXRlZFRhc2tzLyR0b3RhbFRhc2tzKSA6IDA7Cn0KCmZ1bmN0aW9uIGxpc3RPZk1vbnRoc0JldHdlZW5EYXRlcygkZnJvbSwgJHRvKXsKCSRzdGFydCAgICA9IChuZXcgXERhdGVUaW1lKCRmcm9tKSktPm1vZGlmeSgnZmlyc3QgZGF5IG9mIHRoaXMgbW9udGgnKTsKCSRlbmQgICAgICA9IChuZXcgXERhdGVUaW1lKCR0bykpLT5tb2RpZnkoJ2ZpcnN0IGRheSBvZiBuZXh0IG1vbnRoJyk7CgkkaW50ZXJ2YWwgPSBcRGF0ZUludGVydmFsOjpjcmVhdGVGcm9tRGF0ZVN0cmluZygnMSBtb250aCcpOwoJJHBlcmlvZCAgID0gbmV3IFxEYXRlUGVyaW9kKCRzdGFydCwgJGludGVydmFsLCAkZW5kKTsKCgkkZGF0ZXMgPSBbXTsKCWZvcmVhY2ggKCRwZXJpb2QgYXMgJGR0KSB7CgkJYXJyYXlfcHVzaCgkZGF0ZXMsICRkdC0+Zm9ybWF0KCJZLW0tZCIpKTsKCX0KCglyZXR1cm4gJGRhdGVzOwp9CgoKZnVuY3Rpb24gcHJvamVjdFN0YXR1c0xpc3QoJHN0YXR1cyA9IGZhbHNlKXsKCSRhcnJheSA9IFsKCQknd2FpdGluZ19mb3Jfc3VibWl0JyA9PiBbCgkJCSduYW1lJyA9PiAnRHJhZnQnLAoJCQknYmFja2dyb3VuZCcgPT4gJ3JnYig4NSw4NSw4NSwwLjQpJywKCQkJJ3Nob3cnID0+IGF1dGgoKS0+dXNlcigpLT5oYXNBbnlSb2xlKFsnU3VwZXIgQWRtaW4nLCAnTWFuYWdlbWVudCcsICdQTU8nXSksCgkJXSwKCQknYXBwcm92ZWQnID0+IFsKCQkJJ25hbWUnID0+ICdPbmdvaW5nJywKCQkJJ2JhY2tncm91bmQnID0+ICdyZ2IoMzUsMTA4LDk4LDAuNCknLAoJCQknc2hvdycgPT4gYXV0aCgpLT51c2VyKCktPmhhc0FueVJvbGUoWydTdXBlciBBZG1pbicsICdNYW5hZ2VtZW50JywgJ1BNTycsJ1Nwb25zb3InLCdQTScsJ1ByaW1hcnktVXNlcicsJ1Byb2plY3QtQm9hcmQnXSksCgkJXSwKCQkncGVuZGluZycgPT4gWwoJCQknbmFtZScgPT4gJ1dhaXRpbmcgRm9yIEFwcHJvdmFsJywKCQkJJ2JhY2tncm91bmQnID0+ICdyZ2IoMjU1LDIyMCwwLDAuNCknLAoJCQknc2hvdycgPT4gYXV0aCgpLT51c2VyKCktPmhhc0FueVJvbGUoWydTdXBlciBBZG1pbicsICdNYW5hZ2VtZW50JywgJ1BNTycsJ1Nwb25zb3InLCdQcm9qZWN0LUJvYXJkJ10pLAoJCV0sCgkJJ3JlYXBwcm92YWwnID0+IFsKCQkJJ25hbWUnID0+ICdXYWl0aW5nIEZvciBSZWFwcHJvdmFsJywKCQkJJ2JhY2tncm91bmQnID0+ICdyZ2IoMjM5LDExNyw3MCwwLjQpJywKCQkJJ3Nob3cnID0+IGF1dGgoKS0+dXNlcigpLT5oYXNBbnlSb2xlKFsnU3VwZXIgQWRtaW4nLCAnTWFuYWdlbWVudCcsICJQTU8iLCdTcG9uc29yJywnUHJvamVjdC1Cb2FyZCddKSwKCQldLAoJCQoJCSdwbGFubmVkJyA9PiBbCgkJCSduYW1lJyA9PiAnUGxhbm5lZCcsCgkJCSdiYWNrZ3JvdW5kJyA9PiAncmdiKDk1LDE3MywyMzIsMC40KScsCgkJCSdzaG93JyA9PiBhdXRoKCktPnVzZXIoKS0+aGFzQW55Um9sZShbJ1N1cGVyIEFkbWluJywgJ01hbmFnZW1lbnQnLCAiUE1PIiwnU3BvbnNvcicsJ1Byb2plY3QtQm9hcmQnXSksCgkJXQoJXTsKCglpZigkc3RhdHVzKXsKCQlpZihhcnJheV9rZXlfZXhpc3RzKCRzdGF0dXMsICRhcnJheSkpewoJCQlyZXR1cm4gJGFycmF5WyRzdGF0dXNdOwoJCX0KCX0KCglyZXR1cm4gJGFycmF5Owp9CgpmdW5jdGlvbiByYW5kb21Db2xvcigpIHsKICAgJGNoYXJzID0gJ0FCQ0RFRjAxMjM0NTY3ODknOwogICAkY29sb3IgPSAnIyc7CiAgIGZvciAoICRpID0gMDsgJGkgPCA2OyAkaSsrICkgewogICAgICAkY29sb3IgLj0gJGNoYXJzW3JhbmQoMCwgc3RybGVuKCRjaGFycykgLSAxKV07CiAgIH0KICAgcmV0dXJuICRjb2xvcjsKfQoKZnVuY3Rpb24gZm9ybWF0Qnl0ZXMoJHNpemUsICRwcmVjaXNpb24gPSAyKXsKICAgICRiYXNlID0gbG9nKCRzaXplLCAxMDI0KTsKICAgICRzdWZmaXhlcyA9IGFycmF5KCcnLCAnS0InLCAnTUInLCAnR0InLCAnVEInKTsgICAKCiAgICByZXR1cm4gcm91bmQocG93KDEwMjQsICRiYXNlIC0gZmxvb3IoJGJhc2UpKSwgJHByZWNpc2lvbikgLicgJy4gJHN1ZmZpeGVzW2Zsb29yKCRiYXNlKV07Cn0KCmZ1bmN0aW9uIGdldFByb2plY3RUYXNrcygkcHJvamVjdF9pZCl7CglyZXR1cm4gXEFwcFxNb2RlbHNcTXlQcm9qZWN0XFByb2plY3RUYXNrOjp3aGVyZUhhcygnc3ViRGVsaXZlcmFibGUuZGVsaXZlcmFibGUnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcHJvamVjdF9pZCl7CgkJCXJldHVybiAkcXVlcnktPndoZXJlKCdwcm9qZWN0X2lkJywgJHByb2plY3RfaWQpOwoJCX0pCgktPndoZW4oKGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdQcmltYXJ5LVVzZXInKSB8fCBhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnRW1wbG95ZWUnKSksIGZ1bmN0aW9uKCRxdWVyeSl7CgkJcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3VzZXJfaWQnLCBhdXRoKCktPnVzZXIoKS0+aWQpOwoJfSktPnBsdWNrKCdpZCcpLT50b0FycmF5KCk7Cn0KCmZ1bmN0aW9uIGdldEhvbGlkYXlzKCRmdWxsID0gZmFsc2UsICRmcm9tID0gZmFsc2UsICR0byA9IGZhbHNlKXsKCWlmKCRmdWxsKXsKCQlyZXR1cm4gXEFwcFxNb2RlbHNcTXlQcm9qZWN0XEhvbGlkYXk6OnNlbGVjdChcREI6OnJhdygibmFtZSwgU1RSX1RPX0RBVEUoZnVsbF9kYXRlLCAnJVktJW0tJWQnKSBhcyBkYXRlLCBTVFJfVE9fREFURShmdWxsX2RhdGUsICclWS0lbS0lZCcpIGFzIGBmcm9tYCwgU1RSX1RPX0RBVEUoZnVsbF9kYXRlLCAnJVktJW0tJWQnKSBhcyBgdG9gIikpCgkJLT53aGVuKCRmcm9tLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkZnJvbSl7CgkJCXJldHVybiAkcXVlcnktPndoZXJlKFxEQjo6cmF3KCJTVFJfVE9fREFURShmdWxsX2RhdGUsICclWS0lbS0lZCcpIiksICc+PScsICRmcm9tKTsKCQl9KQoJCS0+d2hlbigkdG8sIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCR0byl7CgkJCXJldHVybiAkcXVlcnktPndoZXJlKFxEQjo6cmF3KCJTVFJfVE9fREFURShmdWxsX2RhdGUsICclWS0lbS0lZCcpIiksICc8PScsICR0byk7CgkJfSkKCQktPmdldCgpOwoJfQoKCXJldHVybiBcQXBwXE1vZGVsc1xNeVByb2plY3RcSG9saWRheTo6c2VsZWN0KFxEQjo6cmF3KCJTVFJfVE9fREFURShmdWxsX2RhdGUsICclWS0lbS0lZCcpIGFzIGRhdGUiKSktPmdyb3VwQnkoJ2RhdGUnKS0+cGx1Y2soJ2RhdGUnKS0+dG9BcnJheSgpOwp9CgpmdW5jdGlvbiBudW1iZXJPZmhvbGlkYXlzKCRmcm9tLCAkdG8pewoJcmV0dXJuIFxBcHBcTW9kZWxzXE15UHJvamVjdFxIb2xpZGF5Ojp3aGVyZShcREI6OnJhdygiU1RSX1RPX0RBVEUoZnVsbF9kYXRlLCAnJVktJW0tJWQnKSIpLCAnPj0nLCAkZnJvbSktPndoZXJlKFxEQjo6cmF3KCJTVFJfVE9fREFURShmdWxsX2RhdGUsICclWS0lbS0lZCcpIiksICc8PScsICR0byktPmdyb3VwQnkoJ2Z1bGxfZGF0ZScpLT5jb3VudCgpOwp9CgoKZnVuY3Rpb24gcHJvamVjdEhvbGlkYXlzKCRwcm9qZWN0LCAkZnJvbSA9IGZhbHNlLCAkdG8gPSBmYWxzZSl7CgkkaG9saWRheXMgPSBbXTsKCWlmKCRwcm9qZWN0LT5ob2xpZGF5cy0+Y291bnQoKSA+IDApewoJCWZvcmVhY2goJHByb2plY3QtPmhvbGlkYXlzIGFzICRrZXkgPT4gJGhvbGlkYXkpewoJCQkkaG9saWRheXMgPSBhcnJheV9tZXJnZSgkaG9saWRheXMsIGRhdGVSYW5nZSgkaG9saWRheS0+ZnJvbSwgJGhvbGlkYXktPnRvKSk7CgkJfQoJfQoKCSR3b3JraW5nRGF5cyA9ICRwcm9qZWN0LT53b3JraW5nRGF5cy0+cGx1Y2soJ2RheScpLT50b0FycmF5KCk7CgoJJGZyb20gPSAoJGZyb20gPyAkZnJvbSA6ICRwcm9qZWN0LT5zdGFydF9kYXRlKTsKCSR0byA9ICgkdG8gPyAkdG8gOiAkcHJvamVjdC0+ZW5kX2RhdGUpOwoKCSRkYXlzID0gW107CgkkZGF0ZVJhbmdlID0gZGF0ZVJhbmdlKCRmcm9tLCAkdG8pOwoJZm9yZWFjaCgkZGF0ZVJhbmdlIGFzICRrZXkgPT4gJGRhdGUpewoJCWlmKGluX2FycmF5KCRkYXRlLCAkaG9saWRheXMpIHx8ICFpbl9hcnJheShkYXRlKCdsJywgc3RydG90aW1lKCRkYXRlKSksICR3b3JraW5nRGF5cykpewoJCQlhcnJheV9wdXNoKCRkYXlzLCAkZGF0ZSk7CgkJfQoJfQoJCglyZXR1cm4gJGRheXM7Cn0KCmZ1bmN0aW9uIHBheW1lbnRUeXBlcygkYXAgPSBmYWxzZSl7CgkkdHlwZXMgPSBbCgkJJ2Nhc2gnID0+IFsKCQkJJ25hbWUnID0+ICJDYXNoIiwKCQkJJ3RpdGxlJyA9PiAiUGF5bWVudCBEZXRhaWxzIiwKCQkJJ3BsYWNlaG9sZGVyJyA9PiAiV3JpdGUgUGF5bWVudCBEZXRhaWxzIiwKCQldLAoJCSdjaGVxdWUnID0+IFsKCQkJJ25hbWUnID0+ICJDaGVxdWUiLAoJCQkndGl0bGUnID0+ICJDaGVxdWUgTnVtYmVyIiwKCQkJJ3BsYWNlaG9sZGVyJyA9PiAiTm8gQ2hlcXVlIEF2YWlsYWJsZSEiLAoJCV0sCgkJJ2Z1bmQtdHJhbnNmZXInID0+IFsKCQkJJ25hbWUnID0+ICJGdW5kIFRyYW5zZmVyIChSVEdTKSIsCgkJCSd0aXRsZScgPT4gIlJUR1MgTnVtYmVyIiwKCQkJJ3BsYWNlaG9sZGVyJyA9PiAiV3JpdGUgUlRHUyBSZWZlcmVuY2UgTnVtYmVyIiwKCQldLAoJCSdvdGhlcnMtZ2wnID0+IFsKCQkJJ25hbWUnID0+ICJPdGhlcnMgKENob29zZSBHTCkiLAoJCQkndGl0bGUnID0+ICJOYXJyYXRpb24iLAoJCQkncGxhY2Vob2xkZXInID0+ICJXcml0ZSBhIE5hcnJhdGlvbiIsCgkJXSwKCV07CgoJaWYoJGFwKXsKCQkkdHlwZXNbJ3N1cHBsaWVyLXBheWFibGUnXSA9IFsKCQkJJ25hbWUnID0+ICJTdXBwbGllciBQYXlhYmxlIiwKCQkJJ3RpdGxlJyA9PiAiSW52b2ljZSIsCgkJCSdwbGFjZWhvbGRlcicgPT4gIldyaXRlIEludm9pY2UgbnVtYmVyIiwKCQldOwoJfQoKCXJldHVybiAkdHlwZXM7Cn0KCmZ1bmN0aW9uIHBvQWR2YW5jZSgkcG9faWQpewoJJGdyb3NzX3ByaWNlID0gXEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXI6OndoZXJlKCdpZCcsICRwb19pZCktPnN1bSgnZ3Jvc3NfcHJpY2UnKTsKCSRhZHZhbmNlID0gXEFwcFxNb2RlbHNcUG1zTW9kZWxzXFN1cHBsaWVyUGF5bWVudDo6d2hlcmUoWwoJCSdiaWxsX3R5cGUnID0+ICdwby1hZHZhbmNlJywKCQkncHVyY2hhc2Vfb3JkZXJfaWQnID0+ICRwb19pZAoJXSktPnN1bSgncGF5X2Ftb3VudCcpOwoJJHBlcmNlbnRhZ2UgPSAwOwoJaWYoJGdyb3NzX3ByaWNlID4gMCAmJiAkYWR2YW5jZSA+IDApewoJCSRwZXJjZW50YWdlID0gKCgkYWR2YW5jZSoxMDApLyRncm9zc19wcmljZSk7Cgl9CgkKCXJldHVybiBbCgkJJ2dyb3NzX3ByaWNlJyA9PiAkZ3Jvc3NfcHJpY2UsCgkJJ3BlcmNlbnRhZ2UnID0+ICRwZXJjZW50YWdlLAoJCSdhZHZhbmNlJyA9PiAkYWR2YW5jZSwKCV07Cn0KCmZ1bmN0aW9uIHN1cHBsaWVyU3RhdHVzKCRzdXBwbGllcil7CglyZXR1cm4gWwoJCSdhcHByb3ZlZF90ZXh0JyA9PiB1Y3dvcmRzKHN0cl9yZXBsYWNlKCctJywgJyAnLCAkc3VwcGxpZXItPmFwcHJvdmVkX2J5KSksCgkJJ2FwcHJvdmVkX2NsYXNzJyA9PiBpbl9hcnJheSgkc3VwcGxpZXItPmFwcHJvdmVkX2J5LCBbJ3B1cmNoYXNlLWFwcHJvdmVkJywgJ21hbmFnZW1lbnQtYXBwcm92ZWQnXSkgPyAnc3VjY2VzcycgOiAoaW5fYXJyYXkoJHN1cHBsaWVyLT5hcHByb3ZlZF9ieSwgWydwdXJjaGFzZS1kZWNsaW5lZCcsICdtYW5hZ2VtZW50LWRlY2xpbmVkJ10pID8gJ2RhbmdlcicgOiAnd2FybmluZycpLAoJCSdhcHByb3ZlZF9pY29uJyA9PiAgaW5fYXJyYXkoJHN1cHBsaWVyLT5hcHByb3ZlZF9ieSwgWydwdXJjaGFzZS1hcHByb3ZlZCcsICdtYW5hZ2VtZW50LWFwcHJvdmVkJ10pID8gJ2xhciBsYS1jaGVjay1jaXJjbGUnIDogKGluX2FycmF5KCRzdXBwbGllci0+YXBwcm92ZWRfYnksIFsncHVyY2hhc2UtZGVjbGluZWQnLCAnbWFuYWdlbWVudC1kZWNsaW5lZCddKSA/ICdsYSBsYS1iYW4nIDogJ2xhcyBsYS1xdWVzdGlvbi1jaXJjbGUnKSwKCQknYXBwcm92YWwnID0+IChhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnUHVyY2hhc2UtRGVwYXJ0bWVudCcpICYmIGluX2FycmF5KCRzdXBwbGllci0+YXBwcm92ZWRfYnksIFsnc2VudC10by1wdXJjaGFzZScsICdwdXJjaGFzZS1kZWNsaW5lZCddKSA/IHRydWUgOiAoYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ01hbmFnZW1lbnQnKSAmJiBpbl9hcnJheSgkc3VwcGxpZXItPmFwcHJvdmVkX2J5LCBbJ3B1cmNoYXNlLWFwcHJvdmVkJywgJ21hbmFnZW1lbnQtZGVjbGluZWQnXSkgPyB0cnVlIDogZmFsc2UpKSwKCV07Cn0KCmZ1bmN0aW9uIGdldFVzZXJDb3N0Q2VudGVyKCR1c2VySWQpCnsKCSR1c2VyID0gVXNlcjo6d2l0aCgnZW1wbG95ZWUnKS0+ZmluZCgkdXNlcklkKTsKCgkkY29zdENlbnRlciA9IENvc3RDZW50cmU6OndoZXJlKCdocl91bml0X2lkJywkdXNlci0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpCgkJCQkJIC0+d2hlcmUoJ2hyX2RlcGFydG1lbnRfaWQnLCR1c2VyLT5lbXBsb3llZS0+YXNfZGVwYXJ0bWVudF9pZCktPmZpcnN0KCk7CgoJaWYgKCRjb3N0Q2VudGVyLT5pZCkgewoJCXJldHVybiAkY29zdENlbnRlcjsKCX0KCXJldHVybiBmYWxzZTsKfQoKZnVuY3Rpb24gZ2V0Q29zdENlbnRlclVzZXJzKCRjb3N0Q2VudGVySWQpCnsKCSRjb3N0Q2VudGVyID0gQ29zdENlbnRyZTo6ZmluZCgkY29zdENlbnRlcklkKTsKCglyZXR1cm4gVXNlcjo6d2hlcmVIYXMoJ2VtcGxveWVlJyxmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGNvc3RDZW50ZXIpCgl7CQoJCXJldHVybiAkcXVlcnktPndoZXJlKCdhc191bml0X2lkJywkY29zdENlbnRlci0+aHJfdW5pdF9pZCkKCQkJCQkgLT53aGVyZSgnYXNfZGVwYXJ0bWVudF9pZCcsJGNvc3RDZW50ZXItPmhyX2RlcGFydG1lbnRfaWQpOwoJfSktPmdldChbJ2lkJ10pOwp9CgpmdW5jdGlvbiBjaGVja1RvdGFsV2VpZ2h0YWdlKCRwb3J0Zm9saW9faWQsJHdlaWdodGFnZSwkaWQ9JycpCnsJCglpZiAoJGlkICE9bnVsbCkgewoJCSRjdXJyZW50X3dlaWdodGFnZSA9IFByb2dyYW06OndoZXJlTm90SW4oJ2lkJyxbJGlkXSktPndoZXJlKCdwb3J0Zm9saW9faWQnLCRwb3J0Zm9saW9faWQpLT5zdW0oJ3dlaWdodGFnZScpOwoJfWVsc2V7CgkJJGN1cnJlbnRfd2VpZ2h0YWdlID0gUHJvZ3JhbTo6d2hlcmUoJ3BvcnRmb2xpb19pZCcsJHBvcnRmb2xpb19pZCktPnN1bSgnd2VpZ2h0YWdlJyk7Cgl9CgoJJHRvdGFsX3dlaWdodGFnZSA9ICRjdXJyZW50X3dlaWdodGFnZSskd2VpZ2h0YWdlOwoJCglpZiAoJHRvdGFsX3dlaWdodGFnZSA+IDEwMCkgewoJCXJldHVybiB0cnVlOwoJfQoJcmV0dXJuIGZhbHNlOwp9CgpmdW5jdGlvbiBnZXRFbnVtT3B0aW9ucygkdGFibGVfbmFtZSwgJGNvbHVtbl9uYW1lKSB7CiAgICAkdHlwZSA9IERCOjpzZWxlY3QoREI6OnJhdygnU0hPVyBDT0xVTU5TIEZST00gJy4kdGFibGVfbmFtZS4nIFdIRVJFIEZpZWxkID0gIicuJGNvbHVtbl9uYW1lLiciJykpWzBdLT5UeXBlOwogICAgcHJlZ19tYXRjaCgnL15lbnVtXCgoLiopXCkkLycsICR0eXBlLCAkbWF0Y2hlcyk7CiAgICAkdmFsdWVzID0gYXJyYXkoKTsKICAgIGZvcmVhY2goZXhwbG9kZSgnLCcsICRtYXRjaGVzWzFdKSBhcyAkdmFsdWUpewogICAgICAgICR2YWx1ZXNbXSA9IHRyaW0oJHZhbHVlLCAiJyIpOwogICAgfQogICAgcmV0dXJuICR2YWx1ZXM7Cn0KCmZ1bmN0aW9uIGdldEF2YWlsYWJsZURhdGUoJGRhdGUsICRob2xpZGF5cywgJHR5cGUgPSAnZm9yd2FyZCcpewoJaWYoaW5fYXJyYXkoJGRhdGUsICRob2xpZGF5cykpewoJCSRkYXRlID0gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJGRhdGUuJyAnLigkdHlwZSA9PSAnZm9yd2FyZCcgPyAnKycgOiAnLScpLicxIGRheXMnKSk7CgkJcmV0dXJuIGdldEF2YWlsYWJsZURhdGUoJGRhdGUsICRob2xpZGF5cywgJHR5cGUpOwoJfQoJcmV0dXJuICRkYXRlOwp9CgpmdW5jdGlvbiBlc3RpbWF0ZWRWYWx1ZSgkcmVxdWlzaXRpb24pewoJJGVzdGltYXRlZCA9IDA7CiAgICBpZigkcmVxdWlzaXRpb24tPml0ZW1zLT5jb3VudCgpID4gMCl7CiAgICAgICAgZm9yZWFjaCgkcmVxdWlzaXRpb24tPml0ZW1zIGFzICRrZXkgPT4gJGl0ZW0pewogICAgICAgICAgICAkZXN0aW1hdGVkICs9ICgkaXRlbS0+cXR5KiRpdGVtLT5wcm9kdWN0LT51bml0X3ByaWNlKTsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuICRlc3RpbWF0ZWQ7Cn0KCmZ1bmN0aW9uIHByb2plY3REdXJhdGlvblRvbGVyYW5jZSgkcHJvamVjdCl7CglpZigkcHJvamVjdC0+c3RhdHVzID09ICdhcHByb3ZlZCcpewoJCSRkYXlzID0gZGF5c0RpZmZlcmVuY2UoJHByb2plY3QtPmluaXRpYWxfZW5kX2RhdGUsICRwcm9qZWN0LT5lbmRfZGF0ZSk7CgkgICAgaWYoc3RydG90aW1lKCRwcm9qZWN0LT5lbmRfZGF0ZSkgPiBzdHJ0b3RpbWUoJHByb2plY3QtPmluaXRpYWxfZW5kX2RhdGUpICYmICRkYXlzID4gJHByb2plY3QtPmRheXNfdG9sZXJhbmNlKXsKCSAgICAgICAgcmV0dXJuIFsKCSAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKCSAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiU29ycnkhIFByb2plY3QgRHVyYXRpb24gVG9sZXJhbmNlIExldmVsICgiLiRwcm9qZWN0LT5kYXlzX3RvbGVyYW5jZS4iIGRheXMpIGhhcyBiZWVuIGV4Y2VlZGVkIGJ5ICIuKCRkYXlzKS4iIGRheXMuIgoJICAgICAgICBdOwoJICAgIH0KCgkgICAgJGRheXMgPSBkYXlzRGlmZmVyZW5jZSgkcHJvamVjdC0+c3RhcnRfZGF0ZSwgJHByb2plY3QtPmluaXRpYWxfc3RhcnRfZGF0ZSk7CgkgICAgaWYoc3RydG90aW1lKCRwcm9qZWN0LT5pbml0aWFsX3N0YXJ0X2RhdGUpID4gc3RydG90aW1lKCRwcm9qZWN0LT5zdGFydF9kYXRlKSAmJiAkZGF5cyA+ICRwcm9qZWN0LT5kYXlzX3RvbGVyYW5jZSl7CgkgICAgICAgIHJldHVybiBbCgkgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCgkgICAgICAgICAgICAnbWVzc2FnZScgPT4gIlNvcnJ5ISBQcm9qZWN0IER1cmF0aW9uIFRvbGVyYW5jZSBMZXZlbCAoIi4kcHJvamVjdC0+ZGF5c190b2xlcmFuY2UuIiBkYXlzKSBoYXMgYmVlbiBleGNlZWRlZCBieSAiLigkZGF5cykuIiBkYXlzLiIKCSAgICAgICAgXTsKCSAgICB9Cgl9CgogICAgcmV0dXJuIFsKICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgIF07Cn0KCmZ1bmN0aW9uIGdldFRoaXNQYWdlTWVudXMoKXsKCSR1cmwgPSBleHBsb2RlKCc/JywgUmVxdWVzdDo6cGF0aCgpKVswXTsKCgkkcGVybWlzc2lvbiA9IFtdOwoJZm9yZWFjaChhdXRoKCktPnVzZXIoKS0+Z2V0UGVybWlzc2lvbnNWaWFSb2xlcygpIGFzICRkYXRhKXsKCQlhcnJheV9wdXNoKCRwZXJtaXNzaW9uLCAkZGF0YS0+bmFtZSk7Cgl9CgoJJHN1Ym1lbnUgPSBTdWJNZW51Ojp3aGVyZSgndXJsJywgJHVybCktPmZpcnN0KCk7CgkkbGlua3MgPSBbXTsKCWlmKGlzc2V0KCRzdWJtZW51LT5tZW51X2lkKSl7CgkJICRsaW5rcyA9IGNvbGxlY3QoU3ViTWVudTo6d2hlcmUoJ21lbnVfaWQnLCAkc3VibWVudS0+bWVudV9pZCktPndoZXJlKCd1cmwnLCAnIT0nLCAkdXJsKS0+Z2V0KCkpLT5tYXBXaXRoS2V5cyhmdW5jdGlvbiAoJGl0ZW0pIHVzZSgkcGVybWlzc2lvbikgewoJCQkJJGFyckRpZmYgPSBhcnJheV9pbnRlcnNlY3QoJHBlcm1pc3Npb24sIGlzc2V0KGpzb25fZGVjb2RlKCRpdGVtWydzbHVnJ10sdHJ1ZSlbMF0pID8ganNvbl9kZWNvZGUoJGl0ZW1bJ3NsdWcnXSx0cnVlKSA6IFtdKTsKCgkJCQlyZXR1cm4gW3VybCgkaXRlbVsndXJsJ10pID0+IFsKCQkJCQknbmFtZScgPT4gJGl0ZW1bJ25hbWUnXSwKCQkJCQknaWNvbicgPT4gJGl0ZW1bJ2ljb25fY2xhc3MnXSwKCQkJCQkncGVybWlzc2lvbicgPT4gJGFyckRpZmYsCgkJCQldXTsKCQl9KS0+dG9BcnJheSgpOwoJfQoKCS8vICRwcm9qZWN0X3N1Ym1lbnUgPSBQcm9qZWN0U3ViTWVudTo6d2hlcmUoJ3VybCcsICR1cmwpLT5maXJzdCgpOwoJLy8gJGxpbmtzMyA9IFtdOwoJLy8gaWYoaXNzZXQoJHByb2plY3Rfc3VibWVudS0+bWVudV9pZCkpewoJLy8gCSAkbGlua3MzID0gY29sbGVjdChQcm9qZWN0U3ViTWVudTo6d2hlcmUoJ21lbnVfaWQnLCAkcHJvamVjdF9zdWJtZW51LT5tZW51X2lkKS0+d2hlcmUoJ3VybCcsICchPScsICR1cmwpLT5nZXQoKSktPm1hcFdpdGhLZXlzKGZ1bmN0aW9uICgkaXRlbSkgdXNlKCRwZXJtaXNzaW9uKSB7CgkvLyAJCQkkYXJyRGlmZiA9IGFycmF5X2ludGVyc2VjdCgkcGVybWlzc2lvbiwgaXNzZXQoanNvbl9kZWNvZGUoJGl0ZW1bJ3NsdWcnXSx0cnVlKVswXSkgPyBqc29uX2RlY29kZSgkaXRlbVsnc2x1ZyddLHRydWUpIDogW10pOwoKCS8vIAkJCXJldHVybiBbdXJsKCRpdGVtWyd1cmwnXSkgPT4gWwoJLy8gCQkJCSduYW1lJyA9PiAkaXRlbVsnbmFtZSddLAoJLy8gCQkJCSdpY29uJyA9PiAkaXRlbVsnaWNvbl9jbGFzcyddLAoJLy8gCQkJCSdwZXJtaXNzaW9uJyA9PiAkYXJyRGlmZiwKCS8vIAkJCV1dOwoJLy8gCX0pLT50b0FycmF5KCk7CgkvLyB9CgoJLy8gcmV0dXJuIGFycmF5X21lcmdlKCRsaW5rcywkbGlua3MzKTsKCglyZXR1cm4gJGxpbmtzOwp9CgpmdW5jdGlvbiBnZXRVbml0UGFkKCR1bml0KXsKCSRtYWluID0gZ2V0TW9kdWxlcygpWydtYWluJ107CglyZXR1cm4gaXNzZXQoJHVuaXQtPnBhZCkgPyAkbWFpbi0+dXJsLicvJy4kdW5pdC0+cGFkIDogc2Vzc2lvbigpLT5nZXQoJ3N5c3RlbS1pbmZvcm1hdGlvbicpWydwYWQnXTsKfQoKZnVuY3Rpb24gZ2V0Q29tcGFueVBhZCgkY29tcGFueSl7CgkkbWFpbiA9IGdldE1vZHVsZXMoKVsnbWFpbiddOwoJcmV0dXJuIGlzc2V0KCRjb21wYW55LT51bml0c1swXSkgPyAkbWFpbi0+dXJsLicvJy4kY29tcGFueS0+dW5pdHMtPmZpcnN0KCktPnBhZCA6IHNlc3Npb24oKS0+Z2V0KCdzeXN0ZW0taW5mb3JtYXRpb24nKVsncGFkJ107Cn0KCmZ1bmN0aW9uIG1ha2VQYXltZW50VGVybXNTdHJpbmcoJGlkKXsKCXRyeXsKCQkkcGF5bWVudFRlcm0gPSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcU3VwcGxpZXJQYXltZW50VGVybTo6d2l0aChbJ3JlbFBheW1lbnRUZXJtJ10pLT5maW5kT3JGYWlsKCRpZCk7CgkJJHRlcm0gPSAkcGF5bWVudFRlcm0tPnJlbFBheW1lbnRUZXJtLT50ZXJtLicgKCcuJHBheW1lbnRUZXJtLT5wYXltZW50X3BlcmNlbnQuJyUgJy4oJHBheW1lbnRUZXJtLT50eXBlID09ICdwYWlkJyA/ICdBY2NvdW50IFBheWVlLWNoZXF1ZScgOiAnQ2FzaCBDaGVxdWUnKS4nIGluICcuJHBheW1lbnRUZXJtLT5kYXlfZHVyYXRpb24uJyBkYXlzJzsKCgkJJHRlcm1zID0gXEFwcFxNb2RlbHNcUG1zTW9kZWxzXFN1cHBsaWVyUGF5bWVudFRlcm06OndoZXJlKCdwYXJlbnRfaWQnLCAkcGF5bWVudFRlcm0tPmlkKS0+Z2V0KCk7CgkJaWYoaXNzZXQoJHRlcm1zWzBdKSl7CgkJCWZvcmVhY2goJHRlcm1zIGFzICRrZXkgPT4gJHRoaXNfdGVybSl7CgkJCQkkdGVybSAuPSAnLCAnLiR0aGlzX3Rlcm0tPnBheW1lbnRfcGVyY2VudC4nJSAnLigkdGhpc190ZXJtLT50eXBlID09ICdwYWlkJyA/ICdBY2NvdW50IFBheS1jaGVxdWUnIDogJ0Nhc2ggQ2hlcXVlJykuJyBpbiAnLiR0aGlzX3Rlcm0tPmRheV9kdXJhdGlvbi4nIGRheXMnOwoJCQl9CgkJfQoKCQkkdGVybSAuPSAnKSc7CgoJCXJldHVybiAkdGVybTsKCX1jYXRjaChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgcmV0dXJuICR0aC0+Z2V0TWVzc2FnZSgpOwogICAgfQp9CgpmdW5jdGlvbiB1c2VyQ29sdW1uVmlzaWJpbGl0aWVzKCl7CgkkY29sdW1uVmlzaWJpbGl0aWVzID0gXEFwcFxNb2RlbHNcVXNlckNvbHVtblZpc2liaWxpdHk6OndoZXJlKFsKCQkndXNlcl9pZCcgPT4gYXV0aCgpLT51c2VyKCktPmlkLAoJCSd1cmwnID0+IHJlcXVlc3QoKS0+ZnVsbFVybCgpCgldKS0+Zmlyc3QoKTsKCWlmKGlzc2V0KCRjb2x1bW5WaXNpYmlsaXRpZXMtPmlkKSl7CgkJJGNvbHVtbnMgPSAoIWVtcHR5KCRjb2x1bW5WaXNpYmlsaXRpZXMtPmNvbHVtbnMpICYmIGlzX2FycmF5KGpzb25fZGVjb2RlKCRjb2x1bW5WaXNpYmlsaXRpZXMtPmNvbHVtbnMsIHRydWUpKSA/IGpzb25fZGVjb2RlKCRjb2x1bW5WaXNpYmlsaXRpZXMtPmNvbHVtbnMsIHRydWUpIDogW10pOwoJCSRoaWRkZW4gPSBbXTsKCQlpZihpc3NldCgkY29sdW1uc1swXSkpewoJCQlmb3JlYWNoICgkY29sdW1ucyBhcyAka2V5ID0+ICRjb2x1bW4pIHsKCQkJCWlmKCRjb2x1bW4gPT0gImZhbHNlIil7CgkJCQkJYXJyYXlfcHVzaCgkaGlkZGVuLCAka2V5KTsKCQkJCX0KCQkJfQoJCX0KCgkJcmV0dXJuICRoaWRkZW47Cgl9CgoJcmV0dXJuIFtdOwp9CgpmdW5jdGlvbiBmcmVlemVQcm9kdWN0KCRwcm9kdWN0KXsKCXJldHVybiAoJHByb2R1Y3QtPnN0YXR1cyA9PSAnYXBwcm92ZWQnICYmICRwcm9kdWN0LT5yZXF1aXNpdGlvbkl0ZW0tPmNvdW50KCkgPiAwKTsKfQoKZnVuY3Rpb24gZnJlZXplU3VwcGxpZXIoJHN1cHBsaWVyKXsKCXJldHVybiAoJHN1cHBsaWVyLT5hcHByb3ZlZF9ieSA9PSAnbWFuYWdlbWVudC1hcHByb3ZlZCcgJiYgJHN1cHBsaWVyLT5yZWxRdW90YXRpb25zLT5jb3VudCgpID4gMCk7Cn0KCmZ1bmN0aW9uIGRhdGF0YWJsZU9yZGVyaW5nKCl7Cgkkb3JkZXIgPSBmYWxzZTsKCWlmKGlzc2V0KHJlcXVlc3QoKS0+b3JkZXJbMF0pKXsKCQlmb3JlYWNoKHJlcXVlc3QoKS0+b3JkZXIgYXMgJGtleSA9PiAkb3JkZXJpbmcpewoJCQlpZigkb3JkZXJpbmdbJ2NvbHVtbiddICE9IDApewoJCQkJJG9yZGVyID0gJG9yZGVyaW5nOwoJCQl9CgkJfQoJfQoKCXJldHVybiAkb3JkZXI7Cn0KCmZ1bmN0aW9uIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgJG9yZGVyQnlRdWVyeSl7CglyZXR1cm4gJHF1ZXJ5LT53aGVuKCRvcmRlciA9PSAnYXNjJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJG9yZGVyQnlRdWVyeSl7CiAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJCeSgkb3JkZXJCeVF1ZXJ5KTsKICAgIH0pCiAgICAtPndoZW4oJG9yZGVyID09ICdkZXNjJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJG9yZGVyQnlRdWVyeSl7CiAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJCeURlc2MoJG9yZGVyQnlRdWVyeSk7CiAgICB9KTsKfQoKZnVuY3Rpb24gcmVxdWlyZWQoKXsKCXJldHVybiAnPHN0cm9uZyBjbGFzcz0idGV4dC1kYW5nZXIiPio8L3N0cm9uZz4nOwp9CgpmdW5jdGlvbiBnZXRQcm9qZWN0UHJvZ3Jlc3MoJG9iamVjdCwgJHR5cGUpewoJJHN0YXJ0X2RhdGUgPSAnJzsKCSRlbmRfZGF0ZSA9ICcnOwoJaWYoJHR5cGUgPT0gJ3Byb2plY3QnKXsKCQkkc3RhcnRfZGF0ZSA9ICRvYmplY3QtPnN0YXJ0X2RhdGU7CgkJJGVuZF9kYXRlID0gJG9iamVjdC0+ZW5kX2RhdGU7Cgl9ZWxzZWlmKCR0eXBlID09ICdwaGFzZScgfHwgJHR5cGUgPT0gJ21pbGVzdG9uZScpewoJCSRzdGFydF9kYXRlID0gJG9iamVjdC0+c3RhcnRfYXQ7CgkJJGVuZF9kYXRlID0gJG9iamVjdC0+ZW5kX2F0OwoJfWVsc2VpZigkdHlwZSA9PSAndGFzaycpewoJCSRzdGFydF9kYXRlID0gJG9iamVjdC0+aW5pdGlhdGVfdGltZV9saW5lOwoJCSRlbmRfZGF0ZSA9ICRvYmplY3QtPmVuZF90aW1lX2xpbmU7Cgl9CgkKCSR3ZWlnaHRhZ2UgPSBnZXRDaGFydENvbG9yKCRvYmplY3QsICRzdGFydF9kYXRlLCAkZW5kX2RhdGUgLCAkdHlwZSwgJ2RvbmUnKTsKCSRwYXJlbnRfd2VpZ2h0YWdlID0gKGlzc2V0KCRvYmplY3QtPnNwb25zb3JfaWQpID8gMTAwIDogJG9iamVjdC0+d2VpZ2h0YWdlKTsKCXJldHVybiBzeXN0ZW1Eb3VibGVWYWx1ZSgoJHdlaWdodGFnZSA+IDAgJiYgJHBhcmVudF93ZWlnaHRhZ2UgPiAwID8gMTAwKigkd2VpZ2h0YWdlLyRwYXJlbnRfd2VpZ2h0YWdlKSA6IDApLCAyKTsKfQoKZnVuY3Rpb24gZ2V0Q29sb3IoJHZhbHVlKXsKICAgICRjb2xvcnMgPSBbCiAgICAJJ2JhY2tncm91bmQnID0+ICcjMzhjMTcyJywKICAgIAknY29sb3InID0+ICd3aGl0ZScsCiAgICBdOwogICAgCiAgICBpZigkdmFsdWUgPT0gInVwY29taW5nIil7CiAgICAgICAgJGNvbG9yc1snYmFja2dyb3VuZCddID0gJyMzNDkwZGMnOwogICAgfQoKICAgIGlmKCR2YWx1ZSA9PSAib25nb2luZyIpewogICAgICAgICRjb2xvcnNbJ2JhY2tncm91bmQnXSA9ICcjZmZlZDRhJzsKICAgICAgICAkY29sb3JzWydjb2xvciddID0gJ2JsYWNrJzsKICAgIH0KCiAgICBpZigkdmFsdWUgPT0gImRlbGF5Iil7CiAgICAgICAgJGNvbG9yc1snYmFja2dyb3VuZCddID0gJyNlMzM0MmYnOwogICAgfQogICAgICAgIAogICAgcmV0dXJuICRjb2xvcnM7Cn0KCmZ1bmN0aW9uIGdldENoYXJ0Q29sb3JzKCRvYmplY3QsICRzdGFydF9kYXRlLCAkZW5kX2RhdGUsICR0eXBlID0gJ3Byb2plY3QnKXsKCSRhcnJheSA9IFsnZG9uZScsICdkZWxheScsICdvbmdvaW5nJywgJ3VwY29taW5nJ107CgkkY29uZGl0aW9ucyA9IFtdOwoJZm9yZWFjaCgkYXJyYXkgYXMgJGtleSA9PiAkdmFsdWUpewoJCSR3ZWlnaHRhZ2UgPSBnZXRDaGFydENvbG9yKCRvYmplY3QsICRzdGFydF9kYXRlLCAkZW5kX2RhdGUsICR0eXBlLCAkdmFsdWUpOwoJCSRwYXJlbnRfd2VpZ2h0YWdlID0gKGlzc2V0KCRvYmplY3QtPnNwb25zb3JfaWQpID8gMTAwIDogJG9iamVjdC0+d2VpZ2h0YWdlKTsKCQkkY29uZGl0aW9uc1skdmFsdWVdID0gc3lzdGVtRG91YmxlVmFsdWUoKCR3ZWlnaHRhZ2UgPiAwICYmICRwYXJlbnRfd2VpZ2h0YWdlID4gMCA/IDEwMCooJHdlaWdodGFnZS8kcGFyZW50X3dlaWdodGFnZSkgOiAwKSwgMik7Cgl9CgoJcmV0dXJuICRjb25kaXRpb25zOwp9CgpmdW5jdGlvbiBnZXRDaGFydENvbG9yKCRvYmplY3QsICRzdGFydF9kYXRlLCAkZW5kX2RhdGUsICR0eXBlID0gJ3Byb2plY3QnLCAkY29uZGl0aW9uID0gJ2RvbmUnKXsKCWlmKCR0eXBlID09ICdwcm9qZWN0Jyl7CgkJJHBlcmNlbnRhZ2UgPSAwOwoJCWlmKCRvYmplY3QtPmRlbGl2ZXJhYmxlcy0+Y291bnQoKSA+IDApewoJCQlmb3JlYWNoKCRvYmplY3QtPmRlbGl2ZXJhYmxlcyBhcyAka2V5ID0+ICRkZWxpdmVyYWJsZSl7CgkJCQkkcGVyY2VudGFnZSArPSBnZXRDaGFydENvbG9yKCRkZWxpdmVyYWJsZSwgJGRlbGl2ZXJhYmxlLT5zdGFydF9hdCwgJGRlbGl2ZXJhYmxlLT5lbmRfYXQgLCdwaGFzZScsICRjb25kaXRpb24pOwoJCQl9CgkJfQoJCXJldHVybiAkcGVyY2VudGFnZTsKCX1lbHNlaWYoJHR5cGUgPT0gJ3BoYXNlJyl7CgkJJHBlcmNlbnRhZ2UgPSAwOwoJCWlmKCRvYmplY3QtPnN1YkRlbGl2ZXJhYmxlcy0+Y291bnQoKSA+IDApewoJCQlmb3JlYWNoKCRvYmplY3QtPnN1YkRlbGl2ZXJhYmxlcyBhcyAka2V5ID0+ICRzdWJEZWxpdmVyYWJsZSl7CgkJCQkkcGVyY2VudGFnZSArPSBnZXRDaGFydENvbG9yKCRzdWJEZWxpdmVyYWJsZSwgJHN1YkRlbGl2ZXJhYmxlLT5zdGFydF9hdCwgJHN1YkRlbGl2ZXJhYmxlLT5lbmRfYXQgLCdtaWxlc3RvbmUnLCAkY29uZGl0aW9uKTsKCQkJfQoJCX1lbHNlewoJCQkkcGVyY2VudGFnZSA9IGdldENoYXJ0Q29sb3IoJG9iamVjdCwgJG9iamVjdC0+c3RhcnRfYXQsICRvYmplY3QtPmVuZF9hdCAsJ3Rhc2snLCAkY29uZGl0aW9uKTsKCQkJJHBlcmNlbnRhZ2UgPSAoJHBlcmNlbnRhZ2UgPiAwID8gMTAwIDogMCk7CgkJfQoJCXJldHVybiAoJHBlcmNlbnRhZ2UgPiAwICYmICRvYmplY3QtPndlaWdodGFnZSA+IDAgPyAoJG9iamVjdC0+d2VpZ2h0YWdlKigkcGVyY2VudGFnZS8xMDApKSA6IDApOwoJfWVsc2VpZigkdHlwZSA9PSAnbWlsZXN0b25lJyl7CgkJJHBlcmNlbnRhZ2UgPSAwOwoJCWlmKCRvYmplY3QtPnByb2plY3RUYXNrcy0+d2hlcmUoJ3BhcmVudF9pZCcsIDApLT5jb3VudCgpID4gMCl7CgkJCWZvcmVhY2goJG9iamVjdC0+cHJvamVjdFRhc2tzLT53aGVyZSgncGFyZW50X2lkJywgMCkgYXMgJGtleSA9PiAkcHJvamVjdFRhc2spewoJCQkJJHBlcmNlbnRhZ2UgKz0gZ2V0Q2hhcnRDb2xvcigkcHJvamVjdFRhc2ssICRwcm9qZWN0VGFzay0+aW5pdGlhdGVfdGltZV9saW5lLCAkcHJvamVjdFRhc2stPmVuZF90aW1lX2xpbmUgLCd0YXNrJywgJGNvbmRpdGlvbik7CgkJCX0KCQl9ZWxzZXsKCQkJJHBlcmNlbnRhZ2UgPSBnZXRDaGFydENvbG9yKCRvYmplY3QsICRvYmplY3QtPnN0YXJ0X2F0LCAkb2JqZWN0LT5lbmRfYXQgLCd0YXNrJywgJGNvbmRpdGlvbik7CgkJCSRwZXJjZW50YWdlID0gKCRwZXJjZW50YWdlID4gMCA/IDEwMCA6IDApOwoJCX0KCQlyZXR1cm4gKCRwZXJjZW50YWdlID4gMCAmJiAkb2JqZWN0LT53ZWlnaHRhZ2UgPiAwID8gKCRvYmplY3QtPndlaWdodGFnZSooJHBlcmNlbnRhZ2UvMTAwKSkgOiAwKTsKCX1lbHNlaWYoJHR5cGUgPT0gJ3Rhc2snKXsKCQkkcGVyY2VudGFnZSA9IDA7CgkJaWYoJGNvbmRpdGlvbiA9PSAnZG9uZScpewoJCQkKCQkJJHBlcmNlbnRhZ2UgPSAoJG9iamVjdC0+c3RhdHVzID09ICdkb25lJyA/ICgkb2JqZWN0LT53ZWlnaHRhZ2UpIDogMCk7CgoJCX1lbHNlaWYoJGNvbmRpdGlvbiA9PSAnZGVsYXknICYmICRvYmplY3QtPnN0YXR1cyAhPSAnZG9uZScpewoJCQlpZighKHN0cnRvdGltZShkYXRlKCdZLW0tZCcpKSA8IHN0cnRvdGltZSgkc3RhcnRfZGF0ZSkpICYmICEoc3RydG90aW1lKGRhdGUoJ1ktbS1kJykpID49IHN0cnRvdGltZSgkc3RhcnRfZGF0ZSkgJiYgc3RydG90aW1lKGRhdGUoJ1ktbS1kJykpIDw9IHN0cnRvdGltZSgkZW5kX2RhdGUpKSl7CgkJCQkkcGVyY2VudGFnZSA9IChzdHJ0b3RpbWUoZGF0ZSgnWS1tLWQnKSkgPiBzdHJ0b3RpbWUoJGVuZF9kYXRlKSA/ICgkb2JqZWN0LT53ZWlnaHRhZ2UpIDogMCk7CgkJCX0KCgkJfWVsc2VpZigkY29uZGl0aW9uID09ICd1cGNvbWluZycgJiYgJG9iamVjdC0+c3RhdHVzICE9ICdkb25lJyl7CgkJCWlmKCEoc3RydG90aW1lKGRhdGUoJ1ktbS1kJykpID4gc3RydG90aW1lKCRlbmRfZGF0ZSkpICYmICEoc3RydG90aW1lKGRhdGUoJ1ktbS1kJykpID49IHN0cnRvdGltZSgkc3RhcnRfZGF0ZSkgJiYgc3RydG90aW1lKGRhdGUoJ1ktbS1kJykpIDw9IHN0cnRvdGltZSgkZW5kX2RhdGUpKSl7CgkJCQkkcGVyY2VudGFnZSA9IChzdHJ0b3RpbWUoZGF0ZSgnWS1tLWQnKSkgPCBzdHJ0b3RpbWUoJHN0YXJ0X2RhdGUpID8gKCRvYmplY3QtPndlaWdodGFnZSkgOiAwKTsKCQkJfQoKCQl9ZWxzZWlmKCRjb25kaXRpb24gPT0gJ29uZ29pbmcnICYmICRvYmplY3QtPnN0YXR1cyAhPSAnZG9uZScpewoJCQlpZighKHN0cnRvdGltZShkYXRlKCdZLW0tZCcpKSA+IHN0cnRvdGltZSgkZW5kX2RhdGUpKSAmJiAhKHN0cnRvdGltZShkYXRlKCdZLW0tZCcpKSA8IHN0cnRvdGltZSgkc3RhcnRfZGF0ZSkpKXsKCQkJCSRwZXJjZW50YWdlID0gKHN0cnRvdGltZShkYXRlKCdZLW0tZCcpKSA+PSBzdHJ0b3RpbWUoJHN0YXJ0X2RhdGUpICYmIHN0cnRvdGltZShkYXRlKCdZLW0tZCcpKSA8PSBzdHJ0b3RpbWUoJGVuZF9kYXRlKSA/ICgkb2JqZWN0LT53ZWlnaHRhZ2UpIDogMCk7CgkJCX0KCQl9CgoJCXJldHVybiAkcGVyY2VudGFnZTsKCX0KfQoKZnVuY3Rpb24gdXBkYXRlU3VwcGxpZXJQcm9kdWN0cygkc3VwcGxpZXJfaWQpewoJaWYoJHN1cHBsaWVyX2lkID09IDEyKXsKCQkkc3VwcGxpZXIgPSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcU3VwcGxpZXJzOjp3aXRoKFsKCSAgICAgICAgJ3Byb2R1Y3RzJwoJICAgIF0pLT5maW5kT3JGYWlsKCRzdXBwbGllcl9pZCk7CgoJICAgICRwcm9kdWN0cyA9IFxBcHBcTW9kZWxzXFBtc01vZGVsc1xQcm9kdWN0Ojp3aGVyZU5vdEluKCdpZCcsICRzdXBwbGllci0+cHJvZHVjdHMtPnBsdWNrKCdpZCcpLT50b0FycmF5KCkpLT5wbHVjaygnaWQnKS0+dG9BcnJheSgpOwoJICAgICRhcnJheSA9IFtdOwoJICAgIGlmKGlzc2V0KCRwcm9kdWN0c1swXSkpewoJICAgICAgICBmb3JlYWNoKCRwcm9kdWN0cyBhcyAka2V5ID0+ICRwcm9kdWN0X2lkKXsKCSAgICAgICAgICAgIGFycmF5X3B1c2goJGFycmF5LCBbCgkgICAgICAgICAgICAgICAgJ3N1cHBsaWVyX2lkJyA9PiAkc3VwcGxpZXItPmlkLAoJICAgICAgICAgICAgICAgICdwcm9kdWN0X2lkJyA9PiAkcHJvZHVjdF9pZCwKCSAgICAgICAgICAgIF0pOwoJICAgICAgICB9CgkgICAgfQoKCSAgICBpZihpc3NldCgkYXJyYXlbMF0pKXsKCSAgICAgICAgREI6OnRhYmxlKCdwcm9kdWN0c19zdXBwbGllcicpLT5pbnNlcnQoJGFycmF5KTsKCSAgICB9Cgl9Cn0KCmZ1bmN0aW9uIGdldFBPRHVlQW1vdW50KCRwdXJjaGFzZU9yZGVyKXsKCSRhZHZhbmNlQm9va2VkID0gXEFwcFxNb2RlbHNcUG1zTW9kZWxzXFN1cHBsaWVyUGF5bWVudDo6ZG9lc250SGF2ZSgncmVsU3VwcGxpZXJMZWRnZXJzJykKCS0+d2hlcmUoJ3B1cmNoYXNlX29yZGVyX2lkJywgJHB1cmNoYXNlT3JkZXItPmlkKQogICAgLT53aGVyZSgnc3VwcGxpZXJfaWQnLCAkcHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5zdXBwbGllcl9pZCkKCS0+d2hlcmUoJ2JpbGxfdHlwZScsICdwby1hZHZhbmNlJykKCS0+c3VtKCdwYXlfYW1vdW50Jyk7CiAgICAkcGFpZCA9IFxBcHBcTW9kZWxzXFBtc01vZGVsc1xTdXBwbGllckxlZGdlcnM6OndoZXJlSGFzKCdyZWxTdXBwbGllclBheW1lbnQnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcHVyY2hhc2VPcmRlcil7CiAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3B1cmNoYXNlX29yZGVyX2lkJywgJHB1cmNoYXNlT3JkZXItPmlkKQogICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdzdXBwbGllcl9pZCcsICRwdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnN1cHBsaWVyX2lkKTsKICAgIH0pLT5zdW0oJ2RlYml0Jyk7CiAgICByZXR1cm4gc3lzdGVtRG91YmxlVmFsdWUoJHB1cmNoYXNlT3JkZXItPmdyb3NzX3ByaWNlLSgkYWR2YW5jZUJvb2tlZCskcGFpZCksIDIpOwp9CgpmdW5jdGlvbiBtZW51TW9kdWxlcygpewoJcmV0dXJuIFsKCQkncHJvY3VyZW1lbnQnLAoJCSdwcm9qZWN0LW1hbmFnZW1lbnQnLAoJCSdmaW5hbmNlJywKCQknc2FsZXMnLAoJCSdtYW51ZmFjdHVyaW5nJwoJXTsKfQoKZnVuY3Rpb24gZ2V0RGVwYXJ0bWVudEhlYWROYW1lKCR1c2VyX2lkKQp7CiAgICAkdXNlciA9IFVzZXI6OmZpbmQoJHVzZXJfaWQpOwogICAgJHVzZXJzID0gVXNlcjo6d2hlcmVIYXMoJ2VtcGxveWVlJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkdXNlcikgewogICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhc191bml0X2lkJywgJHVzZXItPmVtcGxveWVlLT5hc191bml0X2lkKQogICAgICAgICAgICAtPndoZXJlKCdhc19kZXBhcnRtZW50X2lkJywgJHVzZXItPmVtcGxveWVlLT5hc19kZXBhcnRtZW50X2lkKTsKICAgIH0pLT5nZXQoKTsKCiAgICAkaGVhZHMgPSBbXTsKICAgIGlmIChpc3NldCgkdXNlcnNbMF0pKSB7CiAgICAgICAgZm9yZWFjaCAoJHVzZXJzIGFzICR1c2VyKSB7CiAgICAgICAgICAgIGlmICgkdXNlci0+aGFzUm9sZSgnRGVwYXJ0bWVudC1IZWFkJykpIHsKICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGhlYWRzLCAkdXNlci0+aWQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICR1c2VyRGF0YSA9IFVzZXI6OndoZXJlSW4oJ2lkJywgJGhlYWRzKS0+d2hlcmVIYXMoJ2VtcGxveWVlJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkdXNlcikgewogICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhc191bml0X2lkJywgJHVzZXItPmVtcGxveWVlLT5hc191bml0X2lkKQogICAgICAgICAgICAtPndoZXJlKCdhc19kZXBhcnRtZW50X2lkJywgJHVzZXItPmVtcGxveWVlLT5hc19kZXBhcnRtZW50X2lkKTsKICAgIH0pLT5maXJzdCgpOwoKICAgIHJldHVybiBpc3NldCgkdXNlckRhdGEtPmlkKSA/ICR1c2VyRGF0YS0+bmFtZSAuJ1snLiR1c2VyRGF0YS0+YXNzb2NpYXRlX2lkLiddJyA6IG51bGw7Cn0=