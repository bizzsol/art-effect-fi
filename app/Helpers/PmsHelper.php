<?php
bolt_decrypt( __FILE__ , 'BdBo6s'); return 0;
##!!!##Cgp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcSW52ZW50b3J5TW9kZWxzXEludmVudG9yeUxvZ3M7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xSZXF1aXNpdGlvbjsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXENhdGVnb3J5Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcU3VwcGxpZXJMb2c7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xTdXBwbGllclJhdGluZ3M7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVyOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcQXR0cmlidXRlOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcQXR0cmlidXRlT3B0aW9uOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHJvZHVjdEF0dHJpYnV0ZTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFByb2R1Y3Q7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xOb3RpZmljYXRpb247CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDb3N0Q2VudHJlOwp1c2UgQXBwXE1vZGVsc1xNeVByb2plY3RcUHJvZ3JhbTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXE1lbnVcU3ViTWVudTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXE1lbnVcQWNjb3VudHNTdWJNZW51Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcTWVudVxNZW51Owp1c2UgXEFwcFxNb2RlbHNcTXlQcm9qZWN0XERlcGVuZGVuY3k7CnVzZSBBcHBcVXNlcjsKdXNlIElsbHVtaW5hdGVcU3VwcG9ydFxGYWNhZGVzXEF1dGg7CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xEQjsKdXNlIElsbHVtaW5hdGVcU3VwcG9ydFxGYWNhZGVzXFJlcXVlc3Q7CgppbmNsdWRlICdEYXNoYm9hcmRIZWxwZXIucGhwJzsKCmZ1bmN0aW9uIHNhdmVTdXBwbGllckxvZygkc3VwcGxpZXJfaWQsICRkYXRlLCAkdG9waWMsICR0ZXh0LCAkaWQgPSAwKXsKCSRsb2cgPSBTdXBwbGllckxvZzo6ZmluZCgkaWQpOwoJaWYoaXNzZXQoJGxvZy0+aWQpKXsKCQkkbG9nLT5kYXRlID0gJGRhdGU7CgkJJGxvZy0+dG9waWMgPSAkdG9waWM7CgkJJGxvZy0+bG9nID0gJHRleHQ7CgkJJGxvZy0+c2F2ZSgpOwoJfWVsc2V7CgkJJGxvZyA9IFN1cHBsaWVyTG9nOjpjcmVhdGUoWwoJCQknc3VwcGxpZXJfaWQnID0+ICRzdXBwbGllcl9pZCwKCQkJJ2RhdGUnID0+ICRkYXRlLAoJCQkndG9waWMnID0+ICR0b3BpYywKCQkJJ2xvZycgPT4gJHRleHQsCgkJXSk7Cgl9CgoJcmV0dXJuICRsb2c7Cn0KCmZ1bmN0aW9uIGdldE1lcmdlZFJlcXVpc2lzaW9uSUQoJGNvbmRpdGlvbjEsICRjb25kaXRpb24yKXsKCXJldHVybiBhcnJheV91bmlxdWUoYXJyYXlfbWVyZ2UoUmVxdWlzaXRpb246OndoZXJlKCRjb25kaXRpb24xKS0+cGx1Y2soJ2lkJyktPnRvQXJyYXkoKSwgUmVxdWlzaXRpb246OndoZXJlKCRjb25kaXRpb24yKS0+cGx1Y2soJ2lkJyktPnRvQXJyYXkoKSkpOwp9CgpmdW5jdGlvbiBnZXRUeXBlV2lzZVJlcXVpc2lzdGlvbkNvdW50KCR0eXBlPScnKQp7CglyZXR1cm4gUmVxdWlzaXRpb246OndoZW4oaXNzZXQoQXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc19kZXBhcnRtZW50X2lkKSwKCQlmdW5jdGlvbigkcXVlcnkpewoJCQlyZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsVXNlcnNMaXN0LmVtcGxveWVlJyxmdW5jdGlvbigkcXVlcnkpewoJCQkJcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2FzX2RlcGFydG1lbnRfaWQnLEF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfZGVwYXJ0bWVudF9pZCk7CgkJCX0pOwoJCX0pCgktPndoZXJlKCdzdGF0dXMnLCR0eXBlKQoJLT5jb3VudCgpOwp9CgpmdW5jdGlvbiBpbnZlbnRvcnlTdGF0dXMoJHR5cGUgPSAnJywgJHdhcmVob3VzZV9pZCA9IDApCnsKCXJldHVybiBJbnZlbnRvcnlMb2dzOjp3aGVyZSgndHlwZScsICR0eXBlKQoJLT53aGVuKCR3YXJlaG91c2VfaWQgPiAwLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkd2FyZWhvdXNlX2lkKXsKCQlyZXR1cm4gJHF1ZXJ5LT53aGVyZSgnd2FyZWhvdXNlX2lkJywgJHdhcmVob3VzZV9pZCk7Cgl9KQoJLT5jb3VudCgpOwp9CgpmdW5jdGlvbiBRdWFsaXR5RW5zdXJlTGlzdCgkdHlwZSkKewoJcmV0dXJuIFB1cmNoYXNlT3JkZXI6OndoZXJlKCdpc19zZW5kJywneWVzJykKCS0+d2hlcmVIYXMoJ3JlbEdvb2RSZWNlaXZlTm90ZS5yZWxHb29kc1JlY2VpdmVkSXRlbXMnLGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgkdHlwZSl7CgkJcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3F1YWxpdHlfZW5zdXJlJywkdHlwZSk7Cgl9KS0+Y291bnQoKTsKfQoKCmZ1bmN0aW9uIHNwYWNlcygkdmFsdWUsICRleHRyYSA9IDAsICRub1NwYWNlcyA9IHRydWUpewoJaWYoJG5vU3BhY2VzKXsKCQlyZXR1cm4gKCR2YWx1ZSskZXh0cmEpKzI7Cgl9CgkKCSRzcGFjZXMgPSAnJzsKCWZvciAoJGk9MDsgJGkgPCAoJHZhbHVlKyRleHRyYSkqNjsgJGkrKykgeyAKCQkkc3BhY2VzIC49ICImbmJzcDsiOwoJfQoJcmV0dXJuICRzcGFjZXM7Cn0KCmZ1bmN0aW9uIGNhdGVnb3J5TGlzdCgpewoJcmV0dXJuIENhdGVnb3J5Ojp3aGVyZSgncGFyZW50X2lkJyxudWxsKS0+Z2V0KCk7Cn0KCmZ1bmN0aW9uIGNhdGVnb3J5T3B0aW9ucygkc3ViQ2F0ZWdvcmllcywgJGNob3NlbiA9IDAsICRzdGVwID0gMCwgJGlzX2ZpeGVkX2Fzc2V0ID0gMCwgJGlzX2N3aXAgPSAwLCAkYWxsU3ViQ2F0ZWdvcmllcyA9IFtdLCAkYWxsQ2F0ZWdvcnlBdHRyaWJ1dGVzID0gW10pewoJaWYoJHN0ZXAgPT0gMCl7CgkJJGFsbFN1YkNhdGVnb3JpZXMgPSBDYXRlZ29yeTo6d2l0aChbCgkJCSdjYXRlZ29yeScsICdzdWJDYXRlZ29yeScsCgkJXSkKCQkvLyAtPndoZXJlKCdpc19maXhlZF9hc3NldCcsICRpc19maXhlZF9hc3NldCkKCQkvLyAtPndoZXJlKCdpc19jd2lwJywgJGlzX2N3aXApCgkJLT5vcmRlckJ5KCdjb2RlJyktPmdldCgpOwoJCSRhbGxDYXRlZ29yeUF0dHJpYnV0ZXMgPSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQ2F0ZWdvcnlBdHRyaWJ1dGU6OmFsbCgpOwoKCQkkc3ViQ2F0ZWdvcmllcyA9ICRhbGxTdWJDYXRlZ29yaWVzLT53aGVyZSgncGFyZW50X2lkJywgMCk7Cgl9CgoJJGRhdGEgPSAnJzsKCWlmKCRzdWJDYXRlZ29yaWVzLT5jb3VudCgpID4gMCl7CgkJZm9yZWFjaCAoJHN1YkNhdGVnb3JpZXMgYXMgJGtleSA9PiAkc3ViQ2F0ZWdvcnkpIHsKCQkJJGNhdGVnb3J5QXR0cmlidXRlcyA9ICRhbGxDYXRlZ29yeUF0dHJpYnV0ZXMtPndoZXJlKCdjYXRlZ29yeV9pZCcsICRzdWJDYXRlZ29yeS0+aWQpOwoJCQkkYXR0cmlidXRlcyA9IFtdOwoJCQkkYXR0cmlidXRlT3B0aW9ucyA9IFtdOwoJCQlpZigkY2F0ZWdvcnlBdHRyaWJ1dGVzLT5jb3VudCgpID4gMCl7CgkJCQlmb3JlYWNoKCRjYXRlZ29yeUF0dHJpYnV0ZXMgYXMgJGtleSA9PiAkY2F0ZWdvcnlBdHRyaWJ1dGUpewoJCQkJCWFycmF5X3B1c2goJGF0dHJpYnV0ZXMsICRjYXRlZ29yeUF0dHJpYnV0ZS0+YXR0cmlidXRlX2lkKTsKCQkJCQkkYXR0cmlidXRlT3B0aW9ucyA9IGFycmF5X21lcmdlKCRhdHRyaWJ1dGVPcHRpb25zLCAoaXNfYXJyYXkoanNvbl9kZWNvZGUoJGNhdGVnb3J5QXR0cmlidXRlLT5vcHRpb25zLCB0cnVlKSkgPyBqc29uX2RlY29kZSgkY2F0ZWdvcnlBdHRyaWJ1dGUtPm9wdGlvbnMsIHRydWUpIDogW10pKTsKCQkJCX0KCQkJfQoJCQkkYXR0cmlidXRlcyA9IGltcGxvZGUoJywnLCAkYXR0cmlidXRlcyk7CgkJCSRhdHRyaWJ1dGVPcHRpb25zID0gaW1wbG9kZSgnLCcsICRhdHRyaWJ1dGVPcHRpb25zKTsKCQkJJHN1YkNhdGVnb3JpZXMgPSAkYWxsU3ViQ2F0ZWdvcmllcy0+d2hlcmUoJ3BhcmVudF9pZCcsICRzdWJDYXRlZ29yeS0+aWQpOwoJCQkkZGF0YSAuPSAgICAnPG9wdGlvbiB2YWx1ZT0iJy4kc3ViQ2F0ZWdvcnktPmlkLiciICcuKCRjaG9zZW4gPT0gJHN1YkNhdGVnb3J5LT5pZCA/ICdzZWxlY3RlZCcgOiAnJykuJyAnLigkc3ViQ2F0ZWdvcnktPnN1YkNhdGVnb3J5LT5jb3VudCgpID4gMCA/ICdkaXNhYmxlZCcgOiAnJykuJyBkYXRhLWF0dHJpYnV0ZXM9IicuJGF0dHJpYnV0ZXMuJyIgZGF0YS1hdHRyaWJ1dGUtb3B0aW9ucz0iJy4kYXR0cmlidXRlT3B0aW9ucy4nIiBpbnZlbnRvcnlfYWNjb3VudF9pZD0iJy4kc3ViQ2F0ZWdvcnktPmludmVudG9yeV9hY2NvdW50X2lkLiciIGN3aXBfYXNzZXRfYWNjb3VudF9pZD0iJy4kc3ViQ2F0ZWdvcnktPmN3aXBfYXNzZXRfYWNjb3VudF9pZC4nIiBjb2dzX2FjY291bnRfaWQ9IicuJHN1YkNhdGVnb3J5LT5jb2dzX2FjY291bnRfaWQuJyIgaW52ZW50b3J5X2FkanVzdG1lbnRzX2FjY291bnRfaWQ9IicuJHN1YkNhdGVnb3J5LT5pbnZlbnRvcnlfYWRqdXN0bWVudHNfYWNjb3VudF9pZC4nIiBpc19maXhlZF9hc3NldD0iJy4kc3ViQ2F0ZWdvcnktPmlzX2ZpeGVkX2Fzc2V0LiciIGlzX2N3aXA9IicuJHN1YkNhdGVnb3J5LT5pc19jd2lwLiciIGRlcHJlY2lhdGlvbl9yYXRlPSInLiRzdWJDYXRlZ29yeS0+ZGVwcmVjaWF0aW9uX3JhdGUuJyIgc2FsZXNfYWNjb3VudF9pZD0iJy4kc3ViQ2F0ZWdvcnktPnNhbGVzX2FjY291bnRfaWQuJyIgZGVwcmVjaWF0aW9uX2Nvc3RfYWNjb3VudF9pZD0iJy4kc3ViQ2F0ZWdvcnktPmRlcHJlY2lhdGlvbl9jb3N0X2FjY291bnRfaWQuJyIgZGVwcmVjaWF0aW9uX2Rpc3Bvc2FsX2FjY291bnRfaWQ9IicuJHN1YkNhdGVnb3J5LT5kZXByZWNpYXRpb25fZGlzcG9zYWxfYWNjb3VudF9pZC4nIiBkYXRhLXByb2R1Y3QtdHlwZT0iJy4oJHN1YkNhdGVnb3J5LT5pc19maXhlZF9hc3NldCA9PSAxID8gJ2ZpeGVkX2Fzc2V0JyA6ICgkc3ViQ2F0ZWdvcnktPmlzX2N3aXAgPT0gMSA/ICdjd2lwJyA6ICdwcm9kdWN0cycpKS4nIiBkYXRhLXNlcnZpY2U9IicuKCRzdWJDYXRlZ29yeS0+aXNfc2VydmljZSkuJyI+Jy5zcGFjZXMoJHN0ZXApLiRzdWJDYXRlZ29yeS0+bmFtZS4nICcuKCRzdWJDYXRlZ29yaWVzLT5jb3VudCgpID4gMCA/ICcoJy4oJHN1YkNhdGVnb3J5LT5pc19maXhlZF9hc3NldCA9PSAxID8gJ0ZpeGVkIEFzc2V0JyA6ICgkc3ViQ2F0ZWdvcnktPmlzX2N3aXAgPT0gMSA/ICdDV0lQJyA6ICdQcm9kdWN0cycpKS4nKScgOiAnJykuJzwvb3B0aW9uPic7CgkJCWlmKCRzdWJDYXRlZ29yaWVzLT5jb3VudCgpID4gMCl7CgkJCQkkZGF0YSAuPSBjYXRlZ29yeU9wdGlvbnMoJHN1YkNhdGVnb3JpZXMsICRjaG9zZW4sICRzdGVwKzEsICRpc19maXhlZF9hc3NldCwgJGlzX2N3aXAsICRhbGxTdWJDYXRlZ29yaWVzLCAkYWxsQ2F0ZWdvcnlBdHRyaWJ1dGVzKTsKCQkJfQoJCX0KCX0KCglyZXR1cm4gJGRhdGE7Cn0KCmZ1bmN0aW9uIGdldFByb2R1Y3RBdHRyaWJ1dGVzKCRwcm9kdWN0X2lkKXsKCSRhdHRyaWJ1dGVzID0gUHJvZHVjdEF0dHJpYnV0ZTo6d2l0aChbJ2F0dHJpYnV0ZU9wdGlvbicsICdhdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJ10pCgktPndoZXJlKCdwcm9kdWN0X2lkJywgJHByb2R1Y3RfaWQpCgktPm9yZGVyQnkoJ3NlcmlhbF9ubycsICdhc2MnKQoJLT5nZXQoKTsKCSRvcHRpb25zID0gW107CglpZihpc3NldCgkYXR0cmlidXRlc1swXSkpewoJCWZvcmVhY2goJGF0dHJpYnV0ZXMgYXMgJGtleSA9PiAkYXR0cmlidXRlKXsKCQkJaWYoaXNzZXQoJGF0dHJpYnV0ZS0+YXR0cmlidXRlT3B0aW9uLT5hdHRyaWJ1dGUtPmNvZGUpKXsKCQkJCWFycmF5X3B1c2goJG9wdGlvbnMsIChpc3NldCgkYXR0cmlidXRlLT5hdHRyaWJ1dGVPcHRpb24tPmF0dHJpYnV0ZS0+Y29kZSk/JGF0dHJpYnV0ZS0+YXR0cmlidXRlT3B0aW9uLT5hdHRyaWJ1dGUtPmNvZGU6JycpLic6Jy4oaXNzZXQoJGF0dHJpYnV0ZS0+YXR0cmlidXRlT3B0aW9uLT5uYW1lKT8kYXR0cmlidXRlLT5hdHRyaWJ1dGVPcHRpb24tPm5hbWU6JycpKTsKCQkJfQoJCX0KCX0KCXJldHVybiBpc3NldCgkb3B0aW9uc1swXSkgPyAnKCcuaW1wbG9kZSgnLCAnLCAkb3B0aW9ucykuJyknIDogJyc7Cn0KCmZ1bmN0aW9uIGdldFByb2R1Y3RBdHRyaWJ1dGVzRmFzdGVyKCRwcm9kdWN0KXsKCSRvcHRpb25zID0gW107CglpZihpc3NldCgkcHJvZHVjdC0+YXR0cmlidXRlc1swXSkpewoJCWZvcmVhY2goJHByb2R1Y3QtPmF0dHJpYnV0ZXMgYXMgJGtleSA9PiAkYXR0cmlidXRlKXsKCQkJaWYoaXNzZXQoJGF0dHJpYnV0ZS0+YXR0cmlidXRlT3B0aW9uLT5hdHRyaWJ1dGUtPmNvZGUpKXsKCQkJCWFycmF5X3B1c2goJG9wdGlvbnMsIChpc3NldCgkYXR0cmlidXRlLT5hdHRyaWJ1dGVPcHRpb24tPmF0dHJpYnV0ZS0+Y29kZSk/JGF0dHJpYnV0ZS0+YXR0cmlidXRlT3B0aW9uLT5hdHRyaWJ1dGUtPmNvZGU6JycpLic6Jy4oaXNzZXQoJGF0dHJpYnV0ZS0+YXR0cmlidXRlT3B0aW9uLT5uYW1lKT8kYXR0cmlidXRlLT5hdHRyaWJ1dGVPcHRpb24tPm5hbWU6JycpKTsKCQkJfQoJCX0KCX0KCXJldHVybiBpc3NldCgkb3B0aW9uc1swXSkgPyAnKCcuaW1wbG9kZSgnLCAnLCAkb3B0aW9ucykuJyknIDogJyc7Cn0KCmZ1bmN0aW9uIHNlbGVjdGVkUHJvZHVjdEF0dHJpYnV0ZXMoJHByb2R1Y3RfaWQsICRhdHRyaWJ1dGVPcHRpb25zKXsKCSRwcm9kdWN0QXR0cmlidXRlcyA9IFByb2R1Y3RBdHRyaWJ1dGU6OndoZXJlKCdwcm9kdWN0X2lkJywgJHByb2R1Y3RfaWQpLT5vcmRlckJ5KCdzZXJpYWxfbm8nLCAnYXNjJyktPmdldCgpOwoJJGRhdGEgPSAnJzsKCWlmKGlzc2V0KCRwcm9kdWN0QXR0cmlidXRlc1swXSkpewoJCWZvcmVhY2goJHByb2R1Y3RBdHRyaWJ1dGVzIGFzICRrZXkgPT4gJGF0dHJpYnV0ZSl7CgkJCSRkYXRhIC49ICgka2V5ID4gMCA/ICcsICcgOiAnJyk7CgkJCSRkYXRhIC49IChpbl9hcnJheSgkYXR0cmlidXRlLT5hdHRyaWJ1dGVfb3B0aW9uX2lkLCAkYXR0cmlidXRlT3B0aW9ucykgPyAnPHN0cm9uZz4nLihpc3NldCgkYXR0cmlidXRlLT5hdHRyaWJ1dGVPcHRpb24tPmF0dHJpYnV0ZS0+Y29kZSk/JGF0dHJpYnV0ZS0+YXR0cmlidXRlT3B0aW9uLT5hdHRyaWJ1dGUtPmNvZGU6JycpLic6Jy4oaXNzZXQoJGF0dHJpYnV0ZS0+YXR0cmlidXRlT3B0aW9uLT5uYW1lKT8kYXR0cmlidXRlLT5hdHRyaWJ1dGVPcHRpb24tPm5hbWU6JycpLic8L3N0cm9uZz4nIDogKGlzc2V0KCRhdHRyaWJ1dGUtPmF0dHJpYnV0ZU9wdGlvbi0+bmFtZSk/JGF0dHJpYnV0ZS0+YXR0cmlidXRlT3B0aW9uLT5uYW1lOicnKSk7CgkJfQoJfQoKCXJldHVybiAkZGF0YTsKfQoKZnVuY3Rpb24gdW5pdE5hbWUoJGlkKXsKCXJldHVybiBcQXBwXE1vZGVsc1xIclxVbml0Ojp3aGVyZSgnaHJfdW5pdF9pZCcsJGlkKS0+Zmlyc3QoKTsKfQoKZnVuY3Rpb24gdW5yZWFkTm90aWZpY2F0aW9uKCl7CglyZXR1cm4gTm90aWZpY2F0aW9uOjp3aGVyZSgndXNlcl9pZCcsYXV0aCgpLT51c2VyKCktPmlkKQoJLT53aGVyZSgndHlwZScsJ3VucmVhZCcpCgktPm9yZGVyQnkoJ2lkJywgJ2Rlc2MnKQoJLT5nZXQoKTsKfQoKLy8gZnVuY3Rpb24gQ3JlYXRlT3JVcGRhdGVOb3RpZmljYXRpb24oJG1lc3NhZ2VzLCAkdHlwZSwgJHN0YXR1cz1udWxsLCAkaXRlbV9pZD1udWxsLCAkdXNlcl9pZD1udWxsLCAkaWQgPSAwKXsKLy8gCWlmKCR1c2VyX2lkID4gMCl7Ci8vIAkJJG1vZGVsID0gTm90aWZpY2F0aW9uOjpmaW5kKCRpZCk7Ci8vIAkJaWYoaXNzZXQoJG1vZGVsLT5pZCkpewovLyAJCQkkbW9kZWwtPnVzZXJfaWQgPSAkbW9kZWwtPnVzZXJfaWQ7Ci8vIAkJCSRtb2RlbC0+cmVxdWlzaXRpb25faXRlbV9pZCA9ICRpdGVtX2lkOwovLyAJCQkkbW9kZWwtPm1lc3NhZ2VzID0gJG1lc3NhZ2VzOwovLyAJCQkkbW9kZWwtPnR5cGUgPSAkdHlwZTsKLy8gCQkJJG1vZGVsLT5zdGF0dXMgPSAkc3RhdHVzOwovLyAJCQkkbW9kZWwtPnNhdmUoKTsKLy8gCQl9ZWxzZXsKLy8gCQkJJG1vZGVsID0gbmV3IE5vdGlmaWNhdGlvbigpOwovLyAJCQkkbW9kZWwtPnVzZXJfaWQgPSAkdXNlcl9pZDsKLy8gCQkJJG1vZGVsLT5yZXF1aXNpdGlvbl9pdGVtX2lkID0gJGl0ZW1faWQ7Ci8vIAkJCSRtb2RlbC0+bWVzc2FnZXMgPSAkbWVzc2FnZXM7Ci8vIAkJCSRtb2RlbC0+dHlwZSA9ICR0eXBlOwovLyAJCQkkbW9kZWwtPnN0YXR1cyA9ICRzdGF0dXM7Ci8vIAkJCSRtb2RlbC0+c2F2ZSgpOwovLyAJCX0KCi8vIAkJcmV0dXJuICRtb2RlbDsKLy8gCX0KCQovLyAJcmV0dXJuIGZhbHNlOwovLyB9CgpmdW5jdGlvbiBDcmVhdGVPclVwZGF0ZU5vdGlmaWNhdGlvbiggJG1lc3NhZ2VzLCAkdHlwZSwgJGl0ZW1faWQ9bnVsbCwgJHVzZXJfaWQ9bnVsbCwgJHN0YXR1cz1udWxsLCAkaWQgPSAwKXsKCWlmKCR1c2VyX2lkID4gMCl7CgkJJG5vdGlmaWNhdGlvbiA9IE5vdGlmaWNhdGlvbjo6ZmluZCgkaWQpOwoJCSRtb2RlbCA9ICRub3RpZmljYXRpb24gPyAkbm90aWZpY2F0aW9uIDogbmV3IE5vdGlmaWNhdGlvbigpOwoJCSRtb2RlbC0+dXNlcl9pZCA9ICRtb2RlbC0+dXNlcl9pZCA/ICRtb2RlbC0+dXNlcl9pZCA6ICR1c2VyX2lkOwoJCSRtb2RlbC0+cmVxdWlzaXRpb25faXRlbV9pZCA9ICRpdGVtX2lkOwoJCSRtb2RlbC0+bWVzc2FnZXMgPSAkbWVzc2FnZXM7CgkJJG1vZGVsLT50eXBlID0gJHR5cGU7CgkJJG1vZGVsLT5zdGF0dXMgPSAkc3RhdHVzOwoJCSRtb2RlbC0+c2F2ZSgpOwoJCXJldHVybiAkbW9kZWw7Cgl9CgkKCXJldHVybiBmYWxzZTsKfQoKCgoKZnVuY3Rpb24gY2hlY2tQb0F0dGFjaG1lbnQoJHBvX2lkLCAkYmlsbF90eXBlPW51bGwsICRncm5faWQ9bnVsbCl7CgkkcG8gPSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VcUHVyY2hhc2VPcmRlcjo6ZmluZE9yRmFpbCgkcG9faWQpOwoJaWYoJHBvLT5pc19jbG9zZWQgPT0gMCl7CgkJJG5vbkJpbGxlZCA9IFxBcHBcTW9kZWxzXFBtc01vZGVsc1xHcm5cR29vZHNSZWNlaXZlZE5vdGU6OndoZXJlRG9lc250SGF2ZSgncmVsUG9BdHRhY2htZW50JywgZnVuY3Rpb24oJHF1ZXJ5KXsKCQkJcmV0dXJuICRxdWVyeS0+d2hlcmVJbignc3RhdHVzJywgWydhcHByb3ZlZCddKS0+d2hlcmUoJ2JpbGxfdHlwZScsJ3BvJyk7IAoJCX0pCgkJLT53aGVyZSgncHVyY2hhc2Vfb3JkZXJfaWQnLCAkcG9faWQpCgkJLT5jb3VudCgpOwoJCWlmKCRub25CaWxsZWQgPiAwKXsKCQkJJGNvdW50ID0gXEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXJBdHRhY2htZW50Ojp3aGVyZSgncHVyY2hhc2Vfb3JkZXJfaWQnLCRwb19pZCktPndoZXJlSW4oJ3N0YXR1cycsIFsncGVuZGluZycsJ2hhbHQnXSktPndoZXJlKCdiaWxsX3R5cGUnLCdwbycpLT5jb3VudCgpOwoKCQkJaWYgKCRjb3VudCA+IDApIHsKCQkJCXJldHVybiAoJGJpbGxfdHlwZSA9PSAicG8iID8gdHJ1ZSA6IChcQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VcUHVyY2hhc2VPcmRlckF0dGFjaG1lbnQ6OndoZXJlKCdwdXJjaGFzZV9vcmRlcl9pZCcsJHBvX2lkKS0+d2hlcmVJbignc3RhdHVzJywgWydwZW5kaW5nJywnYXBwcm92ZWQnXSktPndoZXJlKCdiaWxsX3R5cGUnLCdwbycpLT5jb3VudCgpID49IDEgPyBmYWxzZSA6IHRydWUpKTsKCQkJfWVsc2V7CgkJCQlyZXR1cm4gKFxBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVyQXR0YWNobWVudDo6d2hlcmUoJ3B1cmNoYXNlX29yZGVyX2lkJywkcG9faWQpLT53aGVyZUluKCdzdGF0dXMnLCBbJ3BlbmRpbmcnLCdhcHByb3ZlZCddKS0+d2hlcmUoJ2JpbGxfdHlwZScsJ3BvJyktPmNvdW50KCkgPj0gMSA/IGZhbHNlIDogdHJ1ZSk7CgkJCX0KCgkJCXJldHVybiB0cnVlOwoJCX0KCX0KCglyZXR1cm4gZmFsc2U7Cn0KCmZ1bmN0aW9uIGNoZWNrUG9Hcm5BdHRhY2htZW50KCRwb19pZCwgJGdybl9pZCl7CgkkcG8gPSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VcUHVyY2hhc2VPcmRlcjo6ZmluZE9yRmFpbCgkcG9faWQpOwoJaWYoJHBvLT5pc19jbG9zZWQgPT0gMCl7CgkJJGNvdW50ID0gXEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXJBdHRhY2htZW50Ojp3aGVyZSgncHVyY2hhc2Vfb3JkZXJfaWQnLCAkcG9faWQpCgkJLT53aGVyZSgnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcsICRncm5faWQpCgkJLT53aGVyZSgnc3RhdHVzJywnYXBwcm92ZWQnKQoJCS0+d2hlcmUoJ2JpbGxfdHlwZScsJ2dybicpCgkJLT5jb3VudCgpOwoKCQlyZXR1cm4gKCRjb3VudCA+IDAgPyBmYWxzZSA6IHRydWUpOwoJfQoKCXJldHVybiBmYWxzZTsKfQoKCmZ1bmN0aW9uIGNhbGN1bGF0ZUdyblF0eUFnYWluc3RQdXJjaGFzZU9yZGVyKCRwdXJjaGFzZU9yZGVyKXsKCWZvcmVhY2ggKCRwdXJjaGFzZU9yZGVyIGFzICRrZXk9PiR2YWwpewoJCWlmIChpc3NldCgkdmFsLT5yZWxHb29kUmVjZWl2ZU5vdGUpKXsKCQkJJGdyblF0eSA9ICR2YWwtPnJlbEdvb2RSZWNlaXZlTm90ZS0+ZWFjaChmdW5jdGlvbiAoJGl0ZW0sJGkpewoJCQkJJGl0ZW1bJ2dybl9xdHknXT0gJGl0ZW0tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+c3VtKCdxdHknKTsKCQkJfSk7CgkJCSR2YWxbJ3RvdGFsX2dybl9xdHknXT0kdmFsLT5yZWxHb29kUmVjZWl2ZU5vdGUtPnN1bSgnZ3JuX3F0eScpOwoJCX0KCX0KCglyZXR1cm4gJHB1cmNoYXNlT3JkZXI7Cn0KCmZ1bmN0aW9uIHN0YXR1cygpewoJcmV0dXJuIGFycmF5KAoJCSJhY3RpdmUiPT4nQWN0aXZlJywKCQkiaW5hY3RpdmUiPT4nSW5hY3RpdmUnLAoJCSJjYW5jZWwiPT4nQ2FuY2VsJywKCSk7Cn0KCmZ1bmN0aW9uIHN0YXR1c0FycmF5KCl7CglyZXR1cm4gYXJyYXkoCgkJMCA9PiAiUGVuZGluZyIsCgkJMSA9PiAiQXBwcm92ZWQiLAoJCTIgPT4gIkhhbHQiLAoJKTsKfQoKZnVuY3Rpb24gcmVxdWlzaXRpb25TdGF0dXMoKXsKCXJldHVybiBhcnJheSgKCQkzID0+ICJEcmFmdCIsCgkJMCA9PiAiUGVuZGluZyIsCgkJMSA9PiAiQXBwcm92ZWQiLAoJKTsKfQoKZnVuY3Rpb24gc3RhdHVzQXJyYXlGb3JIZWFkKCl7CglyZXR1cm4gYXJyYXkoCgkJMCA9PiAiUGVuZGluZyIsCgkJMSA9PiAiQWNrbm93bGVkZ2UiLAoJCTIgPT4gIkhhbHQiLAoJKTsKfQoKZnVuY3Rpb24gc3RyaW5nU3RhdHVzQXJyYXkoJGF1ZGl0ZWQgPSBmYWxzZSl7CglpZigkYXVkaXRlZCl7CgkJcmV0dXJuIGFycmF5KAoJCQkncGVuZGluZycgPT4gIlBlbmRpbmciLAoJCQknYXVkaXRlZCcgPT4gIkFwcHJvdmVkIiwKCQkJJ2NhbmNlbGVkJyA9PiAiSGFsdCIsCgkJKTsKCX1lbHNlewoJCXJldHVybiBhcnJheSgKCQkJJ3BlbmRpbmcnID0+ICJQZW5kaW5nIiwKCQkJJ2FwcHJvdmVkJyA9PiAiQXBwcm92ZWQiLAoJCQknaGFsdCcgPT4gIkhhbHQiLAoJCSk7Cgl9Cn0KCmZ1bmN0aW9uIGRlbGl2ZXJ5U3RhdHVzKCl7CglyZXR1cm4gYXJyYXkoCgkJJ3Byb2Nlc3NpbmcnID0+ICJQcm9jZXNzaW5nIiwKCQknY29uZmlybWVkJyA9PiAiQ29uZmlybWVkIiwKCQkncHVyY2hhc2UnID0+ICJQdXJjaGFzZSIsCgkJJ2RlbGl2ZXJlZCcgPT4gIkRlbGl2ZXJlZCIsCgkJJ3BhcnRpYWwtZGVsaXZlcmVkJyA9PiAiUGVyY2lhbC1EZWxpdmVyeSIsCgkJJ2NlbmNlbCcgPT4gIkNlbmNlbCIsCgkpOwp9CgpmdW5jdGlvbiBtYXJpdGFsU3RhdHVzKCl7CglyZXR1cm4gYXJyYXkoCgkJJ1NpbmdsZScsCgkJJ01hcnJpZWQnLAoJCSdEaXZvcmNlZCcsCgkpOwp9CgpmdW5jdGlvbiBibG9vZEdyb3VwcygpewoJcmV0dXJuIGFycmF5KAoJCSdOL0EnLAoJCSdBKycsCgkJJ0EtJywKCQknQisnLAoJCSdCLScsCgkJJ08rJywKCQknTy0nLAoJCSdBQisnLAoJCSdBQi0nLAoJKTsKfQoKZnVuY3Rpb24gd2Vla0RheXMoKXsKCXJldHVybiBhcnJheSgKCQkiU2F0dXJkYXkiLAoJCSJTdW5kYXkiLAoJCSJNb25kYXkiLAoJCSJUdWVzZGF5IiwKCQkiV2VkbmVzZGF5IiwKCQkiVGh1cnNkYXkiLAoJCSJGcmlkYXkiLAoJKTsKfQoKZnVuY3Rpb24gd2Vla0RheXNJbmRleCgpewoJcmV0dXJuIGFycmF5KAoJCSJTYXR1cmRheSIgPT4gMCwKCQkiU3VuZGF5IiA9PiAxLAoJCSJNb25kYXkiID0+IDIsCgkJIlR1ZXNkYXkiID0+IDMsCgkJIldlZG5lc2RheSIgPT4gNCwKCQkiVGh1cnNkYXkiID0+IDUsCgkJIkZyaWRheSIgPT4gNiwKCSk7Cn0KCmZ1bmN0aW9uIGRheXNEaWZmZXJlbmNlKCRmcm9tLCAkdG8pCnsKCSRmcm9tID0gbmV3IERhdGVUaW1lKCRmcm9tKTsKCSR0byA9IG5ldyBEYXRlVGltZSgkdG8pOwoJJGRpZmZlcmVuY2UgPSAkZnJvbS0+ZGlmZigkdG8pOwoJcmV0dXJuICRkaWZmZXJlbmNlLT5kYXlzKzE7Cn0KCmZ1bmN0aW9uIG1pbnV0ZXNEaWZmZXJlbmNlKCRmcm9tLCR0bykKewoJJHN0YXJ0X2RhdGUgPSBuZXcgRGF0ZVRpbWUoJGZyb20pOwoJJHNpbmNlX3N0YXJ0ID0gJHN0YXJ0X2RhdGUtPmRpZmYobmV3IERhdGVUaW1lKCR0bykpOwoJJG1pbnV0ZXMgPSAkc2luY2Vfc3RhcnQtPmRheXMgKiAyNCAqIDYwOwoJJG1pbnV0ZXMgKz0gJHNpbmNlX3N0YXJ0LT5oICogNjA7CgkkbWludXRlcyArPSAkc2luY2Vfc3RhcnQtPmk7CglyZXR1cm4gJG1pbnV0ZXM7Cn0KCmZ1bmN0aW9uIHByaW1hcnlBcHByb3ZhbHMoKXsKCXJldHVybiBbCgkJWwoJCQknbmFtZScgPT4gJ1Byb2Nlc3NpbmcnLAoJCQknY2xhc3MnID0+ICd3YXJuaW5nJwoJCV0sCgkJWwoJCQknbmFtZScgPT4gJ0FwcHJvdmVkJywKCQkJJ2NsYXNzJyA9PiAnc3VjY2VzcycKCQldLAoJCVsKCQkJJ25hbWUnID0+ICdSZWplY3RlZCcsCgkJCSdjbGFzcycgPT4gJ2RhbmdlcicKCQldLAoJXTsKfQoKZnVuY3Rpb24gdW5pcXVlQ29kZSgkbGVuZ3RoLCRwcmVmaXgsJHRhYmxlLCRmaWVsZCl7CgkkcHJlZml4X2xlbmd0aCA9IHN0cmxlbigkcHJlZml4KTsKCSRtYXhfaWQgPSBEQjo6dGFibGUoJHRhYmxlKS0+bWF4KCRmaWVsZCk7CgkkbmV3ID0gKGludCkoJG1heF9pZCk7CgkkbmV3Kys7CgkkbnVtYmVyX29mX3plcm8gPSAkbGVuZ3RoLSRwcmVmaXhfbGVuZ3RoLXN0cmxlbigkbmV3KTsKCSR6ZXJvID0gc3RyX3JlcGVhdCgiMCIsICRudW1iZXJfb2ZfemVybyk7CgkkbWFkZV9pZCA9ICRwcmVmaXguJHplcm8uJG5ldzsKCXJldHVybiAkbWFkZV9pZDsKfQoKZnVuY3Rpb24gZW50cnlVbmlxdWVDb2RlKCRsZW5ndGgsJHByZWZpeCwkdGFibGUsJGZpZWxkKXsKCSRwcmVmaXhfbGVuZ3RoID0gc3RybGVuKCRwcmVmaXgpOwoJJG1heF9pZCA9IERCOjp0YWJsZSgkdGFibGUpLT53aGVyZShEQjo6cmF3KCdzdWJzdHIoYCcuJGZpZWxkLidgLCAxLCAnLnN0cmxlbigkcHJlZml4KS4nKScpLCAkcHJlZml4KS0+bWF4KCRmaWVsZCk7CgkkbmV3ID0gKGludCkoc3RyX3JlcGxhY2UoJHByZWZpeCwgJycsICRtYXhfaWQpKTsKCSRuZXcrKzsKCSRudW1iZXJfb2ZfemVybyA9ICRsZW5ndGgtJHByZWZpeF9sZW5ndGgtc3RybGVuKCRuZXcpOwoJJHplcm8gPSBzdHJfcmVwZWF0KCIwIiwgJG51bWJlcl9vZl96ZXJvKTsKCSRtYWRlX2lkID0gJHByZWZpeC4kemVyby4kbmV3OwoJcmV0dXJuICRtYWRlX2lkOwp9CgpmdW5jdGlvbiB1bmlxdWVDb2RlV2l0aG91dFByZWZpeCgkbGVuZ3RoLCR0YWJsZSwkZmllbGQpewoJJG1heCA9IERCOjp0YWJsZSgkdGFibGUpLT5tYXgoJGZpZWxkKTsKCSRuZXc9KGludCkoJG1heCk7CgkkbmV3Kys7CgkkbnVtYmVyX29mX3plcm89JGxlbmd0aC1zdHJsZW4oJG5ldyk7CgkkemVybz1zdHJfcmVwZWF0KCIwIiwgJG51bWJlcl9vZl96ZXJvIDwgMCA/IDAgOiAkbnVtYmVyX29mX3plcm8pOwoJJG1hZGVfaWQ9JHplcm8uJG5ldzsKCXJldHVybiAkbWFkZV9pZDsKfQoKCmZ1bmN0aW9uIHVuaXF1ZVN0cmluZ0dlbmVyYXRvcigpewoJJHMgPSAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXonOwoJJHMgPSBzdHJfc2h1ZmZsZSgkcyk7CgkkbCA9ICdBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWic7CgkkbCA9IHN0cl9zaHVmZmxlKCRsKTsKCSRzcGMgPSAnQF8jLSc7Cgkkc3BjID0gc3RyX3NodWZmbGUoJHNwYyk7CgkkbnVtID0gJzAxMjM0NTY3ODknOwoJJG51bSA9IHN0cl9zaHVmZmxlKCRudW0pOwoJcmV0dXJuICRudW0uc3Vic3RyKCRzcGMsMCwxKS5zdHJfc2h1ZmZsZShzdWJzdHIoJGwsMCwyKS5zdWJzdHIoJHMsMCwyKSkudGltZSgpOyAgCn0KCmZ1bmN0aW9uIHJhdGluZ0dlbmVyYXRlKCR0b3RhbFNjb3JlPScnLCR0b3RhbENvdW50PScnLCRpc1BkZj1mYWxzZSkKewoJaWYgKCR0b3RhbFNjb3JlID4gMCAmJiAkdG90YWxDb3VudCA+MCkgewoJCS8vJHRvdGFsTWF4RGVjaW5hbFNjb3JlID0gJHRvdGFsU2NvcmUvQ29sdW1uQ291bnQoJ3N1cHBsaWVyX3JhdHRpbmdzJyk7CgkJJGF2ZXJhZ2VSYXRpbmcgPSAkdG90YWxTY29yZS8kdG90YWxDb3VudDsKCX1lbHNlewoJCSRhdmVyYWdlUmF0aW5nID0gMC4wMDsKCX0KCgkkZm9ybWF0ZWRWYWwgPSBudW1iZXJfZm9ybWF0KCRhdmVyYWdlUmF0aW5nLDIpOwoJJHBpZWNlcyA9IGV4cGxvZGUoIi4iLCAkZm9ybWF0ZWRWYWwpOwoKCWlmICgkaXNQZGYpIHsKCQkkc3Rhcl9saXN0ID0gc3RyX3JlcGVhdCgnJiM5NzMzOycsIG51bWJlcl9mb3JtYXQoJHBpZWNlc1swXSkpOwoJfWVsc2V7CgoJCSRzdGFyX2xpc3QgPSBzdHJfcmVwZWF0KCc8aSBjbGFzcz0iZmEgZmEtc3RhciByYXRpbmctY29sb3IiIGFyaWEtaGlkZGVuPSJ0cnVlIj48L2k+JywgbnVtYmVyX2Zvcm1hdCgkcGllY2VzWzBdKSk7Cgl9CgoJaWYgKCRwaWVjZXNbMV0+MCkgewoJCSRoYWxmU3RhcnQgPSAoJGlzUGRmKT8gJyYjMTAwMzE7JyA6ICc8aSBjbGFzcz0iZmEgZmEtc3Rhci1oYWxmLW8gcmF0aW5nLWNvbG9yIiBhcmlhLWhpZGRlbj0idHJ1ZSI+PC9pPic7Cgl9ZWxzZXsKCQkkaGFsZlN0YXJ0PScnOwoJfQoKCSRibGFua1N0YXI9KDUtJGZvcm1hdGVkVmFsKTsKCgkkcHJpbnRSYXRpbmc9Jyc7CgoJZm9yKCRqPTE7ICRqIDw9JGJsYW5rU3RhcjskaisrKXsKCQkkcHJpbnRSYXRpbmcgLj0oJGlzUGRmKT8gJyYjOTczNDsnOic8aSBjbGFzcz0iZmEgZmEtc3RhciI+PC9pPic7Cgl9CgkKCXJldHVybiAkc3Rhcl9saXN0LicnLiRoYWxmU3RhcnQuJycuJHByaW50UmF0aW5nOwp9CgpmdW5jdGlvbiBzaW5nbGVSYXRpbmdHZW5lcmF0ZSgkdG90YWxTY29yZT0nJywkdG90YWxDb3VudD0nJykKewoJaWYgKCR0b3RhbFNjb3JlID4gMCAmJiAkdG90YWxDb3VudCA+MCkgewoJCSRhdmVyYWdlUmF0aW5nID0gJHRvdGFsU2NvcmUvJHRvdGFsQ291bnQ7Cgl9ZWxzZXsKCQkkYXZlcmFnZVJhdGluZyA9IDAuMDA7Cgl9CgoJJGZvcm1hdGVkVmFsID0gbnVtYmVyX2Zvcm1hdCgkYXZlcmFnZVJhdGluZywyKTsKCSRwaWVjZXMgPSBleHBsb2RlKCIuIiwgJGZvcm1hdGVkVmFsKTsKCgkkc3Rhcl9saXN0ID0gc3RyX3JlcGVhdCgnPGkgY2xhc3M9ImZhIGZhLXN0YXIgcmF0aW5nLWNvbG9yIiBhcmlhLWhpZGRlbj0idHJ1ZSI+PC9pPicsIG51bWJlcl9mb3JtYXQoJHBpZWNlc1swXSkpOwoKCWlmICgkcGllY2VzWzFdPjApIHsKCQkkaGFsZlN0YXJ0ID0gJzxpIGNsYXNzPSJmYSBmYS1zdGFyLWhhbGYtbyByYXRpbmctY29sb3IiIGFyaWEtaGlkZGVuPSJ0cnVlIj48L2k+JzsKCX1lbHNlewoJCSRoYWxmU3RhcnQ9Jyc7Cgl9CgoJJGJsYW5rU3Rhcj0oNS0kZm9ybWF0ZWRWYWwpOwoKCSRwcmludFJhdGluZz0nJzsKCglmb3IoJGo9MTsgJGogPD0kYmxhbmtTdGFyOyRqKyspewoJCSRwcmludFJhdGluZyAuPSc8aSBjbGFzcz0iZmEgZmEtc3RhciI+PC9pPic7Cgl9CgoJcmV0dXJuICRzdGFyX2xpc3QuJycuJGhhbGZTdGFydC4nJy4kcHJpbnRSYXRpbmc7Cn0KCmZ1bmN0aW9uIENvbHVtbkNvdW50KCR0YWJsZSkKewoJJGNvbHVtbiA9IGNvdW50KFxJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xTY2hlbWE6OmdldENvbHVtbkxpc3RpbmcoJHRhYmxlKSk7CglyZXR1cm4gJHJlbW92ZUV4dHJhQ29sdW1uPSRjb2x1bW4tMTA7Cn0KCgpmdW5jdGlvbiBzdXBwbGllclBheW1lbnRUZXJtKCl7CgoJcmV0dXJuIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xQYXltZW50VGVybTo6c2VsZWN0KCd0ZXJtJywnaWQnKS0+Z2V0KCk7Cn0KCmZ1bmN0aW9uIHN1cHBsaWVyUmVjZWl2ZWRUZXJtKCl7CglyZXR1cm4gWwoJCSdwYXJ0aWFsJz0+J1BhcnRpYWwgUmVjZWl2ZWQnLAoJCSdmdWxsJz0+J0Z1bGwgUmVjZWl2ZWQnLAoJXTsKfQoKZnVuY3Rpb24gc3VwcGxpZXJDcml0ZXJpYSgkc3VwcGxpZXIpCnsKCSRkYXRhID0gSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcU2NoZW1hOjpnZXRDb2x1bW5MaXN0aW5nKCdzdXBwbGllcl9yYXR0aW5ncycpOwoJJGRlbGV0ZURlZmF1bHQgPSBbMCwxLDksMTAsMTEsMTIsMTMsMTQsMTUsMTZdOwoJJGtleXMgPSBhcnJheV9kaWZmKGFycmF5X2tleXMoJGRhdGEpLCRkZWxldGVEZWZhdWx0KTsKCSRjb2x1bW5zID0gW107CgkkbG9vcD0wOwoJZm9yZWFjaCAoJGtleXMgYXMgJGk9PiAkdmFsdWUpewoJCSRsb29wKys7CgkJJHN1cHBsaWVyRGF0YSA9IChvYmplY3QpWwoJCQknbmFtZScgPT4gdWN3b3JkcyhzdHJfcmVwbGFjZSgnXycsJyAnLCRkYXRhWyR2YWx1ZV0pKSwKCQkJJ3JhdGluZycgPT4gc2luZ2xlUmF0aW5nR2VuZXJhdGUoJHN1cHBsaWVyLT5TdXBwbGllclJhdGluZ3MoKS0+c3VtKCRkYXRhWyR2YWx1ZV0pLCRzdXBwbGllci0+U3VwcGxpZXJSYXRpbmdzKCktPmNvdW50KCkpLAoJCQkncG9pbnQnID0+IG51bWJlcl9mb3JtYXQoKCRzdXBwbGllci0+U3VwcGxpZXJSYXRpbmdzKCktPnN1bSgkZGF0YVskdmFsdWVdKS8kc3VwcGxpZXItPlN1cHBsaWVyUmF0aW5ncygpLT5jb3VudCgpKSwyKQoJCV07CgkJJHZpZXcgPSAnPHRyPgoJCTx0aD4nLiRsb29wLic8L3RoPgoJCTx0ZD4nLiRzdXBwbGllckRhdGEtPm5hbWUuJzwvdGQ+CgkJPHRkPicuJHN1cHBsaWVyRGF0YS0+cmF0aW5nLic8L3RkPgoJCTx0ZD4nLiRzdXBwbGllckRhdGEtPnBvaW50Lic8L3RkPgoJCTwvdHI+JzsKCQkkY29sdW1uc1tdID0gJHZpZXc7Cgl9CglyZXR1cm4gaW1wbG9kZSgnICcsJGNvbHVtbnMpOwp9CgpmdW5jdGlvbiBzdXBwbGllckNyaXRlcmlhQ29sdW1ucygpewoJJGRhdGEgPSBcSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcU2NoZW1hOjpnZXRDb2x1bW5MaXN0aW5nKCdzdXBwbGllcl9yYXR0aW5ncycpOwoKCSRkZWxldGVEZWZhdWx0ID0gWzAsMSw5LDEwLDExLDEyLDEzLDE0LDE1LDE2LDE3LDE4LCAxOV07Cgkka2V5cyA9IGFycmF5X2RpZmYoYXJyYXlfa2V5cygkZGF0YSksJGRlbGV0ZURlZmF1bHQpOwoJJGNvbHVtbnMgPSBbXTsKCWZvcmVhY2ggKCRrZXlzIGFzICRrZXk9PiR2KXsKCQkkY29sdW1uc1ska2V5XT0gJGRhdGFbJHZdOwoJfQoKCXJldHVybiAkY29sdW1uczsKfQoKZnVuY3Rpb24gc3VwcGxpZXJPcGVuaW5nQmFsYW5jZSgkc3VwcGxpZXJfaWQsICRkYXRlID0gbnVsbCl7CgkkcXVlcnkgPSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcU3VwcGxpZXJMZWRnZXJzOjp3aGVyZSgnc3VwcGxpZXJfaWQnLCAkc3VwcGxpZXJfaWQpOwoKCXJldHVybiBbCgkJJ2RlYml0JyA9PiAkcXVlcnktPnN1bSgnZGViaXQnKSwKCQknY3JlZGl0JyA9PiAkcXVlcnktPnN1bSgnY3JlZGl0JyksCgkJJ2JhbGFuY2UnID0+ICgtMSokcXVlcnktPnN1bSgnZGViaXQnKSkrJHF1ZXJ5LT5zdW0oJ2NyZWRpdCcpLAoJXTsKfQoKZnVuY3Rpb24gY3VzdG9tZXJPcGVuaW5nQmFsYW5jZSgkY3VzdG9tZXJfaWQsICRkYXRlID0gbnVsbCl7CgkkcXVlcnkgPSBcQXBwXE1vZGVsc1xTYWxlc1xDdXN0b21lckxlZGdlcjo6d2hlcmUoJ2N1c3RvbWVyX2lkJywgJGN1c3RvbWVyX2lkKTsKCglyZXR1cm4gWwoJCSdkZWJpdCcgPT4gJHF1ZXJ5LT5zdW0oJ2RlYml0JyksCgkJJ2NyZWRpdCcgPT4gJHF1ZXJ5LT5zdW0oJ2NyZWRpdCcpLAoJCSdiYWxhbmNlJyA9PiAoLTEqJHF1ZXJ5LT5zdW0oJ2RlYml0JykpKyRxdWVyeS0+c3VtKCdjcmVkaXQnKSwKCV07Cn0KCmZ1bmN0aW9uIGRlbGl2ZXJhYmxlV2lzZUJ1ZGdldCgkcHJvamVjdF9pZCwgJGRlbGl2ZXJhYmxlX2lkKQp7CgkkdG90YWxDb3N0ID0gMDsKCSRjZHIgPSBbXTsKCS8vJHJlcXVpc2l0aW9ucyA9IFJlcXVpc2l0aW9uOjp3aGVyZShbJ3Byb2plY3RfaWQnID0+ICRwcm9qZWN0X2lkLCAnZGVsaXZlcmFibGVfaWQnID0+ICRkZWxpdmVyYWJsZV9pZF0pLT5nZXQoKTsKCgkkcmVxdWlzaXRpb25zID0gUmVxdWlzaXRpb246OndoZXJlSGFzKCdwcm9qZWN0VGFzay5zdWJEZWxpdmVyYWJsZS5kZWxpdmVyYWJsZScsIGZ1bmN0aW9uKCRxdWVyeSkgCgkJdXNlKCRwcm9qZWN0X2lkKXsgCgkJCXJldHVybiAkcXVlcnktPndoZXJlKCdwcm9qZWN0X2lkJywgJHByb2plY3RfaWQpOwogICAgICAgIH0pCgkJLT53aGVyZUhhcygncHJvamVjdFRhc2suc3ViRGVsaXZlcmFibGUuZGVsaXZlcmFibGUnLCBmdW5jdGlvbigkcXVlcnkpIAoJCXVzZSgkZGVsaXZlcmFibGVfaWQpeyAKCQkJcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lkJywgJGRlbGl2ZXJhYmxlX2lkKTsKICAgICAgICB9KS0+Z2V0KCk7CgoJaWYoJHJlcXVpc2l0aW9ucy0+Y291bnQoKSA+IDApIHsKCQlmb3JlYWNoICgkcmVxdWlzaXRpb25zIGFzICRyZXF1aXNpdGlvbikgewoJCQlmb3JlYWNoICgkcmVxdWlzaXRpb24tPnJlbFJlcXVpc2l0aW9uRGVsaXZlcnkgYXMgJGRlbGl2ZXJ5KSB7CgkJCQkkY2RyW10gPSAkZGVsaXZlcnktPnJlZmVyZW5jZV9ubzsKCQkJfQoJCX0KCQkkY2QgPSBhcnJheV91bmlxdWUoJGNkcik7CgkJJHRvdGFsQ29zdCA9IEludmVudG9yeUxvZ3M6OndoZXJlSW4oJ3JlZmVyZW5jZScsICRjZCktPnN1bSgndG90YWxfcHJpY2UnKTsKCX0KCXJldHVybiAkdG90YWxDb3N0Owp9CgpmdW5jdGlvbiBjb25zdW1lZEJ1ZGdldCgkcHJvamVjdF9pZCkKewoJJHRvdGFsQ29zdCA9IDA7CgkkY2RyID0gW107CgoJLy8kcmVxdWlzaXRpb25zID0gUmVxdWlzaXRpb246OndoZXJlKCdwcm9qZWN0X2lkJywgJHByb2plY3RfaWQpLT5nZXQoKTsKCSRyZXF1aXNpdGlvbnMgPSBSZXF1aXNpdGlvbjo6d2hlcmVIYXMoJ3Byb2plY3RUYXNrLnN1YkRlbGl2ZXJhYmxlLmRlbGl2ZXJhYmxlJywgZnVuY3Rpb24oJHF1ZXJ5KSAKCQl1c2UoJHByb2plY3RfaWQpeyAKCQkJcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3Byb2plY3RfaWQnLCAkcHJvamVjdF9pZCk7CiAgICAgICAgfSktPmdldCgpOwoKCWlmKCRyZXF1aXNpdGlvbnMtPmNvdW50KCkgPiAwKSB7CgkJZm9yZWFjaCAoJHJlcXVpc2l0aW9ucyBhcyAkcmVxdWlzaXRpb24pIHsKCQkJZm9yZWFjaCAoJHJlcXVpc2l0aW9uLT5yZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5IGFzICRkZWxpdmVyeSkgewoJCQkJJGNkcltdID0gJGRlbGl2ZXJ5LT5yZWZlcmVuY2Vfbm87CgkJCX0KCQl9CgkJJGNkID0gYXJyYXlfdW5pcXVlKCRjZHIpOwoJCSR0b3RhbENvc3QgPSBJbnZlbnRvcnlMb2dzOjp3aGVyZUluKCdyZWZlcmVuY2UnLCAkY2QpLT5zdW0oJ3RvdGFsX3ByaWNlJyk7Cgl9CglyZXR1cm4gJHRvdGFsQ29zdDsKfQoKZnVuY3Rpb24gZG93bmxvYWRQREYoJG5hbWUsJGRhdGEsJHZpZXcsJHBhcGVyLCRvcmllbnRhdGlvbil7CglyZXR1cm4gXFBERjo6bG9hZFZpZXcoJHZpZXcsICRkYXRhKS0+c2V0UGFwZXIoJHBhcGVyLCAkb3JpZW50YXRpb24pLT5zZXRPcHRpb25zKFsnZGVmYXVsdEZvbnQnID0+ICdzYW5zLXNlcmlmJ10pLT5zZXRPcHRpb25zKGFycmF5KCdpc1JlbW90ZUVuYWJsZWQnID0+IHRydWUpKS0+c2V0T3B0aW9ucyhhcnJheSgnRE9NUERGX0VOQUJMRV9DU1NfRkxPQVQgJyA9PiB0cnVlKSktPmRvd25sb2FkKCRuYW1lLictKCcuZGF0ZSgnRiBqLFkgZzppIGEnKS4nKS5wZGYnKTsKfQoKZnVuY3Rpb24gZG93bmxvYWRFeGNlbCgkdmlldywgJGRhdGEsICRuYW1lLCAkdHlwZSA9ICd4bHN4Jyl7CiAgICByZXR1cm4gXEV4Y2VsOjpkb3dubG9hZChuZXcgXEFwcFxFeHBvcnRzXEV4Y2VsKCR2aWV3LCAkZGF0YSksICRuYW1lLicoJy5kYXRlKCdGIGosWSBnOmkgYScpLicpJy4nLicuJHR5cGUpOwp9CgpmdW5jdGlvbiBnZXREZXBhcnRtZW50SGVhZCgkdXNlcl9pZCl7CgkkdXNlciA9IFVzZXI6OmZpbmQoJHVzZXJfaWQpOwoJJHVzZXJzID0gVXNlcjo6d2hlcmVIYXMoJ2VtcGxveWVlJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHVzZXIpewoJCXJldHVybiAkcXVlcnktPndoZXJlKCdhc191bml0X2lkJywgJHVzZXItPmVtcGxveWVlLT5hc191bml0X2lkKQoJCS0+d2hlcmUoJ2FzX2RlcGFydG1lbnRfaWQnLCAkdXNlci0+ZW1wbG95ZWUtPmFzX2RlcGFydG1lbnRfaWQpOwoJfSktPmdldCgpOwoKCSRoZWFkcyA9IFtdOwoJaWYoaXNzZXQoJHVzZXJzWzBdKSl7CgkJZm9yZWFjaCgkdXNlcnMgYXMgJHVzZXIpewoJCQlpZigkdXNlci0+aGFzUm9sZSgnRGVwYXJ0bWVudC1IZWFkJykpewoJCQkJYXJyYXlfcHVzaCgkaGVhZHMsICR1c2VyLT5pZCk7CgkJCX0KCQl9Cgl9CgoJJHVzZXJEYXRhID0gVXNlcjo6d2hlcmVJbignaWQnLCAkaGVhZHMpLT53aGVyZUhhcygnZW1wbG95ZWUnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkdXNlcil7CgkJcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2FzX3VuaXRfaWQnLCAkdXNlci0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpCgkJLT53aGVyZSgnYXNfZGVwYXJ0bWVudF9pZCcsICR1c2VyLT5lbXBsb3llZS0+YXNfZGVwYXJ0bWVudF9pZCk7Cgl9KS0+Zmlyc3QoKTsKCglyZXR1cm4gaXNzZXQoJHVzZXJEYXRhLT5pZCkgPyAkdXNlckRhdGEtPmlkIDogMDsKfQoKZnVuY3Rpb24gZ2V0TWFuYWdlckluZm8oJHJvbGVzX25hbWUsJHVuaXRfaWQ9bnVsbCkKewoJJHN1cGVyUGVybWlzc2lvbj1bJ1B1cmNoYXNlLURlcGFydG1lbnQnLCdNYW5hZ2VtZW50JywnQmlsbGluZycsJ0F1ZGl0JywnQWNjb3VudHMnLCdHYXRlIFBlcm1pc3Npb24nLCdRdWFsaXR5LUVuc3VyZScsICdTdG9yZS1NYW5hZ2VyJywgJ1NCVSBIZWFkJywnU3BvbnNvciddOwoKCWlmKGluX2FycmF5KCRyb2xlc19uYW1lLCRzdXBlclBlcm1pc3Npb24pKXsKCQkkdXNlcnM9VXNlcjo6d2hlbighZW1wdHkoJHVuaXRfaWQpLGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgkdW5pdF9pZCl7CgkJCXJldHVybiAkcXVlcnktPndoZXJlSGFzKCdwcmlvcml0aWVzJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCR1bml0X2lkKXsKCQkJCXJldHVybiAkcXVlcnktPndoZXJlKCdocl91bml0X2lkJywgJHVuaXRfaWQpOwoJCQl9KTsKCQl9KS0+Z2V0KCk7Cgl9ZWxzZXsKCQkkdXNlcnM9VXNlcjo6d2hlbihpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpLGZ1bmN0aW9uICgkcXVlcnkpewoJCQlyZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncHJpb3JpdGllcycsIGZ1bmN0aW9uICgkcXVlcnkpewoJCQkJcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX3VuaXRfaWQnLCBhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpCgkJCQktPndoZXJlKCdocl9kZXBhcnRtZW50X2lkJywgYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc19kZXBhcnRtZW50X2lkKTsKCQkJfSk7CgkJfSktPmdldCgpOwoJfQoJCgkkaGVhZHMgPSBbXTsKCWlmKGlzc2V0KCR1c2Vyc1swXSkpewoJCWZvcmVhY2goJHVzZXJzIGFzICR1c2VyKXsKCQkJaWYoJHVzZXItPmhhc1JvbGUoJHJvbGVzX25hbWUpKXsKCQkJCWFycmF5X3B1c2goJGhlYWRzLCAkdXNlci0+aWQpOwoJCQl9CgkJfQoJfQoKCSR1c2VyRGF0YT1Vc2VyOjp3aGVyZUluKCdpZCcsICRoZWFkcyktPmZpcnN0KCk7CgkKCXJldHVybiBpc3NldCgkdXNlckRhdGEtPmlkKSA/ICR1c2VyRGF0YS0+aWQgOiAwOwp9CgpmdW5jdGlvbiBnZXREZXBhcnRtZW50SGVhZEluZm8oJHVuaXRfaWQsICRkZXBhcnRtZW50X2lkKQp7CgkkdXNlcnMgPSBVc2VyOjp3aGVyZUhhcygncHJpb3JpdGllcycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgkdW5pdF9pZCwgJGRlcGFydG1lbnRfaWQpewoJCQlyZXR1cm4gJHF1ZXJ5LT53aGVyZShbCgkJCQknaHJfdW5pdF9pZCcgPT4gJHVuaXRfaWQsCgkJCQknaHJfZGVwYXJ0bWVudF9pZCcgPT4gJGRlcGFydG1lbnRfaWQsCgkJCV0pOwoJfSktPmdldCgpOwoJCgkkaGVhZHMgPSBbXTsKCWlmKGlzc2V0KCR1c2Vyc1swXSkpewoJCWZvcmVhY2goJHVzZXJzIGFzICR1c2VyKXsKCQkJaWYoJHVzZXItPmhhc1JvbGUoJ0RlcGFydG1lbnQtSGVhZCcpKXsKCQkJCWFycmF5X3B1c2goJGhlYWRzLCAkdXNlci0+aWQpOwoJCQl9CgkJfQoJfQoKCSR1c2VyRGF0YSA9IFVzZXI6OndoZXJlSW4oJ2lkJywgJGhlYWRzKS0+Zmlyc3QoKTsKCQoJcmV0dXJuIGlzc2V0KCR1c2VyRGF0YS0+aWQpID8gJHVzZXJEYXRhLT5pZCA6IDA7Cn0KCmZ1bmN0aW9uIGluV29yZCgkbnVtYmVyKSB7CiAgICAkaHlwaGVuICAgICAgPSAnLSc7CiAgICAkY29uanVuY3Rpb24gPSAnIGFuZCAnOwogICAgJHNlcGFyYXRvciAgID0gJywgJzsKICAgICRuZWdhdGl2ZSAgICA9ICduZWdhdGl2ZSAnOwogICAgJGRlY2ltYWwgICAgID0gJyBwb2ludCAnOwogICAgJGRpY3Rpb25hcnkgID0gYXJyYXkoCiAgICAgICAgMCAgICAgICAgICAgICAgICAgICA9PiAnemVybycsCiAgICAgICAgMSAgICAgICAgICAgICAgICAgICA9PiAnb25lJywKICAgICAgICAyICAgICAgICAgICAgICAgICAgID0+ICd0d28nLAogICAgICAgIDMgICAgICAgICAgICAgICAgICAgPT4gJ3RocmVlJywKICAgICAgICA0ICAgICAgICAgICAgICAgICAgID0+ICdmb3VyJywKICAgICAgICA1ICAgICAgICAgICAgICAgICAgID0+ICdmaXZlJywKICAgICAgICA2ICAgICAgICAgICAgICAgICAgID0+ICdzaXgnLAogICAgICAgIDcgICAgICAgICAgICAgICAgICAgPT4gJ3NldmVuJywKICAgICAgICA4ICAgICAgICAgICAgICAgICAgID0+ICdlaWdodCcsCiAgICAgICAgOSAgICAgICAgICAgICAgICAgICA9PiAnbmluZScsCiAgICAgICAgMTAgICAgICAgICAgICAgICAgICA9PiAndGVuJywKICAgICAgICAxMSAgICAgICAgICAgICAgICAgID0+ICdlbGV2ZW4nLAogICAgICAgIDEyICAgICAgICAgICAgICAgICAgPT4gJ3R3ZWx2ZScsCiAgICAgICAgMTMgICAgICAgICAgICAgICAgICA9PiAndGhpcnRlZW4nLAogICAgICAgIDE0ICAgICAgICAgICAgICAgICAgPT4gJ2ZvdXJ0ZWVuJywKICAgICAgICAxNSAgICAgICAgICAgICAgICAgID0+ICdmaWZ0ZWVuJywKICAgICAgICAxNiAgICAgICAgICAgICAgICAgID0+ICdzaXh0ZWVuJywKICAgICAgICAxNyAgICAgICAgICAgICAgICAgID0+ICdzZXZlbnRlZW4nLAogICAgICAgIDE4ICAgICAgICAgICAgICAgICAgPT4gJ2VpZ2h0ZWVuJywKICAgICAgICAxOSAgICAgICAgICAgICAgICAgID0+ICduaW5ldGVlbicsCiAgICAgICAgMjAgICAgICAgICAgICAgICAgICA9PiAndHdlbnR5JywKICAgICAgICAzMCAgICAgICAgICAgICAgICAgID0+ICd0aGlydHknLAogICAgICAgIDQwICAgICAgICAgICAgICAgICAgPT4gJ2ZvdXJ0eScsCiAgICAgICAgNTAgICAgICAgICAgICAgICAgICA9PiAnZmlmdHknLAogICAgICAgIDYwICAgICAgICAgICAgICAgICAgPT4gJ3NpeHR5JywKICAgICAgICA3MCAgICAgICAgICAgICAgICAgID0+ICdzZXZlbnR5JywKICAgICAgICA4MCAgICAgICAgICAgICAgICAgID0+ICdlaWdodHknLAogICAgICAgIDkwICAgICAgICAgICAgICAgICAgPT4gJ25pbmV0eScsCiAgICAgICAgMTAwICAgICAgICAgICAgICAgICA9PiAnaHVuZHJlZCcsCiAgICAgICAgMTAwMCAgICAgICAgICAgICAgICA9PiAndGhvdXNhbmQnLAogICAgICAgIDEwMDAwMDAgICAgICAgICAgICAgPT4gJ21pbGxpb24nLAogICAgICAgIDEwMDAwMDAwMDAgICAgICAgICAgPT4gJ2JpbGxpb24nLAogICAgICAgIDEwMDAwMDAwMDAwMDAgICAgICAgPT4gJ3RyaWxsaW9uJywKICAgICAgICAxMDAwMDAwMDAwMDAwMDAwICAgID0+ICdxdWFkcmlsbGlvbicsCiAgICAgICAgMTAwMDAwMDAwMDAwMDAwMDAwMCA9PiAncXVpbnRpbGxpb24nCiAgICApOwoKICAgIGlmICghaXNfbnVtZXJpYygkbnVtYmVyKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBpZiAoKCRudW1iZXIgPj0gMCAmJiAoaW50KSAkbnVtYmVyIDwgMCkgfHwgKGludCkgJG51bWJlciA8IDAgLSBQSFBfSU5UX01BWCkgewogICAgICAgIC8vIG92ZXJmbG93CiAgICAgICAgdHJpZ2dlcl9lcnJvcigKICAgICAgICAgICAgJ1N5c3RlbSBvbmx5IGFjY2VwdHMgbnVtYmVycyBiZXR3ZWVuIC0nIC4gUEhQX0lOVF9NQVggLiAnIGFuZCAnIC4gUEhQX0lOVF9NQVgsCiAgICAgICAgICAgIEVfVVNFUl9XQVJOSU5HCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgaWYgKCRudW1iZXIgPCAwKSB7CiAgICAgICAgcmV0dXJuICRuZWdhdGl2ZSAuIGluV29yZChhYnMoJG51bWJlcikpOwogICAgfQoKICAgICRzdHJpbmcgPSAkZnJhY3Rpb24gPSBudWxsOwoKICAgIGlmIChzdHJwb3MoJG51bWJlciwgJy4nKSAhPT0gZmFsc2UpIHsKICAgICAgICBsaXN0KCRudW1iZXIsICRmcmFjdGlvbikgPSBleHBsb2RlKCcuJywgJG51bWJlcik7CiAgICB9CgogICAgc3dpdGNoICh0cnVlKSB7CiAgICAgICAgY2FzZSAkbnVtYmVyIDwgMjE6CiAgICAgICAgICAgICRzdHJpbmcgPSAkZGljdGlvbmFyeVskbnVtYmVyXTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAkbnVtYmVyIDwgMTAwOgogICAgICAgICAgICAkdGVucyAgID0gKChpbnQpICgkbnVtYmVyIC8gMTApKSAqIDEwOwogICAgICAgICAgICAkdW5pdHMgID0gJG51bWJlciAlIDEwOwogICAgICAgICAgICAkc3RyaW5nID0gJGRpY3Rpb25hcnlbJHRlbnNdOwogICAgICAgICAgICBpZiAoJHVuaXRzKSB7CiAgICAgICAgICAgICAgICAkc3RyaW5nIC49ICRoeXBoZW4gLiAkZGljdGlvbmFyeVskdW5pdHNdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJG51bWJlciA8IDEwMDA6CiAgICAgICAgICAgICRodW5kcmVkcyAgPSAkbnVtYmVyIC8gMTAwOwogICAgICAgICAgICAkcmVtYWluZGVyID0gJG51bWJlciAlIDEwMDsKICAgICAgICAgICAgJHN0cmluZyA9ICRkaWN0aW9uYXJ5WyRodW5kcmVkc10gLiAnICcgLiAkZGljdGlvbmFyeVsxMDBdOwogICAgICAgICAgICBpZiAoJHJlbWFpbmRlcikgewogICAgICAgICAgICAgICAgJHN0cmluZyAuPSAkY29uanVuY3Rpb24gLiBpbldvcmQoJHJlbWFpbmRlcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgJGJhc2VVbml0ID0gcG93KDEwMDAsIGZsb29yKGxvZygkbnVtYmVyLCAxMDAwKSkpOwogICAgICAgICAgICAkbnVtQmFzZVVuaXRzID0gKGludCkgKCRudW1iZXIgLyAkYmFzZVVuaXQpOwogICAgICAgICAgICAkcmVtYWluZGVyID0gJG51bWJlciAlICRiYXNlVW5pdDsKICAgICAgICAgICAgJHN0cmluZyA9IGluV29yZCgkbnVtQmFzZVVuaXRzKSAuICcgJyAuICRkaWN0aW9uYXJ5WyRiYXNlVW5pdF07CiAgICAgICAgICAgIGlmICgkcmVtYWluZGVyKSB7CiAgICAgICAgICAgICAgICAkc3RyaW5nIC49ICRyZW1haW5kZXIgPCAxMDAgPyAkY29uanVuY3Rpb24gOiAkc2VwYXJhdG9yOwogICAgICAgICAgICAgICAgJHN0cmluZyAuPSBpbldvcmQoJHJlbWFpbmRlcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICB9CgogICAgaWYgKG51bGwgIT09ICRmcmFjdGlvbiAmJiBpc19udW1lcmljKCRmcmFjdGlvbikpIHsKICAgICAgICAkc3RyaW5nIC49ICRkZWNpbWFsOwogICAgICAgICR3b3JkcyA9IGFycmF5KCk7CiAgICAgICAgZm9yZWFjaCAoc3RyX3NwbGl0KChzdHJpbmcpICRmcmFjdGlvbikgYXMgJG51bWJlcikgewogICAgICAgICAgICAkd29yZHNbXSA9ICRkaWN0aW9uYXJ5WyRudW1iZXJdOwogICAgICAgIH0KICAgICAgICAkc3RyaW5nIC49IGltcGxvZGUoJyAnLCAkd29yZHMpOwogICAgfQoKICAgIHJldHVybiB1Y2ZpcnN0KCRzdHJpbmcpOwp9CgpmdW5jdGlvbiBpbldvcmRCbigkbnVtYmVyLCAkdGFrYSA9IHRydWUsICRjdXJyZW5jeSA9ICd0YWthJywgJGN1cnJlbmN5X2h1bmRyZWRzID0gJ3BhaXNhJykgCnsgCiAgICBpZiAoKCRudW1iZXIgPCAwKSB8fCAoJG51bWJlciA+IDk5OTk5OTk5OTk5OSkpIHsgCiAgICAJcmV0dXJuICcnOwogICAgfQoKICAgICRmcmFjdGlvbiA9IG51bGw7CiAgICBpZiAoc3RycG9zKCRudW1iZXIsICcuJykgIT09IGZhbHNlKSB7CiAgICAgICAgbGlzdCgkbnVtYmVyLCAkZnJhY3Rpb24pID0gZXhwbG9kZSgnLicsICRudW1iZXIpOwogICAgfQoKICAgICRibCA9IGZsb29yKCRudW1iZXIgLyAxMDAwMDAwMDAwKTsgLyogYmlsbGlvbiAqLwogICAgJG51bWJlciAtPSAkYmwgKiAxMDAwMDAwMDsKICAgICRLdCA9IGZsb29yKCRudW1iZXIgLyAxMDAwMDAwMCk7IC8qIEtvdGkgKi8KICAgICRudW1iZXIgLT0gJEt0ICogMTAwMDAwMDA7CiAgICAkR24gPSBmbG9vcigkbnVtYmVyIC8gMTAwMDAwKTsgIC8qIGxha2ggICovIAogICAgJG51bWJlciAtPSAkR24gKiAxMDAwMDA7IAogICAgJGtuID0gZmxvb3IoJG51bWJlciAvIDEwMDApOyAgICAgLyogVGhvdXNhbmRzIChraWxvKSAqLyAKICAgICRudW1iZXIgLT0gJGtuICogMTAwMDsgCiAgICAkSG4gPSBmbG9vcigkbnVtYmVyIC8gMTAwKTsgICAgICAvKiBIdW5kcmVkcyAoaGVjdG8pICovIAogICAgJG51bWJlciAtPSAkSG4gKiAxMDA7IAogICAgJERuID0gZmxvb3IoJG51bWJlciAvIDEwKTsgICAgICAgLyogVGVucyAoZGVjYSkgKi8gCiAgICAkbiA9ICRudW1iZXIgJSAxMDsgICAgICAgICAgICAgICAvKiBPbmVzICovCgogICAgJHJlcyA9ICIiOyAKCiAgICBpZiAoJGJsKSB7IAogICAgICAgICRyZXMgLj0gaW5Xb3JkQm4oJGJsLCBmYWxzZSwgJGN1cnJlbmN5LCAkY3VycmVuY3lfaHVuZHJlZHMpIC4gIiBiaWxsaW9uICI7IAogICAgfSAKCiAgICBpZiAoJEt0KSB7IAogICAgICAgICRyZXMgLj0gaW5Xb3JkQm4oJEt0LCBmYWxzZSwgJGN1cnJlbmN5LCAkY3VycmVuY3lfaHVuZHJlZHMpIC4gIiBjb3JlICI7IAogICAgfSAKCiAgICBpZiAoJEduKSB7IAogICAgICAgICRyZXMgLj0gaW5Xb3JkQm4oJEduLCBmYWxzZSwgJGN1cnJlbmN5LCAkY3VycmVuY3lfaHVuZHJlZHMpIC4gIiBsYWMiOyAKICAgIH0gCgogICAgaWYgKCRrbikgeyAKICAgICAgICAkcmVzIC49IChlbXB0eSgkcmVzKSA/ICIiIDogIiAiKSAuIAogICAgICAgICAgICBpbldvcmRCbigka24sIGZhbHNlLCAkY3VycmVuY3ksICRjdXJyZW5jeV9odW5kcmVkcykgLiAiIFRob3VzYW5kIjsgCiAgICB9IAoKICAgIGlmICgkSG4pIHsgCiAgICAgICAgJHJlcyAuPSAoZW1wdHkoJHJlcykgPyAiIiA6ICIgIikgLiAKICAgICAgICAgICAgaW5Xb3JkQm4oJEhuLCBmYWxzZSwgJGN1cnJlbmN5LCAkY3VycmVuY3lfaHVuZHJlZHMpIC4gIiBIdW5kcmVkIjsgCiAgICB9IAoKICAgICRvbmVzID0gYXJyYXkoIiIsICJPbmUiLCAiVHdvIiwgIlRocmVlIiwgIkZvdXIiLCAiRml2ZSIsICJTaXgiLCAKICAgICAgICAiU2V2ZW4iLCAiRWlnaHQiLCAiTmluZSIsICJUZW4iLCAiRWxldmVuIiwgIlR3ZWx2ZSIsICJUaGlydGVlbiIsIAogICAgICAgICJGb3VydGVlbiIsICJGaWZ0ZWVuIiwgIlNpeHRlZW4iLCAiU2V2ZW50ZWVuIiwgIkVpZ2h0dGVlbiIsIAogICAgICAgICJOaW5ldGVlbiIpOyAKICAgICR0ZW5zID0gYXJyYXkoIiIsICIiLCAiVHdlbnR5IiwgIlRoaXJ0eSIsICJGb3VydHkiLCAiRmlmdHkiLCAiU2l4dHkiLCAKICAgICAgICAiU2V2ZW50eSIsICJFaWd0aHkiLCAiTmluZXR5Iik7IAoKICAgIGlmICgkRG4gfHwgJG4pIHsgCiAgICAgICAgaWYgKCFlbXB0eSgkcmVzKSkgeyAKICAgICAgICAgICAgJHJlcyAuPSAiICI7IAogICAgICAgIH0gCgogICAgICAgIGlmICgkRG4gPCAyKSB7IAogICAgICAgICAgICAkcmVzIC49ICRvbmVzWyREbiAqIDEwICsgJG5dOyAKICAgICAgICB9IGVsc2UgeyAKICAgICAgICAgICAgJHJlcyAuPSAkdGVuc1skRG5dOyAKICAgICAgICAgICAgaWYgKCRuKSB7IAogICAgICAgICAgICAgICAgJHJlcyAuPSAiLSIgLiAkb25lc1skbl07IAogICAgICAgICAgICB9IAogICAgICAgIH0gCiAgICB9IAoKICAgIGlmIChlbXB0eSgkcmVzKSl7IAogICAgICAgICRyZXMgPSAiemVybyI7IAogICAgfSAKCiAgICBpZigkdGFrYSl7CiAgICAJJHJlcyAuPSAnICcuJGN1cnJlbmN5LicgJzsKICAgIH0KCiAgICBpZiAobnVsbCAhPT0gJGZyYWN0aW9uICYmIGlzX251bWVyaWMoJGZyYWN0aW9uKSAmJiAkZnJhY3Rpb24gPiAwKSB7CiAgICAJJHJlcyAuPSAnIGFuZCAnOwogICAgCSRmcmFjdGlvbiA9IHN1YnN0cigkZnJhY3Rpb24sIDAsIDIpOwogICAgCSRmcmFjdGlvbiA9IHN0cmxlbigkZnJhY3Rpb24pID09IDEgPyAoaW50KSgkZnJhY3Rpb24pKjEwIDogKGludCkoJGZyYWN0aW9uKTsKICAgIAlpZigkZnJhY3Rpb24gPiAwKXsKICAgICAgICAJJHJlcyAuPSBpbldvcmRCbigkZnJhY3Rpb24sIGZhbHNlLCAkY3VycmVuY3ksICRjdXJyZW5jeV9odW5kcmVkcykuJyAnLiRjdXJyZW5jeV9odW5kcmVkczsKICAgIAl9CiAgICB9CgogICAgcmV0dXJuIHVjd29yZHMoc3RyX3JlcGxhY2UoJy0nLCAnICcsICRyZXMpKTsgCn0KCmZ1bmN0aW9uIHZpZXdNUERGKCR2aWV3LCAkZGF0YSwgJHRpdGxlLCAkZmlsZW5hbWUsICRmb3JtYXQgPSAnYTQnLCAkb3JpZW50YXRpb24gPSAnUCcpewoJXFBERjo6bG9hZFZpZXcoJHZpZXcsICRkYXRhLCBbXSwgWwogICAgICAndGl0bGUnICAgICAgPT4gJHRpdGxlLAogICAgICAnbWFyZ2luX3RvcCcgPT4gMCwKICAgICAgJ3Nob3dJbWFnZUVycm9ycycgPT4gdHJ1ZSwKICAgICAgJ2Zvcm1hdCcgPT4gJGZvcm1hdCwKICAgICAgJ29yaWVudGF0aW9uJyA9PiAkb3JpZW50YXRpb24sCiAgICAgIC8vJ3Nob3dfd2F0ZXJtYXJrX2ltYWdlJyA9PiB0cnVlLAogICAgICAvLydkaXNwbGF5X21vZGUnID0+ICdmdWxscGFnZScsCiAgICAgIC8vJ3dhdGVybWFya19pbWFnZV9wYXRoJyA9PiBwdWJsaWNfcGF0aCgnL2Fzc2V0cy9pZGNhcmQvbGV0dGVyaGVhZC9tYm1fbGV0dGVyaGVhZC5wbmcnKSwKICAgICAgLy8nd2F0ZXJtYXJrX2ltYWdlX3NpemUnICAgICAgID0+ICdEJywKICAgIF0pLT5zdHJlYW0oJGZpbGVuYW1lLicucGRmJyk7Cn0KCmZ1bmN0aW9uIG91dHB1dE1QREYoJHZpZXcsICRkYXRhLCAkdGl0bGUsICRmaWxlbmFtZSwgJGZvcm1hdCA9ICdhNCcsICRvcmllbnRhdGlvbiA9ICdQJyl7CglyZXR1cm4gXFBERjo6bG9hZFZpZXcoJHZpZXcsICRkYXRhLCBbXSwgWwogICAgICAndGl0bGUnICAgICAgPT4gJHRpdGxlLAogICAgICAnbWFyZ2luX3RvcCcgPT4gMCwKICAgICAgJ3Nob3dJbWFnZUVycm9ycycgPT4gdHJ1ZSwKICAgICAgJ2Zvcm1hdCcgPT4gJGZvcm1hdCwKICAgIF0pLT5vdXRwdXQoKTsKfQoKZnVuY3Rpb24gZG93bmxvYWRNUERGKCR2aWV3LCAkZGF0YSwgJHRpdGxlLCAkZmlsZW5hbWUsICRmb3JtYXQgPSAnYTQnLCAkb3JpZW50YXRpb24gPSAnUCcpewoJXFBERjo6bG9hZFZpZXcoJHZpZXcsICRkYXRhLCBbXSwgWwogICAgICAndGl0bGUnICAgICAgPT4gJHRpdGxlLAogICAgICAnbWFyZ2luX3RvcCcgPT4gMCwKICAgICAgJ3Nob3dJbWFnZUVycm9ycycgPT4gdHJ1ZSwKICAgICAgJ29yaWVudGF0aW9uJyA9PiAkb3JpZW50YXRpb24KICAgIF0pLT5kb3dubG9hZCgkZmlsZW5hbWUuJ18nLmRhdGUoJ1ktbS1kIGc6aSBhJykuJy5wZGYnKTsKfQoKZnVuY3Rpb24gcHJpbnRCYXJjb2RlKCRiYXJjb2RlLCAkc3R5bGU9JycsICRsZXR0ZXJfc3BhY2luZz0nMTJweCcpewoJcmV0dXJuICc8ZGl2IGNsYXNzPSJ0ZXh0LWNlbnRlciIgc3R5bGU9IicuJHN0eWxlLiciPgoJCTxpbWcgc3JjPSJkYXRhOmltYWdlL3BuZztiYXNlNjQsJy5ETlMxRDo6Z2V0QmFyY29kZVBORygkYmFyY29kZSwgJ0MzOScsMSwzMykuJyIgYWx0PSInLiRiYXJjb2RlLiciLz4KCQk8YnI+CgkJPHNwYW4gc3R5bGU9ImxldHRlci1zcGFjaW5nOiAnLiRsZXR0ZXJfc3BhY2luZy4nOyI+Jy4kYmFyY29kZS4nPC9zcGFuPgoJPC9kaXY+JzsKfQoKZnVuY3Rpb24gd29yZFJlc3RyaWN0aW9ucygpewoJJHdvcmRzID0gW107Cgkkcm9sZXMgPSBcU3BhdGllXFBlcm1pc3Npb25cTW9kZWxzXFJvbGU6OndoZXJlSW4oJ25hbWUnLCBhdXRoKCktPnVzZXIoKS0+Z2V0Um9sZU5hbWVzKCkpLT5nZXQoKTsKCWlmKGlzc2V0KCRyb2xlc1swXSkpewoJCWZvcmVhY2goJHJvbGVzIGFzICRrZXkgPT4gJHJvbGUpewoJCQkkcmVzdHJpY3Rpb25zID0gYXJyYXlfbWFwKGZ1bmN0aW9uKCR2YWx1ZSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RydG9sb3dlcigkdmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICB9LCBpc3NldChqc29uX2RlY29kZSgkcm9sZS0+d29yZF9yZXN0cmljdGlvbnMsIHRydWUpWzBdKSA/IGpzb25fZGVjb2RlKCRyb2xlLT53b3JkX3Jlc3RyaWN0aW9ucywgdHJ1ZSkgOiBbXSk7CgkJCWlmKGlzc2V0KCRyZXN0cmljdGlvbnNbMF0pKXsKCQkJCWZvcmVhY2goJHJlc3RyaWN0aW9ucyBhcyAka2V5ID0+ICRyZXN0cmljdGlvbil7CgkJCQkJYXJyYXlfcHVzaCgkd29yZHMsICRyZXN0cmljdGlvbik7CgkJCQl9CgkJCX0KCQl9Cgl9CgoJcmV0dXJuIGFycmF5X3VuaXF1ZSgkd29yZHMpOwp9CgoKCmZ1bmN0aW9uIGlzU3VwcGxpZXJSYXRpbmcoJGtleSwkdmFsdWUsICR0eXBlKQp7Cgkkc3VwcGxpZXJSYXRpbmdzPVN1cHBsaWVyUmF0aW5nczo6d2hlcmUoJ2tleScsICRrZXkpLT53aGVyZSgndmFsdWUnLCR2YWx1ZSktPndoZXJlKCd0eXBlJywkdHlwZSktPmZpcnN0KCk7CglpZihpc3NldCgkc3VwcGxpZXJSYXRpbmdzLT5pZCkpewoJCXJldHVybiB0cnVlOwoJfQoJcmV0dXJuIGZhbHNlOwp9CgpmdW5jdGlvbiByZXF1aXNpdGlvbkhhc1N0b2NrKCRyZXF1aXNpdGlvbl9pZCl7CgkkcmVxdWlzaXRpb24gPSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmVxdWlzaXRpb246OmZpbmQoJHJlcXVpc2l0aW9uX2lkKTsKCWlmKCFpc3NldCgkcmVxdWlzaXRpb24tPmlkKSl7CgkJcmV0dXJuIGZhbHNlOwoJfQoJCglpZigkcmVxdWlzaXRpb24tPmlzX3NlbmRfdG9fcmZwID09ICd5ZXMnKXsKCQkkc3RvY2tzID0gXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEdyblxHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW46OndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyLnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcmVxdWlzaXRpb24pewoJCQlyZXR1cm4gJHF1ZXJ5LT53aGVyZSgncmVxdWlzaXRpb25faWQnLCAkcmVxdWlzaXRpb24tPmlkKTsKCQl9KQoJCS0+c3VtKCdyZWNlaXZlZF9xdHknKTsKCQlpZigkc3RvY2tzIDw9IDApewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJfQoKCXJldHVybiB0cnVlOwp9CgpmdW5jdGlvbiBsYXRlc3RQcm9kdWN0UHJpY2VVcGRhdGUoJHByb2R1Y3RJZCwkdW5pdFByaWNlKXsKCSRwcm9kdWN0PVByb2R1Y3Q6OmZpbmRPckZhaWwoJHByb2R1Y3RJZCk7CglpZiAoaXNzZXQoJHByb2R1Y3QtPmlkKSkgewoJCSRwcm9kdWN0LT51cGRhdGUoWyd1bml0X3ByaWNlJz0+JHVuaXRQcmljZV0pOwoJCXJldHVybiB0cnVlOwoJfQoJcmV0dXJuIGZhbHNlOwp9CgpmdW5jdGlvbiBpbmNsdWRlVXNlcnMoKXsKCSR1c2VyVW5pdHMgPSBhdXRoKCktPnVzZXIoKS0+cHJpb3JpdGllcy0+cGx1Y2soJ2hyX3VuaXRfaWQnKS0+dG9BcnJheSgpOwoJJHVzZXJEZXBhcnRtZW50cyA9IGF1dGgoKS0+dXNlcigpLT5wcmlvcml0aWVzLT5wbHVjaygnaHJfZGVwYXJ0bWVudF9pZCcpLT50b0FycmF5KCk7CgkkdXNlclNlY3Rpb25zID0gYXV0aCgpLT51c2VyKCktPnByaW9yaXRpZXMtPnBsdWNrKCdocl9zZWN0aW9uX2lkJyktPnRvQXJyYXkoKTsKCglpZihhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnRGVwYXJ0bWVudC1IZWFkJykpewoJCXJldHVybiBcQXBwXFVzZXI6OndoZXJlTm90SW4oJ2lkJywgW2F1dGgoKS0+dXNlcigpLT5pZF0pCgkJLT53aGVyZUhhcygnZW1wbG95ZWUnLGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCR1c2VyVW5pdHMsICR1c2VyRGVwYXJ0bWVudHMsICR1c2VyU2VjdGlvbnMpewoJCQlyZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdhc191bml0X2lkJywgJHVzZXJVbml0cykKCQkJLT53aGVyZUluKCdhc19kZXBhcnRtZW50X2lkJywgJHVzZXJEZXBhcnRtZW50cyk7CgkJCS8vIC0+d2hlcmVJbignYXNfc2VjdGlvbl9pZCcsICR1c2VyU2VjdGlvbnMpOwogICAgICAgIH0pCgkJLT53aGVyZURvZXNudEhhdmUoJ21vZGVsSGFzUm9sZXMucm9sZScsIGZ1bmN0aW9uKCRxdWVyeSl7CgkJCXJldHVybiAkcXVlcnktPndoZXJlSW4oJ25hbWUnLCBbJ0RlcGFydG1lbnQtSGVhZCcsICdTQlUgSGVhZCcsICdNYW5hZ2VtZW50J10pOwoJCX0pCiAgICAgICAgLT5wbHVjaygnaWQnKS0+dG9BcnJheSgpOwoJfWVsc2VpZihhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnU0JVIEhlYWQnKSl7CgkJcmV0dXJuIFxBcHBcVXNlcjo6d2hlcmVOb3RJbignaWQnLCBbYXV0aCgpLT51c2VyKCktPmlkXSkKCQktPndoZXJlSGFzKCdlbXBsb3llZScsZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHVzZXJVbml0cyl7CgkJCXJldHVybiAkcXVlcnktPndoZXJlSW4oJ2FzX3VuaXRfaWQnLCAkdXNlclVuaXRzKTsKICAgICAgICB9KQogICAgICAgIC0+d2hlcmVIYXMoJ21vZGVsSGFzUm9sZXMucm9sZScsIGZ1bmN0aW9uKCRxdWVyeSl7CgkJCXJldHVybiAkcXVlcnktPndoZXJlKCduYW1lJywgJ0RlcGFydG1lbnQtSGVhZCcpOwoJCX0pCgkJLT5wbHVjaygnaWQnKS0+dG9BcnJheSgpOwoJfWVsc2V7CgkJcmV0dXJuIFxBcHBcVXNlcjo6d2hlcmVOb3RJbignaWQnLCBbYXV0aCgpLT51c2VyKCktPmlkXSkKCQktPndoZXJlSGFzKCdtb2RlbEhhc1JvbGVzLnJvbGUnLCBmdW5jdGlvbigkcXVlcnkpewoJCQlyZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCduYW1lJywgWydTQlUgSGVhZCcsICdNYW5hZ2VtZW50J10pOwoJCX0pLT5wbHVjaygnaWQnKS0+dG9BcnJheSgpOwoJfQoKCXJldHVybiBbXTsKfQoKZnVuY3Rpb24gZ2V0RHVyYXRpb24oJGZyb20sICR0byl7CiAgICAkZGF5cyA9IHJvdW5kKCgoc3RydG90aW1lKCR0bykgLSBzdHJ0b3RpbWUoJGZyb20pKSkgLyAoNjAgKiA2MCAqIDI0KSk7CiAgICByZXR1cm4gKCRkYXlzID49IDEgPyAoJGZyb20gPT0gJHRvID8gMSA6ICRkYXlzKzEpIDogMSk7Cn0KCmZ1bmN0aW9uIGdldFByb2dyZXNzRmFzdGVyKCR0YXNrcywgJG5lZWRsZXMgPSBbMCwgMCwgMCwgMF0pewoJJHRhc2tzID0gY29sbGVjdCgkdGFza3MpOwoKCWlmKCRuZWVkbGVzWzBdID4gMCl7CgkJJHRhc2tzID0gJHRhc2tzLT5maWx0ZXIoZnVuY3Rpb24gKCR0YXNrLCAka2V5KSB1c2UoJG5lZWRsZXMpIHsKCQkgICAgcmV0dXJuICR0YXNrLT5zdWJEZWxpdmVyYWJsZS0+ZGVsaXZlcmFibGUtPnByb2plY3RfaWQgPT0gJG5lZWRsZXNbMF07CgkJfSk7CgkJIAoJCSR0YXNrcy0+YWxsKCk7Cgl9CgoJaWYoJG5lZWRsZXNbMV0gPiAwKXsKCQkkdGFza3MgPSAkdGFza3MtPmZpbHRlcihmdW5jdGlvbiAoJHRhc2ssICRrZXkpIHVzZSgkbmVlZGxlcykgewoJCSAgICByZXR1cm4gJHRhc2stPnN1YkRlbGl2ZXJhYmxlLT5kZWxpdmVyYWJsZV9pZCA9PSAkbmVlZGxlc1sxXTsKCQl9KTsKCQkgCgkJJHRhc2tzLT5hbGwoKTsKCX0KCglpZigkbmVlZGxlc1syXSA+IDApewoJCSR0YXNrcyA9ICR0YXNrcy0+ZmlsdGVyKGZ1bmN0aW9uICgkdGFzaywgJGtleSkgdXNlKCRuZWVkbGVzKSB7CgkJICAgIHJldHVybiAkdGFzay0+c3ViX2RlbGl2ZXJhYmxlX2lkID09ICRuZWVkbGVzWzJdOwoJCX0pOwoJCSAKCQkkdGFza3MtPmFsbCgpOwoJfQoKCWlmKCRuZWVkbGVzWzNdID4gMCl7CgkJJHRhc2tzID0gJHRhc2tzLT5maWx0ZXIoZnVuY3Rpb24gKCR0YXNrLCAka2V5KSB1c2UoJG5lZWRsZXMpIHsKCQkgICAgcmV0dXJuICR0YXNrLT5pZCA9PSAkbmVlZGxlc1szXTsKCQl9KTsKCQkgCgkJJHRhc2tzLT5hbGwoKTsKCX0KCQogICAgJHRvdGFsVGFza3MgPSAkdGFza3MtPmNvdW50KCk7CiAgICAkY29tcGxldGVkVGFza3MgPSAkdGFza3MtPndoZXJlKCdzdGF0dXMnLCAnZG9uZScpLT5jb3VudCgpOwoKICAgIHJldHVybiAkdG90YWxUYXNrcyA+IDAgJiYgJGNvbXBsZXRlZFRhc2tzID4gMCA/ICgkY29tcGxldGVkVGFza3MvJHRvdGFsVGFza3MpIDogMDsKfQoKZnVuY3Rpb24gbGlzdE9mTW9udGhzQmV0d2VlbkRhdGVzKCRmcm9tLCAkdG8pewoJJHN0YXJ0ICAgID0gKG5ldyBcRGF0ZVRpbWUoJGZyb20pKS0+bW9kaWZ5KCdmaXJzdCBkYXkgb2YgdGhpcyBtb250aCcpOwoJJGVuZCAgICAgID0gKG5ldyBcRGF0ZVRpbWUoJHRvKSktPm1vZGlmeSgnZmlyc3QgZGF5IG9mIG5leHQgbW9udGgnKTsKCSRpbnRlcnZhbCA9IFxEYXRlSW50ZXJ2YWw6OmNyZWF0ZUZyb21EYXRlU3RyaW5nKCcxIG1vbnRoJyk7CgkkcGVyaW9kICAgPSBuZXcgXERhdGVQZXJpb2QoJHN0YXJ0LCAkaW50ZXJ2YWwsICRlbmQpOwoKCSRkYXRlcyA9IFtdOwoJZm9yZWFjaCAoJHBlcmlvZCBhcyAkZHQpIHsKCQlhcnJheV9wdXNoKCRkYXRlcywgJGR0LT5mb3JtYXQoIlktbS1kIikpOwoJfQoKCXJldHVybiAkZGF0ZXM7Cn0KCgpmdW5jdGlvbiBwcm9qZWN0U3RhdHVzTGlzdCgkc3RhdHVzID0gZmFsc2UpewoJJGFycmF5ID0gWwoJCSd3YWl0aW5nX2Zvcl9zdWJtaXQnID0+IFsKCQkJJ25hbWUnID0+ICdEcmFmdCcsCgkJCSdiYWNrZ3JvdW5kJyA9PiAncmdiKDg1LDg1LDg1LDAuNCknLAoJCQknc2hvdycgPT4gYXV0aCgpLT51c2VyKCktPmhhc0FueVJvbGUoWydTdXBlciBBZG1pbicsICdNYW5hZ2VtZW50JywgJ1BNTyddKSwKCQldLAoJCSdhcHByb3ZlZCcgPT4gWwoJCQknbmFtZScgPT4gJ09uZ29pbmcnLAoJCQknYmFja2dyb3VuZCcgPT4gJ3JnYigzNSwxMDgsOTgsMC40KScsCgkJCSdzaG93JyA9PiBhdXRoKCktPnVzZXIoKS0+aGFzQW55Um9sZShbJ1N1cGVyIEFkbWluJywgJ01hbmFnZW1lbnQnLCAnUE1PJywnU3BvbnNvcicsJ1BNJywnUHJpbWFyeS1Vc2VyJywnUHJvamVjdC1Cb2FyZCddKSwKCQldLAoJCSdwZW5kaW5nJyA9PiBbCgkJCSduYW1lJyA9PiAnV2FpdGluZyBGb3IgQXBwcm92YWwnLAoJCQknYmFja2dyb3VuZCcgPT4gJ3JnYigyNTUsMjIwLDAsMC40KScsCgkJCSdzaG93JyA9PiBhdXRoKCktPnVzZXIoKS0+aGFzQW55Um9sZShbJ1N1cGVyIEFkbWluJywgJ01hbmFnZW1lbnQnLCAnUE1PJywnU3BvbnNvcicsJ1Byb2plY3QtQm9hcmQnXSksCgkJXSwKCQkncmVhcHByb3ZhbCcgPT4gWwoJCQknbmFtZScgPT4gJ1dhaXRpbmcgRm9yIFJlYXBwcm92YWwnLAoJCQknYmFja2dyb3VuZCcgPT4gJ3JnYigyMzksMTE3LDcwLDAuNCknLAoJCQknc2hvdycgPT4gYXV0aCgpLT51c2VyKCktPmhhc0FueVJvbGUoWydTdXBlciBBZG1pbicsICdNYW5hZ2VtZW50JywgIlBNTyIsJ1Nwb25zb3InLCdQcm9qZWN0LUJvYXJkJ10pLAoJCV0sCgkJCgkJJ3BsYW5uZWQnID0+IFsKCQkJJ25hbWUnID0+ICdQbGFubmVkJywKCQkJJ2JhY2tncm91bmQnID0+ICdyZ2IoOTUsMTczLDIzMiwwLjQpJywKCQkJJ3Nob3cnID0+IGF1dGgoKS0+dXNlcigpLT5oYXNBbnlSb2xlKFsnU3VwZXIgQWRtaW4nLCAnTWFuYWdlbWVudCcsICJQTU8iLCdTcG9uc29yJywnUHJvamVjdC1Cb2FyZCddKSwKCQldCgldOwoKCWlmKCRzdGF0dXMpewoJCWlmKGFycmF5X2tleV9leGlzdHMoJHN0YXR1cywgJGFycmF5KSl7CgkJCXJldHVybiAkYXJyYXlbJHN0YXR1c107CgkJfQoJfQoKCXJldHVybiAkYXJyYXk7Cn0KCmZ1bmN0aW9uIHJhbmRvbUNvbG9yKCkgewogICAkY2hhcnMgPSAnQUJDREVGMDEyMzQ1Njc4OSc7CiAgICRjb2xvciA9ICcjJzsKICAgZm9yICggJGkgPSAwOyAkaSA8IDY7ICRpKysgKSB7CiAgICAgICRjb2xvciAuPSAkY2hhcnNbcmFuZCgwLCBzdHJsZW4oJGNoYXJzKSAtIDEpXTsKICAgfQogICByZXR1cm4gJGNvbG9yOwp9CgpmdW5jdGlvbiBmb3JtYXRCeXRlcygkc2l6ZSwgJHByZWNpc2lvbiA9IDIpewogICAgJGJhc2UgPSBsb2coJHNpemUsIDEwMjQpOwogICAgJHN1ZmZpeGVzID0gYXJyYXkoJycsICdLQicsICdNQicsICdHQicsICdUQicpOyAgIAoKICAgIHJldHVybiByb3VuZChwb3coMTAyNCwgJGJhc2UgLSBmbG9vcigkYmFzZSkpLCAkcHJlY2lzaW9uKSAuJyAnLiAkc3VmZml4ZXNbZmxvb3IoJGJhc2UpXTsKfQoKZnVuY3Rpb24gZ2V0UHJvamVjdFRhc2tzKCRwcm9qZWN0X2lkKXsKCXJldHVybiBcQXBwXE1vZGVsc1xNeVByb2plY3RcUHJvamVjdFRhc2s6OndoZXJlSGFzKCdzdWJEZWxpdmVyYWJsZS5kZWxpdmVyYWJsZScsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRwcm9qZWN0X2lkKXsKCQkJcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3Byb2plY3RfaWQnLCAkcHJvamVjdF9pZCk7CgkJfSkKCS0+d2hlbigoYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ1ByaW1hcnktVXNlcicpIHx8IGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdFbXBsb3llZScpKSwgZnVuY3Rpb24oJHF1ZXJ5KXsKCQlyZXR1cm4gJHF1ZXJ5LT53aGVyZSgndXNlcl9pZCcsIGF1dGgoKS0+dXNlcigpLT5pZCk7Cgl9KS0+cGx1Y2soJ2lkJyktPnRvQXJyYXkoKTsKfQoKZnVuY3Rpb24gZ2V0SG9saWRheXMoJGZ1bGwgPSBmYWxzZSwgJGZyb20gPSBmYWxzZSwgJHRvID0gZmFsc2UpewoJaWYoJGZ1bGwpewoJCXJldHVybiBcQXBwXE1vZGVsc1xNeVByb2plY3RcSG9saWRheTo6c2VsZWN0KFxEQjo6cmF3KCJuYW1lLCBTVFJfVE9fREFURShmdWxsX2RhdGUsICclWS0lbS0lZCcpIGFzIGRhdGUsIFNUUl9UT19EQVRFKGZ1bGxfZGF0ZSwgJyVZLSVtLSVkJykgYXMgYGZyb21gLCBTVFJfVE9fREFURShmdWxsX2RhdGUsICclWS0lbS0lZCcpIGFzIGB0b2AiKSkKCQktPndoZW4oJGZyb20sIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRmcm9tKXsKCQkJcmV0dXJuICRxdWVyeS0+d2hlcmUoXERCOjpyYXcoIlNUUl9UT19EQVRFKGZ1bGxfZGF0ZSwgJyVZLSVtLSVkJykiKSwgJz49JywgJGZyb20pOwoJCX0pCgkJLT53aGVuKCR0bywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHRvKXsKCQkJcmV0dXJuICRxdWVyeS0+d2hlcmUoXERCOjpyYXcoIlNUUl9UT19EQVRFKGZ1bGxfZGF0ZSwgJyVZLSVtLSVkJykiKSwgJzw9JywgJHRvKTsKCQl9KQoJCS0+Z2V0KCk7Cgl9CgoJcmV0dXJuIFxBcHBcTW9kZWxzXE15UHJvamVjdFxIb2xpZGF5OjpzZWxlY3QoXERCOjpyYXcoIlNUUl9UT19EQVRFKGZ1bGxfZGF0ZSwgJyVZLSVtLSVkJykgYXMgZGF0ZSIpKS0+Z3JvdXBCeSgnZGF0ZScpLT5wbHVjaygnZGF0ZScpLT50b0FycmF5KCk7Cn0KCmZ1bmN0aW9uIG51bWJlck9maG9saWRheXMoJGZyb20sICR0byl7CglyZXR1cm4gXEFwcFxNb2RlbHNcTXlQcm9qZWN0XEhvbGlkYXk6OndoZXJlKFxEQjo6cmF3KCJTVFJfVE9fREFURShmdWxsX2RhdGUsICclWS0lbS0lZCcpIiksICc+PScsICRmcm9tKS0+d2hlcmUoXERCOjpyYXcoIlNUUl9UT19EQVRFKGZ1bGxfZGF0ZSwgJyVZLSVtLSVkJykiKSwgJzw9JywgJHRvKS0+Z3JvdXBCeSgnZnVsbF9kYXRlJyktPmNvdW50KCk7Cn0KCgpmdW5jdGlvbiBwcm9qZWN0SG9saWRheXMoJHByb2plY3QsICRmcm9tID0gZmFsc2UsICR0byA9IGZhbHNlKXsKCSRob2xpZGF5cyA9IFtdOwoJaWYoJHByb2plY3QtPmhvbGlkYXlzLT5jb3VudCgpID4gMCl7CgkJZm9yZWFjaCgkcHJvamVjdC0+aG9saWRheXMgYXMgJGtleSA9PiAkaG9saWRheSl7CgkJCSRob2xpZGF5cyA9IGFycmF5X21lcmdlKCRob2xpZGF5cywgZGF0ZVJhbmdlKCRob2xpZGF5LT5mcm9tLCAkaG9saWRheS0+dG8pKTsKCQl9Cgl9CgoJJHdvcmtpbmdEYXlzID0gJHByb2plY3QtPndvcmtpbmdEYXlzLT5wbHVjaygnZGF5JyktPnRvQXJyYXkoKTsKCgkkZnJvbSA9ICgkZnJvbSA/ICRmcm9tIDogJHByb2plY3QtPnN0YXJ0X2RhdGUpOwoJJHRvID0gKCR0byA/ICR0byA6ICRwcm9qZWN0LT5lbmRfZGF0ZSk7CgoJJGRheXMgPSBbXTsKCSRkYXRlUmFuZ2UgPSBkYXRlUmFuZ2UoJGZyb20sICR0byk7Cglmb3JlYWNoKCRkYXRlUmFuZ2UgYXMgJGtleSA9PiAkZGF0ZSl7CgkJaWYoaW5fYXJyYXkoJGRhdGUsICRob2xpZGF5cykgfHwgIWluX2FycmF5KGRhdGUoJ2wnLCBzdHJ0b3RpbWUoJGRhdGUpKSwgJHdvcmtpbmdEYXlzKSl7CgkJCWFycmF5X3B1c2goJGRheXMsICRkYXRlKTsKCQl9Cgl9CgkKCXJldHVybiAkZGF5czsKfQoKZnVuY3Rpb24gcGF5bWVudFR5cGVzKCRhcCA9IGZhbHNlKXsKCSR0eXBlcyA9IFsKCQknY2FzaCcgPT4gWwoJCQknbmFtZScgPT4gIkNhc2giLAoJCQkndGl0bGUnID0+ICJQYXltZW50IERldGFpbHMiLAoJCQkncGxhY2Vob2xkZXInID0+ICJXcml0ZSBQYXltZW50IERldGFpbHMiLAoJCV0sCgkJJ2NoZXF1ZScgPT4gWwoJCQknbmFtZScgPT4gIkNoZXF1ZSIsCgkJCSd0aXRsZScgPT4gIkNoZXF1ZSBOdW1iZXIiLAoJCQkncGxhY2Vob2xkZXInID0+ICJObyBDaGVxdWUgQXZhaWxhYmxlISIsCgkJXSwKCQknZnVuZC10cmFuc2ZlcicgPT4gWwoJCQknbmFtZScgPT4gIkZ1bmQgVHJhbnNmZXIgKFJUR1MpIiwKCQkJJ3RpdGxlJyA9PiAiUlRHUyBOdW1iZXIiLAoJCQkncGxhY2Vob2xkZXInID0+ICJXcml0ZSBSVEdTIFJlZmVyZW5jZSBOdW1iZXIiLAoJCV0sCgkJJ290aGVycy1nbCcgPT4gWwoJCQknbmFtZScgPT4gIk90aGVycyAoQ2hvb3NlIEdMKSIsCgkJCSd0aXRsZScgPT4gIk5hcnJhdGlvbiIsCgkJCSdwbGFjZWhvbGRlcicgPT4gIldyaXRlIGEgTmFycmF0aW9uIiwKCQldLAoJXTsKCglpZigkYXApewoJCSR0eXBlc1snc3VwcGxpZXItcGF5YWJsZSddID0gWwoJCQknbmFtZScgPT4gIlN1cHBsaWVyIFBheWFibGUiLAoJCQkndGl0bGUnID0+ICJJbnZvaWNlIiwKCQkJJ3BsYWNlaG9sZGVyJyA9PiAiV3JpdGUgSW52b2ljZSBudW1iZXIiLAoJCV07Cgl9CgoJcmV0dXJuICR0eXBlczsKfQoKZnVuY3Rpb24gcG9BZHZhbmNlKCRwb19pZCl7CgkkZ3Jvc3NfcHJpY2UgPSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VcUHVyY2hhc2VPcmRlcjo6d2hlcmUoJ2lkJywgJHBvX2lkKS0+c3VtKCdncm9zc19wcmljZScpOwoJJGFkdmFuY2UgPSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcU3VwcGxpZXJQYXltZW50Ojp3aGVyZShbCgkJJ2JpbGxfdHlwZScgPT4gJ3BvLWFkdmFuY2UnLAoJCSdwdXJjaGFzZV9vcmRlcl9pZCcgPT4gJHBvX2lkCgldKS0+c3VtKCdwYXlfYW1vdW50Jyk7CgkkcGVyY2VudGFnZSA9IDA7CglpZigkZ3Jvc3NfcHJpY2UgPiAwICYmICRhZHZhbmNlID4gMCl7CgkJJHBlcmNlbnRhZ2UgPSAoKCRhZHZhbmNlKjEwMCkvJGdyb3NzX3ByaWNlKTsKCX0KCQoJcmV0dXJuIFsKCQknZ3Jvc3NfcHJpY2UnID0+ICRncm9zc19wcmljZSwKCQkncGVyY2VudGFnZScgPT4gJHBlcmNlbnRhZ2UsCgkJJ2FkdmFuY2UnID0+ICRhZHZhbmNlLAoJXTsKfQoKZnVuY3Rpb24gc3VwcGxpZXJTdGF0dXMoJHN1cHBsaWVyKXsKCXJldHVybiBbCgkJJ2FwcHJvdmVkX3RleHQnID0+IHVjd29yZHMoc3RyX3JlcGxhY2UoJy0nLCAnICcsICRzdXBwbGllci0+YXBwcm92ZWRfYnkpKSwKCQknYXBwcm92ZWRfY2xhc3MnID0+IGluX2FycmF5KCRzdXBwbGllci0+YXBwcm92ZWRfYnksIFsncHVyY2hhc2UtYXBwcm92ZWQnLCAnbWFuYWdlbWVudC1hcHByb3ZlZCddKSA/ICdzdWNjZXNzJyA6IChpbl9hcnJheSgkc3VwcGxpZXItPmFwcHJvdmVkX2J5LCBbJ3B1cmNoYXNlLWRlY2xpbmVkJywgJ21hbmFnZW1lbnQtZGVjbGluZWQnXSkgPyAnZGFuZ2VyJyA6ICd3YXJuaW5nJyksCgkJJ2FwcHJvdmVkX2ljb24nID0+ICBpbl9hcnJheSgkc3VwcGxpZXItPmFwcHJvdmVkX2J5LCBbJ3B1cmNoYXNlLWFwcHJvdmVkJywgJ21hbmFnZW1lbnQtYXBwcm92ZWQnXSkgPyAnbGFyIGxhLWNoZWNrLWNpcmNsZScgOiAoaW5fYXJyYXkoJHN1cHBsaWVyLT5hcHByb3ZlZF9ieSwgWydwdXJjaGFzZS1kZWNsaW5lZCcsICdtYW5hZ2VtZW50LWRlY2xpbmVkJ10pID8gJ2xhIGxhLWJhbicgOiAnbGFzIGxhLXF1ZXN0aW9uLWNpcmNsZScpLAoJCSdhcHByb3ZhbCcgPT4gKGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdQdXJjaGFzZS1EZXBhcnRtZW50JykgJiYgaW5fYXJyYXkoJHN1cHBsaWVyLT5hcHByb3ZlZF9ieSwgWydzZW50LXRvLXB1cmNoYXNlJywgJ3B1cmNoYXNlLWRlY2xpbmVkJ10pID8gdHJ1ZSA6IChhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnTWFuYWdlbWVudCcpICYmIGluX2FycmF5KCRzdXBwbGllci0+YXBwcm92ZWRfYnksIFsncHVyY2hhc2UtYXBwcm92ZWQnLCAnbWFuYWdlbWVudC1kZWNsaW5lZCddKSA/IHRydWUgOiBmYWxzZSkpLAoJXTsKfQoKZnVuY3Rpb24gZ2V0VXNlckNvc3RDZW50ZXIoJHVzZXJJZCkKewoJJHVzZXIgPSBVc2VyOjp3aXRoKCdlbXBsb3llZScpLT5maW5kKCR1c2VySWQpOwoKCSRjb3N0Q2VudGVyID0gQ29zdENlbnRyZTo6d2hlcmUoJ2hyX3VuaXRfaWQnLCR1c2VyLT5lbXBsb3llZS0+YXNfdW5pdF9pZCkKCQkJCQkgLT53aGVyZSgnaHJfZGVwYXJ0bWVudF9pZCcsJHVzZXItPmVtcGxveWVlLT5hc19kZXBhcnRtZW50X2lkKS0+Zmlyc3QoKTsKCglpZiAoJGNvc3RDZW50ZXItPmlkKSB7CgkJcmV0dXJuICRjb3N0Q2VudGVyOwoJfQoJcmV0dXJuIGZhbHNlOwp9CgpmdW5jdGlvbiBnZXRDb3N0Q2VudGVyVXNlcnMoJGNvc3RDZW50ZXJJZCkKewoJJGNvc3RDZW50ZXIgPSBDb3N0Q2VudHJlOjpmaW5kKCRjb3N0Q2VudGVySWQpOwoKCXJldHVybiBVc2VyOjp3aGVyZUhhcygnZW1wbG95ZWUnLGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgkY29zdENlbnRlcikKCXsJCgkJcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2FzX3VuaXRfaWQnLCRjb3N0Q2VudGVyLT5ocl91bml0X2lkKQoJCQkJCSAtPndoZXJlKCdhc19kZXBhcnRtZW50X2lkJywkY29zdENlbnRlci0+aHJfZGVwYXJ0bWVudF9pZCk7Cgl9KS0+Z2V0KFsnaWQnXSk7Cn0KCmZ1bmN0aW9uIGNoZWNrVG90YWxXZWlnaHRhZ2UoJHBvcnRmb2xpb19pZCwkd2VpZ2h0YWdlLCRpZD0nJykKewkKCWlmICgkaWQgIT1udWxsKSB7CgkJJGN1cnJlbnRfd2VpZ2h0YWdlID0gUHJvZ3JhbTo6d2hlcmVOb3RJbignaWQnLFskaWRdKS0+d2hlcmUoJ3BvcnRmb2xpb19pZCcsJHBvcnRmb2xpb19pZCktPnN1bSgnd2VpZ2h0YWdlJyk7Cgl9ZWxzZXsKCQkkY3VycmVudF93ZWlnaHRhZ2UgPSBQcm9ncmFtOjp3aGVyZSgncG9ydGZvbGlvX2lkJywkcG9ydGZvbGlvX2lkKS0+c3VtKCd3ZWlnaHRhZ2UnKTsKCX0KCgkkdG90YWxfd2VpZ2h0YWdlID0gJGN1cnJlbnRfd2VpZ2h0YWdlKyR3ZWlnaHRhZ2U7CgkKCWlmICgkdG90YWxfd2VpZ2h0YWdlID4gMTAwKSB7CgkJcmV0dXJuIHRydWU7Cgl9CglyZXR1cm4gZmFsc2U7Cn0KCmZ1bmN0aW9uIGdldEVudW1PcHRpb25zKCR0YWJsZV9uYW1lLCAkY29sdW1uX25hbWUpIHsKICAgICR0eXBlID0gREI6OnNlbGVjdChEQjo6cmF3KCdTSE9XIENPTFVNTlMgRlJPTSAnLiR0YWJsZV9uYW1lLicgV0hFUkUgRmllbGQgPSAiJy4kY29sdW1uX25hbWUuJyInKSlbMF0tPlR5cGU7CiAgICBwcmVnX21hdGNoKCcvXmVudW1cKCguKilcKSQvJywgJHR5cGUsICRtYXRjaGVzKTsKICAgICR2YWx1ZXMgPSBhcnJheSgpOwogICAgZm9yZWFjaChleHBsb2RlKCcsJywgJG1hdGNoZXNbMV0pIGFzICR2YWx1ZSl7CiAgICAgICAgJHZhbHVlc1tdID0gdHJpbSgkdmFsdWUsICInIik7CiAgICB9CiAgICByZXR1cm4gJHZhbHVlczsKfQoKZnVuY3Rpb24gZ2V0QXZhaWxhYmxlRGF0ZSgkZGF0ZSwgJGhvbGlkYXlzLCAkdHlwZSA9ICdmb3J3YXJkJyl7CglpZihpbl9hcnJheSgkZGF0ZSwgJGhvbGlkYXlzKSl7CgkJJGRhdGUgPSBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkZGF0ZS4nICcuKCR0eXBlID09ICdmb3J3YXJkJyA/ICcrJyA6ICctJykuJzEgZGF5cycpKTsKCQlyZXR1cm4gZ2V0QXZhaWxhYmxlRGF0ZSgkZGF0ZSwgJGhvbGlkYXlzLCAkdHlwZSk7Cgl9CglyZXR1cm4gJGRhdGU7Cn0KCmZ1bmN0aW9uIGVzdGltYXRlZFZhbHVlKCRyZXF1aXNpdGlvbil7CgkkZXN0aW1hdGVkID0gMDsKICAgIGlmKCRyZXF1aXNpdGlvbi0+aXRlbXMtPmNvdW50KCkgPiAwKXsKICAgICAgICBmb3JlYWNoKCRyZXF1aXNpdGlvbi0+aXRlbXMgYXMgJGtleSA9PiAkaXRlbSl7CiAgICAgICAgICAgICRlc3RpbWF0ZWQgKz0gKCRpdGVtLT5xdHkqJGl0ZW0tPnByb2R1Y3QtPnVuaXRfcHJpY2UpOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gJGVzdGltYXRlZDsKfQoKZnVuY3Rpb24gcHJvamVjdER1cmF0aW9uVG9sZXJhbmNlKCRwcm9qZWN0KXsKCWlmKCRwcm9qZWN0LT5zdGF0dXMgPT0gJ2FwcHJvdmVkJyl7CgkJJGRheXMgPSBkYXlzRGlmZmVyZW5jZSgkcHJvamVjdC0+aW5pdGlhbF9lbmRfZGF0ZSwgJHByb2plY3QtPmVuZF9kYXRlKTsKCSAgICBpZihzdHJ0b3RpbWUoJHByb2plY3QtPmVuZF9kYXRlKSA+IHN0cnRvdGltZSgkcHJvamVjdC0+aW5pdGlhbF9lbmRfZGF0ZSkgJiYgJGRheXMgPiAkcHJvamVjdC0+ZGF5c190b2xlcmFuY2UpewoJICAgICAgICByZXR1cm4gWwoJICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAoJICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJTb3JyeSEgUHJvamVjdCBEdXJhdGlvbiBUb2xlcmFuY2UgTGV2ZWwgKCIuJHByb2plY3QtPmRheXNfdG9sZXJhbmNlLiIgZGF5cykgaGFzIGJlZW4gZXhjZWVkZWQgYnkgIi4oJGRheXMpLiIgZGF5cy4iCgkgICAgICAgIF07CgkgICAgfQoKCSAgICAkZGF5cyA9IGRheXNEaWZmZXJlbmNlKCRwcm9qZWN0LT5zdGFydF9kYXRlLCAkcHJvamVjdC0+aW5pdGlhbF9zdGFydF9kYXRlKTsKCSAgICBpZihzdHJ0b3RpbWUoJHByb2plY3QtPmluaXRpYWxfc3RhcnRfZGF0ZSkgPiBzdHJ0b3RpbWUoJHByb2plY3QtPnN0YXJ0X2RhdGUpICYmICRkYXlzID4gJHByb2plY3QtPmRheXNfdG9sZXJhbmNlKXsKCSAgICAgICAgcmV0dXJuIFsKCSAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKCSAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiU29ycnkhIFByb2plY3QgRHVyYXRpb24gVG9sZXJhbmNlIExldmVsICgiLiRwcm9qZWN0LT5kYXlzX3RvbGVyYW5jZS4iIGRheXMpIGhhcyBiZWVuIGV4Y2VlZGVkIGJ5ICIuKCRkYXlzKS4iIGRheXMuIgoJICAgICAgICBdOwoJICAgIH0KCX0KCiAgICByZXR1cm4gWwogICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgXTsKfQoKZnVuY3Rpb24gZ2V0VGhpc1BhZ2VNZW51cygpewoJJHVybCA9IGV4cGxvZGUoJz8nLCBSZXF1ZXN0OjpwYXRoKCkpWzBdOwoKCSRwZXJtaXNzaW9uID0gW107Cglmb3JlYWNoKGF1dGgoKS0+dXNlcigpLT5nZXRQZXJtaXNzaW9uc1ZpYVJvbGVzKCkgYXMgJGRhdGEpewoJCWFycmF5X3B1c2goJHBlcm1pc3Npb24sICRkYXRhLT5uYW1lKTsKCX0KCgkkc3VibWVudSA9IFN1Yk1lbnU6OndoZXJlKCd1cmwnLCAkdXJsKS0+Zmlyc3QoKTsKCSRsaW5rcyA9IFtdOwoJaWYoaXNzZXQoJHN1Ym1lbnUtPm1lbnVfaWQpKXsKCQkgJGxpbmtzID0gY29sbGVjdChTdWJNZW51Ojp3aGVyZSgnbWVudV9pZCcsICRzdWJtZW51LT5tZW51X2lkKS0+d2hlcmUoJ3VybCcsICchPScsICR1cmwpLT5nZXQoKSktPm1hcFdpdGhLZXlzKGZ1bmN0aW9uICgkaXRlbSkgdXNlKCRwZXJtaXNzaW9uKSB7CgkJCQkkYXJyRGlmZiA9IGFycmF5X2ludGVyc2VjdCgkcGVybWlzc2lvbiwgaXNzZXQoanNvbl9kZWNvZGUoJGl0ZW1bJ3NsdWcnXSx0cnVlKVswXSkgPyBqc29uX2RlY29kZSgkaXRlbVsnc2x1ZyddLHRydWUpIDogW10pOwoKCQkJCXJldHVybiBbdXJsKCRpdGVtWyd1cmwnXSkgPT4gWwoJCQkJCSduYW1lJyA9PiAkaXRlbVsnbmFtZSddLAoJCQkJCSdpY29uJyA9PiAkaXRlbVsnaWNvbl9jbGFzcyddLAoJCQkJCSdwZXJtaXNzaW9uJyA9PiAkYXJyRGlmZiwKCQkJCV1dOwoJCX0pLT50b0FycmF5KCk7Cgl9CgoJLy8gJHByb2plY3Rfc3VibWVudSA9IFByb2plY3RTdWJNZW51Ojp3aGVyZSgndXJsJywgJHVybCktPmZpcnN0KCk7CgkvLyAkbGlua3MzID0gW107CgkvLyBpZihpc3NldCgkcHJvamVjdF9zdWJtZW51LT5tZW51X2lkKSl7CgkvLyAJICRsaW5rczMgPSBjb2xsZWN0KFByb2plY3RTdWJNZW51Ojp3aGVyZSgnbWVudV9pZCcsICRwcm9qZWN0X3N1Ym1lbnUtPm1lbnVfaWQpLT53aGVyZSgndXJsJywgJyE9JywgJHVybCktPmdldCgpKS0+bWFwV2l0aEtleXMoZnVuY3Rpb24gKCRpdGVtKSB1c2UoJHBlcm1pc3Npb24pIHsKCS8vIAkJCSRhcnJEaWZmID0gYXJyYXlfaW50ZXJzZWN0KCRwZXJtaXNzaW9uLCBpc3NldChqc29uX2RlY29kZSgkaXRlbVsnc2x1ZyddLHRydWUpWzBdKSA/IGpzb25fZGVjb2RlKCRpdGVtWydzbHVnJ10sdHJ1ZSkgOiBbXSk7CgoJLy8gCQkJcmV0dXJuIFt1cmwoJGl0ZW1bJ3VybCddKSA9PiBbCgkvLyAJCQkJJ25hbWUnID0+ICRpdGVtWyduYW1lJ10sCgkvLyAJCQkJJ2ljb24nID0+ICRpdGVtWydpY29uX2NsYXNzJ10sCgkvLyAJCQkJJ3Blcm1pc3Npb24nID0+ICRhcnJEaWZmLAoJLy8gCQkJXV07CgkvLyAJfSktPnRvQXJyYXkoKTsKCS8vIH0KCgkvLyByZXR1cm4gYXJyYXlfbWVyZ2UoJGxpbmtzLCRsaW5rczMpOwoKCXJldHVybiAkbGlua3M7Cn0KCmZ1bmN0aW9uIGdldFVuaXRQYWQoJHVuaXQpewoJJG1haW4gPSBnZXRNb2R1bGVzKClbJ21haW4nXTsKCXJldHVybiBpc3NldCgkdW5pdC0+cGFkKSA/ICRtYWluLT51cmwuJy8nLiR1bml0LT5wYWQgOiBzZXNzaW9uKCktPmdldCgnc3lzdGVtLWluZm9ybWF0aW9uJylbJ3BhZCddOwp9CgpmdW5jdGlvbiBnZXRDb21wYW55UGFkKCRjb21wYW55KXsKCSRtYWluID0gZ2V0TW9kdWxlcygpWydtYWluJ107CglyZXR1cm4gaXNzZXQoJGNvbXBhbnktPnVuaXRzWzBdKSA/ICRtYWluLT51cmwuJy8nLiRjb21wYW55LT51bml0cy0+Zmlyc3QoKS0+cGFkIDogc2Vzc2lvbigpLT5nZXQoJ3N5c3RlbS1pbmZvcm1hdGlvbicpWydwYWQnXTsKfQoKZnVuY3Rpb24gbWFrZVBheW1lbnRUZXJtc1N0cmluZygkaWQpewoJdHJ5ewoJCSRwYXltZW50VGVybSA9IFxBcHBcTW9kZWxzXFBtc01vZGVsc1xTdXBwbGllclBheW1lbnRUZXJtOjp3aXRoKFsncmVsUGF5bWVudFRlcm0nXSktPmZpbmRPckZhaWwoJGlkKTsKCQkkdGVybSA9ICRwYXltZW50VGVybS0+cmVsUGF5bWVudFRlcm0tPnRlcm0uJyAoJy4kcGF5bWVudFRlcm0tPnBheW1lbnRfcGVyY2VudC4nJSAnLigkcGF5bWVudFRlcm0tPnR5cGUgPT0gJ3BhaWQnID8gJ0FjY291bnQgUGF5ZWUtY2hlcXVlJyA6ICdDYXNoIENoZXF1ZScpLicgaW4gJy4kcGF5bWVudFRlcm0tPmRheV9kdXJhdGlvbi4nIGRheXMnOwoKCQkkdGVybXMgPSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcU3VwcGxpZXJQYXltZW50VGVybTo6d2hlcmUoJ3BhcmVudF9pZCcsICRwYXltZW50VGVybS0+aWQpLT5nZXQoKTsKCQlpZihpc3NldCgkdGVybXNbMF0pKXsKCQkJZm9yZWFjaCgkdGVybXMgYXMgJGtleSA9PiAkdGhpc190ZXJtKXsKCQkJCSR0ZXJtIC49ICcsICcuJHRoaXNfdGVybS0+cGF5bWVudF9wZXJjZW50LiclICcuKCR0aGlzX3Rlcm0tPnR5cGUgPT0gJ3BhaWQnID8gJ0FjY291bnQgUGF5LWNoZXF1ZScgOiAnQ2FzaCBDaGVxdWUnKS4nIGluICcuJHRoaXNfdGVybS0+ZGF5X2R1cmF0aW9uLicgZGF5cyc7CgkJCX0KCQl9CgoJCSR0ZXJtIC49ICcpJzsKCgkJcmV0dXJuICR0ZXJtOwoJfWNhdGNoKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICByZXR1cm4gJHRoLT5nZXRNZXNzYWdlKCk7CiAgICB9Cn0KCmZ1bmN0aW9uIHVzZXJDb2x1bW5WaXNpYmlsaXRpZXMoKXsKCSRjb2x1bW5WaXNpYmlsaXRpZXMgPSBcQXBwXE1vZGVsc1xVc2VyQ29sdW1uVmlzaWJpbGl0eTo6d2hlcmUoWwoJCSd1c2VyX2lkJyA9PiBhdXRoKCktPnVzZXIoKS0+aWQsCgkJJ3VybCcgPT4gcmVxdWVzdCgpLT5mdWxsVXJsKCkKCV0pLT5maXJzdCgpOwoJaWYoaXNzZXQoJGNvbHVtblZpc2liaWxpdGllcy0+aWQpKXsKCQkkY29sdW1ucyA9ICghZW1wdHkoJGNvbHVtblZpc2liaWxpdGllcy0+Y29sdW1ucykgJiYgaXNfYXJyYXkoanNvbl9kZWNvZGUoJGNvbHVtblZpc2liaWxpdGllcy0+Y29sdW1ucywgdHJ1ZSkpID8ganNvbl9kZWNvZGUoJGNvbHVtblZpc2liaWxpdGllcy0+Y29sdW1ucywgdHJ1ZSkgOiBbXSk7CgkJJGhpZGRlbiA9IFtdOwoJCWlmKGlzc2V0KCRjb2x1bW5zWzBdKSl7CgkJCWZvcmVhY2ggKCRjb2x1bW5zIGFzICRrZXkgPT4gJGNvbHVtbikgewoJCQkJaWYoJGNvbHVtbiA9PSAiZmFsc2UiKXsKCQkJCQlhcnJheV9wdXNoKCRoaWRkZW4sICRrZXkpOwoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gJGhpZGRlbjsKCX0KCglyZXR1cm4gW107Cn0KCmZ1bmN0aW9uIGZyZWV6ZVByb2R1Y3QoJHByb2R1Y3QpewoJcmV0dXJuICgkcHJvZHVjdC0+c3RhdHVzID09ICdhcHByb3ZlZCcgJiYgJHByb2R1Y3QtPnJlcXVpc2l0aW9uSXRlbS0+Y291bnQoKSA+IDApOwp9CgpmdW5jdGlvbiBmcmVlemVTdXBwbGllcigkc3VwcGxpZXIpewoJcmV0dXJuICgkc3VwcGxpZXItPmFwcHJvdmVkX2J5ID09ICdtYW5hZ2VtZW50LWFwcHJvdmVkJyAmJiAkc3VwcGxpZXItPnJlbFF1b3RhdGlvbnMtPmNvdW50KCkgPiAwKTsKfQoKZnVuY3Rpb24gZGF0YXRhYmxlT3JkZXJpbmcoKXsKCSRvcmRlciA9IGZhbHNlOwoJaWYoaXNzZXQocmVxdWVzdCgpLT5vcmRlclswXSkpewoJCWZvcmVhY2gocmVxdWVzdCgpLT5vcmRlciBhcyAka2V5ID0+ICRvcmRlcmluZyl7CgkJCWlmKCRvcmRlcmluZ1snY29sdW1uJ10gIT0gMCl7CgkJCQkkb3JkZXIgPSAkb3JkZXJpbmc7CgkJCX0KCQl9Cgl9CgoJcmV0dXJuICRvcmRlcjsKfQoKZnVuY3Rpb24gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCAkb3JkZXJCeVF1ZXJ5KXsKCXJldHVybiAkcXVlcnktPndoZW4oJG9yZGVyID09ICdhc2MnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkb3JkZXJCeVF1ZXJ5KXsKICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlckJ5KCRvcmRlckJ5UXVlcnkpOwogICAgfSkKICAgIC0+d2hlbigkb3JkZXIgPT0gJ2Rlc2MnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkb3JkZXJCeVF1ZXJ5KXsKICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlckJ5RGVzYygkb3JkZXJCeVF1ZXJ5KTsKICAgIH0pOwp9CgpmdW5jdGlvbiByZXF1aXJlZCgpewoJcmV0dXJuICc8c3Ryb25nIGNsYXNzPSJ0ZXh0LWRhbmdlciI+Kjwvc3Ryb25nPic7Cn0KCmZ1bmN0aW9uIGdldFByb2plY3RQcm9ncmVzcygkb2JqZWN0LCAkdHlwZSl7Cgkkc3RhcnRfZGF0ZSA9ICcnOwoJJGVuZF9kYXRlID0gJyc7CglpZigkdHlwZSA9PSAncHJvamVjdCcpewoJCSRzdGFydF9kYXRlID0gJG9iamVjdC0+c3RhcnRfZGF0ZTsKCQkkZW5kX2RhdGUgPSAkb2JqZWN0LT5lbmRfZGF0ZTsKCX1lbHNlaWYoJHR5cGUgPT0gJ3BoYXNlJyB8fCAkdHlwZSA9PSAnbWlsZXN0b25lJyl7CgkJJHN0YXJ0X2RhdGUgPSAkb2JqZWN0LT5zdGFydF9hdDsKCQkkZW5kX2RhdGUgPSAkb2JqZWN0LT5lbmRfYXQ7Cgl9ZWxzZWlmKCR0eXBlID09ICd0YXNrJyl7CgkJJHN0YXJ0X2RhdGUgPSAkb2JqZWN0LT5pbml0aWF0ZV90aW1lX2xpbmU7CgkJJGVuZF9kYXRlID0gJG9iamVjdC0+ZW5kX3RpbWVfbGluZTsKCX0KCQoJJHdlaWdodGFnZSA9IGdldENoYXJ0Q29sb3IoJG9iamVjdCwgJHN0YXJ0X2RhdGUsICRlbmRfZGF0ZSAsICR0eXBlLCAnZG9uZScpOwoJJHBhcmVudF93ZWlnaHRhZ2UgPSAoaXNzZXQoJG9iamVjdC0+c3BvbnNvcl9pZCkgPyAxMDAgOiAkb2JqZWN0LT53ZWlnaHRhZ2UpOwoJcmV0dXJuIHN5c3RlbURvdWJsZVZhbHVlKCgkd2VpZ2h0YWdlID4gMCAmJiAkcGFyZW50X3dlaWdodGFnZSA+IDAgPyAxMDAqKCR3ZWlnaHRhZ2UvJHBhcmVudF93ZWlnaHRhZ2UpIDogMCksIDIpOwp9CgpmdW5jdGlvbiBnZXRDb2xvcigkdmFsdWUpewogICAgJGNvbG9ycyA9IFsKICAgIAknYmFja2dyb3VuZCcgPT4gJyMzOGMxNzInLAogICAgCSdjb2xvcicgPT4gJ3doaXRlJywKICAgIF07CiAgICAKICAgIGlmKCR2YWx1ZSA9PSAidXBjb21pbmciKXsKICAgICAgICAkY29sb3JzWydiYWNrZ3JvdW5kJ10gPSAnIzM0OTBkYyc7CiAgICB9CgogICAgaWYoJHZhbHVlID09ICJvbmdvaW5nIil7CiAgICAgICAgJGNvbG9yc1snYmFja2dyb3VuZCddID0gJyNmZmVkNGEnOwogICAgICAgICRjb2xvcnNbJ2NvbG9yJ10gPSAnYmxhY2snOwogICAgfQoKICAgIGlmKCR2YWx1ZSA9PSAiZGVsYXkiKXsKICAgICAgICAkY29sb3JzWydiYWNrZ3JvdW5kJ10gPSAnI2UzMzQyZic7CiAgICB9CiAgICAgICAgCiAgICByZXR1cm4gJGNvbG9yczsKfQoKZnVuY3Rpb24gZ2V0Q2hhcnRDb2xvcnMoJG9iamVjdCwgJHN0YXJ0X2RhdGUsICRlbmRfZGF0ZSwgJHR5cGUgPSAncHJvamVjdCcpewoJJGFycmF5ID0gWydkb25lJywgJ2RlbGF5JywgJ29uZ29pbmcnLCAndXBjb21pbmcnXTsKCSRjb25kaXRpb25zID0gW107Cglmb3JlYWNoKCRhcnJheSBhcyAka2V5ID0+ICR2YWx1ZSl7CgkJJHdlaWdodGFnZSA9IGdldENoYXJ0Q29sb3IoJG9iamVjdCwgJHN0YXJ0X2RhdGUsICRlbmRfZGF0ZSwgJHR5cGUsICR2YWx1ZSk7CgkJJHBhcmVudF93ZWlnaHRhZ2UgPSAoaXNzZXQoJG9iamVjdC0+c3BvbnNvcl9pZCkgPyAxMDAgOiAkb2JqZWN0LT53ZWlnaHRhZ2UpOwoJCSRjb25kaXRpb25zWyR2YWx1ZV0gPSBzeXN0ZW1Eb3VibGVWYWx1ZSgoJHdlaWdodGFnZSA+IDAgJiYgJHBhcmVudF93ZWlnaHRhZ2UgPiAwID8gMTAwKigkd2VpZ2h0YWdlLyRwYXJlbnRfd2VpZ2h0YWdlKSA6IDApLCAyKTsKCX0KCglyZXR1cm4gJGNvbmRpdGlvbnM7Cn0KCmZ1bmN0aW9uIGdldENoYXJ0Q29sb3IoJG9iamVjdCwgJHN0YXJ0X2RhdGUsICRlbmRfZGF0ZSwgJHR5cGUgPSAncHJvamVjdCcsICRjb25kaXRpb24gPSAnZG9uZScpewoJaWYoJHR5cGUgPT0gJ3Byb2plY3QnKXsKCQkkcGVyY2VudGFnZSA9IDA7CgkJaWYoJG9iamVjdC0+ZGVsaXZlcmFibGVzLT5jb3VudCgpID4gMCl7CgkJCWZvcmVhY2goJG9iamVjdC0+ZGVsaXZlcmFibGVzIGFzICRrZXkgPT4gJGRlbGl2ZXJhYmxlKXsKCQkJCSRwZXJjZW50YWdlICs9IGdldENoYXJ0Q29sb3IoJGRlbGl2ZXJhYmxlLCAkZGVsaXZlcmFibGUtPnN0YXJ0X2F0LCAkZGVsaXZlcmFibGUtPmVuZF9hdCAsJ3BoYXNlJywgJGNvbmRpdGlvbik7CgkJCX0KCQl9CgkJcmV0dXJuICRwZXJjZW50YWdlOwoJfWVsc2VpZigkdHlwZSA9PSAncGhhc2UnKXsKCQkkcGVyY2VudGFnZSA9IDA7CgkJaWYoJG9iamVjdC0+c3ViRGVsaXZlcmFibGVzLT5jb3VudCgpID4gMCl7CgkJCWZvcmVhY2goJG9iamVjdC0+c3ViRGVsaXZlcmFibGVzIGFzICRrZXkgPT4gJHN1YkRlbGl2ZXJhYmxlKXsKCQkJCSRwZXJjZW50YWdlICs9IGdldENoYXJ0Q29sb3IoJHN1YkRlbGl2ZXJhYmxlLCAkc3ViRGVsaXZlcmFibGUtPnN0YXJ0X2F0LCAkc3ViRGVsaXZlcmFibGUtPmVuZF9hdCAsJ21pbGVzdG9uZScsICRjb25kaXRpb24pOwoJCQl9CgkJfWVsc2V7CgkJCSRwZXJjZW50YWdlID0gZ2V0Q2hhcnRDb2xvcigkb2JqZWN0LCAkb2JqZWN0LT5zdGFydF9hdCwgJG9iamVjdC0+ZW5kX2F0ICwndGFzaycsICRjb25kaXRpb24pOwoJCQkkcGVyY2VudGFnZSA9ICgkcGVyY2VudGFnZSA+IDAgPyAxMDAgOiAwKTsKCQl9CgkJcmV0dXJuICgkcGVyY2VudGFnZSA+IDAgJiYgJG9iamVjdC0+d2VpZ2h0YWdlID4gMCA/ICgkb2JqZWN0LT53ZWlnaHRhZ2UqKCRwZXJjZW50YWdlLzEwMCkpIDogMCk7Cgl9ZWxzZWlmKCR0eXBlID09ICdtaWxlc3RvbmUnKXsKCQkkcGVyY2VudGFnZSA9IDA7CgkJaWYoJG9iamVjdC0+cHJvamVjdFRhc2tzLT53aGVyZSgncGFyZW50X2lkJywgMCktPmNvdW50KCkgPiAwKXsKCQkJZm9yZWFjaCgkb2JqZWN0LT5wcm9qZWN0VGFza3MtPndoZXJlKCdwYXJlbnRfaWQnLCAwKSBhcyAka2V5ID0+ICRwcm9qZWN0VGFzayl7CgkJCQkkcGVyY2VudGFnZSArPSBnZXRDaGFydENvbG9yKCRwcm9qZWN0VGFzaywgJHByb2plY3RUYXNrLT5pbml0aWF0ZV90aW1lX2xpbmUsICRwcm9qZWN0VGFzay0+ZW5kX3RpbWVfbGluZSAsJ3Rhc2snLCAkY29uZGl0aW9uKTsKCQkJfQoJCX1lbHNlewoJCQkkcGVyY2VudGFnZSA9IGdldENoYXJ0Q29sb3IoJG9iamVjdCwgJG9iamVjdC0+c3RhcnRfYXQsICRvYmplY3QtPmVuZF9hdCAsJ3Rhc2snLCAkY29uZGl0aW9uKTsKCQkJJHBlcmNlbnRhZ2UgPSAoJHBlcmNlbnRhZ2UgPiAwID8gMTAwIDogMCk7CgkJfQoJCXJldHVybiAoJHBlcmNlbnRhZ2UgPiAwICYmICRvYmplY3QtPndlaWdodGFnZSA+IDAgPyAoJG9iamVjdC0+d2VpZ2h0YWdlKigkcGVyY2VudGFnZS8xMDApKSA6IDApOwoJfWVsc2VpZigkdHlwZSA9PSAndGFzaycpewoJCSRwZXJjZW50YWdlID0gMDsKCQlpZigkY29uZGl0aW9uID09ICdkb25lJyl7CgkJCQoJCQkkcGVyY2VudGFnZSA9ICgkb2JqZWN0LT5zdGF0dXMgPT0gJ2RvbmUnID8gKCRvYmplY3QtPndlaWdodGFnZSkgOiAwKTsKCgkJfWVsc2VpZigkY29uZGl0aW9uID09ICdkZWxheScgJiYgJG9iamVjdC0+c3RhdHVzICE9ICdkb25lJyl7CgkJCWlmKCEoc3RydG90aW1lKGRhdGUoJ1ktbS1kJykpIDwgc3RydG90aW1lKCRzdGFydF9kYXRlKSkgJiYgIShzdHJ0b3RpbWUoZGF0ZSgnWS1tLWQnKSkgPj0gc3RydG90aW1lKCRzdGFydF9kYXRlKSAmJiBzdHJ0b3RpbWUoZGF0ZSgnWS1tLWQnKSkgPD0gc3RydG90aW1lKCRlbmRfZGF0ZSkpKXsKCQkJCSRwZXJjZW50YWdlID0gKHN0cnRvdGltZShkYXRlKCdZLW0tZCcpKSA+IHN0cnRvdGltZSgkZW5kX2RhdGUpID8gKCRvYmplY3QtPndlaWdodGFnZSkgOiAwKTsKCQkJfQoKCQl9ZWxzZWlmKCRjb25kaXRpb24gPT0gJ3VwY29taW5nJyAmJiAkb2JqZWN0LT5zdGF0dXMgIT0gJ2RvbmUnKXsKCQkJaWYoIShzdHJ0b3RpbWUoZGF0ZSgnWS1tLWQnKSkgPiBzdHJ0b3RpbWUoJGVuZF9kYXRlKSkgJiYgIShzdHJ0b3RpbWUoZGF0ZSgnWS1tLWQnKSkgPj0gc3RydG90aW1lKCRzdGFydF9kYXRlKSAmJiBzdHJ0b3RpbWUoZGF0ZSgnWS1tLWQnKSkgPD0gc3RydG90aW1lKCRlbmRfZGF0ZSkpKXsKCQkJCSRwZXJjZW50YWdlID0gKHN0cnRvdGltZShkYXRlKCdZLW0tZCcpKSA8IHN0cnRvdGltZSgkc3RhcnRfZGF0ZSkgPyAoJG9iamVjdC0+d2VpZ2h0YWdlKSA6IDApOwoJCQl9CgoJCX1lbHNlaWYoJGNvbmRpdGlvbiA9PSAnb25nb2luZycgJiYgJG9iamVjdC0+c3RhdHVzICE9ICdkb25lJyl7CgkJCWlmKCEoc3RydG90aW1lKGRhdGUoJ1ktbS1kJykpID4gc3RydG90aW1lKCRlbmRfZGF0ZSkpICYmICEoc3RydG90aW1lKGRhdGUoJ1ktbS1kJykpIDwgc3RydG90aW1lKCRzdGFydF9kYXRlKSkpewoJCQkJJHBlcmNlbnRhZ2UgPSAoc3RydG90aW1lKGRhdGUoJ1ktbS1kJykpID49IHN0cnRvdGltZSgkc3RhcnRfZGF0ZSkgJiYgc3RydG90aW1lKGRhdGUoJ1ktbS1kJykpIDw9IHN0cnRvdGltZSgkZW5kX2RhdGUpID8gKCRvYmplY3QtPndlaWdodGFnZSkgOiAwKTsKCQkJfQoJCX0KCgkJcmV0dXJuICRwZXJjZW50YWdlOwoJfQp9CgpmdW5jdGlvbiB1cGRhdGVTdXBwbGllclByb2R1Y3RzKCRzdXBwbGllcl9pZCl7CglpZigkc3VwcGxpZXJfaWQgPT0gMTIpewoJCSRzdXBwbGllciA9IFxBcHBcTW9kZWxzXFBtc01vZGVsc1xTdXBwbGllcnM6OndpdGgoWwoJICAgICAgICAncHJvZHVjdHMnCgkgICAgXSktPmZpbmRPckZhaWwoJHN1cHBsaWVyX2lkKTsKCgkgICAgJHByb2R1Y3RzID0gXEFwcFxNb2RlbHNcUG1zTW9kZWxzXFByb2R1Y3Q6OndoZXJlTm90SW4oJ2lkJywgJHN1cHBsaWVyLT5wcm9kdWN0cy0+cGx1Y2soJ2lkJyktPnRvQXJyYXkoKSktPnBsdWNrKCdpZCcpLT50b0FycmF5KCk7CgkgICAgJGFycmF5ID0gW107CgkgICAgaWYoaXNzZXQoJHByb2R1Y3RzWzBdKSl7CgkgICAgICAgIGZvcmVhY2goJHByb2R1Y3RzIGFzICRrZXkgPT4gJHByb2R1Y3RfaWQpewoJICAgICAgICAgICAgYXJyYXlfcHVzaCgkYXJyYXksIFsKCSAgICAgICAgICAgICAgICAnc3VwcGxpZXJfaWQnID0+ICRzdXBwbGllci0+aWQsCgkgICAgICAgICAgICAgICAgJ3Byb2R1Y3RfaWQnID0+ICRwcm9kdWN0X2lkLAoJICAgICAgICAgICAgXSk7CgkgICAgICAgIH0KCSAgICB9CgoJICAgIGlmKGlzc2V0KCRhcnJheVswXSkpewoJICAgICAgICBEQjo6dGFibGUoJ3Byb2R1Y3RzX3N1cHBsaWVyJyktPmluc2VydCgkYXJyYXkpOwoJICAgIH0KCX0KfQoKZnVuY3Rpb24gZ2V0UE9EdWVBbW91bnQoJHB1cmNoYXNlT3JkZXIpewoJJGFkdmFuY2VCb29rZWQgPSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcU3VwcGxpZXJQYXltZW50Ojpkb2VzbnRIYXZlKCdyZWxTdXBwbGllckxlZGdlcnMnKQoJLT53aGVyZSgncHVyY2hhc2Vfb3JkZXJfaWQnLCAkcHVyY2hhc2VPcmRlci0+aWQpCiAgICAtPndoZXJlKCdzdXBwbGllcl9pZCcsICRwdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnN1cHBsaWVyX2lkKQoJLT53aGVyZSgnYmlsbF90eXBlJywgJ3BvLWFkdmFuY2UnKQoJLT5zdW0oJ3BheV9hbW91bnQnKTsKICAgICRwYWlkID0gXEFwcFxNb2RlbHNcUG1zTW9kZWxzXFN1cHBsaWVyTGVkZ2Vyczo6d2hlcmVIYXMoJ3JlbFN1cHBsaWVyUGF5bWVudCcsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRwdXJjaGFzZU9yZGVyKXsKICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncHVyY2hhc2Vfb3JkZXJfaWQnLCAkcHVyY2hhc2VPcmRlci0+aWQpCiAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3N1cHBsaWVyX2lkJywgJHB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+c3VwcGxpZXJfaWQpOwogICAgfSktPnN1bSgnZGViaXQnKTsKICAgIHJldHVybiBzeXN0ZW1Eb3VibGVWYWx1ZSgkcHVyY2hhc2VPcmRlci0+Z3Jvc3NfcHJpY2UtKCRhZHZhbmNlQm9va2VkKyRwYWlkKSwgMik7Cn0KCmZ1bmN0aW9uIG1lbnVNb2R1bGVzKCl7CglyZXR1cm4gWwoJCSdwcm9jdXJlbWVudCcsCgkJJ3Byb2plY3QtbWFuYWdlbWVudCcsCgkJJ2ZpbmFuY2UnLAoJCSdzYWxlcycsCgkJJ21hbnVmYWN0dXJpbmcnCgldOwp9