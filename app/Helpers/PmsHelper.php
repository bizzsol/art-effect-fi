<?php
bolt_decrypt( __FILE__ , '9mN7qd'); return 0;
##!!!##Cgp1c2UgQXBwXE1haWxcR2VuZXJpY01haWw7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xJbnZlbnRvcnlNb2RlbHNcSW52ZW50b3J5TG9nczsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcQ2F0ZWdvcnk7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xTdXBwbGllckxvZzsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFN1cHBsaWVyUmF0aW5nczsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXI7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBdHRyaWJ1dGU7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBdHRyaWJ1dGVPcHRpb247CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQcm9kdWN0QXR0cmlidXRlOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHJvZHVjdDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXE5vdGlmaWNhdGlvbjsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXENvc3RDZW50cmU7CnVzZSBBcHBcTW9kZWxzXE15UHJvamVjdFxQcm9ncmFtOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcTWVudVxTdWJNZW51Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcTWVudVxBY2NvdW50c1N1Yk1lbnU7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xNZW51XE1lbnU7CnVzZSBcQXBwXE1vZGVsc1xNeVByb2plY3RcRGVwZW5kZW5jeTsKdXNlIEFwcFxVc2VyOwp1c2UgSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcQXV0aDsKdXNlIElsbHVtaW5hdGVcU3VwcG9ydFxGYWNhZGVzXERCOwp1c2UgSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcTG9nOwp1c2UgSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcTWFpbDsKdXNlIElsbHVtaW5hdGVcU3VwcG9ydFxGYWNhZGVzXFJlcXVlc3Q7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xSZXF1aXNpdGlvblN0YWdlSGlzdG9yeTsKCmluY2x1ZGUgJ0Rhc2hib2FyZEhlbHBlci5waHAnOwoKLy9mdW5jdGlvbiBzZW5kRW1haWwoJHZpZXcsICRkYXRhLCAkc3ViamVjdCwgJGVtYWlscyl7Ci8vCS8vIGFycmF5X3B1c2goJGVtYWlscywgImFud2FydWxsYWg4MzRAZ21haWwuY29tIik7Ci8vCS8vIGFycmF5X3B1c2goJGVtYWlscywgInByb2dyYW1tZXIuYXJhZmF0YW53YXJAZ21haWwuY29tIik7Ci8vCi8vICBcTWFpbDo6c2VuZCgkdmlldywgJGRhdGEsIGZ1bmN0aW9uICgkbXNnKSB1c2UgKCRzdWJqZWN0LCAkZW1haWxzKXsKLy8gICAgJG1zZwovLyAgICAgIC0+dG8oJGVtYWlscykKLy8gICAgICAtPnN1YmplY3QoJHN1YmplY3QpOwovLyAgfSk7Ci8vfQoKZnVuY3Rpb24gc2VuZEVtYWlsKCR2aWV3LCAkZGF0YSwgJHN1YmplY3QsICRlbWFpbHMpCnsKICAgIC8vJGVtYWlsc1tdID0gIm1haG11ZGhhc2Fuc2FkaTkyQGdtYWlsLmNvbSI7CgogICAgLy8gQ2hlY2sgaWYgbWFpbCBpcyBjb25maWd1cmVkIGluIC5lbnYKICAgIGlmIChlbXB0eShjb25maWcoJ21haWwubWFpbGVycy5zbXRwLmhvc3QnKSkgfHwgZW1wdHkoY29uZmlnKCdtYWlsLmZyb20uYWRkcmVzcycpKSkgewogICAgICAgIExvZzo6d2FybmluZygnRW1haWwgbm90IHNlbnQ6IE1pc3NpbmcgbWFpbCBjb25maWd1cmF0aW9uLicpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICB0cnkgewogICAgICAgIE1haWw6OnRvKCRlbWFpbHMpLT5xdWV1ZShuZXcgR2VuZXJpY01haWwoJHZpZXcsICRkYXRhLCAkc3ViamVjdCkpOwogICAgfSBjYXRjaCAoXEV4Y2VwdGlvbiAkZSkgewogICAgICAgIExvZzo6ZXJyb3IoJ0VtYWlsIHNlbmRpbmcgZmFpbGVkOiAnIC4gJGUtPmdldE1lc3NhZ2UoKSk7CiAgICB9Cn0KCmZ1bmN0aW9uIHNhdmVTdXBwbGllckxvZygkc3VwcGxpZXJfaWQsICRkYXRlLCAkdG9waWMsICR0ZXh0LCAkaWQgPSAwKQp7CiAgICAkbG9nID0gU3VwcGxpZXJMb2c6OmZpbmQoJGlkKTsKICAgIGlmIChpc3NldCgkbG9nLT5pZCkpIHsKICAgICAgICAkbG9nLT5kYXRlID0gJGRhdGU7CiAgICAgICAgJGxvZy0+dG9waWMgPSAkdG9waWM7CiAgICAgICAgJGxvZy0+bG9nID0gJHRleHQ7CiAgICAgICAgJGxvZy0+c2F2ZSgpOwogICAgfSBlbHNlIHsKICAgICAgICAkbG9nID0gU3VwcGxpZXJMb2c6OmNyZWF0ZShbCiAgICAgICAgICAgICdzdXBwbGllcl9pZCcgPT4gJHN1cHBsaWVyX2lkLAogICAgICAgICAgICAnZGF0ZScgPT4gJGRhdGUsCiAgICAgICAgICAgICd0b3BpYycgPT4gJHRvcGljLAogICAgICAgICAgICAnbG9nJyA9PiAkdGV4dCwKICAgICAgICBdKTsKICAgIH0KICAgIAogICAgcmV0dXJuICRsb2c7Cn0KCmZ1bmN0aW9uIGdldE1lcmdlZFJlcXVpc2lzaW9uSUQoJGNvbmRpdGlvbjEsICRjb25kaXRpb24yKQp7CiAgICByZXR1cm4gYXJyYXlfdW5pcXVlKGFycmF5X21lcmdlKFJlcXVpc2l0aW9uOjp3aGVyZSgkY29uZGl0aW9uMSktPnBsdWNrKCdpZCcpLT50b0FycmF5KCksIFJlcXVpc2l0aW9uOjp3aGVyZSgkY29uZGl0aW9uMiktPnBsdWNrKCdpZCcpLT50b0FycmF5KCkpKTsKfQoKZnVuY3Rpb24gZ2V0VHlwZVdpc2VSZXF1aXNpc3Rpb25Db3VudCgkdHlwZSA9ICcnKQp7CiAgICByZXR1cm4gUmVxdWlzaXRpb246OndoZW4oaXNzZXQoQXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc19kZXBhcnRtZW50X2lkKSwKICAgICAgICBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnYXNfZGVwYXJ0bWVudF9pZCcsIEF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfZGVwYXJ0bWVudF9pZCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pCiAgICAgICAgLT53aGVyZSgnc3RhdHVzJywgJHR5cGUpCiAgICAgICAgLT5jb3VudCgpOwp9CgpmdW5jdGlvbiBpbnZlbnRvcnlTdGF0dXMoJHR5cGUgPSAnJywgJHdhcmVob3VzZV9pZCA9IDApCnsKICAgIHJldHVybiBJbnZlbnRvcnlMb2dzOjp3aGVyZSgndHlwZScsICR0eXBlKQogICAgICAgIC0+d2hlbigkd2FyZWhvdXNlX2lkID4gMCwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkd2FyZWhvdXNlX2lkKSB7CiAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCd3YXJlaG91c2VfaWQnLCAkd2FyZWhvdXNlX2lkKTsKICAgICAgICB9KQogICAgICAgIC0+Y291bnQoKTsKfQoKZnVuY3Rpb24gUXVhbGl0eUVuc3VyZUxpc3QoJHR5cGUpCnsKICAgIHJldHVybiBQdXJjaGFzZU9yZGVyOjp3aGVyZSgnaXNfc2VuZCcsICd5ZXMnKQogICAgICAgIC0+d2hlcmVIYXMoJ3JlbEdvb2RSZWNlaXZlTm90ZS5yZWxHb29kc1JlY2VpdmVkSXRlbXMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCR0eXBlKSB7CiAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdxdWFsaXR5X2Vuc3VyZScsICR0eXBlKTsKICAgICAgICB9KS0+Y291bnQoKTsKfQoKCmZ1bmN0aW9uIHNwYWNlcygkdmFsdWUsICRleHRyYSA9IDAsICRub1NwYWNlcyA9IHRydWUpCnsKICAgIGlmICgkbm9TcGFjZXMpIHsKICAgICAgICByZXR1cm4gKCR2YWx1ZSArICRleHRyYSkgKyAyOwogICAgfQogICAgCiAgICAkc3BhY2VzID0gJyc7CiAgICBmb3IgKCRpID0gMDsgJGkgPCAoJHZhbHVlICsgJGV4dHJhKSAqIDY7ICRpKyspIHsKICAgICAgICAkc3BhY2VzIC49ICImbmJzcDsiOwogICAgfQogICAgcmV0dXJuICRzcGFjZXM7Cn0KCmZ1bmN0aW9uIGNhdGVnb3J5TGlzdCgpCnsKICAgIHJldHVybiBDYXRlZ29yeTo6d2hlcmUoJ3BhcmVudF9pZCcsIG51bGwpLT5nZXQoKTsKfQoKZnVuY3Rpb24gY2F0ZWdvcnlPcHRpb25zKCRzdWJDYXRlZ29yaWVzLCAkY2hvc2VuID0gMCwgJHN0ZXAgPSAwLCAkaXNfZml4ZWRfYXNzZXQgPSAwLCAkaXNfY3dpcCA9IDAsICRhbGxTdWJDYXRlZ29yaWVzID0gW10sICRhbGxDYXRlZ29yeUF0dHJpYnV0ZXMgPSBbXSkKewogICAgaWYgKCRzdGVwID09IDApIHsKICAgICAgICAkYWxsU3ViQ2F0ZWdvcmllcyA9IENhdGVnb3J5Ojp3aXRoKFsKICAgICAgICAgICAgJ2NhdGVnb3J5JywgJ3N1YkNhdGVnb3J5JywKICAgICAgICBdKQogICAgICAgICAgICAvLyAtPndoZXJlKCdpc19maXhlZF9hc3NldCcsICRpc19maXhlZF9hc3NldCkKICAgICAgICAgICAgLy8gLT53aGVyZSgnaXNfY3dpcCcsICRpc19jd2lwKQogICAgICAgICAgICAtPm9yZGVyQnkoJ2NvZGUnKS0+Z2V0KCk7CiAgICAgICAgJGFsbENhdGVnb3J5QXR0cmlidXRlcyA9IFxBcHBcTW9kZWxzXFBtc01vZGVsc1xDYXRlZ29yeUF0dHJpYnV0ZTo6YWxsKCk7CiAgICAgICAgCiAgICAgICAgJHN1YkNhdGVnb3JpZXMgPSAkYWxsU3ViQ2F0ZWdvcmllcy0+d2hlcmUoJ3BhcmVudF9pZCcsIDApOwogICAgfQogICAgCiAgICAkZGF0YSA9ICcnOwogICAgaWYgKCRzdWJDYXRlZ29yaWVzLT5jb3VudCgpID4gMCkgewogICAgICAgIGZvcmVhY2ggKCRzdWJDYXRlZ29yaWVzIGFzICRrZXkgPT4gJHN1YkNhdGVnb3J5KSB7CiAgICAgICAgICAgICRjYXRlZ29yeUF0dHJpYnV0ZXMgPSAkYWxsQ2F0ZWdvcnlBdHRyaWJ1dGVzLT53aGVyZSgnY2F0ZWdvcnlfaWQnLCAkc3ViQ2F0ZWdvcnktPmlkKTsKICAgICAgICAgICAgJGF0dHJpYnV0ZXMgPSBbXTsKICAgICAgICAgICAgJGF0dHJpYnV0ZU9wdGlvbnMgPSBbXTsKICAgICAgICAgICAgaWYgKCRjYXRlZ29yeUF0dHJpYnV0ZXMtPmNvdW50KCkgPiAwKSB7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkY2F0ZWdvcnlBdHRyaWJ1dGVzIGFzICRrZXkgPT4gJGNhdGVnb3J5QXR0cmlidXRlKSB7CiAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkYXR0cmlidXRlcywgJGNhdGVnb3J5QXR0cmlidXRlLT5hdHRyaWJ1dGVfaWQpOwogICAgICAgICAgICAgICAgICAgICRhdHRyaWJ1dGVPcHRpb25zID0gYXJyYXlfbWVyZ2UoJGF0dHJpYnV0ZU9wdGlvbnMsIChpc19hcnJheShqc29uX2RlY29kZSgkY2F0ZWdvcnlBdHRyaWJ1dGUtPm9wdGlvbnMsIHRydWUpKSA/IGpzb25fZGVjb2RlKCRjYXRlZ29yeUF0dHJpYnV0ZS0+b3B0aW9ucywgdHJ1ZSkgOiBbXSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgICRhdHRyaWJ1dGVzID0gaW1wbG9kZSgnLCcsICRhdHRyaWJ1dGVzKTsKICAgICAgICAgICAgJGF0dHJpYnV0ZU9wdGlvbnMgPSBpbXBsb2RlKCcsJywgJGF0dHJpYnV0ZU9wdGlvbnMpOwogICAgICAgICAgICAkc3ViQ2F0ZWdvcmllcyA9ICRhbGxTdWJDYXRlZ29yaWVzLT53aGVyZSgncGFyZW50X2lkJywgJHN1YkNhdGVnb3J5LT5pZCk7CiAgICAgICAgICAgICRkYXRhIC49ICc8b3B0aW9uIHZhbHVlPSInIC4gJHN1YkNhdGVnb3J5LT5pZCAuICciICcgLiAoJGNob3NlbiA9PSAkc3ViQ2F0ZWdvcnktPmlkID8gJ3NlbGVjdGVkJyA6ICcnKSAuICcgJyAuICgkc3ViQ2F0ZWdvcnktPnN1YkNhdGVnb3J5LT5jb3VudCgpID4gMCA/ICdkaXNhYmxlZCcgOiAnJykgLiAnIGRhdGEtYXR0cmlidXRlcz0iJyAuICRhdHRyaWJ1dGVzIC4gJyIgZGF0YS1hdHRyaWJ1dGUtb3B0aW9ucz0iJyAuICRhdHRyaWJ1dGVPcHRpb25zIC4gJyIgaW52ZW50b3J5X2FjY291bnRfaWQ9IicgLiAkc3ViQ2F0ZWdvcnktPmludmVudG9yeV9hY2NvdW50X2lkIC4gJyIgY3dpcF9hc3NldF9hY2NvdW50X2lkPSInIC4gJHN1YkNhdGVnb3J5LT5jd2lwX2Fzc2V0X2FjY291bnRfaWQgLiAnIiBjb2dzX2FjY291bnRfaWQ9IicgLiAkc3ViQ2F0ZWdvcnktPmNvZ3NfYWNjb3VudF9pZCAuICciIGludmVudG9yeV9hZGp1c3RtZW50c19hY2NvdW50X2lkPSInIC4gJHN1YkNhdGVnb3J5LT5pbnZlbnRvcnlfYWRqdXN0bWVudHNfYWNjb3VudF9pZCAuICciIGlzX2ZpeGVkX2Fzc2V0PSInIC4gJHN1YkNhdGVnb3J5LT5pc19maXhlZF9hc3NldCAuICciIGlzX2N3aXA9IicgLiAkc3ViQ2F0ZWdvcnktPmlzX2N3aXAgLiAnIiBkZXByZWNpYXRpb25fcmF0ZT0iJyAuICRzdWJDYXRlZ29yeS0+ZGVwcmVjaWF0aW9uX3JhdGUgLiAnIiBzYWxlc19hY2NvdW50X2lkPSInIC4gJHN1YkNhdGVnb3J5LT5zYWxlc19hY2NvdW50X2lkIC4gJyIgZGVwcmVjaWF0aW9uX2Nvc3RfYWNjb3VudF9pZD0iJyAuICRzdWJDYXRlZ29yeS0+ZGVwcmVjaWF0aW9uX2Nvc3RfYWNjb3VudF9pZCAuICciIGRlcHJlY2lhdGlvbl9kaXNwb3NhbF9hY2NvdW50X2lkPSInIC4gJHN1YkNhdGVnb3J5LT5kZXByZWNpYXRpb25fZGlzcG9zYWxfYWNjb3VudF9pZCAuICciIGRhdGEtcHJvZHVjdC10eXBlPSInIC4gKCRzdWJDYXRlZ29yeS0+aXNfZml4ZWRfYXNzZXQgPT0gMSA/ICdmaXhlZF9hc3NldCcgOiAoJHN1YkNhdGVnb3J5LT5pc19jd2lwID09IDEgPyAnY3dpcCcgOiAncHJvZHVjdHMnKSkgLiAnIiBkYXRhLXNlcnZpY2U9IicgLiAoJHN1YkNhdGVnb3J5LT5pc19zZXJ2aWNlKSAuICciPicgLiBzcGFjZXMoJHN0ZXApIC4gJHN1YkNhdGVnb3J5LT5uYW1lIC4gJyAnIC4gKCRzdWJDYXRlZ29yaWVzLT5jb3VudCgpID4gMCA/ICcoJyAuICgkc3ViQ2F0ZWdvcnktPmlzX2ZpeGVkX2Fzc2V0ID09IDEgPyAnRml4ZWQgQXNzZXQnIDogKCRzdWJDYXRlZ29yeS0+aXNfY3dpcCA9PSAxID8gJ0NXSVAnIDogJ1Byb2R1Y3RzJykpIC4gJyknIDogJycpIC4gJzwvb3B0aW9uPic7CiAgICAgICAgICAgIGlmICgkc3ViQ2F0ZWdvcmllcy0+Y291bnQoKSA+IDApIHsKICAgICAgICAgICAgICAgICRkYXRhIC49IGNhdGVnb3J5T3B0aW9ucygkc3ViQ2F0ZWdvcmllcywgJGNob3NlbiwgJHN0ZXAgKyAxLCAkaXNfZml4ZWRfYXNzZXQsICRpc19jd2lwLCAkYWxsU3ViQ2F0ZWdvcmllcywgJGFsbENhdGVnb3J5QXR0cmlidXRlcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAKICAgIHJldHVybiAkZGF0YTsKfQoKZnVuY3Rpb24gZ2V0UHJvZHVjdEF0dHJpYnV0ZXMoJHByb2R1Y3RfaWQpCnsKICAgICRhdHRyaWJ1dGVzID0gUHJvZHVjdEF0dHJpYnV0ZTo6d2l0aChbJ2F0dHJpYnV0ZU9wdGlvbicsICdhdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJ10pCiAgICAgICAgLT53aGVyZSgncHJvZHVjdF9pZCcsICRwcm9kdWN0X2lkKQogICAgICAgIC0+b3JkZXJCeSgnc2VyaWFsX25vJywgJ2FzYycpCiAgICAgICAgLT5nZXQoKTsKICAgICRvcHRpb25zID0gW107CiAgICBpZiAoaXNzZXQoJGF0dHJpYnV0ZXNbMF0pKSB7CiAgICAgICAgZm9yZWFjaCAoJGF0dHJpYnV0ZXMgYXMgJGtleSA9PiAkYXR0cmlidXRlKSB7CiAgICAgICAgICAgIGlmIChpc3NldCgkYXR0cmlidXRlLT5hdHRyaWJ1dGVPcHRpb24tPmF0dHJpYnV0ZS0+Y29kZSkpIHsKICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJG9wdGlvbnMsIChpc3NldCgkYXR0cmlidXRlLT5hdHRyaWJ1dGVPcHRpb24tPmF0dHJpYnV0ZS0+Y29kZSkgPyAkYXR0cmlidXRlLT5hdHRyaWJ1dGVPcHRpb24tPmF0dHJpYnV0ZS0+Y29kZSA6ICcnKSAuICc6JyAuIChpc3NldCgkYXR0cmlidXRlLT5hdHRyaWJ1dGVPcHRpb24tPm5hbWUpID8gJGF0dHJpYnV0ZS0+YXR0cmlidXRlT3B0aW9uLT5uYW1lIDogJycpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBpc3NldCgkb3B0aW9uc1swXSkgPyAnKCcgLiBpbXBsb2RlKCcsICcsICRvcHRpb25zKSAuICcpJyA6ICcnOwp9CgpmdW5jdGlvbiBnZXRQcm9kdWN0QXR0cmlidXRlc0Zhc3RlcigkcHJvZHVjdCkKewogICAgJG9wdGlvbnMgPSBbXTsKICAgIGlmIChpc3NldCgkcHJvZHVjdC0+YXR0cmlidXRlc1swXSkpIHsKICAgICAgICBmb3JlYWNoICgkcHJvZHVjdC0+YXR0cmlidXRlcyBhcyAka2V5ID0+ICRhdHRyaWJ1dGUpIHsKICAgICAgICAgICAgaWYgKGlzc2V0KCRhdHRyaWJ1dGUtPmF0dHJpYnV0ZU9wdGlvbi0+YXR0cmlidXRlLT5jb2RlKSkgewogICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkb3B0aW9ucywgKGlzc2V0KCRhdHRyaWJ1dGUtPmF0dHJpYnV0ZU9wdGlvbi0+YXR0cmlidXRlLT5jb2RlKSA/ICRhdHRyaWJ1dGUtPmF0dHJpYnV0ZU9wdGlvbi0+YXR0cmlidXRlLT5jb2RlIDogJycpIC4gJzonIC4gKGlzc2V0KCRhdHRyaWJ1dGUtPmF0dHJpYnV0ZU9wdGlvbi0+bmFtZSkgPyAkYXR0cmlidXRlLT5hdHRyaWJ1dGVPcHRpb24tPm5hbWUgOiAnJykpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIGlzc2V0KCRvcHRpb25zWzBdKSA/ICcoJyAuIGltcGxvZGUoJywgJywgJG9wdGlvbnMpIC4gJyknIDogJyc7Cn0KCmZ1bmN0aW9uIHNlbGVjdGVkUHJvZHVjdEF0dHJpYnV0ZXMoJHByb2R1Y3RfaWQsICRhdHRyaWJ1dGVPcHRpb25zKQp7CiAgICAkcHJvZHVjdEF0dHJpYnV0ZXMgPSBQcm9kdWN0QXR0cmlidXRlOjp3aGVyZSgncHJvZHVjdF9pZCcsICRwcm9kdWN0X2lkKS0+b3JkZXJCeSgnc2VyaWFsX25vJywgJ2FzYycpLT5nZXQoKTsKICAgICRkYXRhID0gJyc7CiAgICBpZiAoaXNzZXQoJHByb2R1Y3RBdHRyaWJ1dGVzWzBdKSkgewogICAgICAgIGZvcmVhY2ggKCRwcm9kdWN0QXR0cmlidXRlcyBhcyAka2V5ID0+ICRhdHRyaWJ1dGUpIHsKICAgICAgICAgICAgJGRhdGEgLj0gKCRrZXkgPiAwID8gJywgJyA6ICcnKTsKICAgICAgICAgICAgJGRhdGEgLj0gKGluX2FycmF5KCRhdHRyaWJ1dGUtPmF0dHJpYnV0ZV9vcHRpb25faWQsICRhdHRyaWJ1dGVPcHRpb25zKSA/ICc8c3Ryb25nPicgLiAoaXNzZXQoJGF0dHJpYnV0ZS0+YXR0cmlidXRlT3B0aW9uLT5hdHRyaWJ1dGUtPmNvZGUpID8gJGF0dHJpYnV0ZS0+YXR0cmlidXRlT3B0aW9uLT5hdHRyaWJ1dGUtPmNvZGUgOiAnJykgLiAnOicgLiAoaXNzZXQoJGF0dHJpYnV0ZS0+YXR0cmlidXRlT3B0aW9uLT5uYW1lKSA/ICRhdHRyaWJ1dGUtPmF0dHJpYnV0ZU9wdGlvbi0+bmFtZSA6ICcnKSAuICc8L3N0cm9uZz4nIDogKGlzc2V0KCRhdHRyaWJ1dGUtPmF0dHJpYnV0ZU9wdGlvbi0+bmFtZSkgPyAkYXR0cmlidXRlLT5hdHRyaWJ1dGVPcHRpb24tPm5hbWUgOiAnJykpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcmV0dXJuICRkYXRhOwp9CgpmdW5jdGlvbiB1bml0TmFtZSgkaWQpCnsKICAgIHJldHVybiBcQXBwXE1vZGVsc1xIclxVbml0Ojp3aGVyZSgnaHJfdW5pdF9pZCcsICRpZCktPmZpcnN0KCk7Cn0KCmZ1bmN0aW9uIHVucmVhZE5vdGlmaWNhdGlvbigpCnsKICAgIHJldHVybiBOb3RpZmljYXRpb246OndoZXJlKCd1c2VyX2lkJywgYXV0aCgpLT51c2VyKCktPmlkKQogICAgICAgIC0+d2hlcmUoJ3N0YXR1cycsICdzZW5kLXRvLWFjY291bnRzJykKICAgICAgICAtPndoZXJlKCd0eXBlJywgJ3VucmVhZCcpCiAgICAgICAgLT5vcmRlckJ5KCdpZCcsICdkZXNjJykKICAgICAgICAtPmdldCgpOwp9CgpmdW5jdGlvbiBDcmVhdGVPclVwZGF0ZU5vdGlmaWNhdGlvbigkbWVzc2FnZXMsICR0eXBlLCAkaXRlbV9pZCA9IG51bGwsICR1c2VycyA9IFtdLCAkc3RhdHVzID0gbnVsbCwgJGlkID0gMCkKewogICAgaWYgKGlzc2V0KCR1c2Vyc1swXSkpIHsKICAgICAgICAkbm90aWZpY2F0aW9ucyA9IFtdOwogICAgICAgIGZvcmVhY2ggKCR1c2VycyBhcyAka2V5ID0+ICR1c2VyX2lkKSB7CiAgICAgICAgICAgIGFycmF5X3B1c2goJG5vdGlmaWNhdGlvbnMsIFsKICAgICAgICAgICAgICAgICd1c2VyX2lkJyA9PiAkdXNlcl9pZCwKICAgICAgICAgICAgICAgICdyZXF1aXNpdGlvbl9pdGVtX2lkJyA9PiAkaXRlbV9pZCwKICAgICAgICAgICAgICAgICdtZXNzYWdlcycgPT4gJG1lc3NhZ2VzLAogICAgICAgICAgICAgICAgJ3R5cGUnID0+ICR0eXBlLAogICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gJHN0YXR1cywKICAgICAgICAgICAgICAgICdjcmVhdGVkX2J5JyA9PiBhdXRoKCktPnVzZXIoKS0+aWQsCiAgICAgICAgICAgICAgICAnY3JlYXRlZF9hdCcgPT4gZGF0ZSgnWS1tLWQgSDppOnMnKQogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICAgICAgTm90aWZpY2F0aW9uOjppbnNlcnQoJG5vdGlmaWNhdGlvbnMpOwogICAgICAgIAogICAgICAgIHNlbmRFbWFpbCgnbWFpbHMuaW5kZXgnLCBbCiAgICAgICAgICAgICd0ZXh0JyA9PiAkbWVzc2FnZXMKICAgICAgICBdLCAiTm90aWZpY2F0aW9uIEZyb20gUE1TIFNvbHV0aW9ucyIsIFxBcHBcVXNlcjo6d2hlcmVJbignaWQnLCAkdXNlcnMpCiAgICAgICAgICAgIC0+d2hlcmVOb3RJbignYXNzb2NpYXRlX2lkJywgWydiaXp6c29sJ10pCiAgICAgICAgICAgIC0+cGx1Y2soJ2VtYWlsJykKICAgICAgICAgICAgLT50b0FycmF5KCkpOwogICAgICAgIAogICAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICByZXR1cm4gZmFsc2U7Cn0KCmZ1bmN0aW9uIGNoZWNrUG9BdHRhY2htZW50KCRwb19pZCwgJGJpbGxfdHlwZSA9IG51bGwsICRncm5faWQgPSBudWxsKQp7CiAgICAkcG8gPSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VcUHVyY2hhc2VPcmRlcjo6ZmluZE9yRmFpbCgkcG9faWQpOwogICAgaWYgKCRwby0+aXNfY2xvc2VkID09IDApIHsKICAgICAgICAkbm9uQmlsbGVkID0gXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEdyblxHb29kc1JlY2VpdmVkTm90ZTo6d2hlcmVEb2VzbnRIYXZlKCdyZWxQb0F0dGFjaG1lbnQnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ3N0YXR1cycsIFsnYXBwcm92ZWQnXSktPndoZXJlKCdiaWxsX3R5cGUnLCAncG8nKTsKICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlKCdwdXJjaGFzZV9vcmRlcl9pZCcsICRwb19pZCkKICAgICAgICAgICAgLT5jb3VudCgpOwogICAgICAgIGlmICgkbm9uQmlsbGVkID4gMCkgewogICAgICAgICAgICAkY291bnQgPSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VcUHVyY2hhc2VPcmRlckF0dGFjaG1lbnQ6OndoZXJlKCdwdXJjaGFzZV9vcmRlcl9pZCcsICRwb19pZCktPndoZXJlSW4oJ3N0YXR1cycsIFsncGVuZGluZycsICdoYWx0J10pLT53aGVyZSgnYmlsbF90eXBlJywgJ3BvJyktPmNvdW50KCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoJGNvdW50ID4gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuICgkYmlsbF90eXBlID09ICJwbyIgPyB0cnVlIDogKFxBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVyQXR0YWNobWVudDo6d2hlcmUoJ3B1cmNoYXNlX29yZGVyX2lkJywgJHBvX2lkKS0+d2hlcmVJbignc3RhdHVzJywgWydwZW5kaW5nJywgJ2FwcHJvdmVkJ10pLT53aGVyZSgnYmlsbF90eXBlJywgJ3BvJyktPmNvdW50KCkgPj0gMSA/IGZhbHNlIDogdHJ1ZSkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIChcQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VcUHVyY2hhc2VPcmRlckF0dGFjaG1lbnQ6OndoZXJlKCdwdXJjaGFzZV9vcmRlcl9pZCcsICRwb19pZCktPndoZXJlSW4oJ3N0YXR1cycsIFsncGVuZGluZycsICdhcHByb3ZlZCddKS0+d2hlcmUoJ2JpbGxfdHlwZScsICdwbycpLT5jb3VudCgpID49IDEgPyBmYWxzZSA6IHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHJldHVybiBmYWxzZTsKfQoKZnVuY3Rpb24gY2hlY2tQb0dybkF0dGFjaG1lbnQoJHBvX2lkLCAkZ3JuX2lkKQp7CiAgICAkcG8gPSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VcUHVyY2hhc2VPcmRlcjo6ZmluZE9yRmFpbCgkcG9faWQpOwogICAgaWYgKCRwby0+aXNfY2xvc2VkID09IDApIHsKICAgICAgICAkY291bnQgPSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VcUHVyY2hhc2VPcmRlckF0dGFjaG1lbnQ6OndoZXJlKCdwdXJjaGFzZV9vcmRlcl9pZCcsICRwb19pZCkKICAgICAgICAgICAgLT53aGVyZSgnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcsICRncm5faWQpCiAgICAgICAgICAgIC0+d2hlcmUoJ3N0YXR1cycsICdhcHByb3ZlZCcpCiAgICAgICAgICAgIC0+d2hlcmUoJ2JpbGxfdHlwZScsICdncm4nKQogICAgICAgICAgICAtPmNvdW50KCk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuICgkY291bnQgPiAwID8gZmFsc2UgOiB0cnVlKTsKICAgIH0KICAgIAogICAgcmV0dXJuIGZhbHNlOwp9CgoKZnVuY3Rpb24gY2FsY3VsYXRlR3JuUXR5QWdhaW5zdFB1cmNoYXNlT3JkZXIoJHB1cmNoYXNlT3JkZXIpCnsKICAgIGZvcmVhY2ggKCRwdXJjaGFzZU9yZGVyIGFzICRrZXkgPT4gJHZhbCkgewogICAgICAgIGlmIChpc3NldCgkdmFsLT5yZWxHb29kUmVjZWl2ZU5vdGUpKSB7CiAgICAgICAgICAgICRncm5RdHkgPSAkdmFsLT5yZWxHb29kUmVjZWl2ZU5vdGUtPmVhY2goZnVuY3Rpb24gKCRpdGVtLCAkaSkgewogICAgICAgICAgICAgICAgJGl0ZW1bJ2dybl9xdHknXSA9ICRpdGVtLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnN1bSgncXR5Jyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkdmFsWyd0b3RhbF9ncm5fcXR5J10gPSAkdmFsLT5yZWxHb29kUmVjZWl2ZU5vdGUtPnN1bSgnZ3JuX3F0eScpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcmV0dXJuICRwdXJjaGFzZU9yZGVyOwp9CgpmdW5jdGlvbiBzdGF0dXMoKQp7CiAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgImFjdGl2ZSIgPT4gJ0FjdGl2ZScsCiAgICAgICAgImluYWN0aXZlIiA9PiAnSW5hY3RpdmUnLAogICAgICAgICJjYW5jZWwiID0+ICdDYW5jZWwnLAogICAgKTsKfQoKZnVuY3Rpb24gc3RhdHVzQXJyYXkoKQp7CiAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgMCA9PiAiUGVuZGluZyIsCiAgICAgICAgMSA9PiAiQXBwcm92ZWQiLAogICAgICAgIDIgPT4gIkhhbHQiLAogICAgKTsKfQoKZnVuY3Rpb24gcmVxdWlzaXRpb25TdGF0dXMoKQp7CiAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgMyA9PiAiRHJhZnQiLAogICAgICAgIDAgPT4gIlBlbmRpbmciLAogICAgICAgIDEgPT4gIkFwcHJvdmVkIiwKICAgICk7Cn0KCmZ1bmN0aW9uIHN0YXR1c0FycmF5Rm9ySGVhZCgpCnsKICAgIHJldHVybiBhcnJheSgKICAgICAgICAwID0+ICJQZW5kaW5nIiwKICAgICAgICAxID0+ICJBY2tub3dsZWRnZSIsCiAgICAgICAgMiA9PiAiSGFsdCIsCiAgICApOwp9CgpmdW5jdGlvbiBzdHJpbmdTdGF0dXNBcnJheSgkYXVkaXRlZCA9IGZhbHNlKQp7CiAgICBpZiAoJGF1ZGl0ZWQpIHsKICAgICAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgICAgICdwZW5kaW5nJyA9PiAiUGVuZGluZyIsCiAgICAgICAgICAgICdhdWRpdGVkJyA9PiAiQXBwcm92ZWQiLAogICAgICAgICAgICAnY2FuY2VsZWQnID0+ICJIYWx0IiwKICAgICAgICApOwogICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgICAgICdwZW5kaW5nJyA9PiAiUGVuZGluZyIsCiAgICAgICAgICAgICdhcHByb3ZlZCcgPT4gIkFwcHJvdmVkIiwKICAgICAgICAgICAgJ2hhbHQnID0+ICJIYWx0IiwKICAgICAgICApOwogICAgfQp9CgpmdW5jdGlvbiBkZWxpdmVyeVN0YXR1cygpCnsKICAgIHJldHVybiBhcnJheSgKICAgICAgICAncHJvY2Vzc2luZycgPT4gIlByb2Nlc3NpbmciLAogICAgICAgICdjb25maXJtZWQnID0+ICJDb25maXJtZWQiLAogICAgICAgICdwdXJjaGFzZScgPT4gIlB1cmNoYXNlIiwKICAgICAgICAnZGVsaXZlcmVkJyA9PiAiRGVsaXZlcmVkIiwKICAgICAgICAncGFydGlhbC1kZWxpdmVyZWQnID0+ICJQZXJjaWFsLURlbGl2ZXJ5IiwKICAgICAgICAnY2VuY2VsJyA9PiAiQ2VuY2VsIiwKICAgICk7Cn0KCmZ1bmN0aW9uIG1hcml0YWxTdGF0dXMoKQp7CiAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgJ1NpbmdsZScsCiAgICAgICAgJ01hcnJpZWQnLAogICAgICAgICdEaXZvcmNlZCcsCiAgICApOwp9CgpmdW5jdGlvbiBibG9vZEdyb3VwcygpCnsKICAgIHJldHVybiBhcnJheSgKICAgICAgICAnTi9BJywKICAgICAgICAnQSsnLAogICAgICAgICdBLScsCiAgICAgICAgJ0IrJywKICAgICAgICAnQi0nLAogICAgICAgICdPKycsCiAgICAgICAgJ08tJywKICAgICAgICAnQUIrJywKICAgICAgICAnQUItJywKICAgICk7Cn0KCmZ1bmN0aW9uIHdlZWtEYXlzKCkKewogICAgcmV0dXJuIGFycmF5KAogICAgICAgICJTYXR1cmRheSIsCiAgICAgICAgIlN1bmRheSIsCiAgICAgICAgIk1vbmRheSIsCiAgICAgICAgIlR1ZXNkYXkiLAogICAgICAgICJXZWRuZXNkYXkiLAogICAgICAgICJUaHVyc2RheSIsCiAgICAgICAgIkZyaWRheSIsCiAgICApOwp9CgpmdW5jdGlvbiB3ZWVrRGF5c0luZGV4KCkKewogICAgcmV0dXJuIGFycmF5KAogICAgICAgICJTYXR1cmRheSIgPT4gMCwKICAgICAgICAiU3VuZGF5IiA9PiAxLAogICAgICAgICJNb25kYXkiID0+IDIsCiAgICAgICAgIlR1ZXNkYXkiID0+IDMsCiAgICAgICAgIldlZG5lc2RheSIgPT4gNCwKICAgICAgICAiVGh1cnNkYXkiID0+IDUsCiAgICAgICAgIkZyaWRheSIgPT4gNiwKICAgICk7Cn0KCmZ1bmN0aW9uIGRheXNEaWZmZXJlbmNlKCRmcm9tLCAkdG8pCnsKICAgICRmcm9tID0gbmV3IERhdGVUaW1lKCRmcm9tKTsKICAgICR0byA9IG5ldyBEYXRlVGltZSgkdG8pOwogICAgJGRpZmZlcmVuY2UgPSAkZnJvbS0+ZGlmZigkdG8pOwogICAgcmV0dXJuICRkaWZmZXJlbmNlLT5kYXlzICsgMTsKfQoKZnVuY3Rpb24gbWludXRlc0RpZmZlcmVuY2UoJGZyb20sICR0bykKewogICAgJHN0YXJ0X2RhdGUgPSBuZXcgRGF0ZVRpbWUoJGZyb20pOwogICAgJHNpbmNlX3N0YXJ0ID0gJHN0YXJ0X2RhdGUtPmRpZmYobmV3IERhdGVUaW1lKCR0bykpOwogICAgJG1pbnV0ZXMgPSAkc2luY2Vfc3RhcnQtPmRheXMgKiAyNCAqIDYwOwogICAgJG1pbnV0ZXMgKz0gJHNpbmNlX3N0YXJ0LT5oICogNjA7CiAgICAkbWludXRlcyArPSAkc2luY2Vfc3RhcnQtPmk7CiAgICByZXR1cm4gJG1pbnV0ZXM7Cn0KCmZ1bmN0aW9uIHByaW1hcnlBcHByb3ZhbHMoKQp7CiAgICByZXR1cm4gWwogICAgICAgIFsKICAgICAgICAgICAgJ25hbWUnID0+ICdQcm9jZXNzaW5nJywKICAgICAgICAgICAgJ2NsYXNzJyA9PiAnd2FybmluZycKICAgICAgICBdLAogICAgICAgIFsKICAgICAgICAgICAgJ25hbWUnID0+ICdBcHByb3ZlZCcsCiAgICAgICAgICAgICdjbGFzcycgPT4gJ3N1Y2Nlc3MnCiAgICAgICAgXSwKICAgICAgICBbCiAgICAgICAgICAgICduYW1lJyA9PiAnUmVqZWN0ZWQnLAogICAgICAgICAgICAnY2xhc3MnID0+ICdkYW5nZXInCiAgICAgICAgXSwKICAgIF07Cn0KCmZ1bmN0aW9uIHVuaXF1ZUNvZGUoJGxlbmd0aCwgJHByZWZpeCwgJHRhYmxlLCAkZmllbGQpCnsKICAgICRwcmVmaXhfbGVuZ3RoID0gc3RybGVuKCRwcmVmaXgpOwogICAgJG1heF9pZCA9IERCOjp0YWJsZSgkdGFibGUpLT5tYXgoJGZpZWxkKTsKICAgICRuZXcgPSAoaW50KSgkbWF4X2lkKTsKICAgICRuZXcrKzsKICAgICRudW1iZXJfb2ZfemVybyA9ICRsZW5ndGggLSAkcHJlZml4X2xlbmd0aCAtIHN0cmxlbigkbmV3KTsKICAgICR6ZXJvID0gc3RyX3JlcGVhdCgiMCIsICRudW1iZXJfb2ZfemVybyk7CiAgICAkbWFkZV9pZCA9ICRwcmVmaXggLiAkemVybyAuICRuZXc7CiAgICByZXR1cm4gJG1hZGVfaWQ7Cn0KCmZ1bmN0aW9uIGVudHJ5VW5pcXVlQ29kZSgkbGVuZ3RoLCAkcHJlZml4LCAkdGFibGUsICRmaWVsZCkKewogICAgJHByZWZpeF9sZW5ndGggPSBzdHJsZW4oJHByZWZpeCk7CiAgICAkbWF4X2lkID0gREI6OnRhYmxlKCR0YWJsZSktPndoZXJlKERCOjpyYXcoJ3N1YnN0cihgJyAuICRmaWVsZCAuICdgLCAxLCAnIC4gc3RybGVuKCRwcmVmaXgpIC4gJyknKSwgJHByZWZpeCktPm1heCgkZmllbGQpOwogICAgJG5ldyA9IChpbnQpKHN0cl9yZXBsYWNlKCRwcmVmaXgsICcnLCAkbWF4X2lkKSk7CiAgICAkbmV3Kys7CiAgICAkbnVtYmVyX29mX3plcm8gPSAkbGVuZ3RoIC0gJHByZWZpeF9sZW5ndGggLSBzdHJsZW4oJG5ldyk7CiAgICAkemVybyA9IHN0cl9yZXBlYXQoIjAiLCAkbnVtYmVyX29mX3plcm8pOwogICAgJG1hZGVfaWQgPSAkcHJlZml4IC4gJHplcm8gLiAkbmV3OwogICAgcmV0dXJuICRtYWRlX2lkOwp9CgpmdW5jdGlvbiB1bmlxdWVDb2RlV2l0aG91dFByZWZpeCgkbGVuZ3RoLCAkdGFibGUsICRmaWVsZCkKewogICAgJG1heCA9IERCOjp0YWJsZSgkdGFibGUpLT5tYXgoJGZpZWxkKTsKICAgICRuZXcgPSAoaW50KSgkbWF4KTsKICAgICRuZXcrKzsKICAgICRudW1iZXJfb2ZfemVybyA9ICRsZW5ndGggLSBzdHJsZW4oJG5ldyk7CiAgICAkemVybyA9IHN0cl9yZXBlYXQoIjAiLCAkbnVtYmVyX29mX3plcm8gPCAwID8gMCA6ICRudW1iZXJfb2ZfemVybyk7CiAgICAkbWFkZV9pZCA9ICR6ZXJvIC4gJG5ldzsKICAgIHJldHVybiAkbWFkZV9pZDsKfQoKCmZ1bmN0aW9uIHVuaXF1ZVN0cmluZ0dlbmVyYXRvcigpCnsKICAgICRzID0gJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6JzsKICAgICRzID0gc3RyX3NodWZmbGUoJHMpOwogICAgJGwgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVonOwogICAgJGwgPSBzdHJfc2h1ZmZsZSgkbCk7CiAgICAkc3BjID0gJ0BfIy0nOwogICAgJHNwYyA9IHN0cl9zaHVmZmxlKCRzcGMpOwogICAgJG51bSA9ICcwMTIzNDU2Nzg5JzsKICAgICRudW0gPSBzdHJfc2h1ZmZsZSgkbnVtKTsKICAgIHJldHVybiAkbnVtIC4gc3Vic3RyKCRzcGMsIDAsIDEpIC4gc3RyX3NodWZmbGUoc3Vic3RyKCRsLCAwLCAyKSAuIHN1YnN0cigkcywgMCwgMikpIC4gdGltZSgpOwp9CgpmdW5jdGlvbiByYXRpbmdHZW5lcmF0ZSgkdG90YWxTY29yZSA9ICcnLCAkdG90YWxDb3VudCA9ICcnLCAkaXNQZGYgPSBmYWxzZSkKewogICAgaWYgKCR0b3RhbFNjb3JlID4gMCAmJiAkdG90YWxDb3VudCA+IDApIHsKICAgICAgICAvLyR0b3RhbE1heERlY2luYWxTY29yZSA9ICR0b3RhbFNjb3JlL0NvbHVtbkNvdW50KCdzdXBwbGllcl9yYXR0aW5ncycpOwogICAgICAgICRhdmVyYWdlUmF0aW5nID0gJHRvdGFsU2NvcmUgLyAkdG90YWxDb3VudDsKICAgIH0gZWxzZSB7CiAgICAgICAgJGF2ZXJhZ2VSYXRpbmcgPSAwLjAwOwogICAgfQogICAgCiAgICAkZm9ybWF0ZWRWYWwgPSBudW1iZXJfZm9ybWF0KCRhdmVyYWdlUmF0aW5nLCAyKTsKICAgICRwaWVjZXMgPSBleHBsb2RlKCIuIiwgJGZvcm1hdGVkVmFsKTsKICAgIAogICAgaWYgKCRpc1BkZikgewogICAgICAgICRzdGFyX2xpc3QgPSBzdHJfcmVwZWF0KCcmIzk3MzM7JywgbnVtYmVyX2Zvcm1hdCgkcGllY2VzWzBdKSk7CiAgICB9IGVsc2UgewogICAgICAgIAogICAgICAgICRzdGFyX2xpc3QgPSBzdHJfcmVwZWF0KCc8aSBjbGFzcz0iZmEgZmEtc3RhciByYXRpbmctY29sb3IiIGFyaWEtaGlkZGVuPSJ0cnVlIj48L2k+JywgbnVtYmVyX2Zvcm1hdCgkcGllY2VzWzBdKSk7CiAgICB9CiAgICAKICAgIGlmICgkcGllY2VzWzFdID4gMCkgewogICAgICAgICRoYWxmU3RhcnQgPSAoJGlzUGRmKSA/ICcmIzEwMDMxOycgOiAnPGkgY2xhc3M9ImZhIGZhLXN0YXItaGFsZi1vIHJhdGluZy1jb2xvciIgYXJpYS1oaWRkZW49InRydWUiPjwvaT4nOwogICAgfSBlbHNlIHsKICAgICAgICAkaGFsZlN0YXJ0ID0gJyc7CiAgICB9CiAgICAKICAgICRibGFua1N0YXIgPSAoNSAtICRmb3JtYXRlZFZhbCk7CiAgICAKICAgICRwcmludFJhdGluZyA9ICcnOwogICAgCiAgICBmb3IgKCRqID0gMTsgJGogPD0gJGJsYW5rU3RhcjsgJGorKykgewogICAgICAgICRwcmludFJhdGluZyAuPSAoJGlzUGRmKSA/ICcmIzk3MzQ7JyA6ICc8aSBjbGFzcz0iZmEgZmEtc3RhciI+PC9pPic7CiAgICB9CiAgICAKICAgIHJldHVybiAkc3Rhcl9saXN0IC4gJycgLiAkaGFsZlN0YXJ0IC4gJycgLiAkcHJpbnRSYXRpbmc7Cn0KCmZ1bmN0aW9uIHNpbmdsZVJhdGluZ0dlbmVyYXRlKCR0b3RhbFNjb3JlID0gJycsICR0b3RhbENvdW50ID0gJycpCnsKICAgIGlmICgkdG90YWxTY29yZSA+IDAgJiYgJHRvdGFsQ291bnQgPiAwKSB7CiAgICAgICAgJGF2ZXJhZ2VSYXRpbmcgPSAkdG90YWxTY29yZSAvICR0b3RhbENvdW50OwogICAgfSBlbHNlIHsKICAgICAgICAkYXZlcmFnZVJhdGluZyA9IDAuMDA7CiAgICB9CiAgICAKICAgICRmb3JtYXRlZFZhbCA9IG51bWJlcl9mb3JtYXQoJGF2ZXJhZ2VSYXRpbmcsIDIpOwogICAgJHBpZWNlcyA9IGV4cGxvZGUoIi4iLCAkZm9ybWF0ZWRWYWwpOwogICAgCiAgICAkc3Rhcl9saXN0ID0gc3RyX3JlcGVhdCgnPGkgY2xhc3M9ImZhIGZhLXN0YXIgcmF0aW5nLWNvbG9yIiBhcmlhLWhpZGRlbj0idHJ1ZSI+PC9pPicsIG51bWJlcl9mb3JtYXQoJHBpZWNlc1swXSkpOwogICAgCiAgICBpZiAoJHBpZWNlc1sxXSA+IDApIHsKICAgICAgICAkaGFsZlN0YXJ0ID0gJzxpIGNsYXNzPSJmYSBmYS1zdGFyLWhhbGYtbyByYXRpbmctY29sb3IiIGFyaWEtaGlkZGVuPSJ0cnVlIj48L2k+JzsKICAgIH0gZWxzZSB7CiAgICAgICAgJGhhbGZTdGFydCA9ICcnOwogICAgfQogICAgCiAgICAkYmxhbmtTdGFyID0gKDUgLSAkZm9ybWF0ZWRWYWwpOwogICAgCiAgICAkcHJpbnRSYXRpbmcgPSAnJzsKICAgIAogICAgZm9yICgkaiA9IDE7ICRqIDw9ICRibGFua1N0YXI7ICRqKyspIHsKICAgICAgICAkcHJpbnRSYXRpbmcgLj0gJzxpIGNsYXNzPSJmYSBmYS1zdGFyIj48L2k+JzsKICAgIH0KICAgIAogICAgcmV0dXJuICRzdGFyX2xpc3QgLiAnJyAuICRoYWxmU3RhcnQgLiAnJyAuICRwcmludFJhdGluZzsKfQoKZnVuY3Rpb24gQ29sdW1uQ291bnQoJHRhYmxlKQp7CiAgICAkY29sdW1uID0gY291bnQoXElsbHVtaW5hdGVcU3VwcG9ydFxGYWNhZGVzXFNjaGVtYTo6Z2V0Q29sdW1uTGlzdGluZygkdGFibGUpKTsKICAgIHJldHVybiAkcmVtb3ZlRXh0cmFDb2x1bW4gPSAkY29sdW1uIC0gMTA7Cn0KCgpmdW5jdGlvbiBzdXBwbGllclBheW1lbnRUZXJtKCkKewogICAgCiAgICByZXR1cm4gXEFwcFxNb2RlbHNcUG1zTW9kZWxzXFBheW1lbnRUZXJtOjpzZWxlY3QoJ3Rlcm0nLCAnaWQnKS0+Z2V0KCk7Cn0KCmZ1bmN0aW9uIHN1cHBsaWVyUmVjZWl2ZWRUZXJtKCkKewogICAgcmV0dXJuIFsKICAgICAgICAncGFydGlhbCcgPT4gJ1BhcnRpYWwgUmVjZWl2ZWQnLAogICAgICAgICdmdWxsJyA9PiAnRnVsbCBSZWNlaXZlZCcsCiAgICBdOwp9CgpmdW5jdGlvbiBzdXBwbGllckNyaXRlcmlhKCRzdXBwbGllcikKewogICAgJGRhdGEgPSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xTY2hlbWE6OmdldENvbHVtbkxpc3RpbmcoJ3N1cHBsaWVyX3JhdHRpbmdzJyk7CiAgICAkZGVsZXRlRGVmYXVsdCA9IFswLCAxLCA5LCAxMCwgMTEsIDEyLCAxMywgMTQsIDE1LCAxNl07CiAgICAka2V5cyA9IGFycmF5X2RpZmYoYXJyYXlfa2V5cygkZGF0YSksICRkZWxldGVEZWZhdWx0KTsKICAgICRjb2x1bW5zID0gW107CiAgICAkbG9vcCA9IDA7CiAgICBmb3JlYWNoICgka2V5cyBhcyAkaSA9PiAkdmFsdWUpIHsKICAgICAgICAkbG9vcCsrOwogICAgICAgICRzdXBwbGllckRhdGEgPSAob2JqZWN0KVsKICAgICAgICAgICAgJ25hbWUnID0+IHVjd29yZHMoc3RyX3JlcGxhY2UoJ18nLCAnICcsICRkYXRhWyR2YWx1ZV0pKSwKICAgICAgICAgICAgJ3JhdGluZycgPT4gc2luZ2xlUmF0aW5nR2VuZXJhdGUoJHN1cHBsaWVyLT5TdXBwbGllclJhdGluZ3MoKS0+c3VtKCRkYXRhWyR2YWx1ZV0pLCAkc3VwcGxpZXItPlN1cHBsaWVyUmF0aW5ncygpLT5jb3VudCgpKSwKICAgICAgICAgICAgJ3BvaW50JyA9PiBudW1iZXJfZm9ybWF0KCgkc3VwcGxpZXItPlN1cHBsaWVyUmF0aW5ncygpLT5zdW0oJGRhdGFbJHZhbHVlXSkgLyAkc3VwcGxpZXItPlN1cHBsaWVyUmF0aW5ncygpLT5jb3VudCgpKSwgMikKICAgICAgICBdOwogICAgICAgICR2aWV3ID0gJzx0cj4KCQk8dGg+JyAuICRsb29wIC4gJzwvdGg+CgkJPHRkPicgLiAkc3VwcGxpZXJEYXRhLT5uYW1lIC4gJzwvdGQ+CgkJPHRkPicgLiAkc3VwcGxpZXJEYXRhLT5yYXRpbmcgLiAnPC90ZD4KCQk8dGQ+JyAuICRzdXBwbGllckRhdGEtPnBvaW50IC4gJzwvdGQ+CgkJPC90cj4nOwogICAgICAgICRjb2x1bW5zW10gPSAkdmlldzsKICAgIH0KICAgIHJldHVybiBpbXBsb2RlKCcgJywgJGNvbHVtbnMpOwp9CgpmdW5jdGlvbiBzdXBwbGllckNyaXRlcmlhQ29sdW1ucygpCnsKICAgICRkYXRhID0gXElsbHVtaW5hdGVcU3VwcG9ydFxGYWNhZGVzXFNjaGVtYTo6Z2V0Q29sdW1uTGlzdGluZygnc3VwcGxpZXJfcmF0dGluZ3MnKTsKICAgIAogICAgJGRlbGV0ZURlZmF1bHQgPSBbMCwgMSwgOSwgMTAsIDExLCAxMiwgMTMsIDE0LCAxNSwgMTYsIDE3LCAxOCwgMTldOwogICAgJGtleXMgPSBhcnJheV9kaWZmKGFycmF5X2tleXMoJGRhdGEpLCAkZGVsZXRlRGVmYXVsdCk7CiAgICAkY29sdW1ucyA9IFtdOwogICAgZm9yZWFjaCAoJGtleXMgYXMgJGtleSA9PiAkdikgewogICAgICAgICRjb2x1bW5zWyRrZXldID0gJGRhdGFbJHZdOwogICAgfQogICAgCiAgICByZXR1cm4gJGNvbHVtbnM7Cn0KCmZ1bmN0aW9uIHN1cHBsaWVyT3BlbmluZ0JhbGFuY2UoJHN1cHBsaWVyX2lkLCAkZGF0ZSA9IG51bGwpCnsKICAgICRxdWVyeSA9IFxBcHBcTW9kZWxzXFBtc01vZGVsc1xTdXBwbGllckxlZGdlcnM6OndoZXJlKCdzdXBwbGllcl9pZCcsICRzdXBwbGllcl9pZCk7CiAgICAKICAgIHJldHVybiBbCiAgICAgICAgJ2RlYml0JyA9PiAkcXVlcnktPnN1bSgnZGViaXQnKSwKICAgICAgICAnY3JlZGl0JyA9PiAkcXVlcnktPnN1bSgnY3JlZGl0JyksCiAgICAgICAgJ2JhbGFuY2UnID0+ICgtMSAqICRxdWVyeS0+c3VtKCdkZWJpdCcpKSArICRxdWVyeS0+c3VtKCdjcmVkaXQnKSwKICAgIF07Cn0KCmZ1bmN0aW9uIGN1c3RvbWVyT3BlbmluZ0JhbGFuY2UoJGN1c3RvbWVyX2lkLCAkZGF0ZSA9IG51bGwpCnsKICAgICRxdWVyeSA9IFxBcHBcTW9kZWxzXFNhbGVzXEN1c3RvbWVyTGVkZ2VyOjp3aGVyZSgnY3VzdG9tZXJfaWQnLCAkY3VzdG9tZXJfaWQpOwogICAgCiAgICByZXR1cm4gWwogICAgICAgICdkZWJpdCcgPT4gJHF1ZXJ5LT5zdW0oJ2RlYml0JyksCiAgICAgICAgJ2NyZWRpdCcgPT4gJHF1ZXJ5LT5zdW0oJ2NyZWRpdCcpLAogICAgICAgICdiYWxhbmNlJyA9PiAoLTEgKiAkcXVlcnktPnN1bSgnZGViaXQnKSkgKyAkcXVlcnktPnN1bSgnY3JlZGl0JyksCiAgICBdOwp9CgpmdW5jdGlvbiBkZWxpdmVyYWJsZVdpc2VCdWRnZXQoJHByb2plY3RfaWQsICRkZWxpdmVyYWJsZV9pZCkKewogICAgJHRvdGFsQ29zdCA9IDA7CiAgICAkY2RyID0gW107CiAgICAvLyRyZXF1aXNpdGlvbnMgPSBSZXF1aXNpdGlvbjo6d2hlcmUoWydwcm9qZWN0X2lkJyA9PiAkcHJvamVjdF9pZCwgJ2RlbGl2ZXJhYmxlX2lkJyA9PiAkZGVsaXZlcmFibGVfaWRdKS0+Z2V0KCk7CiAgICAKICAgICRyZXF1aXNpdGlvbnMgPSBSZXF1aXNpdGlvbjo6d2hlcmVIYXMoJ3Byb2plY3RUYXNrLnN1YkRlbGl2ZXJhYmxlLmRlbGl2ZXJhYmxlJywgZnVuY3Rpb24gKCRxdWVyeSkKICAgIHVzZSAoJHByb2plY3RfaWQpIHsKICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncHJvamVjdF9pZCcsICRwcm9qZWN0X2lkKTsKICAgIH0pCiAgICAgICAgLT53aGVyZUhhcygncHJvamVjdFRhc2suc3ViRGVsaXZlcmFibGUuZGVsaXZlcmFibGUnLCBmdW5jdGlvbiAoJHF1ZXJ5KQogICAgICAgIHVzZSAoJGRlbGl2ZXJhYmxlX2lkKSB7CiAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpZCcsICRkZWxpdmVyYWJsZV9pZCk7CiAgICAgICAgfSktPmdldCgpOwogICAgCiAgICBpZiAoJHJlcXVpc2l0aW9ucy0+Y291bnQoKSA+IDApIHsKICAgICAgICBmb3JlYWNoICgkcmVxdWlzaXRpb25zIGFzICRyZXF1aXNpdGlvbikgewogICAgICAgICAgICBmb3JlYWNoICgkcmVxdWlzaXRpb24tPnJlbFJlcXVpc2l0aW9uRGVsaXZlcnkgYXMgJGRlbGl2ZXJ5KSB7CiAgICAgICAgICAgICAgICAkY2RyW10gPSAkZGVsaXZlcnktPnJlZmVyZW5jZV9ubzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAkY2QgPSBhcnJheV91bmlxdWUoJGNkcik7CiAgICAgICAgJHRvdGFsQ29zdCA9IEludmVudG9yeUxvZ3M6OndoZXJlSW4oJ3JlZmVyZW5jZScsICRjZCktPnN1bSgndG90YWxfcHJpY2UnKTsKICAgIH0KICAgIHJldHVybiAkdG90YWxDb3N0Owp9CgpmdW5jdGlvbiBjb25zdW1lZEJ1ZGdldCgkcHJvamVjdF9pZCkKewogICAgJHRvdGFsQ29zdCA9IDA7CiAgICAkY2RyID0gW107CiAgICAKICAgIC8vJHJlcXVpc2l0aW9ucyA9IFJlcXVpc2l0aW9uOjp3aGVyZSgncHJvamVjdF9pZCcsICRwcm9qZWN0X2lkKS0+Z2V0KCk7CiAgICAkcmVxdWlzaXRpb25zID0gUmVxdWlzaXRpb246OndoZXJlSGFzKCdwcm9qZWN0VGFzay5zdWJEZWxpdmVyYWJsZS5kZWxpdmVyYWJsZScsIGZ1bmN0aW9uICgkcXVlcnkpCiAgICB1c2UgKCRwcm9qZWN0X2lkKSB7CiAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3Byb2plY3RfaWQnLCAkcHJvamVjdF9pZCk7CiAgICB9KS0+Z2V0KCk7CiAgICAKICAgIGlmICgkcmVxdWlzaXRpb25zLT5jb3VudCgpID4gMCkgewogICAgICAgIGZvcmVhY2ggKCRyZXF1aXNpdGlvbnMgYXMgJHJlcXVpc2l0aW9uKSB7CiAgICAgICAgICAgIGZvcmVhY2ggKCRyZXF1aXNpdGlvbi0+cmVsUmVxdWlzaXRpb25EZWxpdmVyeSBhcyAkZGVsaXZlcnkpIHsKICAgICAgICAgICAgICAgICRjZHJbXSA9ICRkZWxpdmVyeS0+cmVmZXJlbmNlX25vOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICRjZCA9IGFycmF5X3VuaXF1ZSgkY2RyKTsKICAgICAgICAkdG90YWxDb3N0ID0gSW52ZW50b3J5TG9nczo6d2hlcmVJbigncmVmZXJlbmNlJywgJGNkKS0+c3VtKCd0b3RhbF9wcmljZScpOwogICAgfQogICAgcmV0dXJuICR0b3RhbENvc3Q7Cn0KCmZ1bmN0aW9uIGRvd25sb2FkUERGKCRuYW1lLCAkZGF0YSwgJHZpZXcsICRwYXBlciwgJG9yaWVudGF0aW9uKQp7CiAgICByZXR1cm4gXFBERjo6bG9hZFZpZXcoJHZpZXcsICRkYXRhKS0+c2V0UGFwZXIoJHBhcGVyLCAkb3JpZW50YXRpb24pLT5zZXRPcHRpb25zKFsnZGVmYXVsdEZvbnQnID0+ICdzYW5zLXNlcmlmJ10pLT5zZXRPcHRpb25zKGFycmF5KCdpc1JlbW90ZUVuYWJsZWQnID0+IHRydWUpKS0+c2V0T3B0aW9ucyhhcnJheSgnRE9NUERGX0VOQUJMRV9DU1NfRkxPQVQgJyA9PiB0cnVlKSktPmRvd25sb2FkKCRuYW1lIC4gJy0oJyAuIGRhdGUoJ0YgaixZIGc6aSBhJykgLiAnKS5wZGYnKTsKfQoKZnVuY3Rpb24gZG93bmxvYWRFeGNlbCgkdmlldywgJGRhdGEsICRuYW1lLCAkdHlwZSA9ICd4bHN4JykKewogICAgcmV0dXJuIFxFeGNlbDo6ZG93bmxvYWQobmV3IFxBcHBcRXhwb3J0c1xFeGNlbCgkdmlldywgJGRhdGEpLCAkbmFtZSAuICcoJyAuIGRhdGUoJ0YgaixZIGc6aSBhJykgLiAnKScgLiAnLicgLiAkdHlwZSk7Cn0KCmZ1bmN0aW9uIGdldERlcGFydG1lbnRIZWFkKCR1c2VyX2lkKQp7CiAgICAkdXNlciA9IFVzZXI6OmZpbmQoJHVzZXJfaWQpOwogICAgJHVzZXJzID0gVXNlcjo6d2hlcmVIYXMoJ2VtcGxveWVlJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkdXNlcikgewogICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhc191bml0X2lkJywgJHVzZXItPmVtcGxveWVlLT5hc191bml0X2lkKQogICAgICAgICAgICAtPndoZXJlKCdhc19kZXBhcnRtZW50X2lkJywgJHVzZXItPmVtcGxveWVlLT5hc19kZXBhcnRtZW50X2lkKTsKICAgIH0pLT5nZXQoKTsKICAgIAogICAgJGhlYWRzID0gW107CiAgICBpZiAoaXNzZXQoJHVzZXJzWzBdKSkgewogICAgICAgIGZvcmVhY2ggKCR1c2VycyBhcyAkdXNlcikgewogICAgICAgICAgICBpZiAoJHVzZXItPmhhc1JvbGUoJ0RlcGFydG1lbnQtSGVhZCcpKSB7CiAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRoZWFkcywgJHVzZXItPmlkKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIAogICAgJHVzZXJEYXRhID0gVXNlcjo6d2hlcmVJbignaWQnLCAkaGVhZHMpLT53aGVyZUhhcygnZW1wbG95ZWUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCR1c2VyKSB7CiAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2FzX3VuaXRfaWQnLCAkdXNlci0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpCiAgICAgICAgICAgIC0+d2hlcmUoJ2FzX2RlcGFydG1lbnRfaWQnLCAkdXNlci0+ZW1wbG95ZWUtPmFzX2RlcGFydG1lbnRfaWQpOwogICAgfSktPmZpcnN0KCk7CiAgICAKICAgIHJldHVybiBpc3NldCgkdXNlckRhdGEtPmlkKSA/ICR1c2VyRGF0YS0+aWQgOiAwOwp9CgpmdW5jdGlvbiBnZXRNYW5hZ2VySW5mbygkcm9sZXNfbmFtZSwgJHVuaXRfaWQgPSBudWxsLCAkYWxsID0gZmFsc2UpCnsKICAgICR1bml0X2lkID0gKCR1bml0X2lkICE9IG51bGwgPyAkdW5pdF9pZCA6IGF1dGgoKS0+dXNlcigpLT5wcmlvcml0aWVzLT5wbHVjaygnaHJfdW5pdF9pZCcpLT50b0FycmF5KClbMF0pOwogICAgJHN1cGVyUGVybWlzc2lvbiA9IFsnUHVyY2hhc2UtRGVwYXJ0bWVudCcsICdNYW5hZ2VtZW50JywgJ0JpbGxpbmcnLCAnQXVkaXQnLCAnQWNjb3VudHMnLCAnR2F0ZSBQZXJtaXNzaW9uJywgJ1F1YWxpdHktRW5zdXJlJywgJ1N0b3JlLU1hbmFnZXInLCAnU0JVIEhlYWQnLCAnU3BvbnNvciddOwogICAgCiAgICBpZiAoaW5fYXJyYXkoJHJvbGVzX25hbWUsICRzdXBlclBlcm1pc3Npb24pKSB7CiAgICAgICAgJHVzZXJzID0gVXNlcjo6d2hlbighZW1wdHkoJHVuaXRfaWQpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCR1bml0X2lkKSB7CiAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdwcmlvcml0aWVzJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkdW5pdF9pZCkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX3VuaXRfaWQnLCAkdW5pdF9pZCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pLT5nZXQoKTsKICAgIH0gZWxzZSB7CiAgICAgICAgJHVzZXJzID0gVXNlcjo6d2hlbihpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdwcmlvcml0aWVzJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX3VuaXRfaWQnLCBhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnaHJfZGVwYXJ0bWVudF9pZCcsIGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfZGVwYXJ0bWVudF9pZCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pLT5nZXQoKTsKICAgIH0KICAgIAogICAgJGhlYWRzID0gW107CiAgICBpZiAoaXNzZXQoJHVzZXJzWzBdKSkgewogICAgICAgIGZvcmVhY2ggKCR1c2VycyBhcyAkdXNlcikgewogICAgICAgICAgICBpZiAoJHVzZXItPmhhc1JvbGUoJHJvbGVzX25hbWUpKSB7CiAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRoZWFkcywgJHVzZXItPmlkKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIAogICAgaWYgKCRhbGwpIHsKICAgICAgICByZXR1cm4gVXNlcjo6d2hlcmVJbignaWQnLCAkaGVhZHMpLT5wbHVjaygnaWQnKS0+dG9BcnJheSgpOwogICAgfQogICAgCiAgICAkdXNlckRhdGEgPSBVc2VyOjp3aGVyZUluKCdpZCcsICRoZWFkcyktPmZpcnN0KCk7CiAgICAKICAgIHJldHVybiBpc3NldCgkdXNlckRhdGEtPmlkKSA/ICR1c2VyRGF0YS0+aWQgOiAwOwp9CgpmdW5jdGlvbiBnZXREZXBhcnRtZW50SGVhZEluZm8oJHVuaXRfaWQsICRkZXBhcnRtZW50X2lkKQp7CiAgICAkdXNlcnMgPSBVc2VyOjp3aGVyZUhhcygncHJpb3JpdGllcycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHVuaXRfaWQsICRkZXBhcnRtZW50X2lkKSB7CiAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoWwogICAgICAgICAgICAnaHJfdW5pdF9pZCcgPT4gJHVuaXRfaWQsCiAgICAgICAgICAgICdocl9kZXBhcnRtZW50X2lkJyA9PiAkZGVwYXJ0bWVudF9pZCwKICAgICAgICBdKTsKICAgIH0pLT5nZXQoKTsKICAgIAogICAgJGhlYWRzID0gW107CiAgICBpZiAoaXNzZXQoJHVzZXJzWzBdKSkgewogICAgICAgIGZvcmVhY2ggKCR1c2VycyBhcyAkdXNlcikgewogICAgICAgICAgICBpZiAoJHVzZXItPmhhc1JvbGUoJ0RlcGFydG1lbnQtSGVhZCcpKSB7CiAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRoZWFkcywgJHVzZXItPmlkKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIAogICAgJHVzZXJEYXRhID0gVXNlcjo6d2hlcmVJbignaWQnLCAkaGVhZHMpLT5maXJzdCgpOwogICAgCiAgICByZXR1cm4gaXNzZXQoJHVzZXJEYXRhLT5pZCkgPyAkdXNlckRhdGEtPmlkIDogMDsKfQoKZnVuY3Rpb24gaW5Xb3JkKCRudW1iZXIpCnsKICAgICRoeXBoZW4gPSAnLSc7CiAgICAkY29uanVuY3Rpb24gPSAnIGFuZCAnOwogICAgJHNlcGFyYXRvciA9ICcsICc7CiAgICAkbmVnYXRpdmUgPSAnbmVnYXRpdmUgJzsKICAgICRkZWNpbWFsID0gJyBwb2ludCAnOwogICAgJGRpY3Rpb25hcnkgPSBhcnJheSgKICAgICAgICAwID0+ICd6ZXJvJywKICAgICAgICAxID0+ICdvbmUnLAogICAgICAgIDIgPT4gJ3R3bycsCiAgICAgICAgMyA9PiAndGhyZWUnLAogICAgICAgIDQgPT4gJ2ZvdXInLAogICAgICAgIDUgPT4gJ2ZpdmUnLAogICAgICAgIDYgPT4gJ3NpeCcsCiAgICAgICAgNyA9PiAnc2V2ZW4nLAogICAgICAgIDggPT4gJ2VpZ2h0JywKICAgICAgICA5ID0+ICduaW5lJywKICAgICAgICAxMCA9PiAndGVuJywKICAgICAgICAxMSA9PiAnZWxldmVuJywKICAgICAgICAxMiA9PiAndHdlbHZlJywKICAgICAgICAxMyA9PiAndGhpcnRlZW4nLAogICAgICAgIDE0ID0+ICdmb3VydGVlbicsCiAgICAgICAgMTUgPT4gJ2ZpZnRlZW4nLAogICAgICAgIDE2ID0+ICdzaXh0ZWVuJywKICAgICAgICAxNyA9PiAnc2V2ZW50ZWVuJywKICAgICAgICAxOCA9PiAnZWlnaHRlZW4nLAogICAgICAgIDE5ID0+ICduaW5ldGVlbicsCiAgICAgICAgMjAgPT4gJ3R3ZW50eScsCiAgICAgICAgMzAgPT4gJ3RoaXJ0eScsCiAgICAgICAgNDAgPT4gJ2ZvdXJ0eScsCiAgICAgICAgNTAgPT4gJ2ZpZnR5JywKICAgICAgICA2MCA9PiAnc2l4dHknLAogICAgICAgIDcwID0+ICdzZXZlbnR5JywKICAgICAgICA4MCA9PiAnZWlnaHR5JywKICAgICAgICA5MCA9PiAnbmluZXR5JywKICAgICAgICAxMDAgPT4gJ2h1bmRyZWQnLAogICAgICAgIDEwMDAgPT4gJ3Rob3VzYW5kJywKICAgICAgICAxMDAwMDAwID0+ICdtaWxsaW9uJywKICAgICAgICAxMDAwMDAwMDAwID0+ICdiaWxsaW9uJywKICAgICAgICAxMDAwMDAwMDAwMDAwID0+ICd0cmlsbGlvbicsCiAgICAgICAgMTAwMDAwMDAwMDAwMDAwMCA9PiAncXVhZHJpbGxpb24nLAogICAgICAgIDEwMDAwMDAwMDAwMDAwMDAwMDAgPT4gJ3F1aW50aWxsaW9uJwogICAgKTsKICAgIAogICAgaWYgKCFpc19udW1lcmljKCRudW1iZXIpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgCiAgICBpZiAoKCRudW1iZXIgPj0gMCAmJiAoaW50KSRudW1iZXIgPCAwKSB8fCAoaW50KSRudW1iZXIgPCAwIC0gUEhQX0lOVF9NQVgpIHsKICAgICAgICAvLyBvdmVyZmxvdwogICAgICAgIHRyaWdnZXJfZXJyb3IoCiAgICAgICAgICAgICdTeXN0ZW0gb25seSBhY2NlcHRzIG51bWJlcnMgYmV0d2VlbiAtJyAuIFBIUF9JTlRfTUFYIC4gJyBhbmQgJyAuIFBIUF9JTlRfTUFYLAogICAgICAgICAgICBFX1VTRVJfV0FSTklORwogICAgICAgICk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgCiAgICBpZiAoJG51bWJlciA8IDApIHsKICAgICAgICByZXR1cm4gJG5lZ2F0aXZlIC4gaW5Xb3JkKGFicygkbnVtYmVyKSk7CiAgICB9CiAgICAKICAgICRzdHJpbmcgPSAkZnJhY3Rpb24gPSBudWxsOwogICAgCiAgICBpZiAoc3RycG9zKCRudW1iZXIsICcuJykgIT09IGZhbHNlKSB7CiAgICAgICAgbGlzdCgkbnVtYmVyLCAkZnJhY3Rpb24pID0gZXhwbG9kZSgnLicsICRudW1iZXIpOwogICAgfQogICAgCiAgICBzd2l0Y2ggKHRydWUpIHsKICAgICAgICBjYXNlICRudW1iZXIgPCAyMToKICAgICAgICAgICAgJHN0cmluZyA9ICRkaWN0aW9uYXJ5WyRudW1iZXJdOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICRudW1iZXIgPCAxMDA6CiAgICAgICAgICAgICR0ZW5zID0gKChpbnQpKCRudW1iZXIgLyAxMCkpICogMTA7CiAgICAgICAgICAgICR1bml0cyA9ICRudW1iZXIgJSAxMDsKICAgICAgICAgICAgJHN0cmluZyA9ICRkaWN0aW9uYXJ5WyR0ZW5zXTsKICAgICAgICAgICAgaWYgKCR1bml0cykgewogICAgICAgICAgICAgICAgJHN0cmluZyAuPSAkaHlwaGVuIC4gJGRpY3Rpb25hcnlbJHVuaXRzXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICRudW1iZXIgPCAxMDAwOgogICAgICAgICAgICAkaHVuZHJlZHMgPSAkbnVtYmVyIC8gMTAwOwogICAgICAgICAgICAkcmVtYWluZGVyID0gJG51bWJlciAlIDEwMDsKICAgICAgICAgICAgJHN0cmluZyA9ICRkaWN0aW9uYXJ5WyRodW5kcmVkc10gLiAnICcgLiAkZGljdGlvbmFyeVsxMDBdOwogICAgICAgICAgICBpZiAoJHJlbWFpbmRlcikgewogICAgICAgICAgICAgICAgJHN0cmluZyAuPSAkY29uanVuY3Rpb24gLiBpbldvcmQoJHJlbWFpbmRlcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgJGJhc2VVbml0ID0gcG93KDEwMDAsIGZsb29yKGxvZygkbnVtYmVyLCAxMDAwKSkpOwogICAgICAgICAgICAkbnVtQmFzZVVuaXRzID0gKGludCkoJG51bWJlciAvICRiYXNlVW5pdCk7CiAgICAgICAgICAgICRyZW1haW5kZXIgPSAkbnVtYmVyICUgJGJhc2VVbml0OwogICAgICAgICAgICAkc3RyaW5nID0gaW5Xb3JkKCRudW1CYXNlVW5pdHMpIC4gJyAnIC4gJGRpY3Rpb25hcnlbJGJhc2VVbml0XTsKICAgICAgICAgICAgaWYgKCRyZW1haW5kZXIpIHsKICAgICAgICAgICAgICAgICRzdHJpbmcgLj0gJHJlbWFpbmRlciA8IDEwMCA/ICRjb25qdW5jdGlvbiA6ICRzZXBhcmF0b3I7CiAgICAgICAgICAgICAgICAkc3RyaW5nIC49IGluV29yZCgkcmVtYWluZGVyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgIH0KICAgIAogICAgaWYgKG51bGwgIT09ICRmcmFjdGlvbiAmJiBpc19udW1lcmljKCRmcmFjdGlvbikpIHsKICAgICAgICAkc3RyaW5nIC49ICRkZWNpbWFsOwogICAgICAgICR3b3JkcyA9IGFycmF5KCk7CiAgICAgICAgZm9yZWFjaCAoc3RyX3NwbGl0KChzdHJpbmcpJGZyYWN0aW9uKSBhcyAkbnVtYmVyKSB7CiAgICAgICAgICAgICR3b3Jkc1tdID0gJGRpY3Rpb25hcnlbJG51bWJlcl07CiAgICAgICAgfQogICAgICAgICRzdHJpbmcgLj0gaW1wbG9kZSgnICcsICR3b3Jkcyk7CiAgICB9CiAgICAKICAgIHJldHVybiB1Y2ZpcnN0KCRzdHJpbmcpOwp9CgpmdW5jdGlvbiBpbldvcmRCbigkbnVtYmVyLCAkdGFrYSA9IHRydWUsICRjdXJyZW5jeSA9ICd0YWthJywgJGN1cnJlbmN5X2h1bmRyZWRzID0gJ3BhaXNhJykKewogICAgaWYgKCgkbnVtYmVyIDwgMCkgfHwgKCRudW1iZXIgPiA5OTk5OTk5OTk5OTkpKSB7CiAgICAgICAgcmV0dXJuICcnOwogICAgfQogICAgCiAgICAkZnJhY3Rpb24gPSBudWxsOwogICAgaWYgKHN0cnBvcygkbnVtYmVyLCAnLicpICE9PSBmYWxzZSkgewogICAgICAgIGxpc3QoJG51bWJlciwgJGZyYWN0aW9uKSA9IGV4cGxvZGUoJy4nLCAkbnVtYmVyKTsKICAgIH0KICAgIAogICAgJGJsID0gZmxvb3IoJG51bWJlciAvIDEwMDAwMDAwMDApOyAvKiBiaWxsaW9uICovCiAgICAkbnVtYmVyIC09ICRibCAqIDEwMDAwMDAwOwogICAgJEt0ID0gZmxvb3IoJG51bWJlciAvIDEwMDAwMDAwKTsgLyogS290aSAqLwogICAgJG51bWJlciAtPSAkS3QgKiAxMDAwMDAwMDsKICAgICRHbiA9IGZsb29yKCRudW1iZXIgLyAxMDAwMDApOyAgLyogbGFraCAgKi8KICAgICRudW1iZXIgLT0gJEduICogMTAwMDAwOwogICAgJGtuID0gZmxvb3IoJG51bWJlciAvIDEwMDApOyAgICAgLyogVGhvdXNhbmRzIChraWxvKSAqLwogICAgJG51bWJlciAtPSAka24gKiAxMDAwOwogICAgJEhuID0gZmxvb3IoJG51bWJlciAvIDEwMCk7ICAgICAgLyogSHVuZHJlZHMgKGhlY3RvKSAqLwogICAgJG51bWJlciAtPSAkSG4gKiAxMDA7CiAgICAkRG4gPSBmbG9vcigkbnVtYmVyIC8gMTApOyAgICAgICAvKiBUZW5zIChkZWNhKSAqLwogICAgJG4gPSAkbnVtYmVyICUgMTA7ICAgICAgICAgICAgICAgLyogT25lcyAqLwogICAgCiAgICAkcmVzID0gIiI7CiAgICAKICAgIGlmICgkYmwpIHsKICAgICAgICAkcmVzIC49IGluV29yZEJuKCRibCwgZmFsc2UsICRjdXJyZW5jeSwgJGN1cnJlbmN5X2h1bmRyZWRzKSAuICIgYmlsbGlvbiAiOwogICAgfQogICAgCiAgICBpZiAoJEt0KSB7CiAgICAgICAgJHJlcyAuPSBpbldvcmRCbigkS3QsIGZhbHNlLCAkY3VycmVuY3ksICRjdXJyZW5jeV9odW5kcmVkcykgLiAiIGNvcmUgIjsKICAgIH0KICAgIAogICAgaWYgKCRHbikgewogICAgICAgICRyZXMgLj0gaW5Xb3JkQm4oJEduLCBmYWxzZSwgJGN1cnJlbmN5LCAkY3VycmVuY3lfaHVuZHJlZHMpIC4gIiBsYWMiOwogICAgfQogICAgCiAgICBpZiAoJGtuKSB7CiAgICAgICAgJHJlcyAuPSAoZW1wdHkoJHJlcykgPyAiIiA6ICIgIikgLgogICAgICAgICAgICBpbldvcmRCbigka24sIGZhbHNlLCAkY3VycmVuY3ksICRjdXJyZW5jeV9odW5kcmVkcykgLiAiIFRob3VzYW5kIjsKICAgIH0KICAgIAogICAgaWYgKCRIbikgewogICAgICAgICRyZXMgLj0gKGVtcHR5KCRyZXMpID8gIiIgOiAiICIpIC4KICAgICAgICAgICAgaW5Xb3JkQm4oJEhuLCBmYWxzZSwgJGN1cnJlbmN5LCAkY3VycmVuY3lfaHVuZHJlZHMpIC4gIiBIdW5kcmVkIjsKICAgIH0KICAgIAogICAgJG9uZXMgPSBhcnJheSgiIiwgIk9uZSIsICJUd28iLCAiVGhyZWUiLCAiRm91ciIsICJGaXZlIiwgIlNpeCIsCiAgICAgICAgIlNldmVuIiwgIkVpZ2h0IiwgIk5pbmUiLCAiVGVuIiwgIkVsZXZlbiIsICJUd2VsdmUiLCAiVGhpcnRlZW4iLAogICAgICAgICJGb3VydGVlbiIsICJGaWZ0ZWVuIiwgIlNpeHRlZW4iLCAiU2V2ZW50ZWVuIiwgIkVpZ2h0dGVlbiIsCiAgICAgICAgIk5pbmV0ZWVuIik7CiAgICAkdGVucyA9IGFycmF5KCIiLCAiIiwgIlR3ZW50eSIsICJUaGlydHkiLCAiRm91cnR5IiwgIkZpZnR5IiwgIlNpeHR5IiwKICAgICAgICAiU2V2ZW50eSIsICJFaWd0aHkiLCAiTmluZXR5Iik7CiAgICAKICAgIGlmICgkRG4gfHwgJG4pIHsKICAgICAgICBpZiAoIWVtcHR5KCRyZXMpKSB7CiAgICAgICAgICAgICRyZXMgLj0gIiAiOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAoJERuIDwgMikgewogICAgICAgICAgICAkcmVzIC49ICRvbmVzWyREbiAqIDEwICsgJG5dOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRyZXMgLj0gJHRlbnNbJERuXTsKICAgICAgICAgICAgaWYgKCRuKSB7CiAgICAgICAgICAgICAgICAkcmVzIC49ICItIiAuICRvbmVzWyRuXTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIAogICAgaWYgKGVtcHR5KCRyZXMpKSB7CiAgICAgICAgJHJlcyA9ICJ6ZXJvIjsKICAgIH0KICAgIAogICAgaWYgKCR0YWthKSB7CiAgICAgICAgJHJlcyAuPSAnICcgLiAkY3VycmVuY3kgLiAnICc7CiAgICB9CiAgICAKICAgIGlmIChudWxsICE9PSAkZnJhY3Rpb24gJiYgaXNfbnVtZXJpYygkZnJhY3Rpb24pICYmICRmcmFjdGlvbiA+IDApIHsKICAgICAgICAkcmVzIC49ICcgYW5kICc7CiAgICAgICAgJGZyYWN0aW9uID0gc3Vic3RyKCRmcmFjdGlvbiwgMCwgMik7CiAgICAgICAgJGZyYWN0aW9uID0gc3RybGVuKCRmcmFjdGlvbikgPT0gMSA/IChpbnQpKCRmcmFjdGlvbikgKiAxMCA6IChpbnQpKCRmcmFjdGlvbik7CiAgICAgICAgaWYgKCRmcmFjdGlvbiA+IDApIHsKICAgICAgICAgICAgJHJlcyAuPSBpbldvcmRCbigkZnJhY3Rpb24sIGZhbHNlLCAkY3VycmVuY3ksICRjdXJyZW5jeV9odW5kcmVkcykgLiAnICcgLiAkY3VycmVuY3lfaHVuZHJlZHM7CiAgICAgICAgfQogICAgfQogICAgCiAgICByZXR1cm4gdWN3b3JkcyhzdHJfcmVwbGFjZSgnLScsICcgJywgJHJlcykpOwp9CgpmdW5jdGlvbiB2aWV3TVBERigkdmlldywgJGRhdGEsICR0aXRsZSwgJGZpbGVuYW1lLCAkZm9ybWF0ID0gJ2E0JywgJG9yaWVudGF0aW9uID0gJ1AnKQp7CiAgICBcUERGOjpsb2FkVmlldygkdmlldywgJGRhdGEsIFtdLCBbCiAgICAgICAgJ3RpdGxlJyA9PiAkdGl0bGUsCiAgICAgICAgJ21hcmdpbl90b3AnID0+IDAsCiAgICAgICAgJ3Nob3dJbWFnZUVycm9ycycgPT4gdHJ1ZSwKICAgICAgICAnZm9ybWF0JyA9PiAkZm9ybWF0LAogICAgICAgICdvcmllbnRhdGlvbicgPT4gJG9yaWVudGF0aW9uLAogICAgICAgIC8vJ3Nob3dfd2F0ZXJtYXJrX2ltYWdlJyA9PiB0cnVlLAogICAgICAgIC8vJ2Rpc3BsYXlfbW9kZScgPT4gJ2Z1bGxwYWdlJywKICAgICAgICAvLyd3YXRlcm1hcmtfaW1hZ2VfcGF0aCcgPT4gcHVibGljX3BhdGgoJy9hc3NldHMvaWRjYXJkL2xldHRlcmhlYWQvbWJtX2xldHRlcmhlYWQucG5nJyksCiAgICAgICAgLy8nd2F0ZXJtYXJrX2ltYWdlX3NpemUnICAgICAgID0+ICdEJywKICAgIF0pLT5zdHJlYW0oJGZpbGVuYW1lIC4gJy5wZGYnKTsKfQoKZnVuY3Rpb24gb3V0cHV0TVBERigkdmlldywgJGRhdGEsICR0aXRsZSwgJGZpbGVuYW1lLCAkZm9ybWF0ID0gJ2E0JywgJG9yaWVudGF0aW9uID0gJ1AnKQp7CiAgICByZXR1cm4gXFBERjo6bG9hZFZpZXcoJHZpZXcsICRkYXRhLCBbXSwgWwogICAgICAgICd0aXRsZScgPT4gJHRpdGxlLAogICAgICAgICdtYXJnaW5fdG9wJyA9PiAwLAogICAgICAgICdzaG93SW1hZ2VFcnJvcnMnID0+IHRydWUsCiAgICAgICAgJ2Zvcm1hdCcgPT4gJGZvcm1hdCwKICAgIF0pLT5vdXRwdXQoKTsKfQoKZnVuY3Rpb24gZG93bmxvYWRNUERGKCR2aWV3LCAkZGF0YSwgJHRpdGxlLCAkZmlsZW5hbWUsICRmb3JtYXQgPSAnYTQnLCAkb3JpZW50YXRpb24gPSAnUCcpCnsKICAgIFxQREY6OmxvYWRWaWV3KCR2aWV3LCAkZGF0YSwgW10sIFsKICAgICAgICAndGl0bGUnID0+ICR0aXRsZSwKICAgICAgICAnbWFyZ2luX3RvcCcgPT4gMCwKICAgICAgICAnc2hvd0ltYWdlRXJyb3JzJyA9PiB0cnVlLAogICAgICAgICdvcmllbnRhdGlvbicgPT4gJG9yaWVudGF0aW9uCiAgICBdKS0+ZG93bmxvYWQoJGZpbGVuYW1lIC4gJ18nIC4gZGF0ZSgnWS1tLWQgZzppIGEnKSAuICcucGRmJyk7Cn0KCmZ1bmN0aW9uIHByaW50QmFyY29kZSgkYmFyY29kZSwgJHN0eWxlID0gJycsICRsZXR0ZXJfc3BhY2luZyA9ICcxMnB4JykKewogICAgcmV0dXJuICc8ZGl2IGNsYXNzPSJ0ZXh0LWNlbnRlciIgc3R5bGU9IicgLiAkc3R5bGUgLiAnIj4KCQk8aW1nIHNyYz0iZGF0YTppbWFnZS9wbmc7YmFzZTY0LCcgLiBETlMxRDo6Z2V0QmFyY29kZVBORygkYmFyY29kZSwgJ0MzOScsIDEsIDMzKSAuICciIGFsdD0iJyAuICRiYXJjb2RlIC4gJyIvPgoJCTxicj4KCQk8c3BhbiBzdHlsZT0ibGV0dGVyLXNwYWNpbmc6ICcgLiAkbGV0dGVyX3NwYWNpbmcgLiAnOyI+JyAuICRiYXJjb2RlIC4gJzwvc3Bhbj4KCTwvZGl2Pic7Cn0KCmZ1bmN0aW9uIHdvcmRSZXN0cmljdGlvbnMoKQp7CiAgICAkd29yZHMgPSBbXTsKICAgICRyb2xlcyA9IFxTcGF0aWVcUGVybWlzc2lvblxNb2RlbHNcUm9sZTo6d2hlcmVJbignbmFtZScsIGF1dGgoKS0+dXNlcigpLT5nZXRSb2xlTmFtZXMoKSktPmdldCgpOwogICAgaWYgKGlzc2V0KCRyb2xlc1swXSkpIHsKICAgICAgICBmb3JlYWNoICgkcm9sZXMgYXMgJGtleSA9PiAkcm9sZSkgewogICAgICAgICAgICAkcmVzdHJpY3Rpb25zID0gYXJyYXlfbWFwKGZ1bmN0aW9uICgkdmFsdWUpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzdHJ0b2xvd2VyKCR2YWx1ZSk7CiAgICAgICAgICAgIH0sIGlzc2V0KGpzb25fZGVjb2RlKCRyb2xlLT53b3JkX3Jlc3RyaWN0aW9ucywgdHJ1ZSlbMF0pID8ganNvbl9kZWNvZGUoJHJvbGUtPndvcmRfcmVzdHJpY3Rpb25zLCB0cnVlKSA6IFtdKTsKICAgICAgICAgICAgaWYgKGlzc2V0KCRyZXN0cmljdGlvbnNbMF0pKSB7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkcmVzdHJpY3Rpb25zIGFzICRrZXkgPT4gJHJlc3RyaWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkd29yZHMsICRyZXN0cmljdGlvbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAKICAgIHJldHVybiBhcnJheV91bmlxdWUoJHdvcmRzKTsKfQoKCmZ1bmN0aW9uIGlzU3VwcGxpZXJSYXRpbmcoJGtleSwgJHZhbHVlLCAkdHlwZSkKewogICAgJHN1cHBsaWVyUmF0aW5ncyA9IFN1cHBsaWVyUmF0aW5nczo6d2hlcmUoJ2tleScsICRrZXkpLT53aGVyZSgndmFsdWUnLCAkdmFsdWUpLT53aGVyZSgndHlwZScsICR0eXBlKS0+Zmlyc3QoKTsKICAgIGlmIChpc3NldCgkc3VwcGxpZXJSYXRpbmdzLT5pZCkpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKfQoKZnVuY3Rpb24gcmVxdWlzaXRpb25IYXNTdG9jaygkcmVxdWlzaXRpb25faWQpCnsKICAgICRyZXF1aXNpdGlvbiA9IFxBcHBcTW9kZWxzXFBtc01vZGVsc1xSZXF1aXNpdGlvbjo6ZmluZCgkcmVxdWlzaXRpb25faWQpOwogICAgaWYgKCFpc3NldCgkcmVxdWlzaXRpb24tPmlkKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIAogICAgaWYgKCRyZXF1aXNpdGlvbi0+aXNfc2VuZF90b19yZnAgPT0gJ3llcycpIHsKICAgICAgICAkc3RvY2tzID0gXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEdyblxHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW46OndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyLnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRyZXF1aXNpdGlvbikgewogICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncmVxdWlzaXRpb25faWQnLCAkcmVxdWlzaXRpb24tPmlkKTsKICAgICAgICB9KQogICAgICAgICAgICAtPnN1bSgncmVjZWl2ZWRfcXR5Jyk7CiAgICAgICAgaWYgKCRzdG9ja3MgPD0gMCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQogICAgCiAgICByZXR1cm4gdHJ1ZTsKfQoKZnVuY3Rpb24gdmVyaWZ5QXZhaWxhYmxlU3RvY2soJHJlcXVpc2l0aW9uSWQsICRpdGVtSWQgPSBudWxsKQp7CiAgICAkcmVxdWlzaXRpb24gPSBSZXF1aXNpdGlvbjo6d2l0aChbJ2l0ZW1zLnByb2R1Y3QuY2F0ZWdvcnknLCAnaXRlbXMuYXR0cmlidXRlcyddKQogICAgICAgIC0+ZmluZCgkcmVxdWlzaXRpb25JZCk7CgogICAgaWYgKCEkcmVxdWlzaXRpb24pIHsKICAgICAgICByZXR1cm4gMDsKICAgIH0KCiAgICAkdW5pdElkID0gYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkID8/IDA7CiAgICAkd2FyZWhvdXNlSWRzID0gYXV0aCgpLT51c2VyKCktPnJlbFVzZXJzV2FyZWhvdXNlLT5wbHVjaygnaWQnKS0+dG9BcnJheSgpOwoKICAgICRpdGVtcyA9ICRyZXF1aXNpdGlvbi0+aXRlbXM7CiAgICBpZiAoJGl0ZW1JZCAhPT0gbnVsbCkgewogICAgICAgICRpdGVtcyA9ICRpdGVtcy0+ZmlsdGVyKGZuKCRpdGVtKSA9PiAkaXRlbS0+aWQgPT0gJGl0ZW1JZCk7CiAgICB9CgogICAgJHRvdGFsU3RvY2sgPSAwOwoKICAgIGZvcmVhY2ggKCRpdGVtcyBhcyAkaXRlbSkgewogICAgICAgICRhdHRyaWJ1dGVJZHMgPSAkaXRlbS0+YXR0cmlidXRlcy0+cGx1Y2soJ2F0dHJpYnV0ZV9vcHRpb25faWQnKS0+dG9BcnJheSgpOwoKICAgICAgICAkYXZhaWxhYmxlU3RvY2sgPSBJbnZlbnRvcnlMb2dzOjp3aGVyZUluKCd3YXJlaG91c2VfaWQnLCAkd2FyZWhvdXNlSWRzKQogICAgICAgICAgICAtPndoZXJlSGFzKCdzdG9ja0luLnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy5hdHRyaWJ1dGVzJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UgKCRpdGVtLCAkYXR0cmlidXRlSWRzKXsKICAgICAgICAgICAgICAgICRxdWVyeS0+c2VsZWN0KFxEQjo6cmF3KCdjb3VudChkaXN0aW5jdCBpZCknKSkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ2F0dHJpYnV0ZV9vcHRpb25faWQnLCAkYXR0cmlidXRlSWRzKTsKICAgICAgICAgICAgfSwgJz0nLCBjb3VudCgkYXR0cmlidXRlSWRzKSkKICAgICAgICAgICAgLT53aGVyZShbCiAgICAgICAgICAgICAgICAnY2F0ZWdvcnlfaWQnID0+ICRpdGVtLT5wcm9kdWN0LT5jYXRlZ29yeV9pZCwKICAgICAgICAgICAgICAgICdwcm9kdWN0X2lkJyA9PiAkaXRlbS0+cHJvZHVjdF9pZCwKICAgICAgICAgICAgICAgICdocl91bml0X2lkJyA9PiAoaXNzZXQoYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKSA/IGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCA6IDApCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+c3VtKCdhdmFpbGFibGUnKTsKCiAgICAgICAgJHRvdGFsU3RvY2sgKz0gJGF2YWlsYWJsZVN0b2NrOwogICAgfQoKICAgIHJldHVybiAkdG90YWxTdG9jazsKfQoKZnVuY3Rpb24gbGF0ZXN0UHJvZHVjdFByaWNlVXBkYXRlKCRwcm9kdWN0SWQsICR1bml0UHJpY2UpCnsKICAgICRwcm9kdWN0ID0gUHJvZHVjdDo6ZmluZE9yRmFpbCgkcHJvZHVjdElkKTsKICAgIGlmIChpc3NldCgkcHJvZHVjdC0+aWQpKSB7CiAgICAgICAgJHByb2R1Y3QtPnVwZGF0ZShbJ3VuaXRfcHJpY2UnID0+ICR1bml0UHJpY2VdKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKfQoKZnVuY3Rpb24gaW5jbHVkZVVzZXJzKCkKewogICAgJHVzZXJVbml0cyA9IGF1dGgoKS0+dXNlcigpLT5wcmlvcml0aWVzLT5wbHVjaygnaHJfdW5pdF9pZCcpLT50b0FycmF5KCk7CiAgICAkdXNlckRlcGFydG1lbnRzID0gYXV0aCgpLT51c2VyKCktPnByaW9yaXRpZXMtPnBsdWNrKCdocl9kZXBhcnRtZW50X2lkJyktPnRvQXJyYXkoKTsKICAgICR1c2VyU2VjdGlvbnMgPSBhdXRoKCktPnVzZXIoKS0+cHJpb3JpdGllcy0+cGx1Y2soJ2hyX3NlY3Rpb25faWQnKS0+dG9BcnJheSgpOwogICAgCiAgICBpZiAoYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0RlcGFydG1lbnQtSGVhZCcpKSB7CiAgICAgICAgcmV0dXJuIFxBcHBcVXNlcjo6d2hlcmVOb3RJbignaWQnLCBbYXV0aCgpLT51c2VyKCktPmlkXSkKICAgICAgICAgICAgLT53aGVyZUhhcygnZW1wbG95ZWUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCR1c2VyVW5pdHMsICR1c2VyRGVwYXJ0bWVudHMsICR1c2VyU2VjdGlvbnMpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2FzX3VuaXRfaWQnLCAkdXNlclVuaXRzKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmVJbignYXNfZGVwYXJ0bWVudF9pZCcsICR1c2VyRGVwYXJ0bWVudHMpOwogICAgICAgICAgICAgICAgLy8gLT53aGVyZUluKCdhc19zZWN0aW9uX2lkJywgJHVzZXJTZWN0aW9ucyk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmVEb2VzbnRIYXZlKCdtb2RlbEhhc1JvbGVzLnJvbGUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCduYW1lJywgWydEZXBhcnRtZW50LUhlYWQnLCAnU0JVIEhlYWQnLCAnTWFuYWdlbWVudCddKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5wbHVjaygnaWQnKS0+dG9BcnJheSgpOwogICAgfSBlbHNlaWYgKGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdTQlUgSGVhZCcpKSB7CiAgICAgICAgcmV0dXJuIFxBcHBcVXNlcjo6d2hlcmVOb3RJbignaWQnLCBbYXV0aCgpLT51c2VyKCktPmlkXSkKICAgICAgICAgICAgLT53aGVyZUhhcygnZW1wbG95ZWUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCR1c2VyVW5pdHMpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2FzX3VuaXRfaWQnLCAkdXNlclVuaXRzKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZUhhcygnbW9kZWxIYXNSb2xlcy5yb2xlJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnRGVwYXJ0bWVudC1IZWFkJyk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+cGx1Y2soJ2lkJyktPnRvQXJyYXkoKTsKICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIFxBcHBcVXNlcjo6d2hlcmVOb3RJbignaWQnLCBbYXV0aCgpLT51c2VyKCktPmlkXSkKICAgICAgICAgICAgLT53aGVyZUhhcygnbW9kZWxIYXNSb2xlcy5yb2xlJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignbmFtZScsIFsnU0JVIEhlYWQnLCAnTWFuYWdlbWVudCddKTsKICAgICAgICAgICAgfSktPnBsdWNrKCdpZCcpLT50b0FycmF5KCk7CiAgICB9CiAgICAKICAgIHJldHVybiBbXTsKfQoKZnVuY3Rpb24gZ2V0RHVyYXRpb24oJGZyb20sICR0bykKewogICAgJGRheXMgPSByb3VuZCgoKHN0cnRvdGltZSgkdG8pIC0gc3RydG90aW1lKCRmcm9tKSkpIC8gKDYwICogNjAgKiAyNCkpOwogICAgcmV0dXJuICgkZGF5cyA+PSAxID8gKCRmcm9tID09ICR0byA/IDEgOiAkZGF5cyArIDEpIDogMSk7Cn0KCmZ1bmN0aW9uIGdldFByb2dyZXNzRmFzdGVyKCR0YXNrcywgJG5lZWRsZXMgPSBbMCwgMCwgMCwgMF0pCnsKICAgICR0YXNrcyA9IGNvbGxlY3QoJHRhc2tzKTsKICAgIAogICAgaWYgKCRuZWVkbGVzWzBdID4gMCkgewogICAgICAgICR0YXNrcyA9ICR0YXNrcy0+ZmlsdGVyKGZ1bmN0aW9uICgkdGFzaywgJGtleSkgdXNlICgkbmVlZGxlcykgewogICAgICAgICAgICByZXR1cm4gJHRhc2stPnN1YkRlbGl2ZXJhYmxlLT5kZWxpdmVyYWJsZS0+cHJvamVjdF9pZCA9PSAkbmVlZGxlc1swXTsKICAgICAgICB9KTsKICAgICAgICAKICAgICAgICAkdGFza3MtPmFsbCgpOwogICAgfQogICAgCiAgICBpZiAoJG5lZWRsZXNbMV0gPiAwKSB7CiAgICAgICAgJHRhc2tzID0gJHRhc2tzLT5maWx0ZXIoZnVuY3Rpb24gKCR0YXNrLCAka2V5KSB1c2UgKCRuZWVkbGVzKSB7CiAgICAgICAgICAgIHJldHVybiAkdGFzay0+c3ViRGVsaXZlcmFibGUtPmRlbGl2ZXJhYmxlX2lkID09ICRuZWVkbGVzWzFdOwogICAgICAgIH0pOwogICAgICAgIAogICAgICAgICR0YXNrcy0+YWxsKCk7CiAgICB9CiAgICAKICAgIGlmICgkbmVlZGxlc1syXSA+IDApIHsKICAgICAgICAkdGFza3MgPSAkdGFza3MtPmZpbHRlcihmdW5jdGlvbiAoJHRhc2ssICRrZXkpIHVzZSAoJG5lZWRsZXMpIHsKICAgICAgICAgICAgcmV0dXJuICR0YXNrLT5zdWJfZGVsaXZlcmFibGVfaWQgPT0gJG5lZWRsZXNbMl07CiAgICAgICAgfSk7CiAgICAgICAgCiAgICAgICAgJHRhc2tzLT5hbGwoKTsKICAgIH0KICAgIAogICAgaWYgKCRuZWVkbGVzWzNdID4gMCkgewogICAgICAgICR0YXNrcyA9ICR0YXNrcy0+ZmlsdGVyKGZ1bmN0aW9uICgkdGFzaywgJGtleSkgdXNlICgkbmVlZGxlcykgewogICAgICAgICAgICByZXR1cm4gJHRhc2stPmlkID09ICRuZWVkbGVzWzNdOwogICAgICAgIH0pOwogICAgICAgIAogICAgICAgICR0YXNrcy0+YWxsKCk7CiAgICB9CiAgICAKICAgICR0b3RhbFRhc2tzID0gJHRhc2tzLT5jb3VudCgpOwogICAgJGNvbXBsZXRlZFRhc2tzID0gJHRhc2tzLT53aGVyZSgnc3RhdHVzJywgJ2RvbmUnKS0+Y291bnQoKTsKICAgIAogICAgcmV0dXJuICR0b3RhbFRhc2tzID4gMCAmJiAkY29tcGxldGVkVGFza3MgPiAwID8gKCRjb21wbGV0ZWRUYXNrcyAvICR0b3RhbFRhc2tzKSA6IDA7Cn0KCmZ1bmN0aW9uIGxpc3RPZk1vbnRoc0JldHdlZW5EYXRlcygkZnJvbSwgJHRvKQp7CiAgICAkc3RhcnQgPSAobmV3IFxEYXRlVGltZSgkZnJvbSkpLT5tb2RpZnkoJ2ZpcnN0IGRheSBvZiB0aGlzIG1vbnRoJyk7CiAgICAkZW5kID0gKG5ldyBcRGF0ZVRpbWUoJHRvKSktPm1vZGlmeSgnZmlyc3QgZGF5IG9mIG5leHQgbW9udGgnKTsKICAgICRpbnRlcnZhbCA9IFxEYXRlSW50ZXJ2YWw6OmNyZWF0ZUZyb21EYXRlU3RyaW5nKCcxIG1vbnRoJyk7CiAgICAkcGVyaW9kID0gbmV3IFxEYXRlUGVyaW9kKCRzdGFydCwgJGludGVydmFsLCAkZW5kKTsKICAgIAogICAgJGRhdGVzID0gW107CiAgICBmb3JlYWNoICgkcGVyaW9kIGFzICRkdCkgewogICAgICAgIGFycmF5X3B1c2goJGRhdGVzLCAkZHQtPmZvcm1hdCgiWS1tLWQiKSk7CiAgICB9CiAgICAKICAgIHJldHVybiAkZGF0ZXM7Cn0KCgpmdW5jdGlvbiBwcm9qZWN0U3RhdHVzTGlzdCgkc3RhdHVzID0gZmFsc2UpCnsKICAgICRhcnJheSA9IFsKICAgICAgICAnd2FpdGluZ19mb3Jfc3VibWl0JyA9PiBbCiAgICAgICAgICAgICduYW1lJyA9PiAnRHJhZnQnLAogICAgICAgICAgICAnYmFja2dyb3VuZCcgPT4gJ3JnYig4NSw4NSw4NSwwLjQpJywKICAgICAgICAgICAgJ3Nob3cnID0+IGF1dGgoKS0+dXNlcigpLT5oYXNBbnlSb2xlKFsnU3VwZXIgQWRtaW4nLCAnTWFuYWdlbWVudCcsICdQTU8nXSksCiAgICAgICAgXSwKICAgICAgICAnYXBwcm92ZWQnID0+IFsKICAgICAgICAgICAgJ25hbWUnID0+ICdPbmdvaW5nJywKICAgICAgICAgICAgJ2JhY2tncm91bmQnID0+ICdyZ2IoMzUsMTA4LDk4LDAuNCknLAogICAgICAgICAgICAnc2hvdycgPT4gYXV0aCgpLT51c2VyKCktPmhhc0FueVJvbGUoWydTdXBlciBBZG1pbicsICdNYW5hZ2VtZW50JywgJ1BNTycsICdTcG9uc29yJywgJ1BNJywgJ1ByaW1hcnktVXNlcicsICdQcm9qZWN0LUJvYXJkJ10pLAogICAgICAgIF0sCiAgICAgICAgJ3BlbmRpbmcnID0+IFsKICAgICAgICAgICAgJ25hbWUnID0+ICdXYWl0aW5nIEZvciBBcHByb3ZhbCcsCiAgICAgICAgICAgICdiYWNrZ3JvdW5kJyA9PiAncmdiKDI1NSwyMjAsMCwwLjQpJywKICAgICAgICAgICAgJ3Nob3cnID0+IGF1dGgoKS0+dXNlcigpLT5oYXNBbnlSb2xlKFsnU3VwZXIgQWRtaW4nLCAnTWFuYWdlbWVudCcsICdQTU8nLCAnU3BvbnNvcicsICdQcm9qZWN0LUJvYXJkJ10pLAogICAgICAgIF0sCiAgICAgICAgJ3JlYXBwcm92YWwnID0+IFsKICAgICAgICAgICAgJ25hbWUnID0+ICdXYWl0aW5nIEZvciBSZWFwcHJvdmFsJywKICAgICAgICAgICAgJ2JhY2tncm91bmQnID0+ICdyZ2IoMjM5LDExNyw3MCwwLjQpJywKICAgICAgICAgICAgJ3Nob3cnID0+IGF1dGgoKS0+dXNlcigpLT5oYXNBbnlSb2xlKFsnU3VwZXIgQWRtaW4nLCAnTWFuYWdlbWVudCcsICJQTU8iLCAnU3BvbnNvcicsICdQcm9qZWN0LUJvYXJkJ10pLAogICAgICAgIF0sCiAgICAgICAgCiAgICAgICAgJ3BsYW5uZWQnID0+IFsKICAgICAgICAgICAgJ25hbWUnID0+ICdQbGFubmVkJywKICAgICAgICAgICAgJ2JhY2tncm91bmQnID0+ICdyZ2IoOTUsMTczLDIzMiwwLjQpJywKICAgICAgICAgICAgJ3Nob3cnID0+IGF1dGgoKS0+dXNlcigpLT5oYXNBbnlSb2xlKFsnU3VwZXIgQWRtaW4nLCAnTWFuYWdlbWVudCcsICJQTU8iLCAnU3BvbnNvcicsICdQcm9qZWN0LUJvYXJkJ10pLAogICAgICAgIF0KICAgIF07CiAgICAKICAgIGlmICgkc3RhdHVzKSB7CiAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoJHN0YXR1cywgJGFycmF5KSkgewogICAgICAgICAgICByZXR1cm4gJGFycmF5WyRzdGF0dXNdOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcmV0dXJuICRhcnJheTsKfQoKZnVuY3Rpb24gcmFuZG9tQ29sb3IoKQp7CiAgICAkY2hhcnMgPSAnQUJDREVGMDEyMzQ1Njc4OSc7CiAgICAkY29sb3IgPSAnIyc7CiAgICBmb3IgKCRpID0gMDsgJGkgPCA2OyAkaSsrKSB7CiAgICAgICAgJGNvbG9yIC49ICRjaGFyc1tyYW5kKDAsIHN0cmxlbigkY2hhcnMpIC0gMSldOwogICAgfQogICAgcmV0dXJuICRjb2xvcjsKfQoKZnVuY3Rpb24gZm9ybWF0Qnl0ZXMoJHNpemUsICRwcmVjaXNpb24gPSAyKQp7CiAgICAkYmFzZSA9IGxvZygkc2l6ZSwgMTAyNCk7CiAgICAkc3VmZml4ZXMgPSBhcnJheSgnJywgJ0tCJywgJ01CJywgJ0dCJywgJ1RCJyk7CiAgICAKICAgIHJldHVybiByb3VuZChwb3coMTAyNCwgJGJhc2UgLSBmbG9vcigkYmFzZSkpLCAkcHJlY2lzaW9uKSAuICcgJyAuICRzdWZmaXhlc1tmbG9vcigkYmFzZSldOwp9CgpmdW5jdGlvbiBnZXRQcm9qZWN0VGFza3MoJHByb2plY3RfaWQpCnsKICAgIHJldHVybiBcQXBwXE1vZGVsc1xNeVByb2plY3RcUHJvamVjdFRhc2s6OndoZXJlSGFzKCdzdWJEZWxpdmVyYWJsZS5kZWxpdmVyYWJsZScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHByb2plY3RfaWQpIHsKICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncHJvamVjdF9pZCcsICRwcm9qZWN0X2lkKTsKICAgIH0pCiAgICAgICAgLT53aGVuKChhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnUHJpbWFyeS1Vc2VyJykgfHwgYXV0aCgpLT51c2VyKCktPmhhc1JvbGUoJ0VtcGxveWVlJykpLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCd1c2VyX2lkJywgYXV0aCgpLT51c2VyKCktPmlkKTsKICAgICAgICB9KS0+cGx1Y2soJ2lkJyktPnRvQXJyYXkoKTsKfQoKZnVuY3Rpb24gZ2V0SG9saWRheXMoJGZ1bGwgPSBmYWxzZSwgJGZyb20gPSBmYWxzZSwgJHRvID0gZmFsc2UpCnsKICAgIGlmICgkZnVsbCkgewogICAgICAgIHJldHVybiBcQXBwXE1vZGVsc1xNeVByb2plY3RcSG9saWRheTo6c2VsZWN0KFxEQjo6cmF3KCJuYW1lLCBTVFJfVE9fREFURShmdWxsX2RhdGUsICclWS0lbS0lZCcpIGFzIGRhdGUsIFNUUl9UT19EQVRFKGZ1bGxfZGF0ZSwgJyVZLSVtLSVkJykgYXMgYGZyb21gLCBTVFJfVE9fREFURShmdWxsX2RhdGUsICclWS0lbS0lZCcpIGFzIGB0b2AiKSkKICAgICAgICAgICAgLT53aGVuKCRmcm9tLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRmcm9tKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZShcREI6OnJhdygiU1RSX1RPX0RBVEUoZnVsbF9kYXRlLCAnJVktJW0tJWQnKSIpLCAnPj0nLCAkZnJvbSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlbigkdG8sIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHRvKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZShcREI6OnJhdygiU1RSX1RPX0RBVEUoZnVsbF9kYXRlLCAnJVktJW0tJWQnKSIpLCAnPD0nLCAkdG8pOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPmdldCgpOwogICAgfQogICAgCiAgICByZXR1cm4gXEFwcFxNb2RlbHNcTXlQcm9qZWN0XEhvbGlkYXk6OnNlbGVjdChcREI6OnJhdygiU1RSX1RPX0RBVEUoZnVsbF9kYXRlLCAnJVktJW0tJWQnKSBhcyBkYXRlIikpLT5ncm91cEJ5KCdkYXRlJyktPnBsdWNrKCdkYXRlJyktPnRvQXJyYXkoKTsKfQoKZnVuY3Rpb24gbnVtYmVyT2Zob2xpZGF5cygkZnJvbSwgJHRvKQp7CiAgICByZXR1cm4gXEFwcFxNb2RlbHNcTXlQcm9qZWN0XEhvbGlkYXk6OndoZXJlKFxEQjo6cmF3KCJTVFJfVE9fREFURShmdWxsX2RhdGUsICclWS0lbS0lZCcpIiksICc+PScsICRmcm9tKS0+d2hlcmUoXERCOjpyYXcoIlNUUl9UT19EQVRFKGZ1bGxfZGF0ZSwgJyVZLSVtLSVkJykiKSwgJzw9JywgJHRvKS0+Z3JvdXBCeSgnZnVsbF9kYXRlJyktPmNvdW50KCk7Cn0KCgpmdW5jdGlvbiBwcm9qZWN0SG9saWRheXMoJHByb2plY3QsICRmcm9tID0gZmFsc2UsICR0byA9IGZhbHNlKQp7CiAgICAkaG9saWRheXMgPSBbXTsKICAgIGlmICgkcHJvamVjdC0+aG9saWRheXMtPmNvdW50KCkgPiAwKSB7CiAgICAgICAgZm9yZWFjaCAoJHByb2plY3QtPmhvbGlkYXlzIGFzICRrZXkgPT4gJGhvbGlkYXkpIHsKICAgICAgICAgICAgJGhvbGlkYXlzID0gYXJyYXlfbWVyZ2UoJGhvbGlkYXlzLCBkYXRlUmFuZ2UoJGhvbGlkYXktPmZyb20sICRob2xpZGF5LT50bykpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgJHdvcmtpbmdEYXlzID0gJHByb2plY3QtPndvcmtpbmdEYXlzLT5wbHVjaygnZGF5JyktPnRvQXJyYXkoKTsKICAgIAogICAgJGZyb20gPSAoJGZyb20gPyAkZnJvbSA6ICRwcm9qZWN0LT5zdGFydF9kYXRlKTsKICAgICR0byA9ICgkdG8gPyAkdG8gOiAkcHJvamVjdC0+ZW5kX2RhdGUpOwogICAgCiAgICAkZGF5cyA9IFtdOwogICAgJGRhdGVSYW5nZSA9IGRhdGVSYW5nZSgkZnJvbSwgJHRvKTsKICAgIGZvcmVhY2ggKCRkYXRlUmFuZ2UgYXMgJGtleSA9PiAkZGF0ZSkgewogICAgICAgIGlmIChpbl9hcnJheSgkZGF0ZSwgJGhvbGlkYXlzKSB8fCAhaW5fYXJyYXkoZGF0ZSgnbCcsIHN0cnRvdGltZSgkZGF0ZSkpLCAkd29ya2luZ0RheXMpKSB7CiAgICAgICAgICAgIGFycmF5X3B1c2goJGRheXMsICRkYXRlKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHJldHVybiAkZGF5czsKfQoKZnVuY3Rpb24gcGF5bWVudFR5cGVzKCRhcCA9IGZhbHNlKQp7CiAgICAkdHlwZXMgPSBbCiAgICAgICAgJ2Nhc2gnID0+IFsKICAgICAgICAgICAgJ25hbWUnID0+ICJDYXNoIiwKICAgICAgICAgICAgJ3RpdGxlJyA9PiAiUGF5bWVudCBEZXRhaWxzIiwKICAgICAgICAgICAgJ3BsYWNlaG9sZGVyJyA9PiAiV3JpdGUgUGF5bWVudCBEZXRhaWxzIiwKICAgICAgICBdLAogICAgICAgICdjaGVxdWUnID0+IFsKICAgICAgICAgICAgJ25hbWUnID0+ICJDaGVxdWUiLAogICAgICAgICAgICAndGl0bGUnID0+ICJDaGVxdWUgTnVtYmVyIiwKICAgICAgICAgICAgJ3BsYWNlaG9sZGVyJyA9PiAiTm8gQ2hlcXVlIEF2YWlsYWJsZSEiLAogICAgICAgIF0sCiAgICAgICAgJ2Z1bmQtdHJhbnNmZXInID0+IFsKICAgICAgICAgICAgJ25hbWUnID0+ICJGdW5kIFRyYW5zZmVyIChSVEdTKSIsCiAgICAgICAgICAgICd0aXRsZScgPT4gIlJUR1MgTnVtYmVyIiwKICAgICAgICAgICAgJ3BsYWNlaG9sZGVyJyA9PiAiV3JpdGUgUlRHUyBSZWZlcmVuY2UgTnVtYmVyIiwKICAgICAgICBdLAogICAgICAgICdvdGhlcnMtZ2wnID0+IFsKICAgICAgICAgICAgJ25hbWUnID0+ICJPdGhlcnMgKENob29zZSBHTCkiLAogICAgICAgICAgICAndGl0bGUnID0+ICJOYXJyYXRpb24iLAogICAgICAgICAgICAncGxhY2Vob2xkZXInID0+ICJXcml0ZSBhIE5hcnJhdGlvbiIsCiAgICAgICAgXSwKICAgIF07CiAgICAKICAgIGlmICgkYXApIHsKICAgICAgICAkdHlwZXNbJ3N1cHBsaWVyLXBheWFibGUnXSA9IFsKICAgICAgICAgICAgJ25hbWUnID0+ICJTdXBwbGllciBQYXlhYmxlIiwKICAgICAgICAgICAgJ3RpdGxlJyA9PiAiSW52b2ljZSIsCiAgICAgICAgICAgICdwbGFjZWhvbGRlcicgPT4gIldyaXRlIEludm9pY2UgbnVtYmVyIiwKICAgICAgICBdOwogICAgfQogICAgCiAgICByZXR1cm4gJHR5cGVzOwp9CgpmdW5jdGlvbiBwb0FkdmFuY2UoJHBvX2lkKQp7CiAgICAkZ3Jvc3NfcHJpY2UgPSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VcUHVyY2hhc2VPcmRlcjo6d2hlcmUoJ2lkJywgJHBvX2lkKS0+c3VtKCdncm9zc19wcmljZScpOwogICAgJGFkdmFuY2UgPSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcU3VwcGxpZXJQYXltZW50Ojp3aGVyZShbCiAgICAgICAgJ2JpbGxfdHlwZScgPT4gJ3BvLWFkdmFuY2UnLAogICAgICAgICdwdXJjaGFzZV9vcmRlcl9pZCcgPT4gJHBvX2lkCiAgICBdKS0+c3VtKCdwYXlfYW1vdW50Jyk7CiAgICAkcGVyY2VudGFnZSA9IDA7CiAgICBpZiAoJGdyb3NzX3ByaWNlID4gMCAmJiAkYWR2YW5jZSA+IDApIHsKICAgICAgICAkcGVyY2VudGFnZSA9ICgoJGFkdmFuY2UgKiAxMDApIC8gJGdyb3NzX3ByaWNlKTsKICAgIH0KICAgIAogICAgcmV0dXJuIFsKICAgICAgICAnZ3Jvc3NfcHJpY2UnID0+ICRncm9zc19wcmljZSwKICAgICAgICAncGVyY2VudGFnZScgPT4gJHBlcmNlbnRhZ2UsCiAgICAgICAgJ2FkdmFuY2UnID0+ICRhZHZhbmNlLAogICAgXTsKfQoKZnVuY3Rpb24gc3VwcGxpZXJTdGF0dXMoJHN1cHBsaWVyKQp7CiAgICByZXR1cm4gWwogICAgICAgICdhcHByb3ZlZF90ZXh0JyA9PiB1Y3dvcmRzKHN0cl9yZXBsYWNlKCctJywgJyAnLCAkc3VwcGxpZXItPmFwcHJvdmVkX2J5KSksCiAgICAgICAgJ2FwcHJvdmVkX2NsYXNzJyA9PiBpbl9hcnJheSgkc3VwcGxpZXItPmFwcHJvdmVkX2J5LCBbJ3B1cmNoYXNlLWFwcHJvdmVkJywgJ21hbmFnZW1lbnQtYXBwcm92ZWQnXSkgPyAnc3VjY2VzcycgOiAoaW5fYXJyYXkoJHN1cHBsaWVyLT5hcHByb3ZlZF9ieSwgWydwdXJjaGFzZS1kZWNsaW5lZCcsICdtYW5hZ2VtZW50LWRlY2xpbmVkJ10pID8gJ2RhbmdlcicgOiAnd2FybmluZycpLAogICAgICAgICdhcHByb3ZlZF9pY29uJyA9PiBpbl9hcnJheSgkc3VwcGxpZXItPmFwcHJvdmVkX2J5LCBbJ3B1cmNoYXNlLWFwcHJvdmVkJywgJ21hbmFnZW1lbnQtYXBwcm92ZWQnXSkgPyAnbGFyIGxhLWNoZWNrLWNpcmNsZScgOiAoaW5fYXJyYXkoJHN1cHBsaWVyLT5hcHByb3ZlZF9ieSwgWydwdXJjaGFzZS1kZWNsaW5lZCcsICdtYW5hZ2VtZW50LWRlY2xpbmVkJ10pID8gJ2xhIGxhLWJhbicgOiAnbGFzIGxhLXF1ZXN0aW9uLWNpcmNsZScpLAogICAgICAgICdhcHByb3ZhbCcgPT4gKGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdQdXJjaGFzZS1EZXBhcnRtZW50JykgJiYgaW5fYXJyYXkoJHN1cHBsaWVyLT5hcHByb3ZlZF9ieSwgWydzZW50LXRvLXB1cmNoYXNlJywgJ3B1cmNoYXNlLWRlY2xpbmVkJ10pID8gdHJ1ZSA6IChhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnTWFuYWdlbWVudCcpICYmIGluX2FycmF5KCRzdXBwbGllci0+YXBwcm92ZWRfYnksIFsncHVyY2hhc2UtYXBwcm92ZWQnLCAnbWFuYWdlbWVudC1kZWNsaW5lZCddKSA/IHRydWUgOiBmYWxzZSkpLAogICAgXTsKfQoKZnVuY3Rpb24gZ2V0VXNlckNvc3RDZW50ZXIoJHVzZXJJZCkKewogICAgJHVzZXIgPSBVc2VyOjp3aXRoKCdlbXBsb3llZScpLT5maW5kKCR1c2VySWQpOwogICAgCiAgICAkY29zdENlbnRlciA9IENvc3RDZW50cmU6OndoZXJlKCdocl91bml0X2lkJywgJHVzZXItPmVtcGxveWVlLT5hc191bml0X2lkKQogICAgICAgIC0+d2hlcmUoJ2hyX2RlcGFydG1lbnRfaWQnLCAkdXNlci0+ZW1wbG95ZWUtPmFzX2RlcGFydG1lbnRfaWQpLT5maXJzdCgpOwogICAgCiAgICBpZiAoJGNvc3RDZW50ZXItPmlkKSB7CiAgICAgICAgcmV0dXJuICRjb3N0Q2VudGVyOwogICAgfQogICAgcmV0dXJuIGZhbHNlOwp9CgpmdW5jdGlvbiBnZXRDb3N0Q2VudGVyVXNlcnMoJGNvc3RDZW50ZXJJZCkKewogICAgJGNvc3RDZW50ZXIgPSBDb3N0Q2VudHJlOjpmaW5kKCRjb3N0Q2VudGVySWQpOwogICAgCiAgICByZXR1cm4gVXNlcjo6d2hlcmVIYXMoJ2VtcGxveWVlJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkY29zdENlbnRlcikgewogICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhc191bml0X2lkJywgJGNvc3RDZW50ZXItPmhyX3VuaXRfaWQpCiAgICAgICAgICAgIC0+d2hlcmUoJ2FzX2RlcGFydG1lbnRfaWQnLCAkY29zdENlbnRlci0+aHJfZGVwYXJ0bWVudF9pZCk7CiAgICB9KS0+Z2V0KFsnaWQnXSk7Cn0KCmZ1bmN0aW9uIGNoZWNrVG90YWxXZWlnaHRhZ2UoJHBvcnRmb2xpb19pZCwgJHdlaWdodGFnZSwgJGlkID0gJycpCnsKICAgIGlmICgkaWQgIT0gbnVsbCkgewogICAgICAgICRjdXJyZW50X3dlaWdodGFnZSA9IFByb2dyYW06OndoZXJlTm90SW4oJ2lkJywgWyRpZF0pLT53aGVyZSgncG9ydGZvbGlvX2lkJywgJHBvcnRmb2xpb19pZCktPnN1bSgnd2VpZ2h0YWdlJyk7CiAgICB9IGVsc2UgewogICAgICAgICRjdXJyZW50X3dlaWdodGFnZSA9IFByb2dyYW06OndoZXJlKCdwb3J0Zm9saW9faWQnLCAkcG9ydGZvbGlvX2lkKS0+c3VtKCd3ZWlnaHRhZ2UnKTsKICAgIH0KICAgIAogICAgJHRvdGFsX3dlaWdodGFnZSA9ICRjdXJyZW50X3dlaWdodGFnZSArICR3ZWlnaHRhZ2U7CiAgICAKICAgIGlmICgkdG90YWxfd2VpZ2h0YWdlID4gMTAwKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7Cn0KCmZ1bmN0aW9uIGdldEVudW1PcHRpb25zKCR0YWJsZV9uYW1lLCAkY29sdW1uX25hbWUpCnsKICAgICR0eXBlID0gREI6OnNlbGVjdChEQjo6cmF3KCdTSE9XIENPTFVNTlMgRlJPTSAnIC4gJHRhYmxlX25hbWUgLiAnIFdIRVJFIEZpZWxkID0gIicgLiAkY29sdW1uX25hbWUgLiAnIicpKVswXS0+VHlwZTsKICAgIHByZWdfbWF0Y2goJy9eZW51bVwoKC4qKVwpJC8nLCAkdHlwZSwgJG1hdGNoZXMpOwogICAgJHZhbHVlcyA9IGFycmF5KCk7CiAgICBmb3JlYWNoIChleHBsb2RlKCcsJywgJG1hdGNoZXNbMV0pIGFzICR2YWx1ZSkgewogICAgICAgICR2YWx1ZXNbXSA9IHRyaW0oJHZhbHVlLCAiJyIpOwogICAgfQogICAgcmV0dXJuICR2YWx1ZXM7Cn0KCmZ1bmN0aW9uIGdldEF2YWlsYWJsZURhdGUoJGRhdGUsICRob2xpZGF5cywgJHR5cGUgPSAnZm9yd2FyZCcpCnsKICAgIGlmIChpbl9hcnJheSgkZGF0ZSwgJGhvbGlkYXlzKSkgewogICAgICAgICRkYXRlID0gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJGRhdGUgLiAnICcgLiAoJHR5cGUgPT0gJ2ZvcndhcmQnID8gJysnIDogJy0nKSAuICcxIGRheXMnKSk7CiAgICAgICAgcmV0dXJuIGdldEF2YWlsYWJsZURhdGUoJGRhdGUsICRob2xpZGF5cywgJHR5cGUpOwogICAgfQogICAgcmV0dXJuICRkYXRlOwp9CgpmdW5jdGlvbiBlc3RpbWF0ZWRWYWx1ZSgkcmVxdWlzaXRpb24pCnsKICAgICRlc3RpbWF0ZWQgPSAwOwogICAgaWYgKCRyZXF1aXNpdGlvbi0+aXRlbXMtPmNvdW50KCkgPiAwKSB7CiAgICAgICAgZm9yZWFjaCAoJHJlcXVpc2l0aW9uLT5pdGVtcyBhcyAka2V5ID0+ICRpdGVtKSB7CiAgICAgICAgICAgICRlc3RpbWF0ZWQgKz0gKCRpdGVtLT5xdHkgKiAkaXRlbS0+cHJvZHVjdC0+dW5pdF9wcmljZSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICByZXR1cm4gJGVzdGltYXRlZDsKfQoKZnVuY3Rpb24gcHJvamVjdER1cmF0aW9uVG9sZXJhbmNlKCRwcm9qZWN0KQp7CiAgICBpZiAoJHByb2plY3QtPnN0YXR1cyA9PSAnYXBwcm92ZWQnKSB7CiAgICAgICAgJGRheXMgPSBkYXlzRGlmZmVyZW5jZSgkcHJvamVjdC0+aW5pdGlhbF9lbmRfZGF0ZSwgJHByb2plY3QtPmVuZF9kYXRlKTsKICAgICAgICBpZiAoc3RydG90aW1lKCRwcm9qZWN0LT5lbmRfZGF0ZSkgPiBzdHJ0b3RpbWUoJHByb2plY3QtPmluaXRpYWxfZW5kX2RhdGUpICYmICRkYXlzID4gJHByb2plY3QtPmRheXNfdG9sZXJhbmNlKSB7CiAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gIlNvcnJ5ISBQcm9qZWN0IER1cmF0aW9uIFRvbGVyYW5jZSBMZXZlbCAoIiAuICRwcm9qZWN0LT5kYXlzX3RvbGVyYW5jZSAuICIgZGF5cykgaGFzIGJlZW4gZXhjZWVkZWQgYnkgIiAuICgkZGF5cykgLiAiIGRheXMuIgogICAgICAgICAgICBdOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAkZGF5cyA9IGRheXNEaWZmZXJlbmNlKCRwcm9qZWN0LT5zdGFydF9kYXRlLCAkcHJvamVjdC0+aW5pdGlhbF9zdGFydF9kYXRlKTsKICAgICAgICBpZiAoc3RydG90aW1lKCRwcm9qZWN0LT5pbml0aWFsX3N0YXJ0X2RhdGUpID4gc3RydG90aW1lKCRwcm9qZWN0LT5zdGFydF9kYXRlKSAmJiAkZGF5cyA+ICRwcm9qZWN0LT5kYXlzX3RvbGVyYW5jZSkgewogICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJTb3JyeSEgUHJvamVjdCBEdXJhdGlvbiBUb2xlcmFuY2UgTGV2ZWwgKCIgLiAkcHJvamVjdC0+ZGF5c190b2xlcmFuY2UgLiAiIGRheXMpIGhhcyBiZWVuIGV4Y2VlZGVkIGJ5ICIgLiAoJGRheXMpIC4gIiBkYXlzLiIKICAgICAgICAgICAgXTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHJldHVybiBbCiAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICBdOwp9CgpmdW5jdGlvbiBnZXRUaGlzUGFnZU1lbnVzKCkKewogICAgJHVybCA9IGV4cGxvZGUoJz8nLCBSZXF1ZXN0OjpwYXRoKCkpWzBdOwogICAgCiAgICAkcGVybWlzc2lvbiA9IFtdOwogICAgZm9yZWFjaCAoYXV0aCgpLT51c2VyKCktPmdldFBlcm1pc3Npb25zVmlhUm9sZXMoKSBhcyAkZGF0YSkgewogICAgICAgIGFycmF5X3B1c2goJHBlcm1pc3Npb24sICRkYXRhLT5uYW1lKTsKICAgIH0KICAgIAogICAgJHN1Ym1lbnUgPSBTdWJNZW51Ojp3aGVyZSgndXJsJywgJHVybCktPmZpcnN0KCk7CiAgICAkbGlua3MgPSBbXTsKICAgIGlmIChpc3NldCgkc3VibWVudS0+bWVudV9pZCkpIHsKICAgICAgICAkbGlua3MgPSBjb2xsZWN0KFN1Yk1lbnU6OndoZXJlKCdtZW51X2lkJywgJHN1Ym1lbnUtPm1lbnVfaWQpLT53aGVyZSgndXJsJywgJyE9JywgJHVybCktPmdldCgpKS0+bWFwV2l0aEtleXMoZnVuY3Rpb24gKCRpdGVtKSB1c2UgKCRwZXJtaXNzaW9uKSB7CiAgICAgICAgICAgICRhcnJEaWZmID0gYXJyYXlfaW50ZXJzZWN0KCRwZXJtaXNzaW9uLCBpc3NldChqc29uX2RlY29kZSgkaXRlbVsnc2x1ZyddLCB0cnVlKVswXSkgPyBqc29uX2RlY29kZSgkaXRlbVsnc2x1ZyddLCB0cnVlKSA6IFtdKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBbdXJsKCRpdGVtWyd1cmwnXSkgPT4gWwogICAgICAgICAgICAgICAgJ25hbWUnID0+ICRpdGVtWyduYW1lJ10sCiAgICAgICAgICAgICAgICAnaWNvbicgPT4gJGl0ZW1bJ2ljb25fY2xhc3MnXSwKICAgICAgICAgICAgICAgICdwZXJtaXNzaW9uJyA9PiAkYXJyRGlmZiwKICAgICAgICAgICAgXV07CiAgICAgICAgfSktPnRvQXJyYXkoKTsKICAgIH0KICAgIAogICAgLy8gJHByb2plY3Rfc3VibWVudSA9IFByb2plY3RTdWJNZW51Ojp3aGVyZSgndXJsJywgJHVybCktPmZpcnN0KCk7CiAgICAvLyAkbGlua3MzID0gW107CiAgICAvLyBpZihpc3NldCgkcHJvamVjdF9zdWJtZW51LT5tZW51X2lkKSl7CiAgICAvLyAJICRsaW5rczMgPSBjb2xsZWN0KFByb2plY3RTdWJNZW51Ojp3aGVyZSgnbWVudV9pZCcsICRwcm9qZWN0X3N1Ym1lbnUtPm1lbnVfaWQpLT53aGVyZSgndXJsJywgJyE9JywgJHVybCktPmdldCgpKS0+bWFwV2l0aEtleXMoZnVuY3Rpb24gKCRpdGVtKSB1c2UoJHBlcm1pc3Npb24pIHsKICAgIC8vIAkJCSRhcnJEaWZmID0gYXJyYXlfaW50ZXJzZWN0KCRwZXJtaXNzaW9uLCBpc3NldChqc29uX2RlY29kZSgkaXRlbVsnc2x1ZyddLHRydWUpWzBdKSA/IGpzb25fZGVjb2RlKCRpdGVtWydzbHVnJ10sdHJ1ZSkgOiBbXSk7CiAgICAKICAgIC8vIAkJCXJldHVybiBbdXJsKCRpdGVtWyd1cmwnXSkgPT4gWwogICAgLy8gCQkJCSduYW1lJyA9PiAkaXRlbVsnbmFtZSddLAogICAgLy8gCQkJCSdpY29uJyA9PiAkaXRlbVsnaWNvbl9jbGFzcyddLAogICAgLy8gCQkJCSdwZXJtaXNzaW9uJyA9PiAkYXJyRGlmZiwKICAgIC8vIAkJCV1dOwogICAgLy8gCX0pLT50b0FycmF5KCk7CiAgICAvLyB9CiAgICAKICAgIC8vIHJldHVybiBhcnJheV9tZXJnZSgkbGlua3MsJGxpbmtzMyk7CiAgICAKICAgIHJldHVybiAkbGlua3M7Cn0KCmZ1bmN0aW9uIGdldFVuaXRQYWQoJHVuaXQpCnsKICAgICRtYWluID0gZ2V0TW9kdWxlcygpWydtYWluJ107CiAgICByZXR1cm4gaXNzZXQoJHVuaXQtPnBhZCkgPyAkbWFpbi0+dXJsIC4gJy8nIC4gJHVuaXQtPnBhZCA6IHNlc3Npb24oKS0+Z2V0KCdzeXN0ZW0taW5mb3JtYXRpb24nKVsncGFkJ107Cn0KCmZ1bmN0aW9uIGdldENvbXBhbnlQYWQoJGNvbXBhbnkpCnsKICAgICRtYWluID0gZ2V0TW9kdWxlcygpWydtYWluJ107CiAgICByZXR1cm4gaXNzZXQoJGNvbXBhbnktPnVuaXRzWzBdKSA/ICRtYWluLT51cmwgLiAnLycgLiAkY29tcGFueS0+dW5pdHMtPmZpcnN0KCktPnBhZCA6IHNlc3Npb24oKS0+Z2V0KCdzeXN0ZW0taW5mb3JtYXRpb24nKVsncGFkJ107Cn0KCmZ1bmN0aW9uIG1ha2VQYXltZW50VGVybXNTdHJpbmcoJGlkKQp7CiAgICB0cnkgewogICAgICAgICRwYXltZW50VGVybSA9IFxBcHBcTW9kZWxzXFBtc01vZGVsc1xTdXBwbGllclBheW1lbnRUZXJtOjp3aXRoKFsncmVsUGF5bWVudFRlcm0nXSktPmZpbmRPckZhaWwoJGlkKTsKICAgICAgICAkdGVybSA9ICRwYXltZW50VGVybS0+cmVsUGF5bWVudFRlcm0tPnRlcm0gLiAnICgnIC4gJHBheW1lbnRUZXJtLT5wYXltZW50X3BlcmNlbnQgLiAnJSAnIC4gKCRwYXltZW50VGVybS0+dHlwZSA9PSAncGFpZCcgPyAnQWNjb3VudCBQYXllZS1jaGVxdWUnIDogJ0Nhc2ggQ2hlcXVlJykgLiAnIGluICcgLiAkcGF5bWVudFRlcm0tPmRheV9kdXJhdGlvbiAuICcgZGF5cyc7CiAgICAgICAgCiAgICAgICAgJHRlcm1zID0gXEFwcFxNb2RlbHNcUG1zTW9kZWxzXFN1cHBsaWVyUGF5bWVudFRlcm06OndoZXJlKCdwYXJlbnRfaWQnLCAkcGF5bWVudFRlcm0tPmlkKS0+Z2V0KCk7CiAgICAgICAgaWYgKGlzc2V0KCR0ZXJtc1swXSkpIHsKICAgICAgICAgICAgZm9yZWFjaCAoJHRlcm1zIGFzICRrZXkgPT4gJHRoaXNfdGVybSkgewogICAgICAgICAgICAgICAgJHRlcm0gLj0gJywgJyAuICR0aGlzX3Rlcm0tPnBheW1lbnRfcGVyY2VudCAuICclICcgLiAoJHRoaXNfdGVybS0+dHlwZSA9PSAncGFpZCcgPyAnQWNjb3VudCBQYXktY2hlcXVlJyA6ICdDYXNoIENoZXF1ZScpIC4gJyBpbiAnIC4gJHRoaXNfdGVybS0+ZGF5X2R1cmF0aW9uIC4gJyBkYXlzJzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAkdGVybSAuPSAnKSc7CiAgICAgICAgCiAgICAgICAgcmV0dXJuICR0ZXJtOwogICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICByZXR1cm4gJHRoLT5nZXRNZXNzYWdlKCk7CiAgICB9Cn0KCmZ1bmN0aW9uIHVzZXJDb2x1bW5WaXNpYmlsaXRpZXMoKQp7CiAgICAkY29sdW1uVmlzaWJpbGl0aWVzID0gXEFwcFxNb2RlbHNcVXNlckNvbHVtblZpc2liaWxpdHk6OndoZXJlKFsKICAgICAgICAndXNlcl9pZCcgPT4gYXV0aCgpLT51c2VyKCktPmlkLAogICAgICAgICd1cmwnID0+IHJlcXVlc3QoKS0+ZnVsbFVybCgpCiAgICBdKS0+Zmlyc3QoKTsKICAgIGlmIChpc3NldCgkY29sdW1uVmlzaWJpbGl0aWVzLT5pZCkpIHsKICAgICAgICAkY29sdW1ucyA9ICghZW1wdHkoJGNvbHVtblZpc2liaWxpdGllcy0+Y29sdW1ucykgJiYgaXNfYXJyYXkoanNvbl9kZWNvZGUoJGNvbHVtblZpc2liaWxpdGllcy0+Y29sdW1ucywgdHJ1ZSkpID8ganNvbl9kZWNvZGUoJGNvbHVtblZpc2liaWxpdGllcy0+Y29sdW1ucywgdHJ1ZSkgOiBbXSk7CiAgICAgICAgJGhpZGRlbiA9IFtdOwogICAgICAgIGlmIChpc3NldCgkY29sdW1uc1swXSkpIHsKICAgICAgICAgICAgZm9yZWFjaCAoJGNvbHVtbnMgYXMgJGtleSA9PiAkY29sdW1uKSB7CiAgICAgICAgICAgICAgICBpZiAoJGNvbHVtbiA9PSAiZmFsc2UiKSB7CiAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkaGlkZGVuLCAka2V5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gJGhpZGRlbjsKICAgIH0KICAgIAogICAgcmV0dXJuIFtdOwp9CgpmdW5jdGlvbiBmcmVlemVQcm9kdWN0KCRwcm9kdWN0KQp7CiAgICByZXR1cm4gKCRwcm9kdWN0LT5zdGF0dXMgPT0gJ2FwcHJvdmVkJyAmJiAkcHJvZHVjdC0+cmVxdWlzaXRpb25JdGVtLT5jb3VudCgpID4gMCk7Cn0KCmZ1bmN0aW9uIGZyZWV6ZVN1cHBsaWVyKCRzdXBwbGllcikKewogICAgcmV0dXJuICgkc3VwcGxpZXItPmFwcHJvdmVkX2J5ID09ICdtYW5hZ2VtZW50LWFwcHJvdmVkJyAmJiAkc3VwcGxpZXItPnJlbFF1b3RhdGlvbnMtPmNvdW50KCkgPiAwKTsKfQoKZnVuY3Rpb24gZGF0YXRhYmxlT3JkZXJpbmcoKQp7CiAgICAkb3JkZXIgPSBmYWxzZTsKICAgIGlmIChpc3NldChyZXF1ZXN0KCktPm9yZGVyWzBdKSkgewogICAgICAgIGZvcmVhY2ggKHJlcXVlc3QoKS0+b3JkZXIgYXMgJGtleSA9PiAkb3JkZXJpbmcpIHsKICAgICAgICAgICAgaWYgKCRvcmRlcmluZ1snY29sdW1uJ10gIT0gMCkgewogICAgICAgICAgICAgICAgJG9yZGVyID0gJG9yZGVyaW5nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgCiAgICByZXR1cm4gJG9yZGVyOwp9CgpmdW5jdGlvbiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsICRvcmRlckJ5UXVlcnkpCnsKICAgIHJldHVybiAkcXVlcnktPndoZW4oJG9yZGVyID09ICdhc2MnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRvcmRlckJ5UXVlcnkpIHsKICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlckJ5KCRvcmRlckJ5UXVlcnkpOwogICAgfSkKICAgICAgICAtPndoZW4oJG9yZGVyID09ICdkZXNjJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkb3JkZXJCeVF1ZXJ5KSB7CiAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnlEZXNjKCRvcmRlckJ5UXVlcnkpOwogICAgICAgIH0pOwp9CgpmdW5jdGlvbiByZXF1aXJlZCgpCnsKICAgIHJldHVybiAnPHN0cm9uZyBjbGFzcz0idGV4dC1kYW5nZXIiPio8L3N0cm9uZz4nOwp9CgpmdW5jdGlvbiBnZXRQcm9qZWN0UHJvZ3Jlc3MoJG9iamVjdCwgJHR5cGUpCnsKICAgICRzdGFydF9kYXRlID0gJyc7CiAgICAkZW5kX2RhdGUgPSAnJzsKICAgIGlmICgkdHlwZSA9PSAncHJvamVjdCcpIHsKICAgICAgICAkc3RhcnRfZGF0ZSA9ICRvYmplY3QtPnN0YXJ0X2RhdGU7CiAgICAgICAgJGVuZF9kYXRlID0gJG9iamVjdC0+ZW5kX2RhdGU7CiAgICB9IGVsc2VpZiAoJHR5cGUgPT0gJ3BoYXNlJyB8fCAkdHlwZSA9PSAnbWlsZXN0b25lJykgewogICAgICAgICRzdGFydF9kYXRlID0gJG9iamVjdC0+c3RhcnRfYXQ7CiAgICAgICAgJGVuZF9kYXRlID0gJG9iamVjdC0+ZW5kX2F0OwogICAgfSBlbHNlaWYgKCR0eXBlID09ICd0YXNrJykgewogICAgICAgICRzdGFydF9kYXRlID0gJG9iamVjdC0+aW5pdGlhdGVfdGltZV9saW5lOwogICAgICAgICRlbmRfZGF0ZSA9ICRvYmplY3QtPmVuZF90aW1lX2xpbmU7CiAgICB9CiAgICAKICAgICR3ZWlnaHRhZ2UgPSBnZXRDaGFydENvbG9yKCRvYmplY3QsICRzdGFydF9kYXRlLCAkZW5kX2RhdGUsICR0eXBlLCAnZG9uZScpOwogICAgJHBhcmVudF93ZWlnaHRhZ2UgPSAoaXNzZXQoJG9iamVjdC0+c3BvbnNvcl9pZCkgPyAxMDAgOiAkb2JqZWN0LT53ZWlnaHRhZ2UpOwogICAgcmV0dXJuIHN5c3RlbURvdWJsZVZhbHVlKCgkd2VpZ2h0YWdlID4gMCAmJiAkcGFyZW50X3dlaWdodGFnZSA+IDAgPyAxMDAgKiAoJHdlaWdodGFnZSAvICRwYXJlbnRfd2VpZ2h0YWdlKSA6IDApLCAyKTsKfQoKZnVuY3Rpb24gZ2V0Q29sb3IoJHZhbHVlKQp7CiAgICAkY29sb3JzID0gWwogICAgICAgICdiYWNrZ3JvdW5kJyA9PiAnIzM4YzE3MicsCiAgICAgICAgJ2NvbG9yJyA9PiAnd2hpdGUnLAogICAgXTsKICAgIAogICAgaWYgKCR2YWx1ZSA9PSAidXBjb21pbmciKSB7CiAgICAgICAgJGNvbG9yc1snYmFja2dyb3VuZCddID0gJyMzNDkwZGMnOwogICAgfQogICAgCiAgICBpZiAoJHZhbHVlID09ICJvbmdvaW5nIikgewogICAgICAgICRjb2xvcnNbJ2JhY2tncm91bmQnXSA9ICcjZmZlZDRhJzsKICAgICAgICAkY29sb3JzWydjb2xvciddID0gJ2JsYWNrJzsKICAgIH0KICAgIAogICAgaWYgKCR2YWx1ZSA9PSAiZGVsYXkiKSB7CiAgICAgICAgJGNvbG9yc1snYmFja2dyb3VuZCddID0gJyNlMzM0MmYnOwogICAgfQogICAgCiAgICByZXR1cm4gJGNvbG9yczsKfQoKZnVuY3Rpb24gZ2V0Q2hhcnRDb2xvcnMoJG9iamVjdCwgJHN0YXJ0X2RhdGUsICRlbmRfZGF0ZSwgJHR5cGUgPSAncHJvamVjdCcpCnsKICAgICRhcnJheSA9IFsnZG9uZScsICdkZWxheScsICdvbmdvaW5nJywgJ3VwY29taW5nJ107CiAgICAkY29uZGl0aW9ucyA9IFtdOwogICAgZm9yZWFjaCAoJGFycmF5IGFzICRrZXkgPT4gJHZhbHVlKSB7CiAgICAgICAgJHdlaWdodGFnZSA9IGdldENoYXJ0Q29sb3IoJG9iamVjdCwgJHN0YXJ0X2RhdGUsICRlbmRfZGF0ZSwgJHR5cGUsICR2YWx1ZSk7CiAgICAgICAgJHBhcmVudF93ZWlnaHRhZ2UgPSAoaXNzZXQoJG9iamVjdC0+c3BvbnNvcl9pZCkgPyAxMDAgOiAkb2JqZWN0LT53ZWlnaHRhZ2UpOwogICAgICAgICRjb25kaXRpb25zWyR2YWx1ZV0gPSBzeXN0ZW1Eb3VibGVWYWx1ZSgoJHdlaWdodGFnZSA+IDAgJiYgJHBhcmVudF93ZWlnaHRhZ2UgPiAwID8gMTAwICogKCR3ZWlnaHRhZ2UgLyAkcGFyZW50X3dlaWdodGFnZSkgOiAwKSwgMik7CiAgICB9CiAgICAKICAgIHJldHVybiAkY29uZGl0aW9uczsKfQoKZnVuY3Rpb24gZ2V0Q2hhcnRDb2xvcigkb2JqZWN0LCAkc3RhcnRfZGF0ZSwgJGVuZF9kYXRlLCAkdHlwZSA9ICdwcm9qZWN0JywgJGNvbmRpdGlvbiA9ICdkb25lJykKewogICAgaWYgKCR0eXBlID09ICdwcm9qZWN0JykgewogICAgICAgICRwZXJjZW50YWdlID0gMDsKICAgICAgICBpZiAoJG9iamVjdC0+ZGVsaXZlcmFibGVzLT5jb3VudCgpID4gMCkgewogICAgICAgICAgICBmb3JlYWNoICgkb2JqZWN0LT5kZWxpdmVyYWJsZXMgYXMgJGtleSA9PiAkZGVsaXZlcmFibGUpIHsKICAgICAgICAgICAgICAgICRwZXJjZW50YWdlICs9IGdldENoYXJ0Q29sb3IoJGRlbGl2ZXJhYmxlLCAkZGVsaXZlcmFibGUtPnN0YXJ0X2F0LCAkZGVsaXZlcmFibGUtPmVuZF9hdCwgJ3BoYXNlJywgJGNvbmRpdGlvbik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuICRwZXJjZW50YWdlOwogICAgfSBlbHNlaWYgKCR0eXBlID09ICdwaGFzZScpIHsKICAgICAgICAkcGVyY2VudGFnZSA9IDA7CiAgICAgICAgaWYgKCRvYmplY3QtPnN1YkRlbGl2ZXJhYmxlcy0+Y291bnQoKSA+IDApIHsKICAgICAgICAgICAgZm9yZWFjaCAoJG9iamVjdC0+c3ViRGVsaXZlcmFibGVzIGFzICRrZXkgPT4gJHN1YkRlbGl2ZXJhYmxlKSB7CiAgICAgICAgICAgICAgICAkcGVyY2VudGFnZSArPSBnZXRDaGFydENvbG9yKCRzdWJEZWxpdmVyYWJsZSwgJHN1YkRlbGl2ZXJhYmxlLT5zdGFydF9hdCwgJHN1YkRlbGl2ZXJhYmxlLT5lbmRfYXQsICdtaWxlc3RvbmUnLCAkY29uZGl0aW9uKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRwZXJjZW50YWdlID0gZ2V0Q2hhcnRDb2xvcigkb2JqZWN0LCAkb2JqZWN0LT5zdGFydF9hdCwgJG9iamVjdC0+ZW5kX2F0LCAndGFzaycsICRjb25kaXRpb24pOwogICAgICAgICAgICAkcGVyY2VudGFnZSA9ICgkcGVyY2VudGFnZSA+IDAgPyAxMDAgOiAwKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICgkcGVyY2VudGFnZSA+IDAgJiYgJG9iamVjdC0+d2VpZ2h0YWdlID4gMCA/ICgkb2JqZWN0LT53ZWlnaHRhZ2UgKiAoJHBlcmNlbnRhZ2UgLyAxMDApKSA6IDApOwogICAgfSBlbHNlaWYgKCR0eXBlID09ICdtaWxlc3RvbmUnKSB7CiAgICAgICAgJHBlcmNlbnRhZ2UgPSAwOwogICAgICAgIGlmICgkb2JqZWN0LT5wcm9qZWN0VGFza3MtPndoZXJlKCdwYXJlbnRfaWQnLCAwKS0+Y291bnQoKSA+IDApIHsKICAgICAgICAgICAgZm9yZWFjaCAoJG9iamVjdC0+cHJvamVjdFRhc2tzLT53aGVyZSgncGFyZW50X2lkJywgMCkgYXMgJGtleSA9PiAkcHJvamVjdFRhc2spIHsKICAgICAgICAgICAgICAgICRwZXJjZW50YWdlICs9IGdldENoYXJ0Q29sb3IoJHByb2plY3RUYXNrLCAkcHJvamVjdFRhc2stPmluaXRpYXRlX3RpbWVfbGluZSwgJHByb2plY3RUYXNrLT5lbmRfdGltZV9saW5lLCAndGFzaycsICRjb25kaXRpb24pOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHBlcmNlbnRhZ2UgPSBnZXRDaGFydENvbG9yKCRvYmplY3QsICRvYmplY3QtPnN0YXJ0X2F0LCAkb2JqZWN0LT5lbmRfYXQsICd0YXNrJywgJGNvbmRpdGlvbik7CiAgICAgICAgICAgICRwZXJjZW50YWdlID0gKCRwZXJjZW50YWdlID4gMCA/IDEwMCA6IDApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKCRwZXJjZW50YWdlID4gMCAmJiAkb2JqZWN0LT53ZWlnaHRhZ2UgPiAwID8gKCRvYmplY3QtPndlaWdodGFnZSAqICgkcGVyY2VudGFnZSAvIDEwMCkpIDogMCk7CiAgICB9IGVsc2VpZiAoJHR5cGUgPT0gJ3Rhc2snKSB7CiAgICAgICAgJHBlcmNlbnRhZ2UgPSAwOwogICAgICAgIGlmICgkY29uZGl0aW9uID09ICdkb25lJykgewogICAgICAgICAgICAKICAgICAgICAgICAgJHBlcmNlbnRhZ2UgPSAoJG9iamVjdC0+c3RhdHVzID09ICdkb25lJyA/ICgkb2JqZWN0LT53ZWlnaHRhZ2UpIDogMCk7CiAgICAgICAgICAgIAogICAgICAgIH0gZWxzZWlmICgkY29uZGl0aW9uID09ICdkZWxheScgJiYgJG9iamVjdC0+c3RhdHVzICE9ICdkb25lJykgewogICAgICAgICAgICBpZiAoIShzdHJ0b3RpbWUoZGF0ZSgnWS1tLWQnKSkgPCBzdHJ0b3RpbWUoJHN0YXJ0X2RhdGUpKSAmJiAhKHN0cnRvdGltZShkYXRlKCdZLW0tZCcpKSA+PSBzdHJ0b3RpbWUoJHN0YXJ0X2RhdGUpICYmIHN0cnRvdGltZShkYXRlKCdZLW0tZCcpKSA8PSBzdHJ0b3RpbWUoJGVuZF9kYXRlKSkpIHsKICAgICAgICAgICAgICAgICRwZXJjZW50YWdlID0gKHN0cnRvdGltZShkYXRlKCdZLW0tZCcpKSA+IHN0cnRvdGltZSgkZW5kX2RhdGUpID8gKCRvYmplY3QtPndlaWdodGFnZSkgOiAwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICB9IGVsc2VpZiAoJGNvbmRpdGlvbiA9PSAndXBjb21pbmcnICYmICRvYmplY3QtPnN0YXR1cyAhPSAnZG9uZScpIHsKICAgICAgICAgICAgaWYgKCEoc3RydG90aW1lKGRhdGUoJ1ktbS1kJykpID4gc3RydG90aW1lKCRlbmRfZGF0ZSkpICYmICEoc3RydG90aW1lKGRhdGUoJ1ktbS1kJykpID49IHN0cnRvdGltZSgkc3RhcnRfZGF0ZSkgJiYgc3RydG90aW1lKGRhdGUoJ1ktbS1kJykpIDw9IHN0cnRvdGltZSgkZW5kX2RhdGUpKSkgewogICAgICAgICAgICAgICAgJHBlcmNlbnRhZ2UgPSAoc3RydG90aW1lKGRhdGUoJ1ktbS1kJykpIDwgc3RydG90aW1lKCRzdGFydF9kYXRlKSA/ICgkb2JqZWN0LT53ZWlnaHRhZ2UpIDogMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgfSBlbHNlaWYgKCRjb25kaXRpb24gPT0gJ29uZ29pbmcnICYmICRvYmplY3QtPnN0YXR1cyAhPSAnZG9uZScpIHsKICAgICAgICAgICAgaWYgKCEoc3RydG90aW1lKGRhdGUoJ1ktbS1kJykpID4gc3RydG90aW1lKCRlbmRfZGF0ZSkpICYmICEoc3RydG90aW1lKGRhdGUoJ1ktbS1kJykpIDwgc3RydG90aW1lKCRzdGFydF9kYXRlKSkpIHsKICAgICAgICAgICAgICAgICRwZXJjZW50YWdlID0gKHN0cnRvdGltZShkYXRlKCdZLW0tZCcpKSA+PSBzdHJ0b3RpbWUoJHN0YXJ0X2RhdGUpICYmIHN0cnRvdGltZShkYXRlKCdZLW0tZCcpKSA8PSBzdHJ0b3RpbWUoJGVuZF9kYXRlKSA/ICgkb2JqZWN0LT53ZWlnaHRhZ2UpIDogMCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuICRwZXJjZW50YWdlOwogICAgfQp9CgpmdW5jdGlvbiB1cGRhdGVTdXBwbGllclByb2R1Y3RzKCRzdXBwbGllcl9pZCkKewogICAgaWYgKCRzdXBwbGllcl9pZCA9PSAxMikgewogICAgICAgICRzdXBwbGllciA9IFxBcHBcTW9kZWxzXFBtc01vZGVsc1xTdXBwbGllcnM6OndpdGgoWwogICAgICAgICAgICAncHJvZHVjdHMnCiAgICAgICAgXSktPmZpbmRPckZhaWwoJHN1cHBsaWVyX2lkKTsKICAgICAgICAKICAgICAgICAkcHJvZHVjdHMgPSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHJvZHVjdDo6d2hlcmVOb3RJbignaWQnLCAkc3VwcGxpZXItPnByb2R1Y3RzLT5wbHVjaygnaWQnKS0+dG9BcnJheSgpKS0+cGx1Y2soJ2lkJyktPnRvQXJyYXkoKTsKICAgICAgICAkYXJyYXkgPSBbXTsKICAgICAgICBpZiAoaXNzZXQoJHByb2R1Y3RzWzBdKSkgewogICAgICAgICAgICBmb3JlYWNoICgkcHJvZHVjdHMgYXMgJGtleSA9PiAkcHJvZHVjdF9pZCkgewogICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkYXJyYXksIFsKICAgICAgICAgICAgICAgICAgICAnc3VwcGxpZXJfaWQnID0+ICRzdXBwbGllci0+aWQsCiAgICAgICAgICAgICAgICAgICAgJ3Byb2R1Y3RfaWQnID0+ICRwcm9kdWN0X2lkLAogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKGlzc2V0KCRhcnJheVswXSkpIHsKICAgICAgICAgICAgREI6OnRhYmxlKCdwcm9kdWN0c19zdXBwbGllcicpLT5pbnNlcnQoJGFycmF5KTsKICAgICAgICB9CiAgICB9Cn0KCmZ1bmN0aW9uIGdldFBPRHVlQW1vdW50KCRwdXJjaGFzZU9yZGVyKQp7CiAgICAkYWR2YW5jZUJvb2tlZCA9IFxBcHBcTW9kZWxzXFBtc01vZGVsc1xTdXBwbGllclBheW1lbnQ6OmRvZXNudEhhdmUoJ3JlbFN1cHBsaWVyTGVkZ2VycycpCiAgICAgICAgLT53aGVyZSgncHVyY2hhc2Vfb3JkZXJfaWQnLCAkcHVyY2hhc2VPcmRlci0+aWQpCiAgICAgICAgLT53aGVyZSgnc3VwcGxpZXJfaWQnLCAkcHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5zdXBwbGllcl9pZCkKICAgICAgICAtPndoZXJlKCdiaWxsX3R5cGUnLCAncG8tYWR2YW5jZScpCiAgICAgICAgLT5zdW0oJ3BheV9hbW91bnQnKTsKICAgICRwYWlkID0gXEFwcFxNb2RlbHNcUG1zTW9kZWxzXFN1cHBsaWVyTGVkZ2Vyczo6d2hlcmVIYXMoJ3JlbFN1cHBsaWVyUGF5bWVudCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHB1cmNoYXNlT3JkZXIpIHsKICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncHVyY2hhc2Vfb3JkZXJfaWQnLCAkcHVyY2hhc2VPcmRlci0+aWQpCiAgICAgICAgICAgIC0+d2hlcmUoJ3N1cHBsaWVyX2lkJywgJHB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+c3VwcGxpZXJfaWQpOwogICAgfSktPnN1bSgnZGViaXQnKTsKICAgIHJldHVybiBzeXN0ZW1Eb3VibGVWYWx1ZSgkcHVyY2hhc2VPcmRlci0+Z3Jvc3NfcHJpY2UgLSAoJGFkdmFuY2VCb29rZWQgKyAkcGFpZCksIDIpOwp9CgpmdW5jdGlvbiBtZW51TW9kdWxlcygpCnsKICAgIHJldHVybiBbCiAgICAgICAgJ3Byb2N1cmVtZW50JywKICAgICAgICAncHJvamVjdC1tYW5hZ2VtZW50JywKICAgICAgICAnZmluYW5jZScsCiAgICAgICAgJ3NhbGVzJywKICAgICAgICAnbWFudWZhY3R1cmluZycKICAgIF07Cn0KCmZ1bmN0aW9uIGdldERlcGFydG1lbnRIZWFkTmFtZSgkdXNlcl9pZCkKewogICAgJHVzZXIgPSBVc2VyOjpmaW5kKCR1c2VyX2lkKTsKICAgICR1c2VycyA9IFVzZXI6OndoZXJlSGFzKCdlbXBsb3llZScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHVzZXIpIHsKICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnYXNfdW5pdF9pZCcsICR1c2VyLT5lbXBsb3llZS0+YXNfdW5pdF9pZCkKICAgICAgICAgICAgLT53aGVyZSgnYXNfZGVwYXJ0bWVudF9pZCcsICR1c2VyLT5lbXBsb3llZS0+YXNfZGVwYXJ0bWVudF9pZCk7CiAgICB9KS0+Z2V0KCk7CiAgICAKICAgICRoZWFkcyA9IFtdOwogICAgaWYgKGlzc2V0KCR1c2Vyc1swXSkpIHsKICAgICAgICBmb3JlYWNoICgkdXNlcnMgYXMgJHVzZXIpIHsKICAgICAgICAgICAgaWYgKCR1c2VyLT5oYXNSb2xlKCdEZXBhcnRtZW50LUhlYWQnKSkgewogICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkaGVhZHMsICR1c2VyLT5pZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAKICAgICR1c2VyRGF0YSA9IFVzZXI6OndoZXJlSW4oJ2lkJywgJGhlYWRzKS0+d2hlcmVIYXMoJ2VtcGxveWVlJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkdXNlcikgewogICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhc191bml0X2lkJywgJHVzZXItPmVtcGxveWVlLT5hc191bml0X2lkKQogICAgICAgICAgICAtPndoZXJlKCdhc19kZXBhcnRtZW50X2lkJywgJHVzZXItPmVtcGxveWVlLT5hc19kZXBhcnRtZW50X2lkKTsKICAgIH0pLT5maXJzdCgpOwogICAgCiAgICByZXR1cm4gaXNzZXQoJHVzZXJEYXRhLT5pZCkgPyAkdXNlckRhdGEtPm5hbWUgLiAnWycgLiAkdXNlckRhdGEtPmFzc29jaWF0ZV9pZCAuICddJyA6IG51bGw7Cn0KCmZ1bmN0aW9uIHN0YWdlKCRrZXkgPSBudWxsKQp7CiAgICAkYXJyYXkgPSBbCiAgICAgICAgJ3JlcXVpc2l0aW9uX2NyZWF0ZWQnID0+ICdSZXF1aXNpdGlvbiBDcmVhdGVkJywKICAgICAgICAnc2VudF90b19kZXBhcnRtZW50X2hlYWQnID0+ICdTZW50IHRvIERlcGFydG1lbnQgSGVhZCcsCiAgICAgICAgJ3NlbnRfdG9fc2J1X2hlYWQnID0+ICdTZW50IHRvIFNCVSBIZWFkJywKICAgICAgICAnc2VudF90b19maW5hbmNlJyA9PiAnU2VudCB0byBGaW5hbmNlJywKICAgICAgICAnc2VudF90b19tYW5hZ2VtZW50JyA9PiAnU2VudCB0byBNYW5hZ2VtZW50JywKICAgICAgICAnc2VudF90b19zdG9yZScgPT4gJ1NlbnQgdG8gU3RvcmUnLAogICAgICAgICdzZW50X3RvX3B1cmNoYXNlJyA9PiAnU2VudCB0byBQdXJjaGFzZSBEZXBhcnRtZW50JywKICAgICAgICAKICAgICAgICAnYXBwcm92ZWRfYnlfZGVwYXJ0bWVudF9oZWFkJyA9PiAnQXBwcm92ZWQgYnkgRGVwYXJ0bWVudCBIZWFkJywKICAgICAgICAnYXBwcm92ZWRfYnlfc2J1X2hlYWQnID0+ICdBcHByb3ZlZCBieSBTQlUgSGVhZCcsCiAgICAgICAgJ2FwcHJvdmVkX2J5X2ZpbmFuY2UnID0+ICdBcHByb3ZlZCBieSBGaW5hbmNlJywKICAgICAgICAnYXBwcm92ZWRfYnlfc3RvcmUnID0+ICdBcHByb3ZlZCBieSBTdG9yZScsCiAgICAgICAgJ2FwcHJvdmVkX2J5X3B1cmNoYXNlJyA9PiAnQXBwcm92ZWQgYnkgUHVyY2hhc2UgRGVwYXJ0bWVudCcsCiAgICAgICAgJ2FwcHJvdmVkX2J5X21hbmFnZW1lbnQnID0+ICdBcHByb3ZlZCBieSBNYW5hZ2VtZW50JywKICAgICAgICAKICAgICAgICAnZGVuaWVkX2J5X2ZpbmFuY2UnID0+ICdGaW5hbmNlIERlbmllZCcsCiAgICAgICAgCiAgICAgICAgJ2hhbHRlZCcgPT4gJ1JlcXVpc2l0aW9uIEhhbHRlZCcsCiAgICAgICAgJ3N1cHBsaWVyX3BheW1lbnRfY29tcGxldGUnID0+ICdTdXBwbGllciBQYXltZW50IENvbXBsZXRlZCcsCgogICAgICAgICdwb19jYXNoX2FwcHJvdmFsJyA9PiAnUE8gY2FzaCBhcHByb3ZlZCcsCiAgICAgICAgJ3BvX2Nhc2hfcmVqZWN0JyA9PiAnUE8gY2FzaCByZWplY3RlZCcsCiAgICAgICAgJ3BvX2Nhc2hfaGFsdCcgPT4gJ1BPIGNhc2ggaGFsdGVkJwogICAgXTsKICAgIAogICAgaWYgKCRrZXkgIT09IG51bGwpIHsKICAgICAgICByZXR1cm4gJGFycmF5WyRrZXldOwogICAgfQogICAgcmV0dXJuICRhcnJheTsKfQoKLyoqCiAqIEBwYXJhbSAkcmVxdWlzaXRpb25JZAogKiBAcGFyYW0gJHN0YWdlCiAqIEBwYXJhbSAkbm90ZQogKiBAcmV0dXJuIHRydWUKICovCmZ1bmN0aW9uIHJlcXVpc2l0aW9uVHJhY2tpbmdIaXN0b3J5KCRyZXF1aXNpdGlvbklkLCAkc3RhZ2UsICRub3RlKTogYm9vbAp7CiAgICBSZXF1aXNpdGlvblN0YWdlSGlzdG9yeTo6Y3JlYXRlKFsKICAgICAgICAncmVxdWlzaXRpb25faWQnID0+ICRyZXF1aXNpdGlvbklkLAogICAgICAgICdub3RlJyA9PiAkbm90ZSwKICAgICAgICAnc3RhZ2UnID0+ICRzdGFnZSwKICAgICAgICAnc3RhZ2VfdXBkYXRlZF9hdCcgPT4gZGF0ZSgnWS1tLWQgSDppOnMnKSwKICAgICAgICAnY3JlYXRlZF9ieScgPT4gYXV0aCgpLT51c2VyKCktPmlkCiAgICBdKTsKICAgIAogICAgcmV0dXJuIHRydWU7Cn0KCmZ1bmN0aW9uIHN0YWdlRmluZGVyKCRyZXF1aXNpdGlvbklkLCAkc3RhZ2UpCnsKICAgIHJldHVybiBSZXF1aXNpdGlvblN0YWdlSGlzdG9yeTo6d2l0aCgnY3JlYXRlZEJ5JykKICAgICAgICAtPndoZXJlKCdyZXF1aXNpdGlvbl9pZCcsICRyZXF1aXNpdGlvbklkKS0+d2hlcmUoJ3N0YWdlJywgJHN0YWdlKS0+Zmlyc3QoKTsKfQ==