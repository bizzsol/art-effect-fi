<?php
bolt_decrypt( __FILE__ , 'gQQ6Xi'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zXEdybjsKCnVzZSBBcHBcSHR0cFxDb250cm9sbGVyc1xDb250cm9sbGVyOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcSW52ZW50b3J5TW9kZWxzXEludmVudG9yeUFjdGlvbkNvbnRyb2w7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQcm9kdWN0Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcV2FyZWhvdXNlczsKdXNlIElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VcUHVyY2hhc2VPcmRlcjsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXJJdGVtOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcR3JuXEdvb2RzUmVjZWl2ZWROb3RlOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcR3JuXEdvb2RzUmVjZWl2ZWRJdGVtOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcR3JuXEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbjsKdXNlIEFwcFxNb2RlbHNcRml4ZWRBc3NldHNcRml4ZWRBc3NldExvY2F0aW9uOwp1c2UgQXBwXE1vZGVsc1xGaXhlZEFzc2V0c1xGaXhlZEFzc2V0SGlzdG9yeTsKdXNlIEFwcFxNb2RlbHNcRml4ZWRBc3NldHNcRml4ZWRBc3NldEJhdGNoOwp1c2UgQXBwXE1vZGVsc1xGaXhlZEFzc2V0c1xGaXhlZEFzc2V0QmF0Y2hJdGVtOwp1c2UgSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcTWFpbDsKdXNlIERCLCBBdXRoLCBEYXRhVGFibGVzOwoKY2xhc3MgR1JOU3RvY2tJbkNvbnRyb2xsZXIgZXh0ZW5kcyBDb250cm9sbGVyCnsKICAgIHB1YmxpYyBmdW5jdGlvbiBoZWFkZXJDb2x1bW5zKCR2YWx1ZT0nJykKICAgIHsKICAgICAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgICAgIFsnU0wnLCAnU0wnXSwKICAgICAgICAgICAgWydQT19yZWZlcmVuY2UnLCAnUE9fcmVmZXJlbmNlJywgJ3RleHQtbGVmdCddLAogICAgICAgICAgICBbJ2dhdGVfaW5fcmVmZXJlbmNlJywgJ2dhdGVfaW5fcmVmZXJlbmNlJywgJ3RleHQtbGVmdCddLAogICAgICAgICAgICBbJ2dhdGVfaW5fZGF0ZScsICdnYXRlX2luX2RhdGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydnYXRlX2luX3F0eScsICdnYXRlX2luX3F0eScsICd0ZXh0LXJpZ2h0J10sCiAgICAgICAgICAgIFsnYXBwcm92ZWRfcXR5JywgJ2FwcHJvdmVkX3F0eScsICd0ZXh0LXJpZ2h0J10sCiAgICAgICAgICAgIFsncmV0dXJuX3F0eScsICdyZXR1cm5fcXR5JywgJ3RleHQtcmlnaHQnXSwKICAgICAgICAgICAgWydyZXBsYWNlX3F0eScsICdyZXBsYWNlX3F0eScsICd0ZXh0LXJpZ2h0J10sCiAgICAgICAgICAgIFsncmVjZWl2ZWRfc3RhdHVzJywgJ3JlY2VpdmVkX3N0YXR1cycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ0dSTicsICdHUk4nLCd0ZXh0LWNlbnRlciddLAogICAgICAgICk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEaXNwbGF5IGEgbGlzdGluZyBvZiB0aGUgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBpbmRleCgpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+YWpheCgpKSB7CiAgICAgICAgICAgICAgICAkdXNlclVuaXRzID0gYXV0aCgpLT51c2VyKCktPnByaW9yaXRpZXMtPnBsdWNrKCdocl91bml0X2lkJyktPnRvQXJyYXkoKTsKICAgICAgICAgICAgICAgICRpdGVtcyA9IEdvb2RzUmVjZWl2ZWROb3RlOjp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAncmVsUHVyY2hhc2VPcmRlcicsCiAgICAgICAgICAgICAgICAgICAgJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcy5yZWxHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW4nCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlcicsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX3NlbmQnLCAneWVzJyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKGlzc2V0KGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCksIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCR1c2VyVW5pdHMpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHVzZXJVbml0cyl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2hyX3VuaXRfaWQnLCAkdXNlclVuaXRzKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxHb29kc1JlY2VpdmVkSXRlbXMucmVsR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaXNfZ3JuX2NvbXBsZXRlJywgJ25vJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgncmVjZWl2ZWRfcXR5JywgJz4nLCAwKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oIWRhdGF0YWJsZU9yZGVyaW5nKCksIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgndXBkYXRlZF9hdCcsICdkZXNjJyk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAkb3B0aW9ucyA9IFsKICAgICAgICAgICAgICAgICAgICAnZ3JuLXN0b2NrLWluLWxpc3QnPT5hdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdncm4tc3RvY2staW4tbGlzdCcpLAogICAgICAgICAgICAgICAgXTsKCiAgICAgICAgICAgICAgICByZXR1cm4gRGF0YVRhYmxlczo6b2YoJGl0ZW1zKQogICAgICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdQT19yZWZlcmVuY2UnLCBmdW5jdGlvbigkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJidG4gYnRuLWxpbmsgYnRuLXhzIiBvbmNsaWNrPSJwdXJjaGFzZU9yZGVyRGV0YWlscygkKHRoaXMpKSIgZGF0YS1zcmM9Iicucm91dGUoJ3Btcy5wdXJjaGFzZS5vcmRlci1saXN0LnNob3cnLCAoaXNzZXQoJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+aWQpID8gJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+aWQgOiAwKSkuJyIgZGF0YS10aXRsZT0iUHVyY2hhc2UgT3JkZXIgRGV0YWlscyI+Jy4oaXNzZXQoJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+cmVmZXJlbmNlX25vKSA/ICRncm4tPnJlbFB1cmNoYXNlT3JkZXItPnJlZmVyZW5jZV9ubyA6ICcnKS4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2E+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdQT19yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlcicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncmVmZXJlbmNlX25vJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdQT19yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUHVyY2hhc2VPcmRlcjo6c2VsZWN0KCdwdXJjaGFzZV9vcmRlcnMucmVmZXJlbmNlX25vJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3B1cmNoYXNlX29yZGVycy5pZCcsICdnb29kc19yZWNlaXZlZF9ub3Rlcy5wdXJjaGFzZV9vcmRlcl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZ2F0ZV9pbl9yZWZlcmVuY2UnLCBmdW5jdGlvbigkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJidG4gYnRuLWxpbmsgYnRuLXhzIiBvbmNsaWNrPSJzaG93UUNFUE9EZXRhaWxzKCQodGhpcykpIiBkYXRhLXNyYz0iJy5yb3V0ZSgncG1zLmdybi5ncm4tcHJvY2Vzcy5zaG93JywkZ3JuLT5pZCkuJyIgZGF0YS10aXRsZT0iR2F0ZS1JbiBEZXRhaWxzIj4nLiRncm4tPnJlZmVyZW5jZV9uby4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2E+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdnYXRlX2luX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3JlZmVyZW5jZV9ubycsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdnYXRlX2luX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlckJ5KCdyZWZlcmVuY2Vfbm8nLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2dhdGVfaW5fZGF0ZScsIGZ1bmN0aW9uKCRncm4pewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJGdybi0+cmVjZWl2ZWRfZGF0ZSkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2dhdGVfaW5fZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3JlY2VpdmVkX2RhdGUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignZ2F0ZV9pbl9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ3JlY2VpdmVkX2RhdGUnLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2dhdGVfaW5fcXR5JywgZnVuY3Rpb24oJGdybil7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkZ3JuLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnN1bSgncXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYXBwcm92ZWRfcXR5JywgZnVuY3Rpb24oJGdybil7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkZ3JuLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPndoZXJlKCdxdWFsaXR5X2Vuc3VyZScsJ2FwcHJvdmVkJyktPnN1bSgncmVjZWl2ZWRfcXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncmV0dXJuX3F0eScsIGZ1bmN0aW9uKCRncm4pewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGdybi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT53aGVyZSgncXVhbGl0eV9lbnN1cmUnLCdyZXR1cm4tY2hhbmdlJyktPnN1bSgncXR5JyktJGdybi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT53aGVyZSgncXVhbGl0eV9lbnN1cmUnLCdyZXR1cm4tY2hhbmdlJyktPnN1bSgncmVjZWl2ZWRfcXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncmVwbGFjZV9xdHknLCBmdW5jdGlvbigkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRncm4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+d2hlcmUoJ3F1YWxpdHlfZW5zdXJlJywncmV0dXJuLWNoYW5nZScpLT5zdW0oJ3F0eScpLSRncm4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+d2hlcmUoJ3F1YWxpdHlfZW5zdXJlJywncmV0dXJuLWNoYW5nZScpLT5zdW0oJ3JlY2VpdmVkX3F0eScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdyZWNlaXZlZF9zdGF0dXMnLCBmdW5jdGlvbigkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGdybi0+cmVjZWl2ZWRfc3RhdHVzID09ICdwYXJ0aWFsJyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGNsYXNzPSJidG4gYnRuLXdhcm5pbmcgYnRuLXhzIj5QYXJ0aWFsIFJlY2VpdmVkPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlaWYoJGdybi0+cmVjZWl2ZWRfc3RhdHVzID09ICdmdWxsJyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGNsYXNzPSJidG4gYnRuLXN1Y2Nlc3MgYnRuLXhzIj5GdWxsIFJlY2VpdmVkPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBjbGFzcz0iYnRuIGJ0bi1kYXJrIGJ0bi14cyI+Jy51Y3dvcmRzKCRncm4tPnJlY2VpdmVkX3N0YXR1cykuJzwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignR1JOJywgZnVuY3Rpb24oJGdybikgdXNlKCRvcHRpb25zKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGdybi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zKCktPndoZXJlSGFzKCdyZWxHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW4nLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX2dybl9jb21wbGV0ZScsJ25vJyktPndoZXJlKCdyZWNlaXZlZF9xdHknLCc+JywgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLT5jb3VudCgpPjApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRvcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9Iicucm91dGUoJ3Btcy5ncm4uc3RvY2suaW4ubGlzdCcsICRncm4tPmlkKS4nIiBjbGFzcz0iYnRuIGJ0bi1zdWNjZXNzIGJ0bi14cyI+R1JOPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+cmF3Q29sdW1ucyhbJ1BPX3JlZmVyZW5jZScsICdnYXRlX2luX3JlZmVyZW5jZScsICdyZWNlaXZlZF9zdGF0dXMnLCAnR1JOJ10pCiAgICAgICAgICAgICAgICAgICAgLT5tYWtlKHRydWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuZ3JuLXN0b2NrLWluLnFjZS1saXN0JywgWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAiR1JOIFdhaXRpbmcgTGlzdCIsCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPmhlYWRlckNvbHVtbnMoKSwKICAgICAgICAgICAgXSk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGdybkhlYWRlckNvbHVtbnMoJHZhbHVlPScnKQogICAgewogICAgICAgIHJldHVybiBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgICAgICBbJ1BPX3JlZmVyZW5jZScsICdQT19yZWZlcmVuY2UnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydHUk5fcmVmZXJlbmNlJywgJ0dSTl9yZWZlcmVuY2UnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydnYXRlX2luX3JlZmVyZW5jZScsICdnYXRlX2luX3JlZmVyZW5jZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2dhdGVfaW5fZGF0ZScsICdnYXRlX2luX2RhdGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydnYXRlX2luX3F0eScsICdnYXRlX2luX3F0eScsICd0ZXh0LXJpZ2h0J10sCiAgICAgICAgICAgIFsnYXBwcm92ZWRfcXR5JywgJ2FwcHJvdmVkX3F0eScsICd0ZXh0LXJpZ2h0J10sCiAgICAgICAgICAgIFsncmV0dXJuX3F0eScsICdyZXR1cm5fcXR5JywgJ3RleHQtcmlnaHQnXSwKICAgICAgICAgICAgWydyZXBsYWNlX3F0eScsICdyZXBsYWNlX3F0eScsICd0ZXh0LXJpZ2h0J10sCiAgICAgICAgICAgIFsncmVjZWl2ZWRfc3RhdHVzJywgJ3JlY2VpdmVkX3N0YXR1cycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3NsaXAnLCAnc2xpcCcsJ3RleHQtY2VudGVyJ10sCiAgICAgICAgKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gZ3JuTGlzdCgpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+YWpheCgpKSB7CiAgICAgICAgICAgICAgICAkdXNlclVuaXRzID0gYXV0aCgpLT51c2VyKCktPnByaW9yaXRpZXMtPnBsdWNrKCdocl91bml0X2lkJyktPnRvQXJyYXkoKTsKICAgICAgICAgICAgICAgICRpdGVtcyA9IEdvb2RzUmVjZWl2ZWROb3RlOjp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAncmVsUHVyY2hhc2VPcmRlcicsCiAgICAgICAgICAgICAgICAgICAgJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcy5yZWxHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW4nCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlcicsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX3NlbmQnLCAneWVzJyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKGlzc2V0KGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+YXNfdW5pdF9pZCksIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCR1c2VyVW5pdHMpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHVzZXJVbml0cyl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2hyX3VuaXRfaWQnLCAkdXNlclVuaXRzKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxHb29kc1JlY2VpdmVkSXRlbXMucmVsR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaXNfZ3JuX2NvbXBsZXRlJywgJ3llcycpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXIucHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy5yZXF1aXNpdGlvbi5yZXF1aXNpdGlvbkl0ZW1zLnByb2R1Y3QnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19zZXJ2aWNlJywgMCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyYnkoJ3VwZGF0ZWRfYXQnLCAnZGVzYycpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgcmV0dXJuIERhdGFUYWJsZXM6Om9mKCRpdGVtcykKICAgICAgICAgICAgICAgICAgICAtPmFkZEluZGV4Q29sdW1uKCkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignUE9fcmVmZXJlbmNlJywgZnVuY3Rpb24oJGdybil7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iYnRuIGJ0bi1saW5rIiBvbmNsaWNrPSJwdXJjaGFzZU9yZGVyRGV0YWlscygkKHRoaXMpKSIgZGF0YS1zcmM9Iicucm91dGUoJ3Btcy5wdXJjaGFzZS5vcmRlci1saXN0LnNob3cnLCAoaXNzZXQoJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+aWQpID8gJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+aWQgOiAwKSkuJyIgZGF0YS10aXRsZT0iUHVyY2hhc2UgT3JkZXIgRGV0YWlscyI+Jy4oaXNzZXQoJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+cmVmZXJlbmNlX25vKSA/ICRncm4tPnJlbFB1cmNoYXNlT3JkZXItPnJlZmVyZW5jZV9ubyA6ICcnKS4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2E+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdQT19yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlcicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncmVmZXJlbmNlX25vJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdQT19yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUHVyY2hhc2VPcmRlcjo6c2VsZWN0KCdwdXJjaGFzZV9vcmRlcnMucmVmZXJlbmNlX25vJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3B1cmNoYXNlX29yZGVycy5pZCcsICdnb29kc19yZWNlaXZlZF9ub3Rlcy5wdXJjaGFzZV9vcmRlcl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignR1JOX3JlZmVyZW5jZScsIGZ1bmN0aW9uKCRncm4pewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGNsYXNzPSJ0ZXh0LXN1Y2Nlc3MiIGhyZWY9IicudXJsKCdwbXMvZ3JuLXNsaXAvJy4kZ3JuLT5pZCkuJyIgdGFyZ2V0PSJfYmxhbmsiPicuJGdybi0+Z3JuX3JlZmVyZW5jZV9uby4nPC9hPic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignR1JOX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdncm5fcmVmZXJlbmNlX25vJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ0dSTl9yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgnZ3JuX3JlZmVyZW5jZV9ubycsICRvcmRlcik7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZ2F0ZV9pbl9yZWZlcmVuY2UnLCBmdW5jdGlvbigkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJidG4gYnRuLWxpbmsiIG9uY2xpY2s9InNob3dHUk5QT0RldGFpbHMoJCh0aGlzKSkiIGRhdGEtc3JjPSInLnJvdXRlKCdwbXMuZ3JuLmdybi1wcm9jZXNzLnNob3cnLCRncm4tPmlkKS4nIiBkYXRhLXRpdGxlPSJHYXRlLUluIERldGFpbHMiPicuJGdybi0+cmVmZXJlbmNlX25vLicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYT4nOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2dhdGVfaW5fcmVmZXJlbmNlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncmVmZXJlbmNlX25vJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2dhdGVfaW5fcmVmZXJlbmNlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ3JlZmVyZW5jZV9ubycsICRvcmRlcik7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZ2F0ZV9pbl9kYXRlJywgZnVuY3Rpb24oJGdybil7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkZ3JuLT5yZWNlaXZlZF9kYXRlKSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignZ2F0ZV9pbl9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncmVjZWl2ZWRfZGF0ZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdnYXRlX2luX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJCeSgncmVjZWl2ZWRfZGF0ZScsICRvcmRlcik7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZ2F0ZV9pbl9xdHknLCBmdW5jdGlvbigkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRncm4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+c3VtKCdxdHknKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhcHByb3ZlZF9xdHknLCBmdW5jdGlvbigkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRncm4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+d2hlcmUoJ3F1YWxpdHlfZW5zdXJlJywnYXBwcm92ZWQnKS0+c3VtKCdyZWNlaXZlZF9xdHknKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdyZXR1cm5fcXR5JywgZnVuY3Rpb24oJGdybil7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkZ3JuLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPndoZXJlKCdxdWFsaXR5X2Vuc3VyZScsJ3JldHVybi1jaGFuZ2UnKS0+c3VtKCdxdHknKS0kZ3JuLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPndoZXJlKCdxdWFsaXR5X2Vuc3VyZScsJ3JldHVybi1jaGFuZ2UnKS0+c3VtKCdyZWNlaXZlZF9xdHknKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdyZXBsYWNlX3F0eScsIGZ1bmN0aW9uKCRncm4pewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGdybi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT53aGVyZSgncXVhbGl0eV9lbnN1cmUnLCdyZXR1cm4tY2hhbmdlJyktPnN1bSgncXR5JyktJGdybi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT53aGVyZSgncXVhbGl0eV9lbnN1cmUnLCdyZXR1cm4tY2hhbmdlJyktPnN1bSgncmVjZWl2ZWRfcXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3JlY2VpdmVkX3N0YXR1cycsIGZ1bmN0aW9uKCRncm4pewogICAgICAgICAgICAgICAgICAgICAgICBpZigkZ3JuLT5yZWNlaXZlZF9zdGF0dXMgPT0gJ3BhcnRpYWwnKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgY2xhc3M9ImJ0biBidG4td2FybmluZyBidG4teHMiPlBhcnRpYWwgUmVjZWl2ZWQ8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2VpZigkZ3JuLT5yZWNlaXZlZF9zdGF0dXMgPT0gJ2Z1bGwnKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgY2xhc3M9ImJ0biBidG4tc3VjY2VzcyBidG4teHMiPkZ1bGwgUmVjZWl2ZWQ8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGNsYXNzPSJidG4gYnRuLWRhcmsgYnRuLXhzIj4nLnVjd29yZHMoJGdybi0+cmVjZWl2ZWRfc3RhdHVzKS4nPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdzbGlwJywgZnVuY3Rpb24oJGdybil7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgY2xhc3M9ImJ0biBidG4tc3VjY2VzcyBidG4teHMiIGhyZWY9IicudXJsKCdwbXMvZ3JuLXNsaXAvJy4kZ3JuLT5pZCkuJyIgdGFyZ2V0PSJfYmxhbmsiPjxpIGNsYXNzPSJsYSBsYS1wcmludCI+PC9pPjwvYT4nOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsnUE9fcmVmZXJlbmNlJywgJ0dSTl9yZWZlcmVuY2UnLCAnZ2F0ZV9pbl9yZWZlcmVuY2UnLCAncmVjZWl2ZWRfc3RhdHVzJywgJ3NsaXAnXSkKICAgICAgICAgICAgICAgICAgICAtPm1ha2UodHJ1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5ncm4tc3RvY2staW4uZ3JuLWxpc3QnLCBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICJHUk4gTGlzdCIsCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPmdybkhlYWRlckNvbHVtbnMoKQogICAgICAgICAgICBdKTsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFN0b3JlIGEgbmV3bHkgY3JlYXRlZCByZXNvdXJjZSBpbiBzdG9yYWdlLgogICAgICoKICAgICAqIEBwYXJhbSAgXElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0ICAkcmVxdWVzdAogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KCiAgICBwdWJsaWMgZnVuY3Rpb24gZ3JuU3RvY2tJbkxpc3QoJGlkKQogICAgewogICAgICAgICR0aXRsZSA9ICJHUk4gU3RvY2sgSW4gTGlzdCI7CgogICAgICAgIHRyeSB7CgogICAgICAgICAgICAkZ3JuID0gR29vZHNSZWNlaXZlZE5vdGU6OndpdGgoWwogICAgICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXIucmVsUXVvdGF0aW9uLmV4Y2hhbmdlUmF0ZS5jdXJyZW5jeScKICAgICAgICAgICAgXSktPmZpbmQoJGlkKTsKICAgICAgICAgICAgJGdvb2RzUmVjZWl2ZUl0ZW1zID0gR29vZHNSZWNlaXZlZEl0ZW06OndoZXJlKCdnb29kc19yZWNlaXZlZF9ub3RlX2lkJywgJGlkKQogICAgICAgICAgICAgICAgLT5wbHVjaygnaWQnKQogICAgICAgICAgICAgICAgLT5hbGwoKTsKCiAgICAgICAgICAgICRncm5fc3RvY2tfaW5fbGlzdHMgPSBHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW46OndpdGgoWwogICAgICAgICAgICAgICAgJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcy5yZWxHb29kc1JlY2VpdmVkTm90ZScsCiAgICAgICAgICAgICAgICAncmVsR29vZHNSZWNlaXZlZEl0ZW1zLnJlbFByb2R1Y3QucHJvZHVjdFVuaXQnLAogICAgICAgICAgICAgICAgJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcy5yZWxQcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JywKICAgICAgICAgICAgICAgICdyZWxHb29kc1JlY2VpdmVkSXRlbXMucmVsUHJvZHVjdC5hdHRyaWJ1dGVzLmF0dHJpYnV0ZU9wdGlvbi5hdHRyaWJ1dGUnLAogICAgICAgICAgICBdKQogICAgICAgICAgICAtPndoZXJlSW4oJ2dvb2RzX3JlY2VpdmVkX2l0ZW1faWQnLCAkZ29vZHNSZWNlaXZlSXRlbXMpCiAgICAgICAgICAgIC0+d2hlcmUoJ2lzX2dybl9jb21wbGV0ZScsICdubycpCiAgICAgICAgICAgIC0+d2hlcmUoJ3JlY2VpdmVkX3F0eScsICc+JywgMCkKICAgICAgICAgICAgLT5vcmRlcmJ5KCdnb29kc19yZWNlaXZlZF9pdGVtX2lkJywgJ2Rlc2MnKQogICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAgICAgJHdhcmVob3VzZV9pZHMgPSBBdXRoOjp1c2VyKCktPnJlbFVzZXJzV2FyZWhvdXNlLT5wbHVjaygnaWQnKS0+YWxsKCk7CgogICAgICAgICAgICBpZiAoY291bnQoJHdhcmVob3VzZV9pZHMpID4gMCkgewogICAgICAgICAgICAgICAgJHdhcmVob3VzZXMgPSBXYXJlaG91c2VzOjp3aGVyZUluKCdpZCcsICR3YXJlaG91c2VfaWRzKS0+c2VsZWN0KCduYW1lJywgJ2lkJyktPmdldCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJHdhcmVob3VzZXMgPSBXYXJlaG91c2VzOjpzZWxlY3QoJ25hbWUnLCAnaWQnKS0+Z2V0KCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5ncm4tc3RvY2staW4uZ3JuLXN0b2NrLWluLWxpc3QnLCBjb21wYWN0KCdncm5fc3RvY2tfaW5fbGlzdHMnLCAndGl0bGUnLCAnd2FyZWhvdXNlcycsICdpZCcsICdncm4nKSk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFN0b3JlIGEgbmV3bHkgY3JlYXRlZCByZXNvdXJjZSBpbiBzdG9yYWdlLgogICAgICoKICAgICAqIEBwYXJhbSAgXElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0ICAkcmVxdWVzdAogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KCiAgICBwdWJsaWMgZnVuY3Rpb24gc3RvcmUoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkcmVxdWVzdC0+dmFsaWRhdGUoWwogICAgICAgICAgICAnY2hhbGxhbl9maWxlJyA9PiAnaW1hZ2V8bWltZXM6anBlZyxqcGcscG5nLGdpZixwZGZ8bnVsbGFibGV8bWF4OjUwNDgnLAogICAgICAgIF0pOwoKICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgICRncm4gPSBHb29kc1JlY2VpdmVkTm90ZTo6ZmluZCgkcmVxdWVzdC0+Z29vZHNfcmVjZWl2ZWRfbm90ZV9pZCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJHB1cmNoYXNlX29yZGVyX2lkID0gW107CiAgICAgICAgICAgICRzdG9ja0lucyA9IFtdOwogICAgICAgICAgICAkY3JlZGl0ID0gMDsKICAgICAgICAgICAgZm9yZWFjaCAoJHJlcXVlc3QtPmlkIGFzICRrZXkgPT4gJHZhbHVlKSB7CgogICAgICAgICAgICAgICAgaWYgKCRyZXF1ZXN0LT53YXJlaG91c2VfaWRbJGtleV0pIHsKICAgICAgICAgICAgICAgICAgICAkd2FyZUhvdXNlID0gV2FyZWhvdXNlczo6ZmluZE9yRmFpbCgkcmVxdWVzdC0+d2FyZWhvdXNlX2lkWyRrZXldKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkbW9kZWwgPSBHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW46OndoZXJlKCdpZCcsICRrZXkpLT53aGVyZSgnaXNfZ3JuX2NvbXBsZXRlJywgJ25vJyktPmZpcnN0KCk7CgogICAgICAgICAgICAgICAgaWYgKGNvdW50KChhcnJheSkkbW9kZWwpID4gMCkgewogICAgICAgICAgICAgICAgICAgICRwcm9kdWN0ID0gUHJvZHVjdDo6ZmluZE9yRmFpbCgkbW9kZWwtPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cHJvZHVjdF9pZCk7CiAgICAgICAgICAgICAgICAgICAgbmV3IEludmVudG9yeUFjdGlvbkNvbnRyb2woJHByb2R1Y3QsICR3YXJlSG91c2UsICRtb2RlbC0+dG90YWxfYW1vdW50LCAkbW9kZWwtPnJlY2VpdmVkX3F0eSwgJ2FjdGl2ZScsICRtb2RlbC0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxHb29kc1JlY2VpdmVkTm90ZS0+Z3JuX3JlZmVyZW5jZV9ubyk7CgogICAgICAgICAgICAgICAgICAgICRtb2RlbC0+aXNfZ3JuX2NvbXBsZXRlID0gJ3llcyc7CiAgICAgICAgICAgICAgICAgICAgJG1vZGVsLT53YXJlaG91c2VfaWQgPSAkd2FyZUhvdXNlLT5pZDsKCiAgICAgICAgICAgICAgICAgICAgJHByb2plY3QgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBpZihpc3NldCgkZ3JuLT5yZWxQdXJjaGFzZU9yZGVyLT5wdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zWzBdKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRncm4tPnJlbFB1cmNoYXNlT3JkZXItPnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMgYXMgJGtleSA9PiAkcG9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkcG9yLT5yZXF1aXNpdGlvbi0+cmVxdWlzaXRpb25JdGVtcy0+d2hlcmUoJ3Byb2R1Y3RfaWQnLCAkbW9kZWwtPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cHJvZHVjdF9pZCktPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihpc3NldCgkcG9yLT5yZXF1aXNpdGlvbi0+cHJvamVjdFRhc2stPmlkKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwcm9qZWN0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmKCRtb2RlbC0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT5jYXRlZ29yeS0+aXNfZml4ZWRfYXNzZXQgPT0gMSB8fCAkbW9kZWwtPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+Y2F0ZWdvcnktPmlzX2N3aXAgPT0gMSB8fCAkcHJvamVjdCl7CiAgICAgICAgICAgICAgICAgICAgICAgICRmaXhlZEFzc2V0TG9jYXRpb24gPSBcQXBwXE1vZGVsc1xGaXhlZEFzc2V0c1xGaXhlZEFzc2V0TG9jYXRpb246OndoZXJlKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd1bml0X2lkJyA9PiAkbW9kZWwtPnJlbFB1cmNoYXNlT3JkZXItPmhyX3VuaXRfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2F0ZWdvcnlfaWQnID0+ICRtb2RlbC0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT5jYXRlZ29yeS0+cGFyZW50X2lkLAogICAgICAgICAgICAgICAgICAgICAgICBdKS0+Zmlyc3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgJG1vZGVsLT5maXhlZF9hc3NldF9sb2NhdGlvbl9pZCA9IChpc3NldCgkZml4ZWRBc3NldExvY2F0aW9uLT5pZCkgPyAkZml4ZWRBc3NldExvY2F0aW9uLT5pZCA6IDApOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJG1vZGVsLT5zYXZlKCk7CgogICAgICAgICAgICAgICAgICAgICRjcmVkaXQgKz0gJG1vZGVsLT50b3RhbF9hbW91bnQ7CgogICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJHN0b2NrSW5zLCAkbW9kZWwtPmlkKTsKICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRwdXJjaGFzZV9vcmRlcl9pZCwgJG1vZGVsLT5wdXJjaGFzZV9vcmRlcl9pZCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcignRGF0YSBub3QgZm91bmQuISEnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGdvb2RzUmVjZWl2ZWROb3RlID0gR29vZHNSZWNlaXZlZE5vdGU6OndoZXJlKCdpZCcsICRyZXF1ZXN0LT5nb29kc19yZWNlaXZlZF9ub3RlX2lkKS0+Zmlyc3QoKTsKICAgICAgICAgICAgaWYgKCRyZXF1ZXN0LT5oYXNGaWxlKCdjaGFsbGFuX2ZpbGUnKSkgewogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkZ29vZHNSZWNlaXZlZE5vdGUtPmNoYWxsYW5fZmlsZSkpIHsKICAgICAgICAgICAgICAgICAgICB1bmxpbmsocHVibGljX3BhdGgoJGdvb2RzUmVjZWl2ZWROb3RlLT5jaGFsbGFuX2ZpbGUpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkZ29vZHNSZWNlaXZlZE5vdGUtPmNoYWxsYW5fZmlsZSA9ICR0aGlzLT5maWxlVXBsb2FkKCRyZXF1ZXN0LT5maWxlKCdjaGFsbGFuX2ZpbGUnKSwgJ3VwbG9hZC9ncm4vY2hhbGxhbi1maWxlJyk7CiAgICAgICAgICAgICAgICAkZ29vZHNSZWNlaXZlZE5vdGUtPnNhdmUoKTsKICAgICAgICAgICAgfQoKCiAgICAgICAgICAgICRlbnRyeSA9ICR0aGlzLT5ydW5MZWRnZXJRdWVyaWVzKCRzdG9ja0lucywgJGdybik7CiAgICAgICAgICAgIGlmKGlzc2V0KCRwdXJjaGFzZV9vcmRlcl9pZFswXSkgJiYgJGVudHJ5WydzdWNjZXNzJ10pewogICAgICAgICAgICAgICAgZm9yZWFjaCgkcHVyY2hhc2Vfb3JkZXJfaWQgYXMgJGtleSA9PiAkcG9faWQpewogICAgICAgICAgICAgICAgICAgIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVyRW50cnk6OnVwZGF0ZU9yQ3JlYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3N1cHBsaWVyX2lkJyA9PiBQdXJjaGFzZU9yZGVyOjpmaW5kT3JGYWlsKCRwb19pZCktPnJlbFF1b3RhdGlvbi0+c3VwcGxpZXJfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdwdXJjaGFzZV9vcmRlcl9pZCcgPT4gJHBvX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJ2dybicsCiAgICAgICAgICAgICAgICAgICAgICAgICdlbnRyeV9pZCcgPT4gJGVudHJ5WydlbnRyeSddLT5pZCwKICAgICAgICAgICAgICAgICAgICBdLFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3VwZGF0ZWRfYXQnID0+IGRhdGUoJ1ktbS1kIEg6aTpzJykKICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoaXNzZXQoJHN0b2NrSW5zWzBdKSl7CiAgICAgICAgICAgICAgICAkcHJvamVjdCA9IGlzc2V0KCRncm4tPnJlbFB1cmNoYXNlT3JkZXItPnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnNbMF0tPnJlcXVpc2l0aW9uLT5wcm9qZWN0VGFzay0+aWQpOwogICAgICAgICAgICAgICAgZm9yZWFjaCgkc3RvY2tJbnMgYXMgJGtleSA9PiAkc3RvY2tfaW5faWQpewogICAgICAgICAgICAgICAgICAgICRzdG9ja0luID0gR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luOjp3aGVyZSgnaWQnLCAkc3RvY2tfaW5faWQpLT53aGVyZSgnaXNfZ3JuX2NvbXBsZXRlJywgJ3llcycpLT5maXJzdCgpOwogICAgICAgICAgICAgICAgICAgICRjYXBpdGFsaXplID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBpZigkcHJvamVjdCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRzdG9ja0luLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmNhdGVnb3J5LT5pc19jd2lwID09IDEpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNhcGl0YWxpemUgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICBpZigkc3RvY2tJbi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT5jYXRlZ29yeS0+aXNfZml4ZWRfYXNzZXQgPT0gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2FwaXRhbGl6ZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyByZXR1cm4gWwogICAgICAgICAgICAgICAgICAgIC8vICAgICAncHJvamVjdCcgPT4gJHByb2plY3QsCiAgICAgICAgICAgICAgICAgICAgLy8gICAgICdpc19jd2lwJyA9PiAoJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+Y2F0ZWdvcnktPmlzX2N3aXAgPT0gMSksCiAgICAgICAgICAgICAgICAgICAgLy8gICAgICdpc19maXhlZF9hc3NldCcgPT4gKCRzdG9ja0luLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmNhdGVnb3J5LT5pc19maXhlZF9hc3NldCA9PSAxKSwKICAgICAgICAgICAgICAgICAgICAvLyAgICAgJ2NhcGl0YWxpemUnID0+ICRjYXBpdGFsaXplLAogICAgICAgICAgICAgICAgICAgIC8vIF07CgogICAgICAgICAgICAgICAgICAgIC8vIGRkKCRjYXBpdGFsaXplKTsKCiAgICAgICAgICAgICAgICAgICAgaWYoJGNhcGl0YWxpemUgJiYgJHN0b2NrSW4tPnJlY2VpdmVkX3F0eSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICAkYmF0Y2ggPSBGaXhlZEFzc2V0QmF0Y2g6OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZ29vZHNfcmVjZWl2ZWRfaXRlbXNfc3RvY2tfaW5faWQnID0+ICRzdG9ja0luLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdiYXRjaCcgPT4gdW5pcXVlQ29kZVdpdGhvdXRQcmVmaXgoOCwgJ2ZpeGVkX2Fzc2V0X2JhdGNoZXMnLCAnYmF0Y2gnKSwKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGVwcmVjaWF0aW9uX21ldGhvZF9pZCcgPT4gJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+ZGVwcmVjaWF0aW9uX21ldGhvZF9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdiYXNlX3JhdGUnID0+ICRzdG9ja0luLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmJhc2VfcmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyYXRlX211bHRpcGxpZXInID0+ICRzdG9ja0luLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPnJhdGVfbXVsdGlwbGllciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZXByZWNpYXRpb25fcmF0ZScgPT4gJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+ZGVwcmVjaWF0aW9uX3JhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaXNfeWVhcmx5JyA9PiAkc3RvY2tJbi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT5pc195ZWFybHksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAneWVhcnMnID0+ICRzdG9ja0luLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPnllYXJzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2lzX29uZXRpbWUnID0+ICRzdG9ja0luLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmlzX29uZXRpbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGVwcmVjaWF0aW9uX3N0YXJ0X2RhdGUnID0+IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRzdG9ja0luLT51cGRhdGVkX2F0KSksCiAgICAgICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgICAgICBpZigkYmF0Y2gpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yKCRpPTE7JGk8PSRzdG9ja0luLT5yZWNlaXZlZF9xdHk7JGkrKyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRml4ZWRBc3NldEJhdGNoSXRlbTo6Y3JlYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2ZpeGVkX2Fzc2V0X2JhdGNoX2lkJyA9PiAkYmF0Y2gtPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYXNzZXRfY29kZScgPT4gJGJhdGNoLT5iYXRjaC4nLScuJGksCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGVwcmVjaWF0aW9uX21ldGhvZF9pZCcgPT4gJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+ZGVwcmVjaWF0aW9uX21ldGhvZF9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Jhc2VfcmF0ZScgPT4gJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+YmFzZV9yYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmF0ZV9tdWx0aXBsaWVyJyA9PiAkc3RvY2tJbi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT5yYXRlX211bHRpcGxpZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZXByZWNpYXRpb25fcmF0ZScgPT4gJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+ZGVwcmVjaWF0aW9uX3JhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpc195ZWFybHknID0+ICRzdG9ja0luLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmlzX3llYXJseSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3llYXJzJyA9PiAkc3RvY2tJbi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT55ZWFycywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2lzX29uZXRpbWUnID0+ICRzdG9ja0luLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmlzX29uZXRpbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZXByZWNpYXRpb25fc3RhcnRfZGF0ZScgPT4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHN0b2NrSW4tPnVwZGF0ZWRfYXQpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy9zYXZlU3VwcGxpZXJMZWRnZXIoJGdvb2RzUmVjZWl2ZWROb3RlLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnN1cHBsaWVyX2lkLCBkYXRlKCdZLW0tZCcpLCAwLCAkY3JlZGl0LCAnJywgJycsICdTdXBwbGllciBMaWFiaWxpdHkgQWdhaW5zdCBHUk4nKTsKCiAgICAgICAgICAgIC8vTm90aWZpY2F0aW9uCiAgICAgICAgICAgICRtZXNzYWdlID0gJzxzcGFuIGNsYXNzPSJub3RpZmljYXRpb24tbGlua3MiIGRhdGEtc3JjPSInIC4gcm91dGUoJ3Btcy5wdXJjaGFzZS5vcmRlci1saXN0LnNob3cnLCAkZ29vZHNSZWNlaXZlZE5vdGUtPnB1cmNoYXNlX29yZGVyX2lkKSAuICc/dmlldyIgZGF0YS10aXRsZT0iUHVyY2hhc2UgT3JkZXIgRGV0YWlscyI+UmVmZXJlbmNlIE5vOicgLiAkZ29vZHNSZWNlaXZlZE5vdGUtPnJlbFB1cmNoYXNlT3JkZXItPnJlZmVyZW5jZV9ubyAuICcuIFdhaXRpbmcgZm9yIHRoZSBCaWxsaW5nLjwvc3Bhbj4nOwoKICAgICAgICAgICAgQ3JlYXRlT3JVcGRhdGVOb3RpZmljYXRpb24oJycsIGdldE1hbmFnZXJJbmZvKCdQdXJjaGFzZS1EZXBhcnRtZW50JyksICRtZXNzYWdlLCAndW5yZWFkJywgJ3NlbmQtdG8tYmlsbGluZycsICcnKTsKCiAgICAgICAgICAgIERCOjpjb21taXQoKTsKCiAgICAgICAgICAgIHJldHVybiByZWRpcmVjdCgncG1zL3N1cHBsaWVyL3JhdGluZy8nIC4gJGdvb2RzUmVjZWl2ZWROb3RlLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnN1cHBsaWVyX2lkIC4gJy8nIC4gJGdvb2RzUmVjZWl2ZWROb3RlLT5pZCAuICc/dGFibGU9Z29vZHNfcmVjZWl2ZWRfbm90ZXMmZmllbGQ9JyAuICRnb29kc1JlY2VpdmVkTm90ZS0+aWQgLiAnJnR5cGU9Z3JuJyktPndpdGgoWydtZXNzYWdlJyA9PiAnR1JOIFN1Y2Nlc3NmdWwnLCAnYWxlcnQtdHlwZScgPT4gJ3N1Y2Nlc3MnXSk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBydW5MZWRnZXJRdWVyaWVzKCRpZHMsICRncm4pCiAgICB7CiAgICAgICAgJHN0b2NrSW5zID0gR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luOjp3aGVyZUluKCdpZCcsICRpZHMpLT53aGVyZSgnaXNfZ3JuX2NvbXBsZXRlJywgJ3llcycpLT5nZXQoKTsKICAgICAgICAkaXRlbXMgPSBbXTsKICAgICAgICBpZihpc3NldCgkc3RvY2tJbnNbMF0pKXsKICAgICAgICAgICAgZm9yZWFjaCgkc3RvY2tJbnMgYXMgJGtleSA9PiAkaXRlbSl7CiAgICAgICAgICAgICAgICAkY29zdF9jZW50cmVfaWQgPSAkaXRlbS0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxHb29kc1JlY2VpdmVkTm90ZS0+cmVsUHVyY2hhc2VPcmRlci0+Y29zdF9jZW50cmVfaWQ7CgogICAgICAgICAgICAgICAgJGRlYml0X2FjY291bnQgPSBhY2NvdW50RGVmYXVsdFNldHRpbmdzKClbJ2ludmVudG9yeV9hY2NvdW50J107CiAgICAgICAgICAgICAgICBpZihpc3NldCgkaXRlbS0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT5pZCkpewogICAgICAgICAgICAgICAgICAgIGlmKCRpdGVtLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmlzX3NlcnZpY2UgPT0gMSl7CiAgICAgICAgICAgICAgICAgICAgICAgICRkZWJpdF9hY2NvdW50ID0gYWNjb3VudERlZmF1bHRTZXR0aW5ncygpWydjb2dzX2FjY291bnQnXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGl0ZW0tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+Y29nc19hY2NvdW50X2lkID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGViaXRfYWNjb3VudCA9ICRpdGVtLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmNvZ3NfYWNjb3VudF9pZDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICBpZigkaXRlbS0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT5pbnZlbnRvcnlfYWNjb3VudF9pZCA+IDApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRlYml0X2FjY291bnQgPSAkaXRlbS0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT5pbnZlbnRvcnlfYWNjb3VudF9pZDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRpdGVtcywgWwogICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJGNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkZGViaXRfYWNjb3VudCwKICAgICAgICAgICAgICAgICAgICAnZGViaXQnID0+ICRpdGVtLT50b3RhbF9hbW91bnQsCiAgICAgICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAnR1JOIDo6IEludmVudG9yeSBEZWJpdCcsCiAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdncm4nLAogICAgICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRpdGVtLT5pZAogICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkaXRlbXMsIFsKICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRjb3N0X2NlbnRyZV9pZCwKICAgICAgICAgICAgICAgICAgICAvLyAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gKGlzc2V0KCRpdGVtLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+cGF5YWJsZV9hY2NvdW50X2lkKSAmJiAkaXRlbS0+cmVsUHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPnBheWFibGVfYWNjb3VudF9pZCA+IDAgPyAkaXRlbS0+cmVsUHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPnBheWFibGVfYWNjb3VudF9pZCA6IGFjY291bnREZWZhdWx0U2V0dGluZ3MoKVsnc3VwcGxpZXJfcGF5YWJsZV9hY2NvdW50J10pLAogICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiBhY2NvdW50RGVmYXVsdFNldHRpbmdzKClbJ2dyaXJfYWNjb3VudCddLAogICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAkaXRlbS0+dG90YWxfYW1vdW50LAogICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICdHUk4gOjogR1IvSVIgQ3JlZGl0JywKICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJ2dybicsCiAgICAgICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJGl0ZW0tPmlkCiAgICAgICAgICAgICAgICBdKTsKCiAgICAgICAgICAgICAgICAvLyBhcnJheV9wdXNoKCRpdGVtcywgWwogICAgICAgICAgICAgICAgLy8gICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gMiwKICAgICAgICAgICAgICAgIC8vICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gKGlzc2V0KCRpdGVtLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+cGF5YWJsZV9kaXNjb3VudF9pZCkgJiYgJGl0ZW0tPnJlbFB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5wYXlhYmxlX2Rpc2NvdW50X2lkID4gMCA/ICRpdGVtLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+cGF5YWJsZV9kaXNjb3VudF9pZCA6IGFjY291bnREZWZhdWx0U2V0dGluZ3MoKVsnc3VwcGxpZXJfcGF5YWJsZV9kaXNjb3VudF9hY2NvdW50J10pLAogICAgICAgICAgICAgICAgLy8gICAgICdkZWJpdCcgPT4gJGl0ZW0tPmRpc2NvdW50LAogICAgICAgICAgICAgICAgLy8gICAgICdjcmVkaXQnID0+IDAsCiAgICAgICAgICAgICAgICAvLyAgICAgJ25hcnJhdGlvbicgPT4gJ0dSTiA6OiBTdXBwbGllciBEaXNjb3VudCBQYXlhYmxlIERlYml0JywKICAgICAgICAgICAgICAgIC8vIF0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiBzYXZlTGVkZ2VyRW50cmllcyg1LCBkYXRlKCdZLW0tZCBIOmk6cycpLCAxLCAnJywgJ0dSTicsICRpdGVtcywgJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZV9yYXRlX2lkLCAwLCAwLCAwLCBnZXRDb3N0Q2VudHJlQ29tcGFueSgkZ3JuLT5yZWxQdXJjaGFzZU9yZGVyLT5jb3N0X2NlbnRyZV9pZCkpOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBncm5TbGlwKCRpZCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkdGl0bGUgPSAiR1JOIFNsaXAiOwogICAgICAgICAgICAkbm90ZSA9IEdvb2RzUmVjZWl2ZWROb3RlOjpmaW5kT3JGYWlsKCRpZCk7CiAgICAgICAgICAgICRpdGVtcyA9IEdvb2RzUmVjZWl2ZWRJdGVtOjp3aGVyZSgnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcsICRub3RlLT5pZCkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbicsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaXNfZ3JuX2NvbXBsZXRlJywgJ3llcycpOwogICAgICAgICAgICAgICAgfSktPmdldCgpOwoKICAgICAgICAgICAgJGRhdGEgPSBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICR0aXRsZSwKICAgICAgICAgICAgICAgICdub3RlJyA9PiAkbm90ZSwKICAgICAgICAgICAgICAgICdpdGVtcycgPT4gJGl0ZW1zCiAgICAgICAgICAgIF07CgogICAgICAgICAgICByZXR1cm4gdmlld01QREYoJ3Btcy5iYWNrZW5kLnBhZ2VzLmdybi1zdG9jay1pbi5ncm4tc2xpcC1wZGYnLCAkZGF0YSwgJHRpdGxlLCAkdGl0bGUpOwoKICAgICAgICAgICAgLy9yZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMuZ3JuLXN0b2NrLWluLmdybi1zbGlwJywgJGRhdGEpOwogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQp9