<?php
bolt_decrypt( __FILE__ , 'GEzuDA'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zXFB1cmNoYXNlOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBBcHBcTWFpbFxQbXNcUHVyY2hhc2VPcmRlck1haWw7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVyOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VcUHVyY2hhc2VPcmRlckl0ZW07CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xSZXF1aXNpdGlvbjsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFN1cHBsaWVyczsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFByb2R1Y3Q7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xSZnBcUmVxdWVzdFByb3Bvc2FsOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmZwXFJlcXVlc3RQcm9wb3NhbERldGFpbHM7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xSZnBcUmVxdWVzdFByb3Bvc2FsRGVmaW5lU3VwcGxpZXI7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xRdW90YXRpb25zOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUXVvdGF0aW9uc0l0ZW1zOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcU3VwcGxpZXJQYXltZW50VGVybTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFN1cHBsaWVyUGF5bWVudDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uVHJhY2tpbmc7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xSZXF1aXNpdGlvbkl0ZW07CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVyUmVxdWlzaXRpb247CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDdXJyZW5jeVR5cGU7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xFeGNoYW5nZVJhdGU7CnVzZSBBcHBcTW9kZWxzXEhyXFVuaXQ7CnVzZSBBcHBcTW9kZWxzXEhyXERlcGFydG1lbnQ7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xDYXRlZ29yeTsKCnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKdXNlIElsbHVtaW5hdGVcU3VwcG9ydFxGYWNhZGVzXE1haWw7CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xWaWV3Owp1c2UgREI7CnVzZSBQREYsIERhdGFUYWJsZXM7CgpjbGFzcyBQdXJjaGFzZUNvbnRyb2xsZXIgZXh0ZW5kcyBDb250cm9sbGVyCnsKICAgIHB1YmxpYyBmdW5jdGlvbiBoZWFkZXJDb2x1bW5zKCR2YWx1ZT0nJykKICAgIHsKICAgICAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgICAgIFsnU0wnLCAnU0wnXSwgCiAgICAgICAgICAgIFsnYXBwcm92YWxfZGF0ZScsICdhcHByb3ZhbF9kYXRlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsncmVmZXJlbmNlX25vJywgJ3JlZmVyZW5jZV9ubycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3N1cHBsaWVyJywgJ3N1cHBsaWVyJywgJ3RleHQtbGVmdCddLCAKICAgICAgICAgICAgWydxdW90YXRpb25fcmVmX25vJywgJ3F1b3RhdGlvbl9yZWZfbm8nLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWyd0b3RhbF9wcmljZScsICd0b3RhbF9wcmljZScsICd0ZXh0LXJpZ2h0J10sIAogICAgICAgICAgICBbJ3ZhdCcsICd2YXQnLCAndGV4dC1yaWdodCddLAogICAgICAgICAgICBbJ2dyb3NzX3ByaWNlJywgJ2dyb3NzX3ByaWNlJywgJ3RleHQtcmlnaHQnXSwKICAgICAgICAgICAgWydhY3Rpb25zJywgJ2FjdGlvbnMnLCAndGV4dC1jZW50ZXInLCd3aWR0aDoxNSUnXQogICAgICAgICk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGluZGV4KCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkdGl0bGUgPSAnUHVyY2hhc2UgT3JkZXInOwogICAgICAgICAgICAkcHVyY2hhc2VPcmRlckxpc3QgPSBQdXJjaGFzZU9yZGVyOjp3aXRoKFsKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzJywKICAgICAgICAgICAgICAgICdyZWxHb29kUmVjZWl2ZU5vdGUnLAogICAgICAgICAgICAgICAgJ3JlbFF1b3RhdGlvbi5leGNoYW5nZVJhdGUuY3VycmVuY3knLAogICAgICAgICAgICAgICAgJ3JlbFBvQXR0YWNobWVudCcsCiAgICAgICAgICAgICAgICAncmVsU3VwcGxpZXJQYXltZW50cycKICAgICAgICAgICAgXSkKICAgICAgICAgICAgLT53aGVyZUhhcygncmVsUXVvdGF0aW9uJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlTm90SW4oJ3R5cGUnLFsnZGlyZWN0LXB1cmNoYXNlJ10pOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlSW4oJ2lzX3NlbmQnLFsnbm8nLCd5ZXMnXSkKICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgnaWQnLCAnZGVzYycpOwogICAgICAgICAgICB9KTsKCgogICAgICAgICAgICAkb3B0aW9ucyA9IFsKICAgICAgICAgICAgICAgICdzZW5kLXBvLXRvLXN1cHBsaWVyJyA9PiBhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdzZW5kLXBvLXRvLXN1cHBsaWVyJyksCiAgICAgICAgICAgICAgICAncG8tY2FuY2VsJyA9PiBhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdwby1jYW5jZWwnKSwKICAgICAgICAgICAgXTsKCiAgICAgICAgICAgIGlmIChyZXF1ZXN0KCktPmFqYXgoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIERhdGFUYWJsZXM6Om9mKCRwdXJjaGFzZU9yZGVyTGlzdCkKICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FwcHJvdmFsX2RhdGUnLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZSgnWS1tLWQnLHN0cnRvdGltZSgkdmFsdWVzLT5wb19kYXRlKSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2FwcHJvdmFsX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3BvX2RhdGUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2FwcHJvdmFsX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlckJ5KCdwb19kYXRlJywgJG9yZGVyKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3JlZmVyZW5jZV9ubycsIGZ1bmN0aW9uKCR2YWx1ZXMpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAgJzxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgb25jbGljaz0icHVyY2hhc2VPcmRlckRldGFpbHMoJCh0aGlzKSkiIGNsYXNzPSJidG4gYnRuLWxpbmsiIGRhdGEtc3JjPSInLnJvdXRlKCdwbXMucHVyY2hhc2Uub3JkZXItbGlzdC5zaG93JywkdmFsdWVzLT5pZCkuJyI+Jy4kdmFsdWVzLT5yZWZlcmVuY2Vfbm8uJzwvYT4nOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdzdXBwbGllcicsIGZ1bmN0aW9uKCR2YWx1ZXMpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAgaXNzZXQoJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMpID8gKGlzc2V0KCR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5uYW1lKSA/ICR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5uYW1lLicgKCcuJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPmNvZGUuJyknIDogJycpIDogJyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPm9yV2hlcmUoJ2NvZGUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUXVvdGF0aW9uczo6c2VsZWN0KCdzdXBwbGllcnMubmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignc3VwcGxpZXJzJywgJ3N1cHBsaWVycy5pZCcsICc9JywgJ3F1b3RhdGlvbnMuc3VwcGxpZXJfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdxdW90YXRpb25zLmlkJywgJ3B1cmNoYXNlX29yZGVycy5xdW90YXRpb25faWQnKQogICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdxdW90YXRpb25fcmVmX25vJywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+cmVmZXJlbmNlX25vKT8kdmFsdWVzLT5yZWxRdW90YXRpb24tPnJlZmVyZW5jZV9ubzonJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncXVvdGF0aW9uX3JlZl9ubycsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFF1b3RhdGlvbicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZWZlcmVuY2Vfbm8nLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3F1b3RhdGlvbl9yZWZfbm8nLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBRdW90YXRpb25zOjpzZWxlY3QoJ3F1b3RhdGlvbnMucmVmZXJlbmNlX25vJykKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigncXVvdGF0aW9ucy5pZCcsICdwdXJjaGFzZV9vcmRlcnMucXVvdGF0aW9uX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3RvdGFsX3ByaWNlJywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgoaXNzZXQoJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZVJhdGUtPmN1cnJlbmN5LT5zeW1ib2wpPyR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VSYXRlLT5jdXJyZW5jeS0+c3ltYm9sOicnKS4nICcuc3lzdGVtTW9uZXlGb3JtYXQoJHZhbHVlcy0+dG90YWxfcHJpY2UpKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3ZhdCcsIGZ1bmN0aW9uKCR2YWx1ZXMpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAoKGlzc2V0KCR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VSYXRlLT5jdXJyZW5jeS0+c3ltYm9sKT8kdmFsdWVzLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPnN5bWJvbDonJykuJyAnLnN5c3RlbU1vbmV5Rm9ybWF0KCR2YWx1ZXMtPnZhdCkpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbignZ3Jvc3NfcHJpY2UnLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKChpc3NldCgkdmFsdWVzLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPnN5bWJvbCk/JHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZVJhdGUtPmN1cnJlbmN5LT5zeW1ib2w6JycpIC4nICcuc3lzdGVtTW9uZXlGb3JtYXQoJHZhbHVlcy0+Z3Jvc3NfcHJpY2UpKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYWN0aW9ucycsIGZ1bmN0aW9uKCR2YWx1ZXMpIHVzZSgkb3B0aW9ucyl7CiAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgPSAnJzsKCiAgICAgICAgICAgICAgICAgICAgaWYoJHZhbHVlcy0+cmVsR29vZFJlY2VpdmVOb3RlLT5jb3VudCgpPT0wKXsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRvcHRpb25zWydzZW5kLXBvLXRvLXN1cHBsaWVyJ10pewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR2YWx1ZXMtPmlzX3NlbmQ9PSdubycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGEgZGF0YS1zcmM9IicuIHJvdXRlKCdwbXMucHVyY2hhc2Uuc2VuZC5wby50by5zdXBwbGllcicsICR2YWx1ZXMtPmlkKSAuJyIgY2xhc3M9ImJ0biBidG4teHMgYnRuLXByaW1hcnkgbS0xIiB0aXRsZT0iU2VuZCBQdXJjaGFzZSBPcmRlciBUbyBTdXBwbGllciIgb25jbGljaz0icG9BY3Rpb25zKCQodGhpcykpIj48aSBjbGFzcz0ibGFzIGxhLXBhcGVyLXBsYW5lIj48L2k+PC9hPic7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxhIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi1zdWNjZXNzIG0tMSIgdGl0bGU9IlB1cmNoYXNlIE9yZGVyIEFscmVhZHkgU2VudCBUbyBTdXBwbGllciI+PGkgY2xhc3M9ImxhcyBsYS1jaGVjay1jaXJjbGUiPjwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJG9wdGlvbnNbJ3BvLWNhbmNlbCddKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8YSBkYXRhLXNyYz0iJy5yb3V0ZSgncG1zLnB1cmNoYXNlLmNhbmNlbC5wbycsICR2YWx1ZXMtPmlkKS4nIiBjbGFzcz0iYnRuIGJ0bi14cyBidG4tZGFuZ2VyIGRlbGV0ZVBvIG0tMSIgdGl0bGU9IkNhbmNlbCBQdXJjaGFzZSBPcmRlciIgb25jbGljaz0icG9BY3Rpb25zKCQodGhpcykpIj48aSBjbGFzcz0ibGFzIGxhLXRpbWVzLWNpcmNsZSI+PC9pPjwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHZhbHVlcy0+cmVsUG9BdHRhY2htZW50LT5jb3VudCgpIDw9IDAgJiYgJHZhbHVlcy0+cmVsU3VwcGxpZXJQYXltZW50cy0+d2hlcmVJbignc3RhdHVzJyxbJ2FwcHJvdmVkJywnYXVkaXRlZCddKS0+Y291bnQoKSA8PTApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxhIGhyZWY9Iicucm91dGUoJ3Btcy5wdXJjaGFzZS5vcmRlci1saXN0LnJldmlzZS5wbycsJHZhbHVlcy0+aWQpLiciIHRhcmdldD0iX19ibGFuayIgY2xhc3M9ImJ0biBidG4teHMgYnRuLXN1Y2Nlc3MgbS0xIiB0aXRsZT0iUHVyY2hhc2UgT3JkZXIgUmV2aXNlIj48aSBjbGFzcz0ibGFzIGxhLWVkaXQiPjwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0nIDxhIHRhcmdldD0iX2JsYW5rIiBocmVmPSInLnJvdXRlKCdwbXMuYmlsbGluZy1hdWRpdC5wby5pbnZvaWNlLnByaW50JywkdmFsdWVzLT5pZCkuJyIgIHRpdGxlPSJQdXJjaGFzZSBPcmRlciBQcmludCBWaWV3IiBjbGFzcz0iYnRuIGJ0bi14cyBidG4td2FybmluZyBtLTEiPjxpIGNsYXNzPSJsYXMgbGEtcHJpbnQiPjwvaT48L2E+JzsKCiAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0nIDxhIHRhcmdldD0iX2JsYW5rIiBocmVmPSInLnJvdXRlKCdwbXMuYmlsbGluZy1hdWRpdC5wby5oaXN0b3J5JywkdmFsdWVzLT5pZCkuJyIgIHRpdGxlPSJQTyBIaXN0b3J5IiBjbGFzcz0iYnRuIGJ0bi14cyBidG4taW5mbyBtLTEiPjxpIGNsYXNzPSJsYXMgbGEtdXNlci1jbG9jayI+PC9pPjwvYT4nOwoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGFjdGlvbnM7CgogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+cmF3Q29sdW1ucyhbJ3JlZmVyZW5jZV9ubycsJ3N1cHBsaWVyJywndG90YWxfcHJpY2UnLCd2YXQnLCdncm9zc19wcmljZScsICdhY3Rpb25zJ10pCiAgICAgICAgICAgICAgICAtPm1ha2UodHJ1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5wdXJjaGFzZS5vcmRlci1saXN0JywgWyd0aXRsZSc9PiR0aXRsZSwKICAgICAgICAgICAgICAgICdoZWFkZXJDb2x1bW5zJz0+JHRoaXMtPmhlYWRlckNvbHVtbnMoKV0pOwogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgIAoKICAgIHB1YmxpYyBmdW5jdGlvbiBzZW5kUG9Ub1N1cHBsaWVyKCRpZCkKICAgIHsgICAKICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeSB7CgogICAgICAgICAgICAkcHVyY2hhc2VPcmRlcj1QdXJjaGFzZU9yZGVyOjpmaW5kT3JGYWlsKCRpZCk7CiAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyLT5pc19zZW5kID0gJ3llcyc7CiAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyLT5zYXZlKCk7CgogICAgICAgICAgICAkZGF0YVsiZW1haWwiXSA9ICRwdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+ZW1haWw7CiAgICAgICAgICAgICRkYXRhWyJ0aXRsZSJdID0gIlB1cmNoYXNlIE9yZGVyIEVtYWlsIjsKICAgICAgICAgICAgJGRhdGFbInJlZmVyZW5jZV9ubyJdID0gJHB1cmNoYXNlT3JkZXItPnJlZmVyZW5jZV9ubzsKICAgICAgICAgICAgJGRhdGFbInB1cmNoYXNlT3JkZXIiXSA9ICRwdXJjaGFzZU9yZGVyOwoKICAgICAgICAgICAgLy8gJHBkZiA9IFBERjo6bG9hZFZpZXcoJ3Btcy5iYWNrZW5kLm1haWwucHVyY2hhc2Utb3JkZXItbWFpbCcsICRkYXRhKS0+c2V0T3B0aW9ucyhbJ2RlZmF1bHRGb250JyA9PiAnc2Fucy1zZXJpZiddKTsKCiAgICAgICAgICAgIC8vIE1haWw6OnNlbmQoJ3Btcy5iYWNrZW5kLm1haWwucG9fbWFpbF9ib2R5JywgJGRhdGEsIGZ1bmN0aW9uICgkbWVzc2FnZSkgdXNlICgkZGF0YSwgJHBkZikgewogICAgICAgICAgICAvLyAgICAgJG1lc3NhZ2UtPnRvKCRkYXRhWyJlbWFpbCJdLCAkZGF0YVsiZW1haWwiXSkKICAgICAgICAgICAgLy8gICAgIC0+c3ViamVjdCgkZGF0YVsidGl0bGUiXSkKICAgICAgICAgICAgLy8gICAgIC0+YXR0YWNoRGF0YSgkcGRmLT5vdXRwdXQoKSwgJGRhdGFbInJlZmVyZW5jZV9ubyJdLiIucGRmIik7CiAgICAgICAgICAgIC8vIH0pOwoKICAgICAgICAgICAgLy8gJHBkZiA9IG91dHB1dE1QREYoJ3Btcy5iYWNrZW5kLnBhZ2VzLmJpbGxpbmcucG8taW52b2ljZS1wZGYnLCAkZGF0YSwgJGRhdGFbInJlZmVyZW5jZV9ubyJdLCAkZGF0YVsicmVmZXJlbmNlX25vIl0pOwoKICAgICAgICAgICAgLy8gTWFpbDo6c2VuZCgncG1zLmJhY2tlbmQubWFpbC5wb19tYWlsX2JvZHknLCAkZGF0YSwgZnVuY3Rpb24gKCRtZXNzYWdlKSB1c2UgKCRkYXRhLCAkcGRmKSB7CiAgICAgICAgICAgIC8vICAgICAkbWVzc2FnZS0+dG8oJGRhdGFbImVtYWlsIl0sICRkYXRhWyJlbWFpbCJdKQogICAgICAgICAgICAvLyAgICAgLT5zdWJqZWN0KCRkYXRhWyJ0aXRsZSJdKQogICAgICAgICAgICAvLyAgICAgLT5hdHRhY2hEYXRhKCRwZGYsICRkYXRhWyJyZWZlcmVuY2Vfbm8iXS4iLnBkZiIpOwogICAgICAgICAgICAvLyB9KTsKCiAgICAgICAgICAgIC8vICRtZXNzYWdlID0gJzxzcGFuIGNsYXNzPSJub3RpZmljYXRpb24tbGlua3MiIGRhdGEtc3JjPSInLnJvdXRlKCdwbXMucHVyY2hhc2Uub3JkZXItbGlzdC5zaG93JywkcHVyY2hhc2VPcmRlci0+aWQpLic/dmlldyIgZGF0YS10aXRsZT0iUHVyY2hhc2UgT3JkZXIgRGV0YWlscyI+UmVmZXJlbmNlIE5vOicuJHB1cmNoYXNlT3JkZXItPnJlZmVyZW5jZV9uby4nLiBXYWl0aW5nIEZvciBHYXRlIEluLjwvc3Bhbj4nOwoKICAgICAgICAgICAgLy8gQ3JlYXRlT3JVcGRhdGVOb3RpZmljYXRpb24oJycsZ2V0TWFuYWdlckluZm8oJ0dhdGUgUGVybWlzc2lvbicsJHB1cmNoYXNlT3JkZXItPmhyX3VuaXRfaWQpLCRtZXNzYWdlLCd1bnJlYWQnLCdzZW5kLXRvLWdhdGUtbWFuYWdlcicpOwoKICAgICAgICAgICAgREI6OmNvbW1pdCgpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAnUHVyY2hhc2Ugb3JkZXIgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5IHNlbnQgdG8gc3VwcGxpZXIuJwogICAgICAgICAgICBdKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkdGgtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHNob3coJGlkKQogICAgewogICAgICAgICRyZXNwb25zZSA9IFtdOwoKICAgICAgICB0cnl7CiAgICAgICAgICAgICRtb2RhbCA9IFB1cmNoYXNlT3JkZXI6OndpdGgoWwogICAgICAgICAgICAgICAgJ3JlbFF1b3RhdGlvbi5yZWxTdXBwbGllcnMuU3VwcGxpZXJSYXRpbmdzJywKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywKICAgICAgICAgICAgICAgICdyZWxQdXJjaGFzZU9yZGVySXRlbXMucmVsUHJvZHVjdC5jYXRlZ29yeS5jYXRlZ29yeScsCiAgICAgICAgICAgICAgICAncmVsUHVyY2hhc2VPcmRlckl0ZW1zLnJlbFByb2R1Y3QucHJvZHVjdFVuaXQnLAogICAgICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXJJdGVtcy5yZWxQcm9kdWN0LmF0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScsCiAgICAgICAgICAgIF0pLT5maW5kT3JGYWlsKCRpZCk7CiAgICAgICAgICAgICRyZXF1aXNpdGlvbkl0ZW1zID0gUmVxdWlzaXRpb25JdGVtOjp3aXRoKFsKICAgICAgICAgICAgICAgICdhdHRyaWJ1dGVzLmF0dHJpYnV0ZU9wdGlvbi5hdHRyaWJ1dGUnCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlcXVpc2l0aW9uLnJlcXVlc3RQcm9wb3NhbFJlcXVpc2l0aW9uJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJG1vZGFsKXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdyZXF1ZXN0X3Byb3Bvc2FsX2lkJywgJG1vZGFsLT5yZWxRdW90YXRpb24tPnJlcXVlc3RfcHJvcG9zYWxfaWQpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPmdldCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgJHN5c3RlbUN1cnJlbmN5ID0gc3lzdGVtQ3VycmVuY3koKTsKICAgICAgICAgICAgJGN1cnJlbmN5ID0gJG1vZGFsLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPmNvZGU7CiAgICAgICAgICAgICRleGNoYW5nZVJhdGUgPSBleGNoYW5nZVJhdGUoJG1vZGFsLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZSwgJHN5c3RlbUN1cnJlbmN5LT5pZCk7CiAgICAgICAgICAgICRzYW1lID0gKCRzeXN0ZW1DdXJyZW5jeS0+aWQgPT0gJG1vZGFsLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3lfaWQgPyB0cnVlIDogZmFsc2UpOwogICAgICAgICAgICBpZiAoJG1vZGFsKSB7CiAgICAgICAgICAgICAgICAkYm9keSA9IFZpZXc6Om1ha2UoJ3Btcy5iYWNrZW5kLnBhZ2VzLnB1cmNoYXNlLnNob3cnLFsKICAgICAgICAgICAgICAgICAgICAncHVyY2hhc2VPcmRlcicgPT4gJG1vZGFsLAogICAgICAgICAgICAgICAgICAgICdyZXF1aXNpdGlvbkl0ZW1zJyA9PiAkcmVxdWlzaXRpb25JdGVtcywKICAgICAgICAgICAgICAgICAgICAnc3lzdGVtQ3VycmVuY3knID0+ICRzeXN0ZW1DdXJyZW5jeSwKICAgICAgICAgICAgICAgICAgICAnY3VycmVuY3knID0+ICRjdXJyZW5jeSwKICAgICAgICAgICAgICAgICAgICAnZXhjaGFuZ2VSYXRlJyA9PiAkZXhjaGFuZ2VSYXRlLAogICAgICAgICAgICAgICAgICAgICdzYW1lJyA9PiAkc2FtZSwKICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgIGlmIChyZXF1ZXN0KCktPmhhcygndmlldycpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRib2R5LT5yZW5kZXIoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnc3VjY2Vzcyc7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ2JvZHknXSA9ICRib2R5LT5yZW5kZXIoKTsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJ1N1Y2Nlc3NmdWxseSBHZW5lcmF0ZWQgUE8nOwogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnZXJyb3InOwogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydtZXNzYWdlJ10gPSAnUHVyY2hhc2UgT3JkZXIgbm90IGZvdW5kISEnOwogICAgICAgICAgICB9CgogICAgICAgIH1jYXRjaChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnZXJyb3InOwogICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICR0aC0+Z2V0TWVzc2FnZSgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHJlcXVlc3QoKS0+aGFzKCd2aWV3JykpIHsKICAgICAgICAgICAgcmV0dXJuICRib2R5LT5yZW5kZXIoKTsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgcmV0dXJuICRyZXNwb25zZTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHdvcmtPcmRlckNhbmNlbCgkaWQpCiAgICB7CiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAKICAgICAgICAgICAgJHB1cmNoYXNlT3JkZXI9UHVyY2hhc2VPcmRlcjo6ZmluZE9yRmFpbCgkaWQpOwogICAgICAgICAgICAkcHVyY2hhc2VPcmRlci0+aXNfc2VuZCA9ICdoYWx0JzsKICAgICAgICAgICAgJHB1cmNoYXNlT3JkZXItPnNhdmUoKTsKCiAgICAgICAgICAgIC8vICRkYXRhWyJlbWFpbCJdID0gJHB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5lbWFpbDsKICAgICAgICAgICAgLy8gJGRhdGFbInRpdGxlIl0gPSAiUHVyY2hhc2UgT3JkZXIgRW1haWwiOwogICAgICAgICAgICAvLyAkZGF0YVsicmVmZXJlbmNlX25vIl0gPSAkcHVyY2hhc2VPcmRlci0+cmVmZXJlbmNlX25vOwogICAgICAgICAgICAvLyAkZGF0YVsicHVyY2hhc2VPcmRlciJdID0gJHB1cmNoYXNlT3JkZXI7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAkcGRmID0gb3V0cHV0TVBERigncG1zLmJhY2tlbmQucGFnZXMuYmlsbGluZy5wby1pbnZvaWNlLXBkZicsICRkYXRhLCAkZGF0YVsicmVmZXJlbmNlX25vIl0sICRkYXRhWyJyZWZlcmVuY2Vfbm8iXSk7CiAgICAgICAgICAgIC8vIE1haWw6OnNlbmQoJ3Btcy5iYWNrZW5kLm1haWwucG9fbWFpbF9ib2R5JywgJGRhdGEsIGZ1bmN0aW9uICgkbWVzc2FnZSkgdXNlICgkZGF0YSwgJHBkZikgewogICAgICAgICAgICAvLyAgICAgJG1lc3NhZ2UtPnRvKCRkYXRhWyJlbWFpbCJdLCAkZGF0YVsiZW1haWwiXSkKICAgICAgICAgICAgLy8gICAgIC0+c3ViamVjdCgkZGF0YVsidGl0bGUiXSkKICAgICAgICAgICAgLy8gICAgIC0+YXR0YWNoRGF0YSgkcGRmLCAkZGF0YVsicmVmZXJlbmNlX25vIl0uIi5wZGYiKTsKICAgICAgICAgICAgLy8gfSk7CiAgICAgICAgICAgIC8vTm90aWZpY2F0aW9uCiAgICAgICAgICAgIC8vICRtZXNzYWdlID0gJzxzcGFuIGNsYXNzPSJub3RpZmljYXRpb24tbGlua3MiIGRhdGEtc3JjPSInLnJvdXRlKCdwbXMucHVyY2hhc2Uub3JkZXItbGlzdC5zaG93JywkcHVyY2hhc2VPcmRlci0+aWQpLic/dmlldyIgZGF0YS10aXRsZT0iUHVyY2hhc2UgT3JkZXIgRGV0YWlscyI+UmVmZXJlbmNlIE5vOicuJHB1cmNoYXNlT3JkZXItPnJlZmVyZW5jZV9uby4nLiBXYWl0aW5nIEZvciBHYXRlIEluLjwvc3Bhbj4nOwoKICAgICAgICAgICAgLy8gQ3JlYXRlT3JVcGRhdGVOb3RpZmljYXRpb24oJycsZ2V0TWFuYWdlckluZm8oJ0dhdGUgUGVybWlzc2lvbicsJHB1cmNoYXNlT3JkZXItPmhyX3VuaXRfaWQpLCRtZXNzYWdlLCd1bnJlYWQnLCdzZW5kLXRvLWdhdGUtbWFuYWdlcicpOwoKICAgICAgICAgICAgREI6OmNvbW1pdCgpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiUHVyY2hhc2UgaGFzIGJlZW4gY2FuY2VsbGVkIHN1Y2Nlc3NmdWxseS4iCiAgICAgICAgICAgIF0pOwogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gY2FuY2VsbGVkTGlzdCgpCiAgICB7CiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgICR0aXRsZSA9ICdQdXJjaGFzZSBPcmRlciBDYW5jZWxsZWQgTGlzdCc7CiAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyTGlzdD0gUHVyY2hhc2VPcmRlcjo6d2l0aChbCiAgICAgICAgICAgICAgICAncmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycsCiAgICAgICAgICAgICAgICAncmVsR29vZFJlY2VpdmVOb3RlJywKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JwogICAgICAgICAgICBdKQogICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxRdW90YXRpb24nLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVOb3RJbigndHlwZScsWydkaXJlY3QtcHVyY2hhc2UnXSk7CiAgICAgICAgICAgIH0pLT53aGVyZSgnaXNfc2VuZCcsWydoYWx0J10pCiAgICAgICAgICAgIC0+d2hlbighZGF0YXRhYmxlT3JkZXJpbmcoKSwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlcmJ5KCdpZCcsICdkZXNjJyk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgJG9wdGlvbnMgPSBbCiAgICAgICAgICAgICAgICAncmVzdG9yZS1wbycgPT4gYXV0aCgpLT51c2VyKCktPmhhc1Blcm1pc3Npb25UbygncmVzdG9yZS1wbycpLAogICAgICAgICAgICBdOwoKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+YWpheCgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gRGF0YVRhYmxlczo6b2YoJHB1cmNoYXNlT3JkZXJMaXN0KQogICAgICAgICAgICAgICAgLT5hZGRJbmRleENvbHVtbigpCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYXBwcm92YWxfZGF0ZScsIGZ1bmN0aW9uKCR2YWx1ZXMpewogICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlKCdZLW0tZCcsc3RydG90aW1lKCR2YWx1ZXMtPnBvX2RhdGUpKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignYXBwcm92YWxfZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncG9fZGF0ZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignYXBwcm92YWxfZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ3BvX2RhdGUnLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigncmVmZXJlbmNlX25vJywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICAnPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBvbmNsaWNrPSJwdXJjaGFzZU9yZGVyRGV0YWlscygkKHRoaXMpKSIgY2xhc3M9ImJ0biBidG4tbGluayIgZGF0YS1zcmM9Iicucm91dGUoJ3Btcy5wdXJjaGFzZS5vcmRlci1saXN0LnNob3cnLCR2YWx1ZXMtPmlkKS4nIj4nLiR2YWx1ZXMtPnJlZmVyZW5jZV9uby4nPC9hPic7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICBpc3NldCgkdmFsdWVzLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycykgPyAoaXNzZXQoJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPm5hbWUpID8gJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPm5hbWUuJyAoJy4kdmFsdWVzLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+Y29kZS4nKScgOiAnJykgOiAnJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignc3VwcGxpZXInLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGtleXdvcmQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+b3JXaGVyZSgnY29kZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUXVvdGF0aW9uczo6c2VsZWN0KCdzdXBwbGllcnMubmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignc3VwcGxpZXJzJywgJ3N1cHBsaWVycy5pZCcsICc9JywgJ3F1b3RhdGlvbnMuc3VwcGxpZXJfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdxdW90YXRpb25zLmlkJywgJ3B1cmNoYXNlX29yZGVycy5xdW90YXRpb25faWQnKQogICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdxdW90YXRpb25fcmVmX25vJywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+cmVmZXJlbmNlX25vKT8kdmFsdWVzLT5yZWxRdW90YXRpb24tPnJlZmVyZW5jZV9ubzonJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncXVvdGF0aW9uX3JlZl9ubycsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFF1b3RhdGlvbicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZWZlcmVuY2Vfbm8nLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3F1b3RhdGlvbl9yZWZfbm8nLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBRdW90YXRpb25zOjpzZWxlY3QoJ3F1b3RhdGlvbnMucmVmZXJlbmNlX25vJykKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigncXVvdGF0aW9ucy5pZCcsICdwdXJjaGFzZV9vcmRlcnMucXVvdGF0aW9uX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3RvdGFsX3ByaWNlJywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgoaXNzZXQoJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZVJhdGUtPmN1cnJlbmN5LT5zeW1ib2wpPyR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VSYXRlLT5jdXJyZW5jeS0+c3ltYm9sOicnKS4nICcuc3lzdGVtTW9uZXlGb3JtYXQoJHZhbHVlcy0+dG90YWxfcHJpY2UpKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3ZhdCcsIGZ1bmN0aW9uKCR2YWx1ZXMpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAoKGlzc2V0KCR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VSYXRlLT5jdXJyZW5jeS0+c3ltYm9sKT8kdmFsdWVzLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPnN5bWJvbDonJykuJyAnLnN5c3RlbU1vbmV5Rm9ybWF0KCR2YWx1ZXMtPnZhdCkpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbignZ3Jvc3NfcHJpY2UnLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKChpc3NldCgkdmFsdWVzLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPnN5bWJvbCk/JHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZVJhdGUtPmN1cnJlbmN5LT5zeW1ib2w6JycpIC4nICcuc3lzdGVtTW9uZXlGb3JtYXQoJHZhbHVlcy0+Z3Jvc3NfcHJpY2UpKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYWN0aW9ucycsIGZ1bmN0aW9uKCR2YWx1ZXMpIHVzZSgkb3B0aW9ucyl7CiAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgPSAnJzsKCiAgICAgICAgICAgICAgICAgICAgaWYoJHZhbHVlcy0+cmVsR29vZFJlY2VpdmVOb3RlLT5jb3VudCgpPT0wKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRvcHRpb25zWydyZXN0b3JlLXBvJ10pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8YSBkYXRhLXNyYz0iJy5yb3V0ZSgncG1zLnB1cmNoYXNlLnJlc3RvcmUucG8nLCR2YWx1ZXMtPmlkKS4nIiBjbGFzcz0iYnRuIGJ0bi14cyBidG4tc3VjY2VzcyByZXN0b3JlUG8gbS0xIiB0aXRsZT0iUmVzdG9yZSBQdXJjaGFzZSBPcmRlciIgb25jbGljaz0icG9BY3Rpb25zKCQodGhpcykpIj48aSBjbGFzcz0ibGFzIGxhLXJlZG8tYWx0Ij48L2k+PC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49JyA8YSB0YXJnZXQ9Il9ibGFuayIgaHJlZj0iJy5yb3V0ZSgncG1zLmJpbGxpbmctYXVkaXQucG8uaW52b2ljZS5wcmludCcsJHZhbHVlcy0+aWQpLiciICB0aXRsZT0iUHVyY2hhc2UgT3JkZXIgUHJpbnQgVmlldyIgY2xhc3M9ImJ0biBidG4teHMgYnRuLXdhcm5pbmcgbS0xIj48aSBjbGFzcz0ibGFzIGxhLXByaW50Ij48L2k+PC9hPic7CgogICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49JyA8YSB0YXJnZXQ9Il9ibGFuayIgaHJlZj0iJy5yb3V0ZSgncG1zLmJpbGxpbmctYXVkaXQucG8uaGlzdG9yeScsJHZhbHVlcy0+aWQpLiciICB0aXRsZT0iUE8gSGlzdG9yeSIgY2xhc3M9ImJ0biBidG4teHMgYnRuLWluZm8gbS0xIj48aSBjbGFzcz0ibGFzIGxhLXVzZXItY2xvY2siPjwvaT48L2E+JzsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhY3Rpb25zOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+cmF3Q29sdW1ucyhbJ3JlZmVyZW5jZV9ubycsJ3N1cHBsaWVyJywndG90YWxfcHJpY2UnLCd2YXQnLCdncm9zc19wcmljZScsICdhY3Rpb25zJ10pCiAgICAgICAgICAgICAgICAtPm1ha2UodHJ1ZSk7CiAgICAgICAgICAgIH0KCgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMucHVyY2hhc2UuY2FuY2VsbGVkLWxpc3QnLCBbJ3RpdGxlJz0+JHRpdGxlLAogICAgICAgICAgICAgICAgJ2hlYWRlckNvbHVtbnMnPT4kdGhpcy0+aGVhZGVyQ29sdW1ucygpXSk7CgogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gd29ya09yZGVyUmVzdG9yZSgkaWQpCiAgICB7CiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAKICAgICAgICAgICAgJHB1cmNoYXNlT3JkZXI9UHVyY2hhc2VPcmRlcjo6ZmluZE9yRmFpbCgkaWQpOwogICAgICAgICAgICAkcHVyY2hhc2VPcmRlci0+aXNfc2VuZCA9ICdubyc7CiAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyLT5zYXZlKCk7CgogICAgICAgICAgICAvLyAkZGF0YVsiZW1haWwiXSA9ICRwdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPnJlbFN1cHBsaWVycy0+ZW1haWw7CiAgICAgICAgICAgIC8vICRkYXRhWyJ0aXRsZSJdID0gIlB1cmNoYXNlIE9yZGVyIEVtYWlsIjsKICAgICAgICAgICAgLy8gJGRhdGFbInJlZmVyZW5jZV9ubyJdID0gJHB1cmNoYXNlT3JkZXItPnJlZmVyZW5jZV9ubzsKICAgICAgICAgICAgLy8gJGRhdGFbInB1cmNoYXNlT3JkZXIiXSA9ICRwdXJjaGFzZU9yZGVyOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gJHBkZiA9IG91dHB1dE1QREYoJ3Btcy5iYWNrZW5kLnBhZ2VzLmJpbGxpbmcucG8taW52b2ljZS1wZGYnLCAkZGF0YSwgJGRhdGFbInJlZmVyZW5jZV9ubyJdLCAkZGF0YVsicmVmZXJlbmNlX25vIl0pOwogICAgICAgICAgICAvLyBNYWlsOjpzZW5kKCdwbXMuYmFja2VuZC5tYWlsLnBvX21haWxfYm9keScsICRkYXRhLCBmdW5jdGlvbiAoJG1lc3NhZ2UpIHVzZSAoJGRhdGEsICRwZGYpIHsKICAgICAgICAgICAgLy8gICAgICRtZXNzYWdlLT50bygkZGF0YVsiZW1haWwiXSwgJGRhdGFbImVtYWlsIl0pCiAgICAgICAgICAgIC8vICAgICAtPnN1YmplY3QoJGRhdGFbInRpdGxlIl0pCiAgICAgICAgICAgIC8vICAgICAtPmF0dGFjaERhdGEoJHBkZiwgJGRhdGFbInJlZmVyZW5jZV9ubyJdLiIucGRmIik7CiAgICAgICAgICAgIC8vIH0pOwogICAgICAgICAgICAvL05vdGlmaWNhdGlvbgogICAgICAgICAgICAvLyAkbWVzc2FnZSA9ICc8c3BhbiBjbGFzcz0ibm90aWZpY2F0aW9uLWxpbmtzIiBkYXRhLXNyYz0iJy5yb3V0ZSgncG1zLnB1cmNoYXNlLm9yZGVyLWxpc3Quc2hvdycsJHB1cmNoYXNlT3JkZXItPmlkKS4nP3ZpZXciIGRhdGEtdGl0bGU9IlB1cmNoYXNlIE9yZGVyIERldGFpbHMiPlJlZmVyZW5jZSBObzonLiRwdXJjaGFzZU9yZGVyLT5yZWZlcmVuY2Vfbm8uJy4gV2FpdGluZyBGb3IgR2F0ZSBJbi48L3NwYW4+JzsKCiAgICAgICAgICAgIC8vIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCcnLGdldE1hbmFnZXJJbmZvKCdHYXRlIFBlcm1pc3Npb24nLCRwdXJjaGFzZU9yZGVyLT5ocl91bml0X2lkKSwkbWVzc2FnZSwndW5yZWFkJywnc2VuZC10by1nYXRlLW1hbmFnZXInKTsKCiAgICAgICAgICAgIERCOjpjb21taXQoKTsKICAgICAgICAgICAgcmV0dXJuICByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgIm1lc3NhZ2UiID0+ICJQdXJjaGFzZSBPcmRlciBoYXMgYmVlbiByZXN0b3JlZCBzdWNjZXNzZnVsbHkuIgogICAgICAgICAgICBdKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiAgcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAibWVzc2FnZSIgPT4gJHRoLT5nZXRNZXNzYWdlKCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiByZXZpc2VQbygkcHVyY2hhc2VJZCkKICAgIHsKICAgICAgICAkdGl0bGUgPSAnUHVyY2hhc2UgT3JkZXIgUmV2aXNlJzsKCiAgICAgICAgJHB1cmNoYXNlT3JkZXI9UHVyY2hhc2VPcmRlcjo6ZmluZE9yRmFpbCgkcHVyY2hhc2VJZCk7CgogICAgICAgICRxdW90YXRpb24gPSBRdW90YXRpb25zOjp3aXRoKFsKICAgICAgICAgICAgJ3JlbFF1b3RhdGlvbkl0ZW1zJywKICAgICAgICAgICAgJ3JlbFJlcXVlc3RQcm9wb3NhbC5yZXF1ZXN0UHJvcG9zYWxSZXF1aXNpdGlvbicKICAgICAgICBdKS0+d2hlcmUoWydzdGF0dXMnPT4nYWN0aXZlJywgJ2lzX2FwcHJvdmVkJz0+J2FwcHJvdmVkJywnaWQnPT4kcHVyY2hhc2VPcmRlci0+cXVvdGF0aW9uX2lkXSktPmZpcnN0KCk7CgogICAgICAgICR1bmNvbW1vbiA9IENhdGVnb3J5Ojp3aGVyZUhhcygnc3ViQ2F0ZWdvcnkucHJvZHVjdHMnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcXVvdGF0aW9uKXsKICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignaWQnLCAkcXVvdGF0aW9uLT5yZWxRdW90YXRpb25JdGVtcy0+cGx1Y2soJ3Byb2R1Y3RfaWQnKS0+dG9BcnJheSgpKTsKICAgICAgICB9KS0+d2hlcmUoJ3R5cGUnLCAndW5jb21tb24nKS0+Y291bnQoKTsKCiAgICAgICAgJHJlcXVpc2l0aW9ucyA9IFJlcXVpc2l0aW9uOjp3aXRoKFsKICAgICAgICAgICAgJ3JlbFVzZXJzTGlzdC5lbXBsb3llZScKICAgICAgICBdKQogICAgICAgIC0+d2hlcmVIYXMoJ3JlcXVlc3RQcm9wb3NhbFJlcXVpc2l0aW9uLnJlbFJlcXVlc3RQcm9wb3NhbC5yZWxRdW90YXRpb25zJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHF1b3RhdGlvbil7CiAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpZCcsICRxdW90YXRpb24tPmlkKTsKICAgICAgICB9KQogICAgICAgIC0+d2hlcmVIYXMoJ2l0ZW1zJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHF1b3RhdGlvbil7CiAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ3Byb2R1Y3RfaWQnLCAkcXVvdGF0aW9uLT5yZWxRdW90YXRpb25JdGVtcy0+d2hlcmUoJ2lzX2FwcHJvdmVkJywgJ2FwcHJvdmVkJyktPnBsdWNrKCdwcm9kdWN0X2lkJyktPnRvQXJyYXkoKSk7CiAgICAgICAgfSkKICAgICAgICAtPmdldCgpOwoKICAgICAgICAkdW5pdF9pZHMgPSAkcmVxdWlzaXRpb25zLT5wbHVjaygnaHJfdW5pdF9pZCcpLT50b0FycmF5KCk7CiAgICAgICAgJGRlcGFydG1lbnRfaWRzID0gW107CiAgICAgICAgaWYoJHJlcXVpc2l0aW9ucy0+Y291bnQoKSA+IDApewogICAgICAgICAgICBmb3JlYWNoKCRyZXF1aXNpdGlvbnMgYXMgJGtleSA9PiAkcmVxdWlzaXRpb24pewogICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkZGVwYXJ0bWVudF9pZHMsICRyZXF1aXNpdGlvbi0+cmVsVXNlcnNMaXN0LT5lbXBsb3llZS0+YXNfZGVwYXJ0bWVudF9pZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRyeXsKCiAgICAgICAgICAgICR1bml0cyA9IFVuaXQ6OndoZXJlSW4oJ2hyX3VuaXRfaWQnLCAkdW5pdF9pZHMpLT5nZXQoKTsKICAgICAgICAgICAgJGRlcGFydG1lbnRzID0gRGVwYXJ0bWVudDo6d2hlcmVJbignaHJfZGVwYXJ0bWVudF9pZCcsICRkZXBhcnRtZW50X2lkcyktPmdldCgpOwoKICAgICAgICAgICAgJHN5c3RlbUN1cnJlbmN5ID0gc3lzdGVtQ3VycmVuY3koKTsKICAgICAgICAgICAgJGN1cnJlbmN5ID0gJHF1b3RhdGlvbi0+ZXhjaGFuZ2VSYXRlLT5jdXJyZW5jeS0+Y29kZTsKICAgICAgICAgICAgJGV4Y2hhbmdlUmF0ZSA9IGV4Y2hhbmdlUmF0ZSgkcXVvdGF0aW9uLT5leGNoYW5nZVJhdGUsICRzeXN0ZW1DdXJyZW5jeS0+aWQpOwogICAgICAgICAgICAkc2FtZSA9ICgkc3lzdGVtQ3VycmVuY3ktPmlkID09ICRxdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3lfaWQgPyB0cnVlIDogZmFsc2UpOwoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnB1cmNoYXNlLnJldmlzZS1wdXJjaGFzZS1vcmRlcicsY29tcGFjdCgndGl0bGUnLCdxdW90YXRpb24nLCd1bml0cycsICdkZXBhcnRtZW50cycsICd1bmNvbW1vbicsICdzeXN0ZW1DdXJyZW5jeScsICdleGNoYW5nZVJhdGUnLCAnY3VycmVuY3knLCAnc2FtZScsJ3B1cmNoYXNlT3JkZXInKSk7CgogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCgogICAgcHVibGljIGZ1bmN0aW9uIHVuaXRXaXNlUmVxdWlzaXRpb24oJHVuaXRJZCwkcXVvdGF0aW9uSWQpCiAgICB7CiAgICAgICAgdHJ5ewoKICAgICAgICAgICAgJHByb2R1Y3RJZHMgPSBRdW90YXRpb25zSXRlbXM6OndoZXJlKCdxdW90YXRpb25faWQnLCAkcXVvdGF0aW9uSWQpCiAgICAgICAgICAgIC0+cGx1Y2soJ3Byb2R1Y3RfaWQnKS0+dG9BcnJheSgpOwoKICAgICAgICAgICAgJGFycmF5MSA9IFJlcXVpc2l0aW9uOjp3aGVyZShbCiAgICAgICAgICAgICAgICAnaHJfdW5pdF9pZCcgPT4gJHVuaXRJZCwKICAgICAgICAgICAgICAgICdpc19wb19nZW5lcmF0ZScgPT4gJ25vJywKICAgICAgICAgICAgICAgICdpc19zZW5kX3RvX3JmcCcgPT4gJ3llcycsCiAgICAgICAgICAgICAgICAnZGVsaXZlcnlfc3RhdHVzJyA9PiAncmZwJywKICAgICAgICAgICAgICAgICdhcHByb3ZlZF9pZCcgPT4gMSwKICAgICAgICAgICAgICAgICdzdGF0dXMnID0+IDEsCiAgICAgICAgICAgIF0pIAogICAgICAgICAgICAtPndoZXJlSGFzKCdyZXF1aXNpdGlvbkl0ZW1zJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHByb2R1Y3RJZHMpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19zZW5kJywneWVzJykKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3BvX2dlbmVyYXRlJywneWVzJykKICAgICAgICAgICAgICAgIC0+d2hlcmVJbigncHJvZHVjdF9pZCcsJHByb2R1Y3RJZHMpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlSGFzKCdyZXF1ZXN0UHJvcG9zYWxSZXF1aXNpdGlvbi5yZWxSZXF1ZXN0UHJvcG9zYWwucmVsUXVvdGF0aW9ucycsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRxdW90YXRpb25JZCl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaWQnLCAkcXVvdGF0aW9uSWQpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZW4ocmVxdWVzdCgpLT5nZXQoJ3VuY29tbW9uJykgPiAwLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFVzZXJzTGlzdC5lbXBsb3llZScsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2FzX2RlcGFydG1lbnRfaWQnLCByZXF1ZXN0KCktPmdldCgnaHJfZGVwYXJ0bWVudF9pZCcpKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPnBsdWNrKCdpZCcpLT50b0FycmF5KCk7CgogICAgICAgICAgICAkYXJyYXkyID0gUmVxdWlzaXRpb246OndoZXJlKFsKICAgICAgICAgICAgICAgICdocl91bml0X2lkJyA9PiR1bml0SWQsCiAgICAgICAgICAgICAgICAnYXBwcm92ZWRfaWQnID0+IDEsCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiAxLAogICAgICAgICAgICAgICAgJ2lzX3BvX2dlbmVyYXRlJyA9PiAneWVzJywKICAgICAgICAgICAgICAgICdpc19zZW5kX3RvX3JmcCcgPT4gJ3llcycsCiAgICAgICAgICAgICAgICAncmVxdWVzdF9zdGF0dXMnID0+ICdzZW5kX3JmcCcsCiAgICAgICAgICAgICAgICAnZGVsaXZlcnlfc3RhdHVzJyA9PiAncGFydGlhbC1kZWxpdmVyZWQnLAogICAgICAgICAgICBdKSAKICAgICAgICAgICAgLT53aGVyZUhhcygncmVxdWlzaXRpb25JdGVtcycsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRwcm9kdWN0SWRzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaXNfc2VuZCcsJ3llcycpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdwb19nZW5lcmF0ZScsJ3llcycpCiAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ3Byb2R1Y3RfaWQnLCRwcm9kdWN0SWRzKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZUhhcygncmVxdWVzdFByb3Bvc2FsUmVxdWlzaXRpb24ucmVsUmVxdWVzdFByb3Bvc2FsLnJlbFF1b3RhdGlvbnMnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcXVvdGF0aW9uSWQpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lkJywgJHF1b3RhdGlvbklkKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKHJlcXVlc3QoKS0+Z2V0KCd1bmNvbW1vbicpID4gMCwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhc19kZXBhcnRtZW50X2lkJywgcmVxdWVzdCgpLT5nZXQoJ2hyX2RlcGFydG1lbnRfaWQnKSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5wbHVjaygnaWQnKS0+dG9BcnJheSgpOwoKICAgICAgICAgICAgJGFycmF5ID0gYXJyYXlfdW5pcXVlKGFycmF5X21lcmdlKCRhcnJheTEsICRhcnJheTIpKTsKCiAgICAgICAgICAgIHJldHVybiBSZXF1aXNpdGlvbjo6d2hlcmVJbignaWQnLCRhcnJheSktPmdldChbJ2lkJywncmVmZXJlbmNlX25vJ10pOwoKICAgICAgICB9Y2F0Y2goXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRGlzcGxheSBhIGxpc3Rpbmcgb2YgdGhlIHJlc291cmNlLgogICAgICoKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCgogICAgcHVibGljIGZ1bmN0aW9uIHJlcXVpc2l0aW9uV2lzZUl0ZW1zUXR5KFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgdHJ5ewoKICAgICAgICAgICAgJGl0ZW1zID0gUXVvdGF0aW9uc0l0ZW1zOjp3aGVyZSgncXVvdGF0aW9uX2lkJywgJHJlcXVlc3QtPnF1b3RhdGlvbklkKS0+Z2V0KCk7CiAgICAgICAgICAgICRkYXRhID0gW107CiAgICAgICAgICAgIGlmKGlzc2V0KCRpdGVtc1swXSkpewogICAgICAgICAgICAgICAgZm9yZWFjaCgkaXRlbXMgYXMgJGtleSA9PiAkaXRlbSl7CiAgICAgICAgICAgICAgICAgICAgJHF0eSA9IFJlcXVpc2l0aW9uSXRlbTo6d2hlcmVJbigncmVxdWlzaXRpb25faWQnLCRyZXF1ZXN0LT5yZXF1aXNpdGlvbklkKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3Byb2R1Y3RfaWQnLCAkaXRlbS0+cHJvZHVjdF9pZCkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdpc19zZW5kJywneWVzJykKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdwb19nZW5lcmF0ZScsJ3llcycpCiAgICAgICAgICAgICAgICAgICAgLT5zdW0oJ3F0eScpOwoKICAgICAgICAgICAgICAgICAgICAkZGVsaXZlcnlRdHkgPSBSZXF1aXNpdGlvbkl0ZW06OndoZXJlSW4oJ3JlcXVpc2l0aW9uX2lkJywkcmVxdWVzdC0+cmVxdWlzaXRpb25JZCkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdwcm9kdWN0X2lkJywgJGl0ZW0tPnByb2R1Y3RfaWQpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnaXNfc2VuZCcsJ3llcycpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgncG9fZ2VuZXJhdGUnLCd5ZXMnKQogICAgICAgICAgICAgICAgICAgIC0+c3VtKCdkZWxpdmVyeV9xdHknKTsKCiAgICAgICAgICAgICAgICAgICAgJGRhdGFbJGl0ZW0tPmlkXSA9ICgkZGVsaXZlcnlRdHk+MCk/JHF0eS0kZGVsaXZlcnlRdHk6JHF0eTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuICRkYXRhOwogICAgICAgIH1jYXRjaChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiByZXZpc2VQb1VwZGF0ZShSZXF1ZXN0ICRyZXF1ZXN0LCAkcHVyY2hhc2VPcmRlcklkKQogICAgewogICAgICAgICR0aGlzLT52YWxpZGF0ZSgkcmVxdWVzdCwgWwogICAgICAgICAgICAncXVvdGF0aW9uX2lkJyA9PiBbJ3JlcXVpcmVkJ10sCiAgICAgICAgICAgICdwb19xdHknID0+IFsncmVxdWlyZWQnXSwKICAgICAgICAgICAgJ3JlcXVpc2l0aW9uX2lkJyA9PiBbJ3JlcXVpcmVkJ10sCiAgICAgICAgICAgICdocl91bml0X2lkJyA9PiBbJ3JlcXVpcmVkJ10sCiAgICAgICAgXSk7CgogICAgICAgICRmaWx0ZXJQb1F0eSA9IGFycmF5X2RpZmYoJHJlcXVlc3QtPnBvX3F0eSwgWzBdKTsKICAgICAgICAkY29sbGVjdFByb2R1Y3RJZCA9IGFycmF5X2tleXMoJGZpbHRlclBvUXR5KTsKCiAgICAgICAgaWYoYXJyYXlfc3VtKCRmaWx0ZXJQb1F0eSk8PTApewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJ1BsZWFzZSBwbyBxdHkgY2FuIG5vdCBiZSAwJyk7CiAgICAgICAgfQoKICAgICAgICAkbW9kYWwgPSBRdW90YXRpb25zOjp3aGVyZSgnaWQnLCRyZXF1ZXN0LT5xdW90YXRpb25faWQpLT5maXJzdCgpOwoKICAgICAgICAvLyAkcHJlZml4ID0gJ1BPLScuZGF0ZSgneScsIHN0cnRvdGltZShkYXRlKCdZLW0tZCcpKSkuJy0nLnVuaXROYW1lKCRyZXF1ZXN0LT5ocl91bml0X2lkKS0+aHJfdW5pdF9zaG9ydF9uYW1lLictJzsKICAgICAgICAvLyAkcmVmTm8gPSB1bmlxdWVDb2RlKDE2LCRwcmVmaXgsJ3B1cmNoYXNlX29yZGVycycsJ2lkJyk7CgogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CgogICAgICAgIHRyeXsKCiAgICAgICAgICAgICRwb19kYXRhID1QdXJjaGFzZU9yZGVyOjpmaW5kT3JGYWlsKCRwdXJjaGFzZU9yZGVySWQpOwogICAgICAgICAgICAkcG9fZGF0YS0+aHJfdW5pdF9pZCA9ICRyZXF1ZXN0LT5ocl91bml0X2lkOwogICAgICAgICAgICAkcG9fZGF0YS0+cG9fZGF0ZSA9IGRhdGUoJ1ktbS1kJyxzdHJ0b3RpbWUoJHJlcXVlc3QtPnBvX2RhdGUpKTsKICAgICAgICAgICAgJHBvX2RhdGEtPnJlbWFya3MgPSAkcmVxdWVzdC0+cmVtYXJrczsKICAgICAgICAgICAgJHBvX2RhdGEtPnJldmlzZV9jb3VudCA9ICRwb19kYXRhLT5yZXZpc2VfY291bnQrMTsKICAgICAgICAgICAgJHBvX2RhdGEtPnNhdmUoKTsKCiAgICAgICAgICAgICRwb1N1YlRvdGFsID0gMDsKICAgICAgICAgICAgJHBvVmF0ID0gMDsKICAgICAgICAgICAgJHBvR3Jvc3NUb3RhbCA9IDA7CgogICAgICAgICAgICAkaXRlbXMgPSBRdW90YXRpb25zSXRlbXM6OndoZXJlKCdxdW90YXRpb25faWQnLCAkbW9kYWwtPmlkKS0+d2hlcmVJbigncHJvZHVjdF9pZCcsJGNvbGxlY3RQcm9kdWN0SWQpLT53aGVyZSgnaXNfYXBwcm92ZWQnLCAnYXBwcm92ZWQnKS0+Z2V0KCk7CgogICAgICAgICAgICAvL2RlbGV0ZSBwdXJjaGFzZSBvcmRlciBpdGVtcwogICAgICAgICAgICAkcG9fZGF0YS0+cmVsUHVyY2hhc2VPcmRlckl0ZW1zKCktPmRlbGV0ZSgpOwoKICAgICAgICAgICAgZm9yZWFjaCgkaXRlbXMgYXMgJGtleSA9PiAkdmFsdWVzKXsKCiAgICAgICAgICAgICAgICAkZGlzY291bnRlZCA9ICgkdmFsdWVzLT5kaXNjb3VudCA+IDAgPyAoJHZhbHVlcy0+dW5pdF9wcmljZSooJHZhbHVlcy0+ZGlzY291bnQvMTAwKSkgOiAwKTsKICAgICAgICAgICAgICAgICR1bml0X3ByaWNlID0gKCR2YWx1ZXMtPnVuaXRfcHJpY2UtJGRpc2NvdW50ZWQpOwoKICAgICAgICAgICAgICAgICRwb1F0eSA9ICRmaWx0ZXJQb1F0eVskdmFsdWVzLT5wcm9kdWN0X2lkXTsKICAgICAgICAgICAgICAgICRzdWJUb3RhbCA9ICR1bml0X3ByaWNlKiRwb1F0eTsKICAgICAgICAgICAgICAgICRwb1N1YlRvdGFsICs9ICRzdWJUb3RhbDsKCiAgICAgICAgICAgICAgICAkdmF0QW1vdW50ID0gKCR2YWx1ZXMtPnZhdF9wZXJjZW50YWdlID4gMCAmJiAkc3ViVG90YWwgPiAwID8gKCRzdWJUb3RhbCooJHZhbHVlcy0+dmF0X3BlcmNlbnRhZ2UvMTAwKSkgOiAwKTsKICAgICAgICAgICAgICAgICRwb1ZhdCArPSAkdmF0QW1vdW50OwoKICAgICAgICAgICAgICAgICRncm9zc1RvdGFsID0gKCRzdWJUb3RhbCskdmF0QW1vdW50KTsKICAgICAgICAgICAgICAgICRwb0dyb3NzVG90YWwgKz0gJGdyb3NzVG90YWw7CgogICAgICAgICAgICAgICAgJHBvX2l0ZW1zID0gbmV3IFB1cmNoYXNlT3JkZXJJdGVtKCk7CiAgICAgICAgICAgICAgICAkcG9faXRlbXMtPnBvX2lkID0gJHBvX2RhdGEtPmlkOyAKICAgICAgICAgICAgICAgICRwb19pdGVtcy0+cHJvZHVjdF9pZCA9ICR2YWx1ZXMtPnByb2R1Y3RfaWQ7IAogICAgICAgICAgICAgICAgJHBvX2l0ZW1zLT51bml0X3ByaWNlID0gJHVuaXRfcHJpY2U7IAogICAgICAgICAgICAgICAgJHBvX2l0ZW1zLT5xdHkgPSAkcG9RdHk7CiAgICAgICAgICAgICAgICAkcG9faXRlbXMtPnN1Yl90b3RhbF9wcmljZSA9ICRzdWJUb3RhbDsKICAgICAgICAgICAgICAgICRwb19pdGVtcy0+ZGlzY291bnRfcGVyY2VudGFnZSA9IDA7CiAgICAgICAgICAgICAgICAkcG9faXRlbXMtPmRpc2NvdW50ID0gMDsKICAgICAgICAgICAgICAgICRwb19pdGVtcy0+dmF0X3BlcmNlbnRhZ2UgPSAkdmFsdWVzLT52YXRfcGVyY2VudGFnZTsKICAgICAgICAgICAgICAgICRwb19pdGVtcy0+dmF0ID0gJHZhdEFtb3VudDsKICAgICAgICAgICAgICAgICRwb19pdGVtcy0+dG90YWxfcHJpY2UgPSAkZ3Jvc3NUb3RhbDsKICAgICAgICAgICAgICAgICRwb19pdGVtcy0+c2F2ZSgpOwoKICAgICAgICAgICAgICAgIC8vdXBkYXRlIGxhdGVzdCBwcm9kdWN0IHByaWNlCiAgICAgICAgICAgICAgICBsYXRlc3RQcm9kdWN0UHJpY2VVcGRhdGUoJHZhbHVlcy0+cHJvZHVjdF9pZCwgJHVuaXRfcHJpY2UpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvL1VwZGF0ZSBQdXJjYWhzZSBPcmRlcgogICAgICAgICAgICBQdXJjaGFzZU9yZGVyOjp3aGVyZSgnaWQnLCRwb19kYXRhLT5pZCktPnVwZGF0ZShbCiAgICAgICAgICAgICAgICAndG90YWxfcHJpY2UnID0+ICRwb1N1YlRvdGFsLAogICAgICAgICAgICAgICAgJ2Rpc2NvdW50JyA9PiAwLAogICAgICAgICAgICAgICAgJ3ZhdCcgPT4gJHBvVmF0LAogICAgICAgICAgICAgICAgJ2dyb3NzX3ByaWNlJyA9PiAkcG9Hcm9zc1RvdGFsLAogICAgICAgICAgICBdKTsKCiAgICAgICAgICAgIGlmKCRtb2RhbC0+cmVsU3VwcGxpZXJQYXltZW50VGVybS0+dHlwZSA9PSAncGFpZCcpewogICAgICAgICAgICAgICAgLy9BZGQgU3VwcGxpZXIgUHlhbWVudHMKICAgICAgICAgICAgICAgICRkdXJhdGlvbl9kYXRlID0gJG1vZGFsLT5yZWxTdXBwbGllclBheW1lbnRUZXJtLT5kYXlfZHVyYXRpb247CiAgICAgICAgICAgICAgICAkcGF5X2RhdGUgPSBkYXRlKCdZLW0tZCBoOmk6cycsIHN0cnRvdGltZSgnKycuJGR1cmF0aW9uX2RhdGUuJyBkYXknLCBzdHJ0b3RpbWUoJHBvX2RhdGEtPnBvX2RhdGUpKSk7CiAgICAgICAgICAgICAgICAvL1BheW1lbnQgZGF0ZSBiYXNlZCBvbiBhZHZhbmNlICYgZHVlCiAgICAgICAgICAgICAgICAkcGF5X2Ftb3VudCA9ICAoJG1vZGFsLT5yZWxTdXBwbGllclBheW1lbnRUZXJtLT5wYXltZW50X3BlcmNlbnQgPiAwICYmICRwb0dyb3NzVG90YWwgPiAwID8gKCRtb2RhbC0+cmVsU3VwcGxpZXJQYXltZW50VGVybS0+cGF5bWVudF9wZXJjZW50ICogJHBvR3Jvc3NUb3RhbCkvMTAwIDogMCk7CiAgICAgICAgICAgICAgICBpZigkcGF5X2Ftb3VudCA+IDApewoKICAgICAgICAgICAgICAgICAgICAkc3VwcGxpZXJfcGF5bWVudCA9IFN1cHBsaWVyUGF5bWVudDo6d2hlcmUoWydzdXBwbGllcl9pZCc9PiRtb2RhbC0+c3VwcGxpZXJfaWQsJ3B1cmNoYXNlX29yZGVyX2lkJz0+JHBvX2RhdGEtPmlkXSktPmZpcnN0KCk7CgogICAgICAgICAgICAgICAgICAgICRzdXBwbGllcl9wYXltZW50LT50cmFuc2VjdGlvbl9kYXRlID0gZGF0ZSgnWS1tLWQgaDppOnMnKTsKICAgICAgICAgICAgICAgICAgICAkc3VwcGxpZXJfcGF5bWVudC0+dHJhbnNlY3Rpb25fdHlwZSA9ICdwdXJjaGFzZSc7CiAgICAgICAgICAgICAgICAgICAgJHN1cHBsaWVyX3BheW1lbnQtPnBheV9hbW91bnQgPSAkcGF5X2Ftb3VudDsKICAgICAgICAgICAgICAgICAgICAkc3VwcGxpZXJfcGF5bWVudC0+cGF5X2RhdGUgPSAkcGF5X2RhdGU7CiAgICAgICAgICAgICAgICAgICAgJHN1cHBsaWVyX3BheW1lbnQtPmJpbGxfdHlwZSA9ICdwby1hZHZhbmNlJzsKICAgICAgICAgICAgICAgICAgICAkc3VwcGxpZXJfcGF5bWVudC0+c2F2ZSgpOwoKICAgICAgICAgICAgICAgICAgICAvL05vdGlmaWNhdGlvbiBzZW5kIHRvIGFjY291bnRzCiAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgIGRhdGEtdGl0bGU9IlB1cmNoYXNlIE9yZGVyIERldGFpbHMiPlJlZmVyZW5jZSBObzonLiRwb19kYXRhLT5yZWZlcmVuY2Vfbm8uJy4gQSBQTyAocmV2aXNlZCkgaGFzIGJlZW4gc3VibWl0dGVkIHdpdGggYW4gYWR2YW5jZSBhbW91bnQgb2YgVEsgJy4kc3VwcGxpZXJfcGF5bWVudC0+cGF5X2Ftb3VudC4nPC9zcGFuPic7CgogICAgICAgICAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCcnLGdldE1hbmFnZXJJbmZvKCdBY2NvdW50cycpLCRtZXNzYWdlLCd1bnJlYWQnLCdzZW5kLXRvLWFjY291bnRzJywnJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vVXBkYXRlIHJlcXVpc2l0aW9uCiAgICAgICAgICAgUmVxdWlzaXRpb25JdGVtOjp3aGVyZUluKCdyZXF1aXNpdGlvbl9pZCcsICRyZXF1ZXN0LT5yZXF1aXNpdGlvbl9pZCkKICAgICAgICAgICAgLT53aGVyZUluKCdwcm9kdWN0X2lkJywgJGNvbGxlY3RQcm9kdWN0SWQpCiAgICAgICAgICAgIC0+d2hlcmUoJ2lzX3NlbmQnLCd5ZXMnKQogICAgICAgICAgICAtPndoZXJlKCdwb19nZW5lcmF0ZScsJ25vJykKICAgICAgICAgICAgLT51cGRhdGUoWydwb19nZW5lcmF0ZSc9Pid5ZXMnXSk7CgogICAgICAgICAgICBQdXJjaGFzZU9yZGVyUmVxdWlzaXRpb246OndoZXJlKFsncHVyY2hhc2Vfb3JkZXJfaWQnID0+ICRwb19kYXRhLT5pZF0pLT5kZWxldGUoKTsKCiAgICAgICAgICAgIGlmKGlzc2V0KCRyZXF1ZXN0LT5yZXF1aXNpdGlvbl9pZFswXSkpewoKICAgICAgICAgICAgICAgIGZvcmVhY2goJHJlcXVlc3QtPnJlcXVpc2l0aW9uX2lkIGFzICRrZXkgPT4gJHJlcXVpc2l0aW9uX2lkKXsKICAgICAgICAgICAgICAgICAgICBQdXJjaGFzZU9yZGVyUmVxdWlzaXRpb246OnVwZGF0ZU9yQ3JlYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3B1cmNoYXNlX29yZGVyX2lkJyA9PiAkcG9fZGF0YS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdyZXF1aXNpdGlvbl9pZCcgPT4gJHJlcXVpc2l0aW9uX2lkLAogICAgICAgICAgICAgICAgICAgIF0sWwogICAgICAgICAgICAgICAgICAgICAgICAnaHJfZGVwYXJ0bWVudF9pZCcgPT4gaXNzZXQoJHJlcXVlc3QtPmhyX2RlcGFydG1lbnRfaWQpID8gJHJlcXVlc3QtPmhyX2RlcGFydG1lbnRfaWQgOiAwLAogICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgIC8vUmVxdWlzaXRpb24gdHJhY2tpbmcgd2l0aCByZXF1aXNpdG9uIGlkCiAgICAgICAgICAgICAgICAgICAgUmVxdWlzaXRpb25UcmFja2luZzo6c3RvcmVSZXF1aXNpdGlvblRyYWNraW5nKCRyZXF1aXNpdGlvbl9pZCwnUE8tSXNzdWUnKTsKCiAgICAgICAgICAgICAgICAgICAgLy9Ob3RpZmljYXRpb24gZ2VuZXJhdGUKICAgICAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb25Vc2VyPVJlcXVpc2l0aW9uOjp3aGVyZSgnaWQnLCRyZXF1aXNpdGlvbl9pZCktPmZpcnN0KCk7CgogICAgICAgICAgICAgICAgICAgICRtZXNzYWdlID0gJzxzcGFuIGNsYXNzPSJub3RpZmljYXRpb24tbGlua3MiICBkYXRhLXRpdGxlPSJQdXJjaGFzZSBPcmRlciBEZXRhaWxzIj5QTyBSZWZlcmVuY2UgTm8gIycuJHBvX2RhdGEtPnJlZmVyZW5jZV9uby4nLiBBIFBPIGhhcyBiZWVuIElzc3VlZCAocmV2aXNlZCkgYWdhaW5zdCB5b3VyIHJlcXVpc2l0aW9uICMnLiRyZXF1aXNpdGlvblVzZXItPnJlZmVyZW5jZV9uby4nPC9zcGFuPic7CiAgICAgICAgICAgICAgICAgICAgQ3JlYXRlT3JVcGRhdGVOb3RpZmljYXRpb24oJycsJHJlcXVpc2l0aW9uVXNlci0+YXV0aG9yX2lkLCRtZXNzYWdlLCd1bnJlYWQnLCdyZXF1aXNpdGlvbicsJycpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAkYXJyYXkgPSBbXTsKCiAgICAgICAgICAgIC8vUE8gR2VuZXJhdGUgRXF1YWxseSBkaXN0cmlidXRlCiAgICAgICAgICAgIGlmKGlzc2V0KCRyZXF1ZXN0LT5wcm9kdWN0X2lkWzBdKSl7CiAgICAgICAgICAgICAgICBmb3JlYWNoKCRyZXF1ZXN0LT5wcm9kdWN0X2lkIGFzICRrZXkgPT4gJHByb2R1Y3RfaWQpewoKICAgICAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb25fcXR5ID0gKGlzc2V0KCRyZXF1ZXN0LT5yZXF1aXNpdGlvbl9xdHlbJHByb2R1Y3RfaWRdKSA/ICRyZXF1ZXN0LT5yZXF1aXNpdGlvbl9xdHlbJHByb2R1Y3RfaWRdIDogMCk7CiAgICAgICAgICAgICAgICAgICAgJHBvX3F0eSA9IChpc3NldCgkcmVxdWVzdC0+cG9fcXR5WyRwcm9kdWN0X2lkXSkgPyAkcmVxdWVzdC0+cG9fcXR5WyRwcm9kdWN0X2lkXSA6IDApOwogICAgICAgICAgICAgICAgICAgICRwZXJjZW50YWdlID0gKCRyZXF1aXNpdGlvbl9xdHkgPiAwICYmICRwb19xdHkgPiAwID8gKCgkcG9fcXR5LyRyZXF1aXNpdGlvbl9xdHkpKjEwMCkgOiAwKTsKCiAgICAgICAgICAgICAgICAgICAgaWYoaXNzZXQoJHJlcXVlc3QtPnJlcXVpc2l0aW9uX2lkWzBdKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2goJHJlcXVlc3QtPnJlcXVpc2l0aW9uX2lkIGFzICRrZXkgPT4gJHJlcXVpc2l0aW9uX2lkKXsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb25JdGVtcyA9IFJlcXVpc2l0aW9uSXRlbTo6d2hlcmUoJ3JlcXVpc2l0aW9uX2lkJywgJHJlcXVpc2l0aW9uX2lkKS0+d2hlcmUoJ3Byb2R1Y3RfaWQnLCAkcHJvZHVjdF9pZCktPmdldCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGlzc2V0KCRyZXF1aXNpdGlvbkl0ZW1zWzBdKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCgkcmVxdWlzaXRpb25JdGVtcyBhcyAka2V5ID0+ICRyZXF1aXNpdGlvbkl0ZW0pewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkcG9fcXR5PjApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXNfcG9fcXR5ID0gcm91bmQoKCRwZXJjZW50YWdlID4gMCA/ICgkcmVxdWlzaXRpb25JdGVtLT5xdHkqKCRwZXJjZW50YWdlLzEwMCkpIDogMCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXNfcG9fcXR5ID0gKCR0aGlzX3BvX3F0eSA+ICRwb19xdHkgPyAkcG9fcXR5IDogJHRoaXNfcG9fcXR5KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uSXRlbS0+cHVyY2hhc2VfcXR5ID0gJHRoaXNfcG9fcXR5OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uSXRlbS0+c2F2ZSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwb19xdHkgPSAoJHBvX3F0eSAtICR0aGlzX3BvX3F0eSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRwb19xdHk+MCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb25JdGVtID0gUmVxdWlzaXRpb25JdGVtOjp3aGVyZSgncmVxdWlzaXRpb25faWQnLCAkcmVxdWlzaXRpb25faWQpLT53aGVyZSgncHJvZHVjdF9pZCcsICRwcm9kdWN0X2lkKS0+Zmlyc3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbkl0ZW0tPnB1cmNoYXNlX3F0eSA9ICgkcmVxdWlzaXRpb25JdGVtLT5wdXJjaGFzZV9xdHkrcm91bmQoJHBvX3F0eSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uSXRlbS0+c2F2ZSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgREI6OmNvbW1pdCgpOwoKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5yZWRpcmVjdEJhY2tXaXRoU3VjY2VzcygnUHVyY2hhc2UgT3JkZXIgaGFzIGJlZW4gcmV2aXNlZCBzdWNjZXNzZnVsbHkhJywncG1zLnB1cmNoYXNlLm9yZGVyLWluZGV4Jyk7CgogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJhY2soKTsKICAgIH0KfQo=