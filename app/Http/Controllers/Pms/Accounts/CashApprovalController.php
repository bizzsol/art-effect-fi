<?php
bolt_decrypt( __FILE__ , 'IevM5Z'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zXEFjY291bnRzOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFN1cHBsaWVyUGF5bWVudDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFN1cHBsaWVyTGVkZ2VyczsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFN1cHBsaWVyczsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXI7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVyQXR0YWNobWVudDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEdyblxHb29kc1JlY2VpdmVkSXRlbTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFF1b3RhdGlvbnM7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDb21wYW55Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQ29zdENlbnRyZTsKdXNlIERCOwp1c2UgQXV0aDsKdXNlIEFwcCwgRGF0YVRhYmxlczsKCgpjbGFzcyBDYXNoQXBwcm92YWxDb250cm9sbGVyIGV4dGVuZHMgQ29udHJvbGxlcgp7CiAgICBwdWJsaWMgZnVuY3Rpb24gaGVhZGVyQ29sdW1ucygkdmFsdWU9JycpCiAgICB7CiAgICAgICAgcmV0dXJuIGFycmF5KAogICAgICAgICAgICBbJ1NMJywgJ1NMJ10sIAogICAgICAgICAgICBbJ2NvbXBhbnknLCAnY29tcGFueScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3BvX2RhdGUnLCAncG9fZGF0ZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3JlZmVyZW5jZV9ubycsICdyZWZlcmVuY2Vfbm8nLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydzdXBwbGllcicsICdzdXBwbGllcicsICd0ZXh0LWxlZnQnXSwgCiAgICAgICAgICAgIFsncXVvdGF0aW9uX3JlZl9ubycsICdxdW90YXRpb25fcmVmX25vJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsndG90YWxfcHJpY2UnLCAndG90YWxfcHJpY2UnLCAndGV4dC1sZWZ0J10sIAogICAgICAgICAgICBbJ3ZhdCcsICd2YXQnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydncm9zc19wcmljZScsICdncm9zc19wcmljZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3N0YXR1cycsICdjYXNoX3N0YXR1cycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2FjdGlvbnMnLCAnYWN0aW9ucycsICd0ZXh0LWNlbnRlciBhY3Rpb24nXQogICAgICAgICk7CiAgICB9CiAgICAvKioKICAgICAqIERpc3BsYXkgYSBsaXN0aW5nIG9mIHRoZSByZXNvdXJjZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGluZGV4KCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAkdGl0bGUgPSAiUHVyY2hhc2UgT3JkZXIgQ2FzaCBBcHByb3ZhbCI7CiAgICAgICAgICAgICRjYXNoX3N0YXR1cyA9IHJlcXVlc3QoKS0+aGFzKCdjYXNoX3N0YXR1cycpID8gcmVxdWVzdCgpLT5nZXQoJ2Nhc2hfc3RhdHVzJykgOiAncGVuZGluZyc7CiAgICAgICAgICAgICRpc19zZW5kID0gKCRjYXNoX3N0YXR1cz09J3BlbmRpbmcnIHx8ICRjYXNoX3N0YXR1cz09J2hhbHQnKT8nbm8nOm51bGw7CgogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgICRvcHRpb25zID0gWwogICAgICAgICAgICAgICAgICAgICdwby1jYXNoLXBlcm1pc3Npb24nID0+IGF1dGgoKS0+dXNlcigpLT5oYXNQZXJtaXNzaW9uVG8oJ3BvLWNhc2gtcGVybWlzc2lvbicpCiAgICAgICAgICAgICAgICBdOwoKICAgICAgICAgICAgICAgIHJldHVybiBEYXRhdGFibGVzOjpvZigKICAgICAgICAgICAgICAgICAgICBQdXJjaGFzZU9yZGVyOjp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3JlbFF1b3RhdGlvbi5yZWxTdXBwbGllcnMnLAogICAgICAgICAgICAgICAgICAgICAgICAncmVsUXVvdGF0aW9uLmV4Y2hhbmdlUmF0ZS5jdXJyZW5jeScsCgogICAgICAgICAgICAgICAgICAgICAgICAnVW5pdC5jb21wYW55JwogICAgICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZUhhcygnVW5pdC5jb21wYW55LnVzZXJzJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3VzZXJfaWQnLCBhdXRoKCktPnVzZXIoKS0+aWQpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZUhhcygncmVsUXVvdGF0aW9uJyxmdW5jdGlvbiAoJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3R5cGUnLCdkaXJlY3QtcHVyY2hhc2UnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnc3RhdHVzJywnYWN0aXZlJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2lzX2FwcHJvdmVkJywnYXBwcm92ZWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnaXNfcG9fZ2VuZXJhdGUnLCd5ZXMnKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+d2hlbihyZXF1ZXN0KCktPmdldCgnY29tcGFueV9pZCcpID4gMCwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ1VuaXQnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnY29tcGFueV9pZCcsIHJlcXVlc3QoKS0+Z2V0KCdjb21wYW55X2lkJykpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+d2hlbighZW1wdHkoJGNhc2hfc3RhdHVzKSwgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGNhc2hfc3RhdHVzKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2Nhc2hfc3RhdHVzJywgJGNhc2hfc3RhdHVzKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+d2hlbihlbXB0eSgkY2FzaF9zdGF0dXMpLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkY2FzaF9zdGF0dXMpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnY2FzaF9zdGF0dXMnLCAncGVuZGluZycpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT53aGVuKCFlbXB0eSgkaXNfc2VuZCksIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRpc19zZW5kKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX3NlbmQnLCAkaXNfc2VuZCk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPndoZW4oIWRhdGF0YWJsZU9yZGVyaW5nKCksIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyYnkoJ2lkJywgJ2Rlc2MnKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgLT5hZGRJbmRleENvbHVtbigpCgogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2NvbXBhbnknLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIChpc3NldCgkdmFsdWVzLT5Vbml0LT5jb21wYW55LT5jb2RlKSA/ICR2YWx1ZXMtPlVuaXQtPmNvbXBhbnktPmNvZGUgOiAnJyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2NvbXBhbnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdVbml0LmNvbXBhbnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnY29kZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigncG9fZGF0ZScsIGZ1bmN0aW9uKCR2YWx1ZXMpewogICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkdmFsdWVzLT5wb19kYXRlKSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3BvX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3BvX2RhdGUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3BvX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlckJ5KCdwb19kYXRlJywgJG9yZGVyKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3JlZmVyZW5jZV9ubycsIGZ1bmN0aW9uKCR2YWx1ZXMpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAgJzxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgb25jbGljaz0icHVyY2hhc2VPcmRlckRldGFpbHMoJCh0aGlzKSkiIGNsYXNzPSJidG4gYnRuLWxpbmsiIGRhdGEtc3JjPSInLnJvdXRlKCdwbXMucHVyY2hhc2Uub3JkZXItbGlzdC5zaG93JywkdmFsdWVzLT5pZCkuJyI+Jy4kdmFsdWVzLT5yZWZlcmVuY2Vfbm8uJzwvYT4nOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdzdXBwbGllcicsIGZ1bmN0aW9uKCR2YWx1ZXMpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAgaXNzZXQoJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMpID8gKGlzc2V0KCR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5uYW1lKSA/ICR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzLT5uYW1lLicgKCcuJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5yZWxTdXBwbGllcnMtPmNvZGUuJyknIDogJycpIDogJyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKQogICAgICAgICAgICAgICAgICAgICAgICAtPm9yV2hlcmUoJ2NvZGUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUXVvdGF0aW9uczo6c2VsZWN0KCdzdXBwbGllcnMubmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignc3VwcGxpZXJzJywgJ3N1cHBsaWVycy5pZCcsICc9JywgJ3F1b3RhdGlvbnMuc3VwcGxpZXJfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdxdW90YXRpb25zLmlkJywgJ3B1cmNoYXNlX29yZGVycy5xdW90YXRpb25faWQnKQogICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdxdW90YXRpb25fcmVmX25vJywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+cmVmZXJlbmNlX25vKT8kdmFsdWVzLT5yZWxRdW90YXRpb24tPnJlZmVyZW5jZV9ubzonJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncXVvdGF0aW9uX3JlZl9ubycsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbFF1b3RhdGlvbicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZWZlcmVuY2Vfbm8nLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3F1b3RhdGlvbl9yZWZfbm8nLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBRdW90YXRpb25zOjpzZWxlY3QoJ3F1b3RhdGlvbnMucmVmZXJlbmNlX25vJykKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigncXVvdGF0aW9ucy5pZCcsICdwdXJjaGFzZV9vcmRlcnMucXVvdGF0aW9uX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3RvdGFsX3ByaWNlJywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgoaXNzZXQoJHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZVJhdGUtPmN1cnJlbmN5LT5zeW1ib2wpPyR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VSYXRlLT5jdXJyZW5jeS0+c3ltYm9sOicnKS4nICcuc3lzdGVtTW9uZXlGb3JtYXQoJHZhbHVlcy0+dG90YWxfcHJpY2UpKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3ZhdCcsIGZ1bmN0aW9uKCR2YWx1ZXMpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAoKGlzc2V0KCR2YWx1ZXMtPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VSYXRlLT5jdXJyZW5jeS0+c3ltYm9sKT8kdmFsdWVzLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPnN5bWJvbDonJykuJyAnLnN5c3RlbU1vbmV5Rm9ybWF0KCR2YWx1ZXMtPnZhdCkpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbignZ3Jvc3NfcHJpY2UnLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKChpc3NldCgkdmFsdWVzLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPnN5bWJvbCk/JHZhbHVlcy0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZVJhdGUtPmN1cnJlbmN5LT5zeW1ib2w6JycpIC4nICcuc3lzdGVtTW9uZXlGb3JtYXQoJHZhbHVlcy0+Z3Jvc3NfcHJpY2UpKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignc3RhdHVzJywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAgICAgJHN0YXR1cyA9ICcnOwogICAgICAgICAgICAgICAgICAgIGlmICgkdmFsdWVzLT5jYXNoX3N0YXR1cz09J2FwcHJvdmVkJykgewogICAgICAgICAgICAgICAgICAgICAgICAkc3RhdHVzIC49JzxidXR0b24gdGl0bGU9IkFwcHJvdmVkIiBjbGFzcz0iYnRuIGJ0bi14cyBidG4tcHJpbWFyeSBtci0xIj48aSBjbGFzcz0ibGFzIGxhLWNoZWNrIj48L2k+PC9idXR0b24+JzsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgfWVsc2VpZigkdmFsdWVzLT5jYXNoX3N0YXR1cz09J3BlbmRpbmcnKXsKICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXR1cyAuPSc8YnV0dG9uIHRpdGxlPSJQZW5kaW5nIiAgY2xhc3M9ImJ0biBidG4teHMgYnRuLXdhcm5pbmcgbXItMSI+PGkgY2xhc3M9ImxhcyBsYS1jbG9jayI+PC9pPjwvYnV0dG9uPic7CiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0dXMgLj0nPGJ1dHRvbiAgdGl0bGU9IkhhbHQiIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi1kYW5nZXIgbXItMSI+PGkgY2xhc3M9ImxhcyBsYS1iYW4iPjwvaT48L2J1dHRvbj4nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkc3RhdHVzIC49JzxhIHRhcmdldD0iX2JsYW5rIiBocmVmPSInLnJvdXRlKCdwbXMuYmlsbGluZy1hdWRpdC5wby5pbnZvaWNlLnByaW50JywkdmFsdWVzLT5pZCkuJyIgY2xhc3M9ImJ0biBidG4teHMgYnRuLXN1Y2Nlc3MiPjxpIGNsYXNzPSJsYXMgbGEtcHJpbnQiPjwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHN0YXR1czsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYWN0aW9ucycsIGZ1bmN0aW9uKCR2YWx1ZXMpIHVzZSgkb3B0aW9ucyl7CiAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgPSAnJzsKICAgICAgICAgICAgICAgICAgICBpZiAoJG9wdGlvbnNbJ3BvLWNhc2gtcGVybWlzc2lvbiddKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdmFsdWVzLT5jYXNoX3N0YXR1cyE9J2FwcHJvdmVkJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMuPSc8ZGl2IGNsYXNzPSJidG4tZ3JvdXAiPjxidXR0b24gY2xhc3M9ImJ0biBkcm9wZG93bi10b2dnbGUiIGRhdGEtdG9nZ2xlPSJkcm9wZG93biI+PHNwYW4gaWQ9InN0YXR1c05hbWUnLiR2YWx1ZXMtPmlkLiciPicuIHVjZmlyc3QoJHZhbHVlcy0+Y2FzaF9zdGF0dXMpLic8L3NwYW4+PC9idXR0b24+PHVsIGNsYXNzPSJkcm9wZG93bi1tZW51Ij4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0cmluZ1N0YXR1c0FycmF5KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKHN0cmluZ1N0YXR1c0FycmF5KCkgYXMgJGtleSA9PiAkc3RhdHVzKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0nPGxpPjxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9InVwZGF0ZUNhc2hTdGF0dXMiIGRhdGEtaWQ9IicuJHZhbHVlcy0+aWQuJyIgZGF0YS1zdGF0dXM9IicuJGtleS4nIiB0aXRsZT0iQ2xpY2sgSGVyZSBUbyAnLiRzdGF0dXMuJyIgb25DbGljaz0idXBkYXRlQ2FzaFN0YXR1cygkKHRoaXMpKSI+ICcuICRzdGF0dXMuJzwvYT48L2xpPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMuPSc8L3VsPjwvZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhY3Rpb25zOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+cmF3Q29sdW1ucyhbJ3JlZmVyZW5jZV9ubycsJ3N1cHBsaWVyJywndG90YWxfcHJpY2UnLCd2YXQnLCdncm9zc19wcmljZScsJ3N0YXR1cycsJ2FjdGlvbnMnXSkKICAgICAgICAgICAgICAgIC0+bWFrZSh0cnVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLmNhc2gtYXBwcm92YWwucG8tY2FzaC1hcHByb3ZhbCcsIFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJHRpdGxlLAogICAgICAgICAgICAgICAgJ2Nhc2hfc3RhdHVzJyA9PiAkY2FzaF9zdGF0dXMsCiAgICAgICAgICAgICAgICAnY29tcGFuaWVzJyA9PiBDb21wYW55OjpoYXMoJ3Byb2ZpdENlbnRyZXMuY29zdENlbnRyZXMnKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygndXNlcnMnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCd1c2VyX2lkJywgYXV0aCgpLT51c2VyKCktPmlkKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmdldCgpLAogICAgICAgICAgICAgICAgJ2hlYWRlckNvbHVtbnMnID0+ICR0aGlzLT5oZWFkZXJDb2x1bW5zKCkKICAgICAgICAgICAgXSk7CgogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNob3cgdGhlIGZvcm0gZm9yIGNyZWF0aW5nIGEgbmV3IHJlc291cmNlLgogICAgICoKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY3JlYXRlKCkKICAgIHsKICAgICAgICB0cnl7CiAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyID0gUHVyY2hhc2VPcmRlcjo6ZmluZE9yRmFpbChyZXF1ZXN0KCktPmdldCgncHVyY2hhc2Vfb3JkZXJfaWQnKSk7CiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5jYXNoLWFwcHJvdmFsLmFwcHJvdmFsJywgWwogICAgICAgICAgICAgICAgJ3B1cmNoYXNlX29yZGVyX2lkJyA9PiByZXF1ZXN0KCktPmdldCgncHVyY2hhc2Vfb3JkZXJfaWQnKSwKICAgICAgICAgICAgICAgICdwb19jYXNoX3N0YXR1cycgPT4gcmVxdWVzdCgpLT5nZXQoJ3BvX2Nhc2hfc3RhdHVzJyksCiAgICAgICAgICAgICAgICAncHVyY2hhc2VPcmRlcicgPT4gJHB1cmNoYXNlT3JkZXIsCiAgICAgICAgICAgICAgICAnY29zdENlbnRyZXMnID0+IENvc3RDZW50cmU6OndoZXJlKFsKICAgICAgICAgICAgICAgICAgICAnaHJfdW5pdF9pZCcgPT4gJHB1cmNoYXNlT3JkZXItPmhyX3VuaXRfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2hyX2RlcGFydG1lbnRfaWQnID0+ICRwdXJjaGFzZU9yZGVyLT5wdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zWzBdLT5yZXF1aXNpdGlvbi0+cmVsVXNlcnNMaXN0LT5lbXBsb3llZS0+YXNfZGVwYXJ0bWVudF9pZCwKICAgICAgICAgICAgICAgIF0pLT5nZXQoKSwKICAgICAgICAgICAgXSk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gJHRoLT5nZXRNZXNzYWdlKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU3RvcmUgYSBuZXdseSBjcmVhdGVkIHJlc291cmNlIGluIHN0b3JhZ2UuCiAgICAgKgogICAgICogQHBhcmFtICBcSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3QgICRyZXF1ZXN0CiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHN0b3JlKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJGlzX3NlbmQgPSAoJHJlcXVlc3QtPmNhc2hfc3RhdHVzPT0ncGVuZGluZycgfHwgJHJlcXVlc3QtPmNhc2hfc3RhdHVzPT0naGFsdCcpPydubyc6J3llcyc7CgogICAgICAgICRwdXJjaGFzZU9yZGVyID0gUHVyY2hhc2VPcmRlcjo6d2hlcmVIYXMoJ3JlbFF1b3RhdGlvbicsZnVuY3Rpb24gKCRxdWVyeSl7CiAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3R5cGUnLCdkaXJlY3QtcHVyY2hhc2UnKS0+d2hlcmUoJ3N0YXR1cycsJ2FjdGl2ZScpCiAgICAgICAgICAgIC0+d2hlcmUoJ2lzX2FwcHJvdmVkJywnYXBwcm92ZWQnKS0+d2hlcmUoJ2lzX3BvX2dlbmVyYXRlJywneWVzJyk7CiAgICAgICAgfSkKICAgICAgICAtPndoZXJlKCdpZCcsJHJlcXVlc3QtPmlkKQogICAgICAgIC0+Zmlyc3QoKTsKCiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoJHB1cmNoYXNlT3JkZXIpIHsKICAgICAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyLT51cGRhdGUoWwogICAgICAgICAgICAgICAgICAgICdpc19zZW5kJz0+JGlzX3NlbmQsCiAgICAgICAgICAgICAgICAgICAgJ2Nhc2hfc3RhdHVzJyA9PiAkcmVxdWVzdC0+Y2FzaF9zdGF0dXMsCiAgICAgICAgICAgICAgICAgICAgJ2Nhc2hfbm90ZScgPT4gJHJlcXVlc3QtPmNhc2hfbm90ZSwKICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+IGlzc2V0KCRyZXF1ZXN0LT5jb3N0X2NlbnRyZV9pZCkgPyAkcmVxdWVzdC0+Y29zdF9jZW50cmVfaWQgOiAkcHVyY2hhc2VPcmRlci0+Y29zdF9jZW50cmVfaWQsCiAgICAgICAgICAgICAgICBdKTsgCgogICAgICAgICAgICAgICAgLy8gJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgZGF0YS1zcmM9Iicucm91dGUoJ3Btcy5xdW90YXRpb24ucXVvdGF0aW9ucy5jcy5wcm9wb3NhbC5kZXRhaWxzJywkcHVyY2hhc2VPcmRlci0+aWQpLiciIGRhdGEtdGl0bGU9IlB1cmNoYXNlIE9yZGVyIERldGFpbHMiPlJlZmVyZW5jZSBObzonLiRwdXJjaGFzZU9yZGVyLT5yZWZlcmVuY2Vfbm8uJy5DYXNoICcudWNmaXJzdCgkcmVxdWVzdC0+Y2FzaF9zdGF0dXMpLicgQnkgQWNjb3VudHMuPC9zcGFuPic7CgogICAgICAgICAgICAgICAgLy8gQ3JlYXRlT3JVcGRhdGVOb3RpZmljYXRpb24oJycsJG1lc3NhZ2UsJ3VucmVhZCcsJ3NlbnQtdG8tcHVyY2hhc2UnLCcnLGdldE1hbmFnZXJJbmZvKCdQdXJjaGFzZS1EZXBhcnRtZW50JykpOwogICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uSWQgPSAkcHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5yZWxSZXF1ZXN0UHJvcG9zYWwtPnJlcXVlc3RQcm9wb3NhbFJlcXVpc2l0aW9uLT5maXJzdCgpICAgICAgICAgIC0+cmVxdWlzaXRpb25faWQ7CiAgICAgICAgICAgICAgICBpZiAoJHJlcXVpc2l0aW9uSWQpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKCRyZXF1ZXN0LT5jYXNoX3N0YXR1cykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdhcHByb3ZlZCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1aXNpdGlvblRyYWNraW5nSGlzdG9yeSgkcmVxdWlzaXRpb25JZCwgJ3BvX2Nhc2hfYXBwcm92YWwnLCAnUE8gY2FzaCBhcHByb3ZlZCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3JlamVjdCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1aXNpdGlvblRyYWNraW5nSGlzdG9yeSgkcmVxdWlzaXRpb25JZCwgJ3BvX2Nhc2hfcmVqZWN0JywgJ1BPIGNhc2ggcmVqZWN0ZWQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdoYWx0JzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVpc2l0aW9uVHJhY2tpbmdIaXN0b3J5KCRyZXF1aXNpdGlvbklkLCAncG9fY2FzaF9oYWx0JywgJ1BPIGNhc2ggaGFsdGVkJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvL2RkKCRyZXF1aXNpdGlvbklkKTsKCiAgICAgICAgICAgICAgICBEQjo6Y29tbWl0KCk7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJDYXNoIEFwcHJvdmFsIGFjdGlvbiBoYXMgYmVlbiBkb25lIHN1Y2Nlc3NmdWxseS4iCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJ1NvcnJ5ISEgUHVyY2hhc2UgT3JkZXIgTm90IEZvdW5kIScKICAgICAgICAgICAgXSk7CiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJHRoLT5nZXRNZXNzYWdlKCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRGlzcGxheSB0aGUgc3BlY2lmaWVkIHJlc291cmNlLgogICAgICoKICAgICAqIEBwYXJhbSAgaW50ICAkaWQKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2hvdygkaWQpCiAgICB7CiAgICAgICAgLy8KICAgIH0KCiAgICAvKioKICAgICAqIFNob3cgdGhlIGZvcm0gZm9yIGVkaXRpbmcgdGhlIHNwZWNpZmllZCByZXNvdXJjZS4KICAgICAqCiAgICAgKiBAcGFyYW0gIGludCAgJGlkCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGVkaXQoJGlkKQogICAgewogICAgICAgIC8vCiAgICB9CgogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIHNwZWNpZmllZCByZXNvdXJjZSBpbiBzdG9yYWdlLgogICAgICoKICAgICAqIEBwYXJhbSAgXElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0ICAkcmVxdWVzdAogICAgICogQHBhcmFtICBpbnQgICRpZAogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiB1cGRhdGUoUmVxdWVzdCAkcmVxdWVzdCwgJGlkKQogICAgewogICAgICAgIC8vCiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIHNwZWNpZmllZCByZXNvdXJjZSBmcm9tIHN0b3JhZ2UuCiAgICAgKgogICAgICogQHBhcmFtICBpbnQgICRpZAogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBkZXN0cm95KCRpZCkKICAgIHsKICAgICAgICAvLwogICAgfQp9Cg==