<?php
bolt_decrypt( __FILE__ , 'fYrS8D'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zOwp1c2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcQ29udHJvbGxlcjsKdXNlIEFwcFxNYWlsXFBtc1xSZXF1ZXN0Rm9yUHJvcG9zYWxUb1N1cHBsaWVyTWFpbDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXENhdGVnb3J5Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHJvZHVjdDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmVxdWlzaXRpb25JdGVtOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmVxdWlzaXRpb25UeXBlOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUmZwXFJlcXVlc3RQcm9wb3NhbDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJmcFxSZXF1ZXN0UHJvcG9zYWxEZWZpbmVTdXBwbGllcjsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJmcFxSZXF1ZXN0UHJvcG9zYWxEZXRhaWxzOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUXVvdGF0aW9uczsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFF1b3RhdGlvbnNJdGVtczsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFN1cHBsaWVyczsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFN1cHBsaWVyUGF5bWVudFRlcm07CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xSZXF1ZXN0UHJvcG9zYWxUcmFja2luZzsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVlc3RQcm9wb3NhbFJlcXVpc2l0aW9uczsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXI7CnVzZSBBcHBcVXNlcjsKCnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDdXJyZW5jeVR5cGU7Cgp1c2UgSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3Q7CnVzZSBBcHBcSHR0cFxSZXF1ZXN0czsKdXNlIERCLFZhbGlkYXRvcixBdXRoLFZpZXc7CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xNYWlsOwp1c2UgUERGLCBVUkwsIERhdGFUYWJsZXM7CgpjbGFzcyBSZXF1ZXN0UHJvcG9zYWxDb250cm9sbGVyIGV4dGVuZHMgQ29udHJvbGxlcgp7ICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gaGVhZGVyQ29sdW1ucygkdmFsdWU9JycpCiAgICB7CiAgICAgICAgcmV0dXJuIGFycmF5KAogICAgICAgICAgICBbJ1NMJywgJ1NMJ10sCiAgICAgICAgICAgIFsncmVmZXJlbmNlX25vJywgJ3JlZmVyZW5jZV9ubycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3JlcXVpc2l0aW9ucycsICdyZXF1aXNpdGlvbnMnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydwcm9kdWN0cycsICdwcm9kdWN0cycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3N1cHBsaWVycycsICdzdXBwbGllcnMnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydyZXF1aXNpdGlvbl9kYXRlJywgJ3JlcXVlc3RfZGF0ZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3R5cGUnLCAndHlwZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2NyZWF0ZWRfYnknLCAnY3JlYXRlZF9ieScsICd0ZXh0LWNlbnRlciddLCAKICAgICAgICAgICAgWydhY3Rpb25zJywgJ2FjdGlvbnMnLCAndGV4dC1jZW50ZXInXQogICAgICAgICk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogRGlzcGxheSBhIGxpc3Rpbmcgb2YgdGhlIHJlc291cmNlLgogICAgICoKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaW5kZXgoKQogICAgewogICAgICAgIHRyeSB7CgogICAgICAgICAgICAkdGl0bGUgPSAnUkZQIExpc3QnOwoKICAgICAgICAgICAgJHByb3Bvc2FscyA9IFJlcXVlc3RQcm9wb3NhbDo6d2hlcmVOb3RJbigncXVvdGF0aW9uX2dlbmVyYXRlX3R5cGUnLFsnY29tcGxldGUnXSkKICAgICAgICAgICAgLT5zZWxlY3QoWydpZCddKQogICAgICAgICAgICAtPndpdGhDb3VudChbJ2RlZmluZVRvU3VwcGxpZXInLCAncmVsUXVvdGF0aW9ucyddKQogICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAgICAgJHByb3Bvc2FscyA9IGFycmF5X3ZhbHVlcyhhcnJheV9maWx0ZXIoYXJyYXlfbWFwKGZ1bmN0aW9uKCRwcm9wb3NhbCl7CiAgICAgICAgICAgICAgICBpZigkcHJvcG9zYWxbJ2RlZmluZV90b19zdXBwbGllcl9jb3VudCddID4gJHByb3Bvc2FsWydyZWxfcXVvdGF0aW9uc19jb3VudCddKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHByb3Bvc2FsWydpZCddOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBjb2xsZWN0KCRwcm9wb3NhbHMpLT50b0FycmF5KCkpKSk7CgogICAgICAgICAgICAkcmVxdWVzdFByb3Bvc2FscyA9IFJlcXVlc3RQcm9wb3NhbDo6d2l0aChbCiAgICAgICAgICAgICAgICAnZGVmaW5lVG9TdXBwbGllci5zdXBwbGllcicsCiAgICAgICAgICAgICAgICAncmVxdWVzdFByb3Bvc2FsRGV0YWlscy5wcm9kdWN0LmF0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScsCiAgICAgICAgICAgICAgICAnY3JlYXRlZEJ5JywKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb25zJywKICAgICAgICAgICAgICAgICdyZXF1ZXN0UHJvcG9zYWxSZXF1aXNpdGlvbi5yZWxSZXF1aXNpdGlvbicKICAgICAgICAgICAgXSkKICAgICAgICAgICAgLT53aGVyZUluKCdpZCcsICRwcm9wb3NhbHMpCiAgICAgICAgICAgIC0+d2hlbighZGF0YXRhYmxlT3JkZXJpbmcoKSwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyYnkoJ3JlcXVlc3RfZGF0ZScsICdkZXNjJyk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgJG9wdGlvbnMgPSBbCiAgICAgICAgICAgICAgICAncXVvdGF0aW9uLWdlbmVyYXRlJyA9PiBhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdxdW90YXRpb24tZ2VuZXJhdGUnKSwKICAgICAgICAgICAgICAgICdxdW90YXRpb24tY29tcGxldGUnID0+IGF1dGgoKS0+dXNlcigpLT5oYXNQZXJtaXNzaW9uVG8oJ3F1b3RhdGlvbi1jb21wbGV0ZScpLAogICAgICAgICAgICBdOwoKICAgICAgICAgICAgIGlmIChyZXF1ZXN0KCktPmFqYXgoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIERhdGF0YWJsZXM6Om9mKCRyZXF1ZXN0UHJvcG9zYWxzKQogICAgICAgICAgICAgICAgLT5hZGRJbmRleENvbHVtbigpCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncmVmZXJlbmNlX25vJywgZnVuY3Rpb24oJHJlcXVlc3RQcm9wb3NhbCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBvbmNsaWNrPSJvcGVuTW9kYWwoJy4kcmVxdWVzdFByb3Bvc2FsLT5pZC4nKSIgY2xhc3M9ImJ0biBidG4tbGluayB0ZXh0LXByaW1hcnkiPicuJHJlcXVlc3RQcm9wb3NhbC0+cmVmZXJlbmNlX25vLic8L2E+JzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncmVmZXJlbmNlX25vJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZWZlcmVuY2Vfbm8nLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3JlZmVyZW5jZV9ubycsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ3JlZmVyZW5jZV9ubycsICRvcmRlcik7CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdyZXF1aXNpdGlvbnMnLCBmdW5jdGlvbigkcmVxdWVzdFByb3Bvc2FsKXsKICAgICAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb25zID0gJyc7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYoJHJlcXVlc3RQcm9wb3NhbC0+cmVxdWVzdFByb3Bvc2FsUmVxdWlzaXRpb24tPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCgkcmVxdWVzdFByb3Bvc2FsLT5yZXF1ZXN0UHJvcG9zYWxSZXF1aXNpdGlvbiBhcyAka2V5ID0+ICRyZXF1aXNpdGlvbil7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb25zIC49ICgka2V5ID4gMCA/ICcsICcgOiAnJykuJzxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgZGF0YS1zcmM9Iicucm91dGUoJ3Btcy5yZXF1aXNpdGlvbi5saXN0LnZpZXcuc2hvdycsJHJlcXVpc2l0aW9uLT5yZWxSZXF1aXNpdGlvbi0+aWQpLiciIGNsYXNzPSJ0ZXh0LXByaW1hcnkgcmVxdWlzaXRpb24gbS0xIHJvdW5kZWQgc2hvd1JlcXVpc3Rpb25EZXRhaWxzIiBvbmNsaWNrPSJyZXF1aXN0aW9uRGV0YWlscygkKHRoaXMpKSI+Jy4gJHJlcXVpc2l0aW9uLT5yZWxSZXF1aXNpdGlvbi0+cmVmZXJlbmNlX25vIC4nPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcmVxdWlzaXRpb25zOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdyZXF1aXNpdGlvbnMnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmVIYXMoJ3JlcXVlc3RQcm9wb3NhbFJlcXVpc2l0aW9uLnJlbFJlcXVpc2l0aW9uJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGtleXdvcmQpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncmVmZXJlbmNlX25vJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdyZXF1aXNpdGlvbnMnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBSZXF1ZXN0UHJvcG9zYWxSZXF1aXNpdGlvbnM6OnNlbGVjdCgncmVxdWlzaXRpb25zLnJlZmVyZW5jZV9ubycpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbigncmVxdWlzaXRpb25zJywgJ3JlcXVpc2l0aW9ucy5pZCcsICc9JywgJ3JlcXVlc3RfcHJvcG9zYWxfcmVxdWlzaXRpb25zLnJlcXVpc2l0aW9uX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigncmVxdWVzdF9wcm9wb3NhbF9yZXF1aXNpdGlvbnMucmVxdWVzdF9wcm9wb3NhbF9pZCcsICdyZXF1ZXN0X3Byb3Bvc2Fscy5pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdwcm9kdWN0cycsIGZ1bmN0aW9uKCRyZXF1ZXN0UHJvcG9zYWwpewogICAgICAgICAgICAgICAgICAgICRwcm9kdWN0cyA9ICcnOwogICAgICAgICAgICAgICAgICAgIGlmKCRyZXF1ZXN0UHJvcG9zYWwtPnJlcXVlc3RQcm9wb3NhbERldGFpbHMtPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCgkcmVxdWVzdFByb3Bvc2FsLT5yZXF1ZXN0UHJvcG9zYWxEZXRhaWxzIGFzICRrZXkgPT4gJHByb2R1Y3QpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHByb2R1Y3RzIC49ICgka2V5ID4gMCA/ICcsICcgOiAnJykuJHByb2R1Y3QtPnByb2R1Y3QtPm5hbWUuJyAnLmdldFByb2R1Y3RBdHRyaWJ1dGVzRmFzdGVyKCRwcm9kdWN0LT5wcm9kdWN0KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRwcm9kdWN0czsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncHJvZHVjdHMnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRrZXl3b3JkKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGtleXdvcmQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICAkcXVlcnktPndoZXJlSGFzKCdyZXF1ZXN0UHJvcG9zYWxEZXRhaWxzLnByb2R1Y3QnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgka2V5d29yZCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAtPm9yV2hlcmUoZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGtleXdvcmQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlcXVlc3RQcm9wb3NhbERldGFpbHMucHJvZHVjdC5hdHRyaWJ1dGVzLmF0dHJpYnV0ZU9wdGlvbicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+b3JXaGVyZUhhcygncmVxdWVzdFByb3Bvc2FsRGV0YWlscy5wcm9kdWN0LmF0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdwcm9kdWN0cycsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFJlcXVlc3RQcm9wb3NhbERldGFpbHM6OnNlbGVjdCgncHJvZHVjdHMubmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbigncHJvZHVjdHMnLCAncHJvZHVjdHMuaWQnLCAnPScsICdyZXF1ZXN0X3Byb3Bvc2FsX2RldGFpbHMucHJvZHVjdF9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3JlcXVlc3RfcHJvcG9zYWxfZGV0YWlscy5yZXF1ZXN0X3Byb3Bvc2FsX2lkJywgJ3JlcXVlc3RfcHJvcG9zYWxzLmlkJykKICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3N1cHBsaWVycycsIGZ1bmN0aW9uKCRyZXF1ZXN0UHJvcG9zYWwpewogICAgICAgICAgICAgICAgICAgICRzdXBwbGllcnMgPSAnJzsKICAgICAgICAgICAgICAgICAgICBpZigkcmVxdWVzdFByb3Bvc2FsLT5kZWZpbmVUb1N1cHBsaWVyLT5jb3VudCgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2goJHJlcXVlc3RQcm9wb3NhbC0+ZGVmaW5lVG9TdXBwbGllciBhcyAka2V5ID0+ICRzdXBwbGllcil7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3VwcGxpZXJzIC49ICgka2V5ID4gMCA/ICcsICcgOiAnJykuJHN1cHBsaWVyLT5zdXBwbGllci0+bmFtZS4nICgnLiRzdXBwbGllci0+c3VwcGxpZXItPmNvZGUuJyknOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiAkc3VwcGxpZXJzOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdzdXBwbGllcnMnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmVIYXMoJ2RlZmluZVRvU3VwcGxpZXIuc3VwcGxpZXInLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgka2V5d29yZCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5vcldoZXJlKCdjb2RlJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdzdXBwbGllcnMnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBSZXF1ZXN0UHJvcG9zYWxEZWZpbmVTdXBwbGllcjo6c2VsZWN0KCdzdXBwbGllci5uYW1lJykKICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdzdXBwbGllcnMnLCAnc3VwcGxpZXJzLmlkJywgJz0nLCAncmVxdWVzdF9wcm9wb3NhbF9kZWZpbmVfc3VwcGxpZXJzLnN1cHBsaWVyX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigncmVxdWVzdF9wcm9wb3NhbF9kZWZpbmVfc3VwcGxpZXJzLnJlcXVlc3RfcHJvcG9zYWxfaWQnLCAncmVxdWVzdF9wcm9wb3NhbHMuaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3JlcXVpc2l0aW9uX2RhdGUnLCBmdW5jdGlvbigkcmVxdWVzdFByb3Bvc2FsKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHJlcXVlc3RQcm9wb3NhbC0+cmVxdWVzdF9kYXRlKSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3JlcXVpc2l0aW9uX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3JlcXVlc3RfZGF0ZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbigncmVxdWlzaXRpb25fZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ3JlcXVlc3RfZGF0ZScsICRvcmRlcik7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2NyZWF0ZWRfYnknLCBmdW5jdGlvbigkcmVxdWVzdFByb3Bvc2FsKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHJlcXVlc3RQcm9wb3NhbC0+Y3JlYXRlZEJ5LT5uYW1lKT8kcmVxdWVzdFByb3Bvc2FsLT5jcmVhdGVkQnktPm5hbWU6Jyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2NyZWF0ZWRfYnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdjcmVhdGVkQnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignY3JlYXRlZF9ieScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFVzZXI6OnNlbGVjdCgnbmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3VzZXJzLmlkJywgJ3JlcXVlc3RfcHJvcG9zYWxzLmNyZWF0ZWRfYnknKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FjdGlvbnMnLCBmdW5jdGlvbigkcmVxdWVzdFByb3Bvc2FsKSB1c2UoJG9wdGlvbnMpewogICAgICAgICAgICAgICAgICAgICRhY3Rpb25zPScnOwogICAgICAgICAgICAgICAgICAgICRhY3Rpb25zLj0gJzxkaXYgY2xhc3M9ImJ0bi1ncm91cCI+PGJ1dHRvbiBjbGFzcz0iYnRuIGRyb3Bkb3duLXRvZ2dsZSIgZGF0YS10b2dnbGU9ImRyb3Bkb3duIj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0ic3RhdHVzTmFtZSI+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgZmlsbD0iY3VycmVudENvbG9yIiBjbGFzcz0iYmkgYmktdGhyZWUtZG90cy12ZXJ0aWNhbCIgdmlld0JveD0iMCAwIDE2IDE2Ij48cGF0aCBkPSJNOS41IDEzYTEuNSAxLjUgMCAxIDEtMyAwIDEuNSAxLjUgMCAwIDEgMyAwem0wLTVhMS41IDEuNSAwIDEgMS0zIDAgMS41IDEuNSAwIDAgMSAzIDB6bTAtNWExLjUgMS41IDAgMSAxLTMgMCAxLjUgMS41IDAgMCAxIDMgMHoiLz48L3N2Zz48L3NwYW4+PC9idXR0b24+PHVsIGNsYXNzPSJkcm9wZG93bi1tZW51Ij4nOwoKICAgICAgICAgICAgICAgICAgICBpZigkb3B0aW9uc1sncXVvdGF0aW9uLWdlbmVyYXRlJ10pewogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucy49JzxsaT48YSB0YXJnZXQ9Il9ibGFuayIgaHJlZj0iJy5yb3V0ZSgncG1zLnJmcC5xdW90YXRpb25zLmdlbmVyYXRlJywkcmVxdWVzdFByb3Bvc2FsLT5pZCkuJyI+PGkgY2xhc3M9ImxhcyBsYS1wbHVzIj48L2k+IFF1b3RhdGlvbiBHZW5lcmF0ZTwvYT48L2xpPic7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZigkcmVxdWVzdFByb3Bvc2FsLT5yZWxRdW90YXRpb25zLT5jb3VudCgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRvcHRpb25zWydxdW90YXRpb24tY29tcGxldGUnXSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSc8bGk+PGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBvbmNsaWNrPSJjb21wbGV0ZVFHKCQodGhpcykpIiBjbGFzcz0iY29tcGxldGVRRyIgZGF0YS1zcmM9Iicucm91dGUoJ3Btcy5yZnAuZ2VuZXJhdGUuY29tcGxldGUnKS4nIiBkYXRhLWlkPScuJHJlcXVlc3RQcm9wb3NhbC0+aWQuJz48aSBjbGFzcz0ibGFzIGxhLWNoZWNrLWNpcmNsZSI+PC9pPiBDb21wbGV0ZTwvYT48L2xpPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gZWxzZXsKICAgICAgICAgICAgICAgICAgICAvLyAgICAgJGFjdGlvbnMgLj0nPGxpPjxhIHRhcmdldD0iX19ibGFuayIgaHJlZj0iJy5yb3V0ZSgncG1zLnJmcC5yZXF1ZXN0LXByb3Bvc2FsLmVkaXQnLCRyZXF1ZXN0UHJvcG9zYWwtPmlkKS4nIj48aSBjbGFzcz0ibGFzIGxhLWVkaXQiPjwvaT4gUkZQIFJldmlzZTwvYT48L2xpPic7CiAgICAgICAgICAgICAgICAgICAgLy8gfQoKICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucy49JzxsaT48YSB0YXJnZXQ9Il9ibGFuayIgaHJlZj0iJy5yb3V0ZSgncG1zLnJmcC5oaXN0b3J5JywkcmVxdWVzdFByb3Bvc2FsLT5pZCkuJyI+PGkgY2xhc3M9ImxhcyBsYS1oaXN0b3J5Ij48L2k+IFJGUCBIaXN0b3J5PC9hPjwvbGk+JzsKCiAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMuPSc8L3VsPjwvZGl2Pic7CgogICAgICAgICAgICAgICAgICAgIHJldHVybiAkYWN0aW9uczsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPnJhd0NvbHVtbnMoWydyZWZlcmVuY2Vfbm8nLCAncmVxdWlzaXRpb25zJywgJ3JlcXVpc2l0aW9uX2RhdGUnLCdjcmVhdGVkX2J5JywgJ2FjdGlvbnMnXSkKICAgICAgICAgICAgICAgIC0+bWFrZSh0cnVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnJmcC5pbmRleCcsIFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4kdGl0bGUsCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPmhlYWRlckNvbHVtbnMoKQogICAgICAgICAgICBdKTsKCiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRGlzcGxheSBhIGxpc3Rpbmcgb2YgdGhlIHJlc291cmNlLgogICAgICoKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gcmVxSGVhZGVyQ29sdW1ucygkdmFsdWU9JycpCiAgICB7CiAgICAgICAgJHJvdyA9IGFycmF5KAogICAgICAgICAgICBbJ1NMJywgJ1NMJywnJywnd2lkdGg6NSUnXSwgCiAgICAgICAgICAgIFsncmVmZXJlbmNlX25vJywgJ3JlZmVyZW5jZV9ubycsICd0ZXh0LWNlbnRlcicsJ3dpZHRoOjIwJSddLAogICAgICAgICAgICBbJ3JlcXVpc2l0aW9uX2RhdGUnLCAncmVxdWlzaXRpb25fZGF0ZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3Byb2R1Y3RfY2F0ZWdvcnknLCAncHJvZHVjdF9jYXRlZ29yeScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3VuaXQnLCAndW5pdCcsICd0ZXh0LWNlbnRlciddLCAKICAgICAgICAgICAgWydkZXBhcnRtZW50JywgJ2RlcGFydG1lbnQnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydyZXF1aXNpdGlvbl9ieScsICdyZXF1aXNpdGlvbl9ieScsICd0ZXh0LWNlbnRlciddLCAgCiAgICAgICAgICAgIFsnYXR0YWNobWVudCcsICdhdHRhY2htZW50JywgJ3RleHQtY2VudGVyJ10sICAKICAgICAgICAgICAgWydhY3Rpb25zJywgJ2FjdGlvbnMnLCAndGV4dC1jZW50ZXInLCd3aWR0aDoxNSUnXQogICAgICAgICk7CgogICAgICAgIGlmKGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdFbXBsb3llZScpIHx8IGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdEZXBhcnRtZW50LUhlYWQnKSB8fCBhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnUHVyY2hhc2UtRGVwYXJ0bWVudCcpKSB7CiAgICAgICAgICAgIAogICAgICAgIH1lbHNlewogICAgICAgICAgICB1bnNldCgkcm93WzddKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkcm93OwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiByZXF1aXNpdGlvbkluZGV4KCl7CgogICAgICAgICR0aXRsZSA9ICdSRlAgUmVxdWlzaXRpb24gTGlzdCc7CiAgICAgICAgJGZyb20gPSByZXF1ZXN0KCktPmhhcygnZnJvbScpID8gcmVxdWVzdCgpLT5nZXQoJ2Zyb20nKSA6IGRhdGUoJ1ktbS0wMScpOwogICAgICAgICR0byA9IHJlcXVlc3QoKS0+aGFzKCd0bycpID8gcmVxdWVzdCgpLT5nZXQoJ3RvJykgOiBkYXRlKCdZLW0tdCcpOwogICAgICAgICRjYXRlZ29yeV9pZCA9IHJlcXVlc3QoKS0+aGFzKCdjYXRlZ29yeV9pZCcpID8gcmVxdWVzdCgpLT5nZXQoJ2NhdGVnb3J5X2lkJykgOiAwOwogICAgICAgICRkZXBhcnRtZW50X2lkID0gcmVxdWVzdCgpLT5oYXMoJ2RlcGFydG1lbnRfaWQnKSA/IHJlcXVlc3QoKS0+Z2V0KCdkZXBhcnRtZW50X2lkJykgOiAwOwogICAgICAgICRyZXF1aXNpdGlvbl9ieSA9IHJlcXVlc3QoKS0+aGFzKCdyZXF1aXNpdGlvbl9ieScpID8gcmVxdWVzdCgpLT5nZXQoJ3JlcXVpc2l0aW9uX2J5JykgOiAwOwoKICAgICAgICAkY2F0ZWdvcmllcyA9IENhdGVnb3J5Ojpkb2VzbnRIYXZlKCdjYXRlZ29yeScpCiAgICAgICAgLT5nZXQoKTsKCiAgICAgICAgJGRlcGFydG1lbnRzID0gUmVxdWlzaXRpb246OmpvaW4oJ3VzZXJzJywndXNlcnMuaWQnLCc9JywncmVxdWlzaXRpb25zLmF1dGhvcl9pZCcpCiAgICAgICAgLT5qb2luKCdocl9hc19iYXNpY19pbmZvJywnaHJfYXNfYmFzaWNfaW5mby5hc3NvY2lhdGVfaWQnLCc9JywndXNlcnMuYXNzb2NpYXRlX2lkJykKICAgICAgICAtPmpvaW4oJ2hyX2RlcGFydG1lbnQnLCdocl9kZXBhcnRtZW50LmhyX2RlcGFydG1lbnRfaWQnLCc9JywnaHJfYXNfYmFzaWNfaW5mby5hc19kZXBhcnRtZW50X2lkJykKICAgICAgICAtPmdyb3VwQnkoJ2hyX2RlcGFydG1lbnQuaHJfZGVwYXJ0bWVudF9pZCcpCiAgICAgICAgLT53aGVyZShmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZShbCiAgICAgICAgICAgICAgICAnc3RhdHVzJz0+MSwKICAgICAgICAgICAgICAgICdhcHByb3ZlZF9pZCc9PjEsCiAgICAgICAgICAgICAgICAnaXNfc2VuZF90b19yZnAnPT4neWVzJywKICAgICAgICAgICAgICAgICdkZWxpdmVyeV9zdGF0dXMnPT4ncHJvY2Vzc2luZycsCiAgICAgICAgICAgICAgICAnaXNfcG9fZ2VuZXJhdGUnPT4nbm8nLAogICAgICAgICAgICBdKS0+b3JXaGVyZSgncmVxdWVzdF9zdGF0dXMnLCdyZnAnKTsKICAgICAgICB9KQogICAgICAgIC0+Z2V0KFsKICAgICAgICAgICAgJ2hyX2RlcGFydG1lbnQuaHJfZGVwYXJ0bWVudF9pZCcsCiAgICAgICAgICAgICdocl9kZXBhcnRtZW50LmhyX2RlcGFydG1lbnRfbmFtZScKICAgICAgICBdKTsKCiAgICAgICAgJHVzZXJMaXN0ID0gUmVxdWlzaXRpb246OmpvaW4oJ3VzZXJzJywndXNlcnMuaWQnLCc9JywncmVxdWlzaXRpb25zLmF1dGhvcl9pZCcpCiAgICAgICAgICAgIC0+Z3JvdXBCeSgncmVxdWlzaXRpb25zLmF1dGhvcl9pZCcpCiAgICAgICAgICAgIC0+d2hlcmUoZnVuY3Rpb24gKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZShbCiAgICAgICAgICAgICAgICAncmVxdWlzaXRpb25zLnN0YXR1cycgPT4gMSwKICAgICAgICAgICAgICAgICdyZXF1aXNpdGlvbnMuYXBwcm92ZWRfaWQnID0+IDEsCiAgICAgICAgICAgICAgICAncmVxdWlzaXRpb25zLmlzX3NlbmRfdG9fcmZwJyA9PiAneWVzJywKICAgICAgICAgICAgICAgICdyZXF1aXNpdGlvbnMuZGVsaXZlcnlfc3RhdHVzJyA9PiAncHJvY2Vzc2luZycsCiAgICAgICAgICAgICAgICAncmVxdWlzaXRpb25zLmlzX3BvX2dlbmVyYXRlJyA9PiAnbm8nCiAgICAgICAgICAgIF0pLT5vcldoZXJlKCdyZXF1aXNpdGlvbnMucmVxdWVzdF9zdGF0dXMnLCdyZnAnKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5nZXQoWyd1c2Vycy5pZCcsJ3VzZXJzLm5hbWUnXSk7CgogICAgICAgIHRyeSB7CgogICAgICAgICAgICAkcmVxdWlzaXRpb25zID0gUmVxdWlzaXRpb246OndpdGgoWwogICAgICAgICAgICAgICAgJ2l0ZW1zLnByb2R1Y3QuY2F0ZWdvcnkuY2F0ZWdvcnknLAogICAgICAgICAgICAgICAgJ3JlbFVzZXJzTGlzdC5lbXBsb3llZS51bml0JwogICAgICAgICAgICBdKQogICAgICAgICAgICAtPndoZW4oc3RydG90aW1lKCRmcm9tKT4wLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkZnJvbSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZURhdGUoJ3JlcXVpc2l0aW9uX2RhdGUnLCAnPj0nLCAkZnJvbSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlbihzdHJ0b3RpbWUoJHRvKT4wLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkdG8pewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVEYXRlKCdyZXF1aXNpdGlvbl9kYXRlJywgJzw9JywgJHRvKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKCRkZXBhcnRtZW50X2lkPjAsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRkZXBhcnRtZW50X2lkKXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkZGVwYXJ0bWVudF9pZCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2FzX2RlcGFydG1lbnRfaWQnLCAkZGVwYXJ0bWVudF9pZCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKCRyZXF1aXNpdGlvbl9ieT4wLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcmVxdWlzaXRpb25fYnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2F1dGhvcl9pZCcsJHJlcXVpc2l0aW9uX2J5KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKCRjYXRlZ29yeV9pZD4wLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkY2F0ZWdvcnlfaWQpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2l0ZW1zLnByb2R1Y3QuY2F0ZWdvcnkuY2F0ZWdvcnknLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkY2F0ZWdvcnlfaWQpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpZCcsICRjYXRlZ29yeV9pZCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSktPndoZXJlKGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZShbCiAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gMSwKICAgICAgICAgICAgICAgICAgICAnYXBwcm92ZWRfaWQnID0+IDEsCiAgICAgICAgICAgICAgICAgICAgJ2lzX3NlbmRfdG9fcmZwJyA9PiAneWVzJywKICAgICAgICAgICAgICAgICAgICAnZGVsaXZlcnlfc3RhdHVzJyA9PiAncHJvY2Vzc2luZycsCiAgICAgICAgICAgICAgICAgICAgJ2lzX3BvX2dlbmVyYXRlJyA9PiAnbm8nLAogICAgICAgICAgICAgICAgXSktPm9yV2hlcmUoJ3JlcXVlc3Rfc3RhdHVzJywncmZwJyk7CiAgICAgICAgICAgIH0pLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgncmVmZXJlbmNlX25vJywgJ2Rlc2MnKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBEYXRhdGFibGVzOjpvZigkcmVxdWlzaXRpb25zKQogICAgICAgICAgICAgICAgLT5hZGRJbmRleENvbHVtbigpCiAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3JlZmVyZW5jZV9ubycsIGZ1bmN0aW9uKCR2YWx1ZXMpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAgJzxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgb25jbGljaz0ib3Blbk1vZGFsKCcuJHZhbHVlcy0+aWQuJykiICBjbGFzcz0iYnRuIGJ0bi1saW5rIj4nLiR2YWx1ZXMtPnJlZmVyZW5jZV9uby4nPC9hPic7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdyZXF1aXNpdGlvbl9kYXRlJywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGUoJ1ktbS1kJyxzdHJ0b3RpbWUoJHZhbHVlcy0+cmVxdWlzaXRpb25fZGF0ZSkpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdyZXF1aXNpdGlvbl9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZXF1aXNpdGlvbl9kYXRlJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdyZXF1aXNpdGlvbl9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJCeSgncmVxdWlzaXRpb25fZGF0ZScsICRvcmRlcik7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3Byb2R1Y3RfY2F0ZWdvcnknLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHZhbHVlcy0+aXRlbXNbMF0tPnByb2R1Y3QtPmNhdGVnb3J5LT5jYXRlZ29yeS0+bmFtZSk/JHZhbHVlcy0+aXRlbXNbMF0tPnByb2R1Y3QtPmNhdGVnb3J5LT5jYXRlZ29yeS0+bmFtZTonJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncHJvZHVjdF9jYXRlZ29yeScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2l0ZW1zLnByb2R1Y3QuY2F0ZWdvcnkuY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbigncHJvZHVjdF9jYXRlZ29yeScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFJlcXVpc2l0aW9uSXRlbTo6c2VsZWN0KCdtYWluX2NhdGVnb3J5Lm5hbWUnKQogICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ3Byb2R1Y3RzJywgJ3Byb2R1Y3RzLmlkJywgJz0nLCAncmVxdWlzaXRpb25faXRlbXMucHJvZHVjdF9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignY2F0ZWdvcmllcyBhcyBzdWJfY2F0ZWdvcnknLCAnc3ViX2NhdGVnb3J5LmlkJywgJz0nLCAncHJvZHVjdHMuY2F0ZWdvcnlfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2NhdGVnb3JpZXMgYXMgbWFpbl9jYXRlZ29yeScsICdtYWluX2NhdGVnb3J5LmlkJywgJz0nLCAnc3ViX2NhdGVnb3J5LnBhcmVudF9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3JlcXVpc2l0aW9uX2l0ZW1zLnJlcXVpc2l0aW9uX2lkJywgJ3JlcXVpc2l0aW9ucy5pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3VuaXQnLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHZhbHVlcy0+cmVsVXNlcnNMaXN0LT5lbXBsb3llZS0+dW5pdC0+aHJfdW5pdF9zaG9ydF9uYW1lKT8kdmFsdWVzLT5yZWxVc2Vyc0xpc3QtPmVtcGxveWVlLT51bml0LT5ocl91bml0X3Nob3J0X25hbWU6Jyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3VuaXQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QuZW1wbG95ZWUudW5pdCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdocl91bml0X3Nob3J0X25hbWUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3VuaXQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBVc2VyOjpzZWxlY3QoJ2hyX3VuaXQuaHJfdW5pdF9zaG9ydF9uYW1lJykKICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdocl9hc19iYXNpY19pbmZvJywgJ2hyX2FzX2Jhc2ljX2luZm8uYXNzb2NpYXRlX2lkJywgJz0nLCAndXNlcnMuYXNzb2NpYXRlX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdocl91bml0JywgJ2hyX3VuaXQuaHJfdW5pdF9pZCcsICc9JywgJ2hyX2FzX2Jhc2ljX2luZm8uYXNfdW5pdF9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3VzZXJzLmlkJywgJ3JlcXVpc2l0aW9ucy5hdXRob3JfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdkZXBhcnRtZW50JywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCR2YWx1ZXMtPnJlbFVzZXJzTGlzdC0+ZW1wbG95ZWUtPmRlcGFydG1lbnQtPmhyX2RlcGFydG1lbnRfbmFtZSk/JHZhbHVlcy0+cmVsVXNlcnNMaXN0LT5lbXBsb3llZS0+ZGVwYXJ0bWVudC0+aHJfZGVwYXJ0bWVudF9uYW1lOicnOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdkZXBhcnRtZW50JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsVXNlcnNMaXN0LmVtcGxveWVlLmRlcGFydG1lbnQnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnaHJfZGVwYXJ0bWVudF9uYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdkZXBhcnRtZW50JywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgVXNlcjo6c2VsZWN0KCdocl9kZXBhcnRtZW50LmhyX2RlcGFydG1lbnRfbmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignaHJfYXNfYmFzaWNfaW5mbycsICdocl9hc19iYXNpY19pbmZvLmFzc29jaWF0ZV9pZCcsICc9JywgJ3VzZXJzLmFzc29jaWF0ZV9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignaHJfZGVwYXJ0bWVudCcsICdocl9kZXBhcnRtZW50LmhyX2RlcGFydG1lbnRfaWQnLCAnPScsICdocl9hc19iYXNpY19pbmZvLmFzX2RlcGFydG1lbnRfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCd1c2Vycy5pZCcsICdyZXF1aXNpdGlvbnMuYXV0aG9yX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncmVxdWlzaXRpb25fYnknLCBmdW5jdGlvbigkdmFsdWVzKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHZhbHVlcy0+cmVsVXNlcnNMaXN0LT5uYW1lKT8gJHZhbHVlcy0+cmVsVXNlcnNMaXN0LT5uYW1lIDonJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncmVxdWlzaXRpb25fYnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxVc2Vyc0xpc3QnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbigncmVxdWlzaXRpb25fYnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBVc2VyOjpzZWxlY3QoJ3VzZXJzLm5hbWUnKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCd1c2Vycy5pZCcsICdyZXF1aXNpdGlvbnMuYXV0aG9yX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYXR0YWNobWVudCcsIGZ1bmN0aW9uKCR2YWx1ZXMpewogICAgICAgICAgICAgICAgICAgICAgICAkYXR0YWNobWVudCA9Jyc7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdFbXBsb3llZScpIHx8IGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdEZXBhcnRtZW50LUhlYWQnKSB8fCBhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnUHVyY2hhc2UtRGVwYXJ0bWVudCcpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFlbXB0eSgkdmFsdWVzLT5hdHRhY2htZW50KSAmJiBmaWxlX2V4aXN0cyhwdWJsaWNfcGF0aCgkdmFsdWVzLT5hdHRhY2htZW50KSkpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhdHRhY2htZW50Lj0nPGEgaHJlZj0iJy4gdXJsKCR2YWx1ZXMtPmF0dGFjaG1lbnQpIC4nIiB0YXJnZXQ9Il9ibGFuayIgY2xhc3M9ImJ0biBidG4teHMgYnRuLXByaW1hcnkiPjxpIGNsYXNzPSJsYXMgbGEtcGFwZXJjbGlwIj48L2k+QXR0YWNobWVudDwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGF0dGFjaG1lbnQ7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhY3Rpb25zJywgZnVuY3Rpb24oJHZhbHVlcyl7CiAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgPSAnJzsKICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucy49JzxkaXYgY2xhc3M9ImJ0bi1ncm91cCI+PGJ1dHRvbiBjbGFzcz0iYnRuIGRyb3Bkb3duLXRvZ2dsZSIgZGF0YS10b2dnbGU9ImRyb3Bkb3duIj48c3BhbiBpZD0ic3RhdHVzTmFtZScuJHZhbHVlcy0+aWQuJyI+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgZmlsbD0iY3VycmVudENvbG9yIiBjbGFzcz0iYmkgYmktdGhyZWUtZG90cy12ZXJ0aWNhbCIgdmlld0JveD0iMCAwIDE2IDE2Ij48cGF0aCBkPSJNOS41IDEzYTEuNSAxLjUgMCAxIDEtMyAwIDEuNSAxLjUgMCAwIDEgMyAwem0wLTVhMS41IDEuNSAwIDEgMS0zIDAgMS41IDEuNSAwIDAgMSAzIDB6bTAtNWExLjUgMS41IDAgMSAxLTMgMCAxLjUgMS41IDAgMCAxIDMgMHoiLz48L3N2Zz48L3NwYW4+PC9idXR0b24+PHVsIGNsYXNzPSJkcm9wZG93bi1tZW51Ij4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0nPGxpPjxhIGNsYXNzPSJjb252ZXJ0VG9SZnAiIGRhdGEtc3JjPSInLnJvdXRlKCdwbXMucmZwLmNvbnZlcnQudG8ucmZwJykuJyIgb25jbGljaz0iY29udmVydFRvUmZwKCQodGhpcykpIiBkYXRhLWlkPSInLiR2YWx1ZXMtPmlkLiciIHRpdGxlPSJQcmVwYXJlIHRvIFJGUCIgPlByZXBhcmUgVG8gUkZQPC9hPjwvbGk+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49JzxsaT48YSB0YXJnZXQ9Il9fYmxhbmsiIGhyZWY9Iicucm91dGUoJ3Btcy5yZnAuc2VuZC50by5wdXJjaGFzZScsJHZhbHVlcy0+aWQpLiciIHRpdGxlPSJEaXJlY3QgUHVyY2hhc2UiPkRpcmVjdCBQdXJjaGFzZTwvYT48L2xpPic7CiAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMuPSc8L3VsPjwvZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhY3Rpb25zOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+cmF3Q29sdW1ucyhbJ3JlZmVyZW5jZV9ubycsJ2F0dGFjaG1lbnQnLCdhY3Rpb25zJ10pCiAgICAgICAgICAgICAgICAtPm1ha2UodHJ1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAkZGF0YT1bCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICR0aXRsZSwKICAgICAgICAgICAgICAgICd1c2VyTGlzdCcgPT4gJHVzZXJMaXN0LAogICAgICAgICAgICAgICAgJ2RlcGFydG1lbnRzJyA9PiAkZGVwYXJ0bWVudHMsCiAgICAgICAgICAgICAgICAnZnJvbScgPT4gJGZyb20sCiAgICAgICAgICAgICAgICAndG8nID0+ICR0bywKICAgICAgICAgICAgICAgICdjYXRlZ29yeV9pZCcgPT4gJGNhdGVnb3J5X2lkLAogICAgICAgICAgICAgICAgJ3JlcXVpc2l0aW9uX2J5JyA9PiAkcmVxdWlzaXRpb25fYnksCiAgICAgICAgICAgICAgICAnZGVwYXJ0bWVudF9pZCcgPT4gJGRlcGFydG1lbnRfaWQsCiAgICAgICAgICAgICAgICAnY2F0ZWdvcmllcycgPT4gJGNhdGVnb3JpZXMsCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPnJlcUhlYWRlckNvbHVtbnMoKSwKICAgICAgICAgICAgXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5yZnAuZGVmdC1yZXF1aXNpdGlvbi1pbmRleCcsJGRhdGEpOwoKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRvIHJlcXVlc3QgZm9yIHByb3Bvc2FsLgogICAgICoKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgKi8KCiAgICBwdWJsaWMgZnVuY3Rpb24gY29udmVydFRvUmZwKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJHJlc3BvbnNlID0gW107CgogICAgICAgICRyZXF1aXNpdGlvbj1SZXF1aXNpdGlvbjo6d2hlcmUoZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHJlcXVlc3QpewogICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKFsnaWQnPT4kcmVxdWVzdC0+cmVxdWlzaXRpb25faWQsJ3N0YXR1cyc9PjEsJ2FwcHJvdmVkX2lkJz0+MSwnaXNfc2VuZF90b19yZnAnPT4neWVzJywnZGVsaXZlcnlfc3RhdHVzJz0+J3Byb2Nlc3NpbmcnXSktPm9yV2hlcmUoJ3JlcXVlc3Rfc3RhdHVzJywncmZwJyk7CiAgICAgICAgfSkKICAgICAgICAtPmZpcnN0KCk7CgogICAgICAgIC8vU3RhcnQgdHJhbnNhY3Rpb24KICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBpZihjb3VudCgoYXJyYXkpJHJlcXVpc2l0aW9uKT4wKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZigkcmVxdWlzaXRpb24tPnJlcXVlc3Rfc3RhdHVzPT0ncmZwJyl7CiAgICAgICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uLT5yZXF1ZXN0X3N0YXR1cyA9ICdzZW5kX3JmcCc7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb24tPmRlbGl2ZXJ5X3N0YXR1cyA9ICdyZnAnOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbi0+c2F2ZSgpOwogICAgICAgICAgICAgICAgREI6OmNvbW1pdCgpOwoKICAgICAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnc3VjY2Vzcyc7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICdTdWNjZXNzZnVsbHkgQ29udmVydGVkIHRvIFJGUCEhJzsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ3Jlc3VsdCddID0gJ2Vycm9yJzsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJ0RhdGEgbm90IGZvdW5kLiEhJzsKICAgICAgICAgICAgfQoKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgLy9JZiBwcm9jZXNzIGhhcyBhbnkgcHJvYmxlbSB0aGVuIHJvbGxiYWNrIHRoZSBkYXRhCiAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwoKICAgICAgICAgICAgJHJlc3BvbnNlWydyZXN1bHQnXSA9ICdlcnJvcic7CiAgICAgICAgICAgICRyZXNwb25zZVsnbWVzc2FnZSddID0gJHRoLT5nZXRNZXNzYWdlKCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHJlc3BvbnNlOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRSZXF1ZXN0UHJvcG9zYWxDb21iaW5lSW5mbyhSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRwcm9kdWN0cyA9IChpc3NldCgkcmVxdWVzdC0+cHJvZHVjdHMpID8gJHJlcXVlc3QtPnByb2R1Y3RzIDogW10pOwogICAgICAgICRzdXBwbGllcnMgPSBbXTsKICAgICAgICBpZihjb3VudCgkcHJvZHVjdHMpID4gMCl7CiAgICAgICAgICAgICRzdXBwbGllcnMgPSBTdXBwbGllcnM6OndoZXJlKCdzdGF0dXMnLCAnQWN0aXZlJykKICAgICAgICAgICAgLT53aGVyZUhhcygncHJvZHVjdHMnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcHJvZHVjdHMpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPmRpc3RpbmN0KCktPndoZXJlSW4oJ3Byb2R1Y3RfaWQnLCAkcHJvZHVjdHMpOwogICAgICAgICAgICB9LCAnPScsIGNvdW50KCRwcm9kdWN0cykpCiAgICAgICAgICAgIC0+Z2V0KCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgJ3JlZmVyZW5jZV9ubycgPT4gdW5pcXVlQ29kZSgxNSwgKCdSUC0nLmRhdGUoJ3knLCBzdHJ0b3RpbWUoZGF0ZSgnWS1tLWQnKSkpLictR1JQLScpLCAncmVxdWVzdF9wcm9wb3NhbHMnLCAnaWQnKSwKICAgICAgICAgICAgJ3N1cHBsaWVycycgPT4gJHN1cHBsaWVycywKICAgICAgICBdKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gY3JlYXRlKCkKICAgIHsgICAKICAgICAgICAkdGl0bGUgPSAnQ3JlYXRlIFJGUCc7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgCiAgICAgICAgICAgICRyZXF1aXNpdGlvbklkcyA9IGdldE1lcmdlZFJlcXVpc2lzaW9uSUQoWwogICAgICAgICAgICAgICAgJ2lzX3BvX2dlbmVyYXRlJyA9PiAnbm8nLAogICAgICAgICAgICAgICAgJ2lzX3NlbmRfdG9fcmZwJyA9PiAneWVzJywKICAgICAgICAgICAgICAgICdkZWxpdmVyeV9zdGF0dXMnID0+ICdyZnAnLAogICAgICAgICAgICAgICAgJ2FwcHJvdmVkX2lkJyA9PiAxLAogICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gMSwKICAgICAgICAgICAgXSxbCiAgICAgICAgICAgICAgICAnaXNfcG9fZ2VuZXJhdGUnID0+ICdubycsCiAgICAgICAgICAgICAgICAnaXNfc2VuZF90b19yZnAnID0+ICd5ZXMnLAogICAgICAgICAgICAgICAgJ2RlbGl2ZXJ5X3N0YXR1cycgPT4gJ3BhcnRpYWwtZGVsaXZlcmVkJywKICAgICAgICAgICAgICAgICdhcHByb3ZlZF9pZCcgPT4gMSwKICAgICAgICAgICAgICAgICdzdGF0dXMnID0+IDEsCiAgICAgICAgICAgICAgICAncmVxdWVzdF9zdGF0dXMnID0+ICdzZW5kX3JmcCcsCiAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgJHByb2R1Y3RzID0gUHJvZHVjdDo6d2hlcmUoJ3N0YXR1cycsICdhcHByb3ZlZCcpCiAgICAgICAgICAgIC0+d2l0aChbCiAgICAgICAgICAgICAgICAnc3VwcGxpZXJzJywgJ3Byb2R1Y3RVbml0JywgJ2NhdGVnb3J5LmNhdGVnb3J5JywgJ2F0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScsICdyZXF1aXNpdGlvbkl0ZW0ucmVxdWlzaXRpb24nCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlcXVpc2l0aW9uSXRlbScsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRyZXF1aXNpdGlvbklkcyl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaXNfc2VuZCcsJ25vJyktPndoZXJlSGFzKCdyZXF1aXNpdGlvbicsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRyZXF1aXNpdGlvbklkcyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignaWQnLCRyZXF1aXNpdGlvbklkcyk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSktPmdldCgpOwoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnJmcC5jcmVhdGUnLCBjb21wYWN0KCd0aXRsZScsJ3Byb2R1Y3RzJywncmVxdWlzaXRpb25JZHMnKSk7CiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRSZXF1ZXN0UHJvcG9zYWxTZXBhcmF0ZUluZm8oUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkaXRlbXMgPSAoaXNzZXQoJHJlcXVlc3QtPml0ZW1zKSA/ICRyZXF1ZXN0LT5pdGVtcyA6IFtdKTsKICAgICAgICAkcmVxdWlzaXRpb25JdGVtcyA9IFJlcXVpc2l0aW9uSXRlbTo6d2l0aChbCiAgICAgICAgICAgICdyZXF1aXNpdGlvbicKICAgICAgICBdKQogICAgICAgIC0+d2hlcmUoJ2lzX3NlbmQnLCdubycpCiAgICAgICAgLT53aGVyZUluKCdpZCcsICRpdGVtcykKICAgICAgICAtPmdldCgpOwoKICAgICAgICAkcHJvZHVjdHMgPSAkcmVxdWlzaXRpb25JdGVtcy0+cGx1Y2soJ3Byb2R1Y3RfaWQnKS0+dG9BcnJheSgpOwogICAgICAgICRzdXBwbGllcnMgPSBbXTsKICAgICAgICBpZihjb3VudCgkcHJvZHVjdHMpID4gMCl7CiAgICAgICAgICAgICRzdXBwbGllcnMgPSBTdXBwbGllcnM6OndoZXJlKCdzdGF0dXMnLCAnQWN0aXZlJykKICAgICAgICAgICAgLT53aGVyZUhhcygncHJvZHVjdHMnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcHJvZHVjdHMpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPmRpc3RpbmN0KCktPndoZXJlSW4oJ3Byb2R1Y3RfaWQnLCAkcHJvZHVjdHMpOwogICAgICAgICAgICB9LCAnPScsIGNvdW50KCRwcm9kdWN0cykpCiAgICAgICAgICAgIC0+Z2V0KCk7CiAgICAgICAgfQoKICAgICAgICAkY2x1ZSA9ICdHUlAnOwogICAgICAgICR1bml0cyA9IFxBcHBcTW9kZWxzXEhyXFVuaXQ6OndoZXJlSW4oJ2hyX3VuaXRfaWQnLCAkcmVxdWlzaXRpb25JdGVtcy0+cGx1Y2soJ3JlcXVpc2l0aW9uLmhyX3VuaXRfaWQnKS0+dG9BcnJheSgpKS0+Z2V0KCk7CiAgICAgICAgaWYoJHVuaXRzLT5jb3VudCgpID09IDEpewogICAgICAgICAgICAkY2x1ZSA9ICR1bml0c1swXS0+aHJfdW5pdF9zaG9ydF9uYW1lOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICdyZWZlcmVuY2Vfbm8nID0+IHVuaXF1ZUNvZGUoMTUsICgnUlAtJy5kYXRlKCd5Jywgc3RydG90aW1lKGRhdGUoJ1ktbS1kJykpKS4nLScuJGNsdWUuJy0nKSwgJ3JlcXVlc3RfcHJvcG9zYWxzJywgJ2lkJyksCiAgICAgICAgICAgICdzdXBwbGllcnMnID0+ICRzdXBwbGllcnMsCiAgICAgICAgXSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgc2VwYXJhdGUgcHJvcG9zYWwuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KCiAgICBwdWJsaWMgZnVuY3Rpb24gY3JlYXRlU2VwYXJhdGUoKQogICAgewogICAgICAgICR0aXRsZSA9ICdDcmVhdGUgU2VwYXJ0ZSBSRlAnOwogICAgICAgIHRyeSB7CgogICAgICAgICAgICAkcmVxdWlzaXRpb25JZHMgPSBnZXRNZXJnZWRSZXF1aXNpc2lvbklEKFsKICAgICAgICAgICAgICAgICdpc19wb19nZW5lcmF0ZScgPT4gJ25vJywKICAgICAgICAgICAgICAgICdpc19zZW5kX3RvX3JmcCcgPT4gJ3llcycsCiAgICAgICAgICAgICAgICAnZGVsaXZlcnlfc3RhdHVzJyA9PiAncmZwJywKICAgICAgICAgICAgICAgICdhcHByb3ZlZF9pZCcgPT4gMSwKICAgICAgICAgICAgICAgICdzdGF0dXMnID0+IDEsCiAgICAgICAgICAgIF0sWwogICAgICAgICAgICAgICAgJ2lzX3BvX2dlbmVyYXRlJyA9PiAnbm8nLAogICAgICAgICAgICAgICAgJ2lzX3NlbmRfdG9fcmZwJyA9PiAneWVzJywKICAgICAgICAgICAgICAgICdkZWxpdmVyeV9zdGF0dXMnID0+ICdwYXJ0aWFsLWRlbGl2ZXJlZCcsCiAgICAgICAgICAgICAgICAnYXBwcm92ZWRfaWQnID0+IDEsCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiAxLAogICAgICAgICAgICAgICAgJ3JlcXVlc3Rfc3RhdHVzJyA9PiAnc2VuZF9yZnAnLAogICAgICAgICAgICBdKTsKICAgICAgICAgICAgCiAgICAgICAgICAgICRyZXF1aXNpdGlvbnM9UmVxdWlzaXRpb246OndoZXJlSW4oJ2lkJywgJHJlcXVpc2l0aW9uSWRzKQogICAgICAgICAgICAtPndpdGgoWwogICAgICAgICAgICAgICAgJ3JlcXVpc2l0aW9uSXRlbXMnLAogICAgICAgICAgICAgICAgJ3JlcXVpc2l0aW9uSXRlbXMucHJvZHVjdC5wcm9kdWN0VW5pdCcsCiAgICAgICAgICAgICAgICAncmVxdWlzaXRpb25JdGVtcy5wcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JywKICAgICAgICAgICAgICAgICdyZXF1aXNpdGlvbkl0ZW1zLnByb2R1Y3QuYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJywKICAgICAgICAgICAgICAgICdyZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LnJlbERlbGl2ZXJ5SXRlbXMnCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlcXVpc2l0aW9uSXRlbXMnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX3NlbmQnLCAnbm8nKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5vcmRlckJ5KCdpZCcsJ2Rlc2MnKQogICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnJmcC5jcmVhdGUtc2VwYXJhdGUnLCBjb21wYWN0KCd0aXRsZScsJ3JlcXVpc2l0aW9ucycpKTsKCiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU2hvdyB0aGUgZm9ybSBmb3IgY3JlYXRpbmcgYSBuZXcgcmVzb3VyY2UuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KCiAgICBwdWJsaWMgZnVuY3Rpb24gcmVxdWlzaXRpb25EZXRhaWxCeVByb2R1Y3RJZCgkcHJvZHVjdF9pZCl7CiAgICAgICAgJHRpdGxlID0gJ1JlcXVpc3Rpb24gZGV0YWlscyBieSBwcm9kdWN0Lic7CiAgICAgICAgJHByb2R1Y3QgPSBQcm9kdWN0OjpmaW5kT3JGYWlsKCRwcm9kdWN0X2lkKTsKCiAgICAgICAgJHJlcXVpc2l0aW9uSWRzID0gZ2V0TWVyZ2VkUmVxdWlzaXNpb25JRChbCiAgICAgICAgICAgICAgICAnaXNfcG9fZ2VuZXJhdGUnID0+ICdubycsCiAgICAgICAgICAgICAgICAnaXNfc2VuZF90b19yZnAnID0+ICd5ZXMnLAogICAgICAgICAgICAgICAgJ2RlbGl2ZXJ5X3N0YXR1cycgPT4gJ3JmcCcsCiAgICAgICAgICAgICAgICAnYXBwcm92ZWRfaWQnID0+IDEsCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiAxLAogICAgICAgICAgICBdLFsKICAgICAgICAgICAgICAgICdpc19wb19nZW5lcmF0ZScgPT4gJ25vJywKICAgICAgICAgICAgICAgICdpc19zZW5kX3RvX3JmcCcgPT4gJ3llcycsCiAgICAgICAgICAgICAgICAnZGVsaXZlcnlfc3RhdHVzJyA9PiAncGFydGlhbC1kZWxpdmVyZWQnLAogICAgICAgICAgICAgICAgJ2FwcHJvdmVkX2lkJyA9PiAxLAogICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gMSwKICAgICAgICAgICAgICAgICdyZXF1ZXN0X3N0YXR1cycgPT4gJ3NlbmRfcmZwJywKICAgICAgICAgICAgXSk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRpdGVtcyA9IFJlcXVpc2l0aW9uSXRlbTo6d2hlcmUoWydwcm9kdWN0X2lkJz0+JHByb2R1Y3RfaWQsJ2lzX3NlbmQnPT4nbm8nXSkKICAgICAgICAgICAgLT53aGVyZUhhcygncmVxdWlzaXRpb24nLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcmVxdWlzaXRpb25JZHMpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3N0YXR1cycsIDEpLT53aGVyZUluKCdpZCcsJHJlcXVpc2l0aW9uSWRzKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5nZXQoKTsKCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5wcm9wb3NhbC5fcHJvZHVjdC13aXNlLXJlcXVpc2l0aW9uJywgY29tcGFjdCgndGl0bGUnLCdwcm9kdWN0JywgJ2l0ZW1zJywncmVxdWlzaXRpb25JZHMnKSk7CgogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFN0b3JlIGEgbmV3bHkgY3JlYXRlZCByZXNvdXJjZSBpbiBzdG9yYWdlLgogICAgICoKICAgICAqIEBwYXJhbSAgXElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0ICAkcmVxdWVzdAogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KCiAgICBwdWJsaWMgZnVuY3Rpb24gc3RvcmUoUmVxdWVzdHNcUG1zXFJlcXVlc3RQcm9wb3NhbFJlcXVlc3QgJHJlcXVlc3QpewogICAgICAgICRwcm9wb3NhbFR5cGUgPSAkcmVxdWVzdC0+aGFzKCd0eXBlJyk/J29ubGluZSc6J21hbnVhbCc7CiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnkgewoKICAgICAgICAgICAgLy9DaGVjayBmb3IgQXBwcm9waWV0ZSBTdXBwbGllcnMKICAgICAgICAgICAgJHN1cHBsaWVycyA9IFN1cHBsaWVyczo6d2l0aChbCiAgICAgICAgICAgICAgICAncHJvZHVjdHMnCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlcmVJbignaWQnLCAkcmVxdWVzdC0+c3VwcGxpZXJfaWQpCiAgICAgICAgICAgIC0+Z2V0KCk7CgogICAgICAgICAgICAkcHJvZHVjdHMgPSBQcm9kdWN0Ojp3aXRoKFsKICAgICAgICAgICAgICAgICdhdHRyaWJ1dGVzLmF0dHJpYnV0ZU9wdGlvbi5hdHRyaWJ1dGUnCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlcmVJbignaWQnLCAkcmVxdWVzdC0+cHJvZHVjdF9pZCkKICAgICAgICAgICAgLT5nZXQoKTsKCiAgICAgICAgICAgICRlcnJvcl9jb3VudCA9IDA7CiAgICAgICAgICAgICRtZXNzYWdlcyA9ICc8dWwgY2xhc3M9InBsLTAgdGV4dC13aGl0ZSI+JzsKICAgICAgICAgICAgJGFycmF5ID0gW107CiAgICAgICAgICAgIGlmKCRzdXBwbGllcnMtPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgIGZvcmVhY2goJHN1cHBsaWVycyBhcyAka2V5ID0+ICRzdXBwbGllcil7CiAgICAgICAgICAgICAgICAkYXJyYXlbJHN1cHBsaWVyLT5pZF0gPSAwOwogICAgICAgICAgICAgICAgJHN1cHBsaWVyX21lc3NhZ2VzID0gJyc7CiAgICAgICAgICAgICAgICAgICAgaWYoJHByb2R1Y3RzLT5jb3VudCgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2goJHByb2R1Y3RzIGFzICRrZXkgPT4gJHByb2R1Y3QpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHN1cHBsaWVyLT5wcm9kdWN0cy0+d2hlcmUoJ2lkJywgJHByb2R1Y3QtPmlkKS0+Y291bnQoKSA9PSAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZXJyb3JfY291bnQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXJyYXlbJHN1cHBsaWVyLT5pZF0rKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3VwcGxpZXJfbWVzc2FnZXMgLj0gJzxzdHJvbmc+Jy4kcHJvZHVjdC0+bmFtZS4nICcuZ2V0UHJvZHVjdEF0dHJpYnV0ZXNGYXN0ZXIoJHByb2R1Y3QpLic8L3N0cm9uZz4sICc7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZigkYXJyYXlbJHN1cHBsaWVyLT5pZF0gPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2VzIC49ICc8bGkgY2xhc3M9InRleHQtd2hpdGUiPjxzdHJvbmc+Jy4kc3VwcGxpZXItPm5hbWUuJyAoJy4kc3VwcGxpZXItPmNvZGUuJyk8L3N0cm9uZz4gZG9lcyBub3Qgc3VwcGx5IC0gJy4kc3VwcGxpZXJfbWVzc2FnZXMuJzwvbGk+JzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJG1lc3NhZ2VzIC49ICc8L3VsPic7CgogICAgICAgICAgICBpZigkZXJyb3JfY291bnQgPiAwKXsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICRtZXNzYWdlcwogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy9DaGVjayBmb3IgQXBwcm9waWV0ZSBTdXBwbGllcnMKCiAgICAgICAgICAgICRyZXF1ZXN0UHJvcG9zYWw9UmVxdWVzdFByb3Bvc2FsOjpjcmVhdGUoWwogICAgICAgICAgICAgICAgJ3R5cGUnPT4kcHJvcG9zYWxUeXBlLAogICAgICAgICAgICAgICAgJ3JlZmVyZW5jZV9ubyc9PiRyZXF1ZXN0LT5yZWZlcmVuY2Vfbm8sCiAgICAgICAgICAgICAgICAncmVxdWVzdF9kYXRlJz0+ZGF0ZSgnWS1tLWQnLHN0cnRvdGltZSgkcmVxdWVzdC0+cmVxdWVzdF9kYXRlKSksCiAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgZm9yZWFjaCAoJHJlcXVlc3QtPnN1cHBsaWVyX2lkIGFzICRrZXk9PiRzdXBwbGllcl9pZCl7CiAgICAgICAgICAgICAgICBpZihpc3NldCgkYXJyYXlbJHN1cHBsaWVyX2lkXSkgJiYgJGFycmF5WyRzdXBwbGllcl9pZF0gPT0gMCl7CiAgICAgICAgICAgICAgICAgICAgJHJlcXVlc3RQcm9wb3NhbERlZmluZVtdPVsKICAgICAgICAgICAgICAgICAgICAgICAgJ3JlcXVlc3RfcHJvcG9zYWxfaWQnPT4kcmVxdWVzdFByb3Bvc2FsLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ3N1cHBsaWVyX2lkJz0+JHN1cHBsaWVyX2lkLAogICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvcmVhY2ggKCRyZXF1ZXN0LT5wcm9kdWN0X2lkIGFzICRpPT4kcHJvZHVjdF9pZCl7CiAgICAgICAgICAgICAgICAkcmVxdWVzdFByb3Bvc2FsRGV0YWlsc1tdPVsKICAgICAgICAgICAgICAgICAgICAncmVxdWVzdF9wcm9wb3NhbF9pZCc9PiRyZXF1ZXN0UHJvcG9zYWwtPmlkLAogICAgICAgICAgICAgICAgICAgICdwcm9kdWN0X2lkJz0+JHByb2R1Y3RfaWQsCiAgICAgICAgICAgICAgICAgICAgJ3JlcXVlc3RfcXR5Jz0+JHJlcXVlc3QtPnJlcXVlc3RfcXR5WyRwcm9kdWN0X2lkXSwKICAgICAgICAgICAgICAgICAgICAncXR5Jz0+JHJlcXVlc3QtPnF0eVskcHJvZHVjdF9pZF0sCiAgICAgICAgICAgICAgICAgICAgJ2NyZWF0ZWRfYnknPT5cQXV0aDo6dXNlcigpLT5pZCwKICAgICAgICAgICAgICAgICAgICAnY3JlYXRlZF9hdCc9PmRhdGUoJ1ktbS1kIGg6aScpLAogICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy9Gb3IgdXBkYXRlIGNvbHVtbiAoSXNfU2VuZCkgb24gcmVxdWlzaXRpb24gaXRlbXMgdGFibGUKICAgICAgICAgICAgJHJlcXVpc2l0aW9uSWRzID0gZ2V0TWVyZ2VkUmVxdWlzaXNpb25JRChbCiAgICAgICAgICAgICAgICAnaXNfcG9fZ2VuZXJhdGUnID0+ICdubycsCiAgICAgICAgICAgICAgICAnaXNfc2VuZF90b19yZnAnID0+ICd5ZXMnLAogICAgICAgICAgICAgICAgJ2RlbGl2ZXJ5X3N0YXR1cycgPT4gJ3JmcCcsCiAgICAgICAgICAgICAgICAnYXBwcm92ZWRfaWQnID0+IDEsCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiAxLAogICAgICAgICAgICBdLFsKICAgICAgICAgICAgICAgICdpc19wb19nZW5lcmF0ZScgPT4gJ25vJywKICAgICAgICAgICAgICAgICdpc19zZW5kX3RvX3JmcCcgPT4gJ3llcycsCiAgICAgICAgICAgICAgICAnZGVsaXZlcnlfc3RhdHVzJyA9PiAncGFydGlhbC1kZWxpdmVyZWQnLAogICAgICAgICAgICAgICAgJ2FwcHJvdmVkX2lkJyA9PiAxLAogICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gMSwKICAgICAgICAgICAgICAgICdyZXF1ZXN0X3N0YXR1cycgPT4gJ3NlbmRfcmZwJywKICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAkcmVxdWlzaXRpb25JZEFycmF5ID0gYXJyYXlfdmFsdWVzKGFycmF5X3VuaXF1ZShSZXF1aXNpdGlvbkl0ZW06OndoZXJlKFsnaXNfc2VuZCc9PidubyddKQogICAgICAgICAgICAtPndoZXJlSW4oJ3Byb2R1Y3RfaWQnLCAkcmVxdWVzdC0+cHJvZHVjdF9pZCkKICAgICAgICAgICAgLT53aGVyZUhhcygncmVxdWlzaXRpb24nLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcmVxdWlzaXRpb25JZHMpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3N0YXR1cycsIDEpLT53aGVyZUluKCdpZCcsJHJlcXVpc2l0aW9uSWRzKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5wbHVjaygncmVxdWlzaXRpb25faWQnKS0+dG9BcnJheSgpKSk7CgogICAgICAgICAgICBSZXF1aXNpdGlvbkl0ZW06OndoZXJlSW4oJ3JlcXVpc2l0aW9uX2lkJywgJHJlcXVpc2l0aW9uSWRBcnJheSktPndoZXJlSW4oJ3Byb2R1Y3RfaWQnLCAkcmVxdWVzdC0+cHJvZHVjdF9pZCktPndoZXJlKCdpc19zZW5kJywnbm8nKQogICAgICAgICAgICAtPnVwZGF0ZShbJ2lzX3NlbmQnPT4neWVzJ10pOwoKICAgICAgICAgICAgaWYoaXNzZXQoJHJlcXVpc2l0aW9uSWRBcnJheVswXSkpewogICAgICAgICAgICAgICAgZm9yZWFjaCgkcmVxdWlzaXRpb25JZEFycmF5IGFzICRrZXkgPT4gJHJlcXVpc2l0aW9uX2lkKXsKICAgICAgICAgICAgICAgICAgICBSZXF1ZXN0UHJvcG9zYWxSZXF1aXNpdGlvbnM6OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICdyZXF1aXNpdGlvbl9pZCcgPT4gJHJlcXVpc2l0aW9uX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAncmVxdWVzdF9wcm9wb3NhbF9pZCcgPT4gJHJlcXVlc3RQcm9wb3NhbC0+aWQsCiAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vUmVxdWVzdCBwcm9wb3NhbCBkZWZpbmUgdG8gc3VwcGxpZXIKICAgICAgICAgICAgUmVxdWVzdFByb3Bvc2FsRGVmaW5lU3VwcGxpZXI6Omluc2VydCgkcmVxdWVzdFByb3Bvc2FsRGVmaW5lKTsKCiAgICAgICAgICAgIC8vUmVxdWVzdCBwcm9wb3NhbCBkZXRhaWxzIGluc2VydAogICAgICAgICAgICBSZXF1ZXN0UHJvcG9zYWxEZXRhaWxzOjppbnNlcnQoJHJlcXVlc3RQcm9wb3NhbERldGFpbHMpOwoKICAgICAgICAgICAgLy9SZXF1ZXN0IFByb3Bvc2FsIFRyYWNraW5nCiAgICAgICAgICAgIFJlcXVlc3RQcm9wb3NhbFRyYWNraW5nOjpTdG9yZVJlcXVlc3RQcm9wb3NhbFRyYWNraW5nKCRyZXF1ZXN0UHJvcG9zYWwtPmlkLCdSRlAnKTsKCiAgICAgICAgICAgIC8vU2VuZCBtYWlsIHRvIHN1cHBsaWVyCiAgICAgICAgICAgIC8vJHRoaXMtPm1haWxTZW5kVG9TdXBwbGllcnMoJHJlcXVlc3RQcm9wb3NhbC0+aWQsJHJlcXVlc3QtPnN1cHBsaWVyX2lkLCRwcm9wb3NhbFR5cGUpOwoKICAgICAgICAgICAgREI6OmNvbW1pdCgpOwogICAgICAgICAgICBzZXNzaW9uKCktPmZsYXNoKCdhbGVydC10eXBlJywgJ3N1Y2Nlc3MnKTsKICAgICAgICAgICAgc2Vzc2lvbigpLT5mbGFzaCgnbWVzc2FnZScsICdSZXF1ZXN0IEZvciBQcm9wb3NhbCBTdWNjZXNzZnVsbHkgQ3JlYXRlZCcpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgICAgICAgICAgXSk7CiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJHRoLT5nZXRNZXNzYWdlKCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBzdG9yZVNlcGFyYXRlKFJlcXVlc3QgJHJlcXVlc3QpewogICAgICAgICR0aGlzLT52YWxpZGF0ZSgkcmVxdWVzdCwgWwogICAgICAgICAgICAncmVxdWVzdF9kYXRlJyA9PiBbJ3JlcXVpcmVkJywgJ2RhdGUnXSwKICAgICAgICAgICAgJ3JlZmVyZW5jZV9ubycgPT4gWydyZXF1aXJlZCcsJ21heDoxNScsJ3VuaXF1ZTpyZXF1ZXN0X3Byb3Bvc2FscyddLAogICAgICAgICAgICAnc3VwcGxpZXJfaWQnID0+IFsncmVxdWlyZWQnXSwKICAgICAgICAgICAgInN1cHBsaWVyX2lkLioiICA9PiAiZXhpc3RzOnN1cHBsaWVycyxpZCIsCiAgICAgICAgICAgICJyZXF1aXNpdGlvbl9pdGVtX2lkIiAgICA9PiAicmVxdWlyZWR8bWluOjEiLAogICAgICAgIF0pOwoKICAgICAgICAkcHJvcG9zYWxUeXBlPSRyZXF1ZXN0LT5oYXMoJ3R5cGUnKT8nb25saW5lJzonbWFudWFsJzsKCiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnkgewoKICAgICAgICAgICAgLy9DaGVjayBmb3IgQXBwcm9waWV0ZSBTdXBwbGllcnMKICAgICAgICAgICAgJHN1cHBsaWVycyA9IFN1cHBsaWVyczo6d2l0aChbCiAgICAgICAgICAgICAgICAncHJvZHVjdHMnCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlcmVJbignaWQnLCAkcmVxdWVzdC0+c3VwcGxpZXJfaWQpCiAgICAgICAgICAgIC0+Z2V0KCk7CgogICAgICAgICAgICAkcmVxdWlzaXRpb25JdGVtcyA9IFJlcXVpc2l0aW9uSXRlbTo6d2l0aChbCiAgICAgICAgICAgICAgICAncHJvZHVjdC5hdHRyaWJ1dGVzLmF0dHJpYnV0ZU9wdGlvbi5hdHRyaWJ1dGUnCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlcmVJbignaWQnLCAkcmVxdWVzdC0+cmVxdWlzaXRpb25faXRlbV9pZCkKICAgICAgICAgICAgLT5nZXQoKTsKCiAgICAgICAgICAgICRlcnJvcl9jb3VudCA9IDA7CiAgICAgICAgICAgICRtZXNzYWdlcyA9ICc8dWwgY2xhc3M9InBsLTAgdGV4dC13aGl0ZSI+JzsKICAgICAgICAgICAgJGFycmF5ID0gW107CiAgICAgICAgICAgIGlmKCRzdXBwbGllcnMtPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgIGZvcmVhY2goJHN1cHBsaWVycyBhcyAka2V5ID0+ICRzdXBwbGllcil7CiAgICAgICAgICAgICAgICAkYXJyYXlbJHN1cHBsaWVyLT5pZF0gPSAwOwogICAgICAgICAgICAgICAgJHN1cHBsaWVyX21lc3NhZ2VzID0gJyc7CiAgICAgICAgICAgICAgICAgICAgaWYoJHJlcXVpc2l0aW9uSXRlbXMtPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCgkcmVxdWlzaXRpb25JdGVtcyBhcyAka2V5ID0+ICRyZXF1aXNpdGlvbkl0ZW0pewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHN1cHBsaWVyLT5wcm9kdWN0cy0+d2hlcmUoJ2lkJywgJHJlcXVpc2l0aW9uSXRlbS0+cHJvZHVjdF9pZCktPmNvdW50KCkgPT0gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGVycm9yX2NvdW50Kys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFycmF5WyRzdXBwbGllci0+aWRdKys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN1cHBsaWVyX21lc3NhZ2VzIC49ICc8c3Ryb25nPicuJHJlcXVpc2l0aW9uSXRlbS0+cHJvZHVjdC0+bmFtZS4nICcuZ2V0UHJvZHVjdEF0dHJpYnV0ZXNGYXN0ZXIoJHJlcXVpc2l0aW9uSXRlbS0+cHJvZHVjdCkuJzwvc3Ryb25nPiwgJzsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmKCRhcnJheVskc3VwcGxpZXItPmlkXSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICAkbWVzc2FnZXMgLj0gJzxsaSBjbGFzcz0idGV4dC13aGl0ZSI+PHN0cm9uZz4nLiRzdXBwbGllci0+bmFtZS4nICgnLiRzdXBwbGllci0+Y29kZS4nKTwvc3Ryb25nPiBkb2VzIG5vdCBzdXBwbHkgLSAnLiRzdXBwbGllcl9tZXNzYWdlcy4nPC9saT4nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAkbWVzc2FnZXMgLj0gJzwvdWw+JzsKCiAgICAgICAgICAgIGlmKCRlcnJvcl9jb3VudCA+IDApewogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJG1lc3NhZ2VzCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvL0NoZWNrIGZvciBBcHByb3BpZXRlIFN1cHBsaWVycwoKICAgICAgICAgICAgJHJlcXVlc3RQcm9wb3NhbCA9IFJlcXVlc3RQcm9wb3NhbDo6Y3JlYXRlKFsKICAgICAgICAgICAgICAgICd0eXBlJz0+JHByb3Bvc2FsVHlwZSwKICAgICAgICAgICAgICAgICdyZWZlcmVuY2Vfbm8nPT4kcmVxdWVzdC0+cmVmZXJlbmNlX25vLAogICAgICAgICAgICAgICAgJ3JlcXVlc3RfZGF0ZSc9PmRhdGUoJ1ktbS1kJyxzdHJ0b3RpbWUoJHJlcXVlc3QtPnJlcXVlc3RfZGF0ZSkpLAogICAgICAgICAgICBdKTsKCiAgICAgICAgICAgIGZvcmVhY2ggKCRyZXF1ZXN0LT5zdXBwbGllcl9pZCBhcyAka2V5PT4kc3VwcGxpZXJfaWQpewogICAgICAgICAgICAgICAgaWYoaXNzZXQoJGFycmF5WyRzdXBwbGllcl9pZF0pICYmICRhcnJheVskc3VwcGxpZXJfaWRdID09IDApewogICAgICAgICAgICAgICAgICAgICRyZXF1ZXN0UHJvcG9zYWxEZWZpbmVbXT1bCiAgICAgICAgICAgICAgICAgICAgICAgICdyZXF1ZXN0X3Byb3Bvc2FsX2lkJz0+JHJlcXVlc3RQcm9wb3NhbC0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdzdXBwbGllcl9pZCc9PiRzdXBwbGllcl9pZCwKICAgICAgICAgICAgICAgICAgICBdOyAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHF0eSA9IFtdOwogICAgICAgICAgICBpZihpc19hcnJheSgkcmVxdWVzdC0+cXR5KSAmJiBjb3VudCgkcmVxdWVzdC0+cXR5KSA+IDApewogICAgICAgICAgICAgICAgZm9yZWFjaCgkcmVxdWVzdC0+cXR5IGFzICRjb21iaW5lZCA9PiAkdmFsdWUpewogICAgICAgICAgICAgICAgICAgIGlmKGluX2FycmF5KGV4cGxvZGUoJyYnLCAkY29tYmluZWQpWzFdLCAkcmVxdWVzdC0+cmVxdWlzaXRpb25faXRlbV9pZCkpewogICAgICAgICAgICAgICAgICAgICAgICBpZighaXNzZXQoJHF0eVtleHBsb2RlKCcmJywgJGNvbWJpbmVkKVswXV0pKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdHlbZXhwbG9kZSgnJicsICRjb21iaW5lZClbMF1dID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkcXR5W2V4cGxvZGUoJyYnLCAkY29tYmluZWQpWzBdXSArPSBjb2xsZWN0KCR2YWx1ZSktPnN1bSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHJlcXVlc3RfcXR5ID0gW107CiAgICAgICAgICAgIGlmKGlzX2FycmF5KCRyZXF1ZXN0LT5yZXF1ZXN0X3F0eSkgJiYgY291bnQoJHJlcXVlc3QtPnJlcXVlc3RfcXR5KSA+IDApewogICAgICAgICAgICAgICAgZm9yZWFjaCgkcmVxdWVzdC0+cmVxdWVzdF9xdHkgYXMgJGNvbWJpbmVkID0+ICR2YWx1ZSl7CiAgICAgICAgICAgICAgICAgICAgaWYoaW5fYXJyYXkoZXhwbG9kZSgnJicsICRjb21iaW5lZClbMV0sICRyZXF1ZXN0LT5yZXF1aXNpdGlvbl9pdGVtX2lkKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFpc3NldCgkcmVxdWVzdF9xdHlbZXhwbG9kZSgnJicsICRjb21iaW5lZClbMF1dKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcmVxdWVzdF9xdHlbZXhwbG9kZSgnJicsICRjb21iaW5lZClbMF1dID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkcmVxdWVzdF9xdHlbZXhwbG9kZSgnJicsICRjb21iaW5lZClbMF1dICs9IGNvbGxlY3QoJHZhbHVlKS0+c3VtKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgoKICAgICAgICAgICAgaWYoaXNfYXJyYXkoJHF0eSkgJiYgY291bnQoJHF0eSkgPiAwKXsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRxdHkgYXMgJHByb2R1Y3RfaWQgPT4gJHZhbHVlKXsKICAgICAgICAgICAgICAgICAgICAkcmVxdWVzdFByb3Bvc2FsRGV0YWlsc1tdPVsKICAgICAgICAgICAgICAgICAgICAgICAgJ3JlcXVlc3RfcHJvcG9zYWxfaWQnID0+ICRyZXF1ZXN0UHJvcG9zYWwtPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAncHJvZHVjdF9pZCcgPT4gJHByb2R1Y3RfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdyZXF1ZXN0X3F0eScgPT4gJHJlcXVlc3RfcXR5WyRwcm9kdWN0X2lkXSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3F0eScgPT4gJHF0eVskcHJvZHVjdF9pZF0sCiAgICAgICAgICAgICAgICAgICAgICAgICdjcmVhdGVkX2J5JyA9PiBcQXV0aDo6dXNlcigpLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2NyZWF0ZWRfYXQnID0+IGRhdGUoJ1ktbS1kIGg6aScpLAogICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRyZXF1aXNpdGlvbklkQXJyYXkgPSBhcnJheV92YWx1ZXMoYXJyYXlfdW5pcXVlKFJlcXVpc2l0aW9uSXRlbTo6d2hlcmUoWydpc19zZW5kJz0+J25vJ10pCiAgICAgICAgICAgIC0+d2hlcmVJbignaWQnLCAkcmVxdWVzdC0+cmVxdWlzaXRpb25faXRlbV9pZCkKICAgICAgICAgICAgLT5wbHVjaygncmVxdWlzaXRpb25faWQnKS0+dG9BcnJheSgpKSk7CgogICAgICAgICAgICAvKlVwZGF0ZSByZXF1aXNpdGlvbiBpdGVtcyBzdGF0dXMgaXNTZW5kPSB5ZXMqLwoKICAgICAgICAgICAgUmVxdWlzaXRpb25JdGVtOjp3aGVyZUluKCdpZCcsICRyZXF1ZXN0LT5yZXF1aXNpdGlvbl9pdGVtX2lkKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2lzX3NlbmQnLCdubycpCiAgICAgICAgICAgICAgICAgICAgLT51cGRhdGUoWydpc19zZW5kJz0+J3llcyddKTsKCiAgICAgICAgICAgIGlmKGlzc2V0KCRyZXF1aXNpdGlvbklkQXJyYXlbMF0pKXsKICAgICAgICAgICAgICAgIGZvcmVhY2goJHJlcXVpc2l0aW9uSWRBcnJheSBhcyAka2V5ID0+ICRyZXF1aXNpdGlvbl9pZCl7CiAgICAgICAgICAgICAgICAgICAgUmVxdWVzdFByb3Bvc2FsUmVxdWlzaXRpb25zOjpjcmVhdGUoWwogICAgICAgICAgICAgICAgICAgICAgICAncmVxdWlzaXRpb25faWQnID0+ICRyZXF1aXNpdGlvbl9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ3JlcXVlc3RfcHJvcG9zYWxfaWQnID0+ICRyZXF1ZXN0UHJvcG9zYWwtPmlkLAogICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvL0luc2VydCByZXF1ZXN0IHN1cHBsaWVyCiAgICAgICAgICAgIFJlcXVlc3RQcm9wb3NhbERlZmluZVN1cHBsaWVyOjppbnNlcnQoJHJlcXVlc3RQcm9wb3NhbERlZmluZSk7CiAgICAgICAgICAgIC8vSW5zZXJ0IHByb3Bvc2FsIGRldGFpbHMKICAgICAgICAgICAgUmVxdWVzdFByb3Bvc2FsRGV0YWlsczo6aW5zZXJ0KCRyZXF1ZXN0UHJvcG9zYWxEZXRhaWxzKTsKICAgICAgICAgICAgLy9SZXF1ZXN0IFByb3Bvc2FsIFRyYWNraW5nCiAgICAgICAgICAgIFJlcXVlc3RQcm9wb3NhbFRyYWNraW5nOjpTdG9yZVJlcXVlc3RQcm9wb3NhbFRyYWNraW5nKCRyZXF1ZXN0UHJvcG9zYWwtPmlkLCdSRlAnKTsKICAgICAgICAgICAgLy9NYWlsIHNlbmQgdG8gc3VwcGxpZXIKCiAgICAgICAgICAgIC8vJHRoaXMtPm1haWxTZW5kVG9TdXBwbGllcnMoJHJlcXVlc3RQcm9wb3NhbC0+aWQsJHJlcXVlc3QtPnN1cHBsaWVyX2lkLCRwcm9wb3NhbFR5cGUpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy9EQiBDb21taXQKICAgICAgICAgICAgREI6OmNvbW1pdCgpOwoKICAgICAgICAgICAgc2Vzc2lvbigpLT5mbGFzaCgnYWxlcnQtdHlwZScsICdzdWNjZXNzJyk7CiAgICAgICAgICAgIHNlc3Npb24oKS0+Zmxhc2goJ21lc3NhZ2UnLCAnUmVxdWVzdCBGb3IgUHJvcG9zYWwgU3VjY2Vzc2Z1bGx5IENyZWF0ZWQnKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICAgICAgICAgIF0pOwogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KICAgIH0KCgogICAgcHVibGljIGZ1bmN0aW9uIG1haWxTZW5kVG9TdXBwbGllcnMoJHJlcXVlc3RQcm9wb3NhbElkLCRzdXBwbGllcklkcywkcHJvcG9zYWxUeXBlPW51bGwpewoKICAgICAgICAkc3VwcGxpZXJzID0gIFN1cHBsaWVyczo6d2hlcmUoJ3N0YXR1cycsICdBY3RpdmUnKS0+d2hlcmVJbignaWQnLCRzdXBwbGllcklkcyktPmdldCgpOwoKICAgICAgICBmb3JlYWNoICgkc3VwcGxpZXJzIGFzICRrZXk9PiRzdXBwbGllcil7CgogICAgICAgICAgICAkcmVxdWVzdFByb3Bvc2FsPVJlcXVlc3RQcm9wb3NhbDo6d2l0aCgnZGVmaW5lVG9TdXBwbGllcicsJ3JlcXVlc3RQcm9wb3NhbERldGFpbHMnLCdyZXF1ZXN0UHJvcG9zYWxEZXRhaWxzLnByb2R1Y3QnKQogICAgICAgICAgICAtPndoZXJlSGFzKCdkZWZpbmVUb1N1cHBsaWVyJyxmdW5jdGlvbiAoJHF1ZXJ5KXVzZSAoJHN1cHBsaWVyKSB7CiAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZXF1ZXN0X3Byb3Bvc2FsX2RlZmluZV9zdXBwbGllcnMuc3VwcGxpZXJfaWQnLCRzdXBwbGllci0+aWQpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPmZpbmQoJHJlcXVlc3RQcm9wb3NhbElkKTsKCiAgICAgICAgICAgICRkYXRhWyJlbWFpbCJdID0gJHN1cHBsaWVyLT5lbWFpbDsKICAgICAgICAgICAgJGRhdGFbInRpdGxlIl0gPSAiUmVxdWVzdCBGb3IgUHJvcG9zYWwgRnJvbSBNQk0iOwogICAgICAgICAgICAkZGF0YVsicmVmZXJlbmNlX25vIl0gPSAkcmVxdWVzdFByb3Bvc2FsLT5yZWZlcmVuY2Vfbm87CiAgICAgICAgICAgICRkYXRhWyJyZXF1ZXN0UHJvcG9zYWwiXSA9ICRyZXF1ZXN0UHJvcG9zYWw7CiAgICAgICAgICAgICRkYXRhWyJzdXBwbGllciJdID0gJHN1cHBsaWVyOwogICAgICAgICAgICAkZGF0YVsicHJvcG9zYWxUeXBlIl0gPSAkcHJvcG9zYWxUeXBlOwogICAgICAgICAgICAkZGF0YVsiY3VycmVudF91cmwiXSA9IFVSTDo6dG8oJy8nKTsKCiAgICAgICAgICAgICRwZGYgPSBQREY6OmxvYWRWaWV3KCdwbXMuYmFja2VuZC5tYWlsLnJlcXVlc3QtcHJvcG9zYWwtbWFpbCcsICRkYXRhKS0+c2V0T3B0aW9ucyhbJ2RlZmF1bHRGb250JyA9PiAnc2Fucy1zZXJpZiddKTsKCiAgICAgICAgICAgIE1haWw6OnNlbmQoJ3Btcy5iYWNrZW5kLm1haWwucmZwX21haWxfYm9keScsICRkYXRhLCBmdW5jdGlvbiAoJG1lc3NhZ2UpIHVzZSAoJGRhdGEsICRwZGYpIHsKICAgICAgICAgICAgICAgICRtZXNzYWdlLT50bygkZGF0YVsiZW1haWwiXSwgJGRhdGFbImVtYWlsIl0pCiAgICAgICAgICAgICAgICAtPnN1YmplY3QoJGRhdGFbInRpdGxlIl0pCiAgICAgICAgICAgICAgICAtPmF0dGFjaERhdGEoJHBkZi0+b3V0cHV0KCksICRkYXRhWyJyZWZlcmVuY2Vfbm8iXS4iLnBkZiIpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRGlzcGxheSB0aGUgc3BlY2lmaWVkIHJlc291cmNlLgogICAgICoKICAgICAqIEBwYXJhbSAgXEFwcFxNb2RlbHNcUmVxdWVzdFByb3Bvc2FsICAkcmVxdWVzdFByb3Bvc2FsCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNob3coJGlkKQogICAgewogICAgICAgICR0aXRsZT0nUmVxdWVzdCBQcm9wb3NhbCBEZXRhaWxzJzsKICAgICAgICAkcmVxdWVzdFByb3Bvc2FsID0gUmVxdWVzdFByb3Bvc2FsOjp3aXRoKFsKICAgICAgICAgICAgJ2RlZmluZVRvU3VwcGxpZXIuc3VwcGxpZXInLAogICAgICAgICAgICAncmVxdWVzdFByb3Bvc2FsRGV0YWlscy5wcm9kdWN0LmNhdGVnb3J5LmNhdGVnb3J5JywKICAgICAgICAgICAgJ3JlcXVlc3RQcm9wb3NhbERldGFpbHMucHJvZHVjdC5wcm9kdWN0VW5pdCcsCiAgICAgICAgICAgICdyZXF1ZXN0UHJvcG9zYWxEZXRhaWxzLnByb2R1Y3QuYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJywKICAgICAgICAgICAgJ2NyZWF0ZWRCeScKICAgICAgICBdKS0+ZmluZE9yRmFpbCgkaWQpOwogICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5yZnAucmVxdWVzdC1wcm9wb3NhbC1kZXRhaWxzJywgY29tcGFjdCgndGl0bGUnLCdyZXF1ZXN0UHJvcG9zYWwnKSk7CiAgICB9CgoKICAgIC8qKgogICAgKiBTaG93IHRoZSBmb3JtIGZvciBjcmVhdGluZyBhIG5ldyByZXNvdXJjZS4KICAgICoKICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNlbmRUb1B1cmNoYXNlKCRyZXFfaWQpCiAgICB7CiAgICAgICAgJHJlcSA9IFJlcXVpc2l0aW9uOjpmaW5kKCRyZXFfaWQpOwogICAgICAgICR0aXRsZSA9ICdFc3RpbWF0ZSBQcmVwYXJ0aW9uJzsKICAgICAgICAkcHJlZml4ID0gJ1JQLScuZGF0ZSgneScsIHN0cnRvdGltZShkYXRlKCdZLW0tZCcpKSkuJy0nLiRyZXEtPnJlbFVzZXJzTGlzdC0+ZW1wbG95ZWUtPnVuaXQtPmhyX3VuaXRfc2hvcnRfbmFtZS4nLSc7CiAgICAgICAgJHJlZk5vID0gdW5pcXVlQ29kZSgxNCwkcHJlZml4LCdyZXF1ZXN0X3Byb3Bvc2FscycsJ2lkJyk7CgogICAgICAgIHRyeSB7CgogICAgICAgICAgICAkcmVxdWlzaXRpb25JZHMgPSBnZXRNZXJnZWRSZXF1aXNpc2lvbklEKFsKICAgICAgICAgICAgICAgICdpc19wb19nZW5lcmF0ZScgPT4gJ25vJywKICAgICAgICAgICAgICAgICdpc19zZW5kX3RvX3JmcCcgPT4gJ3llcycsCiAgICAgICAgICAgICAgICAnZGVsaXZlcnlfc3RhdHVzJyA9PiAncHJvY2Vzc2luZycsCiAgICAgICAgICAgICAgICAnYXBwcm92ZWRfaWQnID0+IDEsCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiAxLAogICAgICAgICAgICBdLFsKICAgICAgICAgICAgICAgICdpc19wb19nZW5lcmF0ZScgPT4gJ25vJywKICAgICAgICAgICAgICAgICdpc19zZW5kX3RvX3JmcCcgPT4gJ3llcycsCiAgICAgICAgICAgICAgICAnZGVsaXZlcnlfc3RhdHVzJyA9PiAncGFydGlhbC1kZWxpdmVyZWQnLAogICAgICAgICAgICAgICAgJ2FwcHJvdmVkX2lkJyA9PiAxLAogICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gMSwKICAgICAgICAgICAgICAgICdyZXF1ZXN0X3N0YXR1cycgPT4gJ3JmcCcsCiAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgJHJlcXVpc2l0aW9uID0gUmVxdWlzaXRpb25JdGVtOjp3aXRoKFsKICAgICAgICAgICAgICAgICdyZXF1aXNpdGlvbicsCiAgICAgICAgICAgICAgICAncHJvZHVjdC5wcm9kdWN0VW5pdCcsCiAgICAgICAgICAgICAgICAncHJvZHVjdC5hdHRyaWJ1dGVzLmF0dHJpYnV0ZU9wdGlvbi5hdHRyaWJ1dGUnCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlcXVpc2l0aW9uJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHJlcXVpc2l0aW9uSWRzKXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2lkJywkcmVxdWlzaXRpb25JZHMpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlKCdpc19zZW5kJywnbm8nKQogICAgICAgICAgICAtPndoZXJlKCdwb19nZW5lcmF0ZScsJ25vJykKICAgICAgICAgICAgLT53aGVyZSgncmVxdWlzaXRpb25faWQnLCRyZXFfaWQpCiAgICAgICAgICAgIC0+Z2V0KCk7CgogICAgICAgICAgICAkZ2V0UHJvZHVjdElkcz1bXTsKICAgICAgICAgICAgZm9yZWFjaCgkcmVxdWlzaXRpb24gYXMgJGRhdGEpewogICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkZ2V0UHJvZHVjdElkcywkZGF0YS0+cHJvZHVjdF9pZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRzZWxlY3RTdXBwbGllcklkcz1EQjo6dGFibGUoJ3Byb2R1Y3RzX3N1cHBsaWVyJykKICAgICAgICAgICAgLT53aGVyZUluKCdwcm9kdWN0X2lkJywkZ2V0UHJvZHVjdElkcykKICAgICAgICAgICAgLT5ncm91cEJ5KCdzdXBwbGllcl9pZCcpCiAgICAgICAgICAgIC0+Z2V0KFsnc3VwcGxpZXJfaWQnXSk7CgogICAgICAgICAgICAkZ2V0U3VwcGxpZXJJZHM9W107CiAgICAgICAgICAgIGZvcmVhY2goJHNlbGVjdFN1cHBsaWVySWRzIGFzICRkYXRhKXsKICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGdldFN1cHBsaWVySWRzLCRkYXRhLT5zdXBwbGllcl9pZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRzdXBwbGllckxpc3QgPSBTdXBwbGllcnM6OndoZXJlKCdzdGF0dXMnLCAnQWN0aXZlJyktPndoZXJlSW4oJ2lkJywkZ2V0U3VwcGxpZXJJZHMpLT5wbHVjaygnbmFtZScsJ2lkJyktPmFsbCgpOwoKICAgICAgICAgICAgJGN1cnJlbmN5VHlwZXMgPSBDdXJyZW5jeVR5cGU6OndpdGgoWydjdXJyZW5jaWVzJ10pLT5nZXQoKTsKICAgICAgICAgICAgJHN1cHBsaWVyID0gU3VwcGxpZXJzOjp3aGVyZSgnZGVsZXRhYmxlJywgJ25vJyktPmZpcnN0KCk7CgogICAgICAgICAgICBpZiAoJHJlcXVpc2l0aW9uLT5jb3VudCgpID4gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnN0b3JlLnN0b3JlLWludmVudG9yeS1wdXJjaGFzZScsIGNvbXBhY3QoJ3RpdGxlJywncmVxdWlzaXRpb24nLCdyZXFfaWQnLCdzdXBwbGllckxpc3QnLCdyZWZObycsJ3JlcXVpc2l0aW9uSWRzJywgJ2N1cnJlbmN5VHlwZXMnLCAnc3VwcGxpZXInKSk7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCdBbHJlYWR5IHB1cmNoYXNlIHRoaXMgcmVxdWlzaXRpb24uJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CgogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICogU2hvdyB0aGUgZm9ybSBmb3IgY3JlYXRpbmcgYSBuZXcgcmVzb3VyY2UuCiAgICAqCiAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZW5kVG9QdXJjaGFzZVN1Ym1pdChSZXF1ZXN0ICRyZXF1ZXN0KXsgIAogICAgICAgICR0aGlzLT52YWxpZGF0ZSgkcmVxdWVzdCwgWwogICAgICAgICAgICAncmVxdWVzdF9kYXRlJyA9PiBbJ3JlcXVpcmVkJywgJ2RhdGUnXSwKICAgICAgICAgICAgJ3JlZmVyZW5jZV9ubycgPT4gWydyZXF1aXJlZCcsJ21heDoxNScsJ3VuaXF1ZTpyZXF1ZXN0X3Byb3Bvc2FscyddLAogICAgICAgICAgICAnc3VwcGxpZXJfaWQnID0+IFsncmVxdWlyZWQnXSwKICAgICAgICAgICAgInN1cHBsaWVyX2lkLioiICA9PiAiZXhpc3RzOnN1cHBsaWVycyxpZCIsCiAgICAgICAgICAgICJwcm9kdWN0X2lkIiAgICA9PiAicmVxdWlyZWR8bWluOjEiLAogICAgICAgIF0pOwoKICAgIAogICAgICAgIC8vIFRyYW5zYWN0aW9uIFN0YXJ0IEhlcmUKICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vdXBkYXRlIHJlcXVpc3Rpb24gaWQKICAgICAgICAgICAgJHJlcXVpc2l0aW9uID0gUmVxdWlzaXRpb246OndoZXJlKFsnaWQnPT4kcmVxdWVzdC0+cmVxdWlzaXRpb25faWQsJ3N0YXR1cyc9PjEsJ2FwcHJvdmVkX2lkJz0+MSwnaXNfc2VuZF90b19yZnAnPT4neWVzJywnZGVsaXZlcnlfc3RhdHVzJz0+J3Byb2Nlc3NpbmcnXSkKICAgICAgICAgICAgLT51cGRhdGUoWydkZWxpdmVyeV9zdGF0dXMnPT4ncmZwJywndXBkYXRlZF9ieSc9PlxBdXRoOjp1c2VyKCktPmlkLAogICAgICAgICAgICAgICAgJ3VwZGF0ZWRfYXQnPT5kYXRlKCdZLW0tZCBoOmknKV0pOwoKICAgICAgICAgICAgJHJlcXVpc2l0aW9uID0gUmVxdWlzaXRpb246OmZpbmQoJHJlcXVlc3QtPnJlcXVpc2l0aW9uX2lkKTsKCiAgICAgICAgICAgICRyZXF1ZXN0UHJvcG9zYWwgPSBSZXF1ZXN0UHJvcG9zYWw6OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAndHlwZScgPT4gJ2RpcmVjdC1wdXJjaGFzZScsCiAgICAgICAgICAgICAgICAncmVmZXJlbmNlX25vJz0+JHJlcXVlc3QtPnJlZmVyZW5jZV9ubywKICAgICAgICAgICAgICAgICdyZXF1ZXN0X2RhdGUnPT5kYXRlKCdZLW0tZCcsc3RydG90aW1lKCRyZXF1ZXN0LT5yZXF1ZXN0X2RhdGUpKSwKICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAvL0dlbmVyYXRlIFF1b3RhdGlvbgogICAgICAgICAgICAkcHJlZml4PSdFU1QtJy5kYXRlKCd5Jywgc3RydG90aW1lKGRhdGUoJ1ktbS1kJykpKS4nLScuJHJlcXVpc2l0aW9uLT5yZWxVc2Vyc0xpc3QtPmVtcGxveWVlLT51bml0LT5ocl91bml0X3Nob3J0X25hbWUuJy0nOwogICAgICAgICAgICAkcmVmTm89dW5pcXVlQ29kZSgxNSwkcHJlZml4LCdxdW90YXRpb25zJywnaWQnKTsKCiAgICAgICAgICAgICRxdW90YXRpb25GaWxlUGF0aD0nJzsKICAgICAgICAgICAgaWYgKCRyZXF1ZXN0LT5oYXNGaWxlKCdxdW90YXRpb25fZmlsZScpKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkcXVvdGF0aW9uRmlsZVBhdGg9JHRoaXMtPmZpbGVVcGxvYWQoJHJlcXVlc3QtPmZpbGUoJ3F1b3RhdGlvbl9maWxlJyksJ3VwbG9hZC9xdW90YXRpb24vcGRmLWZpbGUnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHF1b3RhdGlvbj1RdW90YXRpb25zOjpjcmVhdGUoWwogICAgICAgICAgICAgICAgJ3N1cHBsaWVyX2lkJz0+JHJlcXVlc3QtPnN1cHBsaWVyX2lkLAogICAgICAgICAgICAgICAgJ3JlcXVlc3RfcHJvcG9zYWxfaWQnPT4kcmVxdWVzdFByb3Bvc2FsLT5pZCwKICAgICAgICAgICAgICAgICdyZWZlcmVuY2Vfbm8nPT4kcmVmTm8sCiAgICAgICAgICAgICAgICAncXVvdGF0aW9uX2RhdGUnPT5kYXRlKCdZLW0tZCcsc3RydG90aW1lKCRyZXF1ZXN0LT5yZXF1ZXN0X2RhdGUpKSwKICAgICAgICAgICAgICAgICd0b3RhbF9wcmljZSc9PiRyZXF1ZXN0LT5zdW1fb2Zfc3VidG9hbCwKICAgICAgICAgICAgICAgICdkaXNjb3VudCc9PiRyZXF1ZXN0LT5kaXNjb3VudD09bnVsbD8wOiRyZXF1ZXN0LT5kaXNjb3VudCwKICAgICAgICAgICAgICAgICd2YXQnPT4kcmVxdWVzdC0+dmF0PT1udWxsPzA6JHJlcXVlc3QtPnZhdCwKICAgICAgICAgICAgICAgICdncm9zc19wcmljZSc9PiRyZXF1ZXN0LT5ncm9zc19wcmljZSwKICAgICAgICAgICAgICAgICdzdGF0dXMnPT4nYWN0aXZlJywKICAgICAgICAgICAgICAgICd0eXBlJz0+J2RpcmVjdC1wdXJjaGFzZScsCiAgICAgICAgICAgICAgICAnZGVsaXZlcnlfZGF0ZScgPT4gaXNzZXQoJHJlcXVlc3QtPmRlbGl2ZXJ5X2RhdGUpID8gJHJlcXVlc3QtPmRlbGl2ZXJ5X2RhdGUgOiBkYXRlKCdZLW0tZCcpLAogICAgICAgICAgICAgICAgJ2lzX2FwcHJvdmVkJz0+IChhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnUHVyY2hhc2UtRW1wbG95ZWUnKSA/ICdwcmUtcHJvY2Vzc2luZycgOiAncHJvY2Vzc2luZycpLAogICAgICAgICAgICAgICAgJ3N1cHBsaWVyX3BheW1lbnRfdGVybXNfaWQnPT4kcmVxdWVzdC0+c3VwcGxpZXJfcGF5bWVudF90ZXJtc19pZCwKICAgICAgICAgICAgICAgICdxdW90YXRpb25fZmlsZSc9PiRxdW90YXRpb25GaWxlUGF0aAogICAgICAgICAgICBdKTsKCiAgICAgICAgICAgIGZvcmVhY2ggKCRyZXF1ZXN0LT5wcm9kdWN0X2lkIGFzICRpPT4kcHJvZHVjdF9pZCl7CiAgICAgICAgICAgICAgICAkcXVvdGF0aW9uSXRlbXNJbnB1dFtdPVsKICAgICAgICAgICAgICAgICAgICAncXVvdGF0aW9uX2lkJz0+JHF1b3RhdGlvbi0+aWQsCiAgICAgICAgICAgICAgICAgICAgJ3Byb2R1Y3RfaWQnPT4kcHJvZHVjdF9pZCwKICAgICAgICAgICAgICAgICAgICAndW5pdF9wcmljZSc9PiRyZXF1ZXN0LT51bml0X3ByaWNlWyRwcm9kdWN0X2lkXSwKICAgICAgICAgICAgICAgICAgICAncXR5Jz0+JHJlcXVlc3QtPnF0eVskcHJvZHVjdF9pZF0sCiAgICAgICAgICAgICAgICAgICAgJ3N1Yl90b3RhbF9wcmljZSc9PiRyZXF1ZXN0LT5zdWJfdG90YWxfcHJpY2VbJHByb2R1Y3RfaWRdLAogICAgICAgICAgICAgICAgICAgICdkaXNjb3VudCc9PiRyZXF1ZXN0LT5pdGVtX2Rpc2NvdW50X3BlcmNlbnRbJHByb2R1Y3RfaWRdLAogICAgICAgICAgICAgICAgICAgICdkaXNjb3VudF9hbW91bnQnPT4kcmVxdWVzdC0+aXRlbV9kaXNjb3VudF9hbW91bnRbJHByb2R1Y3RfaWRdLAogICAgICAgICAgICAgICAgICAgICd2YXRfcGVyY2VudGFnZSc9PiRyZXF1ZXN0LT5wcm9kdWN0X3ZhdFskcHJvZHVjdF9pZF0sCiAgICAgICAgICAgICAgICAgICAgJ3ZhdCc9PiRyZXF1ZXN0LT5zdWJfdG90YWxfdmF0X3ByaWNlWyRwcm9kdWN0X2lkXSwKICAgICAgICAgICAgICAgICAgICAndG90YWxfcHJpY2UnPT4oJHJlcXVlc3QtPnN1Yl90b3RhbF9wcmljZVskcHJvZHVjdF9pZF0tJHJlcXVlc3QtPml0ZW1fZGlzY291bnRfYW1vdW50WyRwcm9kdWN0X2lkXSkrJHJlcXVlc3QtPnN1Yl90b3RhbF92YXRfcHJpY2VbJHByb2R1Y3RfaWRdLAogICAgICAgICAgICAgICAgICAgICdjcmVhdGVkX2F0Jz0+ZGF0ZSgnWS1tLWQgaDppJyksCiAgICAgICAgICAgICAgICBdOwoKICAgICAgICAgICAgICAgICRyZXF1ZXN0UHJvcG9zYWxEZXRhaWxzSW5wdXRbXT1bCiAgICAgICAgICAgICAgICAgICAgJ3JlcXVlc3RfcHJvcG9zYWxfaWQnPT4kcmVxdWVzdFByb3Bvc2FsLT5pZCwKICAgICAgICAgICAgICAgICAgICAncHJvZHVjdF9pZCc9PiRwcm9kdWN0X2lkLAogICAgICAgICAgICAgICAgICAgICdyZXF1ZXN0X3F0eSc9PiRyZXF1ZXN0LT5yZXF1ZXN0X3F0eVskcHJvZHVjdF9pZF0sCiAgICAgICAgICAgICAgICAgICAgJ3F0eSc9PiRyZXF1ZXN0LT5xdHlbJHByb2R1Y3RfaWRdLAogICAgICAgICAgICAgICAgICAgICdjcmVhdGVkX2J5Jz0+XEF1dGg6OnVzZXIoKS0+aWQsCiAgICAgICAgICAgICAgICAgICAgJ2NyZWF0ZWRfYXQnPT5kYXRlKCdZLW0tZCBoOmknKSwKICAgICAgICAgICAgICAgIF07CgogICAgICAgICAgICAgICAgUmVxdWlzaXRpb25JdGVtOjp3aGVyZShbCiAgICAgICAgICAgICAgICAgICAgJ3JlcXVpc2l0aW9uX2lkJyA9PiAkcmVxdWVzdC0+cmVxdWlzaXRpb25faWQsCiAgICAgICAgICAgICAgICAgICAgJ3Byb2R1Y3RfaWQnID0+ICRwcm9kdWN0X2lkCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT51cGRhdGUoWwogICAgICAgICAgICAgICAgICAgICdwdXJjaGFzZV9xdHknID0+ICRyZXF1ZXN0LT5xdHlbJHByb2R1Y3RfaWRdCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy9Gb3IgdXBkYXRlIGNvbHVtbiAoSXNfU2VuZCkgb24gcmVxdWlzaXRpb24gaXRlbXMgdGFibGUgCiAgICAgICAgICAgIFJlcXVpc2l0aW9uSXRlbTo6d2hlcmUoJ3JlcXVpc2l0aW9uX2lkJywkcmVxdWVzdC0+cmVxdWlzaXRpb25faWQpLT53aGVyZUluKCdwcm9kdWN0X2lkJywkcmVxdWVzdC0+cHJvZHVjdF9pZCktPndoZXJlKCdpc19zZW5kJywnbm8nKS0+dXBkYXRlKFsnaXNfc2VuZCc9Pid5ZXMnXSk7CgogICAgICAgICAgICBSZXF1ZXN0UHJvcG9zYWxSZXF1aXNpdGlvbnM6OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAncmVxdWlzaXRpb25faWQnID0+ICRyZXF1ZXN0LT5yZXF1aXNpdGlvbl9pZCwKICAgICAgICAgICAgICAgICdyZXF1ZXN0X3Byb3Bvc2FsX2lkJyA9PiAkcmVxdWVzdFByb3Bvc2FsLT5pZCwKICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBSZXF1ZXN0UHJvcG9zYWxEZWZpbmVTdXBwbGllcjo6aW5zZXJ0KFsKICAgICAgICAgICAgICAgICdyZXF1ZXN0X3Byb3Bvc2FsX2lkJz0+JHJlcXVlc3RQcm9wb3NhbC0+aWQsCiAgICAgICAgICAgICAgICAnc3VwcGxpZXJfaWQnPT4kcmVxdWVzdC0+c3VwcGxpZXJfaWQsCiAgICAgICAgICAgIF0pOwogICAgICAgICAgICAvL0FkZCByZXF1ZXN0IHByb3Bvc2FsIGRldGFpbHMgZGF0YQogICAgICAgICAgICBSZXF1ZXN0UHJvcG9zYWxEZXRhaWxzOjppbnNlcnQoJHJlcXVlc3RQcm9wb3NhbERldGFpbHNJbnB1dCk7CiAgICAgICAgICAgIC8vQWRkIHF1b3RhdGlvbiBpdGVtcyBkYXRhCiAgICAgICAgICAgIFF1b3RhdGlvbnNJdGVtczo6aW5zZXJ0KCRxdW90YXRpb25JdGVtc0lucHV0KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vTm90aWZpY2F0aW9uCiAgICAgICAgICAgIGlmKGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdQdXJjaGFzZS1FbXBsb3llZScpKXsKICAgICAgICAgICAgICAgICRtZXNzYWdlPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgZGF0YS1zcmM9Iicucm91dGUoJ3Btcy5xdW90YXRpb24ucXVvdGF0aW9ucy5jcy5wcm9wb3NhbC5kZXRhaWxzJywkcmVxdWVzdFByb3Bvc2FsLT5pZCkuJyIgZGF0YS10dGlsZT0iUmVxdWVzdCBQcm9wb3NhbCBEZXRhaWxzIj5SZWZlcmVuY2UgTm86Jy4kcmVxdWVzdFByb3Bvc2FsLT5yZWZlcmVuY2Vfbm8uJy5XYXR0aW5nIGZvciBwdXJjaGFzZSBhcHByb3ZhbC48L3NwYW4+JzsKCiAgICAgICAgICAgICAgICBDcmVhdGVPclVwZGF0ZU5vdGlmaWNhdGlvbignJyxnZXRNYW5hZ2VySW5mbygnUHVyY2hhc2UtRGVwYXJ0bWVudCcpLCAkbWVzc2FnZSwndW5yZWFkJywnc2VuZC10by1wdXJjaGFzZS1kZXBhcnRtZW50JywnJyk7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgJG1lc3NhZ2U9ICc8c3BhbiBjbGFzcz0ibm90aWZpY2F0aW9uLWxpbmtzIiBkYXRhLXNyYz0iJy5yb3V0ZSgncG1zLnF1b3RhdGlvbi5xdW90YXRpb25zLmNzLnByb3Bvc2FsLmRldGFpbHMnLCRyZXF1ZXN0UHJvcG9zYWwtPmlkKS4nIiBkYXRhLXR0aWxlPSJSZXF1ZXN0IFByb3Bvc2FsIERldGFpbHMiPlJlZmVyZW5jZSBObzonLiRyZXF1ZXN0UHJvcG9zYWwtPnJlZmVyZW5jZV9uby4nLldhdHRpbmcgZm9yIE1hbmFnZW1lbnQgYXBwcm92YWwuPC9zcGFuPic7CgogICAgICAgICAgICAgICAgQ3JlYXRlT3JVcGRhdGVOb3RpZmljYXRpb24oJycsZ2V0TWFuYWdlckluZm8oJ01hbmFnZW1lbnQnKSwgJG1lc3NhZ2UsJ3VucmVhZCcsJ3NlbmQtdG8tbWFuYWdlcicsJycpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBEQjo6Y29tbWl0KCk7CgogICAgICAgICAgICByZXR1cm4gJHRoaXMtPnJlZGlyZWN0QmFja1dpdGhTdWNjZXNzKCdTdWNjZXNzZnVsbHkgc2VuZCB0byBwdXJjaGFzZSBkZXBhcnRtZW50ISEnLCdwbXMuZXN0aW1hdGUuaW5kZXgnKTsKCiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIC8vSWYgdGhlcmUgYXJlIGFueSBleGNlcHRpb25zLCByb2xsYmFjayB0aGUgdHJhbnNhY3Rpb25gCiAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYmFjaygpOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRTdXBwbGllclBheW1lbnRUZXJtcyhSZXF1ZXN0ICRyZXF1ZXN0LCAkaWQpCiAgICB7CiAgICAgICAgICRzdXBwbGllclBheW1lbnRUZXJtcyA9IFN1cHBsaWVyUGF5bWVudFRlcm06OndoZXJlKCdzdXBwbGllcl9pZCcsICRpZCktPmdldCgpOwogICAgICAgICAkZGF0YSA9ICcnOwogICAgICAgICBpZihpc3NldCgkc3VwcGxpZXJQYXltZW50VGVybXNbMF0pKXsKICAgICAgICAgICAgJGRhdGEgLj0nPG9wdGlvbiB2YWx1ZT0iIj4tLVNlbGVjdCBPbmUtLTwvb3B0aW9uPic7CiAgICAgICAgICAgIGZvcmVhY2goJHN1cHBsaWVyUGF5bWVudFRlcm1zIGFzICRrZXkgPT4gJHBheW1lbnRUZXJtcyl7CiAgICAgICAgICAgICAgICAkZGF0YSAuPSc8b3B0aW9uIHZhbHVlPSInLiRwYXltZW50VGVybXMtPmlkLiciPicuJHBheW1lbnRUZXJtcy0+cmVsUGF5bWVudFRlcm0tPnRlcm0uJzwvb3B0aW9uPic7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiAkZGF0YTsKICAgIH0KCiAgICAvKioKICAgICogQ29tcGxldGUgcXVvdGF0aW9uIGdlbmVyYXRlLgogICAgKgogICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICovCgogICAgcHVibGljIGZ1bmN0aW9uIHJmcFF1b3RhdGlvbmdlbmVyYXRlQ29tcGxldGUoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkcmVzcG9uc2U9W107CiAgICAgICAgJGRhdGE9UmVxdWVzdFByb3Bvc2FsOjp3aGVyZSgnaWQnLCRyZXF1ZXN0LT5yZXFfcHJvcG9zYWxfaWQpLT5maXJzdCgpOwogICAgICAgIC8vU3RhcnQgdHJhbnNhY3Rpb24KICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmKCFlbXB0eSgkZGF0YSkpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRkYXRhLT5xdW90YXRpb25fZ2VuZXJhdGVfdHlwZSA9ICdjb21wbGV0ZSc7CiAgICAgICAgICAgICAgICAkZGF0YS0+c2F2ZSgpOwogICAgICAgICAgICAgICAgLy9Db21taXQgZGF0YQogICAgICAgICAgICAgICAgREI6OmNvbW1pdCgpOwoKICAgICAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnc3VjY2Vzcyc7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICdTdWNjZXNzZnVsbHkgQ29tcGxldGUgVGhpcyBSZXF1ZXN0IFByb3Bvc2FsISEnOwogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnZXJyb3InOwogICAgICAgICAgICAgICAgJHJlc3BvbnNlWydtZXNzYWdlJ10gPSAnRGF0YSBub3QgZm91bmQuISEnOwogICAgICAgICAgICB9CgogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICAvL0lmIHByb2Nlc3MgaGFzIGFueSBwcm9ibGVtIHRoZW4gcm9sbGJhY2sgdGhlIGRhdGEKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgICRyZXNwb25zZVsncmVzdWx0J10gPSAnZXJyb3InOwogICAgICAgICAgICAkcmVzcG9uc2VbJ21lc3NhZ2UnXSA9ICR0aC0+Z2V0TWVzc2FnZSgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHJlc3BvbnNlOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBlc3RpbWF0ZSgpCiAgICB7CiAgICAgICAgLy8gY29kZS4uLgogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiByZnBIaXN0b3J5KCRpZCkKICAgIHsKICAgICAgICB0cnl7CgogICAgICAgICAgICAkdGl0bGUgPSAiUkZQIEhpc3RvcnkiOwogICAgICAgICAgICAkcHJvcG9zYWxzID0gUmVxdWVzdFByb3Bvc2FsOjp3aXRoKCdyZWxRdW90YXRpb25zJyktPndoZXJlKCdpZCcsJGlkKS0+b3JkZXJieSgnaWQnLCdkZXNjJyktPmZpcnN0KCk7CgogICAgICAgICAgICBpZiAoY291bnQoJHByb3Bvc2Fscy0+cmVsUXVvdGF0aW9ucyk+MCkgewogICAgICAgICAgICAgICAgJHB1cmNoYXNlID0gJHByb3Bvc2Fscy0+cmVsUXVvdGF0aW9ucygpLT53aXRoKCdyZWxQdXJjaGFzZU9yZGVyJyktPmZpcnN0KCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyID0gaXNzZXQoJHB1cmNoYXNlKT8oIWVtcHR5KCRwdXJjaGFzZS0+cmVsUHVyY2hhc2VPcmRlcik/JHB1cmNoYXNlLT5yZWxQdXJjaGFzZU9yZGVyOicnKTonJzsKCiAgICAgICAgICAgIGlmICghZW1wdHkoJHB1cmNoYXNlT3JkZXIpKSB7CiAgICAgICAgICAgICAgICAkYmlsbE1hbmFnZSA9IFB1cmNoYXNlT3JkZXI6OndpdGgoWwogICAgICAgICAgICAgICAgICAgICdyZWxHb29kUmVjZWl2ZU5vdGUnLAogICAgICAgICAgICAgICAgICAgICdyZWxHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW4nLAogICAgICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24ucmVsU3VwcGxpZXJzJywKICAgICAgICAgICAgICAgICAgICAncmVsUXVvdGF0aW9uLmV4Y2hhbmdlUmF0ZS5jdXJyZW5jeScsCiAgICAgICAgICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXJJdGVtcycsCiAgICAgICAgICAgICAgICAgICAgJ3JlbFBvQXR0YWNobWVudCcKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAtPndoZXJlKCdpc19zZW5kJywneWVzJykKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbEdvb2RSZWNlaXZlTm90ZScsZnVuY3Rpb24gKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZVJhdygncHVyY2hhc2Vfb3JkZXJzLmlkPWdvb2RzX3JlY2VpdmVkX25vdGVzLnB1cmNoYXNlX29yZGVyX2lkJyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygncmVsR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaXNfZ3JuX2NvbXBsZXRlJywneWVzJyktPndoZXJlKCd0b3RhbF9hbW91bnQnLCAnPicsIDApOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2lkJywkcHVyY2hhc2VPcmRlci0+aWQpCiAgICAgICAgICAgICAgICAtPmZpcnN0KCk7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgJGJpbGxNYW5hZ2U9Jyc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5yZnAucmZwLWhpc3RvcnknLGNvbXBhY3QoJ3RpdGxlJywncHVyY2hhc2VPcmRlcicsJ3Byb3Bvc2FscycsJ2JpbGxNYW5hZ2UnKSk7CiAgICAgICAgfWNhdGNoKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFdhcm5pbmcoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KfQo=