<?php
bolt_decrypt( __FILE__ , 'd0hiAZ'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcUG1zXFF1YWxpdHk7Cgp1c2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcQ29udHJvbGxlcjsKdXNlIElsbHVtaW5hdGVcRGF0YWJhc2VcRWxvcXVlbnRcQnVpbGRlcjsKdXNlIElsbHVtaW5hdGVcSHR0cFxSZXF1ZXN0OwoKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEludmVudG9yeU1vZGVsc1xJbnZlbnRvcnlBY3Rpb25Db250cm9sOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHJvZHVjdDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFdhcmVob3VzZXM7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVJldHVybjsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXI7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVySXRlbTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEdyblxHb29kc1JlY2VpdmVkTm90ZTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEdyblxHb29kc1JlY2VpdmVkU3VtbWFyeTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEdyblxHb29kc1JlY2VpdmVkSXRlbTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEdyblxHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW47CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xHcm5cRmFxOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcR3JuXFJldHVybkNoYW5nZUZhcTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFJlcXVpc2l0aW9uSXRlbTsKCnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xNYWlsOwp1c2UgRGF0YVRhYmxlczsKdXNlIERCLEF1dGgsU2Vzc2lvbixyZWRpcmVjdDsKCgpjbGFzcyBRdWFsaXR5RW5zdXJlQ29udHJvbGxlciBleHRlbmRzIENvbnRyb2xsZXIKewogICAgcHVibGljIGZ1bmN0aW9uIGFwcHJvdmVkSGVhZGVyQ29sdW1ucygkdmFsdWU9JycpCiAgICB7CiAgICAgICAgcmV0dXJuIGFycmF5KAogICAgICAgICAgICBbJ1NMJywgJ1NMJ10sCiAgICAgICAgICAgIFsnUE9fcmVmZXJlbmNlJywgJ1BPX3JlZmVyZW5jZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ1BPX2RhdGUnLCAnUE9fZGF0ZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2NoYWxsYW4nLCAnY2hhbGxhbicsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2dhdGVfaW5fcmVmZXJlbmNlJywgJ2dhdGVfaW5fcmVmZXJlbmNlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnZ2F0ZV9pbl9kYXRlJywgJ2dhdGVfaW5fZGF0ZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2dhdGVfaW5fcXR5JywgJ2dhdGVfaW5fcXR5JywgJ3RleHQtcmlnaHQnXSwKICAgICAgICAgICAgWydyZWNlaXZlZF9zdGF0dXMnLCAncmVjZWl2ZWRfc3RhdHVzJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnYXBwcm92ZWRfcXR5JywgJ2FwcHJvdmVkX3F0eScsICd0ZXh0LXJpZ2h0J10sCiAgICAgICAgICAgIFsnb3B0aW9ucycsICdvcHRpb25zJywndGV4dC1jZW50ZXInXSwKICAgICAgICApOwogICAgfQoKICAgIC8qKgogICAgICogRGlzcGxheSBhIGFwcHJvdmVkIGxpc3Rpbmcgb2YgdGhlIHJlc291cmNlLgogICAgICoKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaW5kZXgoKQogICAgewogICAgICAgIHRyeXsKCiAgICAgICAgICAgICR1c2VyVW5pdHMgPSBhdXRoKCktPnVzZXIoKS0+cHJpb3JpdGllcy0+cGx1Y2soJ2hyX3VuaXRfaWQnKS0+dG9BcnJheSgpOwogICAgICAgICAgICAkdXNlckRlcGFydG1lbnRzID0gYXV0aCgpLT51c2VyKCktPnByaW9yaXRpZXMtPnBsdWNrKCdocl9kZXBhcnRtZW50X2lkJyktPnRvQXJyYXkoKTsKICAgICAgICAgICAgJGl0ZW1zID0gR29vZHNSZWNlaXZlZE5vdGU6OndpdGgoWwogICAgICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXIucHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucycsCiAgICAgICAgICAgICAgICAncmVsR29vZHNSZWNlaXZlZEl0ZW1zJwogICAgICAgICAgICBdKQogICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19zZW5kJywgJ3llcycpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZW4oaXNzZXQoYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT5hc191bml0X2lkKSwgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHVzZXJVbml0cyl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlcicsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCR1c2VyVW5pdHMpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdocl91bml0X2lkJywgJHVzZXJVbml0cyk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKGF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdEZXBhcnRtZW50LUhlYWQnKSwgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHVzZXJEZXBhcnRtZW50cyl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlci5wdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHVzZXJEZXBhcnRtZW50cyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX2RlcGFydG1lbnRfaWQnLCAkdXNlckRlcGFydG1lbnRzKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZW4oIWF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdEZXBhcnRtZW50LUhlYWQnKSwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyLnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdocl9kZXBhcnRtZW50X2lkJywgMCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZUhhcygncmVsR29vZHNSZWNlaXZlZEl0ZW1zJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdxdWFsaXR5X2Vuc3VyZScsJ2FwcHJvdmVkJyk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlbighZGF0YXRhYmxlT3JkZXJpbmcoKSwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyYnkoJ3JlY2VpdmVkX2RhdGUnLCAnZGVzYycpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBEYXRhVGFibGVzOjpvZigkaXRlbXMpCiAgICAgICAgICAgICAgICAgICAgLT5hZGRJbmRleENvbHVtbigpCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ1BPX3JlZmVyZW5jZScsIGZ1bmN0aW9uKCRncm4pewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9ImJ0biBidG4tbGluayIgb25jbGljaz0icHVyY2hhc2VPcmRlckRldGFpbHMoJCh0aGlzKSkiIGRhdGEtc3JjPSInLnJvdXRlKCdwbXMucHVyY2hhc2Uub3JkZXItbGlzdC5zaG93JywgJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+aWQpLiciIGRhdGEtdGl0bGU9IlB1cmNoYXNlIE9yZGVyIERldGFpbHMiPicuJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+cmVmZXJlbmNlX25vLicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYT4nOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ1BPX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZWZlcmVuY2Vfbm8nLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ1BPX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBQdXJjaGFzZU9yZGVyOjpzZWxlY3QoJ3B1cmNoYXNlX29yZGVycy5yZWZlcmVuY2Vfbm8nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigncHVyY2hhc2Vfb3JkZXJzLmlkJywgJ2dvb2RzX3JlY2VpdmVkX25vdGVzLnB1cmNoYXNlX29yZGVyX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdQT19kYXRlJywgZnVuY3Rpb24oJGdybil7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkZ3JuLT5yZWxQdXJjaGFzZU9yZGVyLT5wb19kYXRlKSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignUE9fZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdwb19kYXRlJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdQT19yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUHVyY2hhc2VPcmRlcjo6c2VsZWN0KCdwdXJjaGFzZV9vcmRlcnMucG9fZGF0ZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdwdXJjaGFzZV9vcmRlcnMuaWQnLCAnZ29vZHNfcmVjZWl2ZWRfbm90ZXMucHVyY2hhc2Vfb3JkZXJfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZ2F0ZV9pbl9yZWZlcmVuY2UnLCBmdW5jdGlvbigkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8ZGl2IHN0eWxlPSJ3aWR0aDogMTAwJSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9IndpZHRoOiA5MCU7ZmxvYXQ6IGxlZnQ7Y2xlYXI6cmlnaHQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iYnRuIGJ0bi1saW5rIiBvbmNsaWNrPSJzaG93UUVQT0RldGFpbHMoJCh0aGlzKSkiIGRhdGEtc3JjPSInLnJvdXRlKCdwbXMuZ3JuLmdybi1wcm9jZXNzLnNob3cnLCRncm4tPmlkKS4nIiBkYXRhLXRpdGxlPSJHYXRlIEluIERldGFpbHMiPicuJGdybi0+cmVmZXJlbmNlX25vLic8L2E+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJ3aWR0aDogMTAlO2Zsb2F0OiBsZWZ0O2NsZWFyOnJpZ2h0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGNsYXNzPSJidG4gYnRuLXByaW1hcnkgYnRuLXhzIiBocmVmPSInLiB1cmwoJ3Btcy9ncm4vZ2F0ZS1pbi1zbGlwLycuJGdybi0+cHVyY2hhc2Vfb3JkZXJfaWQuJz9ncm49Jy4kZ3JuLT5pZCkgLiciIHRhcmdldD0iX2JsYW5rIiBzdHlsZT0ibWFyZ2luLXRvcDogNy41cHgiIHRpdGxlPSJHYXRlIEluIFNsaXAiPjxpIGNsYXNzPSJsYSBsYS1wcmludCI+PC9pPjwvYT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdnYXRlX2luX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3JlZmVyZW5jZV9ubycsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdnYXRlX2luX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlckJ5KCdyZWZlcmVuY2Vfbm8nLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2dhdGVfaW5fZGF0ZScsIGZ1bmN0aW9uKCRncm4pewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJGdybi0+cmVjZWl2ZWRfZGF0ZSkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2dhdGVfaW5fZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3JlY2VpdmVkX2RhdGUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignZ2F0ZV9pbl9kYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ3JlY2VpdmVkX2RhdGUnLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2dhdGVfaW5fcXR5JywgZnVuY3Rpb24oJGdybil7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkZ3JuLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnN1bSgncXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3JlY2VpdmVkX3N0YXR1cycsIGZ1bmN0aW9uKCRncm4pewogICAgICAgICAgICAgICAgICAgICAgICBpZigkZ3JuLT5yZWNlaXZlZF9zdGF0dXMgPT0gJ3BhcnRpYWwnKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgY2xhc3M9ImJ0biBidG4td2FybmluZyBidG4teHMiPlBhcnRpYWwgUmVjZWl2ZWQ8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2VpZigkZ3JuLT5yZWNlaXZlZF9zdGF0dXMgPT0gJ2Z1bGwnKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgY2xhc3M9ImJ0biBidG4tc3VjY2VzcyBidG4teHMiPkZ1bGwgUmVjZWl2ZWQ8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGNsYXNzPSJidG4gYnRuLWRhcmsgYnRuLXhzIj4nLnVjd29yZHMoJGdybi0+cmVjZWl2ZWRfc3RhdHVzKS4nPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhcHByb3ZlZF9xdHknLCBmdW5jdGlvbigkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRncm4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+d2hlcmUoJ3F1YWxpdHlfZW5zdXJlJywnYXBwcm92ZWQnKS0+c3VtKCdxdHknKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdvcHRpb25zJywgZnVuY3Rpb24oJGdybil7CiAgICAgICAgICAgICAgICAgICAgICAgICRvcHRpb25zID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgICRjb3VudCA9ICRncm4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcygpLT53aGVyZSgncXVhbGl0eV9lbnN1cmUnLCdhcHByb3ZlZCcpLT5jb3VudCgpOwogICAgICAgICAgICAgICAgICAgICAgICBpZigkY291bnQgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvcHRpb25zIC49ICc8YSBocmVmPSInLnJvdXRlKCdwbXMucXVhbGl0eS5lbnN1cmUuYXBwcm92ZWQuc2luZ2xlLmxpc3QnLCRncm4tPmlkKS4nIiBjbGFzcz0iYnRuIGJ0bi14cyBidG4taW5mbyI+SXRlbXMgKCcuJGNvdW50LicpPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJG9wdGlvbnMgLj0gJyZuYnNwOyZuYnNwOzxhIHRhcmdldD0iX2JsYW5rIiBocmVmPSInLnJvdXRlKCdwbXMucXVhbGl0eS5hcHByb3ZlZC5pdGVtLnByaW50JyxbJ2lkJz0+JGdybi0+aWQsJ3R5cGUnPT4nYXBwcm92ZWQnXSkuJyIgdGl0bGU9IlF1YWxpdHkgRW5zdXJlIEFwcHJvdmVkIFByaW50IFZpZXciIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi1zdWNjZXNzIj48aSBjbGFzcz0ibGFzIGxhLXByaW50Ij48L2k+PC9hPic7CgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJG9wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPnJhd0NvbHVtbnMoWydQT19yZWZlcmVuY2UnLCAnZ2F0ZV9pbl9yZWZlcmVuY2UnLCAncmVjZWl2ZWRfc3RhdHVzJywgJ29wdGlvbnMnXSkKICAgICAgICAgICAgICAgICAgICAtPm1ha2UodHJ1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5xdWFsaXR5LmFwcHJvdmVkLWluZGV4JywgWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAiUXVhbGl0eSBFbnN1cmUgQXBwcm92YWwgTGlzdCIsCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPmFwcHJvdmVkSGVhZGVyQ29sdW1ucygpCiAgICAgICAgICAgIF0pOwogICAgICAgIH1jYXRjaChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgLyoqCiAgICAgKiBTaG93IHRoZSBHcm4gV2lzZSBBcHByb3ZlZCBJdGVtIExpc3QuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KCiAgICBwdWJsaWMgZnVuY3Rpb24gZW5zdXJlQ2hlY2soJGlkKQogICAgewogICAgICAgIHRyeXsKICAgICAgICAgICAgJHRpdGxlPSJRdWFsaXR5IEVuc3VyZSBDaGVjayI7CgogICAgICAgICAgICAkZ3JuID0gR29vZHNSZWNlaXZlZE5vdGU6OndpdGgoWwogICAgICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXIucmVsUXVvdGF0aW9uLnJlbFN1cHBsaWVycy5TdXBwbGllclJhdGluZ3MnLAogICAgICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXIucmVsUXVvdGF0aW9uLmV4Y2hhbmdlUmF0ZS5jdXJyZW5jeScsCiAgICAgICAgICAgICAgICAncmVsUHVyY2hhc2VPcmRlci5yZWxRdW90YXRpb24nLAogICAgICAgICAgICAgICAgJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcy5yZWxQcm9kdWN0LnByb2R1Y3RVbml0JywKICAgICAgICAgICAgICAgICdyZWxHb29kc1JlY2VpdmVkSXRlbXMucmVsUHJvZHVjdC5jYXRlZ29yeS5jYXRlZ29yeScsCiAgICAgICAgICAgICAgICAncmVsR29vZHNSZWNlaXZlZEl0ZW1zLnJlbFByb2R1Y3QuYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJywKICAgICAgICAgICAgICAgICdyZWxHb29kc1JlY2VpdmVkSXRlbXMucmVsUHVyY2hhc2VPcmRlclJldHVybnMnCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlcmUoJ2lkJywkaWQpCiAgICAgICAgICAgIC0+Zmlyc3QoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgICRncm4tPnJlbF9nb29kc19yZWNlaXZlZF9pdGVtcyA9ICRncm4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+d2hlcmVJbigncXVhbGl0eV9lbnN1cmUnLFsncGVuZGluZyddKTsKICAgICAgICAgICAgJHdhcmVIb3VzZXMgPSBXYXJlaG91c2VzOjpzZWxlY3QoJ25hbWUnLCdpZCcpLT5nZXQoKTsKICAgICAgICAgICAgJGZhcXMgPSBGYXE6OndoZXJlKCdzdGF0dXMnLCdhY3RpdmUnKS0+Z2V0KCk7CiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5xdWFsaXR5LnBlbmRpbmctaW5kZXgnLGNvbXBhY3QoJ3RpdGxlJywnZ3JuJywnd2FyZUhvdXNlcycsJ2ZhcXMnKSk7CiAgICAgICAgfWNhdGNoKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGdldEZhcXMoJGNhdGVnb3J5X2lkKQogICAgewogICAgICAgICRxdWVzdGlvbnMgPSBGYXE6OndoZXJlKCdjYXRlZ29yeV9pZCcsICRjYXRlZ29yeV9pZCktPndoZXJlKCdzdGF0dXMnLCdhY3RpdmUnKS0+Z2V0KCk7CiAgICAgICAgJGRhdGEgPSAnJzsKICAgICAgICBpZihpc3NldCgkcXVlc3Rpb25zWzBdKSl7CiAgICAgICAgICAgIGZvcmVhY2goJHF1ZXN0aW9ucyBhcyAka2V5ID0+ICRxdWVzdGlvbil7CiAgICAgICAgICAgICAgICAkZGF0YSAuPSc8bGk+CiAgICAgICAgICAgICAgICAgICAgPGlucHV0IGNsYXNzPSJmb3JtLWNoZWNrLWlucHV0IiB0eXBlPSJjaGVja2JveCIgbmFtZT0iZmFxX2lkW10iIGlkPSJmYXFfJy4kcXVlc3Rpb24tPmlkLiciIHZhbHVlPSInLiRxdWVzdGlvbi0+aWQuJyIgcmVxdWlyZWQ+CiAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJmb3JtLWNoZWNrLWxhYmVsIiBmb3I9ImZhcV8nLiRxdWVzdGlvbi0+aWQuJyI+PHN0cm9uZz4nLiRxdWVzdGlvbi0+bmFtZS4nPC9zdHJvbmc+CiAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgIDwvbGk+JzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRkYXRhOwogICAgfQogICAgLyoqCiAgICAgKiBTdG9yZSBhIG5ld2x5IGNyZWF0ZWQgcmVzb3VyY2UgaW4gc3RvcmFnZS4KICAgICAqCiAgICAgKiBAcGFyYW0gIFxJbGx1bWluYXRlXEh0dHBcUmVxdWVzdCAgJHJlcXVlc3QKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2F2ZShSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewoKICAgICAgICAkbW9kZWwgPSBHb29kc1JlY2VpdmVkSXRlbTo6ZmluZE9yRmFpbCgkcmVxdWVzdC0+aWQpOwoKICAgICAgICAkcHJvZHVjdCA9IFByb2R1Y3Q6OmZpbmRPckZhaWwoJG1vZGVsLT5wcm9kdWN0X2lkKTsKCiAgICAgICAgaWYoaXNzZXQoJG1vZGVsLT5pZCkgJiYgJHJlcXVlc3QtPnF1YWxpdHlfZW5zdXJlPT09J2FwcHJvdmVkJyl7CgogICAgICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgICAgICB0cnl7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICRuZXdUZXh0ID0gJ0FwcHJvdmVkJzsKICAgICAgICAgICAgICAgICR1cGRhdGU9JG1vZGVsLT51cGRhdGUoWwogICAgICAgICAgICAgICAgICAgICdxdWFsaXR5X2Vuc3VyZScgPT4gJHJlcXVlc3QtPnF1YWxpdHlfZW5zdXJlLAogICAgICAgICAgICAgICAgICAgICdyZWNlaXZlZF9xdHknID0+ICAkbW9kZWwtPnF0eSwKICAgICAgICAgICAgICAgICAgICAndXBkYXRlZF9hdCcgPT4gZGF0ZSgnWS1tLWQgSDppOnMnKSwKICAgICAgICAgICAgICAgICAgICAndXBkYXRlZF9ieScgPT4gQXV0aDo6dXNlcigpLT5pZAogICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgJG1vZGVsID0gR29vZHNSZWNlaXZlZEl0ZW06OmZpbmRPckZhaWwoJHJlcXVlc3QtPmlkKTsKCiAgICAgICAgICAgICAgICAkcHJlZml4PSdRRS1BUC0nLmRhdGUoJ3knLCBzdHJ0b3RpbWUoZGF0ZSgnWS1tLWQnKSkpLictJy4oYXV0aCgpLT51c2VyKCktPmVtcGxveWVlLT51bml0LT5ocl91bml0X3Nob3J0X25hbWUpLictJzsKICAgICAgICAgICAgICAgICRyZWZObz11bmlxdWVDb2RlKDE4LCRwcmVmaXgsJ2dvb2RzX3JlY2VpdmVkX2l0ZW1zX3N0b2NrX2luJywnaWQnKTsKCiAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4gPSBuZXcgR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luKCk7CiAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPnB1cmNoYXNlX29yZGVyX2lkID0gJG1vZGVsLT5yZWxHb29kc1JlY2VpdmVkTm90ZS0+cHVyY2hhc2Vfb3JkZXJfaWQ7CiAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPmdvb2RzX3JlY2VpdmVkX2l0ZW1faWQgPSAkbW9kZWwtPmlkOwogICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT5yZWZlcmVuY2Vfbm8gPSAkcmVmTm87CiAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPnVuaXRfYW1vdW50ID0gJG1vZGVsLT51bml0X2Ftb3VudDsKICAgICAgICAgICAgICAgICRHUkl0ZW1zU3RvY2tJbi0+cmVjZWl2ZWRfcXR5ID0gJG1vZGVsLT5xdHk7CiAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPnN1Yl90b3RhbCA9ICRtb2RlbC0+c3ViX3RvdGFsOwogICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT5kaXNjb3VudF9wZXJjZW50YWdlID0gJG1vZGVsLT5kaXNjb3VudF9wZXJjZW50YWdlOwogICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT5kaXNjb3VudCA9ICRtb2RlbC0+ZGlzY291bnQ7CiAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPnZhdF9wZXJjZW50YWdlID0gJG1vZGVsLT52YXRfcGVyY2VudGFnZTsKICAgICAgICAgICAgICAgICRHUkl0ZW1zU3RvY2tJbi0+dmF0ID0gJG1vZGVsLT52YXQ7CiAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPnRvdGFsX2Ftb3VudCA9ICRtb2RlbC0+dG90YWxfYW1vdW50OwogICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT5pc19ncm5fY29tcGxldGUgPSAnbm8nOwogICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT5zYXZlKCk7CgogICAgICAgICAgICAgICAgJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgZGF0YS1zcmM9Iicucm91dGUoJ3Btcy5ncm4uZ3JuLXByb2Nlc3Muc2hvdycsJG1vZGVsLT5yZWxHb29kc1JlY2VpdmVkTm90ZS0+aWQpLic/dmlldyIgZGF0YS10aXRsZT0iR2F0ZS1JbiBEZXRhaWxzIj5SZWZlcmVuY2UgTm86Jy4kbW9kZWwtPnJlbEdvb2RzUmVjZWl2ZWROb3RlLT5yZWZlcmVuY2Vfbm8uJy4gV2FpdGluZyBmb3IgdGhlIEdSTi48L3NwYW4+JzsKCiAgICAgICAgICAgICAgICBDcmVhdGVPclVwZGF0ZU5vdGlmaWNhdGlvbignJyxnZXRNYW5hZ2VySW5mbygnU3RvcmUtTWFuYWdlcicsJG1vZGVsLT5yZWxHb29kc1JlY2VpdmVkTm90ZS0+cmVsUHVyY2hhc2VPcmRlci0+aHJfdW5pdF9pZCksJG1lc3NhZ2UsJ3VucmVhZCcsJ3NlbmQtdG8tc3RvcmUnKTsKCiAgICAgICAgICAgICAgICBDcmVhdGVPclVwZGF0ZU5vdGlmaWNhdGlvbignJyxnZXRNYW5hZ2VySW5mbygnUHVyY2hhc2UtRGVwYXJ0bWVudCcpLCRtZXNzYWdlLCd1bnJlYWQnLCdzZW50LXRvLXB1cmNoYXNlJywnJyk7CgogICAgICAgICAgICAgICAgJHRoaXMtPnVwZGF0ZVFDUXVhbnRpdHkoJG1vZGVsLT5pZCwgJG1vZGVsLT5xdHkpOwogICAgICAgICAgICAgICAgREI6OmNvbW1pdCgpOwoKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAnbmV3X3RleHQnID0+ICRuZXdUZXh0LAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAnU3VjY2Vzc2Z1bGx5IFVwZGF0ZWQgdGhpcyBJdGVtIFF1YWxpdHkgU3RhdHVzISEnCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfQoKICAgICAgICB9ZWxzZWlmKGlzc2V0KCRtb2RlbC0+aWQpICYmICRyZXF1ZXN0LT5xdWFsaXR5X2Vuc3VyZT09PSdyZXR1cm4tY2hhbmdlJyB8fCAkcmVxdWVzdC0+cXVhbGl0eV9lbnN1cmU9PT0ncmV0dXJuJyl7CgogICAgICAgICAgICBpZiAoKCRtb2RlbC0+cXR5KSA8ICRyZXF1ZXN0LT5yZXR1cm5fcXR5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoV2FybmluZygnWW91ciByZXR1cm4gcXR5IGlzIGdyZWF0ZXIgdGhlbiBtYXhpbXVtIHF0eScpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoJHJlcXVlc3QtPnJldHVybl9xdHkgPD0gMCkgewogICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoV2FybmluZygnTWluaW11bSBPbmUgaXRlbSBpcyByZXF1aXJlZCcpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkY29kZT0oJHJlcXVlc3QtPnF1YWxpdHlfZW5zdXJlPT0ncmV0dXJuLWNoYW5nZSc/J1FFLVJQLSc6J1FFLVJULScpOwoKICAgICAgICAgICAgJHByZWZpeD0kY29kZS5kYXRlKCd5Jywgc3RydG90aW1lKGRhdGUoJ1ktbS1kJykpKS4nLScuKGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+dW5pdC0+aHJfdW5pdF9zaG9ydF9uYW1lKS4nLSc7CiAgICAgICAgICAgICRyZWZObz11bmlxdWVDb2RlKDE4LCRwcmVmaXgsJ2dvb2RzX3JlY2VpdmVkX2l0ZW1zX3N0b2NrX2luJywnaWQnKTsKCiAgICAgICAgICAgIGlmKCRyZXF1ZXN0LT5xdWFsaXR5X2Vuc3VyZT09J3JldHVybi1jaGFuZ2UnKXsKICAgICAgICAgICAgICAgICRwdXJjaGFzZVJldHVybkNvZGVQcmVmaXggPSAnUlAtJy5kYXRlKCd5Jywgc3RydG90aW1lKGRhdGUoJ1ktbS1kJykpKS4nLScuKGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+dW5pdC0+aHJfdW5pdF9zaG9ydF9uYW1lKS4nLSc7CiAgICAgICAgICAgICAgICAkcHJldiA9IFB1cmNoYXNlUmV0dXJuOjp3aGVyZUhhcygncmVsR29vZHNSZWNlaXZlZEl0ZW1zLnJlbEdvb2RzUmVjZWl2ZWROb3RlJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJG1vZGVsKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaWQnLCAkbW9kZWwtPmdvb2RzX3JlY2VpdmVkX25vdGVfaWQpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3N0YXR1cycsICdyZXR1cm4tY2hhbmdlJykKICAgICAgICAgICAgICAgIC0+Zmlyc3QoKTsKICAgICAgICAgICAgICAgIGlmKGlzc2V0KCRwcmV2LT5pZCkpewogICAgICAgICAgICAgICAgICAgICRwdXJjaGFzZVJldHVybkNvZGUgPSAkcHJldi0+Y29kZTsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICRwdXJjaGFzZVJldHVybkNvZGUgPSB1bmlxdWVDb2RlKDE2LCRwdXJjaGFzZVJldHVybkNvZGVQcmVmaXgsJ3B1cmNoYXNlX3JldHVybnMnLCdpZCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICRwdXJjaGFzZVJldHVybkNvZGVQcmVmaXggPSAnUlQtJy5kYXRlKCd5Jywgc3RydG90aW1lKGRhdGUoJ1ktbS1kJykpKS4nLScuKGF1dGgoKS0+dXNlcigpLT5lbXBsb3llZS0+dW5pdC0+aHJfdW5pdF9zaG9ydF9uYW1lKS4nLSc7CiAgICAgICAgICAgICAgICAkcHJldiA9IFB1cmNoYXNlUmV0dXJuOjp3aGVyZUhhcygncmVsR29vZHNSZWNlaXZlZEl0ZW1zLnJlbEdvb2RzUmVjZWl2ZWROb3RlJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJG1vZGVsKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaWQnLCAkbW9kZWwtPmdvb2RzX3JlY2VpdmVkX25vdGVfaWQpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3N0YXR1cycsICdyZXR1cm4nKQogICAgICAgICAgICAgICAgLT5maXJzdCgpOwogICAgICAgICAgICAgICAgaWYoaXNzZXQoJHByZXYtPmlkKSl7CiAgICAgICAgICAgICAgICAgICAgJHB1cmNoYXNlUmV0dXJuQ29kZSA9ICRwcmV2LT5jb2RlOwogICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgJHB1cmNoYXNlUmV0dXJuQ29kZSA9IHVuaXF1ZUNvZGUoMTYsJHB1cmNoYXNlUmV0dXJuQ29kZVByZWZpeCwncHVyY2hhc2VfcmV0dXJucycsJ2lkJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgICAgIHRyeXsKICAgICAgICAgICAgICAgICR1cGRhdGU9JG1vZGVsLT51cGRhdGUoWwogICAgICAgICAgICAgICAgICAgICdxdWFsaXR5X2Vuc3VyZScgPT4gJHJlcXVlc3QtPnF1YWxpdHlfZW5zdXJlLAogICAgICAgICAgICAgICAgICAgICdyZWNlaXZlZF9xdHknID0+ICAkbW9kZWwtPnF0eS0kcmVxdWVzdC0+cmV0dXJuX3F0eSwKICAgICAgICAgICAgICAgICAgICAndXBkYXRlZF9hdCcgPT4gZGF0ZSgnWS1tLWQgSDppOnMnKSwKICAgICAgICAgICAgICAgICAgICAndXBkYXRlZF9ieScgPT4gQXV0aDo6dXNlcigpLT5pZAogICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgaWYgKCR1cGRhdGUpIHsKICAgICAgICAgICAgICAgICAgICBQdXJjaGFzZVJldHVybjo6Y3JlYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ2dvb2RzX3JlY2VpdmVkX2l0ZW1faWQnPT4kbW9kZWwtPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAnY29kZScgPT4gJHB1cmNoYXNlUmV0dXJuQ29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3JldHVybl9ub3RlJyA9PiAkcmVxdWVzdC0+cmV0dXJuX25vdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICdyZXR1cm5fcXR5JyA9PiAkcmVxdWVzdC0+cmV0dXJuX3F0eSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gJHJlcXVlc3QtPnF1YWxpdHlfZW5zdXJlLAogICAgICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgICAgICAvL3N1YnRvdGFsLHJlY2VpdmVkX3F0eSxkaXNjb3VudF9hbW91bnQsdmF0X2Ftb3VudAogICAgICAgICAgICAgICAgICAgICRyZWNlaXZlZFF0eT0kbW9kZWwtPnF0eS0kcmVxdWVzdC0+cmV0dXJuX3F0eTsKICAgICAgICAgICAgICAgICAgICBpZigkcmVjZWl2ZWRRdHkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgJHN1YnRvdGFsPSRyZWNlaXZlZFF0eSokbW9kZWwtPnVuaXRfYW1vdW50OwogICAgICAgICAgICAgICAgICAgICAgICAkZGlzY291bnRBbW91bnQ9ICgkbW9kZWwtPmRpc2NvdW50X3BlcmNlbnRhZ2UgKiAkc3VidG90YWwpLzEwMDsKICAgICAgICAgICAgICAgICAgICAgICAgJHZhdEFtb3VudD0gKCRtb2RlbC0+dmF0X3BlcmNlbnRhZ2UgKiAkc3VidG90YWwpLzEwMDsKCiAgICAgICAgICAgICAgICAgICAgICAgICRHUkl0ZW1zU3RvY2tJbiA9IG5ldyBHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW4oKTsKICAgICAgICAgICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT5wdXJjaGFzZV9vcmRlcl9pZCA9ICRtb2RlbC0+cmVsR29vZHNSZWNlaXZlZE5vdGUtPnB1cmNoYXNlX29yZGVyX2lkOwogICAgICAgICAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPnJlZmVyZW5jZV9ubyA9ICRyZWZObzsKICAgICAgICAgICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT5nb29kc19yZWNlaXZlZF9pdGVtX2lkID0gJG1vZGVsLT5pZDsKICAgICAgICAgICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT51bml0X2Ftb3VudCA9ICRtb2RlbC0+dW5pdF9hbW91bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICRHUkl0ZW1zU3RvY2tJbi0+cmVjZWl2ZWRfcXR5ID0gJHJlY2VpdmVkUXR5OwogICAgICAgICAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPnN1Yl90b3RhbCA9ICRzdWJ0b3RhbDsKICAgICAgICAgICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT5kaXNjb3VudF9wZXJjZW50YWdlID0gJG1vZGVsLT5kaXNjb3VudF9wZXJjZW50YWdlOwogICAgICAgICAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPmRpc2NvdW50ID0gJGRpc2NvdW50QW1vdW50OwogICAgICAgICAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPnZhdF9wZXJjZW50YWdlID0gJG1vZGVsLT52YXRfcGVyY2VudGFnZTsKICAgICAgICAgICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT52YXQgPSAkdmF0QW1vdW50OwogICAgICAgICAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPnRvdGFsX2Ftb3VudCA9ICgkc3VidG90YWwtJGRpc2NvdW50QW1vdW50KSskdmF0QW1vdW50OwogICAgICAgICAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPmlzX2dybl9jb21wbGV0ZSA9ICdubyc7CiAgICAgICAgICAgICAgICAgICAgICAgICRHUkl0ZW1zU3RvY2tJbi0+c2F2ZSgpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy9JbnNlcnQgcmV0dXJuIHJlYXNvbgogICAgICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJHJlcXVlc3QtPmZhcV9pZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHJlcXVlc3QtPmZhcV9pZCBhcyAka2V5ID0+ICRmYXFfaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJldHVybkNoYW5nZUZhcTo6Y3JlYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZmFxX2lkJz0+JGZhcV9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZ29vZHNfcmVjZWl2ZWRfaXRlbV9pZCc9PiRtb2RlbC0+aWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAkbWVzc2FnZSA9ICc8c3BhbiBjbGFzcz0ibm90aWZpY2F0aW9uLWxpbmtzIiBkYXRhLXNyYz0iJy5yb3V0ZSgncG1zLmdybi5ncm4tcHJvY2Vzcy5zaG93JywkbW9kZWwtPnJlbEdvb2RzUmVjZWl2ZWROb3RlLT5pZCkuJz92aWV3IiBkYXRhLXRpdGxlPSJHYXRlLUluIERldGFpbHMiPlJlZmVyZW5jZSBObzonLiRtb2RlbC0+cmVsR29vZHNSZWNlaXZlZE5vdGUtPnJlZmVyZW5jZV9uby4nLiBXYWl0aW5nIGZvciB0aGUgR1JOLjwvc3Bhbj4nOwoKICAgICAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCcnLGdldE1hbmFnZXJJbmZvKCdTdG9yZS1NYW5hZ2VyJywkbW9kZWwtPnJlbEdvb2RzUmVjZWl2ZWROb3RlLT5yZWxQdXJjaGFzZU9yZGVyLT5ocl91bml0X2lkKSwkbWVzc2FnZSwndW5yZWFkJywnc2VuZC10by1zdG9yZScpOwoKICAgICAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCcnLGdldE1hbmFnZXJJbmZvKCdQdXJjaGFzZS1EZXBhcnRtZW50JyksJG1lc3NhZ2UsJ3VucmVhZCcsJ3NlbnQtdG8tcHVyY2hhc2UnLCcnKTsKCiAgICAgICAgICAgICAgICAkdGhpcy0+dXBkYXRlUUNRdWFudGl0eSgkbW9kZWwtPmlkLCAkcmVjZWl2ZWRRdHkpOwogICAgICAgICAgICAgICAgREI6OmNvbW1pdCgpOwoKICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhTdWNjZXNzKCdTdWNjZXNzZnVsbHkgVXBkYXRlZCB0aGlzIEl0ZW0gUXVhbGl0eSBTdGF0dXMhIScpOwoKICAgICAgICAgICAgfWNhdGNoIChUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGJhY2soKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gdXBkYXRlUUNRdWFudGl0eSgkZ29vZHNfcmVjZWl2ZWRfaXRlbV9pZCwgJHFjX3F0eSkKICAgIHsKICAgICAgICBpZigkcWNfcXR5ID4gMCl7CiAgICAgICAgICAgICRhcnJheSA9IFtdOwoKICAgICAgICAgICAgLy9QTyBHZW5lcmF0ZSBFcXVhbGx5IGRpc3RyaWJ1dGUKICAgICAgICAgICAgJGdvb2RzUmVjZWl2ZWRJdGVtID0gR29vZHNSZWNlaXZlZEl0ZW06OmZpbmQoJGdvb2RzX3JlY2VpdmVkX2l0ZW1faWQpOwogICAgICAgICAgICAkcmVxdWlzaXRpb25fcXR5ID0gUmVxdWlzaXRpb25JdGVtOjp3aGVyZSgncHJvZHVjdF9pZCcsICRnb29kc1JlY2VpdmVkSXRlbS0+cHJvZHVjdF9pZCkKICAgICAgICAgICAgLT53aGVyZUhhcygncmVxdWlzaXRpb24ucHVyY2hhc2VPcmRlcnMucHVyY2hhc2VPcmRlci5yZWxHb29kUmVjZWl2ZU5vdGUnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkZ29vZHNSZWNlaXZlZEl0ZW0pewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lkJywgJGdvb2RzUmVjZWl2ZWRJdGVtLT5nb29kc19yZWNlaXZlZF9ub3RlX2lkKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5zdW0oJ3F0eScpOwogICAgICAgICAgICAkcGVyY2VudGFnZSA9ICgkcmVxdWlzaXRpb25fcXR5ID4gMCAmJiAkcWNfcXR5ID4gMCA/ICgoJHFjX3F0eS8kcmVxdWlzaXRpb25fcXR5KSoxMDApIDogMCk7CgogICAgICAgICAgICAvL2FycmF5X3B1c2goJGFycmF5LCAkcGVyY2VudGFnZSk7CgogICAgICAgICAgICAkcmVxdWlzaXRpb25zID0gJGdvb2RzUmVjZWl2ZWRJdGVtLT5yZWxHb29kc1JlY2VpdmVkTm90ZS0+cmVsUHVyY2hhc2VPcmRlci0+cHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucy0+cGx1Y2soJ3JlcXVpc2l0aW9uX2lkJyktPnRvQXJyYXkoKTsKICAgICAgICAgICAgJHJlcXVpc2l0aW9uSXRlbXMgPSBSZXF1aXNpdGlvbkl0ZW06OndoZXJlSW4oJ3JlcXVpc2l0aW9uX2lkJywgJHJlcXVpc2l0aW9ucyktPndoZXJlKCdwcm9kdWN0X2lkJywgJGdvb2RzUmVjZWl2ZWRJdGVtLT5wcm9kdWN0X2lkKS0+Z2V0KCk7CiAgICAgICAgICAgIGlmKGlzc2V0KCRyZXF1aXNpdGlvbkl0ZW1zWzBdKSl7CiAgICAgICAgICAgICAgICBmb3JlYWNoKCRyZXF1aXNpdGlvbkl0ZW1zIGFzICRrZXkgPT4gJHJlcXVpc2l0aW9uSXRlbSl7CiAgICAgICAgICAgICAgICAgICAgaWYoJHFjX3F0eT4wKXsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXNfcWNfcXR5ID0gcm91bmQoKCRwZXJjZW50YWdlID4gMCA/ICgkcmVxdWlzaXRpb25JdGVtLT5xdHkqKCRwZXJjZW50YWdlLzEwMCkpIDogMCkpOwogICAgICAgICAgICAgICAgICAgICAgICAkdGhpc19xY19xdHkgPSAoJHRoaXNfcWNfcXR5ID4gJHFjX3F0eSA/ICRxY19xdHkgOiAkdGhpc19xY19xdHkpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYXJyYXlfcHVzaCgkYXJyYXksIFsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICdwZXJjZW50YWdlJyA9PiAkcGVyY2VudGFnZSwKICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICdyJyA9PiAkcmVxdWlzaXRpb25JdGVtLT5xdHksCiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAncScgPT4gJHRoaXNfcWNfcXR5CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIF0pOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uSXRlbS0+cWNfcXR5ID0gJHRoaXNfcWNfcXR5OwogICAgICAgICAgICAgICAgICAgICAgICAkcmVxdWlzaXRpb25JdGVtLT5zYXZlKCk7CgogICAgICAgICAgICAgICAgICAgICAgICAkcWNfcXR5ID0gKCRxY19xdHkgLSAkdGhpc19xY19xdHkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKCRxY19xdHk+MCl7CiAgICAgICAgICAgICAgICAgICAgJHJlcXVpc2l0aW9uSXRlbSA9IFJlcXVpc2l0aW9uSXRlbTo6d2hlcmVJbigncmVxdWlzaXRpb25faWQnLCAkcmVxdWlzaXRpb25zKS0+d2hlcmUoJ3Byb2R1Y3RfaWQnLCAkZ29vZHNSZWNlaXZlZEl0ZW0tPnByb2R1Y3RfaWQpLT5maXJzdCgpOwogICAgICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbkl0ZW0tPnFjX3F0eSA9ICgkcmVxdWlzaXRpb25JdGVtLT5xY19xdHkrcm91bmQoJHFjX3F0eSkpOwogICAgICAgICAgICAgICAgICAgICRyZXF1aXNpdGlvbkl0ZW0tPnNhdmUoKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gYXJyYXlfcHVzaCgkYXJyYXksIFsKICAgICAgICAgICAgICAgICAgICAvLyAgICAgJ3BlcmNlbnRhZ2UnID0+ICRwZXJjZW50YWdlLAogICAgICAgICAgICAgICAgICAgIC8vICAgICAncicgPT4gJHJlcXVpc2l0aW9uSXRlbS0+cXR5LAogICAgICAgICAgICAgICAgICAgIC8vICAgICAncScgPT4gcm91bmQoJHFjX3F0eSksCiAgICAgICAgICAgICAgICAgICAgLy8gICAgICdlJyA9PiB0cnVlCiAgICAgICAgICAgICAgICAgICAgLy8gXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy9QTyBHZW5lcmF0ZSBFcXVhbGx5IGRpc3RyaWJ1dGUKICAgICAgICAgICAgLy9yZXR1cm4gJGFycmF5OwogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAqIFNob3cgdGhlIEdybiBXaXNlIEFwcHJvdmVkIEl0ZW0gTGlzdC4KICAgICoKICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAqLwoKICAgIHB1YmxpYyBmdW5jdGlvbiBncm5XaXNlQXBwcm92ZWRJdGVtTGlzdCgkaWQpCiAgICB7CiAgICAgICAgdHJ5ewogICAgICAgICAgICAkdGl0bGU9IlF1YWxpdHkgRW5zdXJlIEFwcHJvdmFsIExpc3QiOwogICAgICAgICAgICAkZ3JuID0gR29vZHNSZWNlaXZlZE5vdGU6OmZpbmQoJGlkKTsKICAgICAgICAgICAgJGdvb2RzUmVjZWl2ZWRJdGVtSWQgPSBHb29kc1JlY2VpdmVkSXRlbTo6d2hlcmUoJ2dvb2RzX3JlY2VpdmVkX25vdGVfaWQnLCRpZCktPndoZXJlKCdxdWFsaXR5X2Vuc3VyZScsJ2FwcHJvdmVkJyktPnBsdWNrKCdpZCcpLT5hbGwoKTsKCiAgICAgICAgICAgICRhcHByb3ZhbF9saXN0ID0gR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luOjp3aGVyZUluKCdnb29kc19yZWNlaXZlZF9pdGVtX2lkJywkZ29vZHNSZWNlaXZlZEl0ZW1JZCktPm9yZGVyQnkoJ2lkJywnZGVzYycpLT5wYWdpbmF0ZSgzMCk7CiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5xdWFsaXR5LmFwcHJvdmVkLWxpc3QnLGNvbXBhY3QoJ3RpdGxlJywnYXBwcm92YWxfbGlzdCcsICdncm4nKSk7CiAgICAgICAgfWNhdGNoKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHJldHVybkxpc3RIZWFkZXJDb2x1bW5zKCR2YWx1ZT0nJykKICAgIHsKICAgICAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgICAgIFsnU0wnLCAnU0wnXSwKICAgICAgICAgICAgWydQT19yZWZlcmVuY2UnLCAnUE9fcmVmZXJlbmNlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnUE9fZGF0ZScsICdQT19kYXRlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnY2hhbGxhbicsICdjaGFsbGFuJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnZ2F0ZV9pbl9yZWZlcmVuY2UnLCAnZ2F0ZV9pbl9yZWZlcmVuY2UnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydnYXRlX2luX3F0eScsICdnYXRlX2luX3F0eScsICd0ZXh0LXJpZ2h0J10sCiAgICAgICAgICAgIFsncmV0dXJuX3F0eScsICdyZXR1cm5fcXR5JywgJ3RleHQtcmlnaHQnXSwKICAgICAgICAgICAgWydyZWNlaXZlZF9zdGF0dXMnLCAncmVjZWl2ZWRfc3RhdHVzJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnb3B0aW9ucycsICdvcHRpb25zJywndGV4dC1jZW50ZXInXSwKICAgICAgICApOwogICAgfQoKICAgIC8qKgogICAgKiBTaG93IHRoZSBHcm4gV2lzZSBSZXR1cm4gTGlzdC4KICAgICoKICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHJldHVybmxMaXN0KCkKICAgIHsKICAgICAgICB0cnl7CiAgICAgICAgICAgIGlmIChyZXF1ZXN0KCktPmFqYXgoKSkgewogICAgICAgICAgICAgICAgJHVzZXJVbml0cyA9IGF1dGgoKS0+dXNlcigpLT5wcmlvcml0aWVzLT5wbHVjaygnaHJfdW5pdF9pZCcpLT50b0FycmF5KCk7CiAgICAgICAgICAgICAgICAkdXNlckRlcGFydG1lbnRzID0gYXV0aCgpLT51c2VyKCktPnByaW9yaXRpZXMtPnBsdWNrKCdocl9kZXBhcnRtZW50X2lkJyktPnRvQXJyYXkoKTsKICAgICAgICAgICAgICAgICRpdGVtcyA9IEdvb2RzUmVjZWl2ZWROb3RlOjp3aXRoKFsncmVsUHVyY2hhc2VPcmRlcicsCiAgICAgICAgICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXIucmVsUHVyY2hhc2VPcmRlckl0ZW1zJywKICAgICAgICAgICAgICAgICAgICAncmVsR29vZHNSZWNlaXZlZEl0ZW1zJywncmVsUHVyY2hhc2VPcmRlci5wdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zJwogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXInLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19zZW5kJywgJ3llcycpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbihpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkdXNlclVuaXRzKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlcicsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCR1c2VyVW5pdHMpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaHJfdW5pdF9pZCcsICR1c2VyVW5pdHMpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbihhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnRGVwYXJ0bWVudC1IZWFkJyksIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCR1c2VyRGVwYXJ0bWVudHMpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyLnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkdXNlckRlcGFydG1lbnRzKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX2RlcGFydG1lbnRfaWQnLCAkdXNlckRlcGFydG1lbnRzKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oIWF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdEZXBhcnRtZW50LUhlYWQnKSwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlci5wdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX2RlcGFydG1lbnRfaWQnLCAwKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxHb29kc1JlY2VpdmVkSXRlbXMnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdxdWFsaXR5X2Vuc3VyZScsJ3JldHVybicpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbighZGF0YXRhYmxlT3JkZXJpbmcoKSwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlcmJ5KCdyZWNlaXZlZF9kYXRlJywgJ2Rlc2MnKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIHJldHVybiBEYXRhVGFibGVzOjpvZigkaXRlbXMpCiAgICAgICAgICAgICAgICAgICAgLT5hZGRJbmRleENvbHVtbigpCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ1BPX3JlZmVyZW5jZScsIGZ1bmN0aW9uKCRncm4pewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9ImJ0biBidG4tbGluayIgb25jbGljaz0icHVyY2hhc2VPcmRlckRldGFpbHMoJCh0aGlzKSkiIGRhdGEtc3JjPSInLnJvdXRlKCdwbXMucHVyY2hhc2Uub3JkZXItbGlzdC5zaG93JywgJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+aWQpLiciIGRhdGEtdGl0bGU9IlB1cmNoYXNlIE9yZGVyIERldGFpbHMiPicuJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+cmVmZXJlbmNlX25vLicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYT4nOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ1BPX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZWZlcmVuY2Vfbm8nLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ1BPX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBQdXJjaGFzZU9yZGVyOjpzZWxlY3QoJ3B1cmNoYXNlX29yZGVycy5yZWZlcmVuY2Vfbm8nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigncHVyY2hhc2Vfb3JkZXJzLmlkJywgJ2dvb2RzX3JlY2VpdmVkX25vdGVzLnB1cmNoYXNlX29yZGVyX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdQT19kYXRlJywgZnVuY3Rpb24oJGdybil7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkZ3JuLT5yZWxQdXJjaGFzZU9yZGVyLT5wb19kYXRlKSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignUE9fZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdwb19kYXRlJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignUE9fZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdwb19kYXRlJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZ2F0ZV9pbl9yZWZlcmVuY2UnLCBmdW5jdGlvbigkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8ZGl2IHN0eWxlPSJ3aWR0aDogMTAwJSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9IndpZHRoOiA5MCU7ZmxvYXQ6IGxlZnQ7Y2xlYXI6cmlnaHQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iYnRuIGJ0bi1saW5rIiBvbmNsaWNrPSJzaG93UUVQT0RldGFpbHMoJCh0aGlzKSkiIGRhdGEtc3JjPSInLnJvdXRlKCdwbXMuZ3JuLmdybi1wcm9jZXNzLnNob3cnLCRncm4tPmlkKS4nIiBkYXRhLXRpdGxlPSJHYXRlIEluIERldGFpbHMiPicuJGdybi0+cmVmZXJlbmNlX25vLic8L2E+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJ3aWR0aDogMTAlO2Zsb2F0OiBsZWZ0O2NsZWFyOnJpZ2h0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGNsYXNzPSJidG4gYnRuLXByaW1hcnkgYnRuLXhzIiBocmVmPSInLiB1cmwoJ3Btcy9ncm4vZ2F0ZS1pbi1zbGlwLycuJGdybi0+cHVyY2hhc2Vfb3JkZXJfaWQuJz9ncm49Jy4kZ3JuLT5pZCkgLiciIHRhcmdldD0iX2JsYW5rIiBzdHlsZT0ibWFyZ2luLXRvcDogNy41cHgiPjxpIGNsYXNzPSJsYSBsYS1wcmludCI+PC9pPjwvYT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdnYXRlX2luX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3JlZmVyZW5jZV9ubycsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdnYXRlX2luX3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlckJ5KCdyZWZlcmVuY2Vfbm8nLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2dhdGVfaW5fcXR5JywgZnVuY3Rpb24oJGdybil7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkZ3JuLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnN1bSgncXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncmV0dXJuX3F0eScsIGZ1bmN0aW9uKCRncm4pewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGdybi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5zdW0oJ3F0eScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdyZWNlaXZlZF9zdGF0dXMnLCBmdW5jdGlvbigkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGdybi0+cmVjZWl2ZWRfc3RhdHVzID09ICdwYXJ0aWFsJyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGNsYXNzPSJidG4gYnRuLXdhcm5pbmcgYnRuLXhzIj5QYXJ0aWFsIFJlY2VpdmVkPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlaWYoJGdybi0+cmVjZWl2ZWRfc3RhdHVzID09ICdmdWxsJyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGNsYXNzPSJidG4gYnRuLXN1Y2Nlc3MgYnRuLXhzIj5GdWxsIFJlY2VpdmVkPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBjbGFzcz0iYnRuIGJ0bi1kYXJrIGJ0bi14cyI+Jy51Y3dvcmRzKCRncm4tPnJlY2VpdmVkX3N0YXR1cykuJzwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignb3B0aW9ucycsIGZ1bmN0aW9uKCRncm4pewogICAgICAgICAgICAgICAgICAgICAgICAkcmV0dXJuZWQgPSBQdXJjaGFzZVJldHVybjo6d2hlcmVIYXMoJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcycsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRncm4pewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2dvb2RzX3JlY2VpdmVkX25vdGVfaWQnLCAkZ3JuLT5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLT53aGVyZSgnc3RhdHVzJywgJ3JldHVybicpLT5zdW0oJ3JldHVybl9xdHknKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICRyZXR1cm5lZENvdW50ID0gUHVyY2hhc2VSZXR1cm46OndoZXJlSGFzKCdyZWxHb29kc1JlY2VpdmVkSXRlbXMnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdnb29kc19yZWNlaXZlZF9ub3RlX2lkJywgJGdybi0+aWQpOwogICAgICAgICAgICAgICAgICAgICAgICB9KS0+d2hlcmUoJ3N0YXR1cycsICdyZXR1cm4nKS0+Y291bnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICRhcHByb3ZlZCA9IFB1cmNoYXNlUmV0dXJuOjp3aGVyZUhhcygncmVsR29vZHNSZWNlaXZlZEl0ZW1zJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGdybil7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcsICRncm4tPmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSktPndoZXJlKCdzdGF0dXMnLCAncmV0dXJuJyktPnN1bSgncmVjZWl2ZWRfcXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICRvcHRpb25zID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRyZXR1cm5lZCA+IDApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9wdGlvbnMgLj0gJzxhIGhyZWY9Iicucm91dGUoJ3Btcy5xdWFsaXR5LmVuc3VyZS5yZXR1cm4uc2luZ2xlLmxpc3QnLCRncm4tPmlkKS4nIiBjbGFzcz0iYnRuIGJ0bi14cyBidG4taW5mbyI+SXRlbXMgKCcuJHJldHVybmVkQ291bnQuJyk8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvcHRpb25zIC49ICcmbmJzcDsmbmJzcDs8YSB0YXJnZXQ9Il9fYmxhbmsiIGhyZWY9Iicucm91dGUoJ3Btcy5xdWFsaXR5LnJldHVybi5pdGVtLnByaW50JyxbJ2lkJz0+JGdybi0+aWQsJ3R5cGUnPT4ncmV0dXJuJ10pLiciIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi13YXJuaW5nIiB0aXRsZT0iUmV0dXJuIExpc3QiPjxpIGNsYXNzPSJsYXMgbGEtcHJpbnQiPjwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRhcHByb3ZlZCA+IDApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG9wdGlvbnMgLj0gJyZuYnNwOyZuYnNwOzxhIHRhcmdldD0iX19ibGFuayIgaHJlZj0iJy5yb3V0ZSgncG1zLnF1YWxpdHkucmV0dXJuLml0ZW0ucHJpbnQnLFsnaWQnPT4kZ3JuLT5pZCwndHlwZSc9PidyZXR1cm4tYXBwcm92ZWQtbGlzdCddKS4nIiBjbGFzcz0iYnRuIGJ0bi14cyBidG4tc3VjY2VzcyIgdGl0bGU9IlJldHVybiBBcHByb3ZlZCBMaXN0Ij48aSBjbGFzcz0ibGFzIGxhLXByaW50Ij48L2k+PC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRvcHRpb25zOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsnUE9fcmVmZXJlbmNlJywgJ2dhdGVfaW5fcmVmZXJlbmNlJywgJ3JlY2VpdmVkX3N0YXR1cycsICdvcHRpb25zJ10pCiAgICAgICAgICAgICAgICAgICAgLT5tYWtlKHRydWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMucXVhbGl0eS5yZXR1cm4taW5kZXgnLCBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICJRdWFsaXR5IEVuc3VyZSBSZXR1cm4gTGlzdCIsCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPnJldHVybkxpc3RIZWFkZXJDb2x1bW5zKCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfWNhdGNoKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAqIFNob3cgdGhlIEdybiBXaXNlIFNpbmdsZSBSZXR1cm4gSXRlbSBMaXN0LgogICAgKgogICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICovCgogICAgcHVibGljIGZ1bmN0aW9uIGdybldpc2VSZXR1cm5JdGVtTGlzdCgkaWQpCiAgICB7CiAgICAgICAgdHJ5ewoKICAgICAgICAgICAgJHRpdGxlPSJRdWFsaXR5IEVuc3VyZSBSZXR1cm4gTGlzdCI7CiAgICAgICAgICAgICRncm4gPSBHb29kc1JlY2VpdmVkTm90ZTo6ZmluZCgkaWQpOwogICAgICAgICAgICAkZ29vZHNSZWNlaXZlZEl0ZW1JZCA9IEdvb2RzUmVjZWl2ZWRJdGVtOjp3aGVyZSgnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcsJGlkKS0+d2hlcmUoJ3F1YWxpdHlfZW5zdXJlJywncmV0dXJuJyktPnBsdWNrKCdpZCcpLT5hbGwoKTsKICAgICAgICAgICAgJHJldHVybkxpc3QgPSBQdXJjaGFzZVJldHVybjo6d2hlcmVJbignZ29vZHNfcmVjZWl2ZWRfaXRlbV9pZCcsJGdvb2RzUmVjZWl2ZWRJdGVtSWQpLT5vcmRlckJ5KCdpZCcsJ2Rlc2MnKS0+cGFnaW5hdGUoMzApOwoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnF1YWxpdHkucmV0dXJuLWxpc3QnLGNvbXBhY3QoJ3RpdGxlJywncmV0dXJuTGlzdCcsICdncm4nKSk7CiAgICAgICAgfWNhdGNoKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHJldHVybkNoYW5nZUxpc3RIZWFkZXJDb2x1bW5zKCR2YWx1ZT0nJykKICAgIHsKICAgICAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgICAgIFsnU0wnLCAnU0wnXSwKICAgICAgICAgICAgWydQT19yZWZlcmVuY2UnLCAnUE9fcmVmZXJlbmNlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnUE9fZGF0ZScsICdQT19kYXRlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnY2hhbGxhbicsICdjaGFsbGFuJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnZ2F0ZV9pbl9yZWZlcmVuY2UnLCAnZ2F0ZV9pbl9yZWZlcmVuY2UnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydnYXRlX2luX3F0eScsICdnYXRlX2luX3F0eScsICd0ZXh0LXJpZ2h0J10sCiAgICAgICAgICAgIFsncmV0dXJuX3F0eScsICdyZXR1cm5fcXR5JywgJ3RleHQtcmlnaHQnXSwKICAgICAgICAgICAgWydyZWNlaXZlZF9zdGF0dXMnLCAncmVjZWl2ZWRfc3RhdHVzJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnb3B0aW9ucycsICdvcHRpb25zJywndGV4dC1jZW50ZXInXSwKICAgICAgICApOwogICAgfQoKICAgIC8qKgogICAgKiBTaG93IHRoZSBHcm4gV2lzZSBSZXR1cm4gQ2hhbmdlIExpc3QuCiAgICAqCiAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgKi8KCiAgICBwdWJsaWMgZnVuY3Rpb24gcmV0dXJuQ2hhbmdlTGlzdCgpCiAgICB7CiAgICAgICAgdHJ5ewogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgICR1c2VyVW5pdHMgPSBhdXRoKCktPnVzZXIoKS0+cHJpb3JpdGllcy0+cGx1Y2soJ2hyX3VuaXRfaWQnKS0+dG9BcnJheSgpOwogICAgICAgICAgICAgICAgJHVzZXJEZXBhcnRtZW50cyA9IGF1dGgoKS0+dXNlcigpLT5wcmlvcml0aWVzLT5wbHVjaygnaHJfZGVwYXJ0bWVudF9pZCcpLT50b0FycmF5KCk7CiAgICAgICAgICAgICAgICAkaXRlbXMgPSBHb29kc1JlY2VpdmVkTm90ZTo6d2l0aChbCiAgICAgICAgICAgICAgICAgICAgJ3JlbFB1cmNoYXNlT3JkZXIucmVsUHVyY2hhc2VPcmRlckl0ZW1zJywKICAgICAgICAgICAgICAgICAgICAncmVsUHVyY2hhc2VPcmRlci5wdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zJywKICAgICAgICAgICAgICAgICAgICAncmVsR29vZHNSZWNlaXZlZEl0ZW1zJwogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXInLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19zZW5kJywgJ3llcycpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbihpc3NldChhdXRoKCktPnVzZXIoKS0+ZW1wbG95ZWUtPmFzX3VuaXRfaWQpLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkdXNlclVuaXRzKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlcicsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCR1c2VyVW5pdHMpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaHJfdW5pdF9pZCcsICR1c2VyVW5pdHMpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbihhdXRoKCktPnVzZXIoKS0+aGFzUm9sZSgnRGVwYXJ0bWVudC1IZWFkJyksIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCR1c2VyRGVwYXJ0bWVudHMpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxQdXJjaGFzZU9yZGVyLnB1cmNoYXNlT3JkZXJSZXF1aXNpdGlvbnMnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkdXNlckRlcGFydG1lbnRzKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX2RlcGFydG1lbnRfaWQnLCAkdXNlckRlcGFydG1lbnRzKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oIWF1dGgoKS0+dXNlcigpLT5oYXNSb2xlKCdEZXBhcnRtZW50LUhlYWQnKSwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlci5wdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX2RlcGFydG1lbnRfaWQnLCAwKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdyZWxHb29kc1JlY2VpdmVkSXRlbXMnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdxdWFsaXR5X2Vuc3VyZScsJ3JldHVybi1jaGFuZ2UnKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oIWRhdGF0YWJsZU9yZGVyaW5nKCksIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgncmVjZWl2ZWRfZGF0ZScsICdkZXNjJyk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICByZXR1cm4gRGF0YVRhYmxlczo6b2YoJGl0ZW1zKQogICAgICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdQT19yZWZlcmVuY2UnLCBmdW5jdGlvbigkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJidG4gYnRuLWxpbmsiIG9uY2xpY2s9InB1cmNoYXNlT3JkZXJEZXRhaWxzKCQodGhpcykpIiBkYXRhLXNyYz0iJy5yb3V0ZSgncG1zLnB1cmNoYXNlLm9yZGVyLWxpc3Quc2hvdycsICRncm4tPnJlbFB1cmNoYXNlT3JkZXItPmlkKS4nIiBkYXRhLXRpdGxlPSJQdXJjaGFzZSBPcmRlciBEZXRhaWxzIj4nLiRncm4tPnJlbFB1cmNoYXNlT3JkZXItPnJlZmVyZW5jZV9uby4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2E+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdQT19yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlcicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncmVmZXJlbmNlX25vJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdQT19yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgUHVyY2hhc2VPcmRlcjo6c2VsZWN0KCdwdXJjaGFzZV9vcmRlcnMucmVmZXJlbmNlX25vJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3B1cmNoYXNlX29yZGVycy5pZCcsICdnb29kc19yZWNlaXZlZF9ub3Rlcy5wdXJjaGFzZV9vcmRlcl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignUE9fZGF0ZScsIGZ1bmN0aW9uKCRncm4pewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJGdybi0+cmVsUHVyY2hhc2VPcmRlci0+cG9fZGF0ZSkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ1BPX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlcicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgncG9fZGF0ZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignUE9fcmVmZXJlbmNlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFB1cmNoYXNlT3JkZXI6OnNlbGVjdCgncHVyY2hhc2Vfb3JkZXJzLnBvX2RhdGUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbigncHVyY2hhc2Vfb3JkZXJzLmlkJywgJ2dvb2RzX3JlY2VpdmVkX25vdGVzLnB1cmNoYXNlX29yZGVyX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2dhdGVfaW5fcmVmZXJlbmNlJywgZnVuY3Rpb24oJGdybil7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGRpdiBzdHlsZT0id2lkdGg6IDEwMCUiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJ3aWR0aDogOTAlO2Zsb2F0OiBsZWZ0O2NsZWFyOnJpZ2h0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9ImphdmFzY3JpcHQ6dm9pZCgwKSIgY2xhc3M9ImJ0biBidG4tbGluayIgb25jbGljaz0ic2hvd1FFUE9EZXRhaWxzKCQodGhpcykpIiBkYXRhLXNyYz0iJy5yb3V0ZSgncG1zLmdybi5ncm4tcHJvY2Vzcy5zaG93JywkZ3JuLT5pZCkuJyIgZGF0YS10aXRsZT0iR2F0ZSBJbiBEZXRhaWxzIj4nLiRncm4tPnJlZmVyZW5jZV9uby4nPC9hPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0id2lkdGg6IDEwJTtmbG9hdDogbGVmdDtjbGVhcjpyaWdodCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IGJ0bi14cyIgaHJlZj0iJy4gdXJsKCdwbXMvZ3JuL2dhdGUtaW4tc2xpcC8nLiRncm4tPnB1cmNoYXNlX29yZGVyX2lkLic/Z3JuPScuJGdybi0+aWQpIC4nIiB0YXJnZXQ9Il9ibGFuayIgc3R5bGU9Im1hcmdpbi10b3A6IDcuNXB4Ij48aSBjbGFzcz0ibGEgbGEtcHJpbnQiPjwvaT48L2E+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pic7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignZ2F0ZV9pbl9yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdyZWZlcmVuY2Vfbm8nLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignZ2F0ZV9pbl9yZWZlcmVuY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJCeSgncmVmZXJlbmNlX25vJywgJG9yZGVyKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdnYXRlX2luX3F0eScsIGZ1bmN0aW9uKCRncm4pewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGdybi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5zdW0oJ3F0eScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3JldHVybl9xdHknLCBmdW5jdGlvbigkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRncm4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+d2hlcmUoJ3F1YWxpdHlfZW5zdXJlJywncmV0dXJuLWNoYW5nZScpLT5zdW0oJ3F0eScpLSRncm4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+d2hlcmUoJ3F1YWxpdHlfZW5zdXJlJywncmV0dXJuLWNoYW5nZScpLT5zdW0oJ3JlY2VpdmVkX3F0eScpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdyZWNlaXZlZF9zdGF0dXMnLCBmdW5jdGlvbigkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGdybi0+cmVjZWl2ZWRfc3RhdHVzID09ICdwYXJ0aWFsJyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGNsYXNzPSJidG4gYnRuLXdhcm5pbmcgYnRuLXhzIj5QYXJ0aWFsIFJlY2VpdmVkPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlaWYoJGdybi0+cmVjZWl2ZWRfc3RhdHVzID09ICdmdWxsJyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGNsYXNzPSJidG4gYnRuLXN1Y2Nlc3MgYnRuLXhzIj5GdWxsIFJlY2VpdmVkPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBjbGFzcz0iYnRuIGJ0bi1kYXJrIGJ0bi14cyI+Jy51Y3dvcmRzKCRncm4tPnJlY2VpdmVkX3N0YXR1cykuJzwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignb3B0aW9ucycsIGZ1bmN0aW9uKCRncm4pewogICAgICAgICAgICAgICAgICAgICAgICAkcmV0dXJuZWQgPSBQdXJjaGFzZVJldHVybjo6d2hlcmVIYXMoJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcycsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRncm4pewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2dvb2RzX3JlY2VpdmVkX25vdGVfaWQnLCAkZ3JuLT5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLT53aGVyZSgnc3RhdHVzJywgJ3JldHVybi1jaGFuZ2UnKS0+c3VtKCdyZXR1cm5fcXR5Jyk7CgogICAgICAgICAgICAgICAgICAgICAgICAkcmV0dXJuZWRDb3VudCA9IFB1cmNoYXNlUmV0dXJuOjp3aGVyZUhhcygncmVsR29vZHNSZWNlaXZlZEl0ZW1zJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGdybil7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcsICRncm4tPmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSktPndoZXJlKCdzdGF0dXMnLCAncmV0dXJuLWNoYW5nZScpLT5jb3VudCgpOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmVkID0gUHVyY2hhc2VSZXR1cm46OndoZXJlSGFzKCdyZWxHb29kc1JlY2VpdmVkSXRlbXMnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkZ3JuKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdnb29kc19yZWNlaXZlZF9ub3RlX2lkJywgJGdybi0+aWQpOwogICAgICAgICAgICAgICAgICAgICAgICB9KS0+d2hlcmUoJ3N0YXR1cycsICdyZXR1cm4tY2hhbmdlJyktPnN1bSgncmVjZWl2ZWRfcXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICRjb3VudCA9ICRncm4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcygpLT53aGVyZSgncXVhbGl0eV9lbnN1cmUnLCdyZXR1cm4tY2hhbmdlJyktPmNvdW50KCk7CgogICAgICAgICAgICAgICAgICAgICAgICAkb3B0aW9ucyA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICBpZihhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdxdWFsaXR5LWVuc3VyZS1yZXR1cm4tY2hhbmdlLXJlY2VpdmVkLWxpc3QnKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkY291bnQgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkb3B0aW9ucyAuPSAnPGEgaHJlZj0iJy5yb3V0ZSgncG1zLnF1YWxpdHkuZW5zdXJlLnJldHVybi5jaGFuZ2Uuc2luZ2xlLmxpc3QnLCRncm4tPmlkKS4nIiBjbGFzcz0iYnRuIGJ0bi14cyBidG4taW5mbyI+Jy5fXygnSXRlbXMnKS4nICgnLiRjb3VudC4nKTwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBpZigkcmV0dXJuZWQgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvcHRpb25zIC49ICcmbmJzcDsmbmJzcDs8YSB0YXJnZXQ9Il9fYmxhbmsiIGhyZWY9Iicucm91dGUoJ3Btcy5xdWFsaXR5LnJldHVybi5yZXBsYWNlLml0ZW0ucHJpbnQnLFsnaWQnPT4kZ3JuLT5pZCwndHlwZSc9PidyZXR1cm4tY2hhbmdlLWxpc3QnXSkuJyIgdGl0bGU9IlJldHVybiBSZXBsYWNlIExpc3QiIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi13YXJuaW5nIj48aSBjbGFzcz0ibGFzIGxhLXByaW50Ij48L2k+PC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgCgogICAgICAgICAgICAgICAgICAgICAgICBpZigkYXBwcm92ZWQgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvcHRpb25zIC49ICcmbmJzcDsmbmJzcDs8YSB0YXJnZXQ9Il9fYmxhbmsiIGhyZWY9Iicucm91dGUoJ3Btcy5xdWFsaXR5LnJldHVybi5yZXBsYWNlLml0ZW0ucHJpbnQnLFsnaWQnPT4kZ3JuLT5pZCwndHlwZSc9PidyZXR1cm4tY2hhbmdlJ10pLiciIHRpdGxlPSJSZXR1cm4gUmVwbGFjZSBBcHByb3ZlZCBMaXN0IiBjbGFzcz0iYnRuIGJ0bi14cyBidG4tc3VjY2VzcyI+PGkgY2xhc3M9ImxhcyBsYS1wcmludCI+PC9pPjwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJG9wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPnJhd0NvbHVtbnMoWydQT19yZWZlcmVuY2UnLCAnZ2F0ZV9pbl9yZWZlcmVuY2UnLCAncmVjZWl2ZWRfc3RhdHVzJywgJ29wdGlvbnMnXSkKICAgICAgICAgICAgICAgICAgICAtPm1ha2UodHJ1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdwbXMuYmFja2VuZC5wYWdlcy5xdWFsaXR5LnJldHVybi1jaGFuZ2UtaW5kZXgnLCBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICJRdWFsaXR5IEVuc3VyZSBSZXR1cm4gUmVwbGFjZSBMaXN0IiwKICAgICAgICAgICAgICAgICdoZWFkZXJDb2x1bW5zJyA9PiAkdGhpcy0+cmV0dXJuQ2hhbmdlTGlzdEhlYWRlckNvbHVtbnMoKSwKICAgICAgICAgICAgXSk7CgogICAgICAgIH1jYXRjaChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgKiBTaG93IHRoZSBHcm4gV2lzZSBSZXR1cm4gSXRlbSBMaXN0LgogICAgKgogICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ3JuV2lzZVJldHVybkNoYW5nZUl0ZW1MaXN0KCRpZCkKICAgIHsKICAgICAgICB0cnl7CgogICAgICAgICAgICAkdGl0bGU9IlF1YWxpdHkgRW5zdXJlIFJldHVybiBSZXBsYWNlIExpc3QiOwoKICAgICAgICAgICAgJGNoYW5nZWQgPSBQdXJjaGFzZVJldHVybjo6d2hlcmVIYXMoJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcycsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRpZCl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcsICRpZCk7CiAgICAgICAgICAgIH0pLT53aGVyZSgnc3RhdHVzJywgJ3JldHVybi1jaGFuZ2UnKS0+Z2V0KCk7CgogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMucXVhbGl0eS5yZXR1cm4tY2hhbmdlLWxpc3QnLGNvbXBhY3QoJ3RpdGxlJywnY2hhbmdlZCcpKTsKCiAgICAgICAgfWNhdGNoKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGFwcHJvdmVkSXRlbVByaW50KCRpZCwkdHlwZSkKICAgIHsKICAgICAgICAgdHJ5ewoKICAgICAgICAgICAgJHRpdGxlPSJRdWFsaXR5IEVuc3VyZSBBcHByb3ZlZCBQcmludCBWaWV3IjsKCiAgICAgICAgICAgICRxdW90YXRpb249R29vZHNSZWNlaXZlZE5vdGU6OmZpbmRPckZhaWwoJGlkKTsKCiAgICAgICAgICAgICRnb29kc1JlY2VpdmVkSXRlbUlkID0gR29vZHNSZWNlaXZlZEl0ZW06OndoZXJlKCdnb29kc19yZWNlaXZlZF9ub3RlX2lkJywkaWQpLT53aGVyZSgncXVhbGl0eV9lbnN1cmUnLCR0eXBlKS0+cGx1Y2soJ2lkJyktPmFsbCgpOwoKICAgICAgICAgICAgJGFwcHJvdmFsX2xpc3QgPSBHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW46OndoZXJlSW4oJ2dvb2RzX3JlY2VpdmVkX2l0ZW1faWQnLCRnb29kc1JlY2VpdmVkSXRlbUlkKS0+Z2V0KCk7CgogICAgICAgICAgICByZXR1cm4gdmlld01QREYoJ3Btcy5iYWNrZW5kLnBhZ2VzLnF1YWxpdHkuYXBwcm92ZWQtaXRlbS1wcmludC12aWV3LXBkZicsIFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJHRpdGxlLAogICAgICAgICAgICAgICAgJ2FwcHJvdmFsX2xpc3QnID0+ICRhcHByb3ZhbF9saXN0LAogICAgICAgICAgICAgICAgJ3F1b3RhdGlvbicgPT4gJHF1b3RhdGlvbgogICAgICAgICAgICBdLCAkdGl0bGUsICR0aXRsZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMucXVhbGl0eS5hcHByb3ZlZC1pdGVtLXByaW50LXZpZXcnLGNvbXBhY3QoJ3RpdGxlJywnYXBwcm92YWxfbGlzdCcsJ3F1b3RhdGlvbicpKTsKCiAgICAgICAgfWNhdGNoKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHJldHVybkl0ZW1QcmludFZpZXcoJGlkLCR0eXBlKQogICAgewogICAgICAgICB0cnl7CgogICAgICAgICAgICAkdGl0bGU9IlJldHVybiBJdGVtcyI7CgogICAgICAgICAgICAkcXVvdGF0aW9uID0gR29vZHNSZWNlaXZlZE5vdGU6OmZpbmRPckZhaWwoJGlkKTsKCiAgICAgICAgICAgICRnb29kc1JlY2VpdmVkSXRlbUlkID0gR29vZHNSZWNlaXZlZEl0ZW06OndoZXJlKCdnb29kc19yZWNlaXZlZF9ub3RlX2lkJywkaWQpLT53aGVyZSgncXVhbGl0eV9lbnN1cmUnLCdyZXR1cm4nKS0+cGx1Y2soJ2lkJyktPmFsbCgpOwoKICAgICAgICAgICAgJGNvZGUgPSBQdXJjaGFzZVJldHVybjo6d2hlcmVIYXMoJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcycsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRpZCl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcsICRpZCk7CiAgICAgICAgICAgIH0pLT53aGVyZSgnc3RhdHVzJywgJ3JldHVybicpLT5maXJzdCgpLT5jb2RlOwoKCiAgICAgICAgICAgIGlmICgkdHlwZT09J3JldHVybi1hcHByb3ZlZC1saXN0JykgewogICAgICAgICAgICAgICAgJGFwcHJvdmVkID0gR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luOjp3aGVyZUluKCdnb29kc19yZWNlaXZlZF9pdGVtX2lkJywkZ29vZHNSZWNlaXZlZEl0ZW1JZCktPmdldCgpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgICAgICAgICAndGl0bGUnID0+ICR0aXRsZSwKICAgICAgICAgICAgICAgICAgICAncXVvdGF0aW9uJyA9PiAkcXVvdGF0aW9uLAogICAgICAgICAgICAgICAgICAgICdhcHByb3ZlZCcgPT4gJGFwcHJvdmVkLAogICAgICAgICAgICAgICAgICAgICdjb2RlJyA9PiAkY29kZSwKICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICByZXR1cm4gdmlld01QREYoJ3Btcy5iYWNrZW5kLnBhZ2VzLnF1YWxpdHkucmV0dXJuLWFwcHJvdmVkLWl0ZW0tcHJpbnQtdmlldy1wZGYnLCAkZGF0YSwgJHRpdGxlLCAkdGl0bGUpOwoKICAgICAgICAgICAgICAgIC8vcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnF1YWxpdHkucmV0dXJuLWFwcHJvdmVkLWl0ZW0tcHJpbnQtdmlldycsICRkYXRhKTsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAkcmV0dXJuZWQgPSBQdXJjaGFzZVJldHVybjo6d2hlcmVJbignZ29vZHNfcmVjZWl2ZWRfaXRlbV9pZCcsJGdvb2RzUmVjZWl2ZWRJdGVtSWQpLT53aGVyZSgnc3RhdHVzJywgJ3JldHVybicpLT5nZXQoKTsKCiAgICAgICAgICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgICAgICAgICAndGl0bGUnID0+ICR0aXRsZSwKICAgICAgICAgICAgICAgICAgICAncXVvdGF0aW9uJyA9PiAkcXVvdGF0aW9uLAogICAgICAgICAgICAgICAgICAgICdyZXR1cm5lZCcgPT4gJHJldHVybmVkLAogICAgICAgICAgICAgICAgICAgICdjb2RlJyA9PiAkY29kZSwKICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICByZXR1cm4gdmlld01QREYoJ3Btcy5iYWNrZW5kLnBhZ2VzLnF1YWxpdHkucmV0dXJuLWl0ZW0tcHJpbnQtdmlldy1wZGYnLCAkZGF0YSwgJHRpdGxlLCAkdGl0bGUpOwoKICAgICAgICAgICAgICAgIC8vcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnF1YWxpdHkucmV0dXJuLWl0ZW0tcHJpbnQtdmlldycsICRkYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKCiAgICAgICAgfWNhdGNoKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHJldHVyblJlcGxhY2VJdGVtUHJpbnRWaWV3KCRpZCwkdHlwZSkKICAgIHsKICAgICAgICAgdHJ5ewoKICAgICAgICAgICAgJHRpdGxlPSJSZXR1cm4gUmVwbGFjZSBBcHByb3ZlZCBMaXN0IjsKCiAgICAgICAgICAgICRxdW90YXRpb249R29vZHNSZWNlaXZlZE5vdGU6OmZpbmRPckZhaWwoJGlkKTsKCiAgICAgICAgICAgICRyZXR1cm5DaGFuZ2VMaXN0ID0gR29vZHNSZWNlaXZlZEl0ZW06OndoZXJlKCdnb29kc19yZWNlaXZlZF9ub3RlX2lkJywkaWQpCiAgICAgICAgICAgIC0+d2hlcmUoJ3F1YWxpdHlfZW5zdXJlJywncmV0dXJuLWNoYW5nZScpLT5nZXQoKTsKCiAgICAgICAgICAgICRjb2RlID0gUHVyY2hhc2VSZXR1cm46OndoZXJlSGFzKCdyZWxHb29kc1JlY2VpdmVkSXRlbXMnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkaWQpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2dvb2RzX3JlY2VpdmVkX25vdGVfaWQnLCAkaWQpOwogICAgICAgICAgICB9KS0+d2hlcmUoJ3N0YXR1cycsICdyZXR1cm4tY2hhbmdlJyktPmZpcnN0KCktPmNvZGU7CgogICAgICAgICAgICBpZiAoJHR5cGU9PSdyZXR1cm4tY2hhbmdlLWxpc3QnKSB7CiAgICAgICAgICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgICAgICAgICAndGl0bGUnID0+ICR0aXRsZSwKICAgICAgICAgICAgICAgICAgICAncXVvdGF0aW9uJyA9PiAkcXVvdGF0aW9uLAogICAgICAgICAgICAgICAgICAgICdyZXR1cm5DaGFuZ2VMaXN0JyA9PiAkcmV0dXJuQ2hhbmdlTGlzdCwKICAgICAgICAgICAgICAgICAgICAnY29kZScgPT4gJGNvZGUsCiAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdNUERGKCdwbXMuYmFja2VuZC5wYWdlcy5xdWFsaXR5LnJldHVybi1yZXBsYWNlLXJldHVybi1pdGVtLXByaW50LXZpZXctcGRmJywgJGRhdGEsICR0aXRsZSwgJHRpdGxlKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy9yZXR1cm4gdmlldygncG1zLmJhY2tlbmQucGFnZXMucXVhbGl0eS5yZXR1cm4tcmVwbGFjZS1yZXR1cm4taXRlbS1wcmludC12aWV3Jyxjb21wYWN0KCd0aXRsZScsJ3JldHVybkNoYW5nZUxpc3QnLCdxdW90YXRpb24nLCAnY29kZScpKTsKICAgICAgICAgICAgfWVsc2V7CgogICAgICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ3Btcy5iYWNrZW5kLnBhZ2VzLnF1YWxpdHkucmV0dXJuLXJlcGxhY2UtaXRlbS1wcmludC12aWV3Jyxjb21wYWN0KCd0aXRsZScsJ3JldHVybkNoYW5nZUxpc3QnLCdxdW90YXRpb24nLCAnY29kZScpKTsKICAgICAgICAgICAgfQoKICAgICAgICB9Y2F0Y2goXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBTdG9yZSBhIG5ld2x5IGNyZWF0ZWQgcmVzb3VyY2UgaW4gc3RvcmFnZS4KICAgICAqCiAgICAgKiBAcGFyYW0gIFxJbGx1bWluYXRlXEh0dHBcUmVxdWVzdCAgJHJlcXVlc3QKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gcmV0dXJuQ2hhbmdlUmVjZWl2ZWQoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsgICAgCgogICAgICAgIHRyeXsKCiAgICAgICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgICAgIGZvcmVhY2goJHJlcXVlc3QtPmlkIGFzICRrZXk9PiRpZCl7CgogICAgICAgICAgICAgICAgJG1vZGVsPUdvb2RzUmVjZWl2ZWRJdGVtOjp3aGVyZShbJ2lkJz0+JGlkLCdxdWFsaXR5X2Vuc3VyZSc9PidyZXR1cm4tY2hhbmdlJ10pLT5maXJzdCgpOwogICAgICAgICAgICAgICAgJHByb2R1Y3Q9UHJvZHVjdDo6ZmluZE9yRmFpbCgkbW9kZWwtPnByb2R1Y3RfaWQpOwogICAgICAgICAgICAgICAgJHByZWZpeD0nUUUtUlJQLScuZGF0ZSgneScsIHN0cnRvdGltZShkYXRlKCdZLW0tZCcpKSkuJy1NQk0tJzsKICAgICAgICAgICAgICAgICRyZWZObz11bmlxdWVDb2RlKDE4LCRwcmVmaXgsJ2dvb2RzX3JlY2VpdmVkX2l0ZW1zX3N0b2NrX2luJywnaWQnKTsKCiAgICAgICAgICAgICAgICBpZihpc3NldCgkbW9kZWwtPmlkKSAmJiAkcmVxdWVzdC0+c3RhdHVzPT09J3JlY2VpdmVkJyl7CiAgICAgICAgICAgICAgICAgICAgaWYgKCgkbW9kZWwtPnF0eS0kbW9kZWwtPnJlY2VpdmVkX3F0eSkgPCAkcmVxdWVzdC0+cmVjZWl2ZWRfcXR5WyRrZXldKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhXYXJuaW5nKCdZb3VyIHJldHVybiBxdHkgaXMgZ3JlYXRlciB0aGVuIG1heGltdW0gcXR5Jyk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAkdG90YWxSZWNlaXZlZFF0eSA9ICRtb2RlbC0+cmVjZWl2ZWRfcXR5KyRyZXF1ZXN0LT5yZWNlaXZlZF9xdHlbJGtleV07CgogICAgICAgICAgICAgICAgICAgICRxdWFsaXR5RW5zdXJlPSgkdG90YWxSZWNlaXZlZFF0eT09JG1vZGVsLT5xdHkpPydhcHByb3ZlZCc6J3JldHVybi1jaGFuZ2UnOwoKICAgICAgICAgICAgICAgICAgICAkdXBkYXRlPSRtb2RlbC0+dXBkYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3F1YWxpdHlfZW5zdXJlJyA9PiAkcXVhbGl0eUVuc3VyZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3JlY2VpdmVkX3F0eScgPT4gICR0b3RhbFJlY2VpdmVkUXR5LAogICAgICAgICAgICAgICAgICAgICAgICAndXBkYXRlZF9hdCcgPT4gZGF0ZSgnWS1tLWQgSDppOnMnKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3VwZGF0ZWRfYnknID0+IEF1dGg6OnVzZXIoKS0+aWQKICAgICAgICAgICAgICAgICAgICBdKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCR1cGRhdGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgUHVyY2hhc2VSZXR1cm46OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZ29vZHNfcmVjZWl2ZWRfaXRlbV9pZCc9PiRtb2RlbC0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmV0dXJuX25vdGUnID0+ICRyZXF1ZXN0LT5yZXR1cm5fbm90ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZXR1cm5fcXR5JyA9PiAkcmVxdWVzdC0+cmVjZWl2ZWRfcXR5WyRrZXldLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gJHJlcXVlc3QtPnN0YXR1cywKICAgICAgICAgICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgICAgICAgICAkcmVjZWl2ZWRRdHk9JHJlcXVlc3QtPnJlY2VpdmVkX3F0eVska2V5XTsKICAgICAgICAgICAgICAgICAgICAgICAgJHN1YnRvdGFsPSRyZWNlaXZlZFF0eSokbW9kZWwtPnVuaXRfYW1vdW50OwogICAgICAgICAgICAgICAgICAgICAgICAkZGlzY291bnRBbW91bnQ9ICgkbW9kZWwtPmRpc2NvdW50X3BlcmNlbnRhZ2UgKiAkc3VidG90YWwpLzEwMDsKICAgICAgICAgICAgICAgICAgICAgICAgJHZhdEFtb3VudD0gKCRtb2RlbC0+dmF0X3BlcmNlbnRhZ2UgKiAkc3VidG90YWwpLzEwMDsKCiAgICAgICAgICAgICAgICAgICAgICAgICRHUkl0ZW1zU3RvY2tJbiA9IG5ldyBHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW4oKTsKICAgICAgICAgICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT5wdXJjaGFzZV9vcmRlcl9pZCA9ICRtb2RlbC0+cmVsR29vZHNSZWNlaXZlZE5vdGUtPnB1cmNoYXNlX29yZGVyX2lkOwogICAgICAgICAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPnJlZmVyZW5jZV9ubyA9ICRyZWZObzsKICAgICAgICAgICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT5nb29kc19yZWNlaXZlZF9pdGVtX2lkID0gJG1vZGVsLT5pZDsKICAgICAgICAgICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT51bml0X2Ftb3VudCA9ICRtb2RlbC0+dW5pdF9hbW91bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICRHUkl0ZW1zU3RvY2tJbi0+cmVjZWl2ZWRfcXR5ID0gJHJlY2VpdmVkUXR5OwogICAgICAgICAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPnN1Yl90b3RhbCA9ICRzdWJ0b3RhbDsKICAgICAgICAgICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT5kaXNjb3VudF9wZXJjZW50YWdlID0gJG1vZGVsLT5kaXNjb3VudF9wZXJjZW50YWdlOwogICAgICAgICAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPmRpc2NvdW50ID0gJGRpc2NvdW50QW1vdW50OwogICAgICAgICAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPnZhdF9wZXJjZW50YWdlID0gJG1vZGVsLT52YXRfcGVyY2VudGFnZTsKICAgICAgICAgICAgICAgICAgICAgICAgJEdSSXRlbXNTdG9ja0luLT52YXQgPSAkdmF0QW1vdW50OwogICAgICAgICAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPnRvdGFsX2Ftb3VudCA9ICgkc3VidG90YWwtJGRpc2NvdW50QW1vdW50KSskdmF0QW1vdW50OwogICAgICAgICAgICAgICAgICAgICAgICAkR1JJdGVtc1N0b2NrSW4tPmlzX2dybl9jb21wbGV0ZSA9ICdubyc7CiAgICAgICAgICAgICAgICAgICAgICAgICRHUkl0ZW1zU3RvY2tJbi0+c2F2ZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgZGF0YS1zcmM9Iicucm91dGUoJ3Btcy5ncm4uZ3JuLXByb2Nlc3Muc2hvdycsJG1vZGVsLT5yZWxHb29kc1JlY2VpdmVkTm90ZS0+aWQpLic/dmlldyIgZGF0YS10aXRsZT0iR2F0ZS1JbiBEZXRhaWxzIj5SZWZlcmVuY2UgTm86Jy4kbW9kZWwtPnJlbEdvb2RzUmVjZWl2ZWROb3RlLT5yZWZlcmVuY2Vfbm8uJy4gV2FpdGluZyBmb3IgdGhlIEdSTi48L3NwYW4+JzsKCiAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCcnLGdldE1hbmFnZXJJbmZvKCdTdG9yZS1NYW5hZ2VyJywkbW9kZWwtPnJlbEdvb2RzUmVjZWl2ZWROb3RlLT5yZWxQdXJjaGFzZU9yZGVyLT5ocl91bml0X2lkKSwgJG1lc3NhZ2UsJ3VucmVhZCcsJ3NlbmQtdG8tc3RvcmUnLCcnKTsKCiAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCcnLGdldE1hbmFnZXJJbmZvKCdQdXJjaGFzZS1EZXBhcnRtZW50JyksJG1lc3NhZ2UsJ3VucmVhZCcsJ3NlbnQtdG8tcHVyY2hhc2UnLCcnKTsKCiAgICAgICAgICAgIERCOjpjb21taXQoKTsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5yZWRpcmVjdEJhY2tXaXRoU3VjY2VzcygnU3VjY2Vzc2Z1bGx5IFVwZGF0ZWQgdGhpcyBJdGVtIFF1YWxpdHkgU3RhdHVzISEnLCdwbXMucXVhbGl0eS5lbnN1cmUucmV0dXJuLmNoYW5nZS5saXN0Jyk7CgogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9Cn0K