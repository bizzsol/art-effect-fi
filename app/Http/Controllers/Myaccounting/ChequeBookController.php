<?php
bolt_decrypt( __FILE__ , 'h0SCii'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcTXlhY2NvdW50aW5nOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKCnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQmFua0FjY291bnQ7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQ2hlcXVlQm9vazsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDaGVxdWVCb29rUGFnZTsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDaGVxdWVCb29rUGFnZUVudHJ5Owp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEVudHJ5Owp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXENoZXF1ZVJlZ2lzdGVyOwoKdXNlIEFwcCwgREIsIERhdGFUYWJsZXM7CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xBdXRoOwoKY2xhc3MgQ2hlcXVlQm9va0NvbnRyb2xsZXIgZXh0ZW5kcyBDb250cm9sbGVyCnsKICAgIHB1YmxpYyBmdW5jdGlvbiBoZWFkZXJDb2x1bW5zKCR2YWx1ZSA9ICcnKQogICAgewogICAgICAgIHJldHVybiBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgICAgICBbJ2JhbmtfYWNjb3VudCcsICdiYW5rX2FjY291bnQnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydib29rX251bWJlcicsICdib29rX251bWJlcicsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3JlY2VpdmluZ19kYXRlJywgJ3JlY2VpdmluZ19kYXRlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnY3JlYXRlZF9ieScsICdjcmVhdGVkX2J5JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsndG90YWxfcGFnZXMnLCAndG90YWxfcGFnZXMnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWyd1c2VkX3BhZ2VzJywgJ3VzZWRfcGFnZXMnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydkYW1hZ2VkX3BhZ2VzJywgJ2RhbWFnZWRfcGFnZXMnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydlbXB0eV9wYWdlcycsICdlbXB0eV9wYWdlcycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2FjdGlvbnMnLCAnYWN0aW9ucycsICd0ZXh0LWNlbnRlciddCiAgICAgICAgKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gaW5kZXgoKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChyZXF1ZXN0KCktPmFqYXgoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIERhdGFUYWJsZXM6Om9mKENoZXF1ZUJvb2s6OndpdGgoWwogICAgICAgICAgICAgICAgICAgICdiYW5rQWNjb3VudC5jdXJyZW5jeScsICdwYWdlcycsICdjcmVhdG9yJywgJ3BhZ2VzLmVudHJpZXMnCiAgICAgICAgICAgICAgICBdKSkKICAgICAgICAgICAgICAgICAgICAtPmFkZEluZGV4Q29sdW1uKCkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYmFua19hY2NvdW50JywgZnVuY3Rpb24gKCRib29rKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkYm9vay0+YmFua0FjY291bnQgPyAkYm9vay0+YmFua0FjY291bnQtPm5hbWUgLiAnICgnIC4gJGJvb2stPmJhbmtBY2NvdW50LT5udW1iZXIgLiAnKSAoJyAuICgkYm9vay0+YmFua0FjY291bnQtPmN1cnJlbmN5ID8gJGJvb2stPmJhbmtBY2NvdW50LT5jdXJyZW5jeS0+Y29kZSA6ICcnKSAuICcpJyA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2JhbmtfYWNjb3VudCcsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdiYW5rQWNjb3VudCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+b3JXaGVyZSgnbnVtYmVyJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignYmFua19hY2NvdW50JywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIEJhbmtBY2NvdW50OjpzZWxlY3QoJ2JhbmtfYWNjb3VudHMubmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdiYW5rX2FjY291bnRzLmlkJywgJ2NoZXF1ZV9ib29rcy5iYW5rX2FjY291bnRfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignY3JlYXRlZF9ieScsIGZ1bmN0aW9uICgkYm9vaykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGJvb2stPmNyZWF0b3IgPyAkYm9vay0+Y3JlYXRvci0+bmFtZSA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2NyZWF0ZWRfYnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnY3JlYXRvcicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdjcmVhdGVkX2J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFxBcHBcVXNlcjo6c2VsZWN0KCd1c2Vycy5uYW1lJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3VzZXJzLmlkJywgJ2NoZXF1ZV9ib29rcy5jcmVhdGVkX2J5JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3RvdGFsX3BhZ2VzJywgZnVuY3Rpb24gKCRib29rKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkYm9vay0+cGFnZXMtPmNvdW50KCk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigndXNlZF9wYWdlcycsIGZ1bmN0aW9uICgkYm9vaykgewogICAgICAgICAgICAgICAgICAgICAgICAkdXNlZCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICR1c2VkID0gJGJvb2stPnBhZ2VzLT5maWx0ZXIoZnVuY3Rpb24gKCRwYWdlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHBhZ2UtPmVudHJpZXMtPmNvdW50KCkgPiAwID8gJHBhZ2UtPmlkIDogbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICR1c2VkLT5hbGwoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb3VudCgkdXNlZCk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZGFtYWdlZF9wYWdlcycsIGZ1bmN0aW9uICgkYm9vaykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGJvb2stPnBhZ2VzLT53aGVyZSgnaXNfZGFtYWdlZCcsIDEpLT5jb3VudCgpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2VtcHR5X3BhZ2VzJywgZnVuY3Rpb24gKCRib29rKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR1c2VkID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgJHVzZWQgPSAkYm9vay0+cGFnZXMtPmZpbHRlcihmdW5jdGlvbiAoJHBhZ2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcGFnZS0+ZW50cmllcy0+Y291bnQoKSA+IDAgPyAkcGFnZS0+aWQgOiBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgJHVzZWQtPmFsbCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRib29rLT5wYWdlcy0+Y291bnQoKSAtIChjb3VudCgkdXNlZCkgKyAkYm9vay0+cGFnZXMtPndoZXJlKCdpc19kYW1hZ2VkJywgMSktPmNvdW50KCkpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FjdGlvbnMnLCBmdW5jdGlvbiAoJGJvb2spIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF1dGgoKS0+dXNlcigpLT5oYXNQZXJtaXNzaW9uVG8oJ2NoZXF1ZS1ib29rLXBhZ2VzJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8YSBjbGFzcz0iYnRuIGJ0bi14cyBidG4tc3VjY2VzcyBtci0xIiBocmVmPSInIC4gdXJsKCdhY2NvdW50aW5nL2NoZXF1ZS1ib29rcy8nIC4gJGJvb2stPmlkKSAuICciIHRpdGxlPSJDaGVxdWUgQm9vayBQYWdlcyI+PGkgY2xhc3M9ImxhcyBsYS1ib29rLW9wZW4iPjwvaT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXV0aCgpLT51c2VyKCktPmhhc1Blcm1pc3Npb25UbygnY2hlcXVlLWJvb2stZWRpdCcpICYmICgkYm9vay0+cGFnZXMtPndoZXJlKCdlbnRyeV9pZCcsICc+JywgMCktPmNvdW50KCkgPT0gMCAmJiAkYm9vay0+cGFnZXMtPndoZXJlKCdpc19kYW1hZ2VkJywgMSktPmNvdW50KCkgPT0gMCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8YSBjbGFzcz0iYnRuIGJ0bi14cyBidG4tcHJpbWFyeSIgaHJlZj0iJyAuIHVybCgnYWNjb3VudGluZy9jaGVxdWUtYm9va3MvJyAuICRib29rLT5pZCAuICcvZWRpdCcpIC4gJyI+PGkgY2xhc3M9ImxhIGxhLWVkaXQiPjwvaT48L2E+Jm5ic3A7JzsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF1dGgoKS0+dXNlcigpLT5oYXNQZXJtaXNzaW9uVG8oJ2NoZXF1ZS1ib29rLWRlbGV0ZScpICYmICgkYm9vay0+cGFnZXMtPndoZXJlKCdlbnRyeV9pZCcsICc+JywgMCktPmNvdW50KCkgPT0gMCAmJiAkYm9vay0+cGFnZXMtPndoZXJlKCdpc19kYW1hZ2VkJywgMSktPmNvdW50KCkgPT0gMCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8YSBjbGFzcz0iYnRuIGJ0bi14cyBidG4tZGFuZ2VyIiBvbmNsaWNrPSJkZWxldGVGcm9tQ1JVRCgkKHRoaXMpKSIgZGF0YS1zcmM9IicgLiByb3V0ZSgnYWNjb3VudGluZy5jaGVxdWUtYm9va3MuZGVzdHJveScsICRib29rLT5pZCkgLiAnIj48aSBjbGFzcz0ibGEgbGEtdHJhc2giPjwvaT48L2E+Jm5ic3A7JzsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhY3Rpb25zOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsnYWN0aW9ucyddKQogICAgICAgICAgICAgICAgICAgIC0+dG9Kc29uKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMuY2hlcXVlQm9va3MuaW5kZXgnLCBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICdDaGVxdWUgQm9va3MnLAogICAgICAgICAgICAgICAgJ2hlYWRlckNvbHVtbnMnID0+ICR0aGlzLT5oZWFkZXJDb2x1bW5zKCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGNyZWF0ZSgpCiAgICB7CiAgICAgICAgJGRhdGEgPSBbCiAgICAgICAgICAgICd0aXRsZScgPT4gJ05ldyBDaGVxdWUgYm9vaycsCiAgICAgICAgICAgICdiYW5rQWNjb3VudHMnID0+IEJhbmtBY2NvdW50Ojp3aXRoKFsKICAgICAgICAgICAgICAgICdjdXJyZW5jeScKICAgICAgICAgICAgXSktPmdldCgpLAogICAgICAgIF07CgogICAgICAgIHJldHVybiB2aWV3KCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMuY2hlcXVlQm9va3MuY3JlYXRlJywgJGRhdGEpOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBzdG9yZShSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRyZXF1ZXN0LT52YWxpZGF0ZShbCiAgICAgICAgICAgICdiYW5rX2FjY291bnRfaWQnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdib29rX251bWJlcicgPT4gJ3JlcXVpcmVkfHVuaXF1ZTpjaGVxdWVfYm9va3MnLAogICAgICAgICAgICAncmVjZWl2aW5nX2RhdGUnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdwYWdlX251bWJlcl9mcm9tJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAncGFnZV9udW1iZXJfdG8nID0+ICdyZXF1aXJlZCcsCiAgICAgICAgXSk7CgogICAgICAgIGlmICgkcmVxdWVzdC0+cGFnZV9udW1iZXJfZnJvbSA8IDAgfHwgJHJlcXVlc3QtPnBhZ2VfbnVtYmVyX3RvIDwgMCB8fCAkcmVxdWVzdC0+cGFnZV9udW1iZXJfZnJvbSA+ICRyZXF1ZXN0LT5wYWdlX251bWJlcl90bykgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoIkNoZXF1ZSBib29rIFBhZ2UgbnVtYmVyIGlzIGludmFsaWQhIik7CiAgICAgICAgfQoKICAgICAgICBcREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAkY2hlcXVlQm9vayA9IENoZXF1ZUJvb2s6OmNyZWF0ZSgkcmVxdWVzdC0+YWxsKCkpOwoKICAgICAgICAgICAgJHBhZ2VzID0gW107CiAgICAgICAgICAgIGZvciAoJGkgPSAkcmVxdWVzdC0+cGFnZV9udW1iZXJfZnJvbTsgJGkgPD0gJHJlcXVlc3QtPnBhZ2VfbnVtYmVyX3RvOyAkaSsrKSB7CiAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRwYWdlcywgWwogICAgICAgICAgICAgICAgICAgICdjaGVxdWVfYm9va19pZCcgPT4gJGNoZXF1ZUJvb2stPmlkLAogICAgICAgICAgICAgICAgICAgICdwYWdlX251bWJlcicgPT4gJGksCiAgICAgICAgICAgICAgICAgICAgJ2NyZWF0ZWRfYnknID0+IGF1dGgoKS0+dXNlcigpLT5pZAogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpc3NldCgkcGFnZXNbMF0pKSB7CiAgICAgICAgICAgICAgICBDaGVxdWVCb29rUGFnZTo6aW5zZXJ0KCRwYWdlcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFxEQjo6Y29tbWl0KCk7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+cmVkaXJlY3RCYWNrV2l0aFN1Y2Nlc3MoIkNoZXF1ZSBCb29rIGhhcyBiZWVuIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5IiwgJ2FjY291bnRpbmcuY2hlcXVlLWJvb2tzLmNyZWF0ZScpOwogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIFxEQjo6cm9sbEJhY2soKTsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHBhZ2VzSGVhZGVyQ29sdW1ucygkdmFsdWUgPSAnJykKICAgIHsKICAgICAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgICAgIFsnU0wnLCAnU0wnXSwKICAgICAgICAgICAgWydiYW5rX2FjY291bnQnLCAnYmFua19hY2NvdW50JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnYm9va19udW1iZXInLCAnYm9va19udW1iZXInLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydwYWdlX251bWJlcicsICdwYWdlX251bWJlcicsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3RyYW5zYWN0aW9ucycsICd0cmFuc2FjdGlvbnMnXSwKICAgICAgICAgICAgWydkYW1hZ2VkJywgJ2RhbWFnZWQnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydhY3Rpb25zJywgJ2FjdGlvbnMnLCAndGV4dC1jZW50ZXInXQogICAgICAgICk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHNob3coJGlkKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChyZXF1ZXN0KCktPmFqYXgoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIERhdGFUYWJsZXM6Om9mKAogICAgICAgICAgICAgICAgICAgIENoZXF1ZUJvb2tQYWdlOjp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ2NoZXF1ZUJvb2suYmFua0FjY291bnQuY3VycmVuY3knLAogICAgICAgICAgICAgICAgICAgICAgICAnZW50cmllcy5lbnRyeScKICAgICAgICAgICAgICAgICAgICBdKS0+d2hlcmUoJ2NoZXF1ZV9ib29rX2lkJywgJGlkKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdiYW5rX2FjY291bnQnLCBmdW5jdGlvbiAoJHBhZ2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRwYWdlLT5jaGVxdWVCb29rLT5iYW5rQWNjb3VudCA/ICRwYWdlLT5jaGVxdWVCb29rLT5iYW5rQWNjb3VudC0+bmFtZSAuICcgKCcgLiAkcGFnZS0+Y2hlcXVlQm9vay0+YmFua0FjY291bnQtPm51bWJlciAuICcpICgnIC4gKCRwYWdlLT5jaGVxdWVCb29rLT5iYW5rQWNjb3VudC0+Y3VycmVuY3kgPyAkcGFnZS0+Y2hlcXVlQm9vay0+YmFua0FjY291bnQtPmN1cnJlbmN5LT5jb2RlIDogJycpIC4gJyknIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignYmFua19hY2NvdW50JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2NoZXF1ZUJvb2suYmFua0FjY291bnQnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPm9yV2hlcmUoJ251bWJlcicsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2JhbmtfYWNjb3VudCcsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBDaGVxdWVCb29rOjpzZWxlY3QoJ2JhbmtfYWNjb3VudHMubmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2JhbmtfYWNjb3VudHMnLCAnYmFua19hY2NvdW50cy5pZCcsICc9JywgJ2NoZXF1ZV9ib29rcy5iYW5rX2FjY291bnRfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbignY2hlcXVlX2Jvb2tzLmlkJywgJ2NoZXF1ZV9ib29rX3BhZ2VzLmNoZXF1ZV9ib29rX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2Jvb2tfbnVtYmVyJywgZnVuY3Rpb24gKCRwYWdlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcGFnZS0+Y2hlcXVlQm9vay0+Ym9va19udW1iZXI7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignYm9va19udW1iZXInLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnY2hlcXVlQm9vaycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2Jvb2tfbnVtYmVyJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignYm9va19udW1iZXInLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgQ2hlcXVlQm9vazo6c2VsZWN0KCdjaGVxdWVfYm9va3MuYm9va19udW1iZXInKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbignY2hlcXVlX2Jvb2tzLmlkJywgJ2NoZXF1ZV9ib29rX3BhZ2VzLmNoZXF1ZV9ib29rX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3RyYW5zYWN0aW9ucycsIGZ1bmN0aW9uICgkcGFnZSkgewogICAgICAgICAgICAgICAgICAgICAgICAkdHJhbnNhY3Rpb25zID0gJzxkaXYgc3R5bGU9IndpZHRoOiAyMDBweCI+PHVsIGNsYXNzPSJtYi0wIj4nOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHBhZ2UtPmVudHJpZXMtPmNvdW50KCkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkcGFnZS0+ZW50cmllcyBhcyAka2V5ID0+ICRlbnRyeSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0cmFuc2FjdGlvbnMgLj0gJzxsaT48YSBocmVmPSInIC4gdXJsKCdhY2NvdW50aW5nL2VudHJpZXMvJyAuICRlbnRyeS0+ZW50cnlfaWQpIC4gJyIgdGFyZ2V0PSJfYmxhbmsiPicgLiAkZW50cnktPmVudHJ5LT5udW1iZXIgLiAnPC9saT48L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkdHJhbnNhY3Rpb25zIC49ICc8L3VsPjwvZGl2Pic7CgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRyYW5zYWN0aW9uczsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCd0cmFuc2FjdGlvbnMnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnZW50cmllcy5lbnRyeScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2NvZGUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCd0cmFuc2FjdGlvbnMnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgQ2hlcXVlQm9va1BhZ2VFbnRyeTo6c2VsZWN0KCdlbnRyaWVzLmNvZGUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdlbnRyaWVzJywgJ2VudHJpZXMuaWQnLCAnPScsICdjaGVxdWVfYm9va19wYWdlX2VudHJpZXMuZW50cnlfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbignY2hlcXVlX2Jvb2tfcGFnZV9lbnRyaWVzLmNoZXF1ZV9ib29rX3BhZ2VfaWQnLCAnY2hlcXVlX2Jvb2tfcGFnZXMuaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZGFtYWdlZCcsIGZ1bmN0aW9uICgkcGFnZSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHBhZ2UtPmlzX2RhbWFnZWQgPT0gMSA/ICc8YSBjbGFzcz0iYnRuIGJ0bi14cyBidG4tZGFuZ2VyIj5ZZXM8L2E+JyA6ICgkcGFnZS0+c3RhdHVzCiAgICAgICAgICAgICAgICAgICAgICAgICE9PSBudWxsID8gJzxhIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi13YXJuaW5nIj4nIC4gdWNmaXJzdCgkcGFnZS0+c3RhdHVzKSAuICc8L2E+JyA6ICcnKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhY3Rpb25zJywgZnVuY3Rpb24gKCRwYWdlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdjaGVxdWUtYm9vay1wYWdlLWRhbWFnZScpICYmICRwYWdlLT5lbnRyaWVzLT5jb3VudCgpID09CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAwICYmICRwYWdlLT5pc19kYW1hZ2VkID09IDAgJiYgJHBhZ2UtPnN0YXR1cyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGEgY2xhc3M9ImJ0biBidG4teHMgYnRuLWRhbmdlciBtci0xIiBvbmNsaWNrPSJtYXJrQXNEYW1hZ2VkKCQodGhpcykpIiBkYXRhLXBhZ2UtaWQ9IicgLiAkcGFnZS0+aWQgLiAnIiB0aXRsZT0iTWFyayBhcyBEYW1hZ2VkIj5NYXJrIGFzIERhbWFnZWQ8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF1dGgoKS0+dXNlcigpLT5oYXNQZXJtaXNzaW9uVG8oJ2NoZXF1ZS1ib29rLXBhZ2UtZGFtYWdlJykgJiYgJHBhZ2UtPmVudHJpZXMtPmNvdW50KCkgPT0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgJHBhZ2UtPmlzX2RhbWFnZWQgPT0gMCAmJiAkcGFnZS0+c3RhdHVzID09PSAncGVuZGluZycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8YSBjbGFzcz0iYnRuIGJ0bi14cyBidG4td2FybmluZyBtci0xIiBvbmNsaWNrPSJtYXJrQXNEYW1hZ2VkQXBwcm92ZWQoJCh0aGlzKSkiIGRhdGEtcGFnZS1pZD0iJyAuICRwYWdlLT5pZCAuICciIHRpdGxlPSJNYXJrIGFzIGEgQXBwcm92ZWQiPkFwcHJvdmVkPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdjaGVxdWUtYm9vay10YWctdHJhbnNhY3Rpb25zJykgJiYgJHBhZ2UtPmVudHJpZXMtPmNvdW50KCkgPT0gMCAmJiAkcGFnZS0+aXNfZGFtYWdlZCA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGEgY2xhc3M9ImJ0biBidG4teHMgYnRuLXN1Y2Nlc3MgbXItMSIgb25jbGljaz0idGFnVHJhbnNhY3Rpb25zKCQodGhpcykpIiBkYXRhLXBhZ2UtaWQ9IicgLiAkcGFnZS0+aWQgLiAnIiB0aXRsZT0iVGFnIFRyYW5zYWN0aW9ucyI+VGFnIFRyYW5zYWN0aW9uczwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGFjdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPnJhd0NvbHVtbnMoWyd0cmFuc2FjdGlvbnMnLCAnZGFtYWdlZCcsICdhY3Rpb25zJ10pCiAgICAgICAgICAgICAgICAgICAgLT50b0pzb24oKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5jaGVxdWVCb29rcy5wYWdlcycsIFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJ0NoZXF1ZSBCb29rIFBhZ2VzJywKICAgICAgICAgICAgICAgICdoZWFkZXJDb2x1bW5zJyA9PiAkdGhpcy0+cGFnZXNIZWFkZXJDb2x1bW5zKCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGRhbWFnZSgkaWQpCiAgICB7CiAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5jaGVxdWVCb29rcy5kYW1hZ2UnLCBbCiAgICAgICAgICAgICdwYWdlJyA9PiBDaGVxdWVCb29rUGFnZTo6ZmluZE9yRmFpbCgkaWQpCiAgICAgICAgXSk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGRhbWFnZWQoUmVxdWVzdCAkcmVxdWVzdCwgJGlkKQogICAgewogICAgICAgIFxEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRyZXF1ZXN0LT52YWxpZGF0ZShbCiAgICAgICAgICAgICAgICAnZGFtYWdlZF9hdCcgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAkY2hlcXVlQm9va1BhZ2UgPSBDaGVxdWVCb29rUGFnZTo6ZmluZE9yRmFpbCgkaWQpOwogICAgICAgICAgICAkY2hlcXVlQm9va1BhZ2UtPmZpbGwoJHJlcXVlc3QtPmFsbCgpKTsKICAgICAgICAgICAgJGNoZXF1ZUJvb2tQYWdlLT5zdGF0dXMgPSAncGVuZGluZyc7CiAgICAgICAgICAgICRjaGVxdWVCb29rUGFnZS0+c2F2ZSgpOwoKICAgICAgICAgICAgXERCOjpjb21taXQoKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gIkNoZXF1ZSBCb29rIFBhZ2UgUmVxdWVzdGVkIGZvciBkYW1hZ2Ugc3VjY2Vzc2Z1bGx5IgogICAgICAgICAgICBdKTsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICBcREI6OnJvbGxCYWNrKCk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkdGgtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGRhbWFnZWRBcHByb3ZhbChSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgIFxEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRyZXF1ZXN0LT52YWxpZGF0ZShbCiAgICAgICAgICAgICAgICAnaWQnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgJGNoZXF1ZUJvb2tQYWdlID0gQ2hlcXVlQm9va1BhZ2U6OmZpbmRPckZhaWwoJHJlcXVlc3QtPmlkKTsKICAgICAgICAgICAgJGNoZXF1ZUJvb2tQYWdlLT5maWxsKCRyZXF1ZXN0LT5hbGwoKSk7CiAgICAgICAgICAgICRjaGVxdWVCb29rUGFnZS0+aXNfZGFtYWdlZCA9IDE7CiAgICAgICAgICAgICRjaGVxdWVCb29rUGFnZS0+c3RhdHVzID0gJ2FwcHJvdmVkJzsKICAgICAgICAgICAgJGNoZXF1ZUJvb2tQYWdlLT5zYXZlKCk7CgogICAgICAgICAgICBcREI6OmNvbW1pdCgpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiQ2hlcXVlIEJvb2sgUGFnZSBoYXMgYmVlbiBtYXJrZWQgYXMgRGFtYWdlZCBzdWNjZXNzZnVsbHkiCiAgICAgICAgICAgIF0pOwogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIFxEQjo6cm9sbEJhY2soKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gdGFnVHJhbnNhY3Rpb24oJGlkKQogICAgewogICAgICAgICRwYWdlID0gQ2hlcXVlQm9va1BhZ2U6OmZpbmRPckZhaWwoJGlkKTsKICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLmNoZXF1ZUJvb2tzLnRhZycsIFsKICAgICAgICAgICAgJ3BhZ2UnID0+ICRwYWdlLAogICAgICAgICAgICAnZW50cmllcycgPT4gRW50cnk6OmRvZXNudEhhdmUoJ2NoZXF1ZUJvb2tQYWdlRW50cnknKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygnaXRlbXMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRwYWdlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2NoYXJ0X29mX2FjY291bnRfaWQnLCAkcGFnZS0+Y2hlcXVlQm9vay0+YmFua0FjY291bnQtPmNoYXJ0X29mX2FjY291bnRfaWQpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+Z2V0KFsnaWQnLCAnbnVtYmVyJywgJ2NvZGUnXSksCiAgICAgICAgXSk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHRhZ1RyYW5zYWN0aW9ucyhSZXF1ZXN0ICRyZXF1ZXN0LCAkaWQpCiAgICB7CiAgICAgICAgXERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJHBhZ2UgPSBDaGVxdWVCb29rUGFnZTo6ZmluZE9yRmFpbCgkaWQpOwoKICAgICAgICAgICAgQ2hlcXVlQm9va1BhZ2VFbnRyeTo6d2hlcmUoWydjaGVxdWVfYm9va19wYWdlX2lkJyA9PiAkcGFnZS0+aWRdKS0+ZGVsZXRlKCk7CiAgICAgICAgICAgIGlmIChpc3NldCgkcmVxdWVzdC0+dHJhbnNhY3Rpb25zKSAmJiBjb3VudCgkcmVxdWVzdC0+dHJhbnNhY3Rpb25zKSA+IDApIHsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRyZXF1ZXN0LT50cmFuc2FjdGlvbnMgYXMgJGtleSA9PiAkZW50cnlfaWQpIHsKICAgICAgICAgICAgICAgICAgICAkZW50cnkgPSBFbnRyeTo6ZmluZE9yRmFpbCgkZW50cnlfaWQpOwogICAgICAgICAgICAgICAgICAgIENoZXF1ZUJvb2tQYWdlRW50cnk6OnVwZGF0ZU9yQ3JlYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ2NoZXF1ZV9ib29rX3BhZ2VfaWQnID0+ICRwYWdlLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2VudHJ5X2lkJyA9PiAkZW50cnktPmlkLAogICAgICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgICAgICBDaGVxdWVSZWdpc3Rlcjo6Y3JlYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ2JhbmtfYWNjb3VudF9pZCcgPT4gJHBhZ2UtPmNoZXF1ZUJvb2stPmJhbmtfYWNjb3VudF9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2VudHJ5X2lkJyA9PiAkZW50cnktPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAnc3VwcGxpZXJfbGVkZ2VyX2lkJyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAnZGF0ZXRpbWUnID0+ICRlbnRyeS0+ZGF0ZSAuICcgJyAuICRlbnRyeS0+dGltZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJGVudHJ5LT5lbnRyeVR5cGUtPm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAnY2hlcXVlJywKICAgICAgICAgICAgICAgICAgICAgICAgJ2NoZXF1ZV9udW1iZXInID0+ICRwYWdlLT5wYWdlX251bWJlciwKICAgICAgICAgICAgICAgICAgICAgICAgJ2RlYml0X2NyZWRpdCcgPT4gaXNzZXQoJGVudHJ5LT5pdGVtcy0+d2hlcmUoJ2NoYXJ0X29mX2FjY291bnRfaWQnLCAkcGFnZS0+Y2hlcXVlQm9vay0+YmFua0FjY291bnQtPmNoYXJ0X29mX2FjY291bnRfaWQpLT5maXJzdCgpLT5kZWJpdF9jcmVkaXQpID8gJGVudHJ5LT5pdGVtcy0+d2hlcmUoJ2NoYXJ0X29mX2FjY291bnRfaWQnLCAkcGFnZS0+Y2hlcXVlQm9vay0+YmFua0FjY291bnQtPmNoYXJ0X29mX2FjY291bnRfaWQpLT5maXJzdCgpLT5kZWJpdF9jcmVkaXQgOiAnQycsCiAgICAgICAgICAgICAgICAgICAgICAgICdhbW91bnQnID0+ICRlbnRyeS0+Y3JlZGl0LAogICAgICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAkZW50cnktPm5vdGVzLAogICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBcREI6OmNvbW1pdCgpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiVHJhbnNhY3Rpb25zIGhhdmUgYmVlbiB0YWdnZWQgc3VjY2Vzc2Z1bGx5IgogICAgICAgICAgICBdKTsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICBcREI6OnJvbGxCYWNrKCk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkdGgtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGVkaXQoJGlkKQogICAgewogICAgICAgICRjaGVxdWVCb29rID0gQ2hlcXVlQm9vazo6d2l0aChbCiAgICAgICAgICAgICdiYW5rQWNjb3VudCcKICAgICAgICBdKS0+ZmluZE9yRmFpbCgkaWQpOwogICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAndGl0bGUnID0+ICdFZGl0IENoZXF1ZSBCb29rJywKICAgICAgICAgICAgJ2NoZXF1ZUJvb2snID0+ICRjaGVxdWVCb29rLAogICAgICAgICAgICAnYmFua0FjY291bnRzJyA9PiBCYW5rQWNjb3VudDo6d2l0aChbCiAgICAgICAgICAgICAgICAnY3VycmVuY3knCiAgICAgICAgICAgIF0pLT5nZXQoKSwKICAgICAgICBdOwoKICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLmNoZXF1ZUJvb2tzLmVkaXQnLCAkZGF0YSk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHVwZGF0ZShSZXF1ZXN0ICRyZXF1ZXN0LCAkaWQpCiAgICB7CiAgICAgICAgJHJlcXVlc3QtPnZhbGlkYXRlKFsKICAgICAgICAgICAgJ2JhbmtfYWNjb3VudF9pZCcgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2Jvb2tfbnVtYmVyJyA9PiAncmVxdWlyZWR8dW5pcXVlOmNoZXF1ZV9ib29rcyxib29rX251bWJlciwnIC4gJGlkLAogICAgICAgICAgICAncmVjZWl2aW5nX2RhdGUnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgXSk7CgogICAgICAgIFxEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRjaGVxdWVCb29rID0gQ2hlcXVlQm9vazo6ZmluZE9yRmFpbCgkaWQpOwogICAgICAgICAgICAkY2hlcXVlQm9vay0+ZmlsbCgkcmVxdWVzdC0+YWxsKCkpLT5zYXZlKCk7CgogICAgICAgICAgICBcREI6OmNvbW1pdCgpOwogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoU3VjY2VzcygiQ2hlcXVlIEJvb2sgaGFzIGJlZW4gdXBkYXRlZCBzdWNjZXNzZnVsbHkiKTsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICBcREI6OnJvbGxCYWNrKCk7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBkZXN0cm95KCRpZCkKICAgIHsKICAgICAgICBcREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBDaGVxdWVCb29rOjpmaW5kKCRpZCktPmRlbGV0ZSgpOwogICAgICAgICAgICBcREI6OmNvbW1pdCgpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiQ2hlcXVlIEJvb2sgaGFzIGJlZW4gRGVsZXRlZCEiCiAgICAgICAgICAgIF0pOwogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIFxEQjo6cm9sbEJhY2soKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KICAgIH0KfQo=