<?php
bolt_decrypt( __FILE__ , 'cS8NnV'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcTXlhY2NvdW50aW5nOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKdXNlIERCLCBEYXRhVGFibGVzOwoKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXENvbXBhbnk7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDaGFydE9mQWNjb3VudDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXFNjaGVkdWxlUGF5bWVudDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXFNjaGVkdWxlUGF5bWVudExlZGdlcjsKCgpjbGFzcyBQYXltZW50U2NoZWR1bGVDb250cm9sbGVyIGV4dGVuZHMgQ29udHJvbGxlcgp7ICAgCgogICAgcHVibGljIGZ1bmN0aW9uIGhlYWRlckNvbHVtbnMoJHZhbHVlPScnKQogICAgewogICAgICAgIHJldHVybiBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgICAgICBbJ2NvbXBhbnknLCAnY29tcGFueScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2NvZGUnLCAnY29kZScsJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnbmFtZScsICduYW1lJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnZGF5JywgJ2RheScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2Rlc2NyaXB0aW9uJywgJ2Rlc2NyaXB0aW9uJywndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydkZWJpdF9sZWRnZXJzJywgJ2RlYml0X2xlZGdlcnMnXSwgCiAgICAgICAgICAgIFsnY3JlZGl0X2xlZGdlcnMnLCAnY3JlZGl0X2xlZGdlcnMnXSwgCiAgICAgICAgICAgIFsnYWN0aW9ucycsICdhY3Rpb25zJywgJ3RleHQtY2VudGVyJ10KICAgICAgICApOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBpbmRleCgpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+YWpheCgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gRGF0YXRhYmxlczo6b2YoCiAgICAgICAgICAgICAgICAgICAgU2NoZWR1bGVQYXltZW50Ojp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ2NvbXBhbnknLAogICAgICAgICAgICAgICAgICAgICAgICAnbGVkZ2Vycy5jaGFydE9mQWNjb3VudCcKICAgICAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgLT5hZGRJbmRleENvbHVtbigpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdjb21wYW55JywgZnVuY3Rpb24oJHNjaGVkdWxlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCRzY2hlZHVsZS0+Y29tcGFueS0+Y29kZSkgPyAnWycuJHNjaGVkdWxlLT5jb21wYW55LT5jb2RlLiddICcuJHNjaGVkdWxlLT5jb21wYW55LT5uYW1lIDogJyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2NvbXBhbnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdjb21wYW55JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+b3J3aGVyZSgnY29kZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignY29tcGFueScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIENvbXBhbnk6OnNlbGVjdCgnY29tcGFuaWVzLm5hbWUnKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdjb21wYW5pZXMuaWQnLCAnc2NoZWR1bGVfcGF5bWVudHMuY29tcGFueV9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdkZWJpdF9sZWRnZXJzJywgZnVuY3Rpb24oJHNjaGVkdWxlKSB7CiAgICAgICAgICAgICAgICAgICAgJGxlZGdlcnMgPSAnJzsKICAgICAgICAgICAgICAgICAgICBpZigkc2NoZWR1bGUtPmxlZGdlcnMtPndoZXJlKCd0eXBlJywgJ0QnKS0+Y291bnQoKSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICAkbGVkZ2VycyAuPSAnPG9sPic7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2goJHNjaGVkdWxlLT5sZWRnZXJzLT53aGVyZSgndHlwZScsICdEJykgYXMgJGtleSA9PiAkbGVkZ2VyKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsZWRnZXJzIC49ICc8bGk+WycuJGxlZGdlci0+Y2hhcnRPZkFjY291bnQtPmNvZGUuJ10gJy4kbGVkZ2VyLT5jaGFydE9mQWNjb3VudC0+bmFtZS4nOiAnLiRsZWRnZXItPmFtb3VudC4nPC9saT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICRsZWRnZXJzIC49ICc8L29sPic7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiAkbGVkZ2VyczsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2NyZWRpdF9sZWRnZXJzJywgZnVuY3Rpb24oJHNjaGVkdWxlKSB7CiAgICAgICAgICAgICAgICAgICAgJGxlZGdlcnMgPSAnJzsKICAgICAgICAgICAgICAgICAgICBpZigkc2NoZWR1bGUtPmxlZGdlcnMtPndoZXJlKCd0eXBlJywgJ0MnKS0+Y291bnQoKSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICAkbGVkZ2VycyAuPSAnPG9sPic7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2goJHNjaGVkdWxlLT5sZWRnZXJzLT53aGVyZSgndHlwZScsICdDJykgYXMgJGtleSA9PiAkbGVkZ2VyKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsZWRnZXJzIC49ICc8bGk+WycuJGxlZGdlci0+Y2hhcnRPZkFjY291bnQtPmNvZGUuJ10gJy4kbGVkZ2VyLT5jaGFydE9mQWNjb3VudC0+bmFtZS4nOiAnLiRsZWRnZXItPmFtb3VudC4nPC9saT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICRsZWRnZXJzIC49ICc8L29sPic7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiAkbGVkZ2VyczsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FjdGlvbnMnLCBmdW5jdGlvbigkc2NoZWR1bGUpewogICAgICAgICAgICAgICAgICAgICRhY3Rpb25zID0gJyc7CgogICAgICAgICAgICAgICAgICAgIGlmKGF1dGgoKS0+dXNlcigpLT5oYXNQZXJtaXNzaW9uVG8oJ2Nvc3QtY2VudHJlLWVkaXQnKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8YSBjbGFzcz0iYnRuIGJ0bi14cyBidG4tcHJpbWFyeSByb3VuZGVkLWNpcmNsZSBtLTEiIGhyZWY9IicuIHVybCgnYWNjb3VudGluZy9wYXltZW50LXNjaGVkdWxlcy8nLiRzY2hlZHVsZS0+aWQuJy9lZGl0P2NvbXBhbnlfaWQ9Jy4kc2NoZWR1bGUtPmNvbXBhbnlfaWQpLiciPjxpIGNsYXNzPSJsYXMgbGEtZWRpdCI+PC9pPjwvYT4nOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYoYXV0aCgpLT51c2VyKCktPmhhc1Blcm1pc3Npb25UbygnY29zdC1jZW50cmUtZGVsZXRlJykpewogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGEgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBjbGFzcz0iYnRuIGJ0bi14cyBidG4tZGFuZ2VyIG0tMSIgZGF0YS1zcmM9Iicucm91dGUoJ2FjY291bnRpbmcucGF5bWVudC1zY2hlZHVsZXMuZGVzdHJveScsICRzY2hlZHVsZS0+aWQpLiciIG9uY2xpY2s9ImRlbGV0ZUZyb21DUlVEKCQodGhpcykpIj48aSBjbGFzcz0ibGEgbGEtdHJhc2giPjwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhY3Rpb25zOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+cmF3Q29sdW1ucyhbJ2RlYml0X2xlZGdlcnMnLCAnY3JlZGl0X2xlZGdlcnMnLCAnYWN0aW9ucyddKQogICAgICAgICAgICAgICAgLT5tYWtlKHRydWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gIlBheW1lbnQgU2NoZWR1bGVzIiwKICAgICAgICAgICAgICAgICdoZWFkZXJDb2x1bW5zJyA9PiAkdGhpcy0+aGVhZGVyQ29sdW1ucygpLAogICAgICAgICAgICBdOwoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5wYXltZW50U2NoZWR1bGVzLmluZGV4JywgJGRhdGEpOwogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gY3JlYXRlKCkKICAgIHsKICAgICAgICAkY29tcGFueSA9IENvbXBhbnk6OmZpbmQocmVxdWVzdCgpLT5nZXQoJ2NvbXBhbnlfaWQnKSk7CiAgICAgICAgJGRhdGEgPSBbCiAgICAgICAgICAgICd0aXRsZScgPT4gJ05ldyBQYXltZW50IFNjaGVkdWxlJywKICAgICAgICAgICAgJ2NvbXBhbmllcycgPT4gQ29tcGFueTo6YWxsKCksCiAgICAgICAgICAgICdjb21wYW55JyA9PiAkY29tcGFueSwKICAgICAgICAgICAgJ2NoYXJ0T2ZBY2NvdW50c09wdGlvbnMnID0+IGNoYXJ0T2ZBY2NvdW50c09wdGlvbnMoW10sIDAsIDAsIGdldEFsbEdyb3VwQW5kTGVkZ2VycygpLCBmYWxzZSwgJ3llcycsIGZhbHNlLCBpc3NldCgkY29tcGFueS0+aWQpID8gWyRjb21wYW55LT5pZF0gOiBbXSksCiAgICAgICAgICAgICdjb3N0Q2VudHJlcycgPT4gaXNzZXQoJGNvbXBhbnktPmlkKSA/IGdldENvc3RDZW50cmVzKHRydWUsICRjb21wYW55LT5pZCkgOiAnJywKICAgICAgICBdOwoKICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLnBheW1lbnRTY2hlZHVsZXMuY3JlYXRlJywgJGRhdGEpOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBzdG9yZShSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRyZXF1ZXN0LT52YWxpZGF0ZShbCiAgICAgICAgICAgICdjb21wYW55X2lkJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnbmFtZScgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2RheScgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2RlYml0X2Nvc3RfY2VudHJlcycgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2RlYml0X2Nvc3RfY2VudHJlcy4qJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnZGViaXRfbGVkZ2VycycgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2RlYml0X2xlZGdlcnMuKicgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2RlYml0X2xlZGdlcl9hbW91bnRzJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnZGViaXRfbGVkZ2VyX2Ftb3VudHMuKicgPT4gJ3JlcXVpcmVkJywKCiAgICAgICAgICAgICdjcmVkaXRfY29zdF9jZW50cmVzJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnY3JlZGl0X2Nvc3RfY2VudHJlcy4qJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnY3JlZGl0X2xlZGdlcnMnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdjcmVkaXRfbGVkZ2Vycy4qJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnY3JlZGl0X2xlZGdlcl9hbW91bnRzJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnY3JlZGl0X2xlZGdlcl9hbW91bnRzLionID0+ICdyZXF1aXJlZCcsCiAgICAgICAgXSk7CgogICAgICAgIGlmKGFycmF5X3N1bShpc3NldCgkcmVxdWVzdC0+ZGViaXRfbGVkZ2VyX2Ftb3VudHNbMF0pID8gJHJlcXVlc3QtPmRlYml0X2xlZGdlcl9hbW91bnRzIDogW10pICE9IGFycmF5X3N1bShpc3NldCgkcmVxdWVzdC0+Y3JlZGl0X2xlZGdlcl9hbW91bnRzWzBdKSA/ICRyZXF1ZXN0LT5jcmVkaXRfbGVkZ2VyX2Ftb3VudHMgOiBbXSkpewogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gIlRvdGFsIERlYml0ICYgY3JlZGl0IGRvZXMgbm90IG1hdGNoZWQhIgogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnl7CiAgICAgICAgICAgICRzY2hlZHVsZSA9IFNjaGVkdWxlUGF5bWVudDo6Y3JlYXRlKFsKICAgICAgICAgICAgICAgICdjb21wYW55X2lkJyA9PiAkcmVxdWVzdC0+Y29tcGFueV9pZCwKICAgICAgICAgICAgICAgICdjb2RlJyA9PiBcU3RyOjpyYW5kb20oOCksCiAgICAgICAgICAgICAgICAnbmFtZScgPT4gJHJlcXVlc3QtPm5hbWUsCiAgICAgICAgICAgICAgICAnZGF5JyA9PiAkcmVxdWVzdC0+ZGF5LAogICAgICAgICAgICAgICAgJ2Rlc2NyaXB0aW9uJyA9PiAkcmVxdWVzdC0+ZGVzY3JpcHRpb24sCiAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgJGxlZGdlcnMgPSBbXTsKICAgICAgICAgICAgaWYoaXNzZXQoJHJlcXVlc3QtPmRlYml0X2xlZGdlcnNbMF0pKXsKICAgICAgICAgICAgICAgIGZvcmVhY2goJHJlcXVlc3QtPmRlYml0X2xlZGdlcnMgYXMgJGtleSA9PiAkY2hhcnRfb2ZfYWNjb3VudF9pZCl7CiAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkbGVkZ2VycywgWwogICAgICAgICAgICAgICAgICAgICAgICAnc2NoZWR1bGVfcGF5bWVudF9pZCcgPT4gJHNjaGVkdWxlLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAkcmVxdWVzdC0+ZGViaXRfY29zdF9jZW50cmVzWyRrZXldLAogICAgICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJGNoYXJ0X29mX2FjY291bnRfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAnRCcsCiAgICAgICAgICAgICAgICAgICAgICAgICdhbW91bnQnID0+ICRyZXF1ZXN0LT5kZWJpdF9sZWRnZXJfYW1vdW50c1ska2V5XSwKICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoaXNzZXQoJHJlcXVlc3QtPmNyZWRpdF9sZWRnZXJzWzBdKSl7CiAgICAgICAgICAgICAgICBmb3JlYWNoKCRyZXF1ZXN0LT5jcmVkaXRfbGVkZ2VycyBhcyAka2V5ID0+ICRjaGFydF9vZl9hY2NvdW50X2lkKXsKICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRsZWRnZXJzLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICdzY2hlZHVsZV9wYXltZW50X2lkJyA9PiAkc2NoZWR1bGUtPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRyZXF1ZXN0LT5jcmVkaXRfY29zdF9jZW50cmVzWyRrZXldLAogICAgICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJGNoYXJ0X29mX2FjY291bnRfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAnQycsCiAgICAgICAgICAgICAgICAgICAgICAgICdhbW91bnQnID0+ICRyZXF1ZXN0LT5jcmVkaXRfbGVkZ2VyX2Ftb3VudHNbJGtleV0sCiAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKGlzc2V0KCRsZWRnZXJzWzBdKSl7CiAgICAgICAgICAgICAgICBTY2hlZHVsZVBheW1lbnRMZWRnZXI6Omluc2VydCgkbGVkZ2Vycyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNlc3Npb24oKS0+Zmxhc2goJ2FsZXJ0LXR5cGUnLCAnc3VjY2VzcycpOwogICAgICAgICAgICBzZXNzaW9uKCktPmZsYXNoKCdtZXNzYWdlJywgIlBheW1lbnQgU2NoZWR1bGUgU2F2ZWQgU3VjY2Vzc2Z1bGx5LiIpOwoKICAgICAgICAgICAgREI6OmNvbW1pdCgpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZQogICAgICAgICAgICBdKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkdGgtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHNob3coJGlkKQogICAgewogICAgICAgIAogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBlZGl0KCRpZCkKICAgIHsKICAgICAgICAkY29tcGFueSA9IENvbXBhbnk6OmZpbmQocmVxdWVzdCgpLT5nZXQoJ2NvbXBhbnlfaWQnKSk7CiAgICAgICAgJGRhdGEgPSBbCiAgICAgICAgICAgICd0aXRsZScgPT4gJ0VkaXQgUGF5bWVudCBTY2hlZHVsZScsCiAgICAgICAgICAgICdjb21wYW5pZXMnID0+IENvbXBhbnk6OmFsbCgpLAogICAgICAgICAgICAnY29tcGFueScgPT4gJGNvbXBhbnksCiAgICAgICAgICAgICdzY2hlZHVsZScgPT4gU2NoZWR1bGVQYXltZW50Ojp3aXRoKFsKICAgICAgICAgICAgICAgICdsZWRnZXJzJwogICAgICAgICAgICBdKS0+ZmluZE9yRmFpbCgkaWQpLAogICAgICAgICAgICAnY2hhcnRPZkFjY291bnRzT3B0aW9ucycgPT4gY2hhcnRPZkFjY291bnRzT3B0aW9ucyhbXSwgMCwgMCwgZ2V0QWxsR3JvdXBBbmRMZWRnZXJzKCksIGZhbHNlLCAneWVzJywgZmFsc2UsIGlzc2V0KCRjb21wYW55LT5pZCkgPyBbJGNvbXBhbnktPmlkXSA6IFtdKSwKICAgICAgICAgICAgJ2Nvc3RDZW50cmVzJyA9PiBpc3NldCgkY29tcGFueS0+aWQpID8gZ2V0Q29zdENlbnRyZXModHJ1ZSwgJGNvbXBhbnktPmlkKSA6ICcnLAogICAgICAgIF07CgogICAgICAgIHJldHVybiB2aWV3KCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMucGF5bWVudFNjaGVkdWxlcy5lZGl0JywgJGRhdGEpOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiB1cGRhdGUoUmVxdWVzdCAkcmVxdWVzdCwgJGlkKQogICAgewogICAgICAgICRyZXF1ZXN0LT52YWxpZGF0ZShbCiAgICAgICAgICAgICdjb21wYW55X2lkJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnbmFtZScgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2RheScgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2RlYml0X2xlZGdlcnMnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdkZWJpdF9sZWRnZXJzLionID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdkZWJpdF9sZWRnZXJfYW1vdW50cycgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2RlYml0X2xlZGdlcl9hbW91bnRzLionID0+ICdyZXF1aXJlZCcsCiAgICAgICAgXSk7CgogICAgICAgIGlmKGFycmF5X3N1bShpc3NldCgkcmVxdWVzdC0+ZGViaXRfbGVkZ2VyX2Ftb3VudHNbMF0pID8gJHJlcXVlc3QtPmRlYml0X2xlZGdlcl9hbW91bnRzIDogW10pICE9IGFycmF5X3N1bShpc3NldCgkcmVxdWVzdC0+Y3JlZGl0X2xlZGdlcl9hbW91bnRzWzBdKSA/ICRyZXF1ZXN0LT5jcmVkaXRfbGVkZ2VyX2Ftb3VudHMgOiBbXSkpewogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gIlRvdGFsIERlYml0ICYgY3JlZGl0IGRvZXMgbm90IG1hdGNoZWQhIgogICAgICAgICAgICBdKTsKICAgICAgICB9CgogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgdHJ5ewogICAgICAgICAgICAkc2NoZWR1bGUgPSBTY2hlZHVsZVBheW1lbnQ6OmZpbmRPckZhaWwoJGlkKTsKICAgICAgICAgICAgJHNjaGVkdWxlLT5jb21wYW55X2lkID0gJHJlcXVlc3QtPmNvbXBhbnlfaWQ7CiAgICAgICAgICAgICRzY2hlZHVsZS0+bmFtZSA9ICRyZXF1ZXN0LT5uYW1lOwogICAgICAgICAgICAkc2NoZWR1bGUtPmRheSA9ICRyZXF1ZXN0LT5kYXk7CiAgICAgICAgICAgICRzY2hlZHVsZS0+ZGVzY3JpcHRpb24gPSAkcmVxdWVzdC0+ZGVzY3JpcHRpb247CiAgICAgICAgICAgICRzY2hlZHVsZS0+c2F2ZSgpOwoKICAgICAgICAgICAgU2NoZWR1bGVQYXltZW50TGVkZ2VyOjp3aGVyZSgnc2NoZWR1bGVfcGF5bWVudF9pZCcsICRzY2hlZHVsZS0+aWQpLT5mb3JjZURlbGV0ZSgpOwogICAgICAgICAgICAkbGVkZ2VycyA9IFtdOwogICAgICAgICAgICBpZihpc3NldCgkcmVxdWVzdC0+ZGViaXRfbGVkZ2Vyc1swXSkpewogICAgICAgICAgICAgICAgZm9yZWFjaCgkcmVxdWVzdC0+ZGViaXRfbGVkZ2VycyBhcyAka2V5ID0+ICRjaGFydF9vZl9hY2NvdW50X2lkKXsKICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRsZWRnZXJzLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICdzY2hlZHVsZV9wYXltZW50X2lkJyA9PiAkc2NoZWR1bGUtPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRyZXF1ZXN0LT5kZWJpdF9jb3N0X2NlbnRyZXNbJGtleV0sCiAgICAgICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkY2hhcnRfb2ZfYWNjb3VudF9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdEJywKICAgICAgICAgICAgICAgICAgICAgICAgJ2Ftb3VudCcgPT4gJHJlcXVlc3QtPmRlYml0X2xlZGdlcl9hbW91bnRzWyRrZXldLAogICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZihpc3NldCgkcmVxdWVzdC0+Y3JlZGl0X2xlZGdlcnNbMF0pKXsKICAgICAgICAgICAgICAgIGZvcmVhY2goJHJlcXVlc3QtPmNyZWRpdF9sZWRnZXJzIGFzICRrZXkgPT4gJGNoYXJ0X29mX2FjY291bnRfaWQpewogICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGxlZGdlcnMsIFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3NjaGVkdWxlX3BheW1lbnRfaWQnID0+ICRzY2hlZHVsZS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJHJlcXVlc3QtPmNyZWRpdF9jb3N0X2NlbnRyZXNbJGtleV0sCiAgICAgICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkY2hhcnRfb2ZfYWNjb3VudF9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdDJywKICAgICAgICAgICAgICAgICAgICAgICAgJ2Ftb3VudCcgPT4gJHJlcXVlc3QtPmNyZWRpdF9sZWRnZXJfYW1vdW50c1ska2V5XSwKICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoaXNzZXQoJGxlZGdlcnNbMF0pKXsKICAgICAgICAgICAgICAgIFNjaGVkdWxlUGF5bWVudExlZGdlcjo6aW5zZXJ0KCRsZWRnZXJzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc2Vzc2lvbigpLT5mbGFzaCgnYWxlcnQtdHlwZScsICdzdWNjZXNzJyk7CiAgICAgICAgICAgIHNlc3Npb24oKS0+Zmxhc2goJ21lc3NhZ2UnLCAiUGF5bWVudCBTY2hlZHVsZSBVcGRhdGVkIFN1Y2Nlc3NmdWxseS4iKTsKCiAgICAgICAgICAgIERCOjpjb21taXQoKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUKICAgICAgICAgICAgXSk7CiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJHRoLT5nZXRNZXNzYWdlKCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBkZXN0cm95KCRpZCkKICAgIHsKICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeXsKICAgICAgICAgICAgU2NoZWR1bGVQYXltZW50OjpmaW5kT3JGYWlsKCRpZCktPmRlbGV0ZSgpOwogICAgICAgICAgICBEQjo6Y29tbWl0KCk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJQYXltZW50IFNjaGVkdWxlcyBoYXMgYmVlbiBEZWxldGVkISIKICAgICAgICAgICAgXSk7CiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJHRoLT5nZXRNZXNzYWdlKCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfQogICAgfQp9Cg==