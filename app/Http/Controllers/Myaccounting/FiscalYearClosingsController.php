<?php
bolt_decrypt( __FILE__ , '4s1eUn'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcTXlhY2NvdW50aW5nOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKCnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQ29tcGFueTsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xGaXNjYWxZZWFyOwp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEZpc2NhbFllYXJDbG9zaW5nOwp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEZpc2NhbFllYXJDbG9zaW5nTGVkZ2VyOwp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXENoYXJ0T2ZBY2NvdW50Owp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEVudHJ5SXRlbTsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xFeGNoYW5nZVJhdGU7Cgp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEZpc2NhbFllYXJPcGVuaW5nOwp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEZpc2NhbFllYXJPcGVuaW5nVXNlcjsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xGaXNjYWxZZWFyT3BlbmluZ0VudHJ5OwoKdXNlIEFwcCwgREIsIERhdGFUYWJsZXM7CgpjbGFzcyBGaXNjYWxZZWFyQ2xvc2luZ3NDb250cm9sbGVyIGV4dGVuZHMgQ29udHJvbGxlcgp7ICAgCiAgICAvKioKICAgICAqIFNldCBnbG9iYWwgZGF0YSB0YWJsZSBoZWFkZXJzLgogICAgICoKICAgICAqIEByZXR1cm4gaGVhZGVyQ29sdW1ucwogICAgICovCiAgICAgcHVibGljIGZ1bmN0aW9uIGhlYWRlckNvbHVtbnMoJHZhbHVlPScnKQogICAgIHsKICAgICAgICAkcm93cyA9ICBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgICAgICBbJ2NvbXBhbnknLCAnY29tcGFueScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3JlZmVyZW5jZScsICdyZWZlcmVuY2UnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydkYXRlJywgJ2RhdGUnLCd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3RpbWUnLCAndGltZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2Zyb21fZmlzY2FsX3llYXInLCAnZnJvbV9maXNjYWxfeWVhcicsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3RvX2Zpc2NhbF95ZWFyJywgJ3RvX2Zpc2NhbF95ZWFyJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnYmFsYW5jZScsICdiYWxhbmNlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsncHJvZml0X2xvc3MnLCAncHJvZml0X2xvc3MnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydyZXRhaW5lZF9lYXJuaW5ncycsICdyZXRhaW5lZF9lYXJuaW5ncycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3Byb2Nlc3NlZF9ieScsICdwcm9jZXNzZWRfYnknLCAndGV4dC1jZW50ZXInXSwKICAgICAgICApOwogICAgICAgIHJldHVybiAkcm93czsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gaW5kZXgoKQogICAgewogICAgICAgICR0aXRsZSA9ICdGaXNjYWwgWWVhciBDbG9zaW5ncyc7CiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgICRmaXNjYWxZZWFyQ2xvc2luZ3MgPSBGaXNjYWxZZWFyQ2xvc2luZzo6d2l0aChbCiAgICAgICAgICAgICAgICAnZnJvbUZpc2NhbFllYXInLAogICAgICAgICAgICAgICAgJ3RvRmlzY2FsWWVhcicsCiAgICAgICAgICAgICAgICAnY3JlYXRvcicKICAgICAgICAgICAgXSkKICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgnaWQnLCAnZGVzYycpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChyZXF1ZXN0KCktPmFqYXgoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIERhdGF0YWJsZXM6Om9mKCRmaXNjYWxZZWFyQ2xvc2luZ3MpCiAgICAgICAgICAgICAgICAtPmFkZEluZGV4Q29sdW1uKCkKCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignY29tcGFueScsIGZ1bmN0aW9uKCRjbG9zaW5nKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGNsb3NpbmctPmNvbXBhbnkgPyAnWycuJGNsb3NpbmctPmNvbXBhbnktPmNvZGUuJ10gJy4kY2xvc2luZy0+Y29tcGFueS0+bmFtZSA6ICcnOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdjb21wYW55JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnY29tcGFueScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnY29kZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+b3JXaGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2NvbXBhbnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBDb21wYW55OjpzZWxlY3QoJ2NvbXBhbmllcy5uYW1lJykKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbignY29tcGFuaWVzLmlkJywgJ2Zpc2NhbF95ZWFyX2Nsb3NpbmdzLmNvbXBhbnlfaWQnKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigncmVmZXJlbmNlJywgZnVuY3Rpb24oJGNsb3NpbmcpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iJy51cmwoJ2FjY291bnRpbmcvZmlzY2FsLXllYXItY2xvc2luZ3MvJy4kY2xvc2luZy0+aWQpLiciPicuJGNsb3NpbmctPnJlZmVyZW5jZS4nPC9hPic7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCd0aW1lJywgZnVuY3Rpb24oJGNsb3NpbmcpewogICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlKCdnOmkgYScsIHN0cnRvdGltZSgkY2xvc2luZy0+dGltZSkpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2Zyb21fZmlzY2FsX3llYXInLCBmdW5jdGlvbigkY2xvc2luZyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRjbG9zaW5nLT5mcm9tRmlzY2FsWWVhciA/ICRjbG9zaW5nLT5mcm9tRmlzY2FsWWVhci0+dGl0bGUuJyB8ICcuZGF0ZSgnZC1NLXknLCBzdHJ0b3RpbWUoJGNsb3NpbmctPmZyb21GaXNjYWxZZWFyLT5zdGFydCkpLicgdG8gJy5kYXRlKCdkLU0teScsIHN0cnRvdGltZSgkY2xvc2luZy0+ZnJvbUZpc2NhbFllYXItPmVuZCkpIDogJyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2Zyb21fZmlzY2FsX3llYXInLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdmcm9tRmlzY2FsWWVhcicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgndGl0bGUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPm9yV2hlcmUoJ3N0YXJ0JywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5vcldoZXJlKCdlbmQnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdmcm9tX2Zpc2NhbF95ZWFyJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgRmlzY2FsWWVhcjo6c2VsZWN0KCdmaXNjYWxfeWVhcnMudGl0bGUnKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdmaXNjYWxfeWVhcnMuaWQnLCAnZmlzY2FsX3llYXJfY2xvc2luZ3MuZnJvbV9maXNjYWxfeWVhcl9pZCcpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3RvX2Zpc2NhbF95ZWFyJywgZnVuY3Rpb24oJGNsb3NpbmcpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkY2xvc2luZy0+dG9GaXNjYWxZZWFyID8gJGNsb3NpbmctPnRvRmlzY2FsWWVhci0+dGl0bGUuJyB8ICcuZGF0ZSgnZC1NLXknLCBzdHJ0b3RpbWUoJGNsb3NpbmctPnRvRmlzY2FsWWVhci0+c3RhcnQpKS4nIHRvICcuZGF0ZSgnZC1NLXknLCBzdHJ0b3RpbWUoJGNsb3NpbmctPnRvRmlzY2FsWWVhci0+ZW5kKSkgOiAnJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigndG9fZmlzY2FsX3llYXInLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCd0b0Zpc2NhbFllYXInLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3RpdGxlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5vcldoZXJlKCdzdGFydCcsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+b3JXaGVyZSgnZW5kJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbigndG9fZmlzY2FsX3llYXInLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBGaXNjYWxZZWFyOjpzZWxlY3QoJ2Zpc2NhbF95ZWFycy50aXRsZScpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ2Zpc2NhbF95ZWFycy5pZCcsICdmaXNjYWxfeWVhcl9jbG9zaW5ncy50b19maXNjYWxfeWVhcl9pZCcpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3Byb2Nlc3NlZF9ieScsIGZ1bmN0aW9uKCRjbG9zaW5nKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGNsb3NpbmctPmNyZWF0b3IgPyAkY2xvc2luZy0+Y3JlYXRvci0+bmFtZSA6ICcnOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdwcm9jZXNzZWRfYnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdjcmVhdG9yJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbigncHJvY2Vzc2VkX2J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgXEFwcFxVc2VyOjpzZWxlY3QoJ3VzZXJzLm5hbWUnKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCd1c2Vycy5pZCcsICdmaXNjYWxfeWVhcl9jbG9zaW5ncy5jcmVhdGVkX2F0JykKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAtPnJhd0NvbHVtbnMoWydyZWZlcmVuY2UnXSkKICAgICAgICAgICAgICAgIC0+bWFrZSh0cnVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGRhdGEgPSBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICR0aXRsZSwKICAgICAgICAgICAgICAgICdoZWFkZXJDb2x1bW5zJyA9PiAkdGhpcy0+aGVhZGVyQ29sdW1ucygpLAogICAgICAgICAgICBdOwoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5maXNjYWxZZWFyQ2xvc2luZ3MuaW5kZXgnLCAkZGF0YSk7CiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBjcmVhdGUoKQogICAgewogICAgICAgICRjb21wYW5pZXMgPSBDb21wYW55OjphbGwoKTsKICAgICAgICAkY29tcGFueSA9IGZhbHNlOwoKICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgJ3RpdGxlJyA9PiAnUnVuIEZpc2NhbCBZZWFyIENsb3NpbmcnLAogICAgICAgICAgICAnY29tcGFuaWVzJyA9PiAkY29tcGFuaWVzCiAgICAgICAgXTsKCiAgICAgICAgaWYocmVxdWVzdCgpLT5oYXMoJ2NvbXBhbnlfaWQnKSl7CiAgICAgICAgICAgICRjb21wYW55ID0gQ29tcGFueTo6ZmluZE9yRmFpbChyZXF1ZXN0KCktPmdldCgnY29tcGFueV9pZCcpKTsKICAgICAgICAgICAgaWYoaXNzZXQoJGNvbXBhbnktPmlkKSl7CiAgICAgICAgICAgICAgICAkYWNjb3VudERlZmF1bHRTZXR0aW5ncyA9IGFjY291bnREZWZhdWx0U2V0dGluZ3MoKTsKICAgICAgICAgICAgICAgICRiYWxhbmNlU2hlZXRJdGVtcyA9IGlzc2V0KGpzb25fZGVjb2RlKCRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydiYWxhbmNlX3NoZWV0X2l0ZW1zJ10sIHRydWUpWzBdKSA/IGpzb25fZGVjb2RlKCRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydiYWxhbmNlX3NoZWV0X2l0ZW1zJ10sIHRydWUpIDogW107CiAgICAgICAgICAgICAgICAkcHJvZml0TG9zc0l0ZW1zID0gaXNzZXQoanNvbl9kZWNvZGUoJGFjY291bnREZWZhdWx0U2V0dGluZ3NbJ3Byb2ZpdF9sb3NzX2l0ZW1zJ10sIHRydWUpWzBdKSA/IGpzb25fZGVjb2RlKCRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydwcm9maXRfbG9zc19pdGVtcyddLCB0cnVlKSA6IFtdOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAkZmlzY2FsWWVhciA9IGdldEFjdGl2ZUZpc2NhbFllYXIoJGNvbXBhbnktPmlkKTsKICAgICAgICAgICAgICAgICRzeXN0ZW1DdXJyZW5jeSA9IHN5c3RlbUN1cnJlbmN5KCk7CgogICAgICAgICAgICAgICAgJGRlYml0VHJhbnNhY3Rpb25zID0gRW50cnlJdGVtOjpqb2luKCdlbnRyaWVzJywgJ2VudHJpZXMuaWQnLCAnPScsICdlbnRyeV9pdGVtcy5lbnRyeV9pZCcpCiAgICAgICAgICAgICAgICAtPmpvaW4oJ2Nvc3RfY2VudHJlcycsICdjb3N0X2NlbnRyZXMuaWQnLCAnPScsICdlbnRyeV9pdGVtcy5jb3N0X2NlbnRyZV9pZCcpCiAgICAgICAgICAgICAgICAtPmpvaW4oJ3Byb2ZpdF9jZW50cmVzJywgJ3Byb2ZpdF9jZW50cmVzLmlkJywgJz0nLCAnY29zdF9jZW50cmVzLnByb2ZpdF9jZW50cmVfaWQnKQoKICAgICAgICAgICAgICAgIC0+am9pbignY2hhcnRfb2ZfYWNjb3VudHMnLCAnY2hhcnRfb2ZfYWNjb3VudHMuaWQnLCAnPScsICdlbnRyeV9pdGVtcy5jaGFydF9vZl9hY2NvdW50X2lkJykKICAgICAgICAgICAgICAgIC0+am9pbignYWNjb3VudF9ncm91cHMnLCAnYWNjb3VudF9ncm91cHMuaWQnLCAnPScsICdjaGFydF9vZl9hY2NvdW50cy5hY2NvdW50X2dyb3VwX2lkJykKCiAgICAgICAgICAgICAgICAtPndoZXJlKCdlbnRyaWVzLmlzX2FwcHJvdmVkJywgJ2FwcHJvdmVkJykKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJpZXMuZGF0ZScsICc+PScsICRmaXNjYWxZZWFyLT5zdGFydCkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJpZXMuZGF0ZScsICc8PScsICRmaXNjYWxZZWFyLT5lbmQpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdlbnRyaWVzLmZpc2NhbF95ZWFyX2lkJywgJGZpc2NhbFllYXItPmlkKQogICAgICAgICAgICAgICAgLT53aGVyZSgncHJvZml0X2NlbnRyZXMuY29tcGFueV9pZCcsICRjb21wYW55LT5pZCkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJ5X2l0ZW1zLmRlYml0X2NyZWRpdCcsICdEJykKCiAgICAgICAgICAgICAgICAtPmdyb3VwQnkoJ2VudHJ5X2l0ZW1zLmNoYXJ0X29mX2FjY291bnRfaWQnKQoKICAgICAgICAgICAgICAgIC0+Z2V0KFsKICAgICAgICAgICAgICAgICAgICAnZW50cnlfaXRlbXMuY2hhcnRfb2ZfYWNjb3VudF9pZCcsCiAgICAgICAgICAgICAgICAgICAgREI6OnJhdygnc3VtKGVudHJ5X2l0ZW1zLnJlcG9ydGluZ19hbW91bnQpIGFzIHJlcG9ydGluZ19hbW91bnQnKQogICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgJGNyZWRpdFRyYW5zYWN0aW9ucyA9IEVudHJ5SXRlbTo6am9pbignZW50cmllcycsICdlbnRyaWVzLmlkJywgJz0nLCAnZW50cnlfaXRlbXMuZW50cnlfaWQnKQogICAgICAgICAgICAgICAgLT5qb2luKCdjb3N0X2NlbnRyZXMnLCAnY29zdF9jZW50cmVzLmlkJywgJz0nLCAnZW50cnlfaXRlbXMuY29zdF9jZW50cmVfaWQnKQogICAgICAgICAgICAgICAgLT5qb2luKCdwcm9maXRfY2VudHJlcycsICdwcm9maXRfY2VudHJlcy5pZCcsICc9JywgJ2Nvc3RfY2VudHJlcy5wcm9maXRfY2VudHJlX2lkJykKCiAgICAgICAgICAgICAgICAtPmpvaW4oJ2NoYXJ0X29mX2FjY291bnRzJywgJ2NoYXJ0X29mX2FjY291bnRzLmlkJywgJz0nLCAnZW50cnlfaXRlbXMuY2hhcnRfb2ZfYWNjb3VudF9pZCcpCiAgICAgICAgICAgICAgICAtPmpvaW4oJ2FjY291bnRfZ3JvdXBzJywgJ2FjY291bnRfZ3JvdXBzLmlkJywgJz0nLCAnY2hhcnRfb2ZfYWNjb3VudHMuYWNjb3VudF9ncm91cF9pZCcpCgogICAgICAgICAgICAgICAgLT53aGVyZSgnZW50cmllcy5pc19hcHByb3ZlZCcsICdhcHByb3ZlZCcpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdlbnRyaWVzLmRhdGUnLCAnPj0nLCAkZmlzY2FsWWVhci0+c3RhcnQpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdlbnRyaWVzLmRhdGUnLCAnPD0nLCAkZmlzY2FsWWVhci0+ZW5kKQogICAgICAgICAgICAgICAgLT53aGVyZSgnZW50cmllcy5maXNjYWxfeWVhcl9pZCcsICRmaXNjYWxZZWFyLT5pZCkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3Byb2ZpdF9jZW50cmVzLmNvbXBhbnlfaWQnLCAkY29tcGFueS0+aWQpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdlbnRyeV9pdGVtcy5kZWJpdF9jcmVkaXQnLCAnQycpCgogICAgICAgICAgICAgICAgLT5ncm91cEJ5KCdlbnRyeV9pdGVtcy5jaGFydF9vZl9hY2NvdW50X2lkJykKCiAgICAgICAgICAgICAgICAtPmdldChbCiAgICAgICAgICAgICAgICAgICAgJ2VudHJ5X2l0ZW1zLmNoYXJ0X29mX2FjY291bnRfaWQnLAogICAgICAgICAgICAgICAgICAgIERCOjpyYXcoJ3N1bShlbnRyeV9pdGVtcy5yZXBvcnRpbmdfYW1vdW50KSBhcyByZXBvcnRpbmdfYW1vdW50JykKICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgICRjYXJyeUZvcndhcmRlZCA9IEZpc2NhbFllYXJDbG9zaW5nTGVkZ2VyOjpqb2luKCdmaXNjYWxfeWVhcl9jbG9zaW5ncycsICdmaXNjYWxfeWVhcl9jbG9zaW5ncy5pZCcsICc9JywgJ2Zpc2NhbF95ZWFyX2Nsb3NpbmdfbGVkZ2Vycy5maXNjYWxfeWVhcl9jbG9zaW5nX2lkJykKCiAgICAgICAgICAgICAgICAtPmpvaW4oJ2NoYXJ0X29mX2FjY291bnRzJywgJ2NoYXJ0X29mX2FjY291bnRzLmlkJywgJz0nLCAnZmlzY2FsX3llYXJfY2xvc2luZ19sZWRnZXJzLmNoYXJ0X29mX2FjY291bnRfaWQnKQogICAgICAgICAgICAgICAgLT5qb2luKCdhY2NvdW50X2dyb3VwcycsICdhY2NvdW50X2dyb3Vwcy5pZCcsICc9JywgJ2NoYXJ0X29mX2FjY291bnRzLmFjY291bnRfZ3JvdXBfaWQnKQoKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2Zpc2NhbF95ZWFyX2Nsb3NpbmdzLmNvbXBhbnlfaWQnLCAkY29tcGFueS0+aWQpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdmaXNjYWxfeWVhcl9jbG9zaW5ncy50b19maXNjYWxfeWVhcl9pZCcsICRmaXNjYWxZZWFyLT5pZCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLT5ncm91cEJ5KCdmaXNjYWxfeWVhcl9jbG9zaW5nX2xlZGdlcnMuY2hhcnRfb2ZfYWNjb3VudF9pZCcpCgogICAgICAgICAgICAgICAgLT5nZXQoWwogICAgICAgICAgICAgICAgICAgICdmaXNjYWxfeWVhcl9jbG9zaW5nX2xlZGdlcnMuY2hhcnRfb2ZfYWNjb3VudF9pZCcsCiAgICAgICAgICAgICAgICAgICAgREI6OnJhdygnc3VtKGZpc2NhbF95ZWFyX2Nsb3NpbmdfbGVkZ2Vycy5jYXJyeV9mb3J3YXJkaW5nX2Ftb3VudCkgYXMgY2FycnlfZm9yd2FyZGluZ19hbW91bnQnKQogICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgJGdldEFsbEdyb3VwQW5kTGVkZ2VycyA9IGdldEFsbEdyb3VwQW5kTGVkZ2VycygpOwoKICAgICAgICAgICAgICAgICRiYWxhbmNlU2hlZXRMZWRnZXJzID0gQ2hhcnRPZkFjY291bnQ6OndpdGgoWwogICAgICAgICAgICAgICAgICAgICdhY2NvdW50R3JvdXAuYWNjb3VudENsYXNzJywKICAgICAgICAgICAgICAgICAgICAnZXhjaGFuZ2VSYXRlJwogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ2FjY291bnRHcm91cCcsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRiYWxhbmNlU2hlZXRJdGVtcyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignYWNjb3VudF9jbGFzc19pZCcsICRiYWxhbmNlU2hlZXRJdGVtcyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5vcmRlckJ5KCdjb2RlJywgJ2FzYycpCiAgICAgICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAgICAgICAgICRwcm9maXRMb3NzTGVkZ2VycyA9IENoYXJ0T2ZBY2NvdW50Ojp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAnYWNjb3VudEdyb3VwLmFjY291bnRDbGFzcycsCiAgICAgICAgICAgICAgICAgICAgJ2V4Y2hhbmdlUmF0ZScKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdhY2NvdW50R3JvdXAnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcHJvZml0TG9zc0l0ZW1zKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdhY2NvdW50X2NsYXNzX2lkJywgJHByb2ZpdExvc3NJdGVtcyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5vcmRlckJ5KCdjb2RlJywgJ2FzYycpCiAgICAgICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAgICAgICAgICRmaXNjYWxZZWFycyA9IEZpc2NhbFllYXI6OndoZXJlKCdzdGFydCcsICc+PScsICRmaXNjYWxZZWFyLT5lbmQpCiAgICAgICAgICAgICAgICAtPndoZXJlRG9lc250SGF2ZSgndG9GaXNjYWxZZWFyQ2xvc2luZycsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRjb21wYW55KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnY29tcGFueV9pZCcsICRjb21wYW55LT5pZCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAgICAgICAgICRkYXRhWyd0aXRsZSddID0gJ1J1biBGaXNjYWwgWWVhciBDbG9zaW5nIGZvciBDb21wYW55ICMgWycuJGNvbXBhbnktPmNvZGUuJ10gJy4kY29tcGFueS0+bmFtZTsKICAgICAgICAgICAgICAgICRkYXRhWydjb21wYW55J10gPSAkY29tcGFueTsKICAgICAgICAgICAgICAgICRkYXRhWydhY2NvdW50RGVmYXVsdFNldHRpbmdzJ10gPSAkYWNjb3VudERlZmF1bHRTZXR0aW5nczsKICAgICAgICAgICAgICAgICRkYXRhWydmaXNjYWxZZWFycyddID0gJGZpc2NhbFllYXJzOwogICAgICAgICAgICAgICAgJGRhdGFbJ2JhbGFuY2VTaGVldExlZGdlcnMnXSA9ICRiYWxhbmNlU2hlZXRMZWRnZXJzOwogICAgICAgICAgICAgICAgJGRhdGFbJ3Byb2ZpdExvc3NMZWRnZXJzJ10gPSAkcHJvZml0TG9zc0xlZGdlcnM7CiAgICAgICAgICAgICAgICAkZGF0YVsnc3lzdGVtQ3VycmVuY3knXSA9ICRzeXN0ZW1DdXJyZW5jeTsKICAgICAgICAgICAgICAgICRkYXRhWydmaXNjYWxZZWFyJ10gPSAkZmlzY2FsWWVhcjsKICAgICAgICAgICAgICAgICRkYXRhWydjYXJyeUZvcndhcmRlZCddID0gJGNhcnJ5Rm9yd2FyZGVkOwogICAgICAgICAgICAgICAgJGRhdGFbJ2RlYml0VHJhbnNhY3Rpb25zJ10gPSAkZGViaXRUcmFuc2FjdGlvbnM7CiAgICAgICAgICAgICAgICAkZGF0YVsnY3JlZGl0VHJhbnNhY3Rpb25zJ10gPSAkY3JlZGl0VHJhbnNhY3Rpb25zOwogICAgICAgICAgICAgICAgLy8gJGRhdGFbJ2V4Y2hhbmdlUmF0ZXMnXSA9ICRleGNoYW5nZVJhdGVzOwogICAgICAgICAgICAgICAgJGRhdGFbJ2dldEFsbEdyb3VwQW5kTGVkZ2VycyddID0gJGdldEFsbEdyb3VwQW5kTGVkZ2VyczsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5maXNjYWxZZWFyQ2xvc2luZ3MuY3JlYXRlJywgJGRhdGEpOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBzdG9yZShSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRyZXF1ZXN0LT52YWxpZGF0ZShbCiAgICAgICAgICAgICdjb21wYW55X2lkJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnZnJvbV9maXNjYWxfeWVhcl9pZCcgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ3RvX2Zpc2NhbF95ZWFyX2lkJyA9PiAncmVxdWlyZWQnLAogICAgICAgIF0pOwoKICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeXsKICAgICAgICAgICAgCiAgICAgICAgICAgICRhY2NvdW50RGVmYXVsdFNldHRpbmdzID0gYWNjb3VudERlZmF1bHRTZXR0aW5ncygpOwogICAgICAgICAgICAkYmFsYW5jZVNoZWV0SXRlbXMgPSBpc3NldChqc29uX2RlY29kZSgkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snYmFsYW5jZV9zaGVldF9pdGVtcyddLCB0cnVlKVswXSkgPyBqc29uX2RlY29kZSgkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snYmFsYW5jZV9zaGVldF9pdGVtcyddLCB0cnVlKSA6IFtdOwogICAgICAgICAgICAkcHJvZml0TG9zc0l0ZW1zID0gaXNzZXQoanNvbl9kZWNvZGUoJGFjY291bnREZWZhdWx0U2V0dGluZ3NbJ3Byb2ZpdF9sb3NzX2l0ZW1zJ10sIHRydWUpWzBdKSA/IGpzb25fZGVjb2RlKCRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydwcm9maXRfbG9zc19pdGVtcyddLCB0cnVlKSA6IFtdOwogICAgICAgICAgICAKICAgICAgICAgICAgJGZpc2NhbFllYXIgPSBGaXNjYWxZZWFyOjpmaW5kT3JGYWlsKCRyZXF1ZXN0LT5mcm9tX2Zpc2NhbF95ZWFyX2lkKTsKICAgICAgICAgICAgJHN5c3RlbUN1cnJlbmN5ID0gc3lzdGVtQ3VycmVuY3koKTsKICAgICAgICAgICAgJGV4Y2hhbmdlUmF0ZSA9IGdldEV4Y2hhbmdlUmF0ZXMoJHN5c3RlbUN1cnJlbmN5LT5pZCwgZGF0ZSgnWS1tLWQnKSwgZGF0ZSgnSDppOnMnKSk7CgogICAgICAgICAgICAkZGViaXRUcmFuc2FjdGlvbnMgPSBFbnRyeUl0ZW06OmpvaW4oJ2VudHJpZXMnLCAnZW50cmllcy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmVudHJ5X2lkJykKICAgICAgICAgICAgLT5qb2luKCdjb3N0X2NlbnRyZXMnLCAnY29zdF9jZW50cmVzLmlkJywgJz0nLCAnZW50cnlfaXRlbXMuY29zdF9jZW50cmVfaWQnKQogICAgICAgICAgICAtPmpvaW4oJ3Byb2ZpdF9jZW50cmVzJywgJ3Byb2ZpdF9jZW50cmVzLmlkJywgJz0nLCAnY29zdF9jZW50cmVzLnByb2ZpdF9jZW50cmVfaWQnKQoKICAgICAgICAgICAgLT5qb2luKCdjaGFydF9vZl9hY2NvdW50cycsICdjaGFydF9vZl9hY2NvdW50cy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmNoYXJ0X29mX2FjY291bnRfaWQnKQogICAgICAgICAgICAtPmpvaW4oJ2FjY291bnRfZ3JvdXBzJywgJ2FjY291bnRfZ3JvdXBzLmlkJywgJz0nLCAnY2hhcnRfb2ZfYWNjb3VudHMuYWNjb3VudF9ncm91cF9pZCcpCgogICAgICAgICAgICAtPndoZXJlKCdlbnRyaWVzLmlzX2FwcHJvdmVkJywgJ2FwcHJvdmVkJykKICAgICAgICAgICAgLT53aGVyZSgnZW50cmllcy5kYXRlJywgJz49JywgJGZpc2NhbFllYXItPnN0YXJ0KQogICAgICAgICAgICAtPndoZXJlKCdlbnRyaWVzLmRhdGUnLCAnPD0nLCAkZmlzY2FsWWVhci0+ZW5kKQogICAgICAgICAgICAtPndoZXJlKCdlbnRyaWVzLmZpc2NhbF95ZWFyX2lkJywgJGZpc2NhbFllYXItPmlkKQogICAgICAgICAgICAtPndoZXJlKCdwcm9maXRfY2VudHJlcy5jb21wYW55X2lkJywgJHJlcXVlc3QtPmNvbXBhbnlfaWQpCiAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJ5X2l0ZW1zLmRlYml0X2NyZWRpdCcsICdEJykKCiAgICAgICAgICAgIC0+Z3JvdXBCeSgnZW50cnlfaXRlbXMuY2hhcnRfb2ZfYWNjb3VudF9pZCcpCgogICAgICAgICAgICAtPmdldChbCiAgICAgICAgICAgICAgICAnZW50cnlfaXRlbXMuY2hhcnRfb2ZfYWNjb3VudF9pZCcsCiAgICAgICAgICAgICAgICBEQjo6cmF3KCdzdW0oZW50cnlfaXRlbXMucmVwb3J0aW5nX2Ftb3VudCkgYXMgcmVwb3J0aW5nX2Ftb3VudCcpCiAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgJGNyZWRpdFRyYW5zYWN0aW9ucyA9IEVudHJ5SXRlbTo6am9pbignZW50cmllcycsICdlbnRyaWVzLmlkJywgJz0nLCAnZW50cnlfaXRlbXMuZW50cnlfaWQnKQogICAgICAgICAgICAtPmpvaW4oJ2Nvc3RfY2VudHJlcycsICdjb3N0X2NlbnRyZXMuaWQnLCAnPScsICdlbnRyeV9pdGVtcy5jb3N0X2NlbnRyZV9pZCcpCiAgICAgICAgICAgIC0+am9pbigncHJvZml0X2NlbnRyZXMnLCAncHJvZml0X2NlbnRyZXMuaWQnLCAnPScsICdjb3N0X2NlbnRyZXMucHJvZml0X2NlbnRyZV9pZCcpCgogICAgICAgICAgICAtPmpvaW4oJ2NoYXJ0X29mX2FjY291bnRzJywgJ2NoYXJ0X29mX2FjY291bnRzLmlkJywgJz0nLCAnZW50cnlfaXRlbXMuY2hhcnRfb2ZfYWNjb3VudF9pZCcpCiAgICAgICAgICAgIC0+am9pbignYWNjb3VudF9ncm91cHMnLCAnYWNjb3VudF9ncm91cHMuaWQnLCAnPScsICdjaGFydF9vZl9hY2NvdW50cy5hY2NvdW50X2dyb3VwX2lkJykKCiAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJpZXMuaXNfYXBwcm92ZWQnLCAnYXBwcm92ZWQnKQogICAgICAgICAgICAtPndoZXJlKCdlbnRyaWVzLmRhdGUnLCAnPj0nLCAkZmlzY2FsWWVhci0+c3RhcnQpCiAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJpZXMuZGF0ZScsICc8PScsICRmaXNjYWxZZWFyLT5lbmQpCiAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJpZXMuZmlzY2FsX3llYXJfaWQnLCAkZmlzY2FsWWVhci0+aWQpCiAgICAgICAgICAgIC0+d2hlcmUoJ3Byb2ZpdF9jZW50cmVzLmNvbXBhbnlfaWQnLCAkcmVxdWVzdC0+Y29tcGFueV9pZCkKICAgICAgICAgICAgLT53aGVyZSgnZW50cnlfaXRlbXMuZGViaXRfY3JlZGl0JywgJ0MnKQoKICAgICAgICAgICAgLT5ncm91cEJ5KCdlbnRyeV9pdGVtcy5jaGFydF9vZl9hY2NvdW50X2lkJykKCiAgICAgICAgICAgIC0+Z2V0KFsKICAgICAgICAgICAgICAgICdlbnRyeV9pdGVtcy5jaGFydF9vZl9hY2NvdW50X2lkJywKICAgICAgICAgICAgICAgIERCOjpyYXcoJ3N1bShlbnRyeV9pdGVtcy5yZXBvcnRpbmdfYW1vdW50KSBhcyByZXBvcnRpbmdfYW1vdW50JykKICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAkY2FycnlGb3J3YXJkZWQgPSBGaXNjYWxZZWFyQ2xvc2luZ0xlZGdlcjo6am9pbignZmlzY2FsX3llYXJfY2xvc2luZ3MnLCAnZmlzY2FsX3llYXJfY2xvc2luZ3MuaWQnLCAnPScsICdmaXNjYWxfeWVhcl9jbG9zaW5nX2xlZGdlcnMuZmlzY2FsX3llYXJfY2xvc2luZ19pZCcpCgogICAgICAgICAgICAtPmpvaW4oJ2NoYXJ0X29mX2FjY291bnRzJywgJ2NoYXJ0X29mX2FjY291bnRzLmlkJywgJz0nLCAnZmlzY2FsX3llYXJfY2xvc2luZ19sZWRnZXJzLmNoYXJ0X29mX2FjY291bnRfaWQnKQogICAgICAgICAgICAtPmpvaW4oJ2FjY291bnRfZ3JvdXBzJywgJ2FjY291bnRfZ3JvdXBzLmlkJywgJz0nLCAnY2hhcnRfb2ZfYWNjb3VudHMuYWNjb3VudF9ncm91cF9pZCcpCgogICAgICAgICAgICAtPndoZXJlKCdmaXNjYWxfeWVhcl9jbG9zaW5ncy5jb21wYW55X2lkJywgJHJlcXVlc3QtPmNvbXBhbnlfaWQpCiAgICAgICAgICAgIC0+d2hlcmUoJ2Zpc2NhbF95ZWFyX2Nsb3NpbmdzLnRvX2Zpc2NhbF95ZWFyX2lkJywgJGZpc2NhbFllYXItPmlkKQogICAgICAgICAgICAKICAgICAgICAgICAgLT5ncm91cEJ5KCdmaXNjYWxfeWVhcl9jbG9zaW5nX2xlZGdlcnMuY2hhcnRfb2ZfYWNjb3VudF9pZCcpCgogICAgICAgICAgICAtPmdldChbCiAgICAgICAgICAgICAgICAnZmlzY2FsX3llYXJfY2xvc2luZ19sZWRnZXJzLmNoYXJ0X29mX2FjY291bnRfaWQnLAogICAgICAgICAgICAgICAgREI6OnJhdygnc3VtKGZpc2NhbF95ZWFyX2Nsb3NpbmdfbGVkZ2Vycy5jYXJyeV9mb3J3YXJkaW5nX2Ftb3VudCkgYXMgY2FycnlfZm9yd2FyZGluZ19hbW91bnQnKQogICAgICAgICAgICBdKTsKCiAgICAgICAgICAgICRnZXRBbGxHcm91cEFuZExlZGdlcnMgPSBnZXRBbGxHcm91cEFuZExlZGdlcnMoKTsKCiAgICAgICAgICAgICRiYWxhbmNlU2hlZXRMZWRnZXJzID0gQ2hhcnRPZkFjY291bnQ6OndpdGgoWwogICAgICAgICAgICAgICAgJ2FjY291bnRHcm91cC5hY2NvdW50Q2xhc3MnLAogICAgICAgICAgICAgICAgJ2V4Y2hhbmdlUmF0ZScKICAgICAgICAgICAgXSkKICAgICAgICAgICAgLT53aGVyZUhhcygnYWNjb3VudEdyb3VwJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGJhbGFuY2VTaGVldEl0ZW1zKXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2FjY291bnRfY2xhc3NfaWQnLCAkYmFsYW5jZVNoZWV0SXRlbXMpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPm9yZGVyQnkoJ2NvZGUnLCAnYXNjJykKICAgICAgICAgICAgLT5nZXQoKTsKCiAgICAgICAgICAgICRwcm9maXRMb3NzTGVkZ2VycyA9IENoYXJ0T2ZBY2NvdW50Ojp3aXRoKFsKICAgICAgICAgICAgICAgICdhY2NvdW50R3JvdXAuYWNjb3VudENsYXNzJywKICAgICAgICAgICAgICAgICdleGNoYW5nZVJhdGUnCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ2FjY291bnRHcm91cCcsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRwcm9maXRMb3NzSXRlbXMpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignYWNjb3VudF9jbGFzc19pZCcsICRwcm9maXRMb3NzSXRlbXMpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPm9yZGVyQnkoJ2NvZGUnLCAnYXNjJykKICAgICAgICAgICAgLT5nZXQoKTsKCiAgICAgICAgICAgICRjYXJyeUZvcndhcmRlZCA9IEZpc2NhbFllYXJDbG9zaW5nOjp3aXRoKFsKICAgICAgICAgICAgICAgICdleGNoYW5nZVJhdGUnLAogICAgICAgICAgICAgICAgJ2xlZGdlcnMnCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlcmUoJ2NvbXBhbnlfaWQnLCAkcmVxdWVzdC0+Y29tcGFueV9pZCkKICAgICAgICAgICAgLT53aGVyZSgndG9fZmlzY2FsX3llYXJfaWQnLCAkZmlzY2FsWWVhci0+aWQpCiAgICAgICAgICAgIC0+Z2V0KCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAkbGVkZ2VycyA9IFtdOwoKICAgICAgICAgICAgJHByb2ZpdExvc3NCYWxhbmNlID0gMDsKICAgICAgICAgICAgaWYoJHByb2ZpdExvc3NMZWRnZXJzLT5jb3VudCgpID4gMCl7CiAgICAgICAgICAgICAgICBmb3JlYWNoKCRwcm9maXRMb3NzTGVkZ2VycyBhcyAka2V5ID0+ICRsZWRnZXIpewogICAgICAgICAgICAgICAgICAgICRiYWxhbmNlID0gc3lzdGVtRG91YmxlVmFsdWUobGVkZ2VyQ2xvc2luZ0JhbGFuY2UoJGxlZGdlci0+YWNjb3VudEdyb3VwLCAkbGVkZ2VyLCBbJ0QnID0+ICRkZWJpdFRyYW5zYWN0aW9ucywgJ0MnID0+ICRjcmVkaXRUcmFuc2FjdGlvbnNdLCAkZ2V0QWxsR3JvdXBBbmRMZWRnZXJzLCAkY2FycnlGb3J3YXJkZWQpWydiYWxhbmNlJ10sIDIpOwoKICAgICAgICAgICAgICAgICAgICAkcHJvZml0TG9zc0JhbGFuY2UgKz0gJGJhbGFuY2U7CgogICAgICAgICAgICAgICAgICAgICRsZWRnZXJzWyRsZWRnZXItPmlkXVsncHJldmlvdXNfYmFsYW5jZSddID0gJGJhbGFuY2U7CiAgICAgICAgICAgICAgICAgICAgJGxlZGdlcnNbJGxlZGdlci0+aWRdWydjYXJyeV9mb3J3YXJkaW5nX2Ftb3VudCddID0gMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAkcHJvZml0TG9zc0JhbGFuY2UgPSBzeXN0ZW1Eb3VibGVWYWx1ZSgkcHJvZml0TG9zc0JhbGFuY2UsIDIpOwoKICAgICAgICAgICAgJGJhbGFuY2VTaGVldEJhbGFuY2UgPSAwOwogICAgICAgICAgICBpZigkYmFsYW5jZVNoZWV0TGVkZ2Vycy0+Y291bnQoKSA+IDApewogICAgICAgICAgICAgICAgZm9yZWFjaCgkYmFsYW5jZVNoZWV0TGVkZ2VycyBhcyAka2V5ID0+ICRsZWRnZXIpewogICAgICAgICAgICAgICAgICAgICRiYWxhbmNlID0gc3lzdGVtRG91YmxlVmFsdWUobGVkZ2VyQ2xvc2luZ0JhbGFuY2UoJGxlZGdlci0+YWNjb3VudEdyb3VwLCAkbGVkZ2VyLCBbJ0QnID0+ICRkZWJpdFRyYW5zYWN0aW9ucywgJ0MnID0+ICRjcmVkaXRUcmFuc2FjdGlvbnNdLCAkZ2V0QWxsR3JvdXBBbmRMZWRnZXJzLCAkY2FycnlGb3J3YXJkZWQpWydiYWxhbmNlJ10sIDIpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICRiYWxhbmNlU2hlZXRCYWxhbmNlICs9ICRiYWxhbmNlOwogICAgICAgICAgICAgICAgICAgICRsZWRnZXJzWyRsZWRnZXItPmlkXVsncHJldmlvdXNfYmFsYW5jZSddID0gJGJhbGFuY2U7CiAgICAgICAgICAgICAgICAgICAgJGxlZGdlcnNbJGxlZGdlci0+aWRdWydjYXJyeV9mb3J3YXJkaW5nX2Ftb3VudCddID0gJGJhbGFuY2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGJhbGFuY2VTaGVldEJhbGFuY2UgPSBzeXN0ZW1Eb3VibGVWYWx1ZSgkYmFsYW5jZVNoZWV0QmFsYW5jZSwgMik7CgogICAgICAgICAgICAkbGVkZ2Vyc1skYWNjb3VudERlZmF1bHRTZXR0aW5nc1sncmV0YWluZWRfZWFybmluZ3MnXV1bJ2NhcnJ5X2ZvcndhcmRpbmdfYW1vdW50J10gPSAkbGVkZ2Vyc1skYWNjb3VudERlZmF1bHRTZXR0aW5nc1sncmV0YWluZWRfZWFybmluZ3MnXV1bJ2NhcnJ5X2ZvcndhcmRpbmdfYW1vdW50J10rJHByb2ZpdExvc3NCYWxhbmNlOwoKICAgICAgICAgICAgJGNsb3NpbmcgPSBGaXNjYWxZZWFyQ2xvc2luZzo6Y3JlYXRlKFsKICAgICAgICAgICAgICAgICdyZWZlcmVuY2UnID0+IFxTdHI6OnJhbmRvbSg4KSwKICAgICAgICAgICAgICAgICdkYXRlJyA9PiBkYXRlKCdZLW0tZCcpLAogICAgICAgICAgICAgICAgJ3RpbWUnID0+IGRhdGUoJ0g6aTpzJyksCiAgICAgICAgICAgICAgICAnY29tcGFueV9pZCcgPT4gJHJlcXVlc3QtPmNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgICAnZnJvbV9maXNjYWxfeWVhcl9pZCcgPT4gJHJlcXVlc3QtPmZyb21fZmlzY2FsX3llYXJfaWQsCiAgICAgICAgICAgICAgICAndG9fZmlzY2FsX3llYXJfaWQnID0+ICRyZXF1ZXN0LT50b19maXNjYWxfeWVhcl9pZCwKICAgICAgICAgICAgICAgICdleGNoYW5nZV9yYXRlX2lkJyA9PiAkZXhjaGFuZ2VSYXRlWydyYXRlJ10tPmlkLAogICAgICAgICAgICAgICAgJ2JhbGFuY2UnID0+ICRiYWxhbmNlU2hlZXRCYWxhbmNlLAogICAgICAgICAgICAgICAgJ3Byb2ZpdF9sb3NzJyA9PiAkcHJvZml0TG9zc0JhbGFuY2UsCiAgICAgICAgICAgICAgICAncmV0YWluZWRfZWFybmluZ3MnID0+ICRwcm9maXRMb3NzQmFsYW5jZSwKICAgICAgICAgICAgXSk7CgogICAgICAgICAgICBpZigkY2xvc2luZyl7CiAgICAgICAgICAgICAgICBpZihpc19hcnJheSgkbGVkZ2VycykgJiYgY291bnQoJGxlZGdlcnMpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgJGFycmF5ID0gW107CiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCgkbGVkZ2VycyBhcyAkY2hhcnRfb2ZfYWNjb3VudF9pZCA9PiAkdmFsdWUpewogICAgICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRhcnJheSwgWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Zpc2NhbF95ZWFyX2Nsb3NpbmdfaWQnID0+ICRjbG9zaW5nLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkY2hhcnRfb2ZfYWNjb3VudF9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwcmV2aW91c19iYWxhbmNlJyA9PiAkdmFsdWVbJ3ByZXZpb3VzX2JhbGFuY2UnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjYXJyeV9mb3J3YXJkaW5nX2Ftb3VudCcgPT4gJHZhbHVlWydjYXJyeV9mb3J3YXJkaW5nX2Ftb3VudCddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NyZWF0ZWRfYnknID0+IGF1dGgoKS0+dXNlcigpLT5pZAogICAgICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIEZpc2NhbFllYXJDbG9zaW5nTGVkZ2VyOjppbnNlcnQoJGFycmF5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgREI6OmNvbW1pdCgpOwogICAgICAgICAgICBzZXNzaW9uKCktPmZsYXNoKCdhbGVydC10eXBlJywgJ3N1Y2Nlc3MnKTsKICAgICAgICAgICAgc2Vzc2lvbigpLT5mbGFzaCgnbWVzc2FnZScsICdGaXNjYWwgeWVhciBDbG9zaW5nIHJhbiBzdWNjZXNzZnVsbHkuJyk7CiAgICAgICAgICAgIHJldHVybiByZWRpcmVjdCgnYWNjb3VudGluZy9maXNjYWwteWVhci1jbG9zaW5ncycpOwoKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHNob3coJGlkKQogICAgewogICAgICAgICRhY2NvdW50RGVmYXVsdFNldHRpbmdzID0gYWNjb3VudERlZmF1bHRTZXR0aW5ncygpOwogICAgICAgICRiYWxhbmNlU2hlZXRJdGVtcyA9IGlzc2V0KGpzb25fZGVjb2RlKCRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydiYWxhbmNlX3NoZWV0X2l0ZW1zJ10sIHRydWUpWzBdKSA/IGpzb25fZGVjb2RlKCRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydiYWxhbmNlX3NoZWV0X2l0ZW1zJ10sIHRydWUpIDogW107CiAgICAgICAgJHByb2ZpdExvc3NJdGVtcyA9IGlzc2V0KGpzb25fZGVjb2RlKCRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydwcm9maXRfbG9zc19pdGVtcyddLCB0cnVlKVswXSkgPyBqc29uX2RlY29kZSgkYWNjb3VudERlZmF1bHRTZXR0aW5nc1sncHJvZml0X2xvc3NfaXRlbXMnXSwgdHJ1ZSkgOiBbXTsKCiAgICAgICAgJGNsb3NpbmcgPSBGaXNjYWxZZWFyQ2xvc2luZzo6d2l0aChbCiAgICAgICAgICAgICdleGNoYW5nZVJhdGUuY3VycmVuY3knCiAgICAgICAgXSktPmZpbmRPckZhaWwoJGlkKTsKICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgJ3RpdGxlJyA9PiAnRmlzY2FsIFllYXIgQ2xvc2luZyAjJy4kY2xvc2luZy0+cmVmZXJlbmNlLAogICAgICAgICAgICAnY2xvc2luZycgPT4gJGNsb3NpbmcsCiAgICAgICAgICAgICdiYWxhbmNlU2hlZXRMZWRnZXJzJyA9PiBGaXNjYWxZZWFyQ2xvc2luZ0xlZGdlcjo6d2l0aChbCiAgICAgICAgICAgICAgICAnY2hhcnRPZkFjY291bnQnCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ2NoYXJ0T2ZBY2NvdW50LmFjY291bnRHcm91cCcsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRiYWxhbmNlU2hlZXRJdGVtcyl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdhY2NvdW50X2NsYXNzX2lkJywgJGJhbGFuY2VTaGVldEl0ZW1zKTsKICAgICAgICAgICAgfSktPmdldCgpLAogICAgICAgICAgICAncHJvZml0TG9zc0xlZGdlcnMnID0+IEZpc2NhbFllYXJDbG9zaW5nTGVkZ2VyOjp3aXRoKFsKICAgICAgICAgICAgICAgICdjaGFydE9mQWNjb3VudCcKICAgICAgICAgICAgXSkKICAgICAgICAgICAgLT53aGVyZUhhcygnY2hhcnRPZkFjY291bnQuYWNjb3VudEdyb3VwJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHByb2ZpdExvc3NJdGVtcyl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdhY2NvdW50X2NsYXNzX2lkJywgJHByb2ZpdExvc3NJdGVtcyk7CiAgICAgICAgICAgIH0pLT5nZXQoKSwKICAgICAgICBdOwoKICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLmZpc2NhbFllYXJDbG9zaW5ncy5jbG9zaW5nJywgJGRhdGEpOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBlZGl0KCRpZCkKICAgIHsKICAgICAgICAKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gdXBkYXRlKFJlcXVlc3QgJHJlcXVlc3QsICRpZCkKICAgIHsKICAgICAgIAogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBkZXN0cm95KCRpZCkKICAgIHsKCiAgICB9Cn0K