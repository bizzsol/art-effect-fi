<?php
bolt_decrypt( __FILE__ , 'Ei5nZU'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcTXlhY2NvdW50aW5nOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKCnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQ29tcGFueTsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xQcm9maXRDZW50cmU7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQ29zdENlbnRyZTsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xGaXNjYWxZZWFyOwp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEVudHJ5VHlwZTsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xUYWc7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQWNjb3VudEdyb3VwOwp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXENoYXJ0T2ZBY2NvdW50Owp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEVudHJ5Owp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEVudHJ5SXRlbTsKCnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQmFua0FjY291bnQ7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQ2hlcXVlQm9vazsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDaGVxdWVCb29rUGFnZTsKCnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcRmlzY2FsWWVhckNsb3Npbmc7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcRmlzY2FsWWVhckNsb3NpbmdMZWRnZXI7Cgp1c2UgQXBwLCBEQjsKdXNlIElsbHVtaW5hdGVcU3VwcG9ydFxGYWNhZGVzXEF1dGg7CgpjbGFzcyBEYXNoYm9hcmRDb250cm9sbGVyIGV4dGVuZHMgQ29udHJvbGxlcgp7CiAgICBwdWJsaWMgZnVuY3Rpb24gaW5kZXgoKQogICAgewogICAgICAgIAogICAgICAgIGlmIChyZXF1ZXN0KCktPmhhcygnbWl0Y2htYXRjaCcpKXsKICAgICAgICAgICAgJGZpc2NhbFllYXJJRCA9IHJlcXVlc3QoKS0+Z2V0KCdmaXNjYWxfeWVhcl9pZCcpOwogICAgICAgICAgICAkY29tcGFueUlEID0gcmVxdWVzdCgpLT5nZXQoJ2NvbXBhbnlfaWQnKTsKICAgICAgICAgICAgJHR5cGUgPSByZXF1ZXN0KCktPmdldCgndHlwZScpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKCR0eXBlID09J3ZvdWNoZXInKXsKICAgICAgICAgICAgICAgICRtaXNtYXRjaGVkRW50cmllcyA9IEVudHJ5SXRlbTo6c2VsZWN0KAogICAgICAgICAgICAgICAgICAgICdlbnRyaWVzLmlkIGFzIGVudHJ5X2lkJywKICAgICAgICAgICAgICAgICAgICAnZW50cmllcy5udW1iZXInLAogICAgICAgICAgICAgICAgICAgIFxEQjo6cmF3KCJTVU0oQ0FTRSBXSEVOIGVudHJ5X2l0ZW1zLmRlYml0X2NyZWRpdCA9ICdEJyBUSEVOIGVudHJ5X2l0ZW1zLnJlcG9ydGluZ19hbW91bnQgRUxTRSAwIEVORCkgYXMgdG90YWxfZGViaXQiKSwKICAgICAgICAgICAgICAgICAgICBcREI6OnJhdygiU1VNKENBU0UgV0hFTiBlbnRyeV9pdGVtcy5kZWJpdF9jcmVkaXQgPSAnQycgVEhFTiBlbnRyeV9pdGVtcy5yZXBvcnRpbmdfYW1vdW50IEVMU0UgMCBFTkQpIGFzIHRvdGFsX2NyZWRpdCIpCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdlbnRyaWVzJywgJ2VudHJpZXMuaWQnLCAnPScsICdlbnRyeV9pdGVtcy5lbnRyeV9pZCcpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnZW50cmllcy5pc19hcHByb3ZlZCcsICdhcHByb3ZlZCcpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnZW50cmllcy5maXNjYWxfeWVhcl9pZCcsICRmaXNjYWxZZWFySUQpCiAgICAgICAgICAgICAgICAgICAgLT5ncm91cEJ5KCdlbnRyaWVzLmlkJywgJ2VudHJpZXMubnVtYmVyJykKICAgICAgICAgICAgICAgICAgICAtPmhhdmluZ1JhdygnQUJTKHRvdGFsX2RlYml0IC0gdG90YWxfY3JlZGl0KSA+IDAuMDEnKSAvLyBtaXNtYXRjaAogICAgICAgICAgICAgICAgICAgIC0+Z2V0KCk7CiAgICAgICAgICAgICAgICByZXR1cm4gJG1pc21hdGNoZWRFbnRyaWVzOwogICAgICAgICAgICB9ZWxzZWlmKCR0eXBlPT0nbGVkZ2VyJyl7CiAgICAgICAgICAgICAgICByZXR1cm4gJGNvYU1pc21hdGNoID0gRW50cnlJdGVtOjpzZWxlY3QoCiAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRzLmlkJywKICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudHMuY29kZScsCiAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRzLm5hbWUnLAogICAgICAgICAgICAgICAgICAgIFxEQjo6cmF3KCJTVU0oQ0FTRSBXSEVOIGVudHJ5X2l0ZW1zLmRlYml0X2NyZWRpdCA9ICdEJyBUSEVOIGVudHJ5X2l0ZW1zLnJlcG9ydGluZ19hbW91bnQgRUxTRSAwIEVORCkgYXMgdG90YWxfZGViaXQiKSwKICAgICAgICAgICAgICAgICAgICBcREI6OnJhdygiU1VNKENBU0UgV0hFTiBlbnRyeV9pdGVtcy5kZWJpdF9jcmVkaXQgPSAnQycgVEhFTiBlbnRyeV9pdGVtcy5yZXBvcnRpbmdfYW1vdW50IEVMU0UgMCBFTkQpIGFzIHRvdGFsX2NyZWRpdCIpCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdjaGFydF9vZl9hY2NvdW50cycsICdjaGFydF9vZl9hY2NvdW50cy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmNoYXJ0X29mX2FjY291bnRfaWQnKQogICAgICAgICAgICAgICAgICAgIC0+am9pbignZW50cmllcycsICdlbnRyaWVzLmlkJywgJz0nLCAnZW50cnlfaXRlbXMuZW50cnlfaWQnKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJpZXMuaXNfYXBwcm92ZWQnLCAnYXBwcm92ZWQnKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJpZXMuZmlzY2FsX3llYXJfaWQnLCAkZmlzY2FsWWVhcklEKQogICAgICAgICAgICAgICAgICAgIC0+Z3JvdXBCeSgnY2hhcnRfb2ZfYWNjb3VudHMuaWQnLCAnY2hhcnRfb2ZfYWNjb3VudHMuY29kZScsICdjaGFydF9vZl9hY2NvdW50cy5uYW1lJykKICAgICAgICAgICAgICAgICAgICAtPmhhdmluZ1JhdygnQUJTKHRvdGFsX2RlYml0IC0gdG90YWxfY3JlZGl0KSA+IDAuMDEnKQogICAgICAgICAgICAgICAgICAgIC0+Z2V0KCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfWVsc2VpZigkdHlwZT09J3Byb2ZpdF9jZW50cmUnKXsKICAgICAgICAgICAgICAgIHJldHVybiAgJHBjTWlzbWF0Y2ggPSBFbnRyeUl0ZW06OnNlbGVjdCgKICAgICAgICAgICAgICAgICdwcm9maXRfY2VudHJlcy5pZCcsCiAgICAgICAgICAgICAgICAncHJvZml0X2NlbnRyZXMuY29kZScsCiAgICAgICAgICAgICAgICAncHJvZml0X2NlbnRyZXMubmFtZScsCiAgICAgICAgICAgICAgICBcREI6OnJhdygiU1VNKENBU0UgV0hFTiBlbnRyeV9pdGVtcy5kZWJpdF9jcmVkaXQgPSAnRCcgVEhFTiBlbnRyeV9pdGVtcy5yZXBvcnRpbmdfYW1vdW50IEVMU0UgMCBFTkQpIGFzIHRvdGFsX2RlYml0IiksCiAgICAgICAgICAgICAgICBcREI6OnJhdygiU1VNKENBU0UgV0hFTiBlbnRyeV9pdGVtcy5kZWJpdF9jcmVkaXQgPSAnQycgVEhFTiBlbnRyeV9pdGVtcy5yZXBvcnRpbmdfYW1vdW50IEVMU0UgMCBFTkQpIGFzIHRvdGFsX2NyZWRpdCIpCiAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIC0+am9pbignY29zdF9jZW50cmVzJywgJ2Nvc3RfY2VudHJlcy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmNvc3RfY2VudHJlX2lkJykKICAgICAgICAgICAgICAgIC0+am9pbigncHJvZml0X2NlbnRyZXMnLCAncHJvZml0X2NlbnRyZXMuaWQnLCAnPScsICdjb3N0X2NlbnRyZXMucHJvZml0X2NlbnRyZV9pZCcpCiAgICAgICAgICAgICAgICAtPmpvaW4oJ2VudHJpZXMnLCAnZW50cmllcy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmVudHJ5X2lkJykKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJpZXMuaXNfYXBwcm92ZWQnLCAnYXBwcm92ZWQnKQogICAgICAgICAgICAgICAgLT53aGVyZSgnZW50cmllcy5maXNjYWxfeWVhcl9pZCcsICRmaXNjYWxZZWFySUQpCiAgICAgICAgICAgICAgICAtPmdyb3VwQnkoJ3Byb2ZpdF9jZW50cmVzLmlkJywgJ3Byb2ZpdF9jZW50cmVzLmNvZGUnLCAncHJvZml0X2NlbnRyZXMubmFtZScpCiAgICAgICAgICAgICAgICAtPmhhdmluZ1JhdygnQUJTKHRvdGFsX2RlYml0IC0gdG90YWxfY3JlZGl0KSA+IDAuMDEnKQogICAgICAgICAgICAgICAgLT5nZXQoKTsKCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgIH0KICAgICAgICAKICAgICAgICAKICAgICAgICBpZiAocmVxdWVzdCgpLT5oYXMoJ2dldC1taW51cy1pdGVtcycpKSB7CiAgICAgICAgICAgICRuZWdhdGl2ZUl0ZW1zID0gRW50cnlJdGVtOjp3aGVyZSgnYW1vdW50JywgJzwnLCAwKQogICAgICAgICAgICAgICAgLT53aXRoKFsnZW50cnknLCAnY2hhcnRPZkFjY291bnQnXSkKICAgICAgICAgICAgICAgIC0+Z2V0KCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAkYXJyID0gW107CiAgICAgICAgICAgIAogICAgICAgICAgICBmb3JlYWNoICgkbmVnYXRpdmVJdGVtcyBhcyAkaXRlbSkgewogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAkYXJyWyRpdGVtLT5pZF0gPSBbCiAgICAgICAgICAgICAgICAgICAgJ2xlZGdlcl9jb2RlJyA9PiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaXRlbS0+Y2hhcnRPZkFjY291bnQtPmNvZGUgPz8gJ04vQScgPT4gJGl0ZW0tPmNoYXJ0T2ZBY2NvdW50LT5uYW1lID8/ICdOL0EnCiAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICAgICAnZW50cnlfY29kZScgPT4gJGl0ZW0tPmVudHJ5LT5jb2RlID8/ICdOL0EnLAogICAgICAgICAgICAgICAgICAgICdhbW91bnQnID0+ICRpdGVtLT5hbW91bnQsCiAgICAgICAgICAgICAgICAgICAgJ2RlYml0X2NyZWRpdCcgPT4gJGl0ZW0tPmRlYml0X2NyZWRpdCwKICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiAkYXJyOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAocmVxdWVzdCgpLT5oYXMoJ2dldC1taXRjaG1hdGNoLXJlcG9ydGluZy1pdGVtcycpKSB7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBGdWxsIGRhdGV0aW1lIGlucHV0cwogICAgICAgICAgICAkc3RhcnQgPSAiMjAyMy0wNy0wMSI7CiAgICAgICAgICAgICRlbmQgICA9ICIyMDI0LTA2LTMwIjsKICAgICAgICAgICAgCiAgICAgICAgICAgICRpdGVtcyA9IEVudHJ5SXRlbTo6cXVlcnkoKQogICAgICAgICAgICAgICAgLT53aXRoKFsnZW50cnkuZXhjaGFuZ2VSYXRlJywgJ2NoYXJ0T2ZBY2NvdW50J10pCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdlbnRyeScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHN0YXJ0LCAkZW5kKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gRW50cnkgaGFzICdkYXRlJyBhbmQgJ3RpbWUnIGNvbHVtbnMg4oaSIGNvbWJpbmUgdGhlbQogICAgICAgICAgICAgICAgICAgIC8vJHF1ZXJ5LT53aGVyZVJhdygiQ09OQ0FUKGRhdGUsICcgJywgdGltZSkgQkVUV0VFTiA/IEFORCA/IiwgWyRzdGFydCwgJGVuZF0pOwogICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmVCZXR3ZWVuKCdkYXRlJywgWyRzdGFydCwgJGVuZF0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ2VudHJ5LmV4Y2hhbmdlUmF0ZScsIGZ1bmN0aW9uICgkcSkgewogICAgICAgICAgICAgICAgICAgICRxLT53aGVyZSgnY3VycmVuY3lfaWQnLCAyKTsgLy8gVVNEIG9ubHkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAvLy0+d2hlcmUoJ2VudHJ5X2lkJyw4MjMxKQogICAgICAgICAgICAgICAgLT5nZXQoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgICRhcnIgPSBbXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvcmVhY2ggKCRpdGVtcyBhcyAkaXRlbSkgewogICAgICAgICAgICAgICAgJGFyclskaXRlbS0+aWRdID0gWwogICAgICAgICAgICAgICAgICAgICdsZWRnZXJfY29kZScgPT4gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGl0ZW0tPmNoYXJ0T2ZBY2NvdW50LT5jb2RlID8/ICdOL0EnID0+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaXRlbS0+Y2hhcnRPZkFjY291bnQtPm5hbWUgPz8gJ04vQScKICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgICAgICdlbnRyeV9jb2RlJyAgICAgICAgPT4gJGl0ZW0tPmVudHJ5LT5jb2RlID8/ICdOL0EnLAogICAgICAgICAgICAgICAgICAgICdhbW91bnQnICAgICAgICAgICAgPT4gJGl0ZW0tPmFtb3VudCwKICAgICAgICAgICAgICAgICAgICAncmVwb3J0aW5nX2Ftb3VudCcgID0+ICRpdGVtLT5yZXBvcnRpbmdfYW1vdW50LAogICAgICAgICAgICAgICAgICAgICdkZWJpdF9jcmVkaXQnICAgICAgPT4gJGl0ZW0tPmRlYml0X2NyZWRpdCwKICAgICAgICAgICAgICAgICAgICAnZXhjaGFuZ2VfcmF0ZScgICAgID0+IGpzb25fZGVjb2RlKCRpdGVtLT5lbnRyeS0+ZXhjaGFuZ2VSYXRlLT5yYXRlcywgdHJ1ZSkgPz8gJ04vQScsCiAgICAgICAgICAgICAgICAgICAgJ2RhdGUnICAgICAgICAgICAgICA9PiAkaXRlbS0+ZW50cnktPmRhdGUgPz8gJ04vQScsCiAgICAgICAgICAgICAgICAgICAgJ3RpbWUnICAgICAgICAgICAgICA9PiAkaXRlbS0+ZW50cnktPnRpbWUgPz8gJ04vQScsCiAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gJGFycjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKHJlcXVlc3QoKS0+aGFzKCdzZW5kLXRlc3QtbWFpbCcpKSB7CiAgICAgICAgICAgIHJldHVybiBzZW5kRW1haWwoJ21haWxzLmluZGV4JywgWwogICAgICAgICAgICAgICAgJ3RleHQnID0+IHJlcXVlc3QoKS0+Z2V0KCdib2R5JykKICAgICAgICAgICAgXSwgcmVxdWVzdCgpLT5nZXQoJ3N1YmplY3QnKSwgZXhwbG9kZSgnLCcsIHJlcXVlc3QoKS0+Z2V0KCdlbWFpbHMnKSkpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAocmVxdWVzdCgpLT5oYXMoJ2dldC1wcm9maXQtY2VudHJlcycpKSB7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKAogICAgICAgICAgICAgICAgUHJvZml0Q2VudHJlOjp3aGVyZSgnY29tcGFueV9pZCcsIHJlcXVlc3QoKS0+Z2V0KCdjb21wYW55X2lkJykpLT5nZXQoKQogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAocmVxdWVzdCgpLT5oYXMoJ2dldC1jb3N0LWNlbnRyZXMnKSkgewogICAgICAgICAgICByZXR1cm4gJzxvcHRpb24gdmFsdWU9IjAiPkFsbCBDb3N0IENlbnRyZXM8L29wdGlvbj4nIC4gZ2V0Q29zdENlbnRyZXModHJ1ZSwgcmVxdWVzdCgpLT5nZXQoJ2NvbXBhbnlfaWQnKSwgdHJ1ZSwgcmVxdWVzdCgpLT5nZXQoJ3Byb2ZpdF9jZW50cmVfaWQnKSA+IDAgPyByZXF1ZXN0KCktPmdldCgncHJvZml0X2NlbnRyZV9pZCcpIDogZmFsc2UpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAocmVxdWVzdCgpLT5oYXMoJ2dldC1sZWRnZXJzJykpIHsKICAgICAgICAgICAgJGFsbCA9IGdldEFsbEdyb3VwQW5kTGVkZ2VycyhmYWxzZSwgdHJ1ZSwgW10sIFtyZXF1ZXN0KCktPmdldCgnY29tcGFueV9pZCcpXSk7CiAgICAgICAgICAgICRmaXNjYWxZZWFyID0gZ2V0QWN0aXZlRmlzY2FsWWVhcihyZXF1ZXN0KCktPmdldCgnY29tcGFueV9pZCcpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBjaGFydE9mQWNjb3VudHNPcHRpb25zKFtdLCAwLCAwLCAkYWxsLCBmYWxzZSwgJycsIGZhbHNlLCBbcmVxdWVzdCgpLT5nZXQoJ2NvbXBhbnlfaWQnKV0sIHRydWUsIGdldExlZGdlckJhbGFuY2VzKCRhbGwsIHJlcXVlc3QoKS0+Z2V0KCdjb21wYW55X2lkJyksICRmaXNjYWxZZWFyLT5pZCkpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAocmVxdWVzdCgpLT5oYXMoJ2dldC1zdWItbGVkZ2VycycpKSB7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdsZWRnZXJzJyA9PiBDaGFydE9mQWNjb3VudDo6d2l0aChbCiAgICAgICAgICAgICAgICAgICAgJ3N1YkxlZGdlcnMnCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgICAgIC0+aGFzKCdzdWJMZWRnZXJzJykKICAgICAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ2lkJywgZXhwbG9kZSgnLCcsIHJlcXVlc3QoKS0+Z2V0KCdsZWRnZXJzJykpKQogICAgICAgICAgICAgICAgICAgIC0+Z2V0KCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChyZXF1ZXN0KCktPmhhcygnZ2V0LWNoYXJ0JykpIHsKICAgICAgICAgICAgJHNvdXJjZSA9ICR0aGlzLT50cmFuc2FjdGlvbnMoKVtyZXF1ZXN0KCktPmdldCgnc2x1ZycpXVsnc291cmNlJ107CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+JHNvdXJjZShyZXF1ZXN0KCksIHJlcXVlc3QoKS0+Z2V0KCdzbHVnJyksIHJlcXVlc3QoKS0+Z2V0KCd2aWV3JykpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAkY29tcGFuaWVzID0gQ29tcGFueTo6d2l0aChbCiAgICAgICAgICAgICdlbnRyeVR5cGVzLmVudHJ5VHlwZScKICAgICAgICBdKQogICAgICAgICAgICAtPndoZXJlSGFzKCd1c2VycycsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCd1c2VyX2lkJywgYXV0aCgpLT51c2VyKCktPmlkKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5nZXQoKTsKICAgICAgICAKICAgICAgICAkYWN0aXZlRmlzY2FsWWVhcnMgPSBbXTsKICAgICAgICBpZiAoaXNzZXQoJGNvbXBhbmllc1swXSkpIHsKICAgICAgICAgICAgZm9yZWFjaCAoJGNvbXBhbmllcyBhcyAka2V5ID0+ICRjb21wYW55KSB7CiAgICAgICAgICAgICAgICAkYWN0aXZlRmlzY2FsWWVhcnNbJGNvbXBhbnktPmlkXSA9IGdldEFjdGl2ZUZpc2NhbFllYXIoJGNvbXBhbnktPmlkKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICB0cnkgewogICAgICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJ0FjY291bnRpbmcgRGFzaGJvYXJkJywKICAgICAgICAgICAgICAgICdjb21wYW5pZXMnID0+ICRjb21wYW5pZXMsCiAgICAgICAgICAgICAgICAnZ3JvdXBzJyA9PiBhY2NvdW50R3JvdXBPcHRpb25zKFtdLCAwLCAwLCBnZXRBbGxHcm91cEFuZExlZGdlcnMoKSksCiAgICAgICAgICAgICAgICAnZmlzY2FsWWVhcnMnID0+IEZpc2NhbFllYXI6OmFsbCgpLAogICAgICAgICAgICAgICAgJ2FjdGl2ZUZpc2NhbFllYXJzJyA9PiAkYWN0aXZlRmlzY2FsWWVhcnMsCiAgICAgICAgICAgICAgICAndHJhbnNhY3Rpb25zJyA9PiAkdGhpcy0+dHJhbnNhY3Rpb25zKCksCiAgICAgICAgICAgICAgICAncmV2ZW51ZScgPT4gQWNjb3VudEdyb3VwOjp3aGVyZSgnbmFtZScsICdSRVZFTlVFJyktPmZpcnN0KCksCiAgICAgICAgICAgICAgICAnY3VycmVudEFzc2V0cycgPT4gQWNjb3VudEdyb3VwOjp3aGVyZSgnbmFtZScsICdDdXJyZW50IEFzc2V0cycpLT5maXJzdCgpLAogICAgICAgICAgICAgICAgJ2N1cnJlbnRMaWFiaWxpdGllcycgPT4gQWNjb3VudEdyb3VwOjp3aGVyZSgnbmFtZScsICdDdXJyZW50IExpYWJpbGl0aWVzJyktPmZpcnN0KCksCiAgICAgICAgICAgIF07CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLmRhc2hib2FyZCcsICRkYXRhKTsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgCgogICAgcHVibGljIGZ1bmN0aW9uIHRyYW5zYWN0aW9ucygpCiAgICB7CiAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgLy8gJ2VudHJ5X3RyYW5zYWN0aW9ucycgPT4gWwogICAgICAgICAgICAvLyAgICAgJ3NsdWcnID0+ICJlbnRyeV90cmFuc2FjdGlvbnMiLAogICAgICAgICAgICAvLyAgICAgJ25hbWUnID0+ICJFbnRyeS1XaXNlIEJhbGFuY2VzIiwKICAgICAgICAgICAgLy8gICAgICdoZWlnaHQnID0+ICc1MDBweCcsCiAgICAgICAgICAgIC8vICAgICAnZ3JvdXAnID0+IHRydWUsCiAgICAgICAgICAgIC8vICAgICAnc291cmNlJyA9PiAnZW50cnlUcmFuc2FjdGlvbnMnCiAgICAgICAgICAgIC8vIF0sCiAgICAgICAgICAgICdwcm9maXRfY2VudHJlX3RyYW5zYWN0aW9ucycgPT4gWwogICAgICAgICAgICAgICAgJ3NsdWcnID0+ICJwcm9maXRfY2VudHJlX3RyYW5zYWN0aW9ucyIsCiAgICAgICAgICAgICAgICAnbmFtZScgPT4gIlByb2ZpdCBDZW50cmUtV2lzZSBCYWxhbmNlcyIsCiAgICAgICAgICAgICAgICAnaGVpZ2h0JyA9PiAnNTAwcHgnLAogICAgICAgICAgICAgICAgJ2dyb3VwJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJ3Byb2ZpdENlbnRyZVRyYW5zYWN0aW9ucycKICAgICAgICAgICAgXSwKICAgICAgICAgICAgJ2xlZGdlcl90cmFuc2FjdGlvbnMnID0+IFsKICAgICAgICAgICAgICAgICdzbHVnJyA9PiAibGVkZ2VyX3RyYW5zYWN0aW9ucyIsCiAgICAgICAgICAgICAgICAnbmFtZScgPT4gIkxlZGdlci1XaXNlIEJhbGFuY2VzIiwKICAgICAgICAgICAgICAgICdoZWlnaHQnID0+ICc1MDBweCcsCiAgICAgICAgICAgICAgICAnbGVkZ2VyJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJ2xlZGdlclRyYW5zYWN0aW9ucycKICAgICAgICAgICAgXSwKICAgICAgICAgICAgJ3dvcmtpbmdfY2FwaXRhbCcgPT4gWwogICAgICAgICAgICAgICAgJ3NsdWcnID0+ICJ3b3JraW5nX2NhcGl0YWwiLAogICAgICAgICAgICAgICAgJ25hbWUnID0+ICJXb3JraW5nIENhcGl0YWwiLAogICAgICAgICAgICAgICAgJ2hlaWdodCcgPT4gJzUwMHB4JywKICAgICAgICAgICAgICAgICdkdWFsJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJ3dvcmtpbmdDYXBpdGFsJwogICAgICAgICAgICBdCiAgICAgICAgXTsKICAgIH0KICAgIAogICAgcHVibGljIGZ1bmN0aW9uIGVudHJ5VHJhbnNhY3Rpb25zKCRyZXF1ZXN0LCAkc2x1ZywgJHZpZXcgPSAnY2hhcnQnKQogICAgewogICAgICAgICRhY2NvdW50cyA9IFtdOwogICAgICAgIGlmICgkcmVxdWVzdC0+YWNjb3VudF9ncm91cF9pZCA+IDApIHsKICAgICAgICAgICAgJGFsbCA9IGdldEFsbEdyb3VwQW5kTGVkZ2VycyhmYWxzZSwgZmFsc2UsIFtdLCBbJHJlcXVlc3QtPmNvbXBhbnlfaWRdKTsKICAgICAgICAgICAgJGFjY291bnRzID0gY2FsbF91c2VyX2Z1bmNfYXJyYXkoJ2FycmF5X21lcmdlJywgZ2V0QWxsQWNjb3VudHMoJHJlcXVlc3QtPmFjY291bnRfZ3JvdXBfaWQsIFtdLCAkYWxsKSA/OiBbW11dKTsKICAgICAgICAgICAgJGFjY291bnRzID0gYXJyYXlfbWVyZ2UoJGFjY291bnRzLCAkYWxsWydhY2NvdW50cyddLT53aGVyZSgnYWNjb3VudF9ncm91cF9pZCcsICRyZXF1ZXN0LT5hY2NvdW50X2dyb3VwX2lkKS0+cGx1Y2soJ2lkJyktPnRvQXJyYXkoKSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgICRkZWJpdEJhbGFuY2VzID0gRW50cnlJdGVtOjpqb2luKCdlbnRyaWVzJywgJ2VudHJpZXMuaWQnLCAnPScsICdlbnRyeV9pdGVtcy5lbnRyeV9pZCcpCiAgICAgICAgICAgIC0+am9pbignY29zdF9jZW50cmVzJywgJ2Nvc3RfY2VudHJlcy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmNvc3RfY2VudHJlX2lkJykKICAgICAgICAgICAgLT5qb2luKCdwcm9maXRfY2VudHJlcycsICdwcm9maXRfY2VudHJlcy5pZCcsICc9JywgJ2Nvc3RfY2VudHJlcy5wcm9maXRfY2VudHJlX2lkJykKICAgICAgICAgICAgLT53aGVyZSgnZGViaXRfY3JlZGl0JywgJ0QnKQogICAgICAgICAgICAtPndoZXJlKCdwcm9maXRfY2VudHJlcy5jb21wYW55X2lkJywgJHJlcXVlc3QtPmNvbXBhbnlfaWQpCiAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJpZXMuZmlzY2FsX3llYXJfaWQnLCAkcmVxdWVzdC0+ZmlzY2FsX3llYXJfaWQpCiAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJpZXMuZGF0ZScsICc8PScsICRyZXF1ZXN0LT50bykKICAgICAgICAgICAgLT53aGVuKCRyZXF1ZXN0LT5hY2NvdW50X2dyb3VwX2lkID4gMCwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkYWNjb3VudHMpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2VudHJ5X2l0ZW1zLmNoYXJ0X29mX2FjY291bnRfaWQnLCAkYWNjb3VudHMpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPmdyb3VwQnkoJ2VudHJpZXMuZW50cnlfdHlwZV9pZCcpCiAgICAgICAgICAgIC0+Z2V0KFsKICAgICAgICAgICAgICAgICdlbnRyaWVzLmVudHJ5X3R5cGVfaWQnLAogICAgICAgICAgICAgICAgREI6OnJhdygnc3VtKGVudHJ5X2l0ZW1zLnJlcG9ydGluZ19hbW91bnQpIGFzIGFtb3VudCcpCiAgICAgICAgICAgIF0pOwogICAgICAgIAogICAgICAgICRjcmVkaXRCYWxhbmNlcyA9IEVudHJ5SXRlbTo6am9pbignZW50cmllcycsICdlbnRyaWVzLmlkJywgJz0nLCAnZW50cnlfaXRlbXMuZW50cnlfaWQnKQogICAgICAgICAgICAtPmpvaW4oJ2NoYXJ0X29mX2FjY291bnRzJywgJ2NoYXJ0X29mX2FjY291bnRzLmlkJywgJz0nLCAnZW50cnlfaXRlbXMuY2hhcnRfb2ZfYWNjb3VudF9pZCcpCiAgICAgICAgICAgIC0+am9pbignY29zdF9jZW50cmVzJywgJ2Nvc3RfY2VudHJlcy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmNvc3RfY2VudHJlX2lkJykKICAgICAgICAgICAgLT5qb2luKCdwcm9maXRfY2VudHJlcycsICdwcm9maXRfY2VudHJlcy5pZCcsICc9JywgJ2Nvc3RfY2VudHJlcy5wcm9maXRfY2VudHJlX2lkJykKICAgICAgICAgICAgLT53aGVyZSgnZGViaXRfY3JlZGl0JywgJ0MnKQogICAgICAgICAgICAtPndoZXJlKCdwcm9maXRfY2VudHJlcy5jb21wYW55X2lkJywgJHJlcXVlc3QtPmNvbXBhbnlfaWQpCiAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJpZXMuZmlzY2FsX3llYXJfaWQnLCAkcmVxdWVzdC0+ZmlzY2FsX3llYXJfaWQpCiAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJpZXMuZGF0ZScsICc8PScsICRyZXF1ZXN0LT50bykKICAgICAgICAgICAgLT53aGVuKCRyZXF1ZXN0LT5hY2NvdW50X2dyb3VwX2lkID4gMCwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkYWNjb3VudHMpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2VudHJ5X2l0ZW1zLmNoYXJ0X29mX2FjY291bnRfaWQnLCAkYWNjb3VudHMpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlTnVsbCgnY2hhcnRfb2ZfYWNjb3VudHMuZGVsZXRlZF9hdCcpCiAgICAgICAgICAgIC0+Z3JvdXBCeSgnZW50cmllcy5lbnRyeV90eXBlX2lkJykKICAgICAgICAgICAgLT5nZXQoWwogICAgICAgICAgICAgICAgJ2VudHJpZXMuZW50cnlfdHlwZV9pZCcsCiAgICAgICAgICAgICAgICBEQjo6cmF3KCdzdW0oZW50cnlfaXRlbXMucmVwb3J0aW5nX2Ftb3VudCkgYXMgYW1vdW50JykKICAgICAgICAgICAgXSk7CiAgICAgICAgCiAgICAgICAgJGNhcnJ5Rm9yd2FyZGVkID0gRmlzY2FsWWVhckNsb3NpbmdMZWRnZXI6OmpvaW4oJ2Zpc2NhbF95ZWFyX2Nsb3NpbmdzJywgJ2Zpc2NhbF95ZWFyX2Nsb3NpbmdzLmlkJywgJz0nLCAnZmlzY2FsX3llYXJfY2xvc2luZ19sZWRnZXJzLmZpc2NhbF95ZWFyX2Nsb3NpbmdfaWQnKQogICAgICAgICAgICAtPmpvaW4oJ2NoYXJ0X29mX2FjY291bnRzJywgJ2NoYXJ0X29mX2FjY291bnRzLmlkJywgJz0nLCAnZmlzY2FsX3llYXJfY2xvc2luZ19sZWRnZXJzLmNoYXJ0X29mX2FjY291bnRfaWQnKQogICAgICAgICAgICAtPndoZXJlKCdmaXNjYWxfeWVhcl9jbG9zaW5ncy5jb21wYW55X2lkJywgJHJlcXVlc3QtPmNvbXBhbnlfaWQpCiAgICAgICAgICAgIC0+d2hlcmUoJ2Zpc2NhbF95ZWFyX2Nsb3NpbmdzLnRvX2Zpc2NhbF95ZWFyX2lkJywgJHJlcXVlc3QtPmZpc2NhbF95ZWFyX2lkKQogICAgICAgICAgICAtPndoZW4oJHJlcXVlc3QtPmFjY291bnRfZ3JvdXBfaWQgPiAwLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRhY2NvdW50cykgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignZmlzY2FsX3llYXJfY2xvc2luZ19sZWRnZXJzLmNoYXJ0X29mX2FjY291bnRfaWQnLCAkYWNjb3VudHMpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlTnVsbCgnY2hhcnRfb2ZfYWNjb3VudHMuZGVsZXRlZF9hdCcpCiAgICAgICAgICAgIC0+Z2V0KFsKICAgICAgICAgICAgICAgIERCOjpyYXcoJ3N1bShmaXNjYWxfeWVhcl9jbG9zaW5nX2xlZGdlcnMuY2FycnlfZm9yd2FyZGluZ19hbW91bnQpIGFzIGFtb3VudCcpCiAgICAgICAgICAgIF0pOwogICAgICAgIAogICAgICAgICRjb21wYW55ID0gQ29tcGFueTo6d2l0aChbCiAgICAgICAgICAgICdlbnRyeVR5cGVzLmVudHJ5VHlwZScKICAgICAgICBdKQogICAgICAgICAgICAtPmZpbmQoJHJlcXVlc3QtPmNvbXBhbnlfaWQpOwogICAgICAgIAogICAgICAgICRlbnRyaWVzID0gW107CiAgICAgICAgaWYgKGlzc2V0KCRjb21wYW55LT5lbnRyeVR5cGVzWzBdKSkgewogICAgICAgICAgICBmb3JlYWNoICgkY29tcGFueS0+ZW50cnlUeXBlcyBhcyAkZW50cnlUeXBlKSB7CiAgICAgICAgICAgICAgICAkdmFsdWUgPSAkZGViaXRCYWxhbmNlcy0+d2hlcmUoJ2VudHJ5X3R5cGVfaWQnLCAkZW50cnlUeXBlLT5lbnRyeV90eXBlX2lkKQogICAgICAgICAgICAgICAgICAgICAgICAtPnN1bSgnYW1vdW50JykgLSAkY3JlZGl0QmFsYW5jZXMtPndoZXJlKCdlbnRyeV90eXBlX2lkJywgJGVudHJ5VHlwZS0+ZW50cnlfdHlwZV9pZCkKICAgICAgICAgICAgICAgICAgICAgICAgLT5zdW0oJ2Ftb3VudCcpOwogICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkZW50cmllcywgWwogICAgICAgICAgICAgICAgICAgICdrZXknID0+ICRlbnRyeVR5cGUtPmVudHJ5VHlwZS0+bmFtZSwKICAgICAgICAgICAgICAgICAgICAndmFsdWUnID0+ICR2YWx1ZSA8IDAgPyAkdmFsdWUgKiAoLTEpIDogJHZhbHVlLAogICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAkdmFsdWUgPCAwID8gJ0NyJyA6ICdEcicKICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgICRhY2NvdW50R3JvdXAgPSBBY2NvdW50R3JvdXA6OmZpbmQoJHJlcXVlc3QtPmFjY291bnRfZ3JvdXBfaWQpOwogICAgICAgICRmaXNjYWxZZWFyID0gRmlzY2FsWWVhcjo6ZmluZCgkcmVxdWVzdC0+ZmlzY2FsX3llYXJfaWQpOwogICAgICAgIHJldHVybiB2aWV3KCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMuY2hhcnRzLnRyYW5zYWN0aW9ucycsIFsKICAgICAgICAgICAgJ3RpdGxlJyA9PiAkY29tcGFueS0+Y29kZSAuICcgJyAuICR0aGlzLT50cmFuc2FjdGlvbnMoKVskc2x1Z11bJ25hbWUnXSAuICcgKCcgLiAoaXNzZXQoJGFjY291bnRHcm91cC0+aWQpID8gJGFjY291bnRHcm91cC0+bmFtZSA6ICdBbGwgQWNjb3VudCBHcm91cHMnKSAuICcgfCAnIC4gJGZpc2NhbFllYXItPnRpdGxlIC4gJyB8ICcgLiAkcmVxdWVzdC0+dG8gLiAnKScsCiAgICAgICAgICAgICd0cmFuc2FjdGlvbicgPT4gJHRoaXMtPnRyYW5zYWN0aW9ucygpWyRzbHVnXSwKICAgICAgICAgICAgJ2VudHJpZXMnID0+ICRlbnRyaWVzLAogICAgICAgICAgICAnY29uc29saWRhdGVkJyA9PiAoJGRlYml0QmFsYW5jZXMtPnN1bSgnYW1vdW50JykgLSAkY3JlZGl0QmFsYW5jZXMtPnN1bSgnYW1vdW50JykpICsgJGNhcnJ5Rm9yd2FyZGVkLT5zdW0oJ2Ftb3VudCcpLAogICAgICAgICAgICAnY2FycnlGb3J3YXJkZWQnID0+ICRjYXJyeUZvcndhcmRlZC0+c3VtKCdhbW91bnQnKSwKICAgICAgICAgICAgJ3ZpZXcnID0+ICR2aWV3CiAgICAgICAgXSk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiBwcm9maXRDZW50cmVUcmFuc2FjdGlvbnMoJHJlcXVlc3QsICRzbHVnLCAkdmlldyA9ICdjaGFydCcpCiAgICB7CiAgICAgICAgJGFjY291bnRzID0gW107CiAgICAgICAgaWYgKCRyZXF1ZXN0LT5hY2NvdW50X2dyb3VwX2lkID4gMCkgewogICAgICAgICAgICAkYWxsID0gZ2V0QWxsR3JvdXBBbmRMZWRnZXJzKGZhbHNlLCBmYWxzZSwgW10sIFskcmVxdWVzdC0+Y29tcGFueV9pZF0pOwogICAgICAgICAgICAkYWNjb3VudHMgPSBjYWxsX3VzZXJfZnVuY19hcnJheSgnYXJyYXlfbWVyZ2UnLCBnZXRBbGxBY2NvdW50cygkcmVxdWVzdC0+YWNjb3VudF9ncm91cF9pZCwgW10sICRhbGwpID86IFtbXV0pOwogICAgICAgICAgICAkYWNjb3VudHMgPSBhcnJheV9tZXJnZSgkYWNjb3VudHMsICRhbGxbJ2FjY291bnRzJ10tPndoZXJlKCdhY2NvdW50X2dyb3VwX2lkJywgJHJlcXVlc3QtPmFjY291bnRfZ3JvdXBfaWQpLT5wbHVjaygnaWQnKS0+dG9BcnJheSgpKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgJGRlYml0QmFsYW5jZXMgPSBFbnRyeUl0ZW06OmpvaW4oJ2VudHJpZXMnLCAnZW50cmllcy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmVudHJ5X2lkJykKICAgICAgICAgICAgLT5qb2luKCdjaGFydF9vZl9hY2NvdW50cycsICdjaGFydF9vZl9hY2NvdW50cy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmNoYXJ0X29mX2FjY291bnRfaWQnKQogICAgICAgICAgICAtPmpvaW4oJ2Nvc3RfY2VudHJlcycsICdjb3N0X2NlbnRyZXMuaWQnLCAnPScsICdlbnRyeV9pdGVtcy5jb3N0X2NlbnRyZV9pZCcpCiAgICAgICAgICAgIC0+am9pbigncHJvZml0X2NlbnRyZXMnLCAncHJvZml0X2NlbnRyZXMuaWQnLCAnPScsICdjb3N0X2NlbnRyZXMucHJvZml0X2NlbnRyZV9pZCcpCiAgICAgICAgICAgIC0+d2hlcmUoJ2RlYml0X2NyZWRpdCcsICdEJykKICAgICAgICAgICAgLT53aGVyZSgncHJvZml0X2NlbnRyZXMuY29tcGFueV9pZCcsICRyZXF1ZXN0LT5jb21wYW55X2lkKQogICAgICAgICAgICAtPndoZXJlKCdlbnRyaWVzLmZpc2NhbF95ZWFyX2lkJywgJHJlcXVlc3QtPmZpc2NhbF95ZWFyX2lkKQogICAgICAgICAgICAtPndoZXJlKCdlbnRyaWVzLmRhdGUnLCAnPD0nLCAkcmVxdWVzdC0+dG8pCiAgICAgICAgICAgIC0+d2hlbigkcmVxdWVzdC0+YWNjb3VudF9ncm91cF9pZCA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGFjY291bnRzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdlbnRyeV9pdGVtcy5jaGFydF9vZl9hY2NvdW50X2lkJywgJGFjY291bnRzKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZU51bGwoJ2NoYXJ0X29mX2FjY291bnRzLmRlbGV0ZWRfYXQnKQogICAgICAgICAgICAtPmdyb3VwQnkoJ2Nvc3RfY2VudHJlcy5wcm9maXRfY2VudHJlX2lkJykKICAgICAgICAgICAgLT5nZXQoWwogICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlcy5wcm9maXRfY2VudHJlX2lkJywKICAgICAgICAgICAgICAgIERCOjpyYXcoJ3N1bShlbnRyeV9pdGVtcy5yZXBvcnRpbmdfYW1vdW50KSBhcyBhbW91bnQnKQogICAgICAgICAgICBdKTsKICAgICAgICAKICAgICAgICAkY3JlZGl0QmFsYW5jZXMgPSBFbnRyeUl0ZW06OmpvaW4oJ2VudHJpZXMnLCAnZW50cmllcy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmVudHJ5X2lkJykKICAgICAgICAgICAgLT5qb2luKCdjaGFydF9vZl9hY2NvdW50cycsICdjaGFydF9vZl9hY2NvdW50cy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmNoYXJ0X29mX2FjY291bnRfaWQnKQogICAgICAgICAgICAtPmpvaW4oJ2Nvc3RfY2VudHJlcycsICdjb3N0X2NlbnRyZXMuaWQnLCAnPScsICdlbnRyeV9pdGVtcy5jb3N0X2NlbnRyZV9pZCcpCiAgICAgICAgICAgIC0+am9pbigncHJvZml0X2NlbnRyZXMnLCAncHJvZml0X2NlbnRyZXMuaWQnLCAnPScsICdjb3N0X2NlbnRyZXMucHJvZml0X2NlbnRyZV9pZCcpCiAgICAgICAgICAgIC0+d2hlcmUoJ2RlYml0X2NyZWRpdCcsICdDJykKICAgICAgICAgICAgLT53aGVyZSgncHJvZml0X2NlbnRyZXMuY29tcGFueV9pZCcsICRyZXF1ZXN0LT5jb21wYW55X2lkKQogICAgICAgICAgICAtPndoZXJlKCdlbnRyaWVzLmZpc2NhbF95ZWFyX2lkJywgJHJlcXVlc3QtPmZpc2NhbF95ZWFyX2lkKQogICAgICAgICAgICAtPndoZXJlKCdlbnRyaWVzLmRhdGUnLCAnPD0nLCAkcmVxdWVzdC0+dG8pCiAgICAgICAgICAgIC0+d2hlbigkcmVxdWVzdC0+YWNjb3VudF9ncm91cF9pZCA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGFjY291bnRzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdlbnRyeV9pdGVtcy5jaGFydF9vZl9hY2NvdW50X2lkJywgJGFjY291bnRzKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZU51bGwoJ2NoYXJ0X29mX2FjY291bnRzLmRlbGV0ZWRfYXQnKQogICAgICAgICAgICAtPmdyb3VwQnkoJ2Nvc3RfY2VudHJlcy5wcm9maXRfY2VudHJlX2lkJykKICAgICAgICAgICAgLT5nZXQoWwogICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlcy5wcm9maXRfY2VudHJlX2lkJywKICAgICAgICAgICAgICAgIERCOjpyYXcoJ3N1bShlbnRyeV9pdGVtcy5yZXBvcnRpbmdfYW1vdW50KSBhcyBhbW91bnQnKQogICAgICAgICAgICBdKTsKICAgICAgICAKICAgICAgICAkY2FycnlGb3J3YXJkZWQgPSBGaXNjYWxZZWFyQ2xvc2luZ0xlZGdlcjo6am9pbignZmlzY2FsX3llYXJfY2xvc2luZ3MnLCAnZmlzY2FsX3llYXJfY2xvc2luZ3MuaWQnLCAnPScsICdmaXNjYWxfeWVhcl9jbG9zaW5nX2xlZGdlcnMuZmlzY2FsX3llYXJfY2xvc2luZ19pZCcpCiAgICAgICAgICAgIC0+am9pbignY2hhcnRfb2ZfYWNjb3VudHMnLCAnY2hhcnRfb2ZfYWNjb3VudHMuaWQnLCAnPScsICdmaXNjYWxfeWVhcl9jbG9zaW5nX2xlZGdlcnMuY2hhcnRfb2ZfYWNjb3VudF9pZCcpCiAgICAgICAgICAgIC0+d2hlcmUoJ2Zpc2NhbF95ZWFyX2Nsb3NpbmdzLmNvbXBhbnlfaWQnLCAkcmVxdWVzdC0+Y29tcGFueV9pZCkKICAgICAgICAgICAgLT53aGVyZSgnZmlzY2FsX3llYXJfY2xvc2luZ3MudG9fZmlzY2FsX3llYXJfaWQnLCAkcmVxdWVzdC0+ZmlzY2FsX3llYXJfaWQpCiAgICAgICAgICAgIC0+d2hlbigkcmVxdWVzdC0+YWNjb3VudF9ncm91cF9pZCA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGFjY291bnRzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdmaXNjYWxfeWVhcl9jbG9zaW5nX2xlZGdlcnMuY2hhcnRfb2ZfYWNjb3VudF9pZCcsICRhY2NvdW50cyk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmVOdWxsKCdjaGFydF9vZl9hY2NvdW50cy5kZWxldGVkX2F0JykKICAgICAgICAgICAgLT5nZXQoWwogICAgICAgICAgICAgICAgREI6OnJhdygnc3VtKGZpc2NhbF95ZWFyX2Nsb3NpbmdfbGVkZ2Vycy5jYXJyeV9mb3J3YXJkaW5nX2Ftb3VudCkgYXMgYW1vdW50JykKICAgICAgICAgICAgXSk7CiAgICAgICAgCiAgICAgICAgJGNvbXBhbnkgPSBDb21wYW55Ojp3aXRoKFsKICAgICAgICAgICAgJ3Byb2ZpdENlbnRyZXMnCiAgICAgICAgXSkKICAgICAgICAgICAgLT5maW5kKCRyZXF1ZXN0LT5jb21wYW55X2lkKTsKICAgICAgICAKICAgICAgICAkZW50cmllcyA9IFtdOwogICAgICAgIGlmIChpc3NldCgkY29tcGFueS0+cHJvZml0Q2VudHJlc1swXSkpIHsKICAgICAgICAgICAgZm9yZWFjaCAoJGNvbXBhbnktPnByb2ZpdENlbnRyZXMgYXMgJHByb2ZpdENlbnRyZSkgewogICAgICAgICAgICAgICAgJHZhbHVlID0gJGRlYml0QmFsYW5jZXMtPndoZXJlKCdwcm9maXRfY2VudHJlX2lkJywgJHByb2ZpdENlbnRyZS0+aWQpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+c3VtKCdhbW91bnQnKSAtICRjcmVkaXRCYWxhbmNlcy0+d2hlcmUoJ3Byb2ZpdF9jZW50cmVfaWQnLCAkcHJvZml0Q2VudHJlLT5pZCkKICAgICAgICAgICAgICAgICAgICAgICAgLT5zdW0oJ2Ftb3VudCcpOwogICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkZW50cmllcywgWwogICAgICAgICAgICAgICAgICAgICdrZXknID0+ICRwcm9maXRDZW50cmUtPm5hbWUsCiAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJyA9PiAkdmFsdWUgPCAwID8gJHZhbHVlICogKC0xKSA6ICR2YWx1ZSwKICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJHZhbHVlIDwgMCA/ICdDcicgOiAnRHInCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAkYWNjb3VudEdyb3VwID0gQWNjb3VudEdyb3VwOjpmaW5kKCRyZXF1ZXN0LT5hY2NvdW50X2dyb3VwX2lkKTsKICAgICAgICAkZmlzY2FsWWVhciA9IEZpc2NhbFllYXI6OmZpbmQoJHJlcXVlc3QtPmZpc2NhbF95ZWFyX2lkKTsKICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLmNoYXJ0cy50cmFuc2FjdGlvbnMnLCBbCiAgICAgICAgICAgICd0aXRsZScgPT4gJGNvbXBhbnktPmNvZGUgLiAnICcgLiAkdGhpcy0+dHJhbnNhY3Rpb25zKClbJHNsdWddWyduYW1lJ10gLiAnICgnIC4gKGlzc2V0KCRhY2NvdW50R3JvdXAtPmlkKSA/ICRhY2NvdW50R3JvdXAtPm5hbWUgOiAnQWxsIEFjY291bnQgR3JvdXBzJykgLiAnIHwgJyAuICRmaXNjYWxZZWFyLT50aXRsZSAuICcgfCAnIC4gJHJlcXVlc3QtPnRvIC4gJyknLAogICAgICAgICAgICAndHJhbnNhY3Rpb24nID0+ICR0aGlzLT50cmFuc2FjdGlvbnMoKVskc2x1Z10sCiAgICAgICAgICAgICdlbnRyaWVzJyA9PiAkZW50cmllcywKICAgICAgICAgICAgJ2NvbnNvbGlkYXRlZCcgPT4gKCRkZWJpdEJhbGFuY2VzLT5zdW0oJ2Ftb3VudCcpIC0gJGNyZWRpdEJhbGFuY2VzLT5zdW0oJ2Ftb3VudCcpKSArICRjYXJyeUZvcndhcmRlZC0+c3VtKCdhbW91bnQnKSwKICAgICAgICAgICAgJ2NhcnJ5Rm9yd2FyZGVkJyA9PiAkY2FycnlGb3J3YXJkZWQtPnN1bSgnYW1vdW50JyksCiAgICAgICAgICAgICd2aWV3JyA9PiAkdmlldwogICAgICAgIF0pOwogICAgfQogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gbGVkZ2VyVHJhbnNhY3Rpb25zKCRyZXF1ZXN0LCAkc2x1ZywgJHZpZXcgPSAnY2hhcnQnKQogICAgewogICAgICAgICRkZWJpdEJhbGFuY2VzID0gRW50cnlJdGVtOjpqb2luKCdlbnRyaWVzJywgJ2VudHJpZXMuaWQnLCAnPScsICdlbnRyeV9pdGVtcy5lbnRyeV9pZCcpCiAgICAgICAgICAgIC0+am9pbignY2hhcnRfb2ZfYWNjb3VudHMnLCAnY2hhcnRfb2ZfYWNjb3VudHMuaWQnLCAnPScsICdlbnRyeV9pdGVtcy5jaGFydF9vZl9hY2NvdW50X2lkJykKICAgICAgICAgICAgLT5qb2luKCdjb3N0X2NlbnRyZXMnLCAnY29zdF9jZW50cmVzLmlkJywgJz0nLCAnZW50cnlfaXRlbXMuY29zdF9jZW50cmVfaWQnKQogICAgICAgICAgICAtPmpvaW4oJ3Byb2ZpdF9jZW50cmVzJywgJ3Byb2ZpdF9jZW50cmVzLmlkJywgJz0nLCAnY29zdF9jZW50cmVzLnByb2ZpdF9jZW50cmVfaWQnKQogICAgICAgICAgICAtPndoZXJlKCdkZWJpdF9jcmVkaXQnLCAnRCcpCiAgICAgICAgICAgIC0+d2hlcmUoJ3Byb2ZpdF9jZW50cmVzLmNvbXBhbnlfaWQnLCAkcmVxdWVzdC0+Y29tcGFueV9pZCkKICAgICAgICAgICAgLT53aGVyZSgnZW50cmllcy5maXNjYWxfeWVhcl9pZCcsICRyZXF1ZXN0LT5maXNjYWxfeWVhcl9pZCkKICAgICAgICAgICAgLT53aGVyZSgnZW50cmllcy5kYXRlJywgJzw9JywgJHJlcXVlc3QtPnRvKQogICAgICAgICAgICAtPndoZW4oJHJlcXVlc3QtPmNoYXJ0X29mX2FjY291bnRfaWQgPiAwLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRyZXF1ZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZW50cnlfaXRlbXMuY2hhcnRfb2ZfYWNjb3VudF9pZCcsICRyZXF1ZXN0LT5jaGFydF9vZl9hY2NvdW50X2lkKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZU51bGwoJ2NoYXJ0X29mX2FjY291bnRzLmRlbGV0ZWRfYXQnKQogICAgICAgICAgICAtPmdyb3VwQnkoJ2Nvc3RfY2VudHJlcy5wcm9maXRfY2VudHJlX2lkJykKICAgICAgICAgICAgLT5nZXQoWwogICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlcy5wcm9maXRfY2VudHJlX2lkJywKICAgICAgICAgICAgICAgIERCOjpyYXcoJ3N1bShlbnRyeV9pdGVtcy5yZXBvcnRpbmdfYW1vdW50KSBhcyBhbW91bnQnKQogICAgICAgICAgICBdKTsKICAgICAgICAKICAgICAgICAkY3JlZGl0QmFsYW5jZXMgPSBFbnRyeUl0ZW06OmpvaW4oJ2VudHJpZXMnLCAnZW50cmllcy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmVudHJ5X2lkJykKICAgICAgICAgICAgLT5qb2luKCdjaGFydF9vZl9hY2NvdW50cycsICdjaGFydF9vZl9hY2NvdW50cy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmNoYXJ0X29mX2FjY291bnRfaWQnKQogICAgICAgICAgICAtPmpvaW4oJ2Nvc3RfY2VudHJlcycsICdjb3N0X2NlbnRyZXMuaWQnLCAnPScsICdlbnRyeV9pdGVtcy5jb3N0X2NlbnRyZV9pZCcpCiAgICAgICAgICAgIC0+am9pbigncHJvZml0X2NlbnRyZXMnLCAncHJvZml0X2NlbnRyZXMuaWQnLCAnPScsICdjb3N0X2NlbnRyZXMucHJvZml0X2NlbnRyZV9pZCcpCiAgICAgICAgICAgIC0+d2hlcmUoJ2RlYml0X2NyZWRpdCcsICdDJykKICAgICAgICAgICAgLT53aGVyZSgncHJvZml0X2NlbnRyZXMuY29tcGFueV9pZCcsICRyZXF1ZXN0LT5jb21wYW55X2lkKQogICAgICAgICAgICAtPndoZXJlKCdlbnRyaWVzLmZpc2NhbF95ZWFyX2lkJywgJHJlcXVlc3QtPmZpc2NhbF95ZWFyX2lkKQogICAgICAgICAgICAtPndoZXJlKCdlbnRyaWVzLmRhdGUnLCAnPD0nLCAkcmVxdWVzdC0+dG8pCiAgICAgICAgICAgIC0+d2hlbigkcmVxdWVzdC0+Y2hhcnRfb2ZfYWNjb3VudF9pZCA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHJlcXVlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdlbnRyeV9pdGVtcy5jaGFydF9vZl9hY2NvdW50X2lkJywgJHJlcXVlc3QtPmNoYXJ0X29mX2FjY291bnRfaWQpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlTnVsbCgnY2hhcnRfb2ZfYWNjb3VudHMuZGVsZXRlZF9hdCcpCiAgICAgICAgICAgIC0+Z3JvdXBCeSgnY29zdF9jZW50cmVzLnByb2ZpdF9jZW50cmVfaWQnKQogICAgICAgICAgICAtPmdldChbCiAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVzLnByb2ZpdF9jZW50cmVfaWQnLAogICAgICAgICAgICAgICAgREI6OnJhdygnc3VtKGVudHJ5X2l0ZW1zLnJlcG9ydGluZ19hbW91bnQpIGFzIGFtb3VudCcpCiAgICAgICAgICAgIF0pOwogICAgICAgIAogICAgICAgICRjYXJyeUZvcndhcmRlZCA9IEZpc2NhbFllYXJDbG9zaW5nTGVkZ2VyOjpqb2luKCdmaXNjYWxfeWVhcl9jbG9zaW5ncycsICdmaXNjYWxfeWVhcl9jbG9zaW5ncy5pZCcsICc9JywgJ2Zpc2NhbF95ZWFyX2Nsb3NpbmdfbGVkZ2Vycy5maXNjYWxfeWVhcl9jbG9zaW5nX2lkJykKICAgICAgICAgICAgLT5qb2luKCdjaGFydF9vZl9hY2NvdW50cycsICdjaGFydF9vZl9hY2NvdW50cy5pZCcsICc9JywgJ2Zpc2NhbF95ZWFyX2Nsb3NpbmdfbGVkZ2Vycy5jaGFydF9vZl9hY2NvdW50X2lkJykKICAgICAgICAgICAgLT53aGVyZSgnZmlzY2FsX3llYXJfY2xvc2luZ3MuY29tcGFueV9pZCcsICRyZXF1ZXN0LT5jb21wYW55X2lkKQogICAgICAgICAgICAtPndoZXJlKCdmaXNjYWxfeWVhcl9jbG9zaW5ncy50b19maXNjYWxfeWVhcl9pZCcsICRyZXF1ZXN0LT5maXNjYWxfeWVhcl9pZCkKICAgICAgICAgICAgLT53aGVuKCRyZXF1ZXN0LT5jaGFydF9vZl9hY2NvdW50X2lkID4gMCwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkcmVxdWVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2Zpc2NhbF95ZWFyX2Nsb3NpbmdfbGVkZ2Vycy5jaGFydF9vZl9hY2NvdW50X2lkJywgJHJlcXVlc3QtPmNoYXJ0X29mX2FjY291bnRfaWQpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlTnVsbCgnY2hhcnRfb2ZfYWNjb3VudHMuZGVsZXRlZF9hdCcpCiAgICAgICAgICAgIC0+Z2V0KFsKICAgICAgICAgICAgICAgIERCOjpyYXcoJ3N1bShmaXNjYWxfeWVhcl9jbG9zaW5nX2xlZGdlcnMuY2FycnlfZm9yd2FyZGluZ19hbW91bnQpIGFzIGFtb3VudCcpCiAgICAgICAgICAgIF0pOwogICAgICAgIAogICAgICAgICRjb21wYW55ID0gQ29tcGFueTo6d2l0aChbCiAgICAgICAgICAgICdwcm9maXRDZW50cmVzJwogICAgICAgIF0pCiAgICAgICAgICAgIC0+ZmluZCgkcmVxdWVzdC0+Y29tcGFueV9pZCk7CiAgICAgICAgCiAgICAgICAgJGVudHJpZXMgPSBbXTsKICAgICAgICBpZiAoaXNzZXQoJGNvbXBhbnktPnByb2ZpdENlbnRyZXNbMF0pKSB7CiAgICAgICAgICAgIGZvcmVhY2ggKCRjb21wYW55LT5wcm9maXRDZW50cmVzIGFzICRwcm9maXRDZW50cmUpIHsKICAgICAgICAgICAgICAgICR2YWx1ZSA9ICRkZWJpdEJhbGFuY2VzLT53aGVyZSgncHJvZml0X2NlbnRyZV9pZCcsICRwcm9maXRDZW50cmUtPmlkKQogICAgICAgICAgICAgICAgICAgICAgICAtPnN1bSgnYW1vdW50JykgLSAkY3JlZGl0QmFsYW5jZXMtPndoZXJlKCdwcm9maXRfY2VudHJlX2lkJywgJHByb2ZpdENlbnRyZS0+aWQpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+c3VtKCdhbW91bnQnKTsKICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGVudHJpZXMsIFsKICAgICAgICAgICAgICAgICAgICAna2V5JyA9PiAkcHJvZml0Q2VudHJlLT5uYW1lLAogICAgICAgICAgICAgICAgICAgICd2YWx1ZScgPT4gJHZhbHVlIDwgMCA/ICR2YWx1ZSAqICgtMSkgOiAkdmFsdWUsCiAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICR2YWx1ZSA8IDAgPyAnQ3InIDogJ0RyJwogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgJGFjY291bnRHcm91cCA9IEFjY291bnRHcm91cDo6ZmluZCgkcmVxdWVzdC0+YWNjb3VudF9ncm91cF9pZCk7CiAgICAgICAgJGZpc2NhbFllYXIgPSBGaXNjYWxZZWFyOjpmaW5kKCRyZXF1ZXN0LT5maXNjYWxfeWVhcl9pZCk7CiAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5jaGFydHMudHJhbnNhY3Rpb25zJywgWwogICAgICAgICAgICAndGl0bGUnID0+ICRjb21wYW55LT5jb2RlIC4gJyAnIC4gJHRoaXMtPnRyYW5zYWN0aW9ucygpWyRzbHVnXVsnbmFtZSddIC4gJyAoJyAuIChpc3NldCgkYWNjb3VudEdyb3VwLT5pZCkgPyAkYWNjb3VudEdyb3VwLT5uYW1lIDogJ0FsbCBBY2NvdW50IEdyb3VwcycpIC4gJyB8ICcgLiAkZmlzY2FsWWVhci0+dGl0bGUgLiAnIHwgJyAuICRyZXF1ZXN0LT50byAuICcpJywKICAgICAgICAgICAgJ3RyYW5zYWN0aW9uJyA9PiAkdGhpcy0+dHJhbnNhY3Rpb25zKClbJHNsdWddLAogICAgICAgICAgICAnZW50cmllcycgPT4gJGVudHJpZXMsCiAgICAgICAgICAgICdjb25zb2xpZGF0ZWQnID0+ICgkZGViaXRCYWxhbmNlcy0+c3VtKCdhbW91bnQnKSAtICRjcmVkaXRCYWxhbmNlcy0+c3VtKCdhbW91bnQnKSkgKyAkY2FycnlGb3J3YXJkZWQtPnN1bSgnYW1vdW50JyksCiAgICAgICAgICAgICdjYXJyeUZvcndhcmRlZCcgPT4gJGNhcnJ5Rm9yd2FyZGVkLT5zdW0oJ2Ftb3VudCcpLAogICAgICAgICAgICAndmlldycgPT4gJHZpZXcKICAgICAgICBdKTsKICAgIH0KICAgIAogICAgcHVibGljIGZ1bmN0aW9uIHdvcmtpbmdDYXBpdGFsKCRyZXF1ZXN0LCAkc2x1ZywgJHZpZXcgPSAnY2hhcnQnKQogICAgewogICAgICAgICRwb3NpdGl2ZUFjY291bnRzID0gW107CiAgICAgICAgaWYgKCRyZXF1ZXN0LT5wb3NpdGl2ZV9hY2NvdW50X2dyb3VwX2lkID4gMCkgewogICAgICAgICAgICAkYWxsID0gZ2V0QWxsR3JvdXBBbmRMZWRnZXJzKGZhbHNlLCBmYWxzZSwgW10sIFskcmVxdWVzdC0+Y29tcGFueV9pZF0pOwogICAgICAgICAgICAkcG9zaXRpdmVBY2NvdW50cyA9IGNhbGxfdXNlcl9mdW5jX2FycmF5KCdhcnJheV9tZXJnZScsIGdldEFsbEFjY291bnRzKCRyZXF1ZXN0LT5wb3NpdGl2ZV9hY2NvdW50X2dyb3VwX2lkLCBbXSwgJGFsbCkgPzogW1tdXSk7CiAgICAgICAgICAgICRwb3NpdGl2ZUFjY291bnRzID0gYXJyYXlfbWVyZ2UoJHBvc2l0aXZlQWNjb3VudHMsICRhbGxbJ2FjY291bnRzJ10tPndoZXJlKCdhY2NvdW50X2dyb3VwX2lkJywgJHJlcXVlc3QtPnBvc2l0aXZlX2FjY291bnRfZ3JvdXBfaWQpLT5wbHVjaygnaWQnKS0+dG9BcnJheSgpKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgJG5lZ2F0aXZlQWNjb3VudHMgPSBbXTsKICAgICAgICBpZiAoJHJlcXVlc3QtPm5lZ2F0aXZlX2FjY291bnRfZ3JvdXBfaWQgPiAwKSB7CiAgICAgICAgICAgICRhbGwgPSBnZXRBbGxHcm91cEFuZExlZGdlcnMoZmFsc2UsIGZhbHNlLCBbXSwgWyRyZXF1ZXN0LT5jb21wYW55X2lkXSk7CiAgICAgICAgICAgICRuZWdhdGl2ZUFjY291bnRzID0gY2FsbF91c2VyX2Z1bmNfYXJyYXkoJ2FycmF5X21lcmdlJywgZ2V0QWxsQWNjb3VudHMoJHJlcXVlc3QtPm5lZ2F0aXZlX2FjY291bnRfZ3JvdXBfaWQsIFtdLCAkYWxsKSA/OiBbW11dKTsKICAgICAgICAgICAgJG5lZ2F0aXZlQWNjb3VudHMgPSBhcnJheV9tZXJnZSgkbmVnYXRpdmVBY2NvdW50cywgJGFsbFsnYWNjb3VudHMnXS0+d2hlcmUoJ2FjY291bnRfZ3JvdXBfaWQnLCAkcmVxdWVzdC0+bmVnYXRpdmVfYWNjb3VudF9ncm91cF9pZCktPnBsdWNrKCdpZCcpLT50b0FycmF5KCkpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAkcG9zaXRpdmVEZWJpdEJhbGFuY2VzID0gRW50cnlJdGVtOjpqb2luKCdlbnRyaWVzJywgJ2VudHJpZXMuaWQnLCAnPScsICdlbnRyeV9pdGVtcy5lbnRyeV9pZCcpCiAgICAgICAgICAgIC0+am9pbignY29zdF9jZW50cmVzJywgJ2Nvc3RfY2VudHJlcy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmNvc3RfY2VudHJlX2lkJykKICAgICAgICAgICAgLT5qb2luKCdwcm9maXRfY2VudHJlcycsICdwcm9maXRfY2VudHJlcy5pZCcsICc9JywgJ2Nvc3RfY2VudHJlcy5wcm9maXRfY2VudHJlX2lkJykKICAgICAgICAgICAgLT53aGVyZSgnZGViaXRfY3JlZGl0JywgJ0QnKQogICAgICAgICAgICAtPndoZXJlKCdwcm9maXRfY2VudHJlcy5jb21wYW55X2lkJywgJHJlcXVlc3QtPmNvbXBhbnlfaWQpCiAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJpZXMuZmlzY2FsX3llYXJfaWQnLCAkcmVxdWVzdC0+ZmlzY2FsX3llYXJfaWQpCiAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJpZXMuZGF0ZScsICc8PScsICRyZXF1ZXN0LT50bykKICAgICAgICAgICAgLT53aGVuKCRyZXF1ZXN0LT5wb3NpdGl2ZV9hY2NvdW50X2dyb3VwX2lkID4gMCwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkcG9zaXRpdmVBY2NvdW50cykgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignZW50cnlfaXRlbXMuY2hhcnRfb2ZfYWNjb3VudF9pZCcsICRwb3NpdGl2ZUFjY291bnRzKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5ncm91cEJ5KCdjb3N0X2NlbnRyZXMucHJvZml0X2NlbnRyZV9pZCcpCiAgICAgICAgICAgIC0+Z2V0KFsKICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZXMucHJvZml0X2NlbnRyZV9pZCcsCiAgICAgICAgICAgICAgICBEQjo6cmF3KCdzdW0oZW50cnlfaXRlbXMucmVwb3J0aW5nX2Ftb3VudCkgYXMgYW1vdW50JykKICAgICAgICAgICAgXSk7CiAgICAgICAgCiAgICAgICAgJG5lZ2F0aXZlRGViaXRCYWxhbmNlcyA9IEVudHJ5SXRlbTo6am9pbignZW50cmllcycsICdlbnRyaWVzLmlkJywgJz0nLCAnZW50cnlfaXRlbXMuZW50cnlfaWQnKQogICAgICAgICAgICAtPmpvaW4oJ2Nvc3RfY2VudHJlcycsICdjb3N0X2NlbnRyZXMuaWQnLCAnPScsICdlbnRyeV9pdGVtcy5jb3N0X2NlbnRyZV9pZCcpCiAgICAgICAgICAgIC0+am9pbigncHJvZml0X2NlbnRyZXMnLCAncHJvZml0X2NlbnRyZXMuaWQnLCAnPScsICdjb3N0X2NlbnRyZXMucHJvZml0X2NlbnRyZV9pZCcpCiAgICAgICAgICAgIC0+d2hlcmUoJ2RlYml0X2NyZWRpdCcsICdEJykKICAgICAgICAgICAgLT53aGVyZSgncHJvZml0X2NlbnRyZXMuY29tcGFueV9pZCcsICRyZXF1ZXN0LT5jb21wYW55X2lkKQogICAgICAgICAgICAtPndoZXJlKCdlbnRyaWVzLmZpc2NhbF95ZWFyX2lkJywgJHJlcXVlc3QtPmZpc2NhbF95ZWFyX2lkKQogICAgICAgICAgICAtPndoZXJlKCdlbnRyaWVzLmRhdGUnLCAnPD0nLCAkcmVxdWVzdC0+dG8pCiAgICAgICAgICAgIC0+d2hlbigkcmVxdWVzdC0+bmVnYXRpdmVfYWNjb3VudF9ncm91cF9pZCA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJG5lZ2F0aXZlQWNjb3VudHMpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2VudHJ5X2l0ZW1zLmNoYXJ0X29mX2FjY291bnRfaWQnLCAkbmVnYXRpdmVBY2NvdW50cyk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+Z3JvdXBCeSgnY29zdF9jZW50cmVzLnByb2ZpdF9jZW50cmVfaWQnKQogICAgICAgICAgICAtPmdldChbCiAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVzLnByb2ZpdF9jZW50cmVfaWQnLAogICAgICAgICAgICAgICAgREI6OnJhdygnc3VtKGVudHJ5X2l0ZW1zLnJlcG9ydGluZ19hbW91bnQpIGFzIGFtb3VudCcpCiAgICAgICAgICAgIF0pOwogICAgICAgIAogICAgICAgICRwb3NpdGl2ZUNyZWRpdEJhbGFuY2VzID0gRW50cnlJdGVtOjpqb2luKCdlbnRyaWVzJywgJ2VudHJpZXMuaWQnLCAnPScsICdlbnRyeV9pdGVtcy5lbnRyeV9pZCcpCiAgICAgICAgICAgIC0+am9pbignY2hhcnRfb2ZfYWNjb3VudHMnLCAnY2hhcnRfb2ZfYWNjb3VudHMuaWQnLCAnPScsICdlbnRyeV9pdGVtcy5jaGFydF9vZl9hY2NvdW50X2lkJykKICAgICAgICAgICAgLT5qb2luKCdjb3N0X2NlbnRyZXMnLCAnY29zdF9jZW50cmVzLmlkJywgJz0nLCAnZW50cnlfaXRlbXMuY29zdF9jZW50cmVfaWQnKQogICAgICAgICAgICAtPmpvaW4oJ3Byb2ZpdF9jZW50cmVzJywgJ3Byb2ZpdF9jZW50cmVzLmlkJywgJz0nLCAnY29zdF9jZW50cmVzLnByb2ZpdF9jZW50cmVfaWQnKQogICAgICAgICAgICAtPndoZXJlKCdkZWJpdF9jcmVkaXQnLCAnQycpCiAgICAgICAgICAgIC0+d2hlcmUoJ3Byb2ZpdF9jZW50cmVzLmNvbXBhbnlfaWQnLCAkcmVxdWVzdC0+Y29tcGFueV9pZCkKICAgICAgICAgICAgLT53aGVyZSgnZW50cmllcy5maXNjYWxfeWVhcl9pZCcsICRyZXF1ZXN0LT5maXNjYWxfeWVhcl9pZCkKICAgICAgICAgICAgLT53aGVyZSgnZW50cmllcy5kYXRlJywgJzw9JywgJHJlcXVlc3QtPnRvKQogICAgICAgICAgICAtPndoZW4oJHJlcXVlc3QtPnBvc2l0aXZlX2FjY291bnRfZ3JvdXBfaWQgPiAwLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRwb3NpdGl2ZUFjY291bnRzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdlbnRyeV9pdGVtcy5jaGFydF9vZl9hY2NvdW50X2lkJywgJHBvc2l0aXZlQWNjb3VudHMpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlTnVsbCgnY2hhcnRfb2ZfYWNjb3VudHMuZGVsZXRlZF9hdCcpCiAgICAgICAgICAgIC0+Z3JvdXBCeSgnY29zdF9jZW50cmVzLnByb2ZpdF9jZW50cmVfaWQnKQogICAgICAgICAgICAtPmdldChbCiAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVzLnByb2ZpdF9jZW50cmVfaWQnLAogICAgICAgICAgICAgICAgREI6OnJhdygnc3VtKGVudHJ5X2l0ZW1zLnJlcG9ydGluZ19hbW91bnQpIGFzIGFtb3VudCcpCiAgICAgICAgICAgIF0pOwogICAgICAgIAogICAgICAgICRuZWdhdGl2ZUNyZWRpdEJhbGFuY2VzID0gRW50cnlJdGVtOjpqb2luKCdlbnRyaWVzJywgJ2VudHJpZXMuaWQnLCAnPScsICdlbnRyeV9pdGVtcy5lbnRyeV9pZCcpCiAgICAgICAgICAgIC0+am9pbignY2hhcnRfb2ZfYWNjb3VudHMnLCAnY2hhcnRfb2ZfYWNjb3VudHMuaWQnLCAnPScsICdlbnRyeV9pdGVtcy5jaGFydF9vZl9hY2NvdW50X2lkJykKICAgICAgICAgICAgLT5qb2luKCdjb3N0X2NlbnRyZXMnLCAnY29zdF9jZW50cmVzLmlkJywgJz0nLCAnZW50cnlfaXRlbXMuY29zdF9jZW50cmVfaWQnKQogICAgICAgICAgICAtPmpvaW4oJ3Byb2ZpdF9jZW50cmVzJywgJ3Byb2ZpdF9jZW50cmVzLmlkJywgJz0nLCAnY29zdF9jZW50cmVzLnByb2ZpdF9jZW50cmVfaWQnKQogICAgICAgICAgICAtPndoZXJlKCdkZWJpdF9jcmVkaXQnLCAnQycpCiAgICAgICAgICAgIC0+d2hlcmUoJ3Byb2ZpdF9jZW50cmVzLmNvbXBhbnlfaWQnLCAkcmVxdWVzdC0+Y29tcGFueV9pZCkKICAgICAgICAgICAgLT53aGVyZSgnZW50cmllcy5maXNjYWxfeWVhcl9pZCcsICRyZXF1ZXN0LT5maXNjYWxfeWVhcl9pZCkKICAgICAgICAgICAgLT53aGVyZSgnZW50cmllcy5kYXRlJywgJzw9JywgJHJlcXVlc3QtPnRvKQogICAgICAgICAgICAtPndoZW4oJHJlcXVlc3QtPm5lZ2F0aXZlX2FjY291bnRfZ3JvdXBfaWQgPiAwLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRuZWdhdGl2ZUFjY291bnRzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdlbnRyeV9pdGVtcy5jaGFydF9vZl9hY2NvdW50X2lkJywgJG5lZ2F0aXZlQWNjb3VudHMpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlTnVsbCgnY2hhcnRfb2ZfYWNjb3VudHMuZGVsZXRlZF9hdCcpCiAgICAgICAgICAgIC0+Z3JvdXBCeSgnY29zdF9jZW50cmVzLnByb2ZpdF9jZW50cmVfaWQnKQogICAgICAgICAgICAtPmdldChbCiAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVzLnByb2ZpdF9jZW50cmVfaWQnLAogICAgICAgICAgICAgICAgREI6OnJhdygnc3VtKGVudHJ5X2l0ZW1zLnJlcG9ydGluZ19hbW91bnQpIGFzIGFtb3VudCcpCiAgICAgICAgICAgIF0pOwogICAgICAgIAogICAgICAgICRwb3NpdGl2ZUNhcnJ5Rm9yd2FyZGVkID0gRmlzY2FsWWVhckNsb3NpbmdMZWRnZXI6OmpvaW4oJ2Zpc2NhbF95ZWFyX2Nsb3NpbmdzJywgJ2Zpc2NhbF95ZWFyX2Nsb3NpbmdzLmlkJywgJz0nLCAnZmlzY2FsX3llYXJfY2xvc2luZ19sZWRnZXJzLmZpc2NhbF95ZWFyX2Nsb3NpbmdfaWQnKQogICAgICAgICAgICAtPmpvaW4oJ2NoYXJ0X29mX2FjY291bnRzJywgJ2NoYXJ0X29mX2FjY291bnRzLmlkJywgJz0nLCAnZmlzY2FsX3llYXJfY2xvc2luZ19sZWRnZXJzLmNoYXJ0X29mX2FjY291bnRfaWQnKQogICAgICAgICAgICAtPndoZXJlKCdmaXNjYWxfeWVhcl9jbG9zaW5ncy5jb21wYW55X2lkJywgJHJlcXVlc3QtPmNvbXBhbnlfaWQpCiAgICAgICAgICAgIC0+d2hlcmUoJ2Zpc2NhbF95ZWFyX2Nsb3NpbmdzLnRvX2Zpc2NhbF95ZWFyX2lkJywgJHJlcXVlc3QtPmZpc2NhbF95ZWFyX2lkKQogICAgICAgICAgICAtPndoZW4oJHJlcXVlc3QtPnBvc2l0aXZlX2FjY291bnRfZ3JvdXBfaWQgPiAwLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRwb3NpdGl2ZUFjY291bnRzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdmaXNjYWxfeWVhcl9jbG9zaW5nX2xlZGdlcnMuY2hhcnRfb2ZfYWNjb3VudF9pZCcsICRwb3NpdGl2ZUFjY291bnRzKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZU51bGwoJ2NoYXJ0X29mX2FjY291bnRzLmRlbGV0ZWRfYXQnKQogICAgICAgICAgICAtPmdldChbCiAgICAgICAgICAgICAgICBEQjo6cmF3KCdzdW0oZmlzY2FsX3llYXJfY2xvc2luZ19sZWRnZXJzLmNhcnJ5X2ZvcndhcmRpbmdfYW1vdW50KSBhcyBhbW91bnQnKQogICAgICAgICAgICBdKTsKICAgICAgICAKICAgICAgICAkbmVnYXRpdmVDYXJyeUZvcndhcmRlZCA9IEZpc2NhbFllYXJDbG9zaW5nTGVkZ2VyOjpqb2luKCdmaXNjYWxfeWVhcl9jbG9zaW5ncycsICdmaXNjYWxfeWVhcl9jbG9zaW5ncy5pZCcsICc9JywgJ2Zpc2NhbF95ZWFyX2Nsb3NpbmdfbGVkZ2Vycy5maXNjYWxfeWVhcl9jbG9zaW5nX2lkJykKICAgICAgICAgICAgLT5qb2luKCdjaGFydF9vZl9hY2NvdW50cycsICdjaGFydF9vZl9hY2NvdW50cy5pZCcsICc9JywgJ2Zpc2NhbF95ZWFyX2Nsb3NpbmdfbGVkZ2Vycy5jaGFydF9vZl9hY2NvdW50X2lkJykKICAgICAgICAgICAgLT53aGVyZSgnZmlzY2FsX3llYXJfY2xvc2luZ3MuY29tcGFueV9pZCcsICRyZXF1ZXN0LT5jb21wYW55X2lkKQogICAgICAgICAgICAtPndoZXJlKCdmaXNjYWxfeWVhcl9jbG9zaW5ncy50b19maXNjYWxfeWVhcl9pZCcsICRyZXF1ZXN0LT5maXNjYWxfeWVhcl9pZCkKICAgICAgICAgICAgLT53aGVuKCRyZXF1ZXN0LT5uZWdhdGl2ZV9hY2NvdW50X2dyb3VwX2lkID4gMCwgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkbmVnYXRpdmVBY2NvdW50cykgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignZmlzY2FsX3llYXJfY2xvc2luZ19sZWRnZXJzLmNoYXJ0X29mX2FjY291bnRfaWQnLCAkbmVnYXRpdmVBY2NvdW50cyk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmVOdWxsKCdjaGFydF9vZl9hY2NvdW50cy5kZWxldGVkX2F0JykKICAgICAgICAgICAgLT5nZXQoWwogICAgICAgICAgICAgICAgREI6OnJhdygnc3VtKGZpc2NhbF95ZWFyX2Nsb3NpbmdfbGVkZ2Vycy5jYXJyeV9mb3J3YXJkaW5nX2Ftb3VudCkgYXMgYW1vdW50JykKICAgICAgICAgICAgXSk7CiAgICAgICAgCiAgICAgICAgJGNvbXBhbnkgPSBDb21wYW55Ojp3aXRoKFsKICAgICAgICAgICAgJ3Byb2ZpdENlbnRyZXMnCiAgICAgICAgXSkKICAgICAgICAgICAgLT5maW5kKCRyZXF1ZXN0LT5jb21wYW55X2lkKTsKICAgICAgICAKICAgICAgICAkZW50cmllcyA9IFtdOwogICAgICAgIGlmIChpc3NldCgkY29tcGFueS0+cHJvZml0Q2VudHJlc1swXSkpIHsKICAgICAgICAgICAgZm9yZWFjaCAoJGNvbXBhbnktPnByb2ZpdENlbnRyZXMgYXMgJHByb2ZpdENlbnRyZSkgewogICAgICAgICAgICAgICAgJHZhbHVlID0gKCgkcG9zaXRpdmVEZWJpdEJhbGFuY2VzLT53aGVyZSgncHJvZml0X2NlbnRyZV9pZCcsICRwcm9maXRDZW50cmUtPmlkKS0+c3VtKCdhbW91bnQnKSAtICRwb3NpdGl2ZUNyZWRpdEJhbGFuY2VzLT53aGVyZSgncHJvZml0X2NlbnRyZV9pZCcsICRwcm9maXRDZW50cmUtPmlkKS0+c3VtKCdhbW91bnQnKSkgLSAoJG5lZ2F0aXZlRGViaXRCYWxhbmNlcy0+d2hlcmUoJ3Byb2ZpdF9jZW50cmVfaWQnLCAkcHJvZml0Q2VudHJlLT5pZCktPnN1bSgnYW1vdW50JykgLSAkbmVnYXRpdmVDcmVkaXRCYWxhbmNlcy0+d2hlcmUoJ3Byb2ZpdF9jZW50cmVfaWQnLCAkcHJvZml0Q2VudHJlLT5pZCktPnN1bSgnYW1vdW50JykpKTsKICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGVudHJpZXMsIFsKICAgICAgICAgICAgICAgICAgICAna2V5JyA9PiAkcHJvZml0Q2VudHJlLT5uYW1lLAogICAgICAgICAgICAgICAgICAgICd2YWx1ZScgPT4gJHZhbHVlIDwgMCA/ICR2YWx1ZSAqICgtMSkgOiAkdmFsdWUsCiAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICR2YWx1ZSA8IDAgPyAnQ3InIDogJ0RyJwogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgJHBvc2l0aXZlQWNjb3VudEdyb3VwID0gQWNjb3VudEdyb3VwOjpmaW5kKCRyZXF1ZXN0LT5wb3NpdGl2ZV9hY2NvdW50X2dyb3VwX2lkKTsKICAgICAgICAkbmVnYXRpdmVBY2NvdW50R3JvdXAgPSBBY2NvdW50R3JvdXA6OmZpbmQoJHJlcXVlc3QtPm5lZ2F0aXZlX2FjY291bnRfZ3JvdXBfaWQpOwogICAgICAgICRmaXNjYWxZZWFyID0gRmlzY2FsWWVhcjo6ZmluZCgkcmVxdWVzdC0+ZmlzY2FsX3llYXJfaWQpOwogICAgICAgIHJldHVybiB2aWV3KCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMuY2hhcnRzLnRyYW5zYWN0aW9ucycsIFsKICAgICAgICAgICAgJ3RpdGxlJyA9PiAkY29tcGFueS0+Y29kZSAuICcgJyAuICR0aGlzLT50cmFuc2FjdGlvbnMoKVskc2x1Z11bJ25hbWUnXSAuICcgKCcgLiAoaXNzZXQoJHBvc2l0aXZlQWNjb3VudEdyb3VwLT5pZCkgPyAkcG9zaXRpdmVBY2NvdW50R3JvdXAtPm5hbWUgOiAnQWxsIEFjY291bnQgZ3JvdXBzJykgLiAnIC0gJyAuIChpc3NldCgkbmVnYXRpdmVBY2NvdW50R3JvdXAtPmlkKSA/ICRuZWdhdGl2ZUFjY291bnRHcm91cC0+bmFtZSA6ICdBbGwgQWNjb3VudCBncm91cHMnKSAuICcgfCAnIC4gJGZpc2NhbFllYXItPnRpdGxlIC4gJyB8ICcgLiAkcmVxdWVzdC0+dG8gLiAnKScsCiAgICAgICAgICAgICd0cmFuc2FjdGlvbicgPT4gJHRoaXMtPnRyYW5zYWN0aW9ucygpWyRzbHVnXSwKICAgICAgICAgICAgJ2VudHJpZXMnID0+ICRlbnRyaWVzLAogICAgICAgICAgICAnY29uc29saWRhdGVkJyA9PiAoKCRwb3NpdGl2ZURlYml0QmFsYW5jZXMtPnN1bSgnYW1vdW50JykgLSAkcG9zaXRpdmVDcmVkaXRCYWxhbmNlcy0+c3VtKCdhbW91bnQnKSkgLSAoJG5lZ2F0aXZlRGViaXRCYWxhbmNlcy0+c3VtKCdhbW91bnQnKSAtICRuZWdhdGl2ZUNyZWRpdEJhbGFuY2VzLT5zdW0oJ2Ftb3VudCcpKSkgKyAoJHBvc2l0aXZlQ2FycnlGb3J3YXJkZWQtPnN1bSgnYW1vdW50JykgKyAkbmVnYXRpdmVDYXJyeUZvcndhcmRlZC0+c3VtKCdhbW91bnQnKSksCiAgICAgICAgICAgICdjYXJyeUZvcndhcmRlZCcgPT4gJHBvc2l0aXZlQ2FycnlGb3J3YXJkZWQtPnN1bSgnYW1vdW50JykgKyAkbmVnYXRpdmVDYXJyeUZvcndhcmRlZC0+c3VtKCdhbW91bnQnKSwKICAgICAgICAgICAgJ3ZpZXcnID0+ICR2aWV3CiAgICAgICAgXSk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRDaGVxdWVOdW1iZXIoJGJhbmtfYWNjb3VudF9pZCkKICAgIHsKICAgICAgICAkcGFnZSA9IENoZXF1ZUJvb2tQYWdlOjp3aGVyZUhhcygnY2hlcXVlQm9vaycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGJhbmtfYWNjb3VudF9pZCkgewogICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnYmFua19hY2NvdW50X2lkJywgJGJhbmtfYWNjb3VudF9pZCk7CiAgICAgICAgfSkKICAgICAgICAgICAgLT5kb2VzbnRIYXZlKCdlbnRyaWVzJykKICAgICAgICAgICAgLT53aGVyZSgnaXNfZGFtYWdlZCcsIDApCiAgICAgICAgICAgIC0+Zmlyc3QoKTsKICAgICAgICByZXR1cm4gaXNzZXQoJHBhZ2UtPnBhZ2VfbnVtYmVyKSA/ICRwYWdlLT5wYWdlX251bWJlciA6ICcnOwogICAgfQogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gYXBwcm92YWwoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgkcmVxdWVzdC0+dGFibGUgPT0gImFjY291bnRfZ3JvdXBzIikgewogICAgICAgICAgICAgICAgJG9iamVjdCA9IFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xBY2NvdW50R3JvdXA6OmZpbmRPckZhaWwoJHJlcXVlc3QtPmlkKTsKICAgICAgICAgICAgfSBlbHNlaWYgKCRyZXF1ZXN0LT50YWJsZSA9PSAiY2hhcnRfb2ZfYWNjb3VudHMiKSB7CiAgICAgICAgICAgICAgICAkb2JqZWN0ID0gXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXENoYXJ0T2ZBY2NvdW50OjpmaW5kT3JGYWlsKCRyZXF1ZXN0LT5pZCk7CiAgICAgICAgICAgIH0gZWxzZWlmICgkcmVxdWVzdC0+dGFibGUgPT0gImJhbmtfYWNjb3VudHMiKSB7CiAgICAgICAgICAgICAgICAkb2JqZWN0ID0gXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEJhbmtBY2NvdW50OjpmaW5kT3JGYWlsKCRyZXF1ZXN0LT5pZCk7CiAgICAgICAgICAgIH0gZWxzZWlmICgkcmVxdWVzdC0+dGFibGUgPT0gImVudHJpZXMiKSB7CiAgICAgICAgICAgICAgICAkb2JqZWN0ID0gXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEVudHJ5OjpmaW5kT3JGYWlsKCRyZXF1ZXN0LT5pZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChpc3NldCgkb2JqZWN0LT5pZCkpIHsKICAgICAgICAgICAgICAgICRmaWVsZCA9ICRyZXF1ZXN0LT5maWVsZDsKICAgICAgICAgICAgICAgICRvYmplY3QtPiRmaWVsZCA9ICRyZXF1ZXN0LT52YWx1ZTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKCRyZXF1ZXN0LT50YWJsZSA9PSAiZW50cmllcyIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYXV0aCgpLT51c2VyKCktPmhhc1Blcm1pc3Npb25UbygndHJhbnNhY3Rpb24tcmV2aWV3JykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG9iamVjdC0+cmV2aWV3ZWRfYnkgPSBhdXRoKCktPnVzZXIoKS0+aWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICRvYmplY3QtPmFzc2Vzc2VkX2J5ID0gYXV0aCgpLT51c2VyKCktPmlkOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAoYXV0aCgpLT51c2VyKCktPmhhc1Blcm1pc3Npb25UbygndHJhbnNhY3Rpb24tYXNzZXNzbWVudCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRvYmplY3QtPmFzc2Vzc2VkX2J5ID0gYXV0aCgpLT51c2VyKCktPmlkOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAoYXV0aCgpLT51c2VyKCktPmhhc1Blcm1pc3Npb25UbygndHJhbnNhY3Rpb24tYXBwcm92YWwnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkb2JqZWN0LT5hcHByb3ZlZF9ieSA9IGF1dGgoKS0+dXNlcigpLT5pZDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICRvYmplY3QtPnNhdmUoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKCRvYmplY3QpIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+YXBwcm92YWxOb3RpZmljYXRpb24oJHJlcXVlc3QsICRvYmplY3QpOwogICAgICAgICAgICAgICAgICAgIERCOjpjb21taXQoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gIlN0YXR1cyBoYXMgYmVlbiB1cGRhdGVkISIKICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJEYXRhIG5vdCBmb3VuZCEiCiAgICAgICAgICAgIF0pOwogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJHRoLT5nZXRNZXNzYWdlKCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gYXBwcm92YWxOb3RpZmljYXRpb24oJHJlcXVlc3QsICRvYmplY3QpCiAgICB7CiAgICAgICAgaWYgKCRyZXF1ZXN0LT5maWVsZCA9PSAnaXNfcmV2aWV3ZWQnKSB7CiAgICAgICAgICAgICRwcmV2aW91cyA9IFxBcHBcVXNlcjo6cm9sZSgnQWNjb3VudHMtUmVxdWVzdGVyJyktPmZpcnN0KCk7CiAgICAgICAgICAgIGlmIChpc3NldCgkcHJldmlvdXMtPmlkKSkgewogICAgICAgICAgICAgICAgJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgZGF0YS10aXRsZT0iUmV2aWV3ZWQiPkEgJyAuICR0aGlzLT5nZXROb3RpZnlNb2R1bGUoJHJlcXVlc3QsICRvYmplY3QpIC4gJyB3aXRoIGNvZGUgIycgLiAkb2JqZWN0LT5jb2RlIC4gJyBoYXMgYmVlbiAnIC4gdWN3b3JkcygkcmVxdWVzdC0+dmFsdWUpIC4gJyBpbiBSZXZpZXc8L3NwYW4+JzsKICAgICAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCRtZXNzYWdlLCAndW5yZWFkJywgJycsICRwcmV2aW91cy0+aWQsICdhY2NvdW50aW5nLXJldmlldycpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoJHJlcXVlc3QtPnZhbHVlID09ICdhcHByb3ZlZCcpIHsKICAgICAgICAgICAgICAgICRuZXh0ID0gXEFwcFxVc2VyOjpyb2xlKCdBY2NvdW50cy1Bc3Nlc3NtZW50JyktPmZpcnN0KCk7CiAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJG5leHQtPmlkKSkgewogICAgICAgICAgICAgICAgICAgICRtZXNzYWdlID0gJzxzcGFuIGNsYXNzPSJub3RpZmljYXRpb24tbGlua3MiIGRhdGEtdGl0bGU9IldhaXRpbmcgZm9yIEFzc2Vzc21lbnQiPkEgTmV3ICcgLiAkdGhpcy0+Z2V0Tm90aWZ5TW9kdWxlKCRyZXF1ZXN0LCAkb2JqZWN0KSAuICcgd2l0aCBjb2RlICMnIC4gJG9iamVjdC0+Y29kZSAuICcgaGFzIGJlZW4gcmV2aWV3ZWQgYW5kIHdhaXRpbmcgZm9yIGFzc2Vzc21lbnQ8L3NwYW4+JzsKICAgICAgICAgICAgICAgICAgICBDcmVhdGVPclVwZGF0ZU5vdGlmaWNhdGlvbigkbWVzc2FnZSwgJ3VucmVhZCcsICcnLCAkbmV4dC0+aWQsICdhY2NvdW50aW5nLWFzc2Vzc21lbnQnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZWlmICgkcmVxdWVzdC0+ZmllbGQgPT0gJ2lzX2Fzc2Vzc2VkJykgewogICAgICAgICAgICAkcHJldmlvdXMgPSBcQXBwXFVzZXI6OnJvbGUoJ0FjY291bnRzLVJldmlld2VyJyktPmZpcnN0KCk7CiAgICAgICAgICAgIGlmIChpc3NldCgkcHJldmlvdXMtPmlkKSkgewogICAgICAgICAgICAgICAgJG1lc3NhZ2UgPSAnPHNwYW4gY2xhc3M9Im5vdGlmaWNhdGlvbi1saW5rcyIgZGF0YS10aXRsZT0iQXNzZXNzZWQiPkEgJyAuICR0aGlzLT5nZXROb3RpZnlNb2R1bGUoJHJlcXVlc3QsICRvYmplY3QpIC4gJyB3aXRoIGNvZGUgIycgLiAkb2JqZWN0LT5jb2RlIC4gJyBoYXMgYmVlbiAnIC4gdWN3b3JkcygkcmVxdWVzdC0+dmFsdWUpIC4gJyBpbiBhc3Nlc3NtZW50PC9zcGFuPic7CiAgICAgICAgICAgICAgICBDcmVhdGVPclVwZGF0ZU5vdGlmaWNhdGlvbigkbWVzc2FnZSwgJ3VucmVhZCcsICcnLCAnYWNjb3VudGluZy1hc3Nlc3NtZW50JywgJHByZXZpb3VzLT5pZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICgkcmVxdWVzdC0+dmFsdWUgPT0gJ2FwcHJvdmVkJykgewogICAgICAgICAgICAgICAgJG5leHQgPSBcQXBwXFVzZXI6OnJvbGUoJ0FjY291bnRzJyktPmZpcnN0KCk7CiAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJG5leHQtPmlkKSkgewogICAgICAgICAgICAgICAgICAgICRtZXNzYWdlID0gJzxzcGFuIGNsYXNzPSJub3RpZmljYXRpb24tbGlua3MiIGRhdGEtdGl0bGU9IldhaXRpbmcgZm9yIEFwcHJvdmFsIj5BIE5ldyAnIC4gJHRoaXMtPmdldE5vdGlmeU1vZHVsZSgkcmVxdWVzdCwgJG9iamVjdCkgLiAnIHdpdGggY29kZSAjJyAuICRvYmplY3QtPmNvZGUgLiAnIGhhcyBiZWVuIGFzc2Vzc2VkIGFuZCB3YWl0aW5nIGZvciBhcHByb3ZhbDwvc3Bhbj4nOwogICAgICAgICAgICAgICAgICAgIENyZWF0ZU9yVXBkYXRlTm90aWZpY2F0aW9uKCRtZXNzYWdlLCAndW5yZWFkJywgJycsICdhY2NvdW50aW5nLWFwcHJvdmFsJywgJG5leHQtPmlkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZWlmICgkcmVxdWVzdC0+ZmllbGQgPT0gJ2lzX2FwcHJvdmVkJykgewogICAgICAgICAgICAkcHJldmlvdXMgPSBcQXBwXFVzZXI6OnJvbGUoJ0FjY291bnRzLUFzc2Vzc21lbnQnKS0+Zmlyc3QoKTsKICAgICAgICAgICAgaWYgKGlzc2V0KCRwcmV2aW91cy0+aWQpKSB7CiAgICAgICAgICAgICAgICAkbWVzc2FnZSA9ICc8c3BhbiBjbGFzcz0ibm90aWZpY2F0aW9uLWxpbmtzIiBkYXRhLXRpdGxlPSJBcHByb3ZhbCBDb21wbGV0ZWQiPkEgJyAuICR0aGlzLT5nZXROb3RpZnlNb2R1bGUoJHJlcXVlc3QsICRvYmplY3QpIC4gJyB3aXRoIGNvZGUgIycgLiAkb2JqZWN0LT5jb2RlIC4gJyBoYXMgYmVlbiAnIC4gdWN3b3JkcygkcmVxdWVzdC0+dmFsdWUpIC4gJyBpbiBBcHByb3ZhbDwvc3Bhbj4nOwogICAgICAgICAgICAgICAgQ3JlYXRlT3JVcGRhdGVOb3RpZmljYXRpb24oJG1lc3NhZ2UsICd1bnJlYWQnLCAnJywgJ2FjY291bnRpbmctYXBwcm92YWwnLCAkcHJldmlvdXMtPmlkKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIAogICAgcHVibGljIGZ1bmN0aW9uIGdldE5vdGlmeU1vZHVsZSgkcmVxdWVzdCwgJG9iamVjdCkKICAgIHsKICAgICAgICBpZiAoJHJlcXVlc3QtPnRhYmxlID09ICJhY2NvdW50X2dyb3VwcyIpIHsKICAgICAgICAgICAgcmV0dXJuICJBY2NvdW50IEdyb3VwIjsKICAgICAgICB9IGVsc2VpZiAoJHJlcXVlc3QtPnRhYmxlID09ICJjaGFydF9vZl9hY2NvdW50cyIpIHsKICAgICAgICAgICAgcmV0dXJuICJDaGFydCBvZiBBY2NvdW50IjsKICAgICAgICB9IGVsc2VpZiAoJHJlcXVlc3QtPnRhYmxlID09ICJiYW5rX2FjY291bnRzIikgewogICAgICAgICAgICByZXR1cm4gIkJhbmsgQWNjb3VudCI7CiAgICAgICAgfSBlbHNlaWYgKCRyZXF1ZXN0LT50YWJsZSA9PSAiZW50cmllcyIpIHsKICAgICAgICAgICAgcmV0dXJuICgkb2JqZWN0LT5lbnRyeVR5cGUtPm5hbWUgLiAnIEVudHJ5Jyk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gdG9nZ2xlU3RhdHVzKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJHJvdyA9IFxEQjo6dGFibGUoJHJlcXVlc3QtPnRhYmxlKQogICAgICAgICAgICAtPndoZXJlKCdpZCcsICRyZXF1ZXN0LT5pZCkKICAgICAgICAgICAgLT5maXJzdCgpOwogICAgICAgIAogICAgICAgIGlmIChpc3NldCgkcm93LT5pZCkpIHsKICAgICAgICAgICAgJG9sZF9zdGF0dXMgPSAkcm93LT5zdGF0dXM7CiAgICAgICAgICAgICRuZXdfc3RhdHVzID0gJG9sZF9zdGF0dXMgPT0gMSA/IDAgOiAxOwogICAgICAgICAgICAKICAgICAgICAgICAgJG9sZF9jbGFzcyA9ICRvbGRfc3RhdHVzID09IDEgPyAnYnRuLXN1Y2Nlc3MnIDogJ2J0bi1kYW5nZXInOwogICAgICAgICAgICAkbmV3X2NsYXNzID0gJG5ld19zdGF0dXMgPT0gMSA/ICdidG4tc3VjY2VzcycgOiAnYnRuLWRhbmdlcic7CiAgICAgICAgICAgIAogICAgICAgICAgICAkbmV3X3RleHQgPSAkbmV3X3N0YXR1cyA9PSAxID8gJzxpIGNsYXNzPSJsYSBsYS1jaGVjayB0ZXh0LXdoaXRlIj48L2k+JyA6ICc8aSBjbGFzcz0ibGEgbGEtYmFuIHRleHQtd2hpdGUiPjwvaT4nOwogICAgICAgICAgICAKICAgICAgICAgICAgJHVwZGF0ZSA9IFxEQjo6dGFibGUoJHJlcXVlc3QtPnRhYmxlKQogICAgICAgICAgICAgICAgLT53aGVyZSgnaWQnLCAkcmVxdWVzdC0+aWQpCiAgICAgICAgICAgICAgICAtPnVwZGF0ZShbCiAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gJG5ld19zdGF0dXMsCiAgICAgICAgICAgICAgICAgICAgJ3VwZGF0ZWRfYXQnID0+IGRhdGUoJ1ktbS1kIEg6aTpzJykKICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChpc3NldCgkcm93LT51cGRhdGVkX2J5KSkgewogICAgICAgICAgICAgICAgXERCOjp0YWJsZSgkcmVxdWVzdC0+dGFibGUpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnaWQnLCAkcmVxdWVzdC0+aWQpCiAgICAgICAgICAgICAgICAgICAgLT51cGRhdGUoWwogICAgICAgICAgICAgICAgICAgICAgICAndXBkYXRlZF9ieScgPT4gYXV0aCgpLT51c2VyKCktPmlkCiAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICgkdXBkYXRlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICAgICAgICAgICAgICAgICAgJ29sZF9jbGFzcycgPT4gJG9sZF9jbGFzcywKICAgICAgICAgICAgICAgICAgICAnbmV3X2NsYXNzJyA9PiAkbmV3X2NsYXNzLAogICAgICAgICAgICAgICAgICAgICduZXdfdGV4dCcgPT4gJG5ld190ZXh0LAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAnRGF0YSBoYXMgYmVlbiB1cGRhdGVkIScKICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJ1NvbWV0aGluZyBXZW50IFdyb25nIScKICAgICAgICAgICAgXSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAnbWVzc2FnZScgPT4gJ0RhdGEgbm90IGZvdW5kIScKICAgICAgICBdKTsKICAgIH0KfQo=