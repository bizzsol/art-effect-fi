<?php
bolt_decrypt( __FILE__ , 'liXYC7'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcTXlhY2NvdW50aW5nOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKCnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDb21wYW55Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQWNjb3VudENsYXNzOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQWNjb3VudEdyb3VwOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQ2hhcnRPZkFjY291bnQ7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xTdWJMZWRnZXI7CnVzZSBBcHBcVXNlcjsKCnVzZSBBcHAsREI7CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xBdXRoOwp1c2UgRGF0YVRhYmxlczsKCmNsYXNzIFN1YkxlZGdlckNvbnRyb2xsZXIgZXh0ZW5kcyBDb250cm9sbGVyCnsgICAKICAgIHB1YmxpYyBmdW5jdGlvbiBoZWFkZXJDb2x1bW5zKCR2YWx1ZT0nJykKICAgIHsKICAgICAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgICAgIFsnU0wnLCAnU0wnXSwKICAgICAgICAgICAgWydsZWRnZXInLCAnbGVkZ2VyJ10sCiAgICAgICAgICAgIFsnc3ViX2xlZGdlcl9jb2RlJywgJ3N1Yl9sZWRnZXJfY29kZScsJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnc3ViX2xlZGdlcl9uYW1lJywgJ3N1Yl9sZWRnZXJfbmFtZScsJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnbm90ZXMnLCAnbm90ZXMnLCd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2NvbXBhbmllcycsICdjb21wYW5pZXMnLCd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2FjdGlvbnMnLCAnYWN0aW9ucycsICd0ZXh0LWNlbnRlciddCiAgICAgICAgKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gaW5kZXgoKQogICAgewogICAgICAgIHJldHVybiByZWRpcmVjdCgnYWNjb3VudGluZy9jaGFydC1vZi1hY2NvdW50cycpOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBzaG93KCRpZCkKICAgIHsKICAgICAgICAkYWNjb3VudCA9IENoYXJ0T2ZBY2NvdW50OjpmaW5kT3JGYWlsKCRpZCk7CiAgICAgICAgJHRpdGxlID0gJ1N1YiBMZWRnZXJzIG9mICNbJy4kYWNjb3VudC0+Y29kZS4nXSAnLiRhY2NvdW50LT5uYW1lOwogICAgICAgICRvcHRpb25zID0gWwogICAgICAgICAgICAnc3ViLWxlZGdlcnMtZWRpdCcgPT4gYXV0aCgpLT51c2VyKCktPmhhc1Blcm1pc3Npb25Ubygnc3ViLWxlZGdlcnMtZWRpdCcpLAogICAgICAgICAgICAnc3ViLWxlZGdlcnMtZGVsZXRlJyA9PiBhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdzdWItbGVkZ2Vycy1kZWxldGUnKQogICAgICAgIF07CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChyZXF1ZXN0KCktPmFqYXgoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIERhdGF0YWJsZXM6Om9mKAogICAgICAgICAgICAgICAgICAgIFN1YkxlZGdlcjo6d2l0aChbCiAgICAgICAgICAgICAgICAgICAgICAgICdjaGFydE9mQWNjb3VudC5hY2NvdW50R3JvdXAuYWNjb3VudENsYXNzJywKICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0T2ZBY2NvdW50LmNvbXBhbmllcy5jb21wYW55JywKICAgICAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2NoYXJ0X29mX2FjY291bnRfaWQnLCAkaWQpCiAgICAgICAgICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlcmJ5KCdjb2RlJywgJ2FzYycpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAtPmFkZEluZGV4Q29sdW1uKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gLT5hZGRDb2x1bW4oJ2FjY291bnRfY2xhc3MnLCBmdW5jdGlvbigkc3ViTGVkZ2VyKSB7CiAgICAgICAgICAgICAgICAvLyAgICAgcmV0dXJuIGlzc2V0KCRzdWJMZWRnZXItPmNoYXJ0T2ZBY2NvdW50LT5hY2NvdW50R3JvdXAtPmFjY291bnRDbGFzcy0+bmFtZSkgPyAkc3ViTGVkZ2VyLT5jaGFydE9mQWNjb3VudC0+YWNjb3VudEdyb3VwLT5hY2NvdW50Q2xhc3MtPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgIC8vIH0pCiAgICAgICAgICAgICAgICAvLyAtPmZpbHRlckNvbHVtbignYWNjb3VudF9jbGFzcycsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAvLyAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2NoYXJ0T2ZBY2NvdW50LmFjY291bnRHcm91cC5hY2NvdW50Q2xhc3MnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgIC8vICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAvLyAgICAgfSk7CiAgICAgICAgICAgICAgICAvLyB9KQogICAgICAgICAgICAgICAgLy8gLT5vcmRlckNvbHVtbignYWNjb3VudF9jbGFzcycsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgLy8gICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIENoYXJ0T2ZBY2NvdW50OjpzZWxlY3QoJ2FjY291bnRfY2xhc3Nlcy5uYW1lJykKICAgICAgICAgICAgICAgIC8vICAgICAgICAgLT5qb2luKCdhY2NvdW50X2NsYXNzZXMnLCAnYWNjb3VudF9jbGFzc2VzLmlkJywgJz0nLCAnYWNjb3VudF9ncm91cHMuYWNjb3VudF9jbGFzc19pZCcpCiAgICAgICAgICAgICAgICAvLyAgICAgICAgIC0+am9pbignYWNjb3VudF9ncm91cHMnLCAnYWNjb3VudF9ncm91cHMuaWQnLCAnPScsICdjaGFydF9vZl9hY2NvdW50cy5hY2NvdW50X2dyb3VwX2lkJykKICAgICAgICAgICAgICAgIC8vICAgICAgICAgLT53aGVyZUNvbHVtbignY2hhcnRfb2ZfYWNjb3VudHMuaWQnLCAnc3ViX2xlZGdlcnMuY2hhcnRfb2ZfYWNjb3VudF9pZCcpCiAgICAgICAgICAgICAgICAvLyAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgLy8gICAgICk7CiAgICAgICAgICAgICAgICAvLyB9KQoKICAgICAgICAgICAgICAgIC8vIC0+YWRkQ29sdW1uKCdhY2NvdW50X2dyb3VwJywgZnVuY3Rpb24oJHN1YkxlZGdlcikgewogICAgICAgICAgICAgICAgLy8gICAgIHJldHVybiBpc3NldCgkc3ViTGVkZ2VyLT5jaGFydE9mQWNjb3VudC0+YWNjb3VudEdyb3VwLT5uYW1lKSA/ICdbJy4kc3ViTGVkZ2VyLT5jaGFydE9mQWNjb3VudC0+YWNjb3VudEdyb3VwLT5jb2RlLiddICcuJHN1YkxlZGdlci0+Y2hhcnRPZkFjY291bnQtPmFjY291bnRHcm91cC0+bmFtZSA6ICcnOwogICAgICAgICAgICAgICAgLy8gfSkKICAgICAgICAgICAgICAgIC8vIC0+ZmlsdGVyQ29sdW1uKCdhY2NvdW50X2dyb3VwJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgIC8vICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnY2hhcnRPZkFjY291bnQuYWNjb3VudEdyb3VwJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAvLyAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpCiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgIC0+b3JXaGVyZSgnY29kZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAvLyAgICAgfSk7CiAgICAgICAgICAgICAgICAvLyB9KQogICAgICAgICAgICAgICAgLy8gLT5vcmRlckNvbHVtbignYWNjb3VudF9ncm91cCcsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgLy8gICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIENoYXJ0T2ZBY2NvdW50OjpzZWxlY3QoJ2FjY291bnRfZ3JvdXBzLmNvZGUnKQogICAgICAgICAgICAgICAgLy8gICAgICAgICAtPmpvaW4oJ2FjY291bnRfZ3JvdXBzJywgJ2FjY291bnRfZ3JvdXBzLmlkJywgJz0nLCAnY2hhcnRfb2ZfYWNjb3VudHMuYWNjb3VudF9ncm91cF9pZCcpCiAgICAgICAgICAgICAgICAvLyAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ2NoYXJ0X29mX2FjY291bnRzLmlkJywgJ3N1Yl9sZWRnZXJzLmNoYXJ0X29mX2FjY291bnRfaWQnKQogICAgICAgICAgICAgICAgLy8gICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgIC8vICAgICApOwogICAgICAgICAgICAgICAgLy8gfSkKCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignbGVkZ2VyJywgZnVuY3Rpb24oJHN1YkxlZGdlcikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkc3ViTGVkZ2VyLT5jaGFydE9mQWNjb3VudC0+bmFtZSkgPyAnWycuJHN1YkxlZGdlci0+Y2hhcnRPZkFjY291bnQtPmNvZGUuJ10gJy4kc3ViTGVkZ2VyLT5jaGFydE9mQWNjb3VudC0+bmFtZSA6ICcnOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdsZWRnZXInLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdjaGFydE9mQWNjb3VudCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPm9yV2hlcmUoJ2NvZGUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2xlZGdlcicsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIENoYXJ0T2ZBY2NvdW50OjpzZWxlY3QoJ2NoYXJ0X29mX2FjY291bnRzLmNvZGUnKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdjaGFydF9vZl9hY2NvdW50cy5pZCcsICdzdWJfbGVkZ2Vycy5jaGFydF9vZl9hY2NvdW50X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2NvbXBhbmllcycsIGZ1bmN0aW9uKCRzdWJMZWRnZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHN1YkxlZGdlci0+Y2hhcnRPZkFjY291bnQtPm5hbWUpID8gJHN1YkxlZGdlci0+Y2hhcnRPZkFjY291bnQtPmNvbXBhbmllcy0+cGx1Y2soJ2NvbXBhbnkuY29kZScpLT5pbXBsb2RlKCcsICcpIDogJyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2NvbXBhbmllcycsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2NoYXJ0T2ZBY2NvdW50LmNvbXBhbmllcy5jb21wYW55JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+b3JXaGVyZSgnY29kZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignY29tcGFuaWVzJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgQ2hhcnRPZkFjY291bnQ6OnNlbGVjdCgnY29tcGFueS5jb2RlJykKICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdjb21wYW5pZXMnLCAnY29tcGFuaWVzLmlkJywgJz0nLCAnY2hhcnRfb2ZfYWNjb3VudF9jb21wYW5pZXMuY29tcGFueV9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignY2hhcnRfb2ZfYWNjb3VudF9jb21wYW5pZXMnLCAnY2hhcnRfb2ZfYWNjb3VudF9jb21wYW5pZXMuY2hhcnRfb2ZfYWNjb3VudF9pZCcsICc9JywgJ2NoYXJ0X29mX2FjY291bnRzLmlkJykKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbignY2hhcnRfb2ZfYWNjb3VudHMuaWQnLCAnc3ViX2xlZGdlcnMuY2hhcnRfb2ZfYWNjb3VudF9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdzdWJfbGVkZ2VyX2NvZGUnLCBmdW5jdGlvbigkc3ViTGVkZ2VyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzdWJMZWRnZXItPmNvZGU7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3N1Yl9sZWRnZXJfY29kZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2NvZGUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3N1Yl9sZWRnZXJfY29kZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyQnkoJ2NvZGUnLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignc3ViX2xlZGdlcl9uYW1lJywgZnVuY3Rpb24oJHN1YkxlZGdlcikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkc3ViTGVkZ2VyLT5uYW1lOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdzdWJfbGVkZ2VyX25hbWUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdzdWJfbGVkZ2VyX25hbWUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlckJ5KCduYW1lJywgJG9yZGVyKTsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FjdGlvbnMnLCBmdW5jdGlvbigkc3ViTGVkZ2VyKSB1c2UoJG9wdGlvbnMpewogICAgICAgICAgICAgICAgICAgICRhY3Rpb25zID0gJyc7CgogICAgICAgICAgICAgICAgICAgIGlmKCRvcHRpb25zWydzdWItbGVkZ2Vycy1lZGl0J10pewogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGEgY2xhc3M9ImJ0biBidG4teHMgYnRuLXByaW1hcnkgcm91bmRlZC1jaXJjbGUgbS0xIiBocmVmPSInLiB1cmwoJ2FjY291bnRpbmcvc3ViLWxlZGdlcnMvJy4kc3ViTGVkZ2VyLT5pZC4nL2VkaXQnKS4nIj48aSBjbGFzcz0ibGFzIGxhLWVkaXQiPjwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmKCRvcHRpb25zWydzdWItbGVkZ2Vycy1kZWxldGUnXSl7CiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8YSBocmVmPSJqYXZhc2NyaXB0OnZvaWQoMCkiIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi1kYW5nZXIgbS0xIiBkYXRhLXNyYz0iJy5yb3V0ZSgnYWNjb3VudGluZy5zdWItbGVkZ2Vycy5kZXN0cm95JywgJHN1YkxlZGdlci0+aWQpLiciIG9uY2xpY2s9ImRlbGV0ZUZyb21DUlVEKCQodGhpcykpIj48aSBjbGFzcz0ibGEgbGEtdHJhc2giPjwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhY3Rpb25zOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+cmF3Q29sdW1ucyhbJ2FjdGlvbnMnXSkKICAgICAgICAgICAgICAgIC0+bWFrZSh0cnVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGRhdGEgPSBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICR0aXRsZSwKICAgICAgICAgICAgICAgICdhY2NvdW50JyA9PiAkYWNjb3VudCwKICAgICAgICAgICAgICAgICdoZWFkZXJDb2x1bW5zJyA9PiAkdGhpcy0+aGVhZGVyQ29sdW1ucygpLAogICAgICAgICAgICBdOwoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5zdWJMZWRnZXJzLmluZGV4JywgJGRhdGEpOwogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gY3JlYXRlKCkKICAgIHsKICAgICAgICAkYWNjb3VudCA9IENoYXJ0T2ZBY2NvdW50OjpmaW5kT3JGYWlsKHJlcXVlc3QoKS0+Z2V0KCdjaGFydF9vZl9hY2NvdW50X2lkJykpOwogICAgICAgIHJldHVybiB2aWV3KCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMuc3ViTGVkZ2Vycy5jcmVhdGUnLCBbCiAgICAgICAgICAgICd0aXRsZScgPT4gJ05ldyBTdWIgTGVkZ2VyIGZvciAjWycuJGFjY291bnQtPmNvZGUuJ10gJy4kYWNjb3VudC0+bmFtZSwKICAgICAgICAgICAgJ2FjY291bnQnID0+ICRhY2NvdW50CiAgICAgICAgXSk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHN0b3JlKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJHJlcXVlc3QtPnZhbGlkYXRlKFsKICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdjb2RlJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnbmFtZScgPT4gJ3JlcXVpcmVkJywKICAgICAgICBdKTsKCiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnl7CiAgICAgICAgICAgIGlmKFN1YkxlZGdlcjo6d2hlcmUoJ2NoYXJ0X29mX2FjY291bnRfaWQnLCAkcmVxdWVzdC0+Y2hhcnRfb2ZfYWNjb3VudF9pZCktPndoZXJlKCdjb2RlJywgJHJlcXVlc3QtPmNvZGUpLT5jb3VudCgpID4gMCl7CiAgICAgICAgICAgICAgICBzZXNzaW9uKCktPmZsYXNoKCdhbGVydC10eXBlJywgJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICBzZXNzaW9uKCktPmZsYXNoKCdtZXNzYWdlJywgIlN1YiBMZWRnZXIgQ29kZSAjIi4kcmVxdWVzdC0+Y29kZS4iIGFscmVhZHkgYmVlbiBUYWtlbiEiKTsKICAgICAgICAgICAgICAgIHJldHVybiByZWRpcmVjdCgnYWNjb3VudGluZy9zdWItbGVkZ2Vycy9jcmVhdGU/Y2hhcnRfb2ZfYWNjb3VudF9pZD0nLiRyZXF1ZXN0LT5jaGFydF9vZl9hY2NvdW50X2lkKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHN1YkxlZGdlciA9IG5ldyBTdWJMZWRnZXIoKTsKICAgICAgICAgICAgJHN1YkxlZGdlci0+ZmlsbCgkcmVxdWVzdC0+YWxsKCkpOwogICAgICAgICAgICAkc3ViTGVkZ2VyLT5zYXZlKCk7CgogICAgICAgICAgICBEQjo6Y29tbWl0KCk7CiAgICAgICAgICAgIHNlc3Npb24oKS0+Zmxhc2goJ2FsZXJ0LXR5cGUnLCAnc3VjY2VzcycpOwogICAgICAgICAgICBzZXNzaW9uKCktPmZsYXNoKCdtZXNzYWdlJywgIlN1YiBMZWRnZXIgaGFzIGJlZW4gY3JlYXRlZCBzdWNjZXNzZnVsbHkiKTsKICAgICAgICAgICAgcmV0dXJuIHJlZGlyZWN0KCdhY2NvdW50aW5nL3N1Yi1sZWRnZXJzLycuJHJlcXVlc3QtPmNoYXJ0X29mX2FjY291bnRfaWQpOwogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgc2Vzc2lvbigpLT5mbGFzaCgnYWxlcnQtdHlwZScsICdlcnJvcicpOwogICAgICAgICAgICBzZXNzaW9uKCktPmZsYXNoKCdtZXNzYWdlJywgJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICByZXR1cm4gcmVkaXJlY3QoJ2FjY291bnRpbmcvc3ViLWxlZGdlcnMvY3JlYXRlP2NoYXJ0X29mX2FjY291bnRfaWQ9Jy4kcmVxdWVzdC0+Y2hhcnRfb2ZfYWNjb3VudF9pZCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBlZGl0KCRpZCkKICAgIHsKICAgICAgICAkc3ViTGVkZ2VyID0gU3ViTGVkZ2VyOjp3aXRoKFsKICAgICAgICAgICAgJ2NoYXJ0T2ZBY2NvdW50JywKICAgICAgICBdKS0+ZmluZE9yRmFpbCgkaWQpOwogICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAndGl0bGUnID0+ICdFZGl0IFN1Yi1MZWRnZXIgb2YgI1snLiRzdWJMZWRnZXItPmNoYXJ0T2ZBY2NvdW50LT5jb2RlLiddICcuJHN1YkxlZGdlci0+Y2hhcnRPZkFjY291bnQtPm5hbWUsCiAgICAgICAgICAgICdzdWJMZWRnZXInID0+ICRzdWJMZWRnZXIKICAgICAgICBdOwoKICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLnN1YkxlZGdlcnMuZWRpdCcsICRkYXRhKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gdXBkYXRlKFJlcXVlc3QgJHJlcXVlc3QsICRpZCkKICAgIHsKICAgICAgICAkcmVxdWVzdC0+dmFsaWRhdGUoWwogICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2NvZGUnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICduYW1lJyA9PiAncmVxdWlyZWQnLAogICAgICAgIF0pOwoKICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeXsKICAgICAgICAgICAgaWYoU3ViTGVkZ2VyOjp3aGVyZSgnY2hhcnRfb2ZfYWNjb3VudF9pZCcsICRyZXF1ZXN0LT5jaGFydF9vZl9hY2NvdW50X2lkKS0+d2hlcmUoJ2NvZGUnLCAkcmVxdWVzdC0+Y29kZSktPndoZXJlKCdpZCcsICchPScsICRpZCktPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigiU3ViIExlZGdlciBDb2RlICMiLiRyZXF1ZXN0LT5jb2RlLiIgYWxyZWFkeSBiZWVuIFRha2VuISIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkc3ViTGVkZ2VyID0gU3ViTGVkZ2VyOjpmaW5kT3JGYWlsKCRpZCk7CiAgICAgICAgICAgICRzdWJMZWRnZXItPmZpbGwoJHJlcXVlc3QtPmFsbCgpKTsKICAgICAgICAgICAgJHN1YkxlZGdlci0+c2F2ZSgpOwoKICAgICAgICAgICAgREI6OmNvbW1pdCgpOwogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoU3VjY2VzcygiQ29zdCBDZW50cmUgaGFzIGJlZW4gdXBkYXRlZCBzdWNjZXNzZnVsbHkiKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBkZXN0cm95KCRpZCkKICAgIHsKICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeXsKICAgICAgICAgICAgJHN1YmxlZGdlciA9IFN1YkxlZGdlcjo6d2l0aChbCiAgICAgICAgICAgICAgICAnZW50cnlJdGVtcycsCiAgICAgICAgICAgIF0pLT5maW5kT3JGYWlsKCRpZCk7CiAgICAgICAgICAgIGlmKCRzdWJsZWRnZXItPmVudHJ5SXRlbXMtPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJXaG9vcHMhIFRoaXMgU3ViIExlZGdlciBjb3VsZCBub3QgYmUgZGVsZXRlZCBiZWNhdXNlIGl0J3MgYWxyZWFkeSBiZWVuIHVzZWQgb24gb3RoZXIgZmVhdHVyZXMhIgogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRzdWJsZWRnZXItPmRlbGV0ZSgpOwogICAgICAgICAgICBEQjo6Y29tbWl0KCk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJTdWIgTGVkZ2VyIGhhcyBiZWVuIERlbGV0ZWQhIgogICAgICAgICAgICBdKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkdGgtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICB9Cn0K