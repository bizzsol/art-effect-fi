<?php
bolt_decrypt( __FILE__ , 'WDUEZq'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcTXlhY2NvdW50aW5nOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKCnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQ29tcGFueTsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xQcm9maXRDZW50cmU7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQ29zdENlbnRyZTsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xGaXNjYWxZZWFyOwp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEVudHJ5VHlwZTsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xUYWc7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQWNjb3VudEdyb3VwOwp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXENoYXJ0T2ZBY2NvdW50Owp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEVudHJ5Owp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEVudHJ5SXRlbTsKCnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcRmlzY2FsWWVhckNsb3Npbmc7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcRmlzY2FsWWVhckNsb3NpbmdMZWRnZXI7Cgp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEN1cnJlbmN5VHlwZTsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDdXJyZW5jeTsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xFeGNoYW5nZVJhdGU7Cgp1c2UgQXBwLCBEQjsKdXNlIElsbHVtaW5hdGVcU3VwcG9ydFxGYWNhZGVzXEF1dGg7CgpjbGFzcyBUcmlhbEJhbGFuY2VDb250cm9sbGVyIGV4dGVuZHMgQ29udHJvbGxlcgp7CiAgICBwdWJsaWMgZnVuY3Rpb24gaW5kZXgoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkdGl0bGUgPSAnUmVwb3J0IC0gVHJpYWwgQmFsYW5jZSc7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRmaXNjYWxZZWFyID0gZ2V0QWN0aXZlRmlzY2FsWWVhcigpOwogICAgICAgICAgICAkYWNjb3VudERlZmF1bHRTZXR0aW5ncyA9IGFjY291bnREZWZhdWx0U2V0dGluZ3MoKTsKICAgICAgICAgICAgJHN5c3RlbUN1cnJlbmN5ID0gc3lzdGVtQ3VycmVuY3koKTsKICAgICAgICAgICAgCiAgICAgICAgICAgICR0cmlhbEJhbGFuY2UgPSAnJzsKICAgICAgICAgICAgJGdyb3VwV2lzZSA9IGZhbHNlOwogICAgICAgICAgICBpZihyZXF1ZXN0KCktPmhhcygncmVwb3J0X3R5cGUnKSl7CiAgICAgICAgICAgICAgICAkY3VycmVuY3lfaWQgPSByZXF1ZXN0KCktPmhhcygnY3VycmVuY3lfaWQnKSA/IHJlcXVlc3QoKS0+Z2V0KCdjdXJyZW5jeV9pZCcpIDogMDsKICAgICAgICAgICAgICAgICRwcm9maXRfY2VudHJlX2lkID0gcmVxdWVzdCgpLT5oYXMoJ3Byb2ZpdF9jZW50cmVfaWQnKSA/IHJlcXVlc3QoKS0+Z2V0KCdwcm9maXRfY2VudHJlX2lkJykgOiAwOwogICAgICAgICAgICAgICAgJGNvc3RfY2VudHJlX2lkID0gcmVxdWVzdCgpLT5oYXMoJ2Nvc3RfY2VudHJlX2lkJykgPyByZXF1ZXN0KCktPmdldCgnY29zdF9jZW50cmVfaWQnKSA6IDA7CiAgICAgICAgICAgICAgICAkZmlzY2FsWWVhciA9IEZpc2NhbFllYXI6OmZpbmRPckZhaWwocmVxdWVzdCgpLT5nZXQoJ2Zpc2NhbF95ZWFyX2lkJykpOwogICAgICAgICAgICAgICAgJGFsbCA9IGdldEFsbEdyb3VwQW5kTGVkZ2VycyhmYWxzZSwgZmFsc2UsIFtdLCBbcmVxdWVzdCgpLT5nZXQoJ2NvbXBhbnlfaWQnKV0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAkcmF0ZSA9IDE7CiAgICAgICAgICAgICAgICBpZigkc3lzdGVtQ3VycmVuY3ktPmlkICE9ICRjdXJyZW5jeV9pZCl7CiAgICAgICAgICAgICAgICAgICAgJHJhdGVzID0gZ2V0RXhjaGFuZ2VSYXRlcygkc3lzdGVtQ3VycmVuY3ktPmlkKTsKICAgICAgICAgICAgICAgICAgICAkcmF0ZSA9IGlzc2V0KCRyYXRlc1sncmF0ZXMnXVskY3VycmVuY3lfaWRdWydyYXRlJ10pID8gJHJhdGVzWydyYXRlcyddWyRjdXJyZW5jeV9pZF1bJ3JhdGUnXSA6IDE7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJG9wZW5pbmdEZWJpdEVudHJ5SXRlbXMgPSBFbnRyeUl0ZW06OmpvaW4oJ2VudHJpZXMnLCAnZW50cmllcy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmVudHJ5X2lkJykKICAgICAgICAgICAgICAgIC0+am9pbignY29zdF9jZW50cmVzJywgJ2Nvc3RfY2VudHJlcy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmNvc3RfY2VudHJlX2lkJykKICAgICAgICAgICAgICAgIC0+am9pbigncHJvZml0X2NlbnRyZXMnLCAncHJvZml0X2NlbnRyZXMuaWQnLCAnPScsICdjb3N0X2NlbnRyZXMucHJvZml0X2NlbnRyZV9pZCcpCgogICAgICAgICAgICAgICAgLT5qb2luKCdjaGFydF9vZl9hY2NvdW50cycsICdjaGFydF9vZl9hY2NvdW50cy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmNoYXJ0X29mX2FjY291bnRfaWQnKQogICAgICAgICAgICAgICAgLT5qb2luKCdhY2NvdW50X2dyb3VwcycsICdhY2NvdW50X2dyb3Vwcy5pZCcsICc9JywgJ2NoYXJ0X29mX2FjY291bnRzLmFjY291bnRfZ3JvdXBfaWQnKQoKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJpZXMuaXNfYXBwcm92ZWQnLCAnYXBwcm92ZWQnKQogICAgICAgICAgICAgICAgLT53aGVyZSgnZW50cmllcy5kYXRlJywgJzwnLCAkcmVxdWVzdC0+ZnJvbSkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJpZXMuZmlzY2FsX3llYXJfaWQnLCAkZmlzY2FsWWVhci0+aWQpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdwcm9maXRfY2VudHJlcy5jb21wYW55X2lkJywgcmVxdWVzdCgpLT5nZXQoJ2NvbXBhbnlfaWQnKSkKCiAgICAgICAgICAgICAgICAtPndoZW4oJHByb2ZpdF9jZW50cmVfaWQgPiAwLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcHJvZml0X2NlbnRyZV9pZCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2Nvc3RfY2VudHJlcy5wcm9maXRfY2VudHJlX2lkJywgJHByb2ZpdF9jZW50cmVfaWQpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbigkY29zdF9jZW50cmVfaWQgPiAwLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkY29zdF9jZW50cmVfaWQpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdlbnRyeV9pdGVtcy5jb3N0X2NlbnRyZV9pZCcsICRjb3N0X2NlbnRyZV9pZCk7CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJ5X2l0ZW1zLmRlYml0X2NyZWRpdCcsICdEJykKCiAgICAgICAgICAgICAgICAtPmdyb3VwQnkoJ2VudHJ5X2l0ZW1zLmNoYXJ0X29mX2FjY291bnRfaWQnKQoKICAgICAgICAgICAgICAgIC0+d2hlcmVOdWxsKCdlbnRyaWVzLmRlbGV0ZWRfYXQnKQogICAgICAgICAgICAgICAgLT53aGVyZU51bGwoJ2VudHJ5X2l0ZW1zLmRlbGV0ZWRfYXQnKQogICAgICAgICAgICAgICAgLT53aGVyZU51bGwoJ2NoYXJ0X29mX2FjY291bnRzLmRlbGV0ZWRfYXQnKQoKICAgICAgICAgICAgICAgIC0+Z2V0KFsKICAgICAgICAgICAgICAgICAgICAnZW50cnlfaXRlbXMuY2hhcnRfb2ZfYWNjb3VudF9pZCcsCiAgICAgICAgICAgICAgICAgICAgREI6OnJhdygnc3VtKGVudHJ5X2l0ZW1zLnJlcG9ydGluZ19hbW91bnQpIGFzIHJlcG9ydGluZ19hbW91bnQnKQogICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgJG9wZW5pbmdDcmVkaXRFbnRyeUl0ZW1zID0gRW50cnlJdGVtOjpqb2luKCdlbnRyaWVzJywgJ2VudHJpZXMuaWQnLCAnPScsICdlbnRyeV9pdGVtcy5lbnRyeV9pZCcpCiAgICAgICAgICAgICAgICAtPmpvaW4oJ2Nvc3RfY2VudHJlcycsICdjb3N0X2NlbnRyZXMuaWQnLCAnPScsICdlbnRyeV9pdGVtcy5jb3N0X2NlbnRyZV9pZCcpCiAgICAgICAgICAgICAgICAtPmpvaW4oJ3Byb2ZpdF9jZW50cmVzJywgJ3Byb2ZpdF9jZW50cmVzLmlkJywgJz0nLCAnY29zdF9jZW50cmVzLnByb2ZpdF9jZW50cmVfaWQnKQoKICAgICAgICAgICAgICAgIC0+am9pbignY2hhcnRfb2ZfYWNjb3VudHMnLCAnY2hhcnRfb2ZfYWNjb3VudHMuaWQnLCAnPScsICdlbnRyeV9pdGVtcy5jaGFydF9vZl9hY2NvdW50X2lkJykKICAgICAgICAgICAgICAgIC0+am9pbignYWNjb3VudF9ncm91cHMnLCAnYWNjb3VudF9ncm91cHMuaWQnLCAnPScsICdjaGFydF9vZl9hY2NvdW50cy5hY2NvdW50X2dyb3VwX2lkJykKCiAgICAgICAgICAgICAgICAtPndoZXJlKCdlbnRyaWVzLmlzX2FwcHJvdmVkJywgJ2FwcHJvdmVkJykKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJpZXMuZGF0ZScsICc8JywgJHJlcXVlc3QtPmZyb20pCiAgICAgICAgICAgICAgICAtPndoZXJlKCdlbnRyaWVzLmZpc2NhbF95ZWFyX2lkJywgJGZpc2NhbFllYXItPmlkKQogICAgICAgICAgICAgICAgLT53aGVyZSgncHJvZml0X2NlbnRyZXMuY29tcGFueV9pZCcsIHJlcXVlc3QoKS0+Z2V0KCdjb21wYW55X2lkJykpCgogICAgICAgICAgICAgICAgLT53aGVuKCRwcm9maXRfY2VudHJlX2lkID4gMCwgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHByb2ZpdF9jZW50cmVfaWQpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdjb3N0X2NlbnRyZXMucHJvZml0X2NlbnRyZV9pZCcsICRwcm9maXRfY2VudHJlX2lkKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oJGNvc3RfY2VudHJlX2lkID4gMCwgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGNvc3RfY2VudHJlX2lkKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZW50cnlfaXRlbXMuY29zdF9jZW50cmVfaWQnLCAkY29zdF9jZW50cmVfaWQpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLT53aGVyZSgnZW50cnlfaXRlbXMuZGViaXRfY3JlZGl0JywgJ0MnKQoKICAgICAgICAgICAgICAgIC0+Z3JvdXBCeSgnZW50cnlfaXRlbXMuY2hhcnRfb2ZfYWNjb3VudF9pZCcpCgogICAgICAgICAgICAgICAgLT53aGVyZU51bGwoJ2VudHJpZXMuZGVsZXRlZF9hdCcpCiAgICAgICAgICAgICAgICAtPndoZXJlTnVsbCgnZW50cnlfaXRlbXMuZGVsZXRlZF9hdCcpCiAgICAgICAgICAgICAgICAtPndoZXJlTnVsbCgnY2hhcnRfb2ZfYWNjb3VudHMuZGVsZXRlZF9hdCcpCgogICAgICAgICAgICAgICAgLT5nZXQoWwogICAgICAgICAgICAgICAgICAgICdlbnRyeV9pdGVtcy5jaGFydF9vZl9hY2NvdW50X2lkJywKICAgICAgICAgICAgICAgICAgICBEQjo6cmF3KCdzdW0oZW50cnlfaXRlbXMucmVwb3J0aW5nX2Ftb3VudCkgYXMgcmVwb3J0aW5nX2Ftb3VudCcpCiAgICAgICAgICAgICAgICBdKTsKCiAgICAgICAgICAgICAgICAkZGViaXRFbnRyeUl0ZW1zID0gRW50cnlJdGVtOjpqb2luKCdlbnRyaWVzJywgJ2VudHJpZXMuaWQnLCAnPScsICdlbnRyeV9pdGVtcy5lbnRyeV9pZCcpCiAgICAgICAgICAgICAgICAtPmpvaW4oJ2Nvc3RfY2VudHJlcycsICdjb3N0X2NlbnRyZXMuaWQnLCAnPScsICdlbnRyeV9pdGVtcy5jb3N0X2NlbnRyZV9pZCcpCiAgICAgICAgICAgICAgICAtPmpvaW4oJ3Byb2ZpdF9jZW50cmVzJywgJ3Byb2ZpdF9jZW50cmVzLmlkJywgJz0nLCAnY29zdF9jZW50cmVzLnByb2ZpdF9jZW50cmVfaWQnKQoKICAgICAgICAgICAgICAgIC0+am9pbignY2hhcnRfb2ZfYWNjb3VudHMnLCAnY2hhcnRfb2ZfYWNjb3VudHMuaWQnLCAnPScsICdlbnRyeV9pdGVtcy5jaGFydF9vZl9hY2NvdW50X2lkJykKICAgICAgICAgICAgICAgIC0+am9pbignYWNjb3VudF9ncm91cHMnLCAnYWNjb3VudF9ncm91cHMuaWQnLCAnPScsICdjaGFydF9vZl9hY2NvdW50cy5hY2NvdW50X2dyb3VwX2lkJykKCiAgICAgICAgICAgICAgICAtPndoZXJlKCdlbnRyaWVzLmlzX2FwcHJvdmVkJywgJ2FwcHJvdmVkJykKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJpZXMuZGF0ZScsICc+PScsICRyZXF1ZXN0LT5mcm9tKQogICAgICAgICAgICAgICAgLT53aGVyZSgnZW50cmllcy5kYXRlJywgJzw9JywgJHJlcXVlc3QtPnRvKQogICAgICAgICAgICAgICAgLT53aGVyZSgnZW50cmllcy5maXNjYWxfeWVhcl9pZCcsICRmaXNjYWxZZWFyLT5pZCkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3Byb2ZpdF9jZW50cmVzLmNvbXBhbnlfaWQnLCByZXF1ZXN0KCktPmdldCgnY29tcGFueV9pZCcpKQoKICAgICAgICAgICAgICAgIC0+d2hlbigkcHJvZml0X2NlbnRyZV9pZCA+IDAsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRwcm9maXRfY2VudHJlX2lkKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnY29zdF9jZW50cmVzLnByb2ZpdF9jZW50cmVfaWQnLCAkcHJvZml0X2NlbnRyZV9pZCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKCRjb3N0X2NlbnRyZV9pZCA+IDAsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRjb3N0X2NlbnRyZV9pZCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2VudHJ5X2l0ZW1zLmNvc3RfY2VudHJlX2lkJywgJGNvc3RfY2VudHJlX2lkKTsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgLT53aGVyZSgnZW50cnlfaXRlbXMuZGViaXRfY3JlZGl0JywgJ0QnKQoKICAgICAgICAgICAgICAgIC0+Z3JvdXBCeSgnZW50cnlfaXRlbXMuY2hhcnRfb2ZfYWNjb3VudF9pZCcpCgogICAgICAgICAgICAgICAgLT53aGVyZU51bGwoJ2VudHJpZXMuZGVsZXRlZF9hdCcpCiAgICAgICAgICAgICAgICAtPndoZXJlTnVsbCgnZW50cnlfaXRlbXMuZGVsZXRlZF9hdCcpCiAgICAgICAgICAgICAgICAtPndoZXJlTnVsbCgnY2hhcnRfb2ZfYWNjb3VudHMuZGVsZXRlZF9hdCcpCgogICAgICAgICAgICAgICAgLT5nZXQoWwogICAgICAgICAgICAgICAgICAgICdlbnRyeV9pdGVtcy5jaGFydF9vZl9hY2NvdW50X2lkJywKICAgICAgICAgICAgICAgICAgICBEQjo6cmF3KCdzdW0oZW50cnlfaXRlbXMucmVwb3J0aW5nX2Ftb3VudCkgYXMgcmVwb3J0aW5nX2Ftb3VudCcpCiAgICAgICAgICAgICAgICBdKTsKCiAgICAgICAgICAgICAgICAkY3JlZGl0RW50cnlJdGVtcyA9IEVudHJ5SXRlbTo6am9pbignZW50cmllcycsICdlbnRyaWVzLmlkJywgJz0nLCAnZW50cnlfaXRlbXMuZW50cnlfaWQnKQogICAgICAgICAgICAgICAgLT5qb2luKCdjb3N0X2NlbnRyZXMnLCAnY29zdF9jZW50cmVzLmlkJywgJz0nLCAnZW50cnlfaXRlbXMuY29zdF9jZW50cmVfaWQnKQogICAgICAgICAgICAgICAgLT5qb2luKCdwcm9maXRfY2VudHJlcycsICdwcm9maXRfY2VudHJlcy5pZCcsICc9JywgJ2Nvc3RfY2VudHJlcy5wcm9maXRfY2VudHJlX2lkJykKCiAgICAgICAgICAgICAgICAtPmpvaW4oJ2NoYXJ0X29mX2FjY291bnRzJywgJ2NoYXJ0X29mX2FjY291bnRzLmlkJywgJz0nLCAnZW50cnlfaXRlbXMuY2hhcnRfb2ZfYWNjb3VudF9pZCcpCiAgICAgICAgICAgICAgICAtPmpvaW4oJ2FjY291bnRfZ3JvdXBzJywgJ2FjY291bnRfZ3JvdXBzLmlkJywgJz0nLCAnY2hhcnRfb2ZfYWNjb3VudHMuYWNjb3VudF9ncm91cF9pZCcpCgogICAgICAgICAgICAgICAgLT53aGVyZSgnZW50cmllcy5pc19hcHByb3ZlZCcsICdhcHByb3ZlZCcpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdlbnRyaWVzLmRhdGUnLCAnPj0nLCAkcmVxdWVzdC0+ZnJvbSkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJpZXMuZGF0ZScsICc8PScsICRyZXF1ZXN0LT50bykKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJpZXMuZmlzY2FsX3llYXJfaWQnLCAkZmlzY2FsWWVhci0+aWQpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdwcm9maXRfY2VudHJlcy5jb21wYW55X2lkJywgcmVxdWVzdCgpLT5nZXQoJ2NvbXBhbnlfaWQnKSkKCiAgICAgICAgICAgICAgICAtPndoZW4oJHByb2ZpdF9jZW50cmVfaWQgPiAwLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcHJvZml0X2NlbnRyZV9pZCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2Nvc3RfY2VudHJlcy5wcm9maXRfY2VudHJlX2lkJywgJHByb2ZpdF9jZW50cmVfaWQpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbigkY29zdF9jZW50cmVfaWQgPiAwLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkY29zdF9jZW50cmVfaWQpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdlbnRyeV9pdGVtcy5jb3N0X2NlbnRyZV9pZCcsICRjb3N0X2NlbnRyZV9pZCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAtPndoZXJlKCdlbnRyeV9pdGVtcy5kZWJpdF9jcmVkaXQnLCAnQycpCgogICAgICAgICAgICAgICAgLT5ncm91cEJ5KCdlbnRyeV9pdGVtcy5jaGFydF9vZl9hY2NvdW50X2lkJykKCiAgICAgICAgICAgICAgICAtPndoZXJlTnVsbCgnZW50cmllcy5kZWxldGVkX2F0JykKICAgICAgICAgICAgICAgIC0+d2hlcmVOdWxsKCdlbnRyeV9pdGVtcy5kZWxldGVkX2F0JykKICAgICAgICAgICAgICAgIC0+d2hlcmVOdWxsKCdjaGFydF9vZl9hY2NvdW50cy5kZWxldGVkX2F0JykKCiAgICAgICAgICAgICAgICAtPmdldChbCiAgICAgICAgICAgICAgICAgICAgJ2VudHJ5X2l0ZW1zLmNoYXJ0X29mX2FjY291bnRfaWQnLAogICAgICAgICAgICAgICAgICAgIERCOjpyYXcoJ3N1bShlbnRyeV9pdGVtcy5yZXBvcnRpbmdfYW1vdW50KSBhcyByZXBvcnRpbmdfYW1vdW50JykKICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgICRjYXJyeUZvcndhcmRlZCA9IEZpc2NhbFllYXJDbG9zaW5nTGVkZ2VyOjpqb2luKCdmaXNjYWxfeWVhcl9jbG9zaW5ncycsICdmaXNjYWxfeWVhcl9jbG9zaW5ncy5pZCcsICc9JywgJ2Zpc2NhbF95ZWFyX2Nsb3NpbmdfbGVkZ2Vycy5maXNjYWxfeWVhcl9jbG9zaW5nX2lkJykKCiAgICAgICAgICAgICAgICAtPmpvaW4oJ2NoYXJ0X29mX2FjY291bnRzJywgJ2NoYXJ0X29mX2FjY291bnRzLmlkJywgJz0nLCAnZmlzY2FsX3llYXJfY2xvc2luZ19sZWRnZXJzLmNoYXJ0X29mX2FjY291bnRfaWQnKQogICAgICAgICAgICAgICAgLT5qb2luKCdhY2NvdW50X2dyb3VwcycsICdhY2NvdW50X2dyb3Vwcy5pZCcsICc9JywgJ2NoYXJ0X29mX2FjY291bnRzLmFjY291bnRfZ3JvdXBfaWQnKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAtPndoZXJlKCdmaXNjYWxfeWVhcl9jbG9zaW5ncy5jb21wYW55X2lkJywgcmVxdWVzdCgpLT5nZXQoJ2NvbXBhbnlfaWQnKSkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2Zpc2NhbF95ZWFyX2Nsb3NpbmdzLnRvX2Zpc2NhbF95ZWFyX2lkJywgJGZpc2NhbFllYXItPmlkKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAtPmdyb3VwQnkoJ2Zpc2NhbF95ZWFyX2Nsb3NpbmdfbGVkZ2Vycy5jaGFydF9vZl9hY2NvdW50X2lkJykKCiAgICAgICAgICAgICAgICAtPndoZXJlTnVsbCgnY2hhcnRfb2ZfYWNjb3VudHMuZGVsZXRlZF9hdCcpCgogICAgICAgICAgICAgICAgLT5nZXQoWwogICAgICAgICAgICAgICAgICAgICdmaXNjYWxfeWVhcl9jbG9zaW5nX2xlZGdlcnMuY2hhcnRfb2ZfYWNjb3VudF9pZCcsCiAgICAgICAgICAgICAgICAgICAgREI6OnJhdygnc3VtKGZpc2NhbF95ZWFyX2Nsb3NpbmdfbGVkZ2Vycy5jYXJyeV9mb3J3YXJkaW5nX2Ftb3VudCkgYXMgY2FycnlfZm9yd2FyZGluZ19hbW91bnQnKQogICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgJGdyb3VwV2lzZSA9ICgkcmVxdWVzdC0+Z3JvdXBfd2lzZSA9PSAxKTsKICAgICAgICAgICAgICAgIGlmKCRncm91cFdpc2UpewogICAgICAgICAgICAgICAgICAgICRncm91cHMgPSBBY2NvdW50R3JvdXA6OmRvZXNudEhhdmUoJ3BhcmVudCcpLT5nZXQoKTsKICAgICAgICAgICAgICAgICAgICBpZigkZ3JvdXBzLT5jb3VudCgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2goJGdyb3VwcyBhcyAka2V5ID0+ICRncm91cCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdHJpYWxCYWxhbmNlIC49IHRyaWFsYmFsYW5jZUdyb3VwRGF0YSgkZ3JvdXAsIFsnRCcgPT4gJGRlYml0RW50cnlJdGVtcywgJ0MnID0+ICRjcmVkaXRFbnRyeUl0ZW1zXSwgJGFsbCwgJGNhcnJ5Rm9yd2FyZGVkLCAkcmF0ZSwgWydEJyA9PiAkb3BlbmluZ0RlYml0RW50cnlJdGVtcywgJ0MnID0+ICRvcGVuaW5nQ3JlZGl0RW50cnlJdGVtc10pOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0cmlhbEJhbGFuY2UgLj0gdHJpYWxiYWxhbmNlKHJlcXVlc3QoKS0+Z2V0KCdjb21wYW55X2lkJyksICRncm91cCwgcmVxdWVzdCgpLT5nZXQoJ2Zyb20nKSwgcmVxdWVzdCgpLT5nZXQoJ3RvJyksIDAsICEocmVxdWVzdCgpLT5oYXMoJ3JlcG9ydF90eXBlJykgJiYgcmVxdWVzdCgpLT5nZXQoJ3JlcG9ydF90eXBlJykgPT0gJ3BkZicpLCBbJ0QnID0+ICRvcGVuaW5nRGViaXRFbnRyeUl0ZW1zLCAnQycgPT4gJG9wZW5pbmdDcmVkaXRFbnRyeUl0ZW1zXSwgWydEJyA9PiAkZGViaXRFbnRyeUl0ZW1zLCAnQycgPT4gJGNyZWRpdEVudHJ5SXRlbXNdLCAkYWxsLCAkY2FycnlGb3J3YXJkZWQsICRyYXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJHRyaWFsQmFsYW5jZSAuPSAnPHRyPgogICAgICAgICAgICAgICAgICAgICAgICA8dGQgY29sc3Bhbj0iMiI+PHN0cm9uZz5Ub3RhbDo8L3N0cm9uZz48L3RkPgogICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9Im9wZW5pbmdfYmFsYW5jZV9jb2x1bW4iIHN0eWxlPSJ0ZXh0LWFsaWduOiByaWdodCI+PHN0cm9uZz4nLnN5c3RlbU1vbmV5Rm9ybWF0KCgkb3BlbmluZ0RlYml0RW50cnlJdGVtcy0+c3VtKCdyZXBvcnRpbmdfYW1vdW50JyktJG9wZW5pbmdDcmVkaXRFbnRyeUl0ZW1zLT5zdW0oJ3JlcG9ydGluZ19hbW91bnQnKSskY2FycnlGb3J3YXJkZWQtPnN1bSgnY2FycnlfZm9yd2FyZGluZ19hbW91bnQnKSkpLic8L3N0cm9uZz48L3RkPgogICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9ImRlYml0X2NvbHVtbiIgc3R5bGU9InRleHQtYWxpZ246IHJpZ2h0Ij48c3Ryb25nPicuc3lzdGVtTW9uZXlGb3JtYXQoJGRlYml0RW50cnlJdGVtcy0+c3VtKCdyZXBvcnRpbmdfYW1vdW50JykpLic8L3N0cm9uZz48L3RkPgogICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9ImNyZWRpdF9jb2x1bW4iIHN0eWxlPSJ0ZXh0LWFsaWduOiByaWdodCI+PHN0cm9uZz4tJy5zeXN0ZW1Nb25leUZvcm1hdCgkY3JlZGl0RW50cnlJdGVtcy0+c3VtKCdyZXBvcnRpbmdfYW1vdW50JykpLic8L3N0cm9uZz48L3RkPgogICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9ImNsb3NpbmdfYmFsYW5jZV9jb2x1bW4iIHN0eWxlPSJ0ZXh0LWFsaWduOiByaWdodCI+PHN0cm9uZz4nLnN5c3RlbU1vbmV5Rm9ybWF0KCgkb3BlbmluZ0RlYml0RW50cnlJdGVtcy0+c3VtKCdyZXBvcnRpbmdfYW1vdW50JyktJG9wZW5pbmdDcmVkaXRFbnRyeUl0ZW1zLT5zdW0oJ3JlcG9ydGluZ19hbW91bnQnKSskY2FycnlGb3J3YXJkZWQtPnN1bSgnY2FycnlfZm9yd2FyZGluZ19hbW91bnQnKSkrKCRkZWJpdEVudHJ5SXRlbXMtPnN1bSgncmVwb3J0aW5nX2Ftb3VudCcpLSRjcmVkaXRFbnRyeUl0ZW1zLT5zdW0oJ3JlcG9ydGluZ19hbW91bnQnKSkpLic8L3N0cm9uZz48L3RkPgogICAgICAgICAgICAgICAgICAgIDwvdHI+JzsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICRhY2NvdW50cyA9IENoYXJ0T2ZBY2NvdW50Ojp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ2FjY291bnRHcm91cC5hY2NvdW50Q2xhc3MnLAogICAgICAgICAgICAgICAgICAgICAgICAnZXhjaGFuZ2VSYXRlJwogICAgICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZUhhcygnY29tcGFuaWVzJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2NvbXBhbnlfaWQnLCByZXF1ZXN0KCktPmdldCgnY29tcGFueV9pZCcpKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJCeSgnY29kZScsICdhc2MnKQogICAgICAgICAgICAgICAgICAgIC0+Z2V0KCk7CiAgICAgICAgICAgICAgICAgICAgJGJhbGFuY2VzID0gW107CiAgICAgICAgICAgICAgICAgICAgaWYoJGFjY291bnRzLT5jb3VudCgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2goJGFjY291bnRzIGFzICRrZXkgPT4gJGFjY291bnQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRyaWFsYmFsYW5jZUxlZGdlciA9IHRyaWFsYmFsYW5jZUxlZGdlcihyZXF1ZXN0KCktPmdldCgnY29tcGFueV9pZCcpLCAkYWNjb3VudCwgcmVxdWVzdCgpLT5nZXQoJ2Zyb20nKSwgcmVxdWVzdCgpLT5nZXQoJ3RvJyksICEocmVxdWVzdCgpLT5oYXMoJ3JlcG9ydF90eXBlJykgJiYgcmVxdWVzdCgpLT5nZXQoJ3JlcG9ydF90eXBlJykgPT0gJ3BkZicpLCBbJ0QnID0+ICRvcGVuaW5nRGViaXRFbnRyeUl0ZW1zLCAnQycgPT4gJG9wZW5pbmdDcmVkaXRFbnRyeUl0ZW1zXSwgWydEJyA9PiAkZGViaXRFbnRyeUl0ZW1zLCAnQycgPT4gJGNyZWRpdEVudHJ5SXRlbXNdLCAkYWxsLCAkY2FycnlGb3J3YXJkZWQsICRyYXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0cmlhbEJhbGFuY2UgLj0gJHRyaWFsYmFsYW5jZUxlZGdlclsnZGF0YSddOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRiYWxhbmNlc1snb3BlbmluZ19iYWxhbmNlJ11bXSA9ICR0cmlhbGJhbGFuY2VMZWRnZXJbJ2JhbGFuY2UnXVsnb3BlbmluZ19iYWxhbmNlJ107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYmFsYW5jZXNbJ2RlYml0J11bXSA9ICR0cmlhbGJhbGFuY2VMZWRnZXJbJ2JhbGFuY2UnXVsnZGViaXQnXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRiYWxhbmNlc1snY3JlZGl0J11bXSA9ICR0cmlhbGJhbGFuY2VMZWRnZXJbJ2JhbGFuY2UnXVsnY3JlZGl0J107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYmFsYW5jZXNbJ2JhbGFuY2UnXVtdID0gJHRyaWFsYmFsYW5jZUxlZGdlclsnYmFsYW5jZSddWydiYWxhbmNlJ107CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICR0cmlhbEJhbGFuY2UgLj0gJzx0cj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjb2xzcGFuPSIyIj48c3Ryb25nPlRvdGFsOjwvc3Ryb25nPjwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9Im9wZW5pbmdfYmFsYW5jZV9jb2x1bW4iIHN0eWxlPSJ0ZXh0LWFsaWduOiByaWdodCI+PHN0cm9uZz4nLnN5c3RlbU1vbmV5Rm9ybWF0KGFycmF5X3N1bSgkYmFsYW5jZXNbJ29wZW5pbmdfYmFsYW5jZSddKSkuJzwvc3Ryb25nPjwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9ImRlYml0X2NvbHVtbiIgc3R5bGU9InRleHQtYWxpZ246IHJpZ2h0Ij48c3Ryb25nPicuc3lzdGVtTW9uZXlGb3JtYXQoYXJyYXlfc3VtKCRiYWxhbmNlc1snZGViaXQnXSkpLic8L3N0cm9uZz48L3RkPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJjcmVkaXRfY29sdW1uIiBzdHlsZT0idGV4dC1hbGlnbjogcmlnaHQiPjxzdHJvbmc+Jy5zeXN0ZW1Nb25leUZvcm1hdChhcnJheV9zdW0oJGJhbGFuY2VzWydjcmVkaXQnXSkpLic8L3N0cm9uZz48L3RkPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJjbG9zaW5nX2JhbGFuY2VfY29sdW1uIiBzdHlsZT0idGV4dC1hbGlnbjogcmlnaHQiPjxzdHJvbmc+Jy5zeXN0ZW1Nb25leUZvcm1hdChhcnJheV9zdW0oJGJhbGFuY2VzWydiYWxhbmNlJ10pKS4nPC9zdHJvbmc+PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgPC90cj4nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGNvbXBhbmllcyA9IENvbXBhbnk6OmhhcygncHJvZml0Q2VudHJlcy5jb3N0Q2VudHJlcycpCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3VzZXJzJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCd1c2VyX2lkJywgYXV0aCgpLT51c2VyKCktPmlkKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5nZXQoKTsKCiAgICAgICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiByZXBvcnRUaXRsZShyZXF1ZXN0KCktPmFsbCgpLCAkdGl0bGUpLAogICAgICAgICAgICAgICAgJ2Zpc2NhbFllYXInID0+ICRmaXNjYWxZZWFyLAogICAgICAgICAgICAgICAgJ2dyb3VwV2lzZScgPT4gJGdyb3VwV2lzZSwKICAgICAgICAgICAgICAgICdhY2NvdW50RGVmYXVsdFNldHRpbmdzJyA9PiAkYWNjb3VudERlZmF1bHRTZXR0aW5ncywKICAgICAgICAgICAgICAgICdjb21wYW5pZXMnID0+ICRjb21wYW5pZXMsCiAgICAgICAgICAgICAgICAncHJvZml0Q2VudHJlcycgPT4gUHJvZml0Q2VudHJlOjp3aGVyZSgnY29tcGFueV9pZCcsICRjb21wYW5pZXMtPmZpcnN0KCktPmlkKS0+b3JkZXJCeSgnY29kZScsICdhc2MnKS0+Z2V0KCksCiAgICAgICAgICAgICAgICAnZmlzY2FsWWVhcnMnID0+IEZpc2NhbFllYXI6OmFsbCgpLAogICAgICAgICAgICAgICAgJ2N1cnJlbmN5VHlwZXMnID0+IEN1cnJlbmN5VHlwZTo6d2l0aChbJ2N1cnJlbmNpZXMnXSktPmdldCgpLAogICAgICAgICAgICAgICAgJ2N1cnJlbmN5JyA9PiBDdXJyZW5jeTo6ZmluZChyZXF1ZXN0KCktPmdldCgnY3VycmVuY3lfaWQnKSksCiAgICAgICAgICAgICAgICAndHJpYWxCYWxhbmNlJyA9PiAkdHJpYWxCYWxhbmNlLAogICAgICAgICAgICBdOwoKICAgICAgICAgICAgaWYocmVxdWVzdCgpLT5oYXMoJ3JlcG9ydF90eXBlJykgJiYgcmVxdWVzdCgpLT5nZXQoJ3JlcG9ydF90eXBlJykgPT0gJ3BkZicpewogICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdNUERGKCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMucmVwb3J0cy50cmlhbEJhbGFuY2UucGRmJywgJGRhdGEsICR0aXRsZSwgJHRpdGxlLCAnYTQnLCAnTCcpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZihyZXF1ZXN0KCktPmhhcygncmVwb3J0X3R5cGUnKSAmJiByZXF1ZXN0KCktPmdldCgncmVwb3J0X3R5cGUnKSA9PSAncmVwb3J0Jyl7CiAgICAgICAgICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLnJlcG9ydHMudHJpYWxCYWxhbmNlLnJlcG9ydCcsICRkYXRhKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5yZXBvcnRzLnRyaWFsQmFsYW5jZS5pbmRleCcsICRkYXRhKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgaWYocmVxdWVzdCgpLT5oYXMoJ3JlcG9ydF90eXBlJykgJiYgcmVxdWVzdCgpLT5nZXQoJ3JlcG9ydF90eXBlJykgPT0gJ3JlcG9ydCcpewogICAgICAgICAgICAgICAgcmV0dXJuICR0aC0+Z2V0TWVzc2FnZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gb25seVdpdGhDbG9zaW5nQmFsYW5jZSgpCiAgICB7CiAgICAgICAgJHRpdGxlID0gJ1JlcG9ydCAtIFRyaWFsIEJhbGFuY2UgKEJhbGFuY2UpJzsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJGZpc2NhbFllYXIgPSBnZXRBY3RpdmVGaXNjYWxZZWFyKCk7CiAgICAgICAgICAgICRhY2NvdW50RGVmYXVsdFNldHRpbmdzID0gYWNjb3VudERlZmF1bHRTZXR0aW5ncygpOwogICAgICAgICAgICAKICAgICAgICAgICAgJHRyaWFsQmFsYW5jZSA9ICcnOwogICAgICAgICAgICBpZihyZXF1ZXN0KCktPmhhcygncmVwb3J0X3R5cGUnKSl7CiAgICAgICAgICAgICAgICAkY3VycmVuY3lfaWQgPSByZXF1ZXN0KCktPmhhcygnY3VycmVuY3lfaWQnKSA/IHJlcXVlc3QoKS0+Z2V0KCdjdXJyZW5jeV9pZCcpIDogMDsKICAgICAgICAgICAgICAgICRmaXNjYWxZZWFyID0gRmlzY2FsWWVhcjo6ZmluZE9yRmFpbChyZXF1ZXN0KCktPmdldCgnZmlzY2FsX3llYXJfaWQnKSk7CiAgICAgICAgICAgICAgICAkYWxsID0gZ2V0QWxsR3JvdXBBbmRMZWRnZXJzKCk7CgogICAgICAgICAgICAgICAgJGVudHJ5SXRlbXMgPSBFbnRyeUl0ZW06OndpdGgoWwogICAgICAgICAgICAgICAgICAgICdlbnRyeS5leGNoYW5nZVJhdGUnCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygnZW50cnknLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19hcHByb3ZlZCcsICdhcHByb3ZlZCcpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ2VudHJ5JywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGZpc2NhbFllYXIpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdkYXRlJywgJz49JywgJGZpc2NhbFllYXItPnN0YXJ0KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdlbnRyeScsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRmaXNjYWxZZWFyKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZGF0ZScsICc8PScsICRmaXNjYWxZZWFyLT5lbmQpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ2VudHJ5JywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZmlzY2FsX3llYXJfaWQnLCByZXF1ZXN0KCktPmdldCgnZmlzY2FsX3llYXJfaWQnKSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygnY29zdENlbnRyZS5wcm9maXRDZW50cmUnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdjb21wYW55X2lkJywgcmVxdWVzdCgpLT5nZXQoJ2NvbXBhbnlfaWQnKSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5nZXQoKTsKCiAgICAgICAgICAgICAgICAkY2FycnlGb3J3YXJkZWQgPSBGaXNjYWxZZWFyQ2xvc2luZzo6d2l0aChbCiAgICAgICAgICAgICAgICAgICAgJ2V4Y2hhbmdlUmF0ZScsCiAgICAgICAgICAgICAgICAgICAgJ2xlZGdlcnMnCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVyZSgnY29tcGFueV9pZCcsIHJlcXVlc3QoKS0+Z2V0KCdjb21wYW55X2lkJykpCiAgICAgICAgICAgICAgICAtPndoZXJlKCd0b19maXNjYWxfeWVhcl9pZCcsICRmaXNjYWxZZWFyLT5pZCkKICAgICAgICAgICAgICAgIC0+Z2V0KCk7CgogICAgICAgICAgICAgICAgJGV4Y2hhbmdlUmF0ZXMgPSBFeGNoYW5nZVJhdGU6OndoZXJlKCdjdXJyZW5jeV9pZCcsICchPScsICRjdXJyZW5jeV9pZCkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ2VudHJpZXMuaXRlbXMnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkZW50cnlJdGVtcyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignaWQnLCAkZW50cnlJdGVtcy0+cGx1Y2soJ2lkJyktPnRvQXJyYXkoKSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygnZW50cmllcycsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX2FwcHJvdmVkJywgJ2FwcHJvdmVkJyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5nZXQoKTsKCiAgICAgICAgICAgICAgICAkZ3JvdXBXaXNlID0gZmFsc2U7CiAgICAgICAgICAgICAgICBpZigkZ3JvdXBXaXNlKXsKICAgICAgICAgICAgICAgICAgICAkZ3JvdXBzID0gQWNjb3VudEdyb3VwOjpkb2VzbnRIYXZlKCdwYXJlbnQnKS0+Z2V0KCk7CiAgICAgICAgICAgICAgICAgICAgaWYoJGdyb3Vwcy0+Y291bnQoKSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCRncm91cHMgYXMgJGtleSA9PiAkZ3JvdXApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRyaWFsQmFsYW5jZSAuPSB0cmlhbGJhbGFuY2VPbmx5Q2xvc2luZ0JhbGFuY2UoJGdyb3VwLCByZXF1ZXN0KCktPmdldCgnZnJvbScpLCByZXF1ZXN0KCktPmdldCgndG8nKSwgJGN1cnJlbmN5X2lkLCAwLCAhKHJlcXVlc3QoKS0+aGFzKCdyZXBvcnRfdHlwZScpICYmIHJlcXVlc3QoKS0+Z2V0KCdyZXBvcnRfdHlwZScpID09ICdwZGYnKSwgJGV4Y2hhbmdlUmF0ZXMsICRlbnRyeUl0ZW1zLCAkYWxsLCByZXF1ZXN0KCktPmdldCgnY29tcGFueV9pZCcpLCByZXF1ZXN0KCktPmdldCgnZmlzY2FsX3llYXJfaWQnKSwgJGNhcnJ5Rm9yd2FyZGVkKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICRhY2NvdW50cyA9IENoYXJ0T2ZBY2NvdW50Ojp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ2FjY291bnRHcm91cC5hY2NvdW50Q2xhc3MnCiAgICAgICAgICAgICAgICAgICAgXSktPm9yZGVyQnkoJ2NvZGUnLCAnYXNjJyktPmdldCgpOwogICAgICAgICAgICAgICAgICAgICRiYWxhbmNlcyA9IFtdOwogICAgICAgICAgICAgICAgICAgIGlmKCRhY2NvdW50cy0+Y291bnQoKSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCRhY2NvdW50cyBhcyAka2V5ID0+ICRhY2NvdW50KXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0cmlhbGJhbGFuY2VMZWRnZXIgPSB0cmlhbGJhbGFuY2VPbmx5Q2xvc2luZ0JhbGFuY2VMZWRnZXIoJGFjY291bnQsIHJlcXVlc3QoKS0+Z2V0KCdmcm9tJyksIHJlcXVlc3QoKS0+Z2V0KCd0bycpLCAkY3VycmVuY3lfaWQsICEocmVxdWVzdCgpLT5oYXMoJ3JlcG9ydF90eXBlJykgJiYgcmVxdWVzdCgpLT5nZXQoJ3JlcG9ydF90eXBlJykgPT0gJ3BkZicpLCAkZXhjaGFuZ2VSYXRlcywgJGVudHJ5SXRlbXMsICRhbGwsIHJlcXVlc3QoKS0+Z2V0KCdjb21wYW55X2lkJyksIHJlcXVlc3QoKS0+Z2V0KCdmaXNjYWxfeWVhcl9pZCcpLCAkY2FycnlGb3J3YXJkZWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRyaWFsQmFsYW5jZSAuPSAkdHJpYWxiYWxhbmNlTGVkZ2VyWydkYXRhJ107CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGJhbGFuY2VzWydvcGVuaW5nX2JhbGFuY2UnXVtdID0gJHRyaWFsYmFsYW5jZUxlZGdlclsnYmFsYW5jZSddWydvcGVuaW5nX2JhbGFuY2UnXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRiYWxhbmNlc1snYmFsYW5jZSddW10gPSAkdHJpYWxiYWxhbmNlTGVkZ2VyWydiYWxhbmNlJ11bJ2JhbGFuY2UnXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgJHRyaWFsQmFsYW5jZSAuPSAnPHRyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNvbHNwYW49IjIiPjxzdHJvbmc+VG90YWw6PC9zdHJvbmc+PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0ib3BlbmluZ19iYWxhbmNlX2NvbHVtbiIgc3R5bGU9InRleHQtYWxpZ246IHJpZ2h0Ij48c3Ryb25nPicuc3lzdGVtTW9uZXlGb3JtYXQoYXJyYXlfc3VtKCRiYWxhbmNlc1snb3BlbmluZ19iYWxhbmNlJ10pKS4nPC9zdHJvbmc+PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0iY2xvc2luZ19iYWxhbmNlX2NvbHVtbiIgc3R5bGU9InRleHQtYWxpZ246IHJpZ2h0Ij48c3Ryb25nPicuc3lzdGVtTW9uZXlGb3JtYXQoYXJyYXlfc3VtKCRiYWxhbmNlc1snYmFsYW5jZSddKSkuJzwvc3Ryb25nPjwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+JzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAkdGl0bGUsCiAgICAgICAgICAgICAgICAnZmlzY2FsWWVhcicgPT4gJGZpc2NhbFllYXIsCiAgICAgICAgICAgICAgICAnYWNjb3VudERlZmF1bHRTZXR0aW5ncycgPT4gJGFjY291bnREZWZhdWx0U2V0dGluZ3MsCiAgICAgICAgICAgICAgICAnY29tcGFuaWVzJyA9PiBDb21wYW55OjpoYXMoJ3Byb2ZpdENlbnRyZXMuY29zdENlbnRyZXMnKS0+Z2V0KCksCiAgICAgICAgICAgICAgICAnZmlzY2FsWWVhcnMnID0+IEZpc2NhbFllYXI6OmFsbCgpLAogICAgICAgICAgICAgICAgJ2N1cnJlbmN5VHlwZXMnID0+IEN1cnJlbmN5VHlwZTo6d2l0aChbJ2N1cnJlbmNpZXMnXSktPmdldCgpLAogICAgICAgICAgICAgICAgJ2N1cnJlbmN5JyA9PiBDdXJyZW5jeTo6ZmluZChyZXF1ZXN0KCktPmdldCgnY3VycmVuY3lfaWQnKSksCiAgICAgICAgICAgICAgICAndHJpYWxCYWxhbmNlJyA9PiAkdHJpYWxCYWxhbmNlLAogICAgICAgICAgICBdOwoKICAgICAgICAgICAgaWYocmVxdWVzdCgpLT5oYXMoJ3JlcG9ydF90eXBlJykgJiYgcmVxdWVzdCgpLT5nZXQoJ3JlcG9ydF90eXBlJykgPT0gJ3BkZicpewogICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdNUERGKCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMucmVwb3J0cy50cmlhbEJhbGFuY2Uub25seVdpdGhDbG9zaW5nQmFsYW5jZVBERicsICRkYXRhLCAkdGl0bGUsICR0aXRsZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKHJlcXVlc3QoKS0+aGFzKCdyZXBvcnRfdHlwZScpICYmIHJlcXVlc3QoKS0+Z2V0KCdyZXBvcnRfdHlwZScpID09ICdyZXBvcnQnKXsKICAgICAgICAgICAgICAgIHJldHVybiB2aWV3KCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMucmVwb3J0cy50cmlhbEJhbGFuY2Uub25seVdpdGhDbG9zaW5nQmFsYW5jZVJlcG9ydCcsICRkYXRhKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5yZXBvcnRzLnRyaWFsQmFsYW5jZS5vbmx5V2l0aENsb3NpbmdCYWxhbmNlJywgJGRhdGEpOwogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICBpZihyZXF1ZXN0KCktPmhhcygncmVwb3J0X3R5cGUnKSAmJiByZXF1ZXN0KCktPmdldCgncmVwb3J0X3R5cGUnKSA9PSAncmVwb3J0Jyl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHRoLT5nZXRNZXNzYWdlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQp9Cg==