<?php
bolt_decrypt( __FILE__ , 'CuHWCf'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcTXlhY2NvdW50aW5nOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKCnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQ2hhcnRPZkFjY291bnQ7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcVW5yZWFsaXplZEN1cnJlbmN5RXZlbnRTZXR0aW5nOwp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXFVucmVhbGl6ZWRDdXJyZW5jeUV2ZW50Owp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXFVucmVhbGl6ZWRDdXJyZW5jeUV2ZW50TGVkZ2VyOwoKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDdXJyZW5jeTsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xFeGNoYW5nZVJhdGU7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcRW50cnlJdGVtOwoKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xTdXBwbGllcnM7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcU3VwcGxpZXJQYXltZW50OwoKdXNlIFxBcHBcTW9kZWxzXFNhbGVzXEN1c3RvbWVyOwoKdXNlIEFwcCwgREI7CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xBdXRoOwoKY2xhc3MgVW5yZWFsaXplZEN1cnJlbmN5RXZhbHVhdGlvbkNvbnRyb2xsZXIgZXh0ZW5kcyBDb250cm9sbGVyCnsKICAgIHB1YmxpYyBmdW5jdGlvbiBpbmRleCgpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJHJ1bl9kYXRlID0gcmVxdWVzdCgpLT5oYXMoJ3J1bl9kYXRlJykgPyByZXF1ZXN0KCktPmdldCgncnVuX2RhdGUnKSA6IGRhdGUoJ1ktbS1kJyk7CiAgICAgICAgICAgICRwYXlhYmxlcyA9IHJlcXVlc3QoKS0+aGFzKCdwYXlhYmxlcycpID8gcmVxdWVzdCgpLT5nZXQoJ3BheWFibGVzJykgOiAwOwogICAgICAgICAgICAkcmVjZWl2YWJsZXMgPSByZXF1ZXN0KCktPmhhcygncmVjZWl2YWJsZXMnKSA/IHJlcXVlc3QoKS0+Z2V0KCdyZWNlaXZhYmxlcycpIDogMDsKICAgICAgICAgICAgJGFjY291bnREZWZhdWx0U2V0dGluZ3MgPSBhY2NvdW50RGVmYXVsdFNldHRpbmdzKCk7CiAgICAgICAgICAgICR1bnJlYWxpemVkQ3VycmVuY3lFdmVudFNldHRpbmdzID0gdW5yZWFsaXplZEN1cnJlbmN5RXZlbnRTZXR0aW5ncygpOwoKICAgICAgICAgICAgJGxhc3RFdmFsdWF0ZWQgPSBVbnJlYWxpemVkQ3VycmVuY3lFdmVudDo6b3JkZXJCeSgnaWQnLCAnZGVzYycpLT5maXJzdCgpOwogICAgICAgICAgICAkZnJvbSA9IGlzc2V0KCRsYXN0RXZhbHVhdGVkLT5pZCkgPyAkbGFzdEV2YWx1YXRlZC0+cnVuX2RhdGUgOiBmYWxzZTsKICAgICAgICAgICAgJHRvID0gJHJ1bl9kYXRlOwoKICAgICAgICAgICAgJGRhdGEgPSBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICdVbnJlYWxpemVkIEN1cnJlbmN5IEV2YWx1YXRpb24nLAogICAgICAgICAgICAgICAgJ3J1bl9kYXRlJyA9PiAkcnVuX2RhdGUsCiAgICAgICAgICAgICAgICAncGF5YWJsZXMnID0+ICRwYXlhYmxlcywKICAgICAgICAgICAgICAgICdyZWNlaXZhYmxlcycgPT4gJHJlY2VpdmFibGVzLAogICAgICAgICAgICAgICAgJ2FjY291bnREZWZhdWx0U2V0dGluZ3MnID0+ICRhY2NvdW50RGVmYXVsdFNldHRpbmdzLAogICAgICAgICAgICAgICAgJ3VucmVhbGl6ZWRDdXJyZW5jeUV2ZW50U2V0dGluZ3MnID0+ICR1bnJlYWxpemVkQ3VycmVuY3lFdmVudFNldHRpbmdzLAogICAgICAgICAgICAgICAgJ2xlZGdlcnMnID0+IENoYXJ0T2ZBY2NvdW50Ojp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAnYWNjb3VudEdyb3VwJwogICAgICAgICAgICAgICAgXSktPm9yZGVyQnkoJ2NvZGUnLCAnYXNjJyktPmdldCgpLAogICAgICAgICAgICAgICAgJ2xhc3RFdmFsdWF0ZWQnID0+ICRsYXN0RXZhbHVhdGVkLAogICAgICAgICAgICAgICAgJ2Zyb20nID0+ICRmcm9tLAogICAgICAgICAgICAgICAgJ3RvJyA9PiAkdG8sCiAgICAgICAgICAgIF07CgogICAgICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLnVucmVhbGl6ZWRDdXJyZW5jeUV2YWx1YXRpb24uaW5kZXgnLCAkZGF0YSk7CiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiB1cGRhdGUoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICB0cnl7CiAgICAgICAgICAgICRhY2NvdW50RGVmYXVsdFNldHRpbmdzID0gYWNjb3VudERlZmF1bHRTZXR0aW5ncygpOwoKICAgICAgICAgICAgJGxhc3RFdmFsdWF0ZWQgPSBVbnJlYWxpemVkQ3VycmVuY3lFdmVudDo6b3JkZXJCeSgnaWQnLCAnZGVzYycpLT5maXJzdCgpOwogICAgICAgICAgICAkZnJvbSA9IGlzc2V0KCRsYXN0RXZhbHVhdGVkLT5pZCkgPyAkbGFzdEV2YWx1YXRlZC0+cnVuX2RhdGUgOiBmYWxzZTsKICAgICAgICAgICAgJHRvID0gJHJlcXVlc3QtPnJ1bl9kYXRlOwoKICAgICAgICAgICAgJGFzc2V0X2xlZGdlcnMgPSBpc3NldCgkcmVxdWVzdC0+YXNzZXRfbGVkZ2Vyc1swXSkgPyAkcmVxdWVzdC0+YXNzZXRfbGVkZ2VycyA6IFtdOwogICAgICAgICAgICAkbGlhYmlsaXR5X2xlZGdlcnMgPSBpc3NldCgkcmVxdWVzdC0+bGlhYmlsaXR5X2xlZGdlcnNbMF0pID8gJHJlcXVlc3QtPmxpYWJpbGl0eV9sZWRnZXJzIDogW107CgogICAgICAgICAgICAkc3VwcGxpZXJQYXlhYmxlcyA9IFN1cHBsaWVyczo6d2hlcmUoJ3BheWFibGVfYWNjb3VudF9pZCcsICc+JywgMCktPmdyb3VwQnkoJ3BheWFibGVfYWNjb3VudF9pZCcpLT5wbHVjaygncGF5YWJsZV9hY2NvdW50X2lkJyktPnRvQXJyYXkoKTsKICAgICAgICAgICAgaWYoIWluX2FycmF5KCRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydzdXBwbGllcl9wYXlhYmxlX2FjY291bnQnXSwgJHN1cHBsaWVyUGF5YWJsZXMpKXsKICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJHN1cHBsaWVyUGF5YWJsZXMsICRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydzdXBwbGllcl9wYXlhYmxlX2FjY291bnQnXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRjdXN0b21lclJlY2VpdmFibGVzID0gQ3VzdG9tZXI6OndoZXJlKCdyZWNlaXZhYmxlc19hY2NvdW50X2lkJywgJz4nLCAwKS0+Z3JvdXBCeSgncmVjZWl2YWJsZXNfYWNjb3VudF9pZCcpLT5wbHVjaygncmVjZWl2YWJsZXNfYWNjb3VudF9pZCcpLT50b0FycmF5KCk7CiAgICAgICAgICAgIGlmKCFpbl9hcnJheSgkYWNjb3VudERlZmF1bHRTZXR0aW5nc1sncmVjZWl2YWJsZXNfYWNjb3VudCddLCAkY3VzdG9tZXJSZWNlaXZhYmxlcykpewogICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkY3VzdG9tZXJSZWNlaXZhYmxlcywgJGFjY291bnREZWZhdWx0U2V0dGluZ3NbJ3JlY2VpdmFibGVzX2FjY291bnQnXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRsZWRnZXJzID0gQ2hhcnRPZkFjY291bnQ6OndpdGgoWwogICAgICAgICAgICAgICAgJ2FjY291bnRHcm91cCcKICAgICAgICAgICAgXSkKICAgICAgICAgICAgLT53aGVyZUluKCdpZCcsIGFycmF5X21lcmdlKCRjdXN0b21lclJlY2VpdmFibGVzLCBhcnJheV9tZXJnZSgkc3VwcGxpZXJQYXlhYmxlcywgYXJyYXlfbWVyZ2UoJGFzc2V0X2xlZGdlcnMsICRsaWFiaWxpdHlfbGVkZ2VycykpKSkKICAgICAgICAgICAgLT5vcmRlckJ5KCdjb2RlJywgJ2FzYycpLT5nZXQoKTsKCiAgICAgICAgICAgICRlbnRyaWVzID0gRW50cnlJdGVtOjp3aXRoKFsKICAgICAgICAgICAgICAgICdlbnRyeS5leGNoYW5nZVJhdGUnLAogICAgICAgICAgICBdKQogICAgICAgICAgICAtPmRvZXNudEhhdmUoJ2VudHJ5LnB1cmNoYXNlT3JkZXInKQogICAgICAgICAgICAtPmRvZXNudEhhdmUoJ2VudHJ5LnNhbGVPcmRlcicpCiAgICAgICAgICAgIC0+d2hlbigkdG8sIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCR0byl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnZW50cnknLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkdG8pewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdkYXRlJywgJzw9JywgJHRvKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlSW4oJ2NoYXJ0X29mX2FjY291bnRfaWQnLCAkbGVkZ2Vycy0+cGx1Y2soJ2lkJyktPnRvQXJyYXkoKSkKICAgICAgICAgICAgLT53aGVyZSgncmVhbGl6ZWQnLCAwKQogICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAgICAgJG9yZGVyRW50cmllcyA9IEVudHJ5SXRlbTo6d2l0aChbCiAgICAgICAgICAgICAgICAnZW50cnkuZXhjaGFuZ2VSYXRlJywKICAgICAgICAgICAgXSkKICAgICAgICAgICAgLT53aGVuKCR0bywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHRvKXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdlbnRyeScsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCR0byl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2RhdGUnLCAnPD0nLCAkdG8pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmUoZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+aGFzKCdlbnRyeS5wdXJjaGFzZU9yZGVyJyk7CiAgICAgICAgICAgICAgICB9KS0+b3JXaGVyZShmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPmhhcygnZW50cnkuc2FsZU9yZGVyJyk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZUluKCdjaGFydF9vZl9hY2NvdW50X2lkJywgJGxlZGdlcnMtPnBsdWNrKCdpZCcpLT50b0FycmF5KCkpCiAgICAgICAgICAgIC0+d2hlcmUoJ3JlYWxpemVkJywgMCkKICAgICAgICAgICAgLT5nZXQoKTsKCiAgICAgICAgICAgICRjdXJyZW5jaWVzID0gQ3VycmVuY3k6OmFsbCgpOwogICAgICAgICAgICAkcnVuUmF0ZXMgPSBbXTsKICAgICAgICAgICAgZm9yZWFjaCAoJGN1cnJlbmNpZXMgYXMgJGN1cnJlbmN5KSB7CiAgICAgICAgICAgICAgICAkcnVuUmF0ZXNbJGN1cnJlbmN5LT5pZF0gPSBnZXRFeGNoYW5nZVJhdGVzKCRjdXJyZW5jeS0+aWQsICRyZXF1ZXN0LT5ydW5fZGF0ZSwgJzIzOjU5OjU5Jyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMudW5yZWFsaXplZEN1cnJlbmN5RXZhbHVhdGlvbi5mb3JtJywgWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAnVW5yZWFsaXplZCBDdXJyZW5jeSBFdmFsdWF0aW9uJywgCiAgICAgICAgICAgICAgICAncnVuX2RhdGUnID0+ICRyZXF1ZXN0LT5ydW5fZGF0ZSwKICAgICAgICAgICAgICAgICdwYXlhYmxlcycgPT4gJHJlcXVlc3QtPnBheWFibGVzLAogICAgICAgICAgICAgICAgJ3JlY2VpdmFibGVzJyA9PiAkcmVxdWVzdC0+cmVjZWl2YWJsZXMsCiAgICAgICAgICAgICAgICAnYXNzZXRfbGVkZ2VycycgPT4gJGFzc2V0X2xlZGdlcnMsCiAgICAgICAgICAgICAgICAnbGlhYmlsaXR5X2xlZGdlcnMnID0+ICRsaWFiaWxpdHlfbGVkZ2VycywKICAgICAgICAgICAgICAgICdhY2NvdW50RGVmYXVsdFNldHRpbmdzJyA9PiAkYWNjb3VudERlZmF1bHRTZXR0aW5ncywKICAgICAgICAgICAgICAgICdzeXN0ZW1DdXJyZW5jeScgPT4gc3lzdGVtQ3VycmVuY3koKSwKICAgICAgICAgICAgICAgICdzdXBwbGllclBheWFibGVzJyA9PiAkc3VwcGxpZXJQYXlhYmxlcywKICAgICAgICAgICAgICAgICdjdXN0b21lclJlY2VpdmFibGVzJyA9PiAkY3VzdG9tZXJSZWNlaXZhYmxlcywKICAgICAgICAgICAgICAgICdsZWRnZXJzJyA9PiAkbGVkZ2VycywKICAgICAgICAgICAgICAgICdlbnRyaWVzJyA9PiAkZW50cmllcywKICAgICAgICAgICAgICAgICdvcmRlckVudHJpZXMnID0+ICRvcmRlckVudHJpZXMsCiAgICAgICAgICAgICAgICAnY3VycmVuY2llcycgPT4gJGN1cnJlbmNpZXMsCiAgICAgICAgICAgICAgICAncnVuUmF0ZXMnID0+ICRydW5SYXRlcywKICAgICAgICAgICAgICAgICdmcm9tJyA9PiAkZnJvbSwKICAgICAgICAgICAgICAgICd0bycgPT4gJHRvLAogICAgICAgICAgICBdKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aC0+Z2V0TWVzc2FnZSgpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gc3RvcmUoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkcmVxdWVzdC0+dmFsaWRhdGUoWwogICAgICAgICAgICAncnVuX2RhdGUnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdwYXlhYmxlcycgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ3JlY2VpdmFibGVzJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAncmV2ZXJzYWxfZGF0ZScgPT4gJ3JlcXVpcmVkJywKICAgICAgICBdKTsKCiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnl7CiAgICAgICAgICAgICRqb3VybmFsRW50cmllcyA9IFtdOwogICAgICAgICAgICAkcHJvdmlzaW9uSm91cm5hbEVudHJpZXMgPSBbXTsKCiAgICAgICAgICAgICRhY2NvdW50RGVmYXVsdFNldHRpbmdzID0gYWNjb3VudERlZmF1bHRTZXR0aW5ncygpOwogICAgICAgICAgICAkdW5yZWFsaXplZEN1cnJlbmN5RXZlbnRTZXR0aW5ncyA9IHVucmVhbGl6ZWRDdXJyZW5jeUV2ZW50U2V0dGluZ3MoKTsKICAgICAgICAgICAgJHN5c3RlbUN1cnJlbmN5ID0gc3lzdGVtQ3VycmVuY3koKTsKICAgICAgICAgICAgJGxhc3RFdmFsdWF0ZWQgPSBVbnJlYWxpemVkQ3VycmVuY3lFdmVudDo6b3JkZXJCeSgnaWQnLCAnZGVzYycpLT5maXJzdCgpOwogICAgICAgICAgICAkZnJvbSA9IGlzc2V0KCRsYXN0RXZhbHVhdGVkLT5pZCkgPyAkbGFzdEV2YWx1YXRlZC0+cnVuX2RhdGUgOiBmYWxzZTsKICAgICAgICAgICAgJHRvID0gJHJlcXVlc3QtPnJ1bl9kYXRlOwoKICAgICAgICAgICAgJHN1cHBsaWVyUGF5YWJsZXMgPSBTdXBwbGllcnM6OndoZXJlKCdwYXlhYmxlX2FjY291bnRfaWQnLCAnPicsIDApLT5ncm91cEJ5KCdwYXlhYmxlX2FjY291bnRfaWQnKS0+cGx1Y2soJ3BheWFibGVfYWNjb3VudF9pZCcpLT50b0FycmF5KCk7CiAgICAgICAgICAgIGlmKCFpbl9hcnJheSgkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snc3VwcGxpZXJfcGF5YWJsZV9hY2NvdW50J10sICRzdXBwbGllclBheWFibGVzKSl7CiAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRzdXBwbGllclBheWFibGVzLCAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snc3VwcGxpZXJfcGF5YWJsZV9hY2NvdW50J10pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkY3VzdG9tZXJSZWNlaXZhYmxlcyA9IEN1c3RvbWVyOjp3aGVyZSgncmVjZWl2YWJsZXNfYWNjb3VudF9pZCcsICc+JywgMCktPmdyb3VwQnkoJ3JlY2VpdmFibGVzX2FjY291bnRfaWQnKS0+cGx1Y2soJ3JlY2VpdmFibGVzX2FjY291bnRfaWQnKS0+dG9BcnJheSgpOwogICAgICAgICAgICBpZighaW5fYXJyYXkoJGFjY291bnREZWZhdWx0U2V0dGluZ3NbJ3JlY2VpdmFibGVzX2FjY291bnQnXSwgJGN1c3RvbWVyUmVjZWl2YWJsZXMpKXsKICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGN1c3RvbWVyUmVjZWl2YWJsZXMsICRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydyZWNlaXZhYmxlc19hY2NvdW50J10pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkbGVkZ2VycyA9IENoYXJ0T2ZBY2NvdW50Ojp3aXRoKFsKICAgICAgICAgICAgICAgICdhY2NvdW50R3JvdXAnCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlcmVJbignaWQnLCBhcnJheV9tZXJnZSgkY3VzdG9tZXJSZWNlaXZhYmxlcywgYXJyYXlfbWVyZ2UoJHN1cHBsaWVyUGF5YWJsZXMsIGFycmF5X21lcmdlKGV4cGxvZGUoJywnLCAkcmVxdWVzdC0+YXNzZXRfbGVkZ2VycyksIGV4cGxvZGUoJywnLCAkcmVxdWVzdC0+bGlhYmlsaXR5X2xlZGdlcnMpKSkpKQogICAgICAgICAgICAtPm9yZGVyQnkoJ2NvZGUnLCAnYXNjJyktPmdldCgpOwoKICAgICAgICAgICAgJGVudHJpZXMgPSBFbnRyeUl0ZW06OndpdGgoWwogICAgICAgICAgICAgICAgJ2VudHJ5LmV4Y2hhbmdlUmF0ZScsCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlbigkdG8sIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCR0byl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnZW50cnknLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkdG8pewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdkYXRlJywgJzw9JywgJHRvKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPmRvZXNudEhhdmUoJ2VudHJ5LnB1cmNoYXNlT3JkZXInKQogICAgICAgICAgICAtPmRvZXNudEhhdmUoJ2VudHJ5LnNhbGVPcmRlcicpCiAgICAgICAgICAgIC0+d2hlcmVJbignY2hhcnRfb2ZfYWNjb3VudF9pZCcsICRsZWRnZXJzLT5wbHVjaygnaWQnKS0+dG9BcnJheSgpKQogICAgICAgICAgICAtPndoZXJlKCdyZWFsaXplZCcsIDApCiAgICAgICAgICAgIC0+Z2V0KCk7CgogICAgICAgICAgICAkb3JkZXJFbnRyaWVzID0gRW50cnlJdGVtOjp3aXRoKFsKICAgICAgICAgICAgICAgICdlbnRyeS5leGNoYW5nZVJhdGUnLAogICAgICAgICAgICBdKQogICAgICAgICAgICAtPndoZW4oJHRvLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkdG8pewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2VudHJ5JywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHRvKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZGF0ZScsICc8PScsICR0byk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZShmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5oYXMoJ2VudHJ5LnB1cmNoYXNlT3JkZXInKTsKICAgICAgICAgICAgICAgIH0pLT5vcldoZXJlKGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+aGFzKCdlbnRyeS5zYWxlT3JkZXInKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlSW4oJ2NoYXJ0X29mX2FjY291bnRfaWQnLCAkbGVkZ2Vycy0+cGx1Y2soJ2lkJyktPnRvQXJyYXkoKSkKICAgICAgICAgICAgLT53aGVyZSgncmVhbGl6ZWQnLCAwKQogICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAgICAgJGN1cnJlbmNpZXMgPSBDdXJyZW5jeTo6YWxsKCk7CiAgICAgICAgICAgICRydW5SYXRlcyA9IFtdOwogICAgICAgICAgICBmb3JlYWNoICgkY3VycmVuY2llcyBhcyAkY3VycmVuY3kpIHsKICAgICAgICAgICAgICAgICRydW5SYXRlc1skY3VycmVuY3ktPmlkXSA9IGdldEV4Y2hhbmdlUmF0ZXMoJGN1cnJlbmN5LT5pZCwgcmVxdWVzdCgpLT5nZXQoJ3J1bl9kYXRlJyksICcyMzo1OTo1OScpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkZGF0YSA9IFtdOwogICAgICAgICAgICAkYXNzZXRfZ2FpbiA9IDA7CiAgICAgICAgICAgICRhc3NldF9sb3NzID0gMDsKICAgICAgICAgICAgJGxpYWJpbGl0eV9nYWluID0gMDsKICAgICAgICAgICAgJGxpYWJpbGl0eV9sb3NzID0gMDsKCiAgICAgICAgICAgICRwcm92aXNpb25zID0gW107CgogICAgICAgICAgICBpZigkbGVkZ2Vycy0+d2hlcmVJbignaWQnLCAkc3VwcGxpZXJQYXlhYmxlcyktPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgIGZvcmVhY2goJGxlZGdlcnMtPndoZXJlSW4oJ2lkJywgJHN1cHBsaWVyUGF5YWJsZXMpLT5zb3J0QnkoJ2NvZGUnKSBhcyAka2V5ID0+ICRsZWRnZXIpewogICAgICAgICAgICAgICAgICAgIGlmKCRjdXJyZW5jaWVzLT5jb3VudCgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2goJGN1cnJlbmNpZXMgYXMgJGN1cnJlbmN5X2tleSA9PiAkY3VycmVuY3kpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRyYW5zYWN0aW9ucyA9ICRvcmRlckVudHJpZXMtPndoZXJlKCdlbnRyeS5leGNoYW5nZVJhdGUuY3VycmVuY3lfaWQnLCAkY3VycmVuY3ktPmlkKS0+d2hlcmUoJ2NoYXJ0X29mX2FjY291bnRfaWQnLCAkbGVkZ2VyLT5pZCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRyYW5zYWN0aW9uX2N1cnJlbmN5ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyZXBvcnRpbmdfY3VycmVuY3kgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJ1bl9yYXRlID0gaXNzZXQoanNvbl9kZWNvZGUoJHJ1blJhdGVzWyRjdXJyZW5jeS0+aWRdWydyYXRlJ10tPnJhdGVzLCB0cnVlKVskc3lzdGVtQ3VycmVuY3ktPmlkXVsncmF0ZSddKSA/IGpzb25fZGVjb2RlKCRydW5SYXRlc1skY3VycmVuY3ktPmlkXVsncmF0ZSddLT5yYXRlcywgdHJ1ZSlbJHN5c3RlbUN1cnJlbmN5LT5pZF1bJ3JhdGUnXSA6IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCR0cmFuc2FjdGlvbnMtPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCR0cmFuc2FjdGlvbnMgYXMgJGtleSA9PiAkdHJhbnNhY3Rpb24pewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcmF0ZSA9IGV4Y2hhbmdlUmF0ZSgkdHJhbnNhY3Rpb24tPmVudHJ5LT5leGNoYW5nZVJhdGUsICRzeXN0ZW1DdXJyZW5jeS0+aWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdHJhbnNhY3Rpb25fY3VycmVuY3kgKz0gJHRyYW5zYWN0aW9uLT5hbW91bnQqKCR0cmFuc2FjdGlvbi0+ZGViaXRfY3JlZGl0ID09ICdEJyA/IDEgOiAoLTEpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJlcG9ydGluZ19jdXJyZW5jeSArPSAkdHJhbnNhY3Rpb24tPmFtb3VudCooJHRyYW5zYWN0aW9uLT5kZWJpdF9jcmVkaXQgPT0gJ0QnID8gMSA6ICgtMSkpKiRyYXRlOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkcHJvdmlzaW9ucywgJHRyYW5zYWN0aW9uLT5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR1bnJlYWxpemVkX2Ftb3VudCA9ICR0cmFuc2FjdGlvbl9jdXJyZW5jeSokcnVuX3JhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZ2FpbiA9ICR1bnJlYWxpemVkX2Ftb3VudCA+ICRyZXBvcnRpbmdfY3VycmVuY3kgPyAkdW5yZWFsaXplZF9hbW91bnQtJHJlcG9ydGluZ19jdXJyZW5jeSA6IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbG9zcyA9ICR1bnJlYWxpemVkX2Ftb3VudCA8ICRyZXBvcnRpbmdfY3VycmVuY3kgPyAkcmVwb3J0aW5nX2N1cnJlbmN5LSR1bnJlYWxpemVkX2Ftb3VudCA6IDA7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHRyYW5zYWN0aW9uX2N1cnJlbmN5ICE9IDAgJiYgKCRnYWluID4gMCB8fCAkbG9zcyA+IDApKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGF0YVsncGF5YWJsZXMnXVskbGVkZ2VyLT5pZF1bJGN1cnJlbmN5LT5pZF0gPSBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0cmFuc2FjdGlvbl9jdXJyZW5jeScgPT4gJHRyYW5zYWN0aW9uX2N1cnJlbmN5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmVwb3J0aW5nX2V4Y2hhbmdlX3JhdGUnID0+ICRydW5fcmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JlcG9ydGluZ19jdXJyZW5jeScgPT4gJHJlcG9ydGluZ19jdXJyZW5jeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3VucmVhbGl6ZWRfYW1vdW50JyA9PiAkdW5yZWFsaXplZF9hbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdnYWluJyA9PiAkZ2FpbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xvc3MnID0+ICRsb3NzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF07CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsaWFiaWxpdHlfZ2FpbiArPSAkZ2FpbjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGlhYmlsaXR5X2xvc3MgKz0gJGxvc3M7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRnYWluID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGpvdXJuYWxFbnRyaWVzLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+IGF1dGgoKS0+dXNlcigpLT5jb3N0Q2VudHJlLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkdW5yZWFsaXplZEN1cnJlbmN5RXZlbnRTZXR0aW5nc1sncG5sX2xpYWJpbGl0eV9sZWRnZXJfaWQnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+ICRnYWluLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ0xpYWJpbGl0eSBHYWluIENyZWRpdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkcHJvdmlzaW9uSm91cm5hbEVudHJpZXMsIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gYXV0aCgpLT51c2VyKCktPmNvc3RDZW50cmUtPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICR1bnJlYWxpemVkQ3VycmVuY3lFdmVudFNldHRpbmdzWydwbmxfbGlhYmlsaXR5X2xlZGdlcl9pZCddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAkZ2FpbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAnTGlhYmlsaXR5IEdhaW4gRGViaXQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRsb3NzID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGpvdXJuYWxFbnRyaWVzLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+IGF1dGgoKS0+dXNlcigpLT5jb3N0Q2VudHJlLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkdW5yZWFsaXplZEN1cnJlbmN5RXZlbnRTZXR0aW5nc1sncG5sX2xpYWJpbGl0eV9sZWRnZXJfaWQnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gJGxvc3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ0xpYWJpbGl0eSBMb3NzIERlYml0JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRwcm92aXNpb25Kb3VybmFsRW50cmllcywgWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiBhdXRoKCktPnVzZXIoKS0+Y29zdENlbnRyZS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJHVucmVhbGl6ZWRDdXJyZW5jeUV2ZW50U2V0dGluZ3NbJ3BubF9saWFiaWxpdHlfbGVkZ2VyX2lkJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGViaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAkbG9zcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICdMaWFiaWxpdHkgTG9zcyBDcmVkaXQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKCRsZWRnZXJzLT53aGVyZUluKCdpZCcsICRjdXN0b21lclJlY2VpdmFibGVzKS0+Y291bnQoKSA+IDApewogICAgICAgICAgICAgICAgZm9yZWFjaCgkbGVkZ2Vycy0+d2hlcmVJbignaWQnLCAkY3VzdG9tZXJSZWNlaXZhYmxlcyktPnNvcnRCeSgnY29kZScpIGFzICRrZXkgPT4gJGxlZGdlcil7CiAgICAgICAgICAgICAgICAgICAgaWYoJGN1cnJlbmNpZXMtPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCgkY3VycmVuY2llcyBhcyAkY3VycmVuY3lfa2V5ID0+ICRjdXJyZW5jeSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdHJhbnNhY3Rpb25zID0gJG9yZGVyRW50cmllcy0+d2hlcmUoJ2VudHJ5LmV4Y2hhbmdlUmF0ZS5jdXJyZW5jeV9pZCcsICRjdXJyZW5jeS0+aWQpLT53aGVyZSgnY2hhcnRfb2ZfYWNjb3VudF9pZCcsICRsZWRnZXItPmlkKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdHJhbnNhY3Rpb25fY3VycmVuY3kgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJlcG9ydGluZ19jdXJyZW5jeSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcnVuX3JhdGUgPSBpc3NldChqc29uX2RlY29kZSgkcnVuUmF0ZXNbJGN1cnJlbmN5LT5pZF1bJ3JhdGUnXS0+cmF0ZXMsIHRydWUpWyRzeXN0ZW1DdXJyZW5jeS0+aWRdWydyYXRlJ10pID8ganNvbl9kZWNvZGUoJHJ1blJhdGVzWyRjdXJyZW5jeS0+aWRdWydyYXRlJ10tPnJhdGVzLCB0cnVlKVskc3lzdGVtQ3VycmVuY3ktPmlkXVsncmF0ZSddIDogMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCR0cmFuc2FjdGlvbnMtPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCR0cmFuc2FjdGlvbnMgYXMgJGtleSA9PiAkdHJhbnNhY3Rpb24pewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcmF0ZSA9IGV4Y2hhbmdlUmF0ZSgkdHJhbnNhY3Rpb24tPmVudHJ5LT5leGNoYW5nZVJhdGUsICRzeXN0ZW1DdXJyZW5jeS0+aWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdHJhbnNhY3Rpb25fY3VycmVuY3kgKz0gJHRyYW5zYWN0aW9uLT5hbW91bnQqKCR0cmFuc2FjdGlvbi0+ZGViaXRfY3JlZGl0ID09ICdEJyA/IDEgOiAoLTEpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJlcG9ydGluZ19jdXJyZW5jeSArPSAkdHJhbnNhY3Rpb24tPmFtb3VudCooJHRyYW5zYWN0aW9uLT5kZWJpdF9jcmVkaXQgPT0gJ0QnID8gMSA6ICgtMSkpKiRyYXRlOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkcHJvdmlzaW9ucywgJHRyYW5zYWN0aW9uLT5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR1bnJlYWxpemVkX2Ftb3VudCA9ICR0cmFuc2FjdGlvbl9jdXJyZW5jeSokcnVuX3JhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZ2FpbiA9ICRyZXBvcnRpbmdfY3VycmVuY3kgPCAkdW5yZWFsaXplZF9hbW91bnQgPyAkdW5yZWFsaXplZF9hbW91bnQtJHJlcG9ydGluZ19jdXJyZW5jeSA6IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbG9zcyA9ICRyZXBvcnRpbmdfY3VycmVuY3kgPiAkdW5yZWFsaXplZF9hbW91bnQgPyAkcmVwb3J0aW5nX2N1cnJlbmN5LSR1bnJlYWxpemVkX2Ftb3VudCA6IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCR0cmFuc2FjdGlvbl9jdXJyZW5jeSAhPSAwICYmICgkZ2FpbiA+IDAgfHwgJGxvc3MgPiAwKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRhdGFbJ2Fzc2V0cyddWyRsZWRnZXItPmlkXVskY3VycmVuY3ktPmlkXSA9IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RyYW5zYWN0aW9uX2N1cnJlbmN5JyA9PiAkdHJhbnNhY3Rpb25fY3VycmVuY3ksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZXBvcnRpbmdfZXhjaGFuZ2VfcmF0ZScgPT4gJHJ1bl9yYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmVwb3J0aW5nX2N1cnJlbmN5JyA9PiAkcmVwb3J0aW5nX2N1cnJlbmN5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndW5yZWFsaXplZF9hbW91bnQnID0+ICR1bnJlYWxpemVkX2Ftb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2dhaW4nID0+ICRnYWluLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbG9zcycgPT4gJGxvc3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFzc2V0X2dhaW4gKz0gJGdhaW47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFzc2V0X2xvc3MgKz0gJGxvc3M7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRnYWluID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGpvdXJuYWxFbnRyaWVzLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+IGF1dGgoKS0+dXNlcigpLT5jb3N0Q2VudHJlLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkdW5yZWFsaXplZEN1cnJlbmN5RXZlbnRTZXR0aW5nc1sncG5sX2Fzc2V0X2xlZGdlcl9pZCddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gJGdhaW4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAnQXNzZXQgR2FpbiBDcmVkaXQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRwcm92aXNpb25Kb3VybmFsRW50cmllcywgWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiBhdXRoKCktPnVzZXIoKS0+Y29zdENlbnRyZS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJHVucmVhbGl6ZWRDdXJyZW5jeUV2ZW50U2V0dGluZ3NbJ3BubF9hc3NldF9sZWRnZXJfaWQnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gJGdhaW4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ0Fzc2V0IEdhaW4gRGViaXQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRsb3NzID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGpvdXJuYWxFbnRyaWVzLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+IGF1dGgoKS0+dXNlcigpLT5jb3N0Q2VudHJlLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkdW5yZWFsaXplZEN1cnJlbmN5RXZlbnRTZXR0aW5nc1sncG5sX2Fzc2V0X2xlZGdlcl9pZCddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAkbG9zcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAnQXNzZXQgTG9zcyBEZWJpdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkcHJvdmlzaW9uSm91cm5hbEVudHJpZXMsIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gYXV0aCgpLT51c2VyKCktPmNvc3RDZW50cmUtPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICR1bnJlYWxpemVkQ3VycmVuY3lFdmVudFNldHRpbmdzWydwbmxfYXNzZXRfbGVkZ2VyX2lkJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGViaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAkbG9zcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICdBc3NldCBMb3NzIENyZWRpdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoJGxlZGdlcnMtPndoZXJlSW4oJ2lkJywgZXhwbG9kZSgnLCcsICRyZXF1ZXN0LT5hc3NldF9sZWRnZXJzKSktPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgIGZvcmVhY2goJGxlZGdlcnMtPndoZXJlSW4oJ2lkJywgZXhwbG9kZSgnLCcsICRyZXF1ZXN0LT5hc3NldF9sZWRnZXJzKSktPnNvcnRCeSgnY29kZScpIGFzICRrZXkgPT4gJGxlZGdlcil7CiAgICAgICAgICAgICAgICAgICAgaWYoJGN1cnJlbmNpZXMtPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCgkY3VycmVuY2llcyBhcyAkY3VycmVuY3lfa2V5ID0+ICRjdXJyZW5jeSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdHJhbnNhY3Rpb25zID0gJGVudHJpZXMtPndoZXJlKCdlbnRyeS5leGNoYW5nZVJhdGUuY3VycmVuY3lfaWQnLCAkY3VycmVuY3ktPmlkKS0+d2hlcmUoJ2NoYXJ0X29mX2FjY291bnRfaWQnLCAkbGVkZ2VyLT5pZCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRyYW5zYWN0aW9uX2N1cnJlbmN5ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyZXBvcnRpbmdfY3VycmVuY3kgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJ1bl9yYXRlID0gaXNzZXQoanNvbl9kZWNvZGUoJHJ1blJhdGVzWyRjdXJyZW5jeS0+aWRdWydyYXRlJ10tPnJhdGVzLCB0cnVlKVskc3lzdGVtQ3VycmVuY3ktPmlkXVsncmF0ZSddKSA/IGpzb25fZGVjb2RlKCRydW5SYXRlc1skY3VycmVuY3ktPmlkXVsncmF0ZSddLT5yYXRlcywgdHJ1ZSlbJHN5c3RlbUN1cnJlbmN5LT5pZF1bJ3JhdGUnXSA6IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkdHJhbnNhY3Rpb25zLT5jb3VudCgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCgkdHJhbnNhY3Rpb25zIGFzICRrZXkgPT4gJHRyYW5zYWN0aW9uKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJhdGUgPSBleGNoYW5nZVJhdGUoJHRyYW5zYWN0aW9uLT5lbnRyeS0+ZXhjaGFuZ2VSYXRlLCAkc3lzdGVtQ3VycmVuY3ktPmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRyYW5zYWN0aW9uX2N1cnJlbmN5ICs9ICR0cmFuc2FjdGlvbi0+YW1vdW50KigkdHJhbnNhY3Rpb24tPmRlYml0X2NyZWRpdCA9PSAnRCcgPyAxIDogKC0xKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyZXBvcnRpbmdfY3VycmVuY3kgKz0gJHRyYW5zYWN0aW9uLT5hbW91bnQqKCR0cmFuc2FjdGlvbi0+ZGViaXRfY3JlZGl0ID09ICdEJyA/IDEgOiAoLTEpKSokcmF0ZTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJHByb3Zpc2lvbnMsICR0cmFuc2FjdGlvbi0+aWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdW5yZWFsaXplZF9hbW91bnQgPSAkdHJhbnNhY3Rpb25fY3VycmVuY3kqJHJ1bl9yYXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGdhaW4gPSAkcmVwb3J0aW5nX2N1cnJlbmN5IDwgJHVucmVhbGl6ZWRfYW1vdW50ID8gJHVucmVhbGl6ZWRfYW1vdW50LSRyZXBvcnRpbmdfY3VycmVuY3kgOiAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxvc3MgPSAkcmVwb3J0aW5nX2N1cnJlbmN5ID4gJHVucmVhbGl6ZWRfYW1vdW50ID8gJHJlcG9ydGluZ19jdXJyZW5jeS0kdW5yZWFsaXplZF9hbW91bnQgOiAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkdHJhbnNhY3Rpb25fY3VycmVuY3kgIT0gMCAmJiAoJGdhaW4gPiAwIHx8ICRsb3NzID4gMCkpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkYXRhWydhc3NldHMnXVskbGVkZ2VyLT5pZF1bJGN1cnJlbmN5LT5pZF0gPSBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0cmFuc2FjdGlvbl9jdXJyZW5jeScgPT4gJHRyYW5zYWN0aW9uX2N1cnJlbmN5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmVwb3J0aW5nX2V4Y2hhbmdlX3JhdGUnID0+ICRydW5fcmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JlcG9ydGluZ19jdXJyZW5jeScgPT4gJHJlcG9ydGluZ19jdXJyZW5jeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3VucmVhbGl6ZWRfYW1vdW50JyA9PiAkdW5yZWFsaXplZF9hbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdnYWluJyA9PiAkZ2FpbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xvc3MnID0+ICRsb3NzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF07CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhc3NldF9nYWluICs9ICRnYWluOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhc3NldF9sb3NzICs9ICRsb3NzOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkZ2FpbiA+IDApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRqb3VybmFsRW50cmllcywgWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiBhdXRoKCktPnVzZXIoKS0+Y29zdENlbnRyZS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJHVucmVhbGl6ZWRDdXJyZW5jeUV2ZW50U2V0dGluZ3NbJ3BubF9hc3NldF9sZWRnZXJfaWQnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+ICRnYWluLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ0Fzc2V0IEdhaW4gQ3JlZGl0JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkcHJvdmlzaW9uSm91cm5hbEVudHJpZXMsIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gYXV0aCgpLT51c2VyKCktPmNvc3RDZW50cmUtPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICR1bnJlYWxpemVkQ3VycmVuY3lFdmVudFNldHRpbmdzWydwbmxfYXNzZXRfbGVkZ2VyX2lkJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGViaXQnID0+ICRnYWluLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICdBc3NldCBHYWluIERlYml0JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkbG9zcyA+IDApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRqb3VybmFsRW50cmllcywgWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiBhdXRoKCktPnVzZXIoKS0+Y29zdENlbnRyZS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJHVucmVhbGl6ZWRDdXJyZW5jeUV2ZW50U2V0dGluZ3NbJ3BubF9hc3NldF9sZWRnZXJfaWQnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gJGxvc3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ0Fzc2V0IExvc3MgRGViaXQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJHByb3Zpc2lvbkpvdXJuYWxFbnRyaWVzLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+IGF1dGgoKS0+dXNlcigpLT5jb3N0Q2VudHJlLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkdW5yZWFsaXplZEN1cnJlbmN5RXZlbnRTZXR0aW5nc1sncG5sX2Fzc2V0X2xlZGdlcl9pZCddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gJGxvc3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAnQXNzZXQgTG9zcyBDcmVkaXQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKCRsZWRnZXJzLT53aGVyZUluKCdpZCcsIGV4cGxvZGUoJywnLCAkcmVxdWVzdC0+bGlhYmlsaXR5X2xlZGdlcnMpKS0+Y291bnQoKSA+IDApewogICAgICAgICAgICAgICAgZm9yZWFjaCgkbGVkZ2Vycy0+d2hlcmVJbignaWQnLCBleHBsb2RlKCcsJywgJHJlcXVlc3QtPmxpYWJpbGl0eV9sZWRnZXJzKSktPnNvcnRCeSgnY29kZScpIGFzICRrZXkgPT4gJGxlZGdlcil7CiAgICAgICAgICAgICAgICAgICAgaWYoJGN1cnJlbmNpZXMtPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCgkY3VycmVuY2llcyBhcyAkY3VycmVuY3lfa2V5ID0+ICRjdXJyZW5jeSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdHJhbnNhY3Rpb25zID0gJGVudHJpZXMtPndoZXJlKCdlbnRyeS5leGNoYW5nZVJhdGUuY3VycmVuY3lfaWQnLCAkY3VycmVuY3ktPmlkKS0+d2hlcmUoJ2NoYXJ0X29mX2FjY291bnRfaWQnLCAkbGVkZ2VyLT5pZCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRyYW5zYWN0aW9uX2N1cnJlbmN5ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyZXBvcnRpbmdfY3VycmVuY3kgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJ1bl9yYXRlID0gaXNzZXQoanNvbl9kZWNvZGUoJHJ1blJhdGVzWyRjdXJyZW5jeS0+aWRdWydyYXRlJ10tPnJhdGVzLCB0cnVlKVskc3lzdGVtQ3VycmVuY3ktPmlkXVsncmF0ZSddKSA/IGpzb25fZGVjb2RlKCRydW5SYXRlc1skY3VycmVuY3ktPmlkXVsncmF0ZSddLT5yYXRlcywgdHJ1ZSlbJHN5c3RlbUN1cnJlbmN5LT5pZF1bJ3JhdGUnXSA6IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCR0cmFuc2FjdGlvbnMtPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCR0cmFuc2FjdGlvbnMgYXMgJGtleSA9PiAkdHJhbnNhY3Rpb24pewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcmF0ZSA9IGV4Y2hhbmdlUmF0ZSgkdHJhbnNhY3Rpb24tPmVudHJ5LT5leGNoYW5nZVJhdGUsICRzeXN0ZW1DdXJyZW5jeS0+aWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdHJhbnNhY3Rpb25fY3VycmVuY3kgKz0gJHRyYW5zYWN0aW9uLT5hbW91bnQqKCR0cmFuc2FjdGlvbi0+ZGViaXRfY3JlZGl0ID09ICdEJyA/IDEgOiAoLTEpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJlcG9ydGluZ19jdXJyZW5jeSArPSAkdHJhbnNhY3Rpb24tPmFtb3VudCooJHRyYW5zYWN0aW9uLT5kZWJpdF9jcmVkaXQgPT0gJ0QnID8gMSA6ICgtMSkpKiRyYXRlOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkcHJvdmlzaW9ucywgJHRyYW5zYWN0aW9uLT5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR1bnJlYWxpemVkX2Ftb3VudCA9ICR0cmFuc2FjdGlvbl9jdXJyZW5jeSokcnVuX3JhdGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZ2FpbiA9ICR1bnJlYWxpemVkX2Ftb3VudCA+ICRyZXBvcnRpbmdfY3VycmVuY3kgPyAkdW5yZWFsaXplZF9hbW91bnQtJHJlcG9ydGluZ19jdXJyZW5jeSA6IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbG9zcyA9ICR1bnJlYWxpemVkX2Ftb3VudCA8ICRyZXBvcnRpbmdfY3VycmVuY3kgPyAkcmVwb3J0aW5nX2N1cnJlbmN5LSR1bnJlYWxpemVkX2Ftb3VudCA6IDA7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHRyYW5zYWN0aW9uX2N1cnJlbmN5ICE9IDAgJiYgKCRnYWluID4gMCB8fCAkbG9zcyA+IDApKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGF0YVsnbGlhYmlsaXRpZXMnXVskbGVkZ2VyLT5pZF1bJGN1cnJlbmN5LT5pZF0gPSBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0cmFuc2FjdGlvbl9jdXJyZW5jeScgPT4gJHRyYW5zYWN0aW9uX2N1cnJlbmN5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmVwb3J0aW5nX2V4Y2hhbmdlX3JhdGUnID0+ICRydW5fcmF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JlcG9ydGluZ19jdXJyZW5jeScgPT4gJHJlcG9ydGluZ19jdXJyZW5jeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3VucmVhbGl6ZWRfYW1vdW50JyA9PiAkdW5yZWFsaXplZF9hbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdnYWluJyA9PiAkZ2FpbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xvc3MnID0+ICRsb3NzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF07CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsaWFiaWxpdHlfZ2FpbiArPSAkZ2FpbjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGlhYmlsaXR5X2xvc3MgKz0gJGxvc3M7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRnYWluID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGpvdXJuYWxFbnRyaWVzLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+IGF1dGgoKS0+dXNlcigpLT5jb3N0Q2VudHJlLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkdW5yZWFsaXplZEN1cnJlbmN5RXZlbnRTZXR0aW5nc1sncG5sX2xpYWJpbGl0eV9sZWRnZXJfaWQnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+ICRnYWluLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ0xpYWJpbGl0eSBHYWluIENyZWRpdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkcHJvdmlzaW9uSm91cm5hbEVudHJpZXMsIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gYXV0aCgpLT51c2VyKCktPmNvc3RDZW50cmUtPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICR1bnJlYWxpemVkQ3VycmVuY3lFdmVudFNldHRpbmdzWydwbmxfbGlhYmlsaXR5X2xlZGdlcl9pZCddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAkZ2FpbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAnTGlhYmlsaXR5IEdhaW4gRGViaXQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRsb3NzID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGpvdXJuYWxFbnRyaWVzLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+IGF1dGgoKS0+dXNlcigpLT5jb3N0Q2VudHJlLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkdW5yZWFsaXplZEN1cnJlbmN5RXZlbnRTZXR0aW5nc1sncG5sX2xpYWJpbGl0eV9sZWRnZXJfaWQnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gJGxvc3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ0xpYWJpbGl0eSBMb3NzIERlYml0JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRwcm92aXNpb25Kb3VybmFsRW50cmllcywgWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiBhdXRoKCktPnVzZXIoKS0+Y29zdENlbnRyZS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJHVucmVhbGl6ZWRDdXJyZW5jeUV2ZW50U2V0dGluZ3NbJ3BubF9saWFiaWxpdHlfbGVkZ2VyX2lkJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGViaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAkbG9zcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICdMaWFiaWxpdHkgTG9zcyBDcmVkaXQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRldmVudCA9IFVucmVhbGl6ZWRDdXJyZW5jeUV2ZW50OjpjcmVhdGUoWwogICAgICAgICAgICAgICAgJ3JlZmVyZW5jZScgPT4gXFN0cjo6cmFuZG9tKDgpLAogICAgICAgICAgICAgICAgJ3J1bl9kYXRlJyA9PiAkcmVxdWVzdC0+cnVuX2RhdGUsCiAgICAgICAgICAgICAgICAncmV2ZXJzYWxfZGF0ZScgPT4gJHJlcXVlc3QtPnJldmVyc2FsX2RhdGUsCiAgICAgICAgICAgICAgICAncGF5YWJsZScgPT4gJHJlcXVlc3QtPnBheWFibGVzLAogICAgICAgICAgICAgICAgJ3JlY2VpdmFibGUnID0+ICRyZXF1ZXN0LT5yZWNlaXZhYmxlcywKICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAkZXZlbnRMZWRnZXJzID0gW107CiAgICAgICAgICAgIGlmKGlzX2FycmF5KCRkYXRhKSAmJiBjb3VudCgkZGF0YSkgPiAwKXsKICAgICAgICAgICAgICAgIGZvcmVhY2goJGRhdGEgYXMgJHBvcnRpb24pewogICAgICAgICAgICAgICAgICAgIGlmKGlzX2FycmF5KCRwb3J0aW9uKSAmJiBjb3VudCgkcG9ydGlvbikgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCgkcG9ydGlvbiBhcyAkbGVkZ2VyX2lkID0+ICRjdXJyZW5jaWVzKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGlzX2FycmF5KCRjdXJyZW5jaWVzKSAmJiBjb3VudCgkY3VycmVuY2llcykgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCRjdXJyZW5jaWVzIGFzICRjdXJyZW5jeV9pZCA9PiAkdmFsdWUpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRldmVudExlZGdlcnMsIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjdXJyZW5jeV9ldmVudF9pZCcgPT4gJGV2ZW50LT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkbGVkZ2VyX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RyYW5zYWN0aW9uX2N1cnJlbmN5X2lkJyA9PiAkY3VycmVuY3lfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmVwb3J0aW5nX2N1cnJlbmN5X2lkJyA9PiAkc3lzdGVtQ3VycmVuY3ktPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RyYW5zYWN0aW9uX2Ftb3VudCcgPT4gJHZhbHVlWyd0cmFuc2FjdGlvbl9jdXJyZW5jeSddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RyYW5zYWN0aW9uX2V4Y2hhbmdlX3JhdGUnID0+ICR2YWx1ZVsndHJhbnNhY3Rpb25fY3VycmVuY3knXSAhPSAwICYmICR2YWx1ZVsncmVwb3J0aW5nX2N1cnJlbmN5J10gIT0gMCA/ICR2YWx1ZVsncmVwb3J0aW5nX2N1cnJlbmN5J10vJHZhbHVlWyd0cmFuc2FjdGlvbl9jdXJyZW5jeSddICA6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmVwb3J0aW5nX2Ftb3VudCcgPT4gJHZhbHVlWydyZXBvcnRpbmdfY3VycmVuY3knXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdydW5fZGF0ZV9leGNoYW5nZV9yYXRlJyA9PiAkdmFsdWVbJ3JlcG9ydGluZ19leGNoYW5nZV9yYXRlJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndW5yZWFsaXplZF9hbW91bnQnID0+ICR2YWx1ZVsndW5yZWFsaXplZF9hbW91bnQnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdnYWluJyA9PiAkdmFsdWVbJ2dhaW4nXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsb3NzJyA9PiAkdmFsdWVbJ2xvc3MnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZihpc19hcnJheSgkZXZlbnRMZWRnZXJzKSAmJiBjb3VudCgkZXZlbnRMZWRnZXJzKSA+IDApewogICAgICAgICAgICAgICAgVW5yZWFsaXplZEN1cnJlbmN5RXZlbnRMZWRnZXI6Omluc2VydCgkZXZlbnRMZWRnZXJzKTsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICJtZXNzYWdlIiA9PiAiTm8gRGF0YSBmb3VuZCBmb3IgdGhpcyBvcGVyYXRpb24hIgogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKCiAgICAgICAgICAgIGlmKCRhc3NldF9nYWluID4gMCl7CiAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRqb3VybmFsRW50cmllcywgWwogICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gYXV0aCgpLT51c2VyKCktPmNvc3RDZW50cmUtPmlkLAogICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkdW5yZWFsaXplZEN1cnJlbmN5RXZlbnRTZXR0aW5nc1sncHJvdmlzaW9uX2Fzc2V0X2xlZGdlcl9pZCddLAogICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gJGFzc2V0X2dhaW4sCiAgICAgICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAnUHJvdmlzaW9uIERlYml0JywKICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJHByb3Zpc2lvbkpvdXJuYWxFbnRyaWVzLCBbCiAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiBhdXRoKCktPnVzZXIoKS0+Y29zdENlbnRyZS0+aWQsCiAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICR1bnJlYWxpemVkQ3VycmVuY3lFdmVudFNldHRpbmdzWydwcm92aXNpb25fYXNzZXRfbGVkZ2VyX2lkJ10sCiAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+ICRhc3NldF9nYWluLAogICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICdQcm92aXNpb24gQ3JlZGl0JywKICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZigkYXNzZXRfbG9zcyA+IDApewogICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkam91cm5hbEVudHJpZXMsIFsKICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+IGF1dGgoKS0+dXNlcigpLT5jb3N0Q2VudHJlLT5pZCwKICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJHVucmVhbGl6ZWRDdXJyZW5jeUV2ZW50U2V0dGluZ3NbJ3Byb3Zpc2lvbl9hc3NldF9sZWRnZXJfaWQnXSwKICAgICAgICAgICAgICAgICAgICAnZGViaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gJGFzc2V0X2xvc3MsCiAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ1Byb3Zpc2lvbiBDcmVkaXQnLAogICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkcHJvdmlzaW9uSm91cm5hbEVudHJpZXMsIFsKICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+IGF1dGgoKS0+dXNlcigpLT5jb3N0Q2VudHJlLT5pZCwKICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJHVucmVhbGl6ZWRDdXJyZW5jeUV2ZW50U2V0dGluZ3NbJ3Byb3Zpc2lvbl9hc3NldF9sZWRnZXJfaWQnXSwKICAgICAgICAgICAgICAgICAgICAnZGViaXQnID0+ICRhc3NldF9sb3NzLAogICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ1Byb3Zpc2lvbiBEZWJpdCcsCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoJGxpYWJpbGl0eV9nYWluID4gMCl7CiAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRqb3VybmFsRW50cmllcywgWwogICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gYXV0aCgpLT51c2VyKCktPmNvc3RDZW50cmUtPmlkLAogICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkdW5yZWFsaXplZEN1cnJlbmN5RXZlbnRTZXR0aW5nc1sncHJvdmlzaW9uX2xpYWJpbGl0eV9sZWRnZXJfaWQnXSwKICAgICAgICAgICAgICAgICAgICAnZGViaXQnID0+ICRsaWFiaWxpdHlfZ2FpbiwKICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICdQcm92aXNpb24gRGViaXQnLAogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJHByb3Zpc2lvbkpvdXJuYWxFbnRyaWVzLCBbCiAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiBhdXRoKCktPnVzZXIoKS0+Y29zdENlbnRyZS0+aWQsCiAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICR1bnJlYWxpemVkQ3VycmVuY3lFdmVudFNldHRpbmdzWydwcm92aXNpb25fbGlhYmlsaXR5X2xlZGdlcl9pZCddLAogICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAkbGlhYmlsaXR5X2dhaW4sCiAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ1Byb3Zpc2lvbiBDcmVkaXQnLAogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKCRsaWFiaWxpdHlfbG9zcyA+IDApewogICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkam91cm5hbEVudHJpZXMsIFsKICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+IGF1dGgoKS0+dXNlcigpLT5jb3N0Q2VudHJlLT5pZCwKICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJHVucmVhbGl6ZWRDdXJyZW5jeUV2ZW50U2V0dGluZ3NbJ3Byb3Zpc2lvbl9saWFiaWxpdHlfbGVkZ2VyX2lkJ10sCiAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+ICRsaWFiaWxpdHlfbG9zcywKICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAnUHJvdmlzaW9uIENyZWRpdCcsCiAgICAgICAgICAgICAgICBdKTsKCiAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRwcm92aXNpb25Kb3VybmFsRW50cmllcywgWwogICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gYXV0aCgpLT51c2VyKCktPmNvc3RDZW50cmUtPmlkLAogICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkdW5yZWFsaXplZEN1cnJlbmN5RXZlbnRTZXR0aW5nc1sncHJvdmlzaW9uX2xpYWJpbGl0eV9sZWRnZXJfaWQnXSwKICAgICAgICAgICAgICAgICAgICAnZGViaXQnID0+ICRsaWFiaWxpdHlfbG9zcywKICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICdQcm92aXNpb24gRGViaXQnLAogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRleGNoYW5nZV9yYXRlX2lkID0gJHJ1blJhdGVzWyRzeXN0ZW1DdXJyZW5jeS0+aWRdWydyYXRlJ10tPmlkOwogICAgICAgICAgICAkZW50cnkgPSBzYXZlTGVkZ2VyRW50cmllcyg1LCBkYXRlKCdZLW0tZCBIOmk6cycsIHN0cnRvdGltZSgkcmVxdWVzdC0+cnVuX2RhdGUpKSwgMSwgJycsICdVbnJlYWxpemVkIEN1cnJlbmN5IEV2YWx1YXRpb24nLCAkam91cm5hbEVudHJpZXMsICRleGNoYW5nZV9yYXRlX2lkLCAwLCAwLCAwLCBnZXRDb3N0Q2VudHJlQ29tcGFueShhdXRoKCktPnVzZXIoKS0+Y29zdENlbnRyZS0+aWQpKTsKICAgICAgICAgICAgc2F2ZUxlZGdlckVudHJpZXMoNSwgZGF0ZSgnWS1tLWQgSDppOnMnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPnJldmVyc2FsX2RhdGUpKSwgMSwgJGVudHJ5WydlbnRyeSddLT5udW1iZXIsICdVbnJlYWxpemVkIEN1cnJlbmN5IEV2YWx1YXRpb24gOjogUmV2ZXJzYWwnLCAkcHJvdmlzaW9uSm91cm5hbEVudHJpZXMsICRleGNoYW5nZV9yYXRlX2lkLCAwLCAwLCAwLCBnZXRDb3N0Q2VudHJlQ29tcGFueShhdXRoKCktPnVzZXIoKS0+Y29zdENlbnRyZS0+aWQpKTsKCiAgICAgICAgICAgIERCOjpjb21taXQoKTsKICAgICAgICAgICAgc2Vzc2lvbigpLT5mbGFzaCgnYWxlcnQtdHlwZScsICdzdWNjZXNzJyk7CiAgICAgICAgICAgIHNlc3Npb24oKS0+Zmxhc2goJ21lc3NhZ2UnLCAnQ3VycmVuY3kgRXZhbHVhdGlvbiBoYXMgYmVubiBkb25lIHN1Y2Nlc3NmdWxseS4nKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICAgICAgICAgIF0pOwogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gc2hvdygkbGVkZ2VyX2lkKQogICAgewogICAgICAgIHRyeXsKICAgICAgICAgICAgJGxlZGdlciA9IENoYXJ0T2ZBY2NvdW50OjpmaW5kT3JGYWlsKCRsZWRnZXJfaWQpOwogICAgICAgICAgICAkY3VycmVuY3kgPSBDdXJyZW5jeTo6ZmluZE9yRmFpbChyZXF1ZXN0KCktPmdldCgnY3VycmVuY3lfaWQnKSk7CgogICAgICAgICAgICAkbGFzdEV2YWx1YXRlZCA9IFVucmVhbGl6ZWRDdXJyZW5jeUV2ZW50OjpvcmRlckJ5KCdpZCcsICdkZXNjJyktPmZpcnN0KCk7CiAgICAgICAgICAgICRmcm9tID0gaXNzZXQoJGxhc3RFdmFsdWF0ZWQtPmlkKSA/ICRsYXN0RXZhbHVhdGVkLT5ydW5fZGF0ZSA6IGZhbHNlOwogICAgICAgICAgICAkdG8gPSByZXF1ZXN0KCktPmdldCgncnVuX2RhdGUnKTsKCiAgICAgICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAgICAgJ2xlZGdlcicgPT4gJGxlZGdlciwKICAgICAgICAgICAgICAgICdjdXJyZW5jeScgPT4gJGN1cnJlbmN5LAogICAgICAgICAgICAgICAgJ3N5c3RlbUN1cnJlbmN5JyA9PiBzeXN0ZW1DdXJyZW5jeSgpLAogICAgICAgICAgICAgICAgJ3VucmVhbGl6ZWRDdXJyZW5jeUV2ZW50U2V0dGluZ3MnID0+IHVucmVhbGl6ZWRDdXJyZW5jeUV2ZW50U2V0dGluZ3MoKSwKICAgICAgICAgICAgICAgICdydW5fZGF0ZScgPT4gZ2V0RXhjaGFuZ2VSYXRlcygkY3VycmVuY3ktPmlkLCByZXF1ZXN0KCktPmdldCgncnVuX2RhdGUnKSwgJzIzOjU5OjU5JyksCiAgICAgICAgICAgICAgICAnZW50cmllcycgPT4gRW50cnlJdGVtOjp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAnZW50cnkuZXhjaGFuZ2VSYXRlJywKICAgICAgICAgICAgICAgICAgICAnZW50cnkucHVyY2hhc2VPcmRlci5wdXJjaGFzZU9yZGVyLnJlbFN1cHBsaWVyUGF5bWVudHMucmVsU3VwcGxpZXJMZWRnZXJzJwogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlbigkdG8sIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCR0byl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2VudHJ5JywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHRvKXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2RhdGUnLCAnPD0nLCAkdG8pOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2NoYXJ0X29mX2FjY291bnRfaWQnLCAkbGVkZ2VyX2lkKQogICAgICAgICAgICAgICAgLT53aGVyZSgncmVhbGl6ZWQnLCAwKQogICAgICAgICAgICAgICAgLT5nZXQoKQogICAgICAgICAgICBdOwoKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiB1Y3dvcmRzKHJlcXVlc3QoKS0+Z2V0KCd0eXBlJykpLiIgRGV0YWlscyBmb3IgWyIuJGxlZGdlci0+Y29kZS4nXSAnLiRsZWRnZXItPm5hbWUuJywgQ3VycmVuY3k6ICcuJGN1cnJlbmN5LT5uYW1lLicsIFJ1biBkYXRlOiAnLnJlcXVlc3QoKS0+Z2V0KCdydW5fZGF0ZScpLAogICAgICAgICAgICAgICAgJ2NvbnRlbnQnID0+IHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy51bnJlYWxpemVkQ3VycmVuY3lFdmFsdWF0aW9uLmRldGFpbHMuJy5yZXF1ZXN0KCktPmdldCgndHlwZScpLCAkZGF0YSktPnJlbmRlcigpCiAgICAgICAgICAgIF0pOwogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICJXaG9vcHMhIiwKICAgICAgICAgICAgICAgICdjb250ZW50JyA9PiAkdGgtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICB9Cn0K