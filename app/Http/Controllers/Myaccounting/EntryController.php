<?php
bolt_decrypt( __FILE__ , 'AJ7Owx'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcTXlhY2NvdW50aW5nOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBBcHBcSW1wb3J0c1xFbnRyaWVzSW1wb3J0Owp1c2UgSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3Q7Cgp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXENvbXBhbnk7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcUHJvZml0Q2VudHJlOwp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXENvc3RDZW50cmU7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcRmlzY2FsWWVhcjsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xFbnRyeVR5cGU7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcVGFnOwp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXENoYXJ0T2ZBY2NvdW50Owp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXFN1YkxlZGdlcjsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xFbnRyeTsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xFbnRyeUFwcHJvdmFsOwp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEVudHJ5SXRlbTsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xFbnRyeUF0dGFjaG1lbnQ7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcU3VwcGxpZXJzOwp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXI7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcR3JuXEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbjsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xTdXBwbGllclBheW1lbnQ7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcU3VwcGxpZXJMZWRnZXJzOwp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEJhbmtBY2NvdW50Owp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEFkdmFuY2VDYXRlZ29yeTsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xQdXJjaGFzZVxQdXJjaGFzZU9yZGVyRW50cnk7Cgp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEN1cnJlbmN5VHlwZTsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDdXJyZW5jeTsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xFeGNoYW5nZVJhdGU7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcRmlzY2FsWWVhck9wZW5pbmc7Cgp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEFwcHJvdmFsTGV2ZWw7Cgp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEZpc2NhbFllYXJPcGVuaW5nRW50cnk7Cgp1c2UgQXBwLCBEQiwgRGF0YVRhYmxlczsKdXNlIElsbHVtaW5hdGVcU3VwcG9ydFxGYWNhZGVzXEF1dGg7CnVzZSBNYWF0d2Vic2l0ZVxFeGNlbFxGYWNhZGVzXEV4Y2VsOwoKY2xhc3MgRW50cnlDb250cm9sbGVyIGV4dGVuZHMgQ29udHJvbGxlcgp7CiAgICBwdWJsaWMgZnVuY3Rpb24gaGVhZGVyQ29sdW1ucygkdmFsdWUgPSAnJykKICAgIHsKICAgICAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgICAgIFsnU0wnLCAnU0wnXSwKICAgICAgICAgICAgWydkYXRlJywgJ2RhdGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydjb2RlJywgJ2NvZGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydyZWZlcmVuY2UnLCAncmVmZXJlbmNlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnc291cmNlJywgJ3NvdXJjZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2N1cnJlbmN5JywgJ2N1cnJlbmN5JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnZGViaXQnLCAnZGViaXQnLCAndGV4dC1yaWdodCddLAogICAgICAgICAgICBbJ2NyZWRpdCcsICdjcmVkaXQnLCAndGV4dC1yaWdodCddLAogICAgICAgICAgICBbJ25vdGVzJywgJ25vdGVzJywgJ3RleHQtcmlnaHQnXSwKICAgICAgICAgICAgWydtYW51YWwnLCAnbWFudWFsJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnb3B0aW9ucycsICdvcHRpb25zJywgJ3RleHQtY2VudGVyJ10KICAgICAgICApOwogICAgfQogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gaW5kZXgoKQogICAgewogICAgICAgIGlmIChyZXF1ZXN0KCktPmhhcygnZ2V0LWxlZGdlcnMnKSkgewogICAgICAgICAgICAkYWxsID0gZ2V0QWxsR3JvdXBBbmRMZWRnZXJzKGZhbHNlLCB0cnVlKTsKICAgICAgICAgICAgJGZpc2NhbFllYXIgPSBnZXRBY3RpdmVGaXNjYWxZZWFyKHJlcXVlc3QoKS0+Z2V0KCdjb21wYW55X2lkJykpOwogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ2NvYScgPT4gY2hhcnRPZkFjY291bnRzT3B0aW9ucyhbXSwgMCwgMCwgJGFsbCwgZmFsc2UsICcnLCBmYWxzZSwgW3JlcXVlc3QoKS0+Z2V0KCdjb21wYW55X2lkJyldLCB0cnVlLCBnZXRMZWRnZXJCYWxhbmNlcygkYWxsLCByZXF1ZXN0KCktPmdldCgnY29tcGFueV9pZCcpLCAkZmlzY2FsWWVhci0+aWQpKSwKICAgICAgICAgICAgICAgICdmeScgPT4gJGZpc2NhbFllYXIKICAgICAgICAgICAgXSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRwZXJtaXNzaW9ucyA9IFsKICAgICAgICAgICAgICAgICdyZXZlcnNlLWZpbmFuY2UtcG9zdGluZycgPT4gYXV0aCgpLT51c2VyKCktPmhhc1Blcm1pc3Npb25UbygncmV2ZXJzZS1maW5hbmNlLXBvc3RpbmcnKSwKICAgICAgICAgICAgICAgICdlbnRyeS1lZGl0JyA9PiBhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvblRvKCdlbnRyeS1lZGl0JyksCiAgICAgICAgICAgICAgICAnZW50cnktdmlldycgPT4gYXV0aCgpLT51c2VyKCktPmhhc1Blcm1pc3Npb25UbygnZW50cnktdmlldycpLAogICAgICAgICAgICBdOwogICAgICAgICAgICAKICAgICAgICAgICAgJGNvbXBhbmllcyA9IENvbXBhbnk6OmhhcygncHJvZml0Q2VudHJlcy5jb3N0Q2VudHJlcycpCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCd1c2VycycsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgndXNlcl9pZCcsIGF1dGgoKS0+dXNlcigpLT5pZCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5nZXQoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgICRjb21wYW55X2lkID0gcmVxdWVzdCgpLT5nZXQoJ2NvbXBhbnlfaWQnKSA+IDAgPyByZXF1ZXN0KCktPmdldCgnY29tcGFueV9pZCcpIDogJGNvbXBhbmllc1swXS0+aWQ7CiAgICAgICAgICAgIAogICAgICAgICAgICAkZmlzY2FsWWVhciA9IGdldEFjdGl2ZUZpc2NhbFllYXIoJGNvbXBhbnlfaWQpOwogICAgICAgICAgICAkZmlzY2FsX3llYXJfaWQgPSByZXF1ZXN0KCktPmdldCgnZmlzY2FsX3llYXJfaWQnKSA+IDAgPyByZXF1ZXN0KCktPmdldCgnZmlzY2FsX3llYXJfaWQnKSA6ICRmaXNjYWxZZWFyLT5pZDsKICAgICAgICAgICAgCiAgICAgICAgICAgICRmcm9tID0gIWVtcHR5KHJlcXVlc3QoKS0+Z2V0KCdmcm9tJykpID8gcmVxdWVzdCgpLT5nZXQoJ2Zyb20nKSA6ICRmaXNjYWxZZWFyLT5zdGFydDsKICAgICAgICAgICAgJHRvID0gIWVtcHR5KHJlcXVlc3QoKS0+Z2V0KCd0bycpKSA/IHJlcXVlc3QoKS0+Z2V0KCd0bycpIDogJGZpc2NhbFllYXItPmVuZDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICghcmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgIC8vICRhbGwgPSBnZXRBbGxHcm91cEFuZExlZGdlcnMoZmFsc2UsIHRydWUpOwogICAgICAgICAgICAgICAgLy8gJGN1cnJlbnRDT0EgPSBjaGFydE9mQWNjb3VudHNPcHRpb25zKFtdLCAwLCAwLCAkYWxsLCBmYWxzZSwgJycsIGZhbHNlLCBbJGNvbXBhbnlfaWRdLCB0cnVlLCBnZXRMZWRnZXJCYWxhbmNlcygkYWxsLCAkY29tcGFueV9pZCwgJGZpc2NhbF95ZWFyX2lkKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICRlbnRyeUFycmF5ID0gRW50cnk6OmpvaW4oJ2VudHJ5X2l0ZW1zJywgJ2VudHJ5X2l0ZW1zLmVudHJ5X2lkJywgJz0nLCAnZW50cmllcy5pZCcpCiAgICAgICAgICAgICAgICAtPmpvaW4oJ2Nvc3RfY2VudHJlcycsICdjb3N0X2NlbnRyZXMuaWQnLCAnPScsICdlbnRyeV9pdGVtcy5jb3N0X2NlbnRyZV9pZCcpCiAgICAgICAgICAgICAgICAtPmpvaW4oJ3Byb2ZpdF9jZW50cmVzJywgJ3Byb2ZpdF9jZW50cmVzLmlkJywgJz0nLCAnY29zdF9jZW50cmVzLnByb2ZpdF9jZW50cmVfaWQnKQogICAgICAgICAgICAgICAgLT5qb2luKCdjb21wYW5pZXMnLCAnY29tcGFuaWVzLmlkJywgJz0nLCAncHJvZml0X2NlbnRyZXMuY29tcGFueV9pZCcpCiAgICAgICAgICAgICAgICAtPmpvaW4oJ3VzZXJfY29tcGFuaWVzJywgJ3VzZXJfY29tcGFuaWVzLmNvbXBhbnlfaWQnLCAnPScsICdjb21wYW5pZXMuaWQnKQogICAgICAgICAgICAgICAgLT5qb2luKCdjaGFydF9vZl9hY2NvdW50cycsICdjaGFydF9vZl9hY2NvdW50cy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmNoYXJ0X29mX2FjY291bnRfaWQnKQogICAgICAgICAgICAgICAgLT5qb2luKCdjaGFydF9vZl9hY2NvdW50X3VzZXJzJywgJ2NoYXJ0X29mX2FjY291bnRfdXNlcnMuY2hhcnRfb2ZfYWNjb3VudF9pZCcsICc9JywgJ2NoYXJ0X29mX2FjY291bnRzLmlkJykKICAgICAgICAgICAgICAgIC0+am9pbignZW50cnlfdHlwZXMnLCAnZW50cnlfdHlwZXMuaWQnLCAnPScsICdlbnRyaWVzLmVudHJ5X3R5cGVfaWQnKQogICAgICAgICAgICAgICAgLT5qb2luKCdlbnRyeV90eXBlX2NvbXBhbmllcycsICdlbnRyeV90eXBlX2NvbXBhbmllcy5lbnRyeV90eXBlX2lkJywgJz0nLCAnZW50cnlfdHlwZXMuaWQnKQogICAgICAgICAgICAgICAgLT53aGVyZSgndXNlcl9jb21wYW5pZXMudXNlcl9pZCcsIGF1dGgoKS0+dXNlcigpLT5pZCkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2NoYXJ0X29mX2FjY291bnRfdXNlcnMudXNlcl9pZCcsIGF1dGgoKS0+dXNlcigpLT5pZCkKICAgICAgICAgICAgICAgIC0+d2hlcmVJbignZW50cnlfdHlwZV9jb21wYW5pZXMuY29tcGFueV9pZCcsIGF1dGgoKS0+dXNlcigpLT5jb21wYW5pZXMtPnBsdWNrKCdjb21wYW55X2lkJyktPnRvQXJyYXkoKSkKICAgICAgICAgICAgICAgIC0+d2hlbigkY29tcGFueV9pZCA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGNvbXBhbnlfaWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncHJvZml0X2NlbnRyZXMuY29tcGFueV9pZCcsICRjb21wYW55X2lkKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4ocmVxdWVzdCgpLT5nZXQoJ2VudHJ5X3R5cGVfaWQnKSA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZW50cmllcy5lbnRyeV90eXBlX2lkJywgcmVxdWVzdCgpLT5nZXQoJ2VudHJ5X3R5cGVfaWQnKSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKCRmaXNjYWxfeWVhcl9pZCA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGZpc2NhbF95ZWFyX2lkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2VudHJpZXMuZmlzY2FsX3llYXJfaWQnLCAkZmlzY2FsX3llYXJfaWQpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbihyZXF1ZXN0KCktPmdldCgnY3VycmVuY3lfaWQnKSA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5qb2luKCdleGNoYW5nZV9yYXRlcycsICdleGNoYW5nZV9yYXRlcy5pZCcsICc9JywgJ2VudHJpZXMuZXhjaGFuZ2VfcmF0ZV9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2V4Y2hhbmdlX3JhdGVzLmN1cnJlbmN5X2lkJywgcmVxdWVzdCgpLT5nZXQoJ2N1cnJlbmN5X2lkJykpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJpZXMuZGF0ZScsICc+PScsICRmcm9tKQogICAgICAgICAgICAgICAgLT53aGVyZSgnZW50cmllcy5kYXRlJywgJzw9JywgJHRvKQogICAgICAgICAgICAgICAgLT53aGVuKHJlcXVlc3QoKS0+Z2V0KCdkZWJpdF9sZWRnZXJfaWQnKSA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZW50cnlfaXRlbXMuY2hhcnRfb2ZfYWNjb3VudF9pZCcsIHJlcXVlc3QoKS0+Z2V0KCdkZWJpdF9sZWRnZXJfaWQnKSkKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnZW50cnlfaXRlbXMuZGViaXRfY3JlZGl0JywgJ0QnKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4ocmVxdWVzdCgpLT5nZXQoJ2RlYml0X3N1Yl9sZWRnZXJfaWQnKSA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZW50cnlfaXRlbXMuc3ViX2xlZGdlcl9pZCcsIHJlcXVlc3QoKS0+Z2V0KCdkZWJpdF9zdWJfbGVkZ2VyX2lkJykpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJ5X2l0ZW1zLmRlYml0X2NyZWRpdCcsICdEJyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKHJlcXVlc3QoKS0+Z2V0KCdjcmVkaXRfbGVkZ2VyX2lkJykgPiAwLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2VudHJ5X2l0ZW1zLmNoYXJ0X29mX2FjY291bnRfaWQnLCByZXF1ZXN0KCktPmdldCgnY3JlZGl0X2xlZGdlcl9pZCcpKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdlbnRyeV9pdGVtcy5kZWJpdF9jcmVkaXQnLCAnQycpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbihyZXF1ZXN0KCktPmdldCgnY3JlZGl0X3N1Yl9sZWRnZXJfaWQnKSA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZW50cnlfaXRlbXMuc3ViX2xlZGdlcl9pZCcsIHJlcXVlc3QoKS0+Z2V0KCdjcmVkaXRfc3ViX2xlZGdlcl9pZCcpKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdlbnRyeV9pdGVtcy5kZWJpdF9jcmVkaXQnLCAnQycpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbighZW1wdHkocmVxdWVzdCgpLT5nZXQoJ3N0YXR1cycpKSwgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZW4ocmVxdWVzdCgpLT5nZXQoJ3N0YXR1cycpID09ICdhcHByb3ZlZCcsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2VudHJpZXMuaXNfYXBwcm92ZWQnLCAnYXBwcm92ZWQnKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZW4ocmVxdWVzdCgpLT5nZXQoJ3N0YXR1cycpICE9ICdhcHByb3ZlZCcsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPmpvaW4oJ2VudHJ5X2FwcHJvdmFscycsICdlbnRyeV9hcHByb3ZhbHMuZW50cnlfaWQnLCAnPScsICdlbnRyaWVzLmlkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2FwcHJvdmFsX2xldmVscycsICdhcHByb3ZhbF9sZXZlbHMuaWQnLCAnPScsICdlbnRyeV9hcHByb3ZhbHMuYXBwcm92YWxfbGV2ZWxfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2FwcHJvdmFsX2xldmVscy5uYW1lJywgJ0xJS0UnLCAnJScgLiBleHBsb2RlKCctJywgcmVxdWVzdCgpLT5nZXQoJ3N0YXR1cycpKVswXSAuICclJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdlbnRyeV9hcHByb3ZhbHMuc3RhdHVzJywgJ0xJS0UnLCAnJScgLiAoaXNzZXQoZXhwbG9kZSgnLScsIHJlcXVlc3QoKS0+Z2V0KCdzdGF0dXMnKSlbMV0pID8gZXhwbG9kZSgnLScsIHJlcXVlc3QoKS0+Z2V0KCdzdGF0dXMnKSlbMV0gOiAnJykgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPnNlbGVjdCgnZW50cmllcy5pZCcpCiAgICAgICAgICAgICAgICAtPmRpc3RpbmN0KCkKICAgICAgICAgICAgICAgIC0+cGx1Y2soJ2lkJykKICAgICAgICAgICAgICAgIC0+dG9BcnJheSgpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+aGFzKCdlbnRyeV9jb2RlJykpIHsKICAgICAgICAgICAgICAgICRlbnRyeSA9IEVudHJ5Ojp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAnaXRlbXMuY29zdENlbnRyZS5wcm9maXRDZW50cmUuY29tcGFueScsCiAgICAgICAgICAgICAgICAgICAgJ2l0ZW1zLmNoYXJ0T2ZBY2NvdW50JywKICAgICAgICAgICAgICAgICAgICAnZmlzY2FsWWVhcicsCiAgICAgICAgICAgICAgICAgICAgJ2VudHJ5VHlwZScsCiAgICAgICAgICAgICAgICAgICAgJ2V4Y2hhbmdlUmF0ZS5jdXJyZW5jeScsCiAgICAgICAgICAgICAgICAgICAgJ2FwcHJvdmFscy5hcHByb3ZhbExldmVsJywKICAgICAgICAgICAgICAgIF0pLT53aGVyZSgnY29kZScsIHJlcXVlc3QoKS0+Z2V0KCdlbnRyeV9jb2RlJykpLT5maXJzdCgpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgJ2VudHJ5JyA9PiAkZW50cnksCiAgICAgICAgICAgICAgICAgICAgJ2FycmF5JyA9PiAkZW50cnlBcnJheSwKICAgICAgICAgICAgICAgICAgICAnZXhpc3RzJyA9PiBpbl9hcnJheSgkZW50cnktPmlkLCAkZW50cnlBcnJheSksCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+YWpheCgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gRGF0YVRhYmxlczo6b2YoCiAgICAgICAgICAgICAgICAgICAgRW50cnk6OndpdGgoWwogICAgICAgICAgICAgICAgICAgICAgICAnZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywKICAgICAgICAgICAgICAgICAgICAgICAgJ2VudHJ5VHlwZScsCiAgICAgICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUluKCdpZCcsICRlbnRyeUFycmF5KQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZW4oIWRhdGF0YWJsZU9yZGVyaW5nKCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyYnkoJ2lkJywgJ2Rlc2MnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAtPmFkZEluZGV4Q29sdW1uKCkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ2NvZGUnLCBmdW5jdGlvbiAoJGVudHJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgY2xhc3M9InRleHQtcHJpbWFyeSBtci0xIiBvbmNsaWNrPSJnZXRTaG9ydERldGFpbHMoJCh0aGlzKSkiIGRhdGEtaWQ9IicgLiAoJGVudHJ5LT5pZCkgLiAnIiBkYXRhLWVudHJ5LXR5cGU9IicgLiAoJGVudHJ5LT5lbnRyeVR5cGUtPm5hbWUpIC4gJyIgZGF0YS1jb2RlPSInIC4gKCRlbnRyeS0+Y29kZSkgLiAnIj4nIC4gJGVudHJ5LT5jb2RlIC4gJzwvYT4nOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkZW50cnkpIHVzZSAoJHBlcm1pc3Npb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkcGVybWlzc2lvbnNbJ2VudHJ5LXZpZXcnXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBjbGFzcz0idGV4dC1wcmltYXJ5IiB0YXJnZXQ9Il9ibGFuayIgaHJlZj0iJyAuIHVybCgnYWNjb3VudGluZy9lbnRyaWVzLycgLiAkZW50cnktPmlkKSAuICciPicgLiAkZW50cnktPm51bWJlciAuICc8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRlbnRyeS0+bnVtYmVyOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdudW1iZXInLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3JlZmVyZW5jZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlcmJ5KCdudW1iZXInLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3NvdXJjZScsIGZ1bmN0aW9uICgkZW50cnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRlbnRyeS0+bm90ZXM7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignc291cmNlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ25vdGVzJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdzb3VyY2UnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJCeSgnbm90ZXMnLCAkb3JkZXIpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2N1cnJlbmN5JywgZnVuY3Rpb24gKCRlbnRyeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGVudHJ5LT5leGNoYW5nZVJhdGUgPyAoJGVudHJ5LT5leGNoYW5nZVJhdGUtPmN1cnJlbmN5ID8gJGVudHJ5LT5leGNoYW5nZVJhdGUtPmN1cnJlbmN5LT5jb2RlIDogJycpIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignY3VycmVuY3knLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnY29kZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2N1cnJlbmN5JywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIEV4Y2hhbmdlUmF0ZTo6c2VsZWN0KCdjdXJyZW5jaWVzLmNvZGUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdjdXJyZW5jaWVzJywgJ2N1cnJlbmNpZXMuaWQnLCAnPScsICdleGNoYW5nZV9yYXRlcy5jdXJyZW5jeV9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdleGNoYW5nZV9yYXRlcy5pZCcsICdlbnRyaWVzLmV4Y2hhbmdlX3JhdGVfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ2RlYml0JywgZnVuY3Rpb24gKCRlbnRyeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3lzdGVtTW9uZXlGb3JtYXQoJGVudHJ5LT5kZWJpdCk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ2NyZWRpdCcsIGZ1bmN0aW9uICgkZW50cnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN5c3RlbU1vbmV5Rm9ybWF0KCRlbnRyeS0+Y3JlZGl0KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdtYW51YWwnLCBmdW5jdGlvbiAoJGVudHJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkZW50cnktPmlzX21hbnVhbCA9PSAxID8gJ1llcycgOiAnTm8nOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ29wdGlvbnMnLCBmdW5jdGlvbiAoJGVudHJ5KSB1c2UgKCRwZXJtaXNzaW9ucykgewogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRlbnRyeS0+aXNfYXBwcm92ZWQgPT0gJ2FwcHJvdmVkJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxhIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi1zdWNjZXNzIG1yLTEiIG9uY2xpY2s9ImVudHJ5QXBwcm92YWxIaXN0b3J5KCQodGhpcykpIiBkYXRhLWlkPSInIC4gKCRlbnRyeS0+aWQpIC4gJyI+QXBwcm92ZWQ8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zIC49ICc8YSBjbGFzcz0iYnRuIGJ0bi14cyBidG4td2FybmluZyBtci0xIiBvbmNsaWNrPSJlbnRyeUdsb2JhbEFwcHJvdmFsKCQodGhpcykpIiBkYXRhLWlkPSInIC4gKCRlbnRyeS0+aWQpIC4gJyI+UGVuZGluZzwvYT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHBlcm1pc3Npb25zWydyZXZlcnNlLWZpbmFuY2UtcG9zdGluZyddICYmICRlbnRyeS0+aXNfbWFudWFsID09IDEgJiYgJGVudHJ5LT5pc19yZXZlcnNlZCA9PSAwICYmICRlbnRyeS0+aXNfYXBwcm92ZWQgPT0gJ2FwcHJvdmVkJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnMgLj0gJzxhIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi1kYW5nZXIgbXQtMSBtYi0xIiBocmVmPSInIC4gdXJsKCdhY2NvdW50aW5nL2VudHJpZXMvJyAuICRlbnRyeS0+aWQgLiAnP3JldmVyc2UnKSAuICciPjxpIGNsYXNzPSJsYXMgbGEtcmV0d2VldCI+PC9pPiZuYnNwO1JldmVyc2U8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRwZXJtaXNzaW9uc1snZW50cnktZWRpdCddICYmICRlbnRyeS0+aXNfbWFudWFsID09IDEgJiYgJGVudHJ5LT5pc19yZXZlcnNlZCA9PSAwICYmICRlbnRyeS0+aXNfYXBwcm92ZWQgIT0gJ2FwcHJvdmVkJyAmJiAkZW50cnktPmNyZWF0ZWRfYnkgPT0gYXV0aCgpLT51c2VyKCktPmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucyAuPSAnPGEgY2xhc3M9ImJ0biBidG4teHMgYnRuLXN1Y2Nlc3MgbXQtMSBtYi0xIiBocmVmPSInIC4gdXJsKCdhY2NvdW50aW5nL2VudHJpZXMvJyAuICRlbnRyeS0+aWQgLiAnL2VkaXQnKSAuICciPjxpIGNsYXNzPSJsYXMgbGEtZWRpdCI+PC9pPiZuYnNwO0VkaXQ8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhY3Rpb25zOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5za2lwVG90YWxSZWNvcmRzKCkKICAgICAgICAgICAgICAgICAgICAtPnJhd0NvbHVtbnMoWydjb2RlJywgJ3JlZmVyZW5jZScsICdvcHRpb25zJywgJ25vdGVzJ10pCiAgICAgICAgICAgICAgICAgICAgLT50b0pzb24oKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5lbnRyaWVzLmluZGV4JywgWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAnRW50cmllcycsCiAgICAgICAgICAgICAgICAnY29tcGFuaWVzJyA9PiAkY29tcGFuaWVzLAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAnY29tcGFueV9pZCcgPT4gJGNvbXBhbnlfaWQsCiAgICAgICAgICAgICAgICAnZmlzY2FsX3llYXJfaWQnID0+ICRmaXNjYWxfeWVhcl9pZCwKICAgICAgICAgICAgICAgICdmcm9tJyA9PiAkZnJvbSwKICAgICAgICAgICAgICAgICd0bycgPT4gJHRvLAogICAgICAgICAgICAgICAgLy8gJ2N1cnJlbnRDT0EnID0+ICRjdXJyZW50Q09BLAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAnZW50cnlUeXBlcycgPT4gRW50cnlUeXBlOjp3aGVyZUhhcygnY29tcGFuaWVzLmNvbXBhbnkudXNlcnMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3VzZXJfaWQnLCBhdXRoKCktPnVzZXIoKS0+aWQpOwogICAgICAgICAgICAgICAgfSktPmdldCgpLAogICAgICAgICAgICAgICAgJ2Zpc2NhbFllYXJzJyA9PiBGaXNjYWxZZWFyOjphbGwoKSwKICAgICAgICAgICAgICAgICdjdXJyZW5jaWVzJyA9PiBDdXJyZW5jeTo6YWxsKCksCiAgICAgICAgICAgICAgICAnYXBwcm92YWxMZXZlbHMnID0+IEFwcHJvdmFsTGV2ZWw6OndoZXJlSW4oJ2lkJywgYXV0aCgpLT51c2VyKCktPmFwcHJvdmFscy0+cGx1Y2soJ2FwcHJvdmFsX2xldmVsX2lkJyktPnRvQXJyYXkoKSktPmdldCgpLAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPmhlYWRlckNvbHVtbnMoKSwKICAgICAgICAgICAgXSk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiBjcmVhdGUoKQogICAgewogICAgICAgIGlmIChyZXF1ZXN0KCktPmhhcygnZ2V0LXN1Yi1sZWRnZXJzJykpIHsKICAgICAgICAgICAgJHN1YkxlZGdlcnMgPSBTdWJMZWRnZXI6OndoZXJlKCdjaGFydF9vZl9hY2NvdW50X2lkJywgcmVxdWVzdCgpLT5nZXQoJ2NoYXJ0X29mX2FjY291bnRfaWQnKSkKICAgICAgICAgICAgICAgIC0+b3JkZXJCeSgnY29kZScsICdhc2MnKQogICAgICAgICAgICAgICAgLT5nZXQoKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ2NvdW50JyA9PiAkc3ViTGVkZ2Vycy0+Y291bnQoKSwKICAgICAgICAgICAgICAgICdzdWJfbGVkZ2VycycgPT4gJHN1YkxlZGdlcnMKICAgICAgICAgICAgXSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChyZXF1ZXN0KCktPmhhcygnY2xlYXItZW50cnktaXRlbXMnKSkgewogICAgICAgICAgICBzZXNzaW9uKCktPmZvcmdldCgnZW50cmllcy1pdGVtcycpOwogICAgICAgICAgICBzZXNzaW9uKCktPmZvcmdldCgnZW50cmllcy1lcnJvcnMnKTsKICAgICAgICAgICAgcmV0dXJuIHJlZGlyZWN0KCktPmJhY2soKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJGNvbXBhbnkgPSBDb21wYW55OjpoYXMoJ3Byb2ZpdENlbnRyZXMuY29zdENlbnRyZXMnKQogICAgICAgICAgICAgICAgLT53aGVyZSgnaWQnLCByZXF1ZXN0KCktPmdldCgnY29tcGFueScpKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygndXNlcnMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3VzZXJfaWQnLCBhdXRoKCktPnVzZXIoKS0+aWQpOwogICAgICAgICAgICAgICAgfSktPmZpcnN0KCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoIWlzc2V0KCRjb21wYW55LT5pZCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZWRpcmVjdCgnYWNjb3VudGluZy9lbnRyaWVzJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICRlbnRyeVR5cGUgPSBFbnRyeVR5cGU6OndoZXJlKCdsYWJlbCcsIHJlcXVlc3QoKS0+Z2V0KCd0eXBlJykpCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdjb21wYW5pZXMuY29tcGFueS51c2VycycsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgndXNlcl9pZCcsIGF1dGgoKS0+dXNlcigpLT5pZCk7CiAgICAgICAgICAgICAgICB9KS0+Zmlyc3QoKTsKICAgICAgICAgICAgaWYgKCFpc3NldCgkZW50cnlUeXBlLT5pZCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZWRpcmVjdCgnYWNjb3VudGluZy9lbnRyaWVzJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICRwdXJjaGFzZU9yZGVycyA9IFtdOwogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5nZXQoJ3R5cGUnKSA9PSAicGF5bWVudCIpIHsKICAgICAgICAgICAgICAgICRwdXJjaGFzZU9yZGVycyA9IFB1cmNoYXNlT3JkZXI6OndoZXJlKCdpc19jbG9zZWQnLCAwKS0+Z2V0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICAgICAkYWNjb3VudERlZmF1bHRTZXR0aW5ncyA9IGFjY291bnREZWZhdWx0U2V0dGluZ3MoKTsKICAgICAgICAgICAgJGFsbCA9IGdldEFsbEdyb3VwQW5kTGVkZ2VycygkZW50cnlUeXBlLT5pZCwgdHJ1ZSwgW10sIFskY29tcGFueS0+aWRdKTsKICAgICAgICAgICAgJGdldEFjdGl2ZUZpc2NhbFllYXIgPSBnZXRBY3RpdmVGaXNjYWxZZWFyKCRjb21wYW55LT5pZCk7CiAgICAgICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAnTmV3ICcgLiAkZW50cnlUeXBlLT5uYW1lIC4gJyBFbnRyeScsCiAgICAgICAgICAgICAgICAnYWNjb3VudERlZmF1bHRTZXR0aW5ncycgPT4gJGFjY291bnREZWZhdWx0U2V0dGluZ3MsCiAgICAgICAgICAgICAgICAnc3lzdGVtQ3VycmVuY3knID0+IHN5c3RlbUN1cnJlbmN5KCRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydjdXJyZW5jeV9pZCddLCAkYWNjb3VudERlZmF1bHRTZXR0aW5ncyksCiAgICAgICAgICAgICAgICAnY29tcGFueScgPT4gJGNvbXBhbnksCiAgICAgICAgICAgICAgICAnZW50cnlUeXBlJyA9PiAkZW50cnlUeXBlLAogICAgICAgICAgICAgICAgJ3RhZ3MnID0+IFRhZzo6YWxsKCksCiAgICAgICAgICAgICAgICAnZmlzY2FsWWVhcicgPT4gJGdldEFjdGl2ZUZpc2NhbFllYXIsCiAgICAgICAgICAgICAgICAnZmlzY2FsWWVhcnMnID0+IEZpc2NhbFllYXI6OndoZXJlSGFzKCdmaXNjYWxZZWFyT3BlbmluZ3MnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRjb21wYW55KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3N0YXR1cycsICdvcGVuZWQnKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdpc19hcHByb3ZlZCcsICdhcHByb3ZlZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2NvbXBhbnlfaWQnLCAkY29tcGFueS0+aWQpOwogICAgICAgICAgICAgICAgfSktPmdldCgpLAogICAgICAgICAgICAgICAgJ2N1cnJlbmN5VHlwZXMnID0+IEN1cnJlbmN5VHlwZTo6d2l0aChbJ2N1cnJlbmNpZXMnXSktPmdldCgpLAogICAgICAgICAgICAgICAgJ2Nvc3RDZW50cmVzJyA9PiBnZXRDb3N0Q2VudHJlcyh0cnVlLCAkY29tcGFueS0+aWQsIHRydWUpLAogICAgICAgICAgICAgICAgJ2NoYXJ0T2ZBY2NvdW50c09wdGlvbnMnID0+IGNoYXJ0T2ZBY2NvdW50c09wdGlvbnMoW10sIDAsIDAsICRhbGwsIGZhbHNlLCAneWVzJywgJGVudHJ5VHlwZS0+aWQsIFskY29tcGFueS0+aWRdLCB0cnVlLCBnZXRMZWRnZXJCYWxhbmNlcygkYWxsLCAkY29tcGFueS0+aWQsICRnZXRBY3RpdmVGaXNjYWxZZWFyLT5pZCkpLAogICAgICAgICAgICAgICAgJ3B1cmNoYXNlT3JkZXJzJyA9PiAkcHVyY2hhc2VPcmRlcnMsCiAgICAgICAgICAgICAgICAnc3VwcGxpZXJzJyA9PiBTdXBwbGllcnM6OndoZXJlSGFzKCdyZWxRdW90YXRpb25zLnJlbFB1cmNoYXNlT3JkZXInLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRwdXJjaGFzZU9yZGVycykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2lkJywgaXNzZXQoJHB1cmNoYXNlT3JkZXJzWzBdKSA/ICRwdXJjaGFzZU9yZGVycy0+cGx1Y2soJ2lkJyktPnRvQXJyYXkoKSA6IFtdKTsKICAgICAgICAgICAgICAgIH0pLT5nZXQoKSwKICAgICAgICAgICAgICAgICdhZHZhbmNlQ2F0ZWdvcmllcycgPT4gQWR2YW5jZUNhdGVnb3J5OjphbGwoKQogICAgICAgICAgICBdOwogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5lbnRyaWVzLmNyZWF0ZScsICRkYXRhKTsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHVibGljIGZ1bmN0aW9uIHVwbG9hZEV4Y2VsKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJHJlcXVlc3QtPnZhbGlkYXRlKFsKICAgICAgICAgICAgJ2NvbXBhbnlfaWQnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdlbnRyeV90eXBlX2lkJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnZXhjZWxfZmlsZScgPT4gJ3JlcXVpcmVkfG1pbWVzOnhscyx4bHN4JwogICAgICAgIF0pOwogICAgICAgIAogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRwYXRoID0gJHRoaXMtPmZpbGVVcGxvYWQoJHJlcXVlc3QtPmZpbGUoJ2V4Y2VsX2ZpbGUnKSwgJ3VwbG9hZC91cGxvYWQtZXhjZWxzJyk7CiAgICAgICAgICAgICRzaGVldHMgPSBFeGNlbDo6dG9BcnJheShuZXcgRW50cmllc0ltcG9ydCwgcHVibGljX3BhdGgoJHBhdGgpKTsKICAgICAgICAgICAgJHRoaXMtPmZpbGVEZWxldGUoJHBhdGgpOwogICAgICAgICAgICAKICAgICAgICAgICAgJGNvbXBhbnkgPSBDb21wYW55OjpmaW5kT3JGYWlsKCRyZXF1ZXN0LT5jb21wYW55X2lkKTsKICAgICAgICAgICAgCiAgICAgICAgICAgICRjb3N0Q2VudHJlcyA9IENvc3RDZW50cmU6OndoZXJlSGFzKCdwcm9maXRDZW50cmUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRyZXF1ZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnY29tcGFueV9pZCcsICRyZXF1ZXN0LT5jb21wYW55X2lkKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmVJbignY29tcGFueV9pZCcsIGF1dGgoKS0+dXNlcigpLT5jb21wYW5pZXMtPnBsdWNrKCdjb21wYW55X2lkJyktPnRvQXJyYXkoKSk7CiAgICAgICAgICAgIH0pLT5nZXQoKTsKICAgICAgICAgICAgJGNvbXBhbnlJZCA9ICRjb21wYW55LT5pZDsKICAgICAgICAgICAgJGNoYXJ0T2ZBY2NvdW50cyA9IENoYXJ0T2ZBY2NvdW50Ojp3aGVyZUhhcygnZW50cnlUeXBlcycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHJlcXVlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdlbnRyeV90eXBlX2lkJywgJHJlcXVlc3QtPmVudHJ5X3R5cGVfaWQpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygnY29tcGFuaWVzJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkY29tcGFueUlkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2NvbXBhbnlfaWQnLCAkY29tcGFueUlkKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlSW4oJ2NvbXBhbnlfaWQnLCBhdXRoKCktPnVzZXIoKS0+Y29tcGFuaWVzLT5wbHVjaygnY29tcGFueV9pZCcpLT50b0FycmF5KCkpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3VzZXJzJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCd1c2VyX2lkJywgYXV0aCgpLT51c2VyKCktPmlkKTsKICAgICAgICAgICAgICAgIH0pLT5nZXQoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgICRzdWJMZWRnZXJzID0gU3ViTGVkZ2VyOjp3aGVyZUluKCdjaGFydF9vZl9hY2NvdW50X2lkJywgJGNoYXJ0T2ZBY2NvdW50cy0+cGx1Y2soJ2lkJyktPnRvQXJyYXkoKSktPmdldCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgJGl0ZW1zID0gW107CiAgICAgICAgICAgICRlbnRyeUVycm9ycyA9IFtdOwogICAgICAgICAgICBpZiAoaXNzZXQoJHNoZWV0c1swXVswXSkpIHsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRzaGVldHNbMF0gYXMgJGtleSA9PiAkdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAkY29zdF9jZW50cmUgPSAkY29zdENlbnRyZXMtPndoZXJlKCdjb2RlJywgdHJpbSgkdmFsdWVbJ2Nvc3RfY2VudHJlX2NvZGUnXSkpLT5jb3VudCgpID4gMCA/ICRjb3N0Q2VudHJlcy0+d2hlcmUoJ2NvZGUnLCB0cmltKCR2YWx1ZVsnY29zdF9jZW50cmVfY29kZSddKSktPmZpcnN0KCkgOiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAkY2hhcnRfb2ZfYWNjb3VudCA9ICRjaGFydE9mQWNjb3VudHMtPndoZXJlKCdjb2RlJywgdHJpbSgkdmFsdWVbJ2NoYXJ0X29mX2FjY291bnRfY29kZSddKSktPmNvdW50CiAgICAgICAgICAgICAgICAgICAgKCkgPiAwID8gJGNoYXJ0T2ZBY2NvdW50cy0+d2hlcmUoJ2NvZGUnLCB0cmltKCR2YWx1ZVsnY2hhcnRfb2ZfYWNjb3VudF9jb2RlJ10pKS0+Zmlyc3QoKSA6IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICRzdWJfbGVkZ2VyID0gJHN1YkxlZGdlcnMtPndoZXJlKCdjaGFydF9vZl9hY2NvdW50X2lkJywgaXNzZXQoJGNoYXJ0X29mX2FjY291bnQtPmlkKSA/ICRjaGFydF9vZl9hY2NvdW50LT5pZCA6IDApLT53aGVyZSgnY29kZScsIHRyaW0oaXNzZXQoJHZhbHVlWydzdWJfbGVkZ2VyX2NvZGUnXSkgPyAkdmFsdWVbJ3N1Yl9sZWRnZXJfY29kZSddIDogJycpKS0+Y291bnQoKSA+IDAgPyAkc3ViTGVkZ2Vycy0+d2hlcmUoJ2NoYXJ0X29mX2FjY291bnRfaWQnLCBpc3NldCgkY2hhcnRfb2ZfYWNjb3VudC0+aWQpID8gJGNoYXJ0X29mX2FjY291bnQtPmlkIDogMCktPndoZXJlKCdjb2RlJywgdHJpbShpc3NldCgkdmFsdWVbJ3N1Yl9sZWRnZXJfY29kZSddKSA/ICR2YWx1ZVsnc3ViX2xlZGdlcl9jb2RlJ10gOiAnJykpLT5maXJzdCgpIDogZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRjb3N0X2NlbnRyZS0+aWQpICYmIGlzc2V0KCRjaGFydF9vZl9hY2NvdW50LT5pZCkgJiYgKCR2YWx1ZVsnZGViaXQnXSA+IDAgfHwgJHZhbHVlWydjcmVkaXQnXSA+IDApKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGl0ZW1zLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRjb3N0X2NlbnRyZS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfY29kZScgPT4gJGNvc3RfY2VudHJlLT5jb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX25hbWUnID0+ICRjb3N0X2NlbnRyZS0+bmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkY2hhcnRfb2ZfYWNjb3VudC0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9jb2RlJyA9PiAkY2hhcnRfb2ZfYWNjb3VudC0+Y29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X25hbWUnID0+ICRjaGFydF9vZl9hY2NvdW50LT5uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Yl9sZWRnZXJfaWQnID0+IGlzc2V0KCRzdWJfbGVkZ2VyLT5pZCkgPyAkc3ViX2xlZGdlci0+aWQgOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Yl9sZWRnZXJfY29kZScgPT4gaXNzZXQoJHN1Yl9sZWRnZXItPmNvZGUpID8gJHN1Yl9sZWRnZXItPmNvZGUgOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Yl9sZWRnZXJfbmFtZScgPT4gaXNzZXQoJHN1Yl9sZWRnZXItPm5hbWUpID8gJHN1Yl9sZWRnZXItPm5hbWUgOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAkdmFsdWVbJ2RlYml0J10gPiAwID8gJHZhbHVlWydkZWJpdCddIDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+ICR2YWx1ZVsnY3JlZGl0J10gPiAwID8gJHZhbHVlWydjcmVkaXQnXSA6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAkdmFsdWVbJ25hcnJhdGlvbiddLAogICAgICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzc2V0KCRjb3N0X2NlbnRyZS0+aWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRlbnRyeUVycm9ycywgJ0Nvc3QgQ2VudHJlIDxiPiMnIC4gdHJpbSgkdmFsdWVbJ2Nvc3RfY2VudHJlX2NvZGUnXSkgLiAnPC9iPiBub3QgYXZhaWxhYmxlIGZvciBDb21wYW55IDxiPiMnIC4gJGNvbXBhbnktPmNvZGUgLiAnPC9iPiBpbiBsaW5lIDxiPiMnIC4gJHZhbHVlWydzbCddIC4gJzwvYj4uJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNzZXQoJGNoYXJ0X29mX2FjY291bnQtPmlkKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkZW50cnlFcnJvcnMsICdMZWRnZXIgPGI+IycgLiB0cmltKCR2YWx1ZVsnY2hhcnRfb2ZfYWNjb3VudF9jb2RlJ10pIC4gJzwvYj4gbm90IGF2YWlsYWJsZSBmb3IgQ29tcGFueSA8Yj4jJyAuICRjb21wYW55LT5jb2RlIC4gJzwvYj4gaW4gbGluZSA8Yj4jJyAuICR2YWx1ZVsnc2wnXSAuICc8L2I+LicpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHZhbHVlWydkZWJpdCddIDw9IDAgJiYgJHZhbHVlWydjcmVkaXQnXSA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRlbnRyeUVycm9ycywgJ0JvdGggRGViaXQgJiBDcmVkaXQgQW1vdW50IGlzIGludmFsaWQgaW4gbGluZSA8L2I+IycgLiAkdmFsdWVbJ3NsJ10gLiAnLzxiPi4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHN5c3RlbURvdWJsZVZhbHVlKGNvbGxlY3QoJGl0ZW1zKS0+c3VtKCdkZWJpdCcpLCAyKSAhPSBzeXN0ZW1Eb3VibGVWYWx1ZShjb2xsZWN0KCRpdGVtcyktPnN1bSgnY3JlZGl0JyksIDIpKSB7CiAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRlbnRyeUVycm9ycywgJ0RlYml0ICYgQ3JlZGl0IEFtb3VudCBpcyBub3QgbWF0Y2hlZCEnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgc2Vzc2lvbigpLT5wdXQoJ2VudHJpZXMtaXRlbXMnLCAkaXRlbXMpOwogICAgICAgICAgICBzZXNzaW9uKCktPnB1dCgnZW50cmllcy1lcnJvcnMnLCAkZW50cnlFcnJvcnMpOwogICAgICAgICAgICAKICAgICAgICAgICAgc2Vzc2lvbigpLT5mbGFzaCgnYWxlcnQtdHlwZScsICdzdWNjZXNzJyk7CiAgICAgICAgICAgIHNlc3Npb24oKS0+Zmxhc2goJ21lc3NhZ2UnLCAiRXhjZWwgZmlsZSB1cGxvYWRlZCBzdWNjZXNzZnVsbHkuIik7CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgICAgICAgICAgXSk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KICAgICAgICAKICAgIH0KICAgIAogICAgcHVibGljIGZ1bmN0aW9uIHN0b3JlKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJHJlcXVlc3QtPnZhbGlkYXRlKFsKICAgICAgICAgICAgJ2Zpc2NhbF95ZWFyX2lkJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZC4qJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQuKicgPT4gJ3JlcXVpcmVkJywKICAgICAgICBdKTsKICAgICAgICAKICAgICAgICAkaXNfbWFudWFsID0gMTsKICAgICAgICAKICAgICAgICBpZiAoaXNzZXQoJHJlcXVlc3QtPmZvcm1fdHlwZSkgJiYgJHJlcXVlc3QtPmZvcm1fdHlwZSA9PSAnd2l0aF9wbycpIHsKICAgICAgICAgICAgJGlzX21hbnVhbCA9IDA7CiAgICAgICAgICAgICRyZXF1ZXN0LT52YWxpZGF0ZShbCiAgICAgICAgICAgICAgICAnc3VwcGxpZXJfaWQnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICAgICAncHVyY2hhc2Vfb3JkZXJfaWQnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICAgICAvKidpc19hZHZhbmNlJyA9PiAncmVxdWlyZWQnLCovCiAgICAgICAgICAgICAgICAnYWR2YW5jZV9jYXRlZ29yeV9pZCcgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvKgogICAgICAgICAgICBpZigkcmVxdWVzdC0+aXNfYWR2YW5jZSA9PSAxKXsKICAgICAgICAgICAgICAgICRyZXF1ZXN0LT52YWxpZGF0ZShbCiAgICAgICAgICAgICAgICAgICAgJ2FkdmFuY2VfY2F0ZWdvcnlfaWQnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfSovCiAgICAgICAgICAgIAogICAgICAgICAgICAkZHVlX2Ftb3VudCA9ICR0aGlzLT5nZXREdWVBbW91bnQoJHJlcXVlc3QtPnB1cmNoYXNlX29yZGVyX2lkKTsKICAgICAgICAgICAgaWYgKCRkdWVfYW1vdW50IDwgc3lzdGVtRG91YmxlVmFsdWUoJHRoaXMtPmFtb3VudCgkcmVxdWVzdClbJ2RlYml0J10sIDIpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiVG90YWwgVHJhbnNhY3Rpb24gQW1vdW50IGNhbm5vdCBiZSBncmVhdGVyIHRoYW4gRHVlIEFtb3VudCBvZiAiIC4gJGR1ZV9hbW91bnQKICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8qCiAgICAgICAgaWYoaXNzZXQoJHJlcXVlc3QtPmZvcm1fdHlwZSkgJiYgJHJlcXVlc3QtPmZvcm1fdHlwZSA9PSAnd2l0aG91dF9wbycpewogICAgICAgICAgICBpZigkcmVxdWVzdC0+d3Bfc3VwcGxpZXJfaWQgPiAwKXsKICAgICAgICAgICAgICAgICRpc19tYW51YWwgPSAwOwogICAgICAgICAgICAgICAgJHJlcXVlc3QtPnZhbGlkYXRlKFsKICAgICAgICAgICAgICAgICAgICAnaXNfYWR2YW5jZScgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgICAgICAgICAnYWR2YW5jZV9jYXRlZ29yeV9pZCcgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgIGlmKCRyZXF1ZXN0LT5pc19hZHZhbmNlID09IDEpewogICAgICAgICAgICAgICAgICAgICRyZXF1ZXN0LT52YWxpZGF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICdhZHZhbmNlX2NhdGVnb3J5X2lkJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSovCiAgICAgICAgCiAgICAgICAgaWYgKHN5c3RlbURvdWJsZVZhbHVlKCR0aGlzLT5hbW91bnQoJHJlcXVlc3QpWydkZWJpdCddLCAyKSA8PSAwIHx8IHN5c3RlbURvdWJsZVZhbHVlKCR0aGlzLT5hbW91bnQoJHJlcXVlc3QpWydjcmVkaXQnXSwgMikgPD0gMCkgewogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gIlBsZWFzZSBhZGQgc29tZSBEZWJpdCBvciBDcmVkaXQgYW1vdW50IgogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKHN5c3RlbURvdWJsZVZhbHVlKCR0aGlzLT5hbW91bnQoJHJlcXVlc3QpWydkZWJpdCddLCAyKSAhPSBzeXN0ZW1Eb3VibGVWYWx1ZSgkdGhpcy0+YW1vdW50KCRyZXF1ZXN0KVsnY3JlZGl0J10sIDIpKSB7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiRGViaXQgJiBDcmVkaXQgYW1vdW50IG11c3QgYmUgc2FtZSIKICAgICAgICAgICAgXSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIAogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJGZpc2NhbFllYXIgPSBGaXNjYWxZZWFyOjp3aXRoKFsKICAgICAgICAgICAgICAgICdmaXNjYWxZZWFyT3BlbmluZ3MnCiAgICAgICAgICAgIF0pLT5maW5kT3JGYWlsKCRyZXF1ZXN0LT5maXNjYWxfeWVhcl9pZCk7CiAgICAgICAgICAgIGlmICgoc3RydG90aW1lKGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRyZXF1ZXN0LT5kYXRldGltZSkpKSA8IHN0cnRvdGltZSgkZmlzY2FsWWVhci0+c3RhcnQpKSB8fCAoc3RydG90aW1lKGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRyZXF1ZXN0LT5kYXRldGltZSkpKSA+IHN0cnRvdGltZSgkZmlzY2FsWWVhci0+ZW5kKSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJEYXRldGltZSBpcyBub3QgaW4gdGhlIHJhbmdlIG9mIHRoZSBmaXNjYWwgeWVhciBwZXJpb2QuIgogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgICAgICAkaXRlbXMgPSBbXTsKICAgICAgICAgICAgaWYgKGlzc2V0KCRyZXF1ZXN0LT5jaGFydF9vZl9hY2NvdW50X2lkWzBdKSkgewogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHJlcXVlc3QtPmNoYXJ0X29mX2FjY291bnRfaWQgYXMgJGtleSA9PiAkY2hhcnRfb2ZfYWNjb3VudF9pZCkgewogICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGl0ZW1zLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJHJlcXVlc3QtPmNvc3RfY2VudHJlX2lkWyRrZXldLAogICAgICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJHJlcXVlc3QtPmNoYXJ0X29mX2FjY291bnRfaWRbJGtleV0sCiAgICAgICAgICAgICAgICAgICAgICAgICdzdWJfbGVkZ2VyX2lkJyA9PiBpc3NldCgkcmVxdWVzdC0+c3ViX2xlZGdlcnNbJGtleV0pID8gJHJlcXVlc3QtPnN1Yl9sZWRnZXJzWyRrZXldIDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAkcmVxdWVzdC0+ZGViaXRbJGtleV0sCiAgICAgICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+ICRyZXF1ZXN0LT5jcmVkaXRbJGtleV0sCiAgICAgICAgICAgICAgICAgICAgICAgICdhbW91bnQnID0+ICgkcmVxdWVzdC0+ZGViaXRbJGtleV0gPiAwID8gJHJlcXVlc3QtPmRlYml0WyRrZXldIDogJHJlcXVlc3QtPmNyZWRpdFska2V5XSksCiAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdF9jcmVkaXQnID0+ICgkcmVxdWVzdC0+ZGViaXRbJGtleV0gPiAwID8gJ0QnIDogJ0MnKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJHJlcXVlc3QtPm5hcnJhdGlvblska2V5XSwKICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgJGVudHJ5VHlwZSA9IEVudHJ5VHlwZTo6d2hlcmUoJ2xhYmVsJywgcmVxdWVzdCgpLT5nZXQoJ3R5cGUnKSktPmZpcnN0KCk7CiAgICAgICAgICAgICRjb21wYW55ID0gQ29tcGFueTo6d2hlcmUoJ2lkJywgcmVxdWVzdCgpLT5nZXQoJ2NvbXBhbnknKSktPmZpcnN0KCk7CiAgICAgICAgICAgICRlbnRyeSA9IHNhdmVMZWRnZXJFbnRyaWVzKCRlbnRyeVR5cGUtPmlkLCAkcmVxdWVzdC0+ZGF0ZXRpbWUsIDEsICRyZXF1ZXN0LT5udW1iZXIsICRyZXF1ZXN0LT5ub3RlcywgJGl0ZW1zLCBnZXRFeGNoYW5nZVJhdGVzKCRyZXF1ZXN0LT5jdXJyZW5jeV9pZCwgZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPmRhdGV0aW1lKSksIGRhdGUoJ0g6aTpzJywgc3RydG90aW1lKCRyZXF1ZXN0LT5kYXRldGltZSkpKVsncmF0ZSddLT5pZCwgMSwgJHJlcXVlc3QtPmFkdmFuY2VfY2F0ZWdvcnlfaWQsICRpc19tYW51YWwsICRjb21wYW55LT5pZCwgJGZpc2NhbFllYXIpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGlzc2V0KCRlbnRyeVsnc3VjY2VzcyddKSAmJiAkZW50cnlbJ3N1Y2Nlc3MnXSkgewogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRyZXF1ZXN0LT5mb3JtX3R5cGUpICYmICRyZXF1ZXN0LT5mb3JtX3R5cGUgPT0gJ3dpdGhfcG8nKSB7CiAgICAgICAgICAgICAgICAgICAgJHB1cmNoYXNlT3JkZXIgPSBQdXJjaGFzZU9yZGVyOjpmaW5kT3JGYWlsKCRyZXF1ZXN0LT5wdXJjaGFzZV9vcmRlcl9pZCk7CiAgICAgICAgICAgICAgICAgICAgJHBheW1lbnQgPSBTdXBwbGllclBheW1lbnQ6OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICdzdXBwbGllcl9pZCcgPT4gJHJlcXVlc3QtPnN1cHBsaWVyX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAncHVyY2hhc2Vfb3JkZXJfaWQnID0+ICRyZXF1ZXN0LT5wdXJjaGFzZV9vcmRlcl9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ3RyYW5zZWN0aW9uX2RhdGUnID0+IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRyZXF1ZXN0LT5kYXRldGltZSkpLAogICAgICAgICAgICAgICAgICAgICAgICAndHJhbnNlY3Rpb25fdHlwZScgPT4gJ3B1cmNoYXNlJywKICAgICAgICAgICAgICAgICAgICAgICAgJ2V4Y2hhbmdlX3JhdGVfaWQnID0+ICRwdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlX3JhdGVfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdiaWxsX251bWJlcicgPT4gJHB1cmNoYXNlT3JkZXItPnJlZmVyZW5jZV9ubywKICAgICAgICAgICAgICAgICAgICAgICAgJ2JpbGxfYW1vdW50JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAncGF5X2Ftb3VudCcgPT4gJHRoaXMtPmFtb3VudCgkcmVxdWVzdClbJ2RlYml0J10sCiAgICAgICAgICAgICAgICAgICAgICAgICdwYXlfZGF0ZScgPT4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPmRhdGV0aW1lKSksCiAgICAgICAgICAgICAgICAgICAgICAgIC8qJ2JpbGxfdHlwZScgPT4gKCRyZXF1ZXN0LT5pc19hZHZhbmNlID09IDEgPyAncG8tYWR2YW5jZScgOiAncG8nKSwqLwogICAgICAgICAgICAgICAgICAgICAgICAnYmlsbF90eXBlJyA9PiAncG8tYWR2YW5jZScsCiAgICAgICAgICAgICAgICAgICAgICAgICdzdGF0dXMnID0+ICdwZW5kaW5nJwogICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICRwYXltZW50SW5mbyA9ICR0aGlzLT5jaGVja1BheW1lbnRUeXBlKCRyZXF1ZXN0KTsKICAgICAgICAgICAgICAgICAgICAkc3VwcGxpZXJMZWRnZXIgPSBzYXZlU3VwcGxpZXJMZWRnZXIoJHJlcXVlc3QtPnN1cHBsaWVyX2lkLCBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkcmVxdWVzdC0+ZGF0ZXRpbWUpKSwgJHRoaXMtPmFtb3VudCgkcmVxdWVzdClbJ2RlYml0J10sIDAsICRwYXltZW50SW5mb1sncGF5bWVudF90eXBlJ10sICRyZXF1ZXN0LT5ub3RlcywgJHJlcXVlc3QtPm5vdGVzLCAkcGF5bWVudEluZm9bJ2JhbmtfYWNjb3VudF9pZCddLCAkcGF5bWVudC0+aWQsICRwdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlX3JhdGVfaWQsICRlbnRyeVsnZW50cnknXS0+aWQpOwogICAgICAgICAgICAgICAgICAgIC8qc2F2ZVBPRW50cnkoJGVudHJ5LCAkcmVxdWVzdC0+c3VwcGxpZXJfaWQsICRyZXF1ZXN0LT5wdXJjaGFzZV9vcmRlcl9pZCwgKCRyZXF1ZXN0LT5pc19hZHZhbmNlID09IDEgPyAnYWR2YW5jZScgOiAnc3VwcGxpZXItcGF5bWVudCcpKTsqLwogICAgICAgICAgICAgICAgICAgIHNhdmVQT0VudHJ5KCRlbnRyeSwgJHJlcXVlc3QtPnN1cHBsaWVyX2lkLCAkcmVxdWVzdC0+cHVyY2hhc2Vfb3JkZXJfaWQsICdhZHZhbmNlJyk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKCRwYXltZW50SW5mb1sncGF5bWVudF90eXBlJ10gPT0gJ2NoZXF1ZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZUNoZXF1ZSgkcGF5bWVudEluZm9bJ2JhbmtfYWNjb3VudF9pZCddLCAkZW50cnlbJ2VudHJ5J10tPmlkLCAkc3VwcGxpZXJMZWRnZXItPmlkLCAkcmVxdWVzdC0+ZGF0ZXRpbWUsICdzdXBwbGllci1wYXltZW50JywgJHBheW1lbnRJbmZvWydwYXltZW50X3R5cGUnXSwgJGVudHJ5WydlbnRyeSddLT5udW1iZXIsICdDJywgJHRoaXMtPmFtb3VudCgkcmVxdWVzdClbJ2RlYml0J10pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZWlmIChpc3NldCgkcmVxdWVzdC0+Zm9ybV90eXBlKSAmJiAkcmVxdWVzdC0+Zm9ybV90eXBlID09ICd3aXRob3V0X3BvJykgewogICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgJHBheW1lbnRJbmZvID0gJHRoaXMtPmNoZWNrUGF5bWVudFR5cGUoJHJlcXVlc3QpOwogICAgICAgICAgICAgICAgICAgICRzdXBwbGllckxlZGdlciA9IHNhdmVTdXBwbGllckxlZGdlcigkcmVxdWVzdC0+d3Bfc3VwcGxpZXJfaWQsICRyZXF1ZXN0LT5kYXRlLCAkdGhpcy0+YW1vdW50KCRyZXF1ZXN0KVsnZGViaXQnXSwgMCwgJHBheW1lbnRJbmZvWydwYXltZW50X3R5cGUnXSwgJHJlcXVlc3QtPm5vdGVzLCAkcmVxdWVzdC0+bm9ldHMsICRwYXltZW50SW5mb1snYmFua19hY2NvdW50X2lkJ10pOwoKICAgICAgICAgICAgICAgICAgICBpZigkcGF5bWVudEluZm9bJ3BheW1lbnRfdHlwZSddID09ICdjaGVxdWUnKXsKICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZUNoZXF1ZSgkcGF5bWVudEluZm9bJ2JhbmtfYWNjb3VudF9pZCddLCAkZW50cnlbJ2VudHJ5J10tPmlkLCAkc3VwcGxpZXJMZWRnZXItPmlkLCBkYXRlKCdZLW0tZCBIOmk6cycsIHN0cnRvdGltZSgkcmVxdWVzdC0+ZGF0ZS4nICcuJHJlcXVlc3QtPnRpbWUpKSwgJ3N1cHBsaWVyLXBheW1lbnQnLCAkcGF5bWVudEluZm9bJ3BheW1lbnRfdHlwZSddLCAkZW50cnlbJ2VudHJ5J10tPm51bWJlciwgJ0MnLCAkdGhpcy0+YW1vdW50KCRyZXF1ZXN0KVsnZGViaXQnXSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICRhdHRhY2htZW50cyA9IFtdOwogICAgICAgICAgICAgICAgaWYgKCRyZXF1ZXN0LT5oYXNGaWxlKCdmaWxlcycpKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHJlcXVlc3QtPmZpbGUoJ2ZpbGVzJykgYXMgJGtleSA9PiAkZmlsZSkgewogICAgICAgICAgICAgICAgICAgICAgICAkZmlsZUluZm8gPSAkdGhpcy0+ZmlsZUluZm8oJGZpbGUpOwogICAgICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRhdHRhY2htZW50cywgWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2VudHJ5X2lkJyA9PiAkZW50cnlbJ2VudHJ5J10tPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hbWUnID0+ICRmaWxlSW5mb1snbmFtZSddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICRmaWxlSW5mb1sndHlwZSddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3NpemUnID0+ICRmaWxlSW5mb1snc2l6ZSddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BhdGgnID0+ICR0aGlzLT5maWxlVXBsb2FkKCRmaWxlLCAndXBsb2FkL2VudHJ5LWF0dGFjaG1lbnRzJyksCiAgICAgICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRhdHRhY2htZW50c1swXSkpIHsKICAgICAgICAgICAgICAgICAgICBFbnRyeUF0dGFjaG1lbnQ6Omluc2VydCgkYXR0YWNobWVudHMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZXNzaW9uKCktPmZvcmdldCgnZW50cmllcy1pdGVtcycpOwogICAgICAgICAgICAgICAgc2Vzc2lvbigpLT5mb3JnZXQoJ2VudHJpZXMtZXJyb3JzJyk7CiAgICAgICAgICAgICAgICBEQjo6Y29tbWl0KCk7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICRlbnRyeVsnbWVzc2FnZSddLAogICAgICAgICAgICAgICAgICAgICdpZCcgPT4gJGVudHJ5WydlbnRyeSddLT5pZCwKICAgICAgICAgICAgICAgICAgICAnY29kZScgPT4gJGVudHJ5WydlbnRyeSddLT5jb2RlLAogICAgICAgICAgICAgICAgICAgICdlbnRyeV90eXBlJyA9PiAkZW50cnlbJ2VudHJ5J10tPmVudHJ5VHlwZS0+bmFtZSwKICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkZW50cnlbJ21lc3NhZ2UnXQogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHVibGljIGZ1bmN0aW9uIGNoZWNrUGF5bWVudFR5cGUoJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJGNoYXJ0X29mX2FjY291bnRfaWQgPSAwOwogICAgICAgIGZvcmVhY2ggKCRyZXF1ZXN0LT5jcmVkaXQgYXMgJGtleSA9PiAkY3JlZGl0KSB7CiAgICAgICAgICAgIGlmICgkY3JlZGl0ID4gMCkgewogICAgICAgICAgICAgICAgJGNoYXJ0X29mX2FjY291bnRfaWQgPSAkcmVxdWVzdC0+Y2hhcnRfb2ZfYWNjb3VudF9pZFska2V5XTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAkcGF5bWVudF90eXBlID0gJ2Nhc2gnOwogICAgICAgICRiYW5rQWNjb3VudCA9IEJhbmtBY2NvdW50Ojp3aGVyZSgnY2hhcnRfb2ZfYWNjb3VudF9pZCcsICRjaGFydF9vZl9hY2NvdW50X2lkKS0+Zmlyc3QoKTsKICAgICAgICBpZiAoJGNoYXJ0X29mX2FjY291bnRfaWQgPiAwICYmIGlzc2V0KCRiYW5rQWNjb3VudC0+aWQpKSB7CiAgICAgICAgICAgICRwYXltZW50X3R5cGUgPSAnY2hlcXVlJzsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgJ3BheW1lbnRfdHlwZScgPT4gJHBheW1lbnRfdHlwZSwKICAgICAgICAgICAgJ2JhbmtfYWNjb3VudF9pZCcgPT4gaXNzZXQoJGJhbmtBY2NvdW50LT5pZCkgPyAkYmFua0FjY291bnQtPmlkIDogMCwKICAgICAgICBdOwogICAgfQogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gc2hvdygkaWQpCiAgICB7CiAgICAgICAgaWYgKHJlcXVlc3QoKS0+aGFzKCdhcHByb3ZhbCcpKSB7CiAgICAgICAgICAgIHJldHVybiB2aWV3KCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMuZW50cmllcy5hcHByb3ZhbCcsIFsKICAgICAgICAgICAgICAgICdhcHByb3ZhbCcgPT4gRW50cnlBcHByb3ZhbDo6d2l0aChbCiAgICAgICAgICAgICAgICAgICAgJ2FwcHJvdmFsTGV2ZWwnLAogICAgICAgICAgICAgICAgICAgICdlbnRyeS5maXNjYWxZZWFyJywKICAgICAgICAgICAgICAgICAgICAnZW50cnkuZW50cnlUeXBlJywKICAgICAgICAgICAgICAgICAgICAnZW50cnkuZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JwogICAgICAgICAgICAgICAgXSktPmZpbmRPckZhaWwocmVxdWVzdCgpLT5nZXQoJ2lkJykpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAocmVxdWVzdCgpLT5oYXMoJ2dsb2JhbC1hcHByb3ZhbCcpKSB7CiAgICAgICAgICAgIHJldHVybiB2aWV3KCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMuZW50cmllcy5nbG9iYWwtYXBwcm92YWwnLCBbCiAgICAgICAgICAgICAgICAnZW50cnknID0+IEVudHJ5Ojp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAnZmlzY2FsWWVhcicsCiAgICAgICAgICAgICAgICAgICAgJ2VudHJ5VHlwZScsCiAgICAgICAgICAgICAgICAgICAgJ2V4Y2hhbmdlUmF0ZS5jdXJyZW5jeScKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAgICAgLT5maW5kKHJlcXVlc3QoKS0+Z2V0KCdpZCcpKSwKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgJ2FwcHJvdmFscycgPT4gRW50cnlBcHByb3ZhbDo6d2l0aChbCiAgICAgICAgICAgICAgICAgICAgJ2FwcHJvdmFsTGV2ZWwnLAogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdhcHByb3ZhbExldmVsLnVzZXJzJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgndXNlcl9pZCcsIGF1dGgoKS0+dXNlcigpLT5pZCk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdlbnRyeV9pZCcsIHJlcXVlc3QoKS0+Z2V0KCdpZCcpKQogICAgICAgICAgICAgICAgICAgIC0+Z2V0KCksCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAocmVxdWVzdCgpLT5oYXMoJ2FwcHJvdmFsLWhpc3RvcnknKSkgewogICAgICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLmVudHJpZXMuYXBwcm92YWwtaGlzdG9yeScsIFsKICAgICAgICAgICAgICAgICdlbnRyeScgPT4gRW50cnk6OndpdGgoWwogICAgICAgICAgICAgICAgICAgICdhcHByb3ZhbHMuYXBwcm92YWxMZXZlbCcsCiAgICAgICAgICAgICAgICAgICAgJ2Zpc2NhbFllYXInLAogICAgICAgICAgICAgICAgICAgICdlbnRyeVR5cGUnLAogICAgICAgICAgICAgICAgICAgICdleGNoYW5nZVJhdGUuY3VycmVuY3knCiAgICAgICAgICAgICAgICBdKS0+ZmluZE9yRmFpbCgkaWQpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAocmVxdWVzdCgpLT5oYXMoJ3NvdXJjZScpKSB7CiAgICAgICAgICAgIHJldHVybiB2aWV3KCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMuZW50cmllcy5zb3VyY2UnLCBbCiAgICAgICAgICAgICAgICAnaXRlbScgPT4gRW50cnlJdGVtOjpmaW5kT3JGYWlsKCRpZCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChyZXF1ZXN0KCktPmhhcygnZ2V0LXB1cmNoYXNlLW9yZGVycycpKSB7CiAgICAgICAgICAgICRvcmRlcnMgPSBQdXJjaGFzZU9yZGVyOjp3aGVuKCRpZCA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGlkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUXVvdGF0aW9uJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkaWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnc3VwcGxpZXJfaWQnLCAkaWQpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pLT5nZXQoKTsKICAgICAgICAgICAgJGFjY291bnREZWZhdWx0U2V0dGluZ3MgPSBhY2NvdW50RGVmYXVsdFNldHRpbmdzKCk7CiAgICAgICAgICAgICRwdXJjaGFzZU9yZGVycyA9ICc8b3B0aW9uIHZhbHVlPSIwIiBkYXRhLWRlYml0LWFjY291bnQ9IicgLiAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snc3VwcGxpZXJfYWR2YW5jZV9hY2NvdW50J10gLiAnIiBkYXRhLWNyZWRpdC1hY2NvdW50PSInIC4gJGFjY291bnREZWZhdWx0U2V0dGluZ3NbJ3N1cHBsaWVyX2FkdmFuY2VfYWNjb3VudCddIC4gJyIgZGF0YS1ncm9zcy1hbW91bnQ9IicgLiBzeXN0ZW1Eb3VibGVWYWx1ZSgwLCAyKSAuICciIGRhdGEtcGFpZC1hbW91bnQ9IicgLiBzeXN0ZW1Eb3VibGVWYWx1ZSgwLCAyKSAuICciIGRhdGEtZHVlLWFtb3VudD0iJyAuIHN5c3RlbURvdWJsZVZhbHVlKDAsIDIpIC4gJyIgZGF0YS1zdXBwbGllci1pZD0iIj5DaG9vc2UgUHVyY2hhc2Ugb3JkZXI8L29wdGlvbj4nOwogICAgICAgICAgICBpZiAoaXNzZXQoJG9yZGVyc1swXSkpIHsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRvcmRlcnMgYXMgJGtleSA9PiAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAkc3VwcGxpZXIgPSAkb3JkZXItPnJlbFF1b3RhdGlvbi0+cmVsU3VwcGxpZXJzOwogICAgICAgICAgICAgICAgICAgICRhZHZhbmNlX2FjY291bnQgPSAoaXNzZXQoJHN1cHBsaWVyLT5hZHZhbmNlX2FjY291bnRfaWQpICYmICRzdXBwbGllci0+YWR2YW5jZV9hY2NvdW50X2lkID4gMCA/ICRzdXBwbGllci0+YWR2YW5jZV9hY2NvdW50X2lkIDogJGFjY291bnREZWZhdWx0U2V0dGluZ3NbJ3N1cHBsaWVyX2FkdmFuY2VfYWNjb3VudCddKTsKICAgICAgICAgICAgICAgICAgICAkcGF5YWJsZV9hY2NvdW50ID0gKGlzc2V0KCRzdXBwbGllci0+cGF5YWJsZV9hY2NvdW50X2lkKSAmJiAkc3VwcGxpZXItPnBheWFibGVfYWNjb3VudF9pZCA+IDAgPyAkc3VwcGxpZXItPnBheWFibGVfYWNjb3VudF9pZCA6ICRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydzdXBwbGllcl9wYXlhYmxlX2FjY291bnQnXSk7CiAgICAgICAgICAgICAgICAgICAgJGNyZWRpdF9hY2NvdW50ID0gJGFjY291bnREZWZhdWx0U2V0dGluZ3NbJ2Nhc2hfaW5faGFuZF9hY2NvdW50J107CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgJHB1cmNoYXNlT3JkZXJzIC49ICc8b3B0aW9uIHZhbHVlPSInIC4gJG9yZGVyLT5pZCAuICciIGRhdGEtYWR2YW5jZS1hY2NvdW50PSInIC4gJGFkdmFuY2VfYWNjb3VudCAuICciIGRhdGEtcGF5YWJsZS1hY2NvdW50PSInIC4gJHBheWFibGVfYWNjb3VudCAuICciIGRhdGEtY3JlZGl0LWFjY291bnQ9IicgLiAkY3JlZGl0X2FjY291bnQgLiAnIiBkYXRhLWdyb3NzLWFtb3VudD0iJyAuIHN5c3RlbURvdWJsZVZhbHVlKCRvcmRlci0+Z3Jvc3NfcHJpY2UsIDIpIC4gJyIgZGF0YS1wYWlkLWFtb3VudD0iJyAuIHN5c3RlbURvdWJsZVZhbHVlKDAsIDIpIC4gJyIgZGF0YS1kdWUtYW1vdW50PSInIC4gc3lzdGVtRG91YmxlVmFsdWUoMCwgMikgLiAnIiBkYXRhLXN1cHBsaWVyLWlkPSInIC4gJG9yZGVyLT5yZWxRdW90YXRpb24tPnN1cHBsaWVyX2lkIC4gJyI+JyAuICRvcmRlci0+cmVmZXJlbmNlX25vIC4gJyZuYnNwO3wmbmJzcDsnIC4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJG9yZGVyLT5wb19kYXRlKSkgLiAnPC9vcHRpb24+JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ29yZGVycycgPT4gJHB1cmNoYXNlT3JkZXJzCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAkZW50cnkgPSBFbnRyeTo6d2l0aChbCiAgICAgICAgICAgICdlbnRyeVR5cGUnLAogICAgICAgICAgICAnZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywKICAgICAgICAgICAgJ2Zpc2NhbFllYXInLAogICAgICAgICAgICAnaXRlbXMuY2hhcnRPZkFjY291bnQuYWNjb3VudEdyb3VwJywKICAgICAgICAgICAgJ2l0ZW1zLnN1YkxlZGdlcicsCiAgICAgICAgICAgICdpdGVtcy5jb3N0Q2VudHJlLnByb2ZpdENlbnRyZS5jb21wYW55JywKICAgICAgICAgICAgJ2FwcHJvdmFscy5hcHByb3ZhbExldmVsJywKICAgICAgICAgICAgJ2FwcHJvdmFscy51c2VyJywKICAgICAgICAgICAgJ2F0dGFjaG1lbnRzJywKICAgICAgICAgICAgJ2xvZ3MnCiAgICAgICAgXSktPmZpbmRPckZhaWwoJGlkKTsKICAgICAgICAkc3lzdGVtQ3VycmVuY3kgPSBzeXN0ZW1DdXJyZW5jeSgpOwogICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAndGl0bGUnID0+ICRlbnRyeS0+ZW50cnlUeXBlLT5uYW1lIC4gJyBWb3VjaGVyICMnIC4gJGVudHJ5LT5jb2RlLAogICAgICAgICAgICAnZW50cnknID0+ICRlbnRyeSwKICAgICAgICAgICAgJ2N1cnJlbmN5JyA9PiAkZW50cnktPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPmNvZGUsCiAgICAgICAgICAgICdzeXN0ZW1DdXJyZW5jeScgPT4gJHN5c3RlbUN1cnJlbmN5LAogICAgICAgICAgICAnc2FtZScgPT4gKCRlbnRyeS0+ZXhjaGFuZ2VSYXRlLT5jdXJyZW5jeV9pZCA9PSAkc3lzdGVtQ3VycmVuY3ktPmlkID8gdHJ1ZSA6IGZhbHNlKSwKICAgICAgICAgICAgJ2V4Y2hhbmdlUmF0ZScgPT4gZXhjaGFuZ2VSYXRlKCRlbnRyeS0+ZXhjaGFuZ2VSYXRlLCAkc3lzdGVtQ3VycmVuY3ktPmlkKSwKICAgICAgICAgICAgJ2FwcHJvdmFscycgPT4gYXV0aCgpLT51c2VyKCktPmFwcHJvdmFscy0+cGx1Y2soJ2FwcHJvdmFsX2xldmVsX2lkJyktPnRvQXJyYXkoKQogICAgICAgIF07CiAgICAgICAgCiAgICAgICAgaWYgKHJlcXVlc3QoKS0+aGFzKCdyZXZlcnNlJykpIHsKICAgICAgICAgICAgaWYgKCRlbnRyeS0+aXNfbWFudWFsID09IDAgfHwgJGVudHJ5LT5pc19yZXZlcnNlZCA9PSAxKSB7CiAgICAgICAgICAgICAgICBzZXNzaW9uKCktPmZsYXNoKCdhbGVydC10eXBlJywgJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICBzZXNzaW9uKCktPmZsYXNoKCdtZXNzYWdlJywgJ1RoaXMgVHJhbnNhY3Rpb24gY2Fubm90IGJlIHJldmVyc2VkIScpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlZGlyZWN0KCdhY2NvdW50aW5nL2VudHJpZXMnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgJGZ5ID0gJGVudHJ5LT5maXNjYWxZZWFyLT5pZDsKICAgICAgICAgICAgJGFmeSA9IGdldEFjdGl2ZUZpc2NhbFllYXIoJGVudHJ5LT5pdGVtc1swXS0+Y29zdENlbnRyZS0+cHJvZml0Q2VudHJlLT5jb21wYW55X2lkKS0+aWQ7CiAgICAgICAgICAgICRvZnkgPSBGaXNjYWxZZWFyT3BlbmluZzo6d2hlcmUoWwogICAgICAgICAgICAgICAgJ2NvbXBhbnlfaWQnID0+ICRlbnRyeS0+aXRlbXNbMF0tPmNvc3RDZW50cmUtPnByb2ZpdENlbnRyZS0+Y29tcGFueV9pZCwKICAgICAgICAgICAgICAgICdmaXNjYWxfeWVhcl9pZCcgPT4gJGZ5LAogICAgICAgICAgICAgICAgJ2lzX2FwcHJvdmVkJyA9PiAnYXBwcm92ZWQnLAogICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gJ29wZW5lZCcsCiAgICAgICAgICAgIF0pLT5jb3VudCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKCgkZnkgIT0gJGFmeSkgJiYgJG9meSA9PSAwKSB7CiAgICAgICAgICAgICAgICBzZXNzaW9uKCktPmZsYXNoKCdhbGVydC10eXBlJywgJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICBzZXNzaW9uKCktPmZsYXNoKCdtZXNzYWdlJywgJ1RoaXMgVHJhbnNhY3Rpb24gY2Fubm90IGJlIHJldmVyc2VkLCBiZWNhdXNlIHRoZSBmaXNjYWwgeWVhciBpcyBjbG9zZWQgbm93LicpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlZGlyZWN0KCdhY2NvdW50aW5nL2VudHJpZXMnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5lbnRyaWVzLnJldmVyc2UnLCAkZGF0YSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChyZXF1ZXN0KCktPmhhcygnc2hvcnQtZGV0YWlscycpKSB7CiAgICAgICAgICAgIHJldHVybiB2aWV3KCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMuZW50cmllcy5zaG9ydC1kZXRhaWxzJywgJGRhdGEpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAocmVxdWVzdCgpLT5oYXMoJ3ByaW50JykpIHsKICAgICAgICAgICAgcmV0dXJuIHZpZXdNUERGKCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMuZW50cmllcy5lbnRyeS1wZGYtcHJpbnQnLCAkZGF0YSwgJGRhdGFbJ3RpdGxlJ10sICRkYXRhWyd0aXRsZSddLCAnYTQnLCAnTCcpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAocmVxdWVzdCgpLT5oYXMoJ3BkZicpKSB7CiAgICAgICAgICAgIHJldHVybiBkb3dubG9hZE1QREYoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5lbnRyaWVzLmVudHJ5LXBkZi1wcmludCcsICRkYXRhLCAkZGF0YVsndGl0bGUnXSwgJGRhdGFbJ3RpdGxlJ10pOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLmVudHJpZXMuZW50cnknLCAkZGF0YSk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiBlZGl0KCRpZCkKICAgIHsKICAgICAgICAkZW50cnkgPSBFbnRyeTo6d2l0aChbCiAgICAgICAgICAgICdlbnRyeVR5cGUnLAogICAgICAgICAgICAnaXRlbXMuY29zdENlbnRyZS5wcm9maXRDZW50cmUuY29tcGFueScsCiAgICAgICAgICAgICdleGNoYW5nZVJhdGUuY3VycmVuY3knCiAgICAgICAgXSktPmZpbmRPckZhaWwoJGlkKTsKICAgICAgICBpZiAoYXV0aCgpLT51c2VyKCktPmhhc1Blcm1pc3Npb25UbygnZW50cnktZWRpdCcpICYmICRlbnRyeS0+aXNfbWFudWFsID09IDEgJiYgJGVudHJ5LT5pc19yZXZlcnNlZCA9PSAwICYmICRlbnRyeS0+aXNfYXBwcm92ZWQgIT0gJ2FwcHJvdmVkJyAmJiAkZW50cnktPmNyZWF0ZWRfYnkgPT0gYXV0aCgpLT51c2VyKCktPmlkKSB7CiAgICAgICAgICAgIAogICAgICAgICAgICAkY29tcGFueSA9IENvbXBhbnk6OmhhcygncHJvZml0Q2VudHJlcy5jb3N0Q2VudHJlcycpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdpZCcsICRlbnRyeS0+aXRlbXMtPmZpcnN0KCktPmNvc3RDZW50cmUtPnByb2ZpdENlbnRyZS0+Y29tcGFueV9pZCkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3VzZXJzJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCd1c2VyX2lkJywgYXV0aCgpLT51c2VyKCktPmlkKTsKICAgICAgICAgICAgICAgIH0pLT5maXJzdCgpOwogICAgICAgICAgICBpZiAoIWlzc2V0KCRjb21wYW55LT5pZCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZWRpcmVjdCgnYWNjb3VudGluZy9lbnRyaWVzJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICRlbnRyeVR5cGUgPSBFbnRyeVR5cGU6OndoZXJlKCdpZCcsICRlbnRyeS0+ZW50cnlfdHlwZV9pZCkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ2NvbXBhbmllcy5jb21wYW55LnVzZXJzJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCd1c2VyX2lkJywgYXV0aCgpLT51c2VyKCktPmlkKTsKICAgICAgICAgICAgICAgIH0pLT5maXJzdCgpOwogICAgICAgICAgICBpZiAoIWlzc2V0KCRlbnRyeVR5cGUtPmlkKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlZGlyZWN0KCdhY2NvdW50aW5nL2VudHJpZXMnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgJGFjY291bnREZWZhdWx0U2V0dGluZ3MgPSBhY2NvdW50RGVmYXVsdFNldHRpbmdzKCk7CiAgICAgICAgICAgICRhbGwgPSBnZXRBbGxHcm91cEFuZExlZGdlcnMoJGVudHJ5LT5lbnRyeVR5cGUtPmlkLCB0cnVlLCBbXSwgWyRjb21wYW55LT5pZF0pOwogICAgICAgICAgICAkZ2V0QWN0aXZlRmlzY2FsWWVhciA9IGdldEFjdGl2ZUZpc2NhbFllYXIoJGNvbXBhbnktPmlkKTsKICAgICAgICAgICAgCiAgICAgICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAnRWRpdCAnIC4gJGVudHJ5LT5lbnRyeVR5cGUtPm5hbWUgLiAnIEVudHJ5ICMnIC4gJGVudHJ5LT5jb2RlLAogICAgICAgICAgICAgICAgJ2VudHJ5JyA9PiAkZW50cnksCiAgICAgICAgICAgICAgICAnYWNjb3VudERlZmF1bHRTZXR0aW5ncycgPT4gJGFjY291bnREZWZhdWx0U2V0dGluZ3MsCiAgICAgICAgICAgICAgICAnc3lzdGVtQ3VycmVuY3knID0+IHN5c3RlbUN1cnJlbmN5KCRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydjdXJyZW5jeV9pZCddLCAkYWNjb3VudERlZmF1bHRTZXR0aW5ncyksCiAgICAgICAgICAgICAgICAnY29tcGFueScgPT4gJGNvbXBhbnksCiAgICAgICAgICAgICAgICAnZW50cnlUeXBlJyA9PiAkZW50cnlUeXBlLAogICAgICAgICAgICAgICAgJ3RhZ3MnID0+IFRhZzo6YWxsKCksCiAgICAgICAgICAgICAgICAnZmlzY2FsWWVhcicgPT4gJGdldEFjdGl2ZUZpc2NhbFllYXIsCiAgICAgICAgICAgICAgICAnZmlzY2FsWWVhcnMnID0+IEZpc2NhbFllYXI6OndoZXJlSGFzKCdmaXNjYWxZZWFyT3BlbmluZ3MnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRjb21wYW55KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3N0YXR1cycsICdvcGVuZWQnKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdpc19hcHByb3ZlZCcsICdhcHByb3ZlZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2NvbXBhbnlfaWQnLCAkY29tcGFueS0+aWQpOwogICAgICAgICAgICAgICAgfSktPmdldCgpLAogICAgICAgICAgICAgICAgJ2N1cnJlbmN5VHlwZXMnID0+IEN1cnJlbmN5VHlwZTo6d2l0aChbJ2N1cnJlbmNpZXMnXSktPmdldCgpLAogICAgICAgICAgICAgICAgJ2Nvc3RDZW50cmVzJyA9PiBnZXRDb3N0Q2VudHJlcyh0cnVlLCAkY29tcGFueS0+aWQsIHRydWUpLAogICAgICAgICAgICAgICAgJ2NoYXJ0T2ZBY2NvdW50c09wdGlvbnMnID0+IGNoYXJ0T2ZBY2NvdW50c09wdGlvbnMoW10sIDAsIDAsICRhbGwsIGZhbHNlLCAneWVzJywgJGVudHJ5VHlwZS0+aWQsIFskY29tcGFueS0+aWRdLCB0cnVlLCBnZXRMZWRnZXJCYWxhbmNlcygkYWxsLCAkY29tcGFueS0+aWQsICRnZXRBY3RpdmVGaXNjYWxZZWFyLT5pZCkpLAogICAgICAgICAgICAgICAgJ2FkdmFuY2VDYXRlZ29yaWVzJyA9PiBBZHZhbmNlQ2F0ZWdvcnk6OmFsbCgpCiAgICAgICAgICAgIF07CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLmVudHJpZXMuZWRpdCcsICRkYXRhKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCJUcmFuc2FjdGlvbiBjYW5ub3QgYmUgZWRpdGVkISIpOwogICAgfQogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gdXBkYXRlKFJlcXVlc3QgJHJlcXVlc3QsICRpZCkKICAgIHsKICAgICAgICBpZiAocmVxdWVzdCgpLT5oYXMoJ2FwcHJvdmFsJykpIHsKICAgICAgICAgICAgJHJlcXVlc3QtPnZhbGlkYXRlKFsKICAgICAgICAgICAgICAgICdzdGF0dXMnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgIF0pOwogICAgICAgICAgICAKICAgICAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICRhcHByb3ZhbCA9IEVudHJ5QXBwcm92YWw6OndpdGgoWwogICAgICAgICAgICAgICAgICAgICdhcHByb3ZhbExldmVsJywKICAgICAgICAgICAgICAgICAgICAnZW50cnkuZmlzY2FsWWVhcicsCiAgICAgICAgICAgICAgICAgICAgJ2VudHJ5LmVudHJ5VHlwZScsCiAgICAgICAgICAgICAgICAgICAgJ2VudHJ5LmV4Y2hhbmdlUmF0ZS5jdXJyZW5jeScKICAgICAgICAgICAgICAgIF0pLT5maW5kT3JGYWlsKHJlcXVlc3QoKS0+Z2V0KCdpZCcpKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoJGFwcHJvdmFsLT5zdGF0dXMgIT0gJHJlcXVlc3QtPnN0YXR1cykgewogICAgICAgICAgICAgICAgICAgICRsb2dzID0gIWVtcHR5KCRhcHByb3ZhbC0+bG9ncykgPyBqc29uX2RlY29kZSgkYXBwcm92YWwtPmxvZ3MsIHRydWUpIDogW107CiAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkbG9ncywgJzxzdHJvbmc+JyAuIHVjd29yZHMoJHJlcXVlc3QtPnN0YXR1cykgLiAnPC9zdHJvbmc+IGJ5IDxzdHJvbmc+JyAuIGF1dGgoKS0+dXNlcigpLT5uYW1lIC4gJzwvc3Ryb25nPiBhdCA8c3Ryb25nPicgLiBkYXRlKCdZLW0tZCBnOmkgYScpIC4gJzwvc3Ryb25nPicpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICRhcHByb3ZhbC0+c3RhdHVzID0gJHJlcXVlc3QtPnN0YXR1czsKICAgICAgICAgICAgICAgICAgICAkYXBwcm92YWwtPnVzZXJfaWQgPSBhdXRoKCktPnVzZXIoKS0+aWQ7CiAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmFsLT5sb2dzID0ganNvbl9lbmNvZGUoJGxvZ3MpOwogICAgICAgICAgICAgICAgICAgICRhcHByb3ZhbC0+c2F2ZSgpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIChFbnRyeUFwcHJvdmFsOjp3aGVyZSgnZW50cnlfaWQnLCAkYXBwcm92YWwtPmVudHJ5X2lkKS0+d2hlcmUoJ3N0YXR1cycsICchPScsICdhcHByb3ZlZCcpLT5jb3VudCgpID09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmFsLT5lbnRyeS0+aXNfYXBwcm92ZWQgPSAnYXBwcm92ZWQnOwogICAgICAgICAgICAgICAgICAgICAgICAkYXBwcm92YWwtPmVudHJ5LT5zYXZlKCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmFsLT5lbnRyeS0+aXNfYXBwcm92ZWQgPSAncGVuZGluZyc7CiAgICAgICAgICAgICAgICAgICAgICAgICRhcHByb3ZhbC0+ZW50cnktPnNhdmUoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgREI6OmNvbW1pdCgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiQXBwcm92YWwgUmVzcG9uc2UgaGFzIGJlZW4gcG9zdGVkLiIKICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gIlBsZWFzZSBjaGFuZ2UgQXBwcm92YWwgdG8gUG9zdC4iCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJHRoLT5nZXRNZXNzYWdlKCkKICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChyZXF1ZXN0KCktPmhhcygnZ2xvYmFsLWFwcHJvdmFsJykpIHsKICAgICAgICAgICAgJHJlcXVlc3QtPnZhbGlkYXRlKFsKICAgICAgICAgICAgICAgICdzdGF0dXMnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICAgICAnc3RhdHVzLionID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgIF0pOwogICAgICAgICAgICAKICAgICAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICRhcHByb3ZhbHMgPSBFbnRyeUFwcHJvdmFsOjp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAnYXBwcm92YWxMZXZlbCcsCiAgICAgICAgICAgICAgICAgICAgJ2VudHJ5LmZpc2NhbFllYXInLAogICAgICAgICAgICAgICAgICAgICdlbnRyeS5lbnRyeVR5cGUnLAogICAgICAgICAgICAgICAgICAgICdlbnRyeS5leGNoYW5nZVJhdGUuY3VycmVuY3knCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ2FwcHJvdmFsTGV2ZWwudXNlcnMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCd1c2VyX2lkJywgYXV0aCgpLT51c2VyKCktPmlkKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJ5X2lkJywgcmVxdWVzdCgpLT5nZXQoJ2lkJykpCiAgICAgICAgICAgICAgICAgICAgLT5nZXQoKTsKICAgICAgICAgICAgICAgIGlmIChpc3NldCgkYXBwcm92YWxzWzBdKSkgewogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRhcHByb3ZhbHMgYXMgJGFwcHJvdmFsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkYXBwcm92YWwtPnN0YXR1cyAhPSAkcmVxdWVzdC0+c3RhdHVzWyRhcHByb3ZhbC0+aWRdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbG9ncyA9ICFlbXB0eSgkYXBwcm92YWwtPmxvZ3MpID8ganNvbl9kZWNvZGUoJGFwcHJvdmFsLT5sb2dzLCB0cnVlKSA6IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkbG9ncywgJzxzdHJvbmc+JyAuIHVjd29yZHMoJHJlcXVlc3QtPnN0YXR1c1skYXBwcm92YWwtPmlkXSkgLiAnPC9zdHJvbmc+IGJ5IDxzdHJvbmc+JyAuIGF1dGgoKS0+dXNlcigpLT5uYW1lIC4gJzwvc3Ryb25nPiBhdCA8c3Ryb25nPicgLiBkYXRlKCdZLW0tZCBnOmkgYScpIC4gJzwvc3Ryb25nPicpIC4gKCFlbXB0eSgkcmVxdWVzdC0+bm90ZXNbJGFwcHJvdmFsLT5pZF0pID8gJyB3aXRoIG5vdGVzIC0gJyAuICRyZXF1ZXN0LT5ub3Rlc1skYXBwcm92YWwtPmlkXSA6ICcnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmFsLT5zdGF0dXMgPSAkcmVxdWVzdC0+c3RhdHVzWyRhcHByb3ZhbC0+aWRdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmFsLT51c2VyX2lkID0gYXV0aCgpLT51c2VyKCktPmlkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmFsLT5sb2dzID0ganNvbl9lbmNvZGUoJGxvZ3MpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmFsLT5zYXZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChFbnRyeUFwcHJvdmFsOjp3aGVyZSgnZW50cnlfaWQnLCAkYXBwcm92YWwtPmVudHJ5X2lkKS0+d2hlcmUoJ3N0YXR1cycsICchPScsICdhcHByb3ZlZCcpLT5jb3VudCgpID09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXBwcm92YWwtPmVudHJ5LT5pc19hcHByb3ZlZCA9ICdhcHByb3ZlZCc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFwcHJvdmFsLT5lbnRyeS0+c2F2ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXBwcm92YWwtPmVudHJ5LT5pc19hcHByb3ZlZCA9ICdwZW5kaW5nJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXBwcm92YWwtPmVudHJ5LT5zYXZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIERCOjpjb21taXQoKTsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gIkFwcHJvdmFsIFJlc3BvbnNlIGhhcyBiZWVuIHBvc3RlZC4iCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJHRoLT5nZXRNZXNzYWdlKCkKICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChyZXF1ZXN0KCktPmhhcygncmV2ZXJzZScpKSB7CiAgICAgICAgICAgICRlbnRyeSA9IEVudHJ5OjpmaW5kT3JGYWlsKCRpZCk7CiAgICAgICAgICAgIGlmICgkZW50cnktPmlzX21hbnVhbCA9PSAwIHx8ICRlbnRyeS0+aXNfcmV2ZXJzZWQgPT0gMSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gIlRoaXMgVHJhbnNhY3Rpb24gY2Fubm90IGJlIHJldmVyc2VkISIKICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgJGl0ZW1zID0gW107CiAgICAgICAgICAgICAgICBpZiAoJGVudHJ5LT5pdGVtcy0+Y291bnQoKSA+IDApIHsKICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkZW50cnktPml0ZW1zIGFzICRrZXkgPT4gJGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkaXRlbXMsIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJGl0ZW0tPmNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICRpdGVtLT5jaGFydF9vZl9hY2NvdW50X2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Yl9sZWRnZXJfaWQnID0+ICRpdGVtLT5zdWJfbGVkZ2VyX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAoJGl0ZW0tPmRlYml0X2NyZWRpdCA9PSAnQycgPyAkaXRlbS0+YW1vdW50IDogMCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAoJGl0ZW0tPmRlYml0X2NyZWRpdCA9PSAnRCcgPyAkaXRlbS0+YW1vdW50IDogMCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYW1vdW50JyA9PiAkaXRlbS0+YW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RlYml0X2NyZWRpdCcgPT4gKCRpdGVtLT5kZWJpdF9jcmVkaXQgPT0gJ0MnID8gJ0QnIDogJ0MnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICRyZXF1ZXN0LT5uYXJyYXRpb25bJGl0ZW0tPmlkXSwKICAgICAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAkZmlzY2FsWWVhciA9IEZpc2NhbFllYXI6OndpdGgoWwogICAgICAgICAgICAgICAgICAgICdmaXNjYWxZZWFyT3BlbmluZ3MnCiAgICAgICAgICAgICAgICBdKS0+ZmluZE9yRmFpbCgkZW50cnktPmZpc2NhbF95ZWFyX2lkKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgJG5ld0VudHJ5ID0gc2F2ZUxlZGdlckVudHJpZXMoJGVudHJ5LT5lbnRyeV90eXBlX2lkLCAkZW50cnktPmRhdGUgLiAnICcgLiAkZW50cnktPnRpbWUsIDEsICRlbnRyeS0+bnVtYmVyLCAkcmVxdWVzdC0+bm90ZXMsICRpdGVtcywgJGVudHJ5LT5leGNoYW5nZV9yYXRlX2lkLCAkZW50cnktPmlzX2FkdmFuY2UsICRlbnRyeS0+YWR2YW5jZV9jYXRlZ29yeV9pZCwgJGVudHJ5LT5pc19tYW51YWwsICRlbnRyeS0+aXRlbXNbMF0tPmNvc3RDZW50cmUtPnByb2ZpdENlbnRyZS0+Y29tcGFueV9pZCwgJGZpc2NhbFllYXIpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJG5ld0VudHJ5WydzdWNjZXNzJ10pICYmICRuZXdFbnRyeVsnc3VjY2VzcyddKSB7CiAgICAgICAgICAgICAgICAgICAgJGVudHJ5LT5pc19yZXZlcnNlZCA9IDE7CiAgICAgICAgICAgICAgICAgICAgJGVudHJ5LT5zYXZlKCk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgREI6OmNvbW1pdCgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJG5ld0VudHJ5WydtZXNzYWdlJ10KICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJHRoLT5nZXRNZXNzYWdlKCkKICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgICRyZXF1ZXN0LT52YWxpZGF0ZShbCiAgICAgICAgICAgICdmaXNjYWxfeWVhcl9pZCcgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnY29zdF9jZW50cmVfaWQuKicgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkLionID0+ICdyZXF1aXJlZCcsCiAgICAgICAgXSk7CiAgICAgICAgCiAgICAgICAgaWYgKCR0aGlzLT5hbW91bnQoJHJlcXVlc3QpWydkZWJpdCddIDw9IDAgfHwgJHRoaXMtPmFtb3VudCgkcmVxdWVzdClbJ2NyZWRpdCddIDw9IDApIHsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJQbGVhc2UgYWRkIHNvbWUgRGViaXQgb3IgQ3JlZGl0IGFtb3VudCIKICAgICAgICAgICAgXSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmICgkdGhpcy0+YW1vdW50KCRyZXF1ZXN0KVsnZGViaXQnXSAhPSAkdGhpcy0+YW1vdW50KCRyZXF1ZXN0KVsnY3JlZGl0J10pIHsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJEZWJpdCAmIENyZWRpdCBhbW91bnQgbXVzdCBiZSBzYW1lIgogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgCiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAkZmlzY2FsWWVhciA9IEZpc2NhbFllYXI6OndpdGgoWwogICAgICAgICAgICAgICAgJ2Zpc2NhbFllYXJPcGVuaW5ncycKICAgICAgICAgICAgXSktPmZpbmRPckZhaWwoJHJlcXVlc3QtPmZpc2NhbF95ZWFyX2lkKTsKICAgICAgICAgICAgaWYgKChzdHJ0b3RpbWUoZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPmRhdGV0aW1lKSkpIDwgc3RydG90aW1lKCRmaXNjYWxZZWFyLT5zdGFydCkpIHx8IChzdHJ0b3RpbWUoZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPmRhdGV0aW1lKSkpID4gc3RydG90aW1lKCRmaXNjYWxZZWFyLT5lbmQpKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gIkRhdGV0aW1lIGlzIG5vdCBpbiB0aGUgcmFuZ2Ugb2YgdGhlIGZpc2NhbCB5ZWFyIHBlcmlvZC4iCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgJGVudHJ5ID0gRW50cnk6OndpdGgoWwogICAgICAgICAgICAgICAgJ2VudHJ5VHlwZScsCiAgICAgICAgICAgICAgICAnaXRlbXMuY29zdENlbnRyZS5wcm9maXRDZW50cmUuY29tcGFueScsCiAgICAgICAgICAgICAgICAnZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JwogICAgICAgICAgICBdKS0+ZmluZE9yRmFpbCgkaWQpOwogICAgICAgICAgICAKICAgICAgICAgICAgJGV4Y2hhbmdlUmF0ZSA9IFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xFeGNoYW5nZVJhdGU6OmZpbmRPckZhaWwoZ2V0RXhjaGFuZ2VSYXRlcygkcmVxdWVzdC0+Y3VycmVuY3lfaWQsIGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRyZXF1ZXN0LT5kYXRldGltZSkpLCBkYXRlKCdIOmk6cycsIHN0cnRvdGltZSgkcmVxdWVzdC0+ZGF0ZXRpbWUpKSlbJ3JhdGUnXS0+aWQpOwogICAgICAgICAgICAkc3lzdGVtQ3VycmVuY3kgPSBzeXN0ZW1DdXJyZW5jeSgpLT5pZDsKICAgICAgICAgICAgJHN5c3RlbVJhdGUgPSBpc3NldChqc29uX2RlY29kZSgkZXhjaGFuZ2VSYXRlLT5yYXRlcywgdHJ1ZSlbJHN5c3RlbUN1cnJlbmN5XSkgPyBqc29uX2RlY29kZSgkZXhjaGFuZ2VSYXRlLT5yYXRlcywgdHJ1ZSlbJHN5c3RlbUN1cnJlbmN5XVsncmF0ZSddIDogMTsKICAgICAgICAgICAgCiAgICAgICAgICAgICRpdGVtcyA9IFtdOwogICAgICAgICAgICBpZiAoaXNzZXQoJHJlcXVlc3QtPmNoYXJ0X29mX2FjY291bnRfaWRbMF0pKSB7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkcmVxdWVzdC0+Y2hhcnRfb2ZfYWNjb3VudF9pZCBhcyAka2V5ID0+ICRjaGFydF9vZl9hY2NvdW50X2lkKSB7CiAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkaXRlbXMsIFsKICAgICAgICAgICAgICAgICAgICAgICAgJ2VudHJ5X2lkJyA9PiAkZW50cnktPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRyZXF1ZXN0LT5jb3N0X2NlbnRyZV9pZFska2V5XSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICRyZXF1ZXN0LT5jaGFydF9vZl9hY2NvdW50X2lkWyRrZXldLAogICAgICAgICAgICAgICAgICAgICAgICAnc3ViX2xlZGdlcl9pZCcgPT4gaXNzZXQoJHJlcXVlc3QtPnN1Yl9sZWRnZXJzWyRrZXldKSA/ICRyZXF1ZXN0LT5zdWJfbGVkZ2Vyc1ska2V5XSA6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICdhbW91bnQnID0+ICgkcmVxdWVzdC0+ZGViaXRbJGtleV0gPiAwID8gJHJlcXVlc3QtPmRlYml0WyRrZXldIDogJHJlcXVlc3QtPmNyZWRpdFska2V5XSksCiAgICAgICAgICAgICAgICAgICAgICAgICdyZXBvcnRpbmdfYW1vdW50JyA9PiAoJHJlcXVlc3QtPmRlYml0WyRrZXldID4gMCA/ICRyZXF1ZXN0LT5kZWJpdFska2V5XSA6ICRyZXF1ZXN0LT5jcmVkaXRbJGtleV0pICogJHN5c3RlbVJhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdF9jcmVkaXQnID0+ICgkcmVxdWVzdC0+ZGViaXRbJGtleV0gPiAwID8gJ0QnIDogJ0MnKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJHJlcXVlc3QtPm5hcnJhdGlvblska2V5XSwKICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgJGVudHJ5LT5maXNjYWxfeWVhcl9pZCA9ICRyZXF1ZXN0LT5maXNjYWxfeWVhcl9pZDsKICAgICAgICAgICAgJGVudHJ5LT5udW1iZXIgPSAkcmVxdWVzdC0+bnVtYmVyOwogICAgICAgICAgICAkZW50cnktPmRhdGUgPSBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkcmVxdWVzdC0+ZGF0ZXRpbWUpKTsKICAgICAgICAgICAgJGVudHJ5LT50aW1lID0gZGF0ZSgnSDppOnMnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPmRhdGV0aW1lKSk7CiAgICAgICAgICAgICRlbnRyeS0+ZXhjaGFuZ2VfcmF0ZV9pZCA9ICRleGNoYW5nZVJhdGUtPmlkOwogICAgICAgICAgICAkZW50cnktPmRlYml0ID0gY29sbGVjdCgkaXRlbXMpLT53aGVyZSgnZGViaXRfY3JlZGl0JywgJ0QnKS0+c3VtKCdhbW91bnQnKTsKICAgICAgICAgICAgJGVudHJ5LT5jcmVkaXQgPSBjb2xsZWN0KCRpdGVtcyktPndoZXJlKCdkZWJpdF9jcmVkaXQnLCAnQycpLT5zdW0oJ2Ftb3VudCcpOwogICAgICAgICAgICAkZW50cnktPnJlcG9ydGluZ19kZWJpdCA9IGNvbGxlY3QoJGl0ZW1zKS0+d2hlcmUoJ2RlYml0X2NyZWRpdCcsICdEJyktPnN1bSgncmVwb3J0aW5nX2Ftb3VudCcpOwogICAgICAgICAgICAkZW50cnktPnJlcG9ydGluZ19jcmVkaXQgPSBjb2xsZWN0KCRpdGVtcyktPndoZXJlKCdkZWJpdF9jcmVkaXQnLCAnQycpLT5zdW0oJ3JlcG9ydGluZ19hbW91bnQnKTsKICAgICAgICAgICAgJGVudHJ5LT5ub3RlcyA9ICRyZXF1ZXN0LT5ub3RlczsKICAgICAgICAgICAgJGVudHJ5LT5zYXZlKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoJGVudHJ5LT5zYXZlKCkpIHsKICAgICAgICAgICAgICAgIEVudHJ5SXRlbTo6d2hlcmUoJ2VudHJ5X2lkJywgJGVudHJ5LT5pZCktPmRlbGV0ZSgpOwogICAgICAgICAgICAgICAgRW50cnlJdGVtOjppbnNlcnQoJGl0ZW1zKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgJGF0dGFjaG1lbnRzID0gRW50cnlBdHRhY2htZW50Ojp3aGVyZSgnZW50cnlfaWQnLCAkZW50cnktPmlkKS0+d2hlcmVOb3RpbignaWQnLCBpc3NldCgkcmVxdWVzdC0+b2xkX2ZpbGVzWzBdKSA/ICRyZXF1ZXN0LT5vbGRfZmlsZXMgOiBbXSktPmdldCgpOwogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRhdHRhY2htZW50c1swXSkpIHsKICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkYXR0YWNobWVudHMgYXMgJGF0dGFjaG1lbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmZpbGVEZWxldGUoJGF0dGFjaG1lbnQtPnBhdGgpOwogICAgICAgICAgICAgICAgICAgICAgICAkYXR0YWNobWVudC0+ZGVsZXRlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAkYXR0YWNobWVudHMgPSBbXTsKICAgICAgICAgICAgICAgIGlmICgkcmVxdWVzdC0+aGFzRmlsZSgnZmlsZXMnKSkgewogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRyZXF1ZXN0LT5maWxlKCdmaWxlcycpIGFzICRrZXkgPT4gJGZpbGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGZpbGVJbmZvID0gJHRoaXMtPmZpbGVJbmZvKCRmaWxlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkYXR0YWNobWVudHMsIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdlbnRyeV9pZCcgPT4gJGVudHJ5LT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYW1lJyA9PiAkZmlsZUluZm9bJ25hbWUnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAkZmlsZUluZm9bJ3R5cGUnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzaXplJyA9PiAkZmlsZUluZm9bJ3NpemUnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwYXRoJyA9PiAkdGhpcy0+ZmlsZVVwbG9hZCgkZmlsZSwgJ3VwbG9hZC9lbnRyeS1hdHRhY2htZW50cycpLAogICAgICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJGF0dGFjaG1lbnRzWzBdKSkgewogICAgICAgICAgICAgICAgICAgIEVudHJ5QXR0YWNobWVudDo6aW5zZXJ0KCRhdHRhY2htZW50cyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xFbnRyeUFwcHJvdmFsOjp3aGVyZSgnZW50cnlfaWQnLCAkZW50cnktPmlkKS0+ZGVsZXRlKCk7CiAgICAgICAgICAgICAgICAkYXBwcm92YWxMZXZlbHMgPSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQXBwcm92YWxMZXZlbDo6d2hlcmVIYXMoJ2NoYXJ0T2ZBY2NvdW50cycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGl0ZW1zKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignY2hhcnRfb2ZfYWNjb3VudF9pZCcsIGNvbGxlY3QoJGl0ZW1zKS0+cGx1Y2soJ2NoYXJ0X29mX2FjY291bnRfaWQnKS0+dG9BcnJheSgpKTsKICAgICAgICAgICAgICAgIH0pLT5nZXQoKTsKICAgICAgICAgICAgICAgIGlmIChpc3NldCgkYXBwcm92YWxMZXZlbHNbMF0pKSB7CiAgICAgICAgICAgICAgICAgICAgJGxldmVscyA9IFtdOwogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRhcHByb3ZhbExldmVscyBhcyAkbGV2ZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkbGV2ZWxzLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZW50cnlfaWQnID0+ICRlbnRyeS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYXBwcm92YWxfbGV2ZWxfaWQnID0+ICRsZXZlbC0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiAoJGVudHJ5LT5pc19tYW51YWwgPT0gMSA/ICdwZW5kaW5nJyA6ICdhcHByb3ZlZCcpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xvZ3MnID0+IGpzb25fZW5jb2RlKFtdKSwKICAgICAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xFbnRyeUFwcHJvdmFsOjppbnNlcnQoJGxldmVscyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRlbnRyeS0+aXNfYXBwcm92ZWQgPSAnYXBwcm92ZWQnOwogICAgICAgICAgICAgICAgICAgICRlbnRyeS0+c2F2ZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBEQjo6Y29tbWl0KCk7CiAgICAgICAgICAgICAgICBzZXNzaW9uKCktPmZsYXNoKCdhbGVydC10eXBlJywgJ3N1Y2Nlc3MnKTsKICAgICAgICAgICAgICAgIHNlc3Npb24oKS0+Zmxhc2goJ21lc3NhZ2UnLCAiVHJhbnNhY3Rpb24gaGFzIGJlZW4gdXBkYXRlZCBzdWNjZXNzZnVsbHkuIik7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gIlNvbWV0aGluZyB3ZW50IFdyb25nISIKICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkdGgtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiBkZXN0cm95KCRpZCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBFbnRyeTo6ZmluZCgkaWQpLT5kZWxldGUoKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gIkVudHJ5IGhhcyBiZWVuIERlbGV0ZWQhIgogICAgICAgICAgICBdKTsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJHRoLT5nZXRNZXNzYWdlKCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gYW1vdW50KCRyZXF1ZXN0KQogICAgewogICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICdkZWJpdCcgPT4gYXJyYXlfc3VtKCRyZXF1ZXN0LT5kZWJpdCksCiAgICAgICAgICAgICdjcmVkaXQnID0+IGFycmF5X3N1bSgkcmVxdWVzdC0+Y3JlZGl0KSwKICAgICAgICBdOwogICAgfQogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0RHVlQW1vdW50KCRwdXJjaGFzZV9vcmRlcl9pZCkKICAgIHsKICAgICAgICAkcHVyY2hhc2VPcmRlciA9IFB1cmNoYXNlT3JkZXI6OmZpbmQoJHB1cmNoYXNlX29yZGVyX2lkKTsKICAgICAgICByZXR1cm4gZ2V0UE9EdWVBbW91bnQoJHB1cmNoYXNlT3JkZXIpOwogICAgfQogICAgCiAgICAvKiAkZW50cmllcyA9IEVudHJ5Ojp3aXRoKFsKICAgICAgICAvLyAncHVyY2hhc2VPcmRlcicsCiAgICAgICAgJ2V4Y2hhbmdlUmF0ZS5jdXJyZW5jeScsCiAgICAgICAgJ2VudHJ5VHlwZScsCiAgICAgICAgLy8gJ2l0ZW1zLmNvc3RDZW50cmUucHJvZml0Q2VudHJlLmNvbXBhbnknLAogICAgICAgIC8vICdhcHByb3ZhbHMuYXBwcm92YWxMZXZlbCcKICAgIF0pCiAgICAtPndoZW4oIWRhdGF0YWJsZU9yZGVyaW5nKCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlcmJ5KCdpZCcsICdkZXNjJyk7CiAgICB9KQoKICAgIC0+d2hlcmVIYXMoJ2l0ZW1zLmNvc3RDZW50cmUucHJvZml0Q2VudHJlLmNvbXBhbnkudXNlcnMnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCd1c2VyX2lkJywgYXV0aCgpLT51c2VyKCktPmlkKTsKICAgIH0pCiAgICAtPndoZXJlSGFzKCdpdGVtcy5jaGFydE9mQWNjb3VudC51c2VycycsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3VzZXJfaWQnLCBhdXRoKCktPnVzZXIoKS0+aWQpOwogICAgfSkKICAgIC0+d2hlcmVIYXMoJ2VudHJ5VHlwZS5jb21wYW5pZXMuY29tcGFueS51c2VycycsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3VzZXJfaWQnLCBhdXRoKCktPnVzZXIoKS0+aWQpOwogICAgfSkKCiAgICAtPndoZW4ocmVxdWVzdCgpLT5nZXQoJ2NvbXBhbnlfaWQnKSA+IDAsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2l0ZW1zLmNvc3RDZW50cmUucHJvZml0Q2VudHJlJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2NvbXBhbnlfaWQnLCByZXF1ZXN0KCktPmdldCgnY29tcGFueV9pZCcpKTsKICAgICAgICB9KTsKICAgIH0pCiAgICAtPndoZW4ocmVxdWVzdCgpLT5nZXQoJ2VudHJ5X3R5cGVfaWQnKSA+IDAsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2VudHJ5X3R5cGVfaWQnLCByZXF1ZXN0KCktPmdldCgnZW50cnlfdHlwZV9pZCcpKTsKICAgIH0pCiAgICAtPndoZW4ocmVxdWVzdCgpLT5nZXQoJ2Zpc2NhbF95ZWFyX2lkJykgPiAwLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdmaXNjYWxfeWVhcl9pZCcsIHJlcXVlc3QoKS0+Z2V0KCdmaXNjYWxfeWVhcl9pZCcpKTsKICAgIH0pCiAgICAtPndoZW4ocmVxdWVzdCgpLT5nZXQoJ2N1cnJlbmN5X2lkJykgPiAwLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdleGNoYW5nZVJhdGUnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnY3VycmVuY3lfaWQnLCByZXF1ZXN0KCktPmdldCgnY3VycmVuY3lfaWQnKSk7CiAgICAgICAgfSk7CiAgICB9KQogICAgLT53aGVuKCFlbXB0eShyZXF1ZXN0KCktPmdldCgnZnJvbScpKSAmJiBzdHJ0b3RpbWUocmVxdWVzdCgpLT5nZXQoJ2Zyb20nKSkgPiAwLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdkYXRlJywgJz49JywgcmVxdWVzdCgpLT5nZXQoJ2Zyb20nKSk7CiAgICB9KQogICAgLT53aGVuKCFlbXB0eShyZXF1ZXN0KCktPmdldCgndG8nKSkgJiYgc3RydG90aW1lKHJlcXVlc3QoKS0+Z2V0KCd0bycpKSA+IDAsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2RhdGUnLCAnPD0nLCByZXF1ZXN0KCktPmdldCgndG8nKSk7CiAgICB9KQogICAgCiAgICAtPndoZW4ocmVxdWVzdCgpLT5nZXQoJ2RlYml0X2xlZGdlcl9pZCcpID4gMCwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnaXRlbXMnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnY2hhcnRfb2ZfYWNjb3VudF9pZCcsIHJlcXVlc3QoKS0+Z2V0KCdkZWJpdF9sZWRnZXJfaWQnKSkKICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2RlYml0X2NyZWRpdCcsICdEJyk7CiAgICAgICAgfSk7CiAgICB9KQogICAgLT53aGVuKHJlcXVlc3QoKS0+Z2V0KCdkZWJpdF9zdWJfbGVkZ2VyX2lkJykgPiAwLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdpdGVtcycsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdzdWJfbGVkZ2VyX2lkJywgcmVxdWVzdCgpLT5nZXQoJ2RlYml0X3N1Yl9sZWRnZXJfaWQnKSkKICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2RlYml0X2NyZWRpdCcsICdEJyk7CiAgICAgICAgfSk7CiAgICB9KQoKICAgIC0+d2hlbihyZXF1ZXN0KCktPmdldCgnY3JlZGl0X2xlZGdlcl9pZCcpID4gMCwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnaXRlbXMnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnY2hhcnRfb2ZfYWNjb3VudF9pZCcsIHJlcXVlc3QoKS0+Z2V0KCdjcmVkaXRfbGVkZ2VyX2lkJykpCiAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdkZWJpdF9jcmVkaXQnLCAnQycpOwogICAgICAgIH0pOwogICAgfSkKICAgIC0+d2hlbihyZXF1ZXN0KCktPmdldCgnY3JlZGl0X3N1Yl9sZWRnZXJfaWQnKSA+IDAsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2l0ZW1zJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3N1Yl9sZWRnZXJfaWQnLCByZXF1ZXN0KCktPmdldCgnY3JlZGl0X3N1Yl9sZWRnZXJfaWQnKSkKICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2RlYml0X2NyZWRpdCcsICdDJyk7CiAgICAgICAgfSk7CiAgICB9KQoKICAgIC0+d2hlbighZW1wdHkocmVxdWVzdCgpLT5nZXQoJ3N0YXR1cycpKSwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVuKHJlcXVlc3QoKS0+Z2V0KCdzdGF0dXMnKSA9PSAnYXBwcm92ZWQnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaXNfYXBwcm92ZWQnLCAnYXBwcm92ZWQnKTsKICAgICAgICB9KQogICAgICAgIC0+d2hlbihyZXF1ZXN0KCktPmdldCgnc3RhdHVzJykgIT0gJ2FwcHJvdmVkJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2FwcHJvdmFscy5hcHByb3ZhbExldmVsJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuZXhwbG9kZSgnLScsIHJlcXVlc3QoKS0+Z2V0KCdzdGF0dXMnKSlbMF0uJyUnKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZUhhcygnYXBwcm92YWxzJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdzdGF0dXMnLCAnTElLRScsICclJy4oaXNzZXQoZXhwbG9kZSgnLScsIHJlcXVlc3QoKS0+Z2V0KCdzdGF0dXMnKSlbMV0pID8gZXhwbG9kZSgnLScsIHJlcXVlc3QoKS0+Z2V0KCdzdGF0dXMnKSlbMV0gOiAnJykuJyUnKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9KTsKCiAgICBpZihyZXF1ZXN0KCktPmhhcygnY29sbGVjdGlvbicpKXsKICAgICAgICByZXR1cm4gJGVudHJpZXMtPmdldCgpOwogICAgfQogICAgKi8KICAgIAogICAgLy8gLT5hZGRDb2x1bW4oJ2NvbXBhbnknLCBmdW5jdGlvbiAoJGVudHJ5KSB7CiAgICAvLyAgICAgcmV0dXJuIGltcGxvZGUoJywgJywgYXJyYXlfdW5pcXVlKCRlbnRyeS0+aXRlbXMtPnBsdWNrKCdjb3N0Q2VudHJlLnByb2ZpdENlbnRyZS5jb21wYW55LmNvZGUnKS0+dG9BcnJheSgpKSk7CiAgICAvLyB9KQogICAgLy8gLT5maWx0ZXJDb2x1bW4oJ2NvbXBhbnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgLy8gICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdpdGVtcy5jb3N0Q2VudHJlLnByb2ZpdENlbnRyZS5jb21wYW55JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgLy8gICAgICAgICAkcXVlcnktPndoZXJlKCdjb2RlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJykKICAgIC8vICAgICAgICAgICAgICAgLT5vcldoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAvLyAgICAgfSk7CiAgICAvLyB9KQogICAgLy8gLT5vcmRlckNvbHVtbignY29tcGFueScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgLy8gICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIEVudHJ5SXRlbTo6c2VsZWN0KCdjb21wYW5pZXMuY29kZScpCiAgICAvLyAgICAgICAgIC0+am9pbignY29zdF9jZW50cmVzJywgJ2Nvc3RfY2VudHJlcy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmNvc3RfY2VudHJlX2lkJykKICAgIC8vICAgICAgICAgLT5qb2luKCdwcm9maXRfY2VudHJlcycsICdwcm9maXRfY2VudHJlcy5pZCcsICc9JywgJ2Nvc3RfY2VudHJlcy5wcm9maXRfY2VudHJlX2lkJykKICAgIC8vICAgICAgICAgLT5qb2luKCdjb21wYW5pZXMnLCAnY29tcGFuaWVzLmlkJywgJz0nLCAncHJvZml0X2NlbnRyZXMuY29tcGFueV9pZCcpCiAgICAvLyAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ2VudHJ5X2l0ZW1zLmVudHJ5X2lkJywgJ2VudHJpZXMuaWQnKQogICAgLy8gICAgICAgICAtPnRha2UoMSkKICAgIC8vICAgICApOwogICAgLy8gfSkKICAgIAogICAgLy8gLT5hZGRDb2x1bW4oJ3R5cGUnLCBmdW5jdGlvbiAoJGVudHJ5KSB7CiAgICAvLyAgICAgcmV0dXJuICRlbnRyeS0+ZW50cnlUeXBlID8gJGVudHJ5LT5lbnRyeVR5cGUtPm5hbWUgOiAnJzsKICAgIC8vIH0pCiAgICAvLyAtPmZpbHRlckNvbHVtbigndHlwZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAvLyAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2VudHJ5VHlwZScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgIC8vICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgLy8gICAgIH0pOwogICAgLy8gfSkKICAgIC8vIC0+b3JkZXJDb2x1bW4oJ3R5cGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgIC8vICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBFbnRyeVR5cGU6OnNlbGVjdCgnZW50cnlfdHlwZXMubmFtZScpCiAgICAvLyAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ2VudHJ5X3R5cGVzLmlkJywgJ2VudHJpZXMuZW50cnlfdHlwZV9pZCcpCiAgICAvLyAgICAgICAgIC0+dGFrZSgxKQogICAgLy8gICAgICk7CiAgICAvLyB9KQogICAgCiAgICAvLyAtPmFkZENvbHVtbignZmlzY2FsX3llYXInLCBmdW5jdGlvbigkZW50cnkpewogICAgLy8gICAgIHJldHVybiAkZW50cnktPmZpc2NhbFllYXIgPyAkZW50cnktPmZpc2NhbFllYXItPnRpdGxlIDogJyc7CiAgICAvLyB9KQogICAgLy8gLT5maWx0ZXJDb2x1bW4oJ2Zpc2NhbF95ZWFyJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgIC8vICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnZmlzY2FsWWVhcicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgIC8vICAgICAgICAgJHF1ZXJ5LT53aGVyZSgndGl0bGUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgIC8vICAgICB9KTsKICAgIC8vIH0pCiAgICAvLyAtPm9yZGVyQ29sdW1uKCdmaXNjYWxfeWVhcicsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgLy8gICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIEZpc2NhbFllYXI6OnNlbGVjdCgnZmlzY2FsX3llYXJzLnRpdGxlJykKICAgIC8vICAgICAgICAgLT53aGVyZUNvbHVtbignZmlzY2FsX3llYXJzLmlkJywgJ2VudHJpZXMuZmlzY2FsX3llYXJfaWQnKQogICAgLy8gICAgICAgICAtPnRha2UoMSkKICAgIC8vICAgICApOwogICAgLy8gfSkKICAgIAogICAgLy8gLT5hZGRDb2x1bW4oJ2RlYml0X2xlZGdlcicsIGZ1bmN0aW9uICgkZW50cnkpIHsKICAgIC8vICAgICByZXR1cm4gJzxhIGNsYXNzPSJ0ZXh0LXByaW1hcnkiIG9uY2xpY2s9ImdldFNob3J0RGV0YWlscygkKHRoaXMpKSIgZGF0YS1pZD0iJyAuICgkZW50cnktPmlkKSAuICciIGRhdGEtZW50cnktdHlwZT0iJyAuICgkZW50cnktPmVudHJ5VHlwZS0+bmFtZSkgLiAnIiBkYXRhLWNvZGU9IicgLiAoJGVudHJ5LT5jb2RlKSAuICciPgogICAgLy8gICAgICAgICAgICAgPHAgc3R5bGU9IndpZHRoOiAxNTBweDt3aGl0ZS1zcGFjZTogbm9ybWFsIj4nIC4gaW1wbG9kZSgnLCAnLCBhcnJheV91bmlxdWUoJGVudHJ5LT5pdGVtcy0+d2hlcmUoJ2RlYml0X2NyZWRpdCcsICdEJyktPnBsdWNrKCdjaGFydE9mQWNjb3VudC5jb2RlJyktPnRvQXJyYXkoKSkpIC4gJzwvcD4KICAgIC8vICAgICAgICAgPC9hPic7CiAgICAvLyB9KQogICAgLy8gLT5maWx0ZXJDb2x1bW4oJ2RlYml0X2xlZGdlcicsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAvLyAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2l0ZW1zLmNoYXJ0T2ZBY2NvdW50JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgLy8gICAgICAgICAkcXVlcnktPndoZXJlKCdjb2RlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAvLyAgICAgfSkKICAgIC8vICAgICAtPndoZXJlSGFzKCdpdGVtcycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgIC8vICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnZGViaXRfY3JlZGl0JywgJ0QnKTsKICAgIC8vICAgICB9KTsKICAgIC8vIH0pCiAgICAvLyAtPm9yZGVyQ29sdW1uKCdkZWJpdF9sZWRnZXInLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgIC8vICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBFbnRyeUl0ZW06OnNlbGVjdCgnY2hhcnRfb2ZfYWNjb3VudHMuY29kZScpCiAgICAvLyAgICAgICAgIC0+am9pbignY2hhcnRfb2ZfYWNjb3VudHMnLCAnY2hhcnRfb2ZfYWNjb3VudHMuaWQnLCAnPScsICdlbnRyeV9pdGVtcy5jaGFydF9vZl9hY2NvdW50X2lkJykKICAgIC8vICAgICAgICAgLT53aGVyZUNvbHVtbignZW50cnlfaXRlbXMuZW50cnlfaWQnLCAnZW50cmllcy5pZCcpCiAgICAvLyAgICAgICAgIC0+dGFrZSgxKQogICAgLy8gICAgICk7CiAgICAvLyB9KQogICAgLy8gLT5hZGRDb2x1bW4oJ2NyZWRpdF9sZWRnZXInLCBmdW5jdGlvbiAoJGVudHJ5KSB7CiAgICAvLyAgICAgcmV0dXJuICc8YSBjbGFzcz0idGV4dC1wcmltYXJ5IiBvbmNsaWNrPSJnZXRTaG9ydERldGFpbHMoJCh0aGlzKSkiIGRhdGEtaWQ9IicgLiAoJGVudHJ5LT5pZCkgLiAnIiBkYXRhLWVudHJ5LXR5cGU9IicgLiAoJGVudHJ5LT5lbnRyeVR5cGUtPm5hbWUpIC4gJyIgZGF0YS1jb2RlPSInIC4gKCRlbnRyeS0+Y29kZSkgLiAnIj4KICAgIC8vICAgICAgICAgICAgIDxwIHN0eWxlPSJ3aWR0aDogMTUwcHg7d2hpdGUtc3BhY2U6IG5vcm1hbCI+JyAuIGltcGxvZGUoJywgJywgYXJyYXlfdW5pcXVlKCRlbnRyeS0+aXRlbXMtPndoZXJlKCdkZWJpdF9jcmVkaXQnLCAnQycpLT5wbHVjaygnY2hhcnRPZkFjY291bnQuY29kZScpLT50b0FycmF5KCkpKSAuICc8L3A+CiAgICAvLyAgICAgICAgIDwvYT4nOwogICAgLy8gfSkKICAgIC8vIC0+ZmlsdGVyQ29sdW1uKCdjcmVkaXRfbGVkZ2VyJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgIC8vICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnaXRlbXMuY2hhcnRPZkFjY291bnQnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAvLyAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2NvZGUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgIC8vICAgICB9KQogICAgLy8gICAgICAgICAtPndoZXJlSGFzKCdpdGVtcycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgIC8vICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2RlYml0X2NyZWRpdCcsICdDJyk7CiAgICAvLyAgICAgICAgIH0pOwogICAgLy8gfSkKICAgIC8vIC0+b3JkZXJDb2x1bW4oJ2NyZWRpdF9sZWRnZXInLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgIC8vICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBFbnRyeUl0ZW06OnNlbGVjdCgnY2hhcnRfb2ZfYWNjb3VudHMuY29kZScpCiAgICAvLyAgICAgICAgIC0+am9pbignY2hhcnRfb2ZfYWNjb3VudHMnLCAnY2hhcnRfb2ZfYWNjb3VudHMuaWQnLCAnPScsICdlbnRyeV9pdGVtcy5jaGFydF9vZl9hY2NvdW50X2lkJykKICAgIC8vICAgICAgICAgLT53aGVyZUNvbHVtbignZW50cnlfaXRlbXMuZW50cnlfaWQnLCAnZW50cmllcy5pZCcpCiAgICAvLyAgICAgICAgIC0+dGFrZSgxKQogICAgLy8gICAgICk7CiAgICAvLyB9KQp9Cg==