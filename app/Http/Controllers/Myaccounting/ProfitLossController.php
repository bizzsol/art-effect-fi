<?php
bolt_decrypt( __FILE__ , 'n6TTAs'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcTXlhY2NvdW50aW5nOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKCnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQ29tcGFueTsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xQcm9maXRDZW50cmU7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQ29zdENlbnRyZTsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xBY2NvdW50R3JvdXA7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcRmlzY2FsWWVhcjsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xFbnRyeVR5cGU7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcVGFnOwp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXENoYXJ0T2ZBY2NvdW50Owp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEVudHJ5Owp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEVudHJ5SXRlbTsKCnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQ3VycmVuY3lUeXBlOwp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEN1cnJlbmN5Owp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEV4Y2hhbmdlUmF0ZTsKCnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcRmlzY2FsWWVhckNsb3Npbmc7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcRmlzY2FsWWVhckNsb3NpbmdMZWRnZXI7Cgp1c2UgQXBwLCBEQjsKdXNlIElsbHVtaW5hdGVcU3VwcG9ydFxGYWNhZGVzXEF1dGg7CgpjbGFzcyBQcm9maXRMb3NzQ29udHJvbGxlciBleHRlbmRzIENvbnRyb2xsZXIKewogICAgcHVibGljIGZ1bmN0aW9uIGluZGV4KFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJHRpdGxlID0gJ1RyYWRpbmcgYW5kIFByb2ZpdCAmIExvc3MgU3RhdGVtZW50JzsKICAgICAgICAgICAgCiAgICAgICAgICAgICRmaXNjYWxZZWFyID0gZ2V0QWN0aXZlRmlzY2FsWWVhcigpOwogICAgICAgICAgICAkYWNjb3VudERlZmF1bHRTZXR0aW5ncyA9IGFjY291bnREZWZhdWx0U2V0dGluZ3MoKTsKICAgICAgICAgICAgJHN5c3RlbUN1cnJlbmN5ID0gc3lzdGVtQ3VycmVuY3koKTsKCiAgICAgICAgICAgICRpbmNvbWVzID0gJyc7CiAgICAgICAgICAgICRleHBlbnNlcyA9ICcnOwogICAgICAgICAgICAkZ3JvdXBXaXNlID0gZmFsc2U7CiAgICAgICAgICAgIGlmKHJlcXVlc3QoKS0+aGFzKCdyZXBvcnRfdHlwZScpKXsKCiAgICAgICAgICAgICAgICAkY3VycmVuY3lfaWQgPSByZXF1ZXN0KCktPmhhcygnY3VycmVuY3lfaWQnKSA/IHJlcXVlc3QoKS0+Z2V0KCdjdXJyZW5jeV9pZCcpIDogMDsKICAgICAgICAgICAgICAgICRjb21wYW55X2lkID0gcmVxdWVzdCgpLT5oYXMoJ2NvbXBhbnlfaWQnKSA/IHJlcXVlc3QoKS0+Z2V0KCdjb21wYW55X2lkJykgOiAwOwogICAgICAgICAgICAgICAgJHByb2ZpdF9jZW50cmVfaWQgPSByZXF1ZXN0KCktPmhhcygncHJvZml0X2NlbnRyZV9pZCcpID8gcmVxdWVzdCgpLT5nZXQoJ3Byb2ZpdF9jZW50cmVfaWQnKSA6IDA7CiAgICAgICAgICAgICAgICAkY29zdF9jZW50cmVfaWQgPSByZXF1ZXN0KCktPmhhcygnY29zdF9jZW50cmVfaWQnKSA/IHJlcXVlc3QoKS0+Z2V0KCdjb3N0X2NlbnRyZV9pZCcpIDogMDsKICAgICAgICAgICAgICAgICRmaXNjYWxfeWVhcl9pZCA9IHJlcXVlc3QoKS0+aGFzKCdmaXNjYWxfeWVhcl9pZCcpID8gcmVxdWVzdCgpLT5nZXQoJ2Zpc2NhbF95ZWFyX2lkJykgOiAwOwogICAgICAgICAgICAgICAgJGZpc2NhbFllYXIgPSBGaXNjYWxZZWFyOjpmaW5kT3JGYWlsKCRmaXNjYWxfeWVhcl9pZCk7CiAgICAgICAgICAgICAgICAkYWxsID0gZ2V0QWxsR3JvdXBBbmRMZWRnZXJzKCk7CgogICAgICAgICAgICAgICAgJHJhdGUgPSAxOwogICAgICAgICAgICAgICAgaWYoJHN5c3RlbUN1cnJlbmN5LT5pZCAhPSAkY3VycmVuY3lfaWQpewogICAgICAgICAgICAgICAgICAgICRyYXRlcyA9IGdldEV4Y2hhbmdlUmF0ZXMoJHN5c3RlbUN1cnJlbmN5LT5pZCk7CiAgICAgICAgICAgICAgICAgICAgJHJhdGUgPSBpc3NldCgkcmF0ZXNbJ3JhdGVzJ11bJGN1cnJlbmN5X2lkXVsncmF0ZSddKSA/ICRyYXRlc1sncmF0ZXMnXVskY3VycmVuY3lfaWRdWydyYXRlJ10gOiAxOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRkZWJpdEVudHJ5SXRlbXMgPSBFbnRyeUl0ZW06OmpvaW4oJ2VudHJpZXMnLCAnZW50cmllcy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmVudHJ5X2lkJykKICAgICAgICAgICAgICAgIC0+am9pbignY29zdF9jZW50cmVzJywgJ2Nvc3RfY2VudHJlcy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmNvc3RfY2VudHJlX2lkJykKICAgICAgICAgICAgICAgIC0+am9pbigncHJvZml0X2NlbnRyZXMnLCAncHJvZml0X2NlbnRyZXMuaWQnLCAnPScsICdjb3N0X2NlbnRyZXMucHJvZml0X2NlbnRyZV9pZCcpCgogICAgICAgICAgICAgICAgLT5qb2luKCdjaGFydF9vZl9hY2NvdW50cycsICdjaGFydF9vZl9hY2NvdW50cy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmNoYXJ0X29mX2FjY291bnRfaWQnKQogICAgICAgICAgICAgICAgLT5qb2luKCdhY2NvdW50X2dyb3VwcycsICdhY2NvdW50X2dyb3Vwcy5pZCcsICc9JywgJ2NoYXJ0X29mX2FjY291bnRzLmFjY291bnRfZ3JvdXBfaWQnKQoKICAgICAgICAgICAgICAgIC0+d2hlcmVJbignYWNjb3VudF9ncm91cHMuYWNjb3VudF9jbGFzc19pZCcsIFs0LCA1XSkKCiAgICAgICAgICAgICAgICAtPndoZXJlKCdlbnRyaWVzLmlzX2FwcHJvdmVkJywgJ2FwcHJvdmVkJykKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJpZXMuZGF0ZScsICc+PScsICRyZXF1ZXN0LT5mcm9tKQogICAgICAgICAgICAgICAgLT53aGVyZSgnZW50cmllcy5kYXRlJywgJzw9JywgJHJlcXVlc3QtPnRvKQogICAgICAgICAgICAgICAgLT53aGVyZSgnZW50cmllcy5maXNjYWxfeWVhcl9pZCcsICRmaXNjYWxfeWVhcl9pZCkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3Byb2ZpdF9jZW50cmVzLmNvbXBhbnlfaWQnLCAkY29tcGFueV9pZCkKCiAgICAgICAgICAgICAgICAtPndoZW4oJHByb2ZpdF9jZW50cmVfaWQgPiAwLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcHJvZml0X2NlbnRyZV9pZCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2Nvc3RfY2VudHJlcy5wcm9maXRfY2VudHJlX2lkJywgJHByb2ZpdF9jZW50cmVfaWQpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbigkY29zdF9jZW50cmVfaWQgPiAwLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkY29zdF9jZW50cmVfaWQpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdlbnRyeV9pdGVtcy5jb3N0X2NlbnRyZV9pZCcsICRjb3N0X2NlbnRyZV9pZCk7CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJ5X2l0ZW1zLmRlYml0X2NyZWRpdCcsICdEJykKCiAgICAgICAgICAgICAgICAtPmdyb3VwQnkoJ2VudHJ5X2l0ZW1zLmNoYXJ0X29mX2FjY291bnRfaWQnKQoKICAgICAgICAgICAgICAgIC0+Z2V0KFsKICAgICAgICAgICAgICAgICAgICAnZW50cnlfaXRlbXMuY2hhcnRfb2ZfYWNjb3VudF9pZCcsCiAgICAgICAgICAgICAgICAgICAgREI6OnJhdygnc3VtKGVudHJ5X2l0ZW1zLnJlcG9ydGluZ19hbW91bnQpIGFzIHJlcG9ydGluZ19hbW91bnQnKQogICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgJGNyZWRpdEVudHJ5SXRlbXMgPSBFbnRyeUl0ZW06OmpvaW4oJ2VudHJpZXMnLCAnZW50cmllcy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmVudHJ5X2lkJykKICAgICAgICAgICAgICAgIC0+am9pbignY29zdF9jZW50cmVzJywgJ2Nvc3RfY2VudHJlcy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmNvc3RfY2VudHJlX2lkJykKICAgICAgICAgICAgICAgIC0+am9pbigncHJvZml0X2NlbnRyZXMnLCAncHJvZml0X2NlbnRyZXMuaWQnLCAnPScsICdjb3N0X2NlbnRyZXMucHJvZml0X2NlbnRyZV9pZCcpCgogICAgICAgICAgICAgICAgLT5qb2luKCdjaGFydF9vZl9hY2NvdW50cycsICdjaGFydF9vZl9hY2NvdW50cy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmNoYXJ0X29mX2FjY291bnRfaWQnKQogICAgICAgICAgICAgICAgLT5qb2luKCdhY2NvdW50X2dyb3VwcycsICdhY2NvdW50X2dyb3Vwcy5pZCcsICc9JywgJ2NoYXJ0X29mX2FjY291bnRzLmFjY291bnRfZ3JvdXBfaWQnKQoKICAgICAgICAgICAgICAgIC0+d2hlcmVJbignYWNjb3VudF9ncm91cHMuYWNjb3VudF9jbGFzc19pZCcsIFs0LCA1XSkKCiAgICAgICAgICAgICAgICAtPndoZXJlKCdlbnRyaWVzLmlzX2FwcHJvdmVkJywgJ2FwcHJvdmVkJykKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJpZXMuZGF0ZScsICc+PScsICRyZXF1ZXN0LT5mcm9tKQogICAgICAgICAgICAgICAgLT53aGVyZSgnZW50cmllcy5kYXRlJywgJzw9JywgJHJlcXVlc3QtPnRvKQogICAgICAgICAgICAgICAgLT53aGVyZSgnZW50cmllcy5maXNjYWxfeWVhcl9pZCcsICRmaXNjYWxfeWVhcl9pZCkKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ3Byb2ZpdF9jZW50cmVzLmNvbXBhbnlfaWQnLCAkY29tcGFueV9pZCkKCiAgICAgICAgICAgICAgICAtPndoZW4oJHByb2ZpdF9jZW50cmVfaWQgPiAwLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcHJvZml0X2NlbnRyZV9pZCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2Nvc3RfY2VudHJlcy5wcm9maXRfY2VudHJlX2lkJywgJHByb2ZpdF9jZW50cmVfaWQpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbigkY29zdF9jZW50cmVfaWQgPiAwLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkY29zdF9jZW50cmVfaWQpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdlbnRyeV9pdGVtcy5jb3N0X2NlbnRyZV9pZCcsICRjb3N0X2NlbnRyZV9pZCk7CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJ5X2l0ZW1zLmRlYml0X2NyZWRpdCcsICdDJykKCiAgICAgICAgICAgICAgICAtPmdyb3VwQnkoJ2VudHJ5X2l0ZW1zLmNoYXJ0X29mX2FjY291bnRfaWQnKQoKICAgICAgICAgICAgICAgIC0+Z2V0KFsKICAgICAgICAgICAgICAgICAgICAnZW50cnlfaXRlbXMuY2hhcnRfb2ZfYWNjb3VudF9pZCcsCiAgICAgICAgICAgICAgICAgICAgREI6OnJhdygnc3VtKGVudHJ5X2l0ZW1zLnJlcG9ydGluZ19hbW91bnQpIGFzIHJlcG9ydGluZ19hbW91bnQnKQogICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgJGNhcnJ5Rm9yd2FyZGVkID0gRmlzY2FsWWVhckNsb3NpbmdMZWRnZXI6OmpvaW4oJ2Zpc2NhbF95ZWFyX2Nsb3NpbmdzJywgJ2Zpc2NhbF95ZWFyX2Nsb3NpbmdzLmlkJywgJz0nLCAnZmlzY2FsX3llYXJfY2xvc2luZ19sZWRnZXJzLmZpc2NhbF95ZWFyX2Nsb3NpbmdfaWQnKQoKICAgICAgICAgICAgICAgIC0+am9pbignY2hhcnRfb2ZfYWNjb3VudHMnLCAnY2hhcnRfb2ZfYWNjb3VudHMuaWQnLCAnPScsICdmaXNjYWxfeWVhcl9jbG9zaW5nX2xlZGdlcnMuY2hhcnRfb2ZfYWNjb3VudF9pZCcpCiAgICAgICAgICAgICAgICAtPmpvaW4oJ2FjY291bnRfZ3JvdXBzJywgJ2FjY291bnRfZ3JvdXBzLmlkJywgJz0nLCAnY2hhcnRfb2ZfYWNjb3VudHMuYWNjb3VudF9ncm91cF9pZCcpCgogICAgICAgICAgICAgICAgLT53aGVyZUluKCdhY2NvdW50X2dyb3Vwcy5hY2NvdW50X2NsYXNzX2lkJywgWzQsIDVdKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAtPndoZXJlKCdmaXNjYWxfeWVhcl9jbG9zaW5ncy5jb21wYW55X2lkJywgJGNvbXBhbnlfaWQpCiAgICAgICAgICAgICAgICAtPndoZXJlKCdmaXNjYWxfeWVhcl9jbG9zaW5ncy50b19maXNjYWxfeWVhcl9pZCcsICRmaXNjYWxZZWFyLT5pZCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLT5ncm91cEJ5KCdmaXNjYWxfeWVhcl9jbG9zaW5nX2xlZGdlcnMuY2hhcnRfb2ZfYWNjb3VudF9pZCcpCgogICAgICAgICAgICAgICAgLT5nZXQoWwogICAgICAgICAgICAgICAgICAgICdmaXNjYWxfeWVhcl9jbG9zaW5nX2xlZGdlcnMuY2hhcnRfb2ZfYWNjb3VudF9pZCcsCiAgICAgICAgICAgICAgICAgICAgREI6OnJhdygnc3VtKGZpc2NhbF95ZWFyX2Nsb3NpbmdfbGVkZ2Vycy5jYXJyeV9mb3J3YXJkaW5nX2Ftb3VudCkgYXMgY2FycnlfZm9yd2FyZGluZ19hbW91bnQnKQogICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgJGluY29tZUdyb3VwcyA9IEFjY291bnRHcm91cDo6ZG9lc250SGF2ZSgncGFyZW50JyktPndoZXJlSW4oJ2FjY291bnRfY2xhc3NfaWQnLCBbNF0pLT5nZXQoKTsKICAgICAgICAgICAgICAgICRleHBlbnNlR3JvdXBzID0gQWNjb3VudEdyb3VwOjpkb2VzbnRIYXZlKCdwYXJlbnQnKS0+d2hlcmVJbignYWNjb3VudF9jbGFzc19pZCcsIFs1XSktPmdldCgpOwoKICAgICAgICAgICAgICAgICRpbmNvbWVCYWxhbmNlcyA9IFtdOwogICAgICAgICAgICAgICAgJGV4cGVuc2VCYWxhbmNlcyA9IFtdOwoKICAgICAgICAgICAgICAgICRncm91cFdpc2UgPSAoJHJlcXVlc3QtPmdyb3VwX3dpc2UgPT0gMSk7CiAgICAgICAgICAgICAgICBpZigkZ3JvdXBXaXNlKXsKICAgICAgICAgICAgICAgICAgICBpZigkaW5jb21lR3JvdXBzLT5jb3VudCgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2goJGluY29tZUdyb3VwcyBhcyAka2V5ID0+ICRncm91cCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaW5jb21lcyAuPSBiYWxhbmNlU2hlZXQoJGNvbXBhbnlfaWQsICRncm91cCwgJHJlcXVlc3QtPmZyb20sICRyZXF1ZXN0LT50bywgMCwgIShyZXF1ZXN0KCktPmhhcygncmVwb3J0X3R5cGUnKSAmJiAkcmVxdWVzdC0+cmVwb3J0X3R5cGUgPT0gJ3BkZicpLCBbJ0QnID0+ICRkZWJpdEVudHJ5SXRlbXMsICdDJyA9PiAkY3JlZGl0RW50cnlJdGVtc10sICRhbGwsICRjYXJyeUZvcndhcmRlZCwgJHJhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgJGNoYXJ0T2ZBY2NvdW50cyA9IENoYXJ0T2ZBY2NvdW50Ojp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ2FjY291bnRHcm91cC5hY2NvdW50Q2xhc3MnCiAgICAgICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdhY2NvdW50R3JvdXAnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdhY2NvdW50X2NsYXNzX2lkJywgWzRdKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJCeSgnY29kZScsICdhc2MnKS0+Z2V0KCk7CiAgICAgICAgICAgICAgICAgICAgaWYoJGNoYXJ0T2ZBY2NvdW50cy0+Y291bnQoKSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCRjaGFydE9mQWNjb3VudHMgYXMgJGtleSA9PiAkYWNjb3VudCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYmFsYW5jZVNoZWV0TGVkZ2VyID0gYmFsYW5jZVNoZWV0TGVkZ2VyKCRjb21wYW55X2lkLCAkYWNjb3VudCwgJHJlcXVlc3QtPmZyb20sICRyZXF1ZXN0LT50bywgMCwgIShyZXF1ZXN0KCktPmhhcygncmVwb3J0X3R5cGUnKSAmJiAkcmVxdWVzdC0+cmVwb3J0X3R5cGUgPT0gJ3BkZicpLCBbJ0QnID0+ICRkZWJpdEVudHJ5SXRlbXMsICdDJyA9PiAkY3JlZGl0RW50cnlJdGVtc10sICRhbGwsICRjYXJyeUZvcndhcmRlZCwgJHJhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaW5jb21lcyAuPSAkYmFsYW5jZVNoZWV0TGVkZ2VyWydkYXRhJ107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRpbmNvbWVCYWxhbmNlcywgJGJhbGFuY2VTaGVldExlZGdlclsnYmFsYW5jZSddKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgJGluY29tZXMgLj0gJzx0cj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjb2xzcGFuPSIyIj48c3Ryb25nPlRvdGFsICcuJGluY29tZUdyb3Vwcy0+cGx1Y2soJ25hbWUnKS0+aW1wbG9kZSgnLCAnKS4nOjwvc3Ryb25nPjwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9ImNsb3NpbmdfYmFsYW5jZV9jb2x1bW4iIHN0eWxlPSJ0ZXh0LWFsaWduOiByaWdodCI+PHN0cm9uZz4nLnN5c3RlbU1vbmV5Rm9ybWF0KGFycmF5X3N1bSgkaW5jb21lQmFsYW5jZXMpKS4nPC9zdHJvbmc+PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgPC90cj4nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZigkZ3JvdXBXaXNlKXsKICAgICAgICAgICAgICAgICAgICBpZigkZXhwZW5zZUdyb3Vwcy0+Y291bnQoKSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCRleHBlbnNlR3JvdXBzIGFzICRrZXkgPT4gJGdyb3VwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRleHBlbnNlcyAuPSBiYWxhbmNlU2hlZXQoJGNvbXBhbnlfaWQsICRncm91cCwgJHJlcXVlc3QtPmZyb20sICRyZXF1ZXN0LT50bywgMCwgIShyZXF1ZXN0KCktPmhhcygncmVwb3J0X3R5cGUnKSAmJiAkcmVxdWVzdC0+cmVwb3J0X3R5cGUgPT0gJ3BkZicpLCBbJ0QnID0+ICRkZWJpdEVudHJ5SXRlbXMsICdDJyA9PiAkY3JlZGl0RW50cnlJdGVtc10sICRhbGwsICRjYXJyeUZvcndhcmRlZCwgJHJhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgJGNoYXJ0T2ZBY2NvdW50cyA9IENoYXJ0T2ZBY2NvdW50Ojp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ2FjY291bnRHcm91cC5hY2NvdW50Q2xhc3MnCiAgICAgICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdhY2NvdW50R3JvdXAnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdhY2NvdW50X2NsYXNzX2lkJywgWzVdKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJCeSgnY29kZScsICdhc2MnKS0+Z2V0KCk7CiAgICAgICAgICAgICAgICAgICAgaWYoJGNoYXJ0T2ZBY2NvdW50cy0+Y291bnQoKSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCRjaGFydE9mQWNjb3VudHMgYXMgJGtleSA9PiAkYWNjb3VudCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYmFsYW5jZVNoZWV0TGVkZ2VyID0gYmFsYW5jZVNoZWV0TGVkZ2VyKCRjb21wYW55X2lkLCAkYWNjb3VudCwgJHJlcXVlc3QtPmZyb20sICRyZXF1ZXN0LT50bywgMCwgIShyZXF1ZXN0KCktPmhhcygncmVwb3J0X3R5cGUnKSAmJiAkcmVxdWVzdC0+cmVwb3J0X3R5cGUgPT0gJ3BkZicpLCBbJ0QnID0+ICRkZWJpdEVudHJ5SXRlbXMsICdDJyA9PiAkY3JlZGl0RW50cnlJdGVtc10sICRhbGwsICRjYXJyeUZvcndhcmRlZCwgJHJhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZXhwZW5zZXMgLj0gJGJhbGFuY2VTaGVldExlZGdlclsnZGF0YSddOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkZXhwZW5zZUJhbGFuY2VzLCAkYmFsYW5jZVNoZWV0TGVkZ2VyWydiYWxhbmNlJ10pOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAkZXhwZW5zZXMgLj0gJzx0cj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjb2xzcGFuPSIyIj48c3Ryb25nPlRvdGFsICcuJGV4cGVuc2VHcm91cHMtPnBsdWNrKCduYW1lJyktPmltcGxvZGUoJywgJykuJzo8L3N0cm9uZz48L3RkPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJjbG9zaW5nX2JhbGFuY2VfY29sdW1uIiBzdHlsZT0idGV4dC1hbGlnbjogcmlnaHQiPjxzdHJvbmc+Jy5zeXN0ZW1Nb25leUZvcm1hdChhcnJheV9zdW0oJGV4cGVuc2VCYWxhbmNlcykpLic8L3N0cm9uZz48L3RkPgogICAgICAgICAgICAgICAgICAgICAgICA8L3RyPic7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAkY29tcGFuaWVzID0gQ29tcGFueTo6aGFzKCdwcm9maXRDZW50cmVzLmNvc3RDZW50cmVzJykKICAgICAgICAgICAgLT53aGVyZUhhcygndXNlcnMnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3VzZXJfaWQnLCBhdXRoKCktPnVzZXIoKS0+aWQpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAgICAgJGRhdGEgPSBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICR0aXRsZSwKICAgICAgICAgICAgICAgICdjdXJyZW5jeVR5cGVzJyA9PiBDdXJyZW5jeVR5cGU6OndpdGgoJ2N1cnJlbmNpZXMnKS0+Z2V0KCksCiAgICAgICAgICAgICAgICAnY3VycmVuY3knID0+IEN1cnJlbmN5OjpmaW5kKHJlcXVlc3QoKS0+Z2V0KCdjdXJyZW5jeV9pZCcpKSwKICAgICAgICAgICAgICAgICdpbmNvbWVHcm91cHMnID0+IGlzc2V0KCRpbmNvbWVHcm91cHMpID8gJGluY29tZUdyb3VwcyA6IFtdLAogICAgICAgICAgICAgICAgJ2V4cGVuc2VHcm91cHMnID0+IGlzc2V0KCRleHBlbnNlR3JvdXBzKSA/ICRleHBlbnNlR3JvdXBzIDogW10sCiAgICAgICAgICAgICAgICAnZ3JvdXBXaXNlJyA9PiAkZ3JvdXBXaXNlLAogICAgICAgICAgICAgICAgJ2luY29tZXMnID0+ICRpbmNvbWVzLAogICAgICAgICAgICAgICAgJ2V4cGVuc2VzJyA9PiAkZXhwZW5zZXMsCiAgICAgICAgICAgICAgICAnZmlzY2FsWWVhcicgPT4gJGZpc2NhbFllYXIsCiAgICAgICAgICAgICAgICAnYWNjb3VudERlZmF1bHRTZXR0aW5ncycgPT4gJGFjY291bnREZWZhdWx0U2V0dGluZ3MsCiAgICAgICAgICAgICAgICAnY29tcGFuaWVzJyA9PiAkY29tcGFuaWVzLAogICAgICAgICAgICAgICAgJ3Byb2ZpdENlbnRyZXMnID0+IFByb2ZpdENlbnRyZTo6d2hlcmUoJ2NvbXBhbnlfaWQnLCAkY29tcGFuaWVzLT5maXJzdCgpLT5pZCktPm9yZGVyQnkoJ2NvZGUnLCAnYXNjJyktPmdldCgpLAogICAgICAgICAgICAgICAgJ2Zpc2NhbFllYXJzJyA9PiBGaXNjYWxZZWFyOjphbGwoKSwKICAgICAgICAgICAgXTsKCiAgICAgICAgICAgIGlmKHJlcXVlc3QoKS0+aGFzKCdyZXBvcnRfdHlwZScpICYmIHJlcXVlc3QoKS0+Z2V0KCdyZXBvcnRfdHlwZScpID09ICdwZGYnKXsKICAgICAgICAgICAgICAgIHJldHVybiB2aWV3TVBERignYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLnJlcG9ydHMucHJvZml0TG9zcy5wZGYnLCAkZGF0YSwgJHRpdGxlLCAkdGl0bGUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZihyZXF1ZXN0KCktPmhhcygncmVwb3J0X3R5cGUnKSAmJiByZXF1ZXN0KCktPmdldCgncmVwb3J0X3R5cGUnKSA9PSAncmVwb3J0Jyl7CiAgICAgICAgICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLnJlcG9ydHMucHJvZml0TG9zcy5yZXBvcnQnLCAkZGF0YSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMucmVwb3J0cy5wcm9maXRMb3NzLmluZGV4JywgJGRhdGEpOwogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICBpZihyZXF1ZXN0KCktPmhhcygncmVwb3J0X3R5cGUnKSAmJiByZXF1ZXN0KCktPmdldCgncmVwb3J0X3R5cGUnKSA9PSAncmVwb3J0Jyl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHRoLT5nZXRNZXNzYWdlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQp9Cg==