<?php
bolt_decrypt( __FILE__ , 'XrHAlA'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcTXlhY2NvdW50aW5nXEludGVncmF0aW9uOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKdXNlIEFwcCwgREIsIERhdGFUYWJsZXM7Cgp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXENvbXBhbnk7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQ29zdENlbnRyZTsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xFbnRyeVR5cGU7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQ3VycmVuY3k7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQ2hhcnRPZkFjY291bnQ7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcRXhjaGFuZ2VSYXRlOwp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEVudHJ5TG9nOwp1c2UgXEFwcFxNb2RlbHNcSW50ZWdyYXRpb25cU291cmNlOwp1c2UgXEFwcFxNb2RlbHNcSW50ZWdyYXRpb25cQ29udHJvbFBvaW50Owp1c2UgXEFwcFxNb2RlbHNcSW50ZWdyYXRpb25cRW50cnlQb2ludDsKdXNlIFxBcHBcTW9kZWxzXEludGVncmF0aW9uXFJlcXVpcmVtZW50Owp1c2UgXEFwcFxNb2RlbHNcSW50ZWdyYXRpb25cUHJvY2VzczsKdXNlIFxBcHBcTW9kZWxzXEludGVncmF0aW9uXFN1YlByb2Nlc3M7CnVzZSBcQXBwXE1vZGVsc1xJbnRlZ3JhdGlvblxTdWJQcm9jZXNzTGVkZ2VyOwp1c2UgXEFwcFxNb2RlbHNcSW50ZWdyYXRpb25cRW50cnlQb2ludExlZGdlcjsKdXNlIFxBcHBcTW9kZWxzXEludGVncmF0aW9uXFRyYW5zYWN0aW9uOwp1c2UgXEFwcFxNb2RlbHNcSW50ZWdyYXRpb25cVHJhbnNhY3Rpb25FbnRyeTsKdXNlIFxBcHBcTW9kZWxzXEludGVncmF0aW9uXFRyYW5zYWN0aW9uTG9nOwoKY2xhc3MgVHJhbnNhY3Rpb25Db250cm9sbGVyIGV4dGVuZHMgQ29udHJvbGxlcgp7CiAgICAvKioKICAgICAqIFNldCBnbG9iYWwgZGF0YSB0YWJsZSBoZWFkZXJzLgogICAgICoKICAgICAqIEByZXR1cm4gaGVhZGVyQ29sdW1ucwogICAgICovCiAgICAgcHVibGljIGZ1bmN0aW9uIGhlYWRlckNvbHVtbnMoJHZhbHVlPScnKQogICAgIHsKICAgICAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgICAgIFsnU0wnLCAnU0wnXSwKICAgICAgICAgICAgWydwcm9jZXNzJywgJ3Byb2Nlc3MnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydzdWJfcHJvY2VzcycsICdzdWJfcHJvY2VzcycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2RhdGV0aW1lJywgJ2RhdGV0aW1lJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnY3VycmVuY3knLCAnY3VycmVuY3knLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydhbW91bnQnLCAnYW1vdW50JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsndHJhbnNhY3Rpb25zJywgJ3RyYW5zYWN0aW9ucyddLAogICAgICAgICAgICBbJ2Zpc2NhbF95ZWFycycsICdmaXNjYWxfeWVhcnMnXSwKICAgICAgICAgICAgWydmaXNjYWxfeWVhcl9vcGVuaW5ncycsICdmaXNjYWxfeWVhcl9vcGVuaW5ncyddLAogICAgICAgICAgICBbJ2xvZ3MnLCAnbG9ncycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGluZGV4KCkKICAgIHsKICAgICAgICBpZihyZXF1ZXN0KCktPmhhcygndHJhbnNhY3Rpb24tZGV0YWlscycpKXsKICAgICAgICAgICAgJHRyYW5zYWN0aW9uID0gVHJhbnNhY3Rpb246OndpdGgoWwogICAgICAgICAgICAgICAgJ3N1YlByb2Nlc3MucHJvY2VzcycsCiAgICAgICAgICAgICAgICAnZW50cmllcy5lbnRyeS5lbnRyeVR5cGUnLAogICAgICAgICAgICAgICAgJ2VudHJpZXMuZW50cnkuaXRlbXMuY29zdENlbnRyZS5wcm9maXRDZW50cmUuY29tcGFueScsCiAgICAgICAgICAgICAgICAnZW50cmllcy5lbnRyeS5sb2dzJywKICAgICAgICAgICAgICAgICdsb2dzJywKICAgICAgICAgICAgICAgICdleGNoYW5nZVJhdGUuY3VycmVuY3knCiAgICAgICAgICAgIF0pLT5maW5kT3JGYWlsKHJlcXVlc3QoKS0+Z2V0KCd0cmFuc2FjdGlvbl9pZCcpKTsKCiAgICAgICAgICAgICR0cmFuc2FjdGlvbl9sb2dzID0gW107CiAgICAgICAgICAgIGlmKGlzc2V0KCR0cmFuc2FjdGlvbi0+bG9nc1swXSkpewogICAgICAgICAgICAgICAgZm9yZWFjaCgkdHJhbnNhY3Rpb24tPmxvZ3MgYXMgJGxvZyl7CiAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkdHJhbnNhY3Rpb25fbG9ncywgWwogICAgICAgICAgICAgICAgICAgICAgICAncmVxdWVzdCcgPT4ganNvbl9kZWNvZGUoJGxvZy0+cmVxdWVzdCwgdHJ1ZSksCiAgICAgICAgICAgICAgICAgICAgICAgICdsb2dzJyA9PiBqc29uX2RlY29kZShqc29uX2RlY29kZSgkbG9nLT5yZXF1ZXN0LCB0cnVlKVsnbG9ncyddLCB0cnVlKQogICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAkZW50cnlfbG9ncyA9IFtdOwogICAgICAgICAgICAkbG9ncyA9IEVudHJ5TG9nOjp3aGVyZSgnZW50cnlfaWQnLCAkdHJhbnNhY3Rpb24tPmVudHJpZXMtPnBsdWNrKCdlbnRyeV9pZCcpLT50b0FycmF5KCkpLT5nZXQoKTsKICAgICAgICAgICAgaWYoaXNzZXQoJGxvZ3NbMF0pKXsKICAgICAgICAgICAgICAgIGZvcmVhY2goJGxvZ3MgYXMgJGxvZyl7CiAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkZW50cnlfbG9ncywgWwogICAgICAgICAgICAgICAgICAgICAgICAnbG9nJyA9PiAkbG9nLAogICAgICAgICAgICAgICAgICAgICAgICAndmFsdWUnID0+IGpzb25fZGVjb2RlKCRsb2ctPnZhbHVlLCB0cnVlKQogICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAgICAgJ3RyYW5zYWN0aW9uJyA9PiAkdHJhbnNhY3Rpb24sCiAgICAgICAgICAgICAgICAnbG9ncycgPT4gJHRyYW5zYWN0aW9uLT5sb2dzLAogICAgICAgICAgICAgICAgJ3RyYW5zYWN0aW9uX2xvZ3MnID0+ICR0cmFuc2FjdGlvbl9sb2dzLAogICAgICAgICAgICAgICAgJ2VudHJ5X2xvZ3MnID0+ICRlbnRyeV9sb2dzLAogICAgICAgICAgICBdOwogICAgICAgIH0KCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+YWpheCgpKSB7CiAgICAgICAgICAgICAgICAkY29zdENlbnRyZXMgPSBbXTsKICAgICAgICAgICAgICAgIGlmKHJlcXVlc3QoKS0+Z2V0KCdjb21wYW55X2lkJykgPiAwKXsKICAgICAgICAgICAgICAgICAgICAkY29zdENlbnRyZXMgPSBDb3N0Q2VudHJlOjp3aGVyZUhhcygncHJvZml0Q2VudHJlJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2NvbXBhbnlfaWQnLCByZXF1ZXN0KCktPmdldCgnY29tcGFueV9pZCcpKTsKICAgICAgICAgICAgICAgICAgICB9KS0+cGx1Y2soJ2lkJyktPnRvQXJyYXkoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBEYXRhdGFibGVzOjpvZigKICAgICAgICAgICAgICAgICAgICBUcmFuc2FjdGlvbjo6d2l0aChbCiAgICAgICAgICAgICAgICAgICAgICAgICdzdWJQcm9jZXNzLnByb2Nlc3MnLAogICAgICAgICAgICAgICAgICAgICAgICAnZW50cmllcy5lbnRyeS5lbnRyeVR5cGUnLAogICAgICAgICAgICAgICAgICAgICAgICAnZW50cmllcy5lbnRyeS5maXNjYWxZZWFyJywKICAgICAgICAgICAgICAgICAgICAgICAgJ2VudHJpZXMuZW50cnkuZmlzY2FsWWVhck9wZW5pbmdFbnRyaWVzLmZpc2NhbFllYXJPcGVuaW5nJywKICAgICAgICAgICAgICAgICAgICAgICAgJ2xvZ3MnLAogICAgICAgICAgICAgICAgICAgICAgICAnZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JwogICAgICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAgICAgLT53aGVuKHJlcXVlc3QoKS0+Z2V0KCdjb21wYW55X2lkJykgPiAwLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkY29zdENlbnRyZXMpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnZW50cmllcy5lbnRyeS5pdGVtcycsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRjb3N0Q2VudHJlcyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdjb3N0X2NlbnRyZV9pZCcsICRjb3N0Q2VudHJlcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5vcmRlcmJ5KCdpZCcsICdkZXNjJyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQoKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdwcm9jZXNzJywgZnVuY3Rpb24gKCR0cmFuc2FjdGlvbikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkdHJhbnNhY3Rpb24tPnN1YlByb2Nlc3MtPnByb2Nlc3MtPmNvZGUuJyB8ICcuJHRyYW5zYWN0aW9uLT5zdWJQcm9jZXNzLT5wcm9jZXNzLT5uYW1lOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdwcm9jZXNzJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnc3ViUHJvY2Vzcy5wcm9jZXNzJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdjb2RlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5vcldoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbigncHJvY2VzcycsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFN1YlByb2Nlc3M6OnNlbGVjdCgncHJvY2Vzc2VzLmNvZGUnKQogICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ3Byb2Nlc3NlcycsICdwcm9jZXNzZXMuaWQnLCAnPScsICdzdWJfcHJvY2Vzc2VzLnByb2Nlc3NfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdzdWJfcHJvY2Vzc2VzLmlkJywgJ3RyYW5zYWN0aW9ucy5zdWJfcHJvY2Vzc19pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdzdWJfcHJvY2VzcycsIGZ1bmN0aW9uICgkdHJhbnNhY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRyYW5zYWN0aW9uLT5zdWJQcm9jZXNzLT5jb2RlLicgfCAnLiR0cmFuc2FjdGlvbi0+c3ViUHJvY2Vzcy0+bmFtZTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignc3ViX3Byb2Nlc3MnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdzdWJQcm9jZXNzJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdjb2RlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5vcldoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignc3ViX3Byb2Nlc3MnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBTdWJQcm9jZXNzOjpzZWxlY3QoJ3N1Yl9wcm9jZXNzZXMuY29kZScpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3N1Yl9wcm9jZXNzZXMuaWQnLCAndHJhbnNhY3Rpb25zLnN1Yl9wcm9jZXNzX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdkYXRldGltZScsIGZ1bmN0aW9uICgkdHJhbnNhY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZSgnWS1tLWQgZzppIGEnLCBzdHJ0b3RpbWUoJHRyYW5zYWN0aW9uLT5kYXRldGltZSkpOwogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignY3VycmVuY3knLCBmdW5jdGlvbiAoJHRyYW5zYWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0cmFuc2FjdGlvbi0+ZXhjaGFuZ2VSYXRlLT5jdXJyZW5jeS0+Y29kZS4nIHwgJy4kdHJhbnNhY3Rpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPm5hbWU7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2N1cnJlbmN5JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdjb2RlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5vcldoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignY3VycmVuY3knLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBFeGNoYW5nZVJhdGU6OnNlbGVjdCgnY3VycmVuY2llcy5jb2RlJykKICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdjdXJyZW5jaWVzJywgJ2N1cnJlbmNpZXMuaWQnLCAnPScsICdleGNoYW5nZV9yYXRlcy5jdXJyZW5jeV9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ2V4Y2hhbmdlX3JhdGVzLmlkJywgJ3RyYW5zYWN0aW9ucy5leGNoYW5nZV9yYXRlX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3RyYW5zYWN0aW9ucycsIGZ1bmN0aW9uKCR0cmFuc2FjdGlvbil7CiAgICAgICAgICAgICAgICAgICAgJGRhdGEgPSAnJzsKICAgICAgICAgICAgICAgICAgICBpZihpc3NldCgkdHJhbnNhY3Rpb24tPmVudHJpZXNbMF0pKXsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCgkdHJhbnNhY3Rpb24tPmVudHJpZXMgYXMgJGVudHJ5KXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGlzc2V0KCRlbnRyeS0+ZW50cnktPmlkKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRhdGEgLj0gJzxhIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi1zdWNjZXNzIG1sLTEiIG9uY2xpY2s9ImdldFNob3J0RGV0YWlscygkKHRoaXMpKSIgZGF0YS1pZD0iJy4oJGVudHJ5LT5lbnRyeS0+aWQpLiciIGRhdGEtZW50cnktdHlwZT0iJy4oJGVudHJ5LT5lbnRyeS0+ZW50cnlUeXBlLT5uYW1lKS4nIiBkYXRhLWNvZGU9IicuKCRlbnRyeS0+ZW50cnktPmNvZGUpLiciPicuJGVudHJ5LT5lbnRyeS0+Y29kZS4nPC9hPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRkYXRhOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCd0cmFuc2FjdGlvbnMnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdlbnRyaWVzLmVudHJ5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdjb2RlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbigndHJhbnNhY3Rpb25zJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgVHJhbnNhY3Rpb25FbnRyeTo6c2VsZWN0KCdlbnRyaWVzLmNvZGUnKQogICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2VudHJpZXMnLCAnZW50cmllcy5pZCcsICc9JywgJ3RyYW5zYWN0aW9uX2VudHJpZXMuZW50cnlfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCd0cmFuc2FjdGlvbl9lbnRyaWVzLnRyYW5zYWN0aW9uX2lkJywgJ3RyYW5zYWN0aW9ucy5pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdmaXNjYWxfeWVhcnMnLCBmdW5jdGlvbigkdHJhbnNhY3Rpb24pewogICAgICAgICAgICAgICAgICAgICRhcnJheSA9IFtdOwogICAgICAgICAgICAgICAgICAgIGlmKGlzc2V0KCR0cmFuc2FjdGlvbi0+ZW50cmllc1swXSkpewogICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCR0cmFuc2FjdGlvbi0+ZW50cmllcyBhcyAkZW50cnkpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoaXNzZXQoJGVudHJ5LT5lbnRyeS0+ZmlzY2FsWWVhci0+aWQpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRhcnJheSwgJGVudHJ5LT5lbnRyeS0+ZmlzY2FsWWVhci0+dGl0bGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBpbXBsb2RlKCcsICcsICRhcnJheSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2Zpc2NhbF95ZWFycycsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2VudHJpZXMuZW50cnkuZmlzY2FsWWVhcicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgndGl0bGUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdmaXNjYWxfeWVhcnMnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBUcmFuc2FjdGlvbkVudHJ5OjpzZWxlY3QoJ2Zpc2NhbF95ZWFycy50aXRsZScpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignZmlzY2FsX3llYXJzJywgJ2Zpc2NhbF95ZWFycy5pZCcsICc9JywgJ2VudHJpZXMuZmlzY2FsX3llYXJfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2VudHJpZXMnLCAnZW50cmllcy5pZCcsICc9JywgJ3RyYW5zYWN0aW9uX2VudHJpZXMuZW50cnlfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCd0cmFuc2FjdGlvbl9lbnRyaWVzLnRyYW5zYWN0aW9uX2lkJywgJ3RyYW5zYWN0aW9ucy5pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdmaXNjYWxfeWVhcl9vcGVuaW5ncycsIGZ1bmN0aW9uKCR0cmFuc2FjdGlvbil7CiAgICAgICAgICAgICAgICAgICAgJGFycmF5ID0gW107CiAgICAgICAgICAgICAgICAgICAgaWYoaXNzZXQoJHRyYW5zYWN0aW9uLT5lbnRyaWVzWzBdKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2goJHRyYW5zYWN0aW9uLT5lbnRyaWVzIGFzICRlbnRyeSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihpc3NldCgkZW50cnktPmVudHJ5LT5maXNjYWxZZWFyT3BlbmluZ0VudHJpZXNbMF0pKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXJyYXkgPSBhcnJheV9tZXJnZSgkYXJyYXksICRlbnRyeS0+ZW50cnktPmZpc2NhbFllYXJPcGVuaW5nRW50cmllcy0+cGx1Y2soJ2Zpc2NhbFllYXJPcGVuaW5nLnJlZmVyZW5jZScpLT50b0FycmF5KCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBpbXBsb2RlKCcsICcsICRhcnJheSk7CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdsb2dzJywgZnVuY3Rpb24oJHRyYW5zYWN0aW9uKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi1kYW5nZXIgbWwtMSIgb25jbGljaz0idmlld0xvZ3MoJy4kdHJhbnNhY3Rpb24tPmlkLicpIj5WaWV3IExvZ3M8L2E+JzsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsndHJhbnNhY3Rpb25zJywgJ2xvZ3MnXSkKICAgICAgICAgICAgICAgIC0+bWFrZSh0cnVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGRhdGEgPSBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICdMaXN0IG9mIFRyYW5zYWN0aW9ucycsCiAgICAgICAgICAgICAgICAnY29tcGFuaWVzJyA9PiBDb21wYW55OjpoYXMoJ3Byb2ZpdENlbnRyZXMuY29zdENlbnRyZXMnKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygndXNlcnMnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCd1c2VyX2lkJywgYXV0aCgpLT51c2VyKCktPmlkKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmdldCgpLAogICAgICAgICAgICAgICAgJ2hlYWRlckNvbHVtbnMnID0+ICR0aGlzLT5oZWFkZXJDb2x1bW5zKCksCiAgICAgICAgICAgIF07CiAgICAgICAgICAgIHJldHVybiB2aWV3KCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMuaW50ZWdyYXRpb25zLnRyYW5zYWN0aW9ucy5pbmRleCcsICRkYXRhKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGNyZWF0ZSgpCiAgICB7CiAgICAgICAgaWYocmVxdWVzdCgpLT5oYXMoJ2dldC1jb3N0LWNlbnRyZXMnKSl7CiAgICAgICAgICAgIHJldHVybiBDb3N0Q2VudHJlOjp3aGVyZUhhcygncHJvZml0Q2VudHJlJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdjb21wYW55X2lkJywgcmVxdWVzdCgpLT5nZXQoJ2NvbXBhbnlfaWQnKSk7CiAgICAgICAgICAgIH0pLT5nZXQoKTsKICAgICAgICB9CgogICAgICAgIGlmKHJlcXVlc3QoKS0+aGFzKCdnZXQtbGVkZ2VycycpKXsKICAgICAgICAgICAgJGRhdGEgPSBbCiAgICAgICAgICAgICAgICAnc3ViUHJvY2VzcycgPT4gU3ViUHJvY2Vzczo6d2l0aChbCiAgICAgICAgICAgICAgICAgICAgJ2xlZGdlcnMuY2hhcnRPZkFjY291bnQnCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT5maW5kT3JGYWlsKHJlcXVlc3QoKS0+Z2V0KCdzdWJfcHJvY2Vzc19pZCcpKSwgCiAgICAgICAgICAgIF07CgogICAgICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLmludGVncmF0aW9ucy50cmFuc2FjdGlvbnMubGVkZ2VycycsICRkYXRhKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB2aWV3KCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMuaW50ZWdyYXRpb25zLnRyYW5zYWN0aW9ucy5jcmVhdGUnLCBbCiAgICAgICAgICAgICd0aXRsZScgPT4gIk5ldyBUcmFuc2FjdGlvbiIsCiAgICAgICAgICAgICdjb21wYW5pZXMnID0+IENvbXBhbnk6OmFsbCgpLAogICAgICAgICAgICAnZW50cnlUeXBlcycgPT4gRW50cnlUeXBlOjphbGwoKSwKICAgICAgICAgICAgJ2N1cnJlbmNpZXMnID0+IEN1cnJlbmN5OjphbGwoKSwKICAgICAgICAgICAgJ3Byb2Nlc3NlcycgPT4gUHJvY2Vzczo6YWxsKCksCiAgICAgICAgXSk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHN0b3JlKFJlcXVlc3QgJHJlcXVlc3QpewogICAgICAgICRyZXF1ZXN0LT52YWxpZGF0ZShbCiAgICAgICAgICAgICdjb21wYW55X2lkJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdlbnRyeV90eXBlX2lkJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnY3VycmVuY3lfaWQnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdudW1iZXInID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdkYXRldGltZScgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ25vdGVzJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnc3ViX3Byb2Nlc3NfaWQnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdhbW91bnQnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgXSk7CgogICAgICAgIGlmKCRyZXF1ZXN0LT5oYXMoJ2RlYml0X2xlZGdlcnMnKSl7CiAgICAgICAgICAgICRyZXF1ZXN0LT52YWxpZGF0ZShbCiAgICAgICAgICAgICAgICAnZGViaXRfbGVkZ2Vycy4qJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICBdKTsKICAgICAgICB9CgogICAgICAgIGlmKCRyZXF1ZXN0LT5oYXMoJ2NyZWRpdF9sZWRnZXJzJykpewogICAgICAgICAgICAkcmVxdWVzdC0+dmFsaWRhdGUoWwogICAgICAgICAgICAgICAgJ2NyZWRpdF9sZWRnZXJzLionID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KCiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnl7CiAgICAgICAgICAgICRpdGVtcyA9IFtdOwogICAgICAgICAgICAkc3ViUHJvY2VzcyA9IFN1YlByb2Nlc3M6OndpdGgoWwogICAgICAgICAgICAgICAgJ2xlZGdlcnMnCiAgICAgICAgICAgIF0pLT5maW5kT3JGYWlsKCRyZXF1ZXN0LT5zdWJfcHJvY2Vzc19pZCk7CiAgICAgICAgICAgIGlmKGlzc2V0KCRzdWJQcm9jZXNzLT5pZCkpewogICAgICAgICAgICAgICAgaWYoaXNzZXQoJHJlcXVlc3QtPmRlYml0X2xlZGdlcnMpICYmIGlzX2FycmF5KCRyZXF1ZXN0LT5kZWJpdF9sZWRnZXJzKSAmJiBjb3VudCgkcmVxdWVzdC0+ZGViaXRfbGVkZ2VycykgPiAwKXsKICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkcmVxdWVzdC0+ZGViaXRfbGVkZ2VycyBhcyAkY2hhcnRfb2ZfYWNjb3VudF9pZCA9PiAkYW1vdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGl0ZW1zLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRyZXF1ZXN0LT5jb3N0X2NlbnRyZV9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkY2hhcnRfb2ZfYWNjb3VudF9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gJGFtb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAkc3ViUHJvY2Vzcy0+bmFtZS4nIDo6ICcuJHJlcXVlc3QtPm5vdGVzLicgOjogRGViaXQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdhcGktaW50ZWdyYXRpb24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJHN1YlByb2Nlc3MtPmlkCiAgICAgICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgIGlmKCRzdWJQcm9jZXNzLT5sZWRnZXJzLT53aGVyZSgndHlwZScsICdEJyktPmNvdW50KCkgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHN1YlByb2Nlc3MtPmxlZGdlcnMtPndoZXJlKCd0eXBlJywgJ0QnKSBhcyAka2V5ID0+ICRsZWRnZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhbW91bnQgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHJlcXVlc3QtPmFtb3VudCA+IDAgJiYgJGxlZGdlci0+cGVyY2VudGFnZSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhbW91bnQgPSBmbG9vcigkcmVxdWVzdC0+YW1vdW50KigkbGVkZ2VyLT5wZXJjZW50YWdlLzEwMCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGl0ZW1zLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAkcmVxdWVzdC0+Y29zdF9jZW50cmVfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICRsZWRnZXItPmNoYXJ0X29mX2FjY291bnRfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAkYW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJHN1YlByb2Nlc3MtPm5hbWUuJyA6OiAnLiRyZXF1ZXN0LT5ub3Rlcy4nIDo6IERlYml0JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJ2FwaS1pbnRlZ3JhdGlvbicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJHN1YlByb2Nlc3MtPmlkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZihpc3NldCgkcmVxdWVzdC0+Y3JlZGl0X2xlZGdlcnMpICYmIGlzX2FycmF5KCRyZXF1ZXN0LT5jcmVkaXRfbGVkZ2VycykgJiYgY291bnQoJHJlcXVlc3QtPmNyZWRpdF9sZWRnZXJzKSA+IDApewogICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRyZXF1ZXN0LT5jcmVkaXRfbGVkZ2VycyBhcyAkY2hhcnRfb2ZfYWNjb3VudF9pZCA9PiAkYW1vdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGl0ZW1zLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRyZXF1ZXN0LT5jb3N0X2NlbnRyZV9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkY2hhcnRfb2ZfYWNjb3VudF9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+ICRhbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAkc3ViUHJvY2Vzcy0+bmFtZS4nIDo6ICcuJHJlcXVlc3QtPm5vdGVzLicgOjogQ3JlZGl0JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAnYXBpLWludGVncmF0aW9uJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRzdWJQcm9jZXNzLT5pZAogICAgICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICBpZigkc3ViUHJvY2Vzcy0+bGVkZ2Vycy0+d2hlcmUoJ3R5cGUnLCAnQycpLT5jb3VudCgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRzdWJQcm9jZXNzLT5sZWRnZXJzLT53aGVyZSgndHlwZScsICdDJykgYXMgJGtleSA9PiAkbGVkZ2VyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYW1vdW50ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRyZXF1ZXN0LT5hbW91bnQgPiAwICYmICRsZWRnZXItPnBlcmNlbnRhZ2UgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYW1vdW50ID0gZmxvb3IoJHJlcXVlc3QtPmFtb3VudCooJGxlZGdlci0+cGVyY2VudGFnZS8xMDApKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRpdGVtcywgWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJHJlcXVlc3QtPmNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkbGVkZ2VyLT5jaGFydF9vZl9hY2NvdW50X2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAkYW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICRzdWJQcm9jZXNzLT5uYW1lLicgOjogJy4kcmVxdWVzdC0+bm90ZXMuJyA6OiBDcmVkaXQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAnYXBpLWludGVncmF0aW9uJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc291cmNlJyA9PiAkc3ViUHJvY2Vzcy0+aWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAkZXhjaGFuZ2VfcmF0ZV9pZCA9IGdldEV4Y2hhbmdlUmF0ZXMoJHJlcXVlc3QtPmN1cnJlbmN5X2lkLCBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkcmVxdWVzdC0+ZGF0ZXRpbWUpKSwgZGF0ZSgnSDppOnMnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPmRhdGV0aW1lKSkpWydyYXRlJ10tPmlkOwogICAgICAgICAgICAkZW50cnkgPSBzYXZlTGVkZ2VyRW50cmllcygkcmVxdWVzdC0+ZW50cnlfdHlwZV9pZCwgJHJlcXVlc3QtPmRhdGV0aW1lLCBpc3NldCgkcmVxdWVzdC0+dGFnX2lkKSA/ICRyZXF1ZXN0LT50YWdfaWQgOiAxLCAkcmVxdWVzdC0+bnVtYmVyLCAkcmVxdWVzdC0+bm90ZXMsICRpdGVtcywgJGV4Y2hhbmdlX3JhdGVfaWQsIGlzc2V0KCRyZXF1ZXN0LT5pc19hZHZhbmNlKSA/ICRyZXF1ZXN0LT5pc19hZHZhbmNlIDogMCwgaXNzZXQoJHJlcXVlc3QtPmFkdmFuY2VfY2F0ZWdvcnlfaWQpID8gJHJlcXVlc3QtPmFkdmFuY2VfY2F0ZWdvcnlfaWQgOiAwLCBpc3NldCgkcmVxdWVzdC0+aXNfbWFudWFsKSA/ICRyZXF1ZXN0LT5pc19tYW51YWwgOiAwLCBpc3NldCgkcmVxdWVzdC0+Y29tcGFueV9pZCkgPyAkcmVxdWVzdC0+Y29tcGFueV9pZCA6IDApOwoKICAgICAgICAgICAgJHJlc3BvbnNlID0gWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+ICRlbnRyeVsnc3VjY2VzcyddLAogICAgICAgICAgICAgICAgJ2lkJyA9PiBpc3NldCgkZW50cnlbJ2VudHJ5J10pID8gJGVudHJ5WydlbnRyeSddLT5pZCA6IGZhbHNlLAogICAgICAgICAgICAgICAgJ2NvZGUnID0+IGlzc2V0KCRlbnRyeVsnZW50cnknXSkgPyAkZW50cnlbJ2VudHJ5J10tPmNvZGUgOiBmYWxzZSwKICAgICAgICAgICAgICAgICdlbnRyeV90eXBlJyA9PiBpc3NldCgkZW50cnlbJ2VudHJ5J10pID8gJGVudHJ5WydlbnRyeSddLT5lbnRyeVR5cGUtPm5hbWUgOiBmYWxzZSwKICAgICAgICAgICAgICAgICdkYXRhJyA9PiBpc3NldCgkZW50cnlbJ2VudHJ5J10pID8gJGVudHJ5WydlbnRyeSddIDogZmFsc2UsCiAgICAgICAgICAgIF07CgogICAgICAgICAgICAkdHJhbnNhY3Rpb24gPSBUcmFuc2FjdGlvbjo6Y3JlYXRlKFsKICAgICAgICAgICAgICAgICdzdWJfcHJvY2Vzc19pZCcgPT4gJHN1YlByb2Nlc3MtPmlkLAogICAgICAgICAgICAgICAgJ2RhdGV0aW1lJyA9PiAkcmVxdWVzdC0+ZGF0ZXRpbWUsCiAgICAgICAgICAgICAgICAnZXhjaGFuZ2VfcmF0ZV9pZCcgPT4gJGV4Y2hhbmdlX3JhdGVfaWQsCiAgICAgICAgICAgICAgICAnYW1vdW50JyA9PiAkcmVxdWVzdC0+YW1vdW50LAogICAgICAgICAgICBdKTsKCiAgICAgICAgICAgIGlmKGlzc2V0KCRlbnRyeVsnZW50cnknXS0+aWQpKXsKICAgICAgICAgICAgICAgIFRyYW5zYWN0aW9uRW50cnk6OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAgICAgJ3RyYW5zYWN0aW9uX2lkJyA9PiAkdHJhbnNhY3Rpb24tPmlkLAogICAgICAgICAgICAgICAgICAgICdlbnRyeV9pZCcgPT4gJGVudHJ5WydlbnRyeSddLT5pZCwKICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBUcmFuc2FjdGlvbkxvZzo6Y3JlYXRlKFsKICAgICAgICAgICAgICAgICd0cmFuc2FjdGlvbl9pZCcgPT4gJHRyYW5zYWN0aW9uLT5pZCwKICAgICAgICAgICAgICAgICdyZXF1ZXN0JyA9PiBqc29uX2VuY29kZSgkcmVxdWVzdC0+YWxsKCkpLAogICAgICAgICAgICAgICAgJ3Jlc3BvbnNlJyA9PiBqc29uX2VuY29kZSgkcmVzcG9uc2UpLAogICAgICAgICAgICAgICAgJ2xvZ3MnID0+ICJQb3N0ZWQgYnkgIi5hdXRoKCktPnVzZXIoKS0+bmFtZSwKICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBEQjo6Y29tbWl0KCk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKCRyZXNwb25zZSwgJGVudHJ5WydzdWNjZXNzJ10gPyAyMDAgOiA1MDApOwogICAgICAgIH1jYXRjaCAoRXhjZXB0aW9uICRlKXsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkZS0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgIF0sIDUwMCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBzaG93KCRpZCkKICAgIHsKICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgJ3RyYW5zYWN0aW9uJyA9PiBUcmFuc2FjdGlvbjo6d2l0aChbCiAgICAgICAgICAgICAgICAnbG9ncycKICAgICAgICAgICAgXSktPmZpbmRPckZhaWwoJGlkKSwgCiAgICAgICAgXTsKCiAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5pbnRlZ3JhdGlvbnMudHJhbnNhY3Rpb25zLmxvZ3MnLCAkZGF0YSk7CiAgICB9Cn0K