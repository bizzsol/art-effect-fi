<?php
bolt_decrypt( __FILE__ , 'V5HuBv'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcTXlhY2NvdW50aW5nOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDaGFydE9mQWNjb3VudDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXENvbXBhbnk7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDdXJyZW5jeTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEN1cnJlbmN5VHlwZTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEVudHJ5Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcRW50cnlJdGVtOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcRmlzY2FsWWVhckNsb3NpbmdMZWRnZXI7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xQcm9maXRDZW50cmU7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xTdWJMZWRnZXI7CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xEQjsKCmNsYXNzIExlZGdlclN0YXRlbWVudENvbnRyb2xsZXIgZXh0ZW5kcyBDb250cm9sbGVyCnsKICAgIHB1YmxpYyBmdW5jdGlvbiBpbmRleCgpCiAgICB7CiAgICAgICAgaWYocmVxdWVzdCgpLT5oYXMoJ2dldC1jb2EnKSl7CiAgICAgICAgICAgIHJldHVybiBjaGFydE9mQWNjb3VudHNPcHRpb25zKFtdLCByZXF1ZXN0KCktPmdldCgnY2hhcnRfb2ZfYWNjb3VudF9pZCcpLCAwLCBnZXRBbGxHcm91cEFuZExlZGdlcnMoZmFsc2UsIHRydWUpKTsKICAgICAgICB9CgogICAgICAgICR0aXRsZSA9ICdSZXBvcnQgLSBMZWRnZXIgU3RhdGVtZW50JzsKCiAgICAgICAgJGNvbXBhbnlfaWQgPSByZXF1ZXN0KCktPmhhcygnY29tcGFueV9pZCcpID8gcmVxdWVzdCgpLT5nZXQoJ2NvbXBhbnlfaWQnKSA6IDA7CiAgICAgICAgJHByb2ZpdF9jZW50cmVfaWQgPSByZXF1ZXN0KCktPmhhcygncHJvZml0X2NlbnRyZV9pZCcpID8gcmVxdWVzdCgpLT5nZXQoJ3Byb2ZpdF9jZW50cmVfaWQnKSA6IDA7CiAgICAgICAgJGNvc3RfY2VudHJlX2lkID0gcmVxdWVzdCgpLT5oYXMoJ2Nvc3RfY2VudHJlX2lkJykgPyByZXF1ZXN0KCktPmdldCgnY29zdF9jZW50cmVfaWQnKSA6IDA7CiAgICAgICAgCiAgICAgICAgJGNoYXJ0X29mX2FjY291bnRfaWQgPSByZXF1ZXN0KCktPmhhcygnY2hhcnRfb2ZfYWNjb3VudF9pZCcpID8gcmVxdWVzdCgpLT5nZXQoJ2NoYXJ0X29mX2FjY291bnRfaWQnKSA6IFtdOwogICAgICAgICRjaGFydF9vZl9hY2NvdW50X2lkID0gaXNfYXJyYXkoJGNoYXJ0X29mX2FjY291bnRfaWQpICYmIGlzc2V0KCRjaGFydF9vZl9hY2NvdW50X2lkWzBdKSA/ICRjaGFydF9vZl9hY2NvdW50X2lkIDogKCFpc19hcnJheSgkY2hhcnRfb2ZfYWNjb3VudF9pZCkgJiYgKGludCkoJGNoYXJ0X29mX2FjY291bnRfaWQpID4gMCA/IFskY2hhcnRfb2ZfYWNjb3VudF9pZF0gOiBbXSk7CiAgICAgICAgJG5hcnJhdGlvbiA9IHJlcXVlc3QoKS0+aGFzKCduYXJyYXRpb24nKSA/IHJlcXVlc3QoKS0+Z2V0KCduYXJyYXRpb24nKSA6ICcnOwogICAgICAgIAogICAgICAgICRzdWJfbGVkZ2VyX2lkID0gcmVxdWVzdCgpLT5oYXMoJ3N1Yl9sZWRnZXJfaWQnKSA/IHJlcXVlc3QoKS0+Z2V0KCdzdWJfbGVkZ2VyX2lkJykgOiBbXTsKICAgICAgICAkc3ViX2xlZGdlcl9pZCA9IGlzX2FycmF5KCRzdWJfbGVkZ2VyX2lkKSAmJiBpc3NldCgkc3ViX2xlZGdlcl9pZFswXSkgPyAkc3ViX2xlZGdlcl9pZCA6ICghaXNfYXJyYXkoJHN1Yl9sZWRnZXJfaWQpICYmIChpbnQpKCRzdWJfbGVkZ2VyX2lkKSA+IDAgPyBbJHN1Yl9sZWRnZXJfaWRdIDogW10pOwoKICAgICAgICAkY3VycmVuY3lfaWQgPSByZXF1ZXN0KCktPmhhcygnY3VycmVuY3lfaWQnKSA/IHJlcXVlc3QoKS0+Z2V0KCdjdXJyZW5jeV9pZCcpIDogMDsKICAgICAgICAkZnJvbSA9IHJlcXVlc3QoKS0+aGFzKCdmcm9tJykgPyByZXF1ZXN0KCktPmdldCgnZnJvbScpIDogZGF0ZSgnWS1tLTAxJyk7CiAgICAgICAgJHRvID0gcmVxdWVzdCgpLT5oYXMoJ3RvJykgPyByZXF1ZXN0KCktPmdldCgndG8nKSA6IGRhdGUoJ1ktbS10Jyk7CiAgICAgICAgJHNlYXJjaEFjY291bnRzID0gQ2hhcnRPZkFjY291bnQ6OndpdGgoWwogICAgICAgICAgICAnYWNjb3VudEdyb3VwJwogICAgICAgIF0pCiAgICAgICAgLT53aGVyZUluKCdpZCcsICRjaGFydF9vZl9hY2NvdW50X2lkKQogICAgICAgIC0+Z2V0KCk7CiAgICAgICAgJGVudHJpZXMgPSBmYWxzZTsKICAgICAgICAkb3BlbmluZ19iYWxhbmNlID0gMDsKICAgICAgICAKICAgICAgICBpZihpc3NldCgkY2hhcnRfb2ZfYWNjb3VudF9pZFswXSkpewogICAgICAgICAgICAkYWxsID0gZ2V0QWxsR3JvdXBBbmRMZWRnZXJzKCk7CiAgICAgICAgICAgICRhY3RpdmVGaXNjYWxZZWFyID0gZ2V0QWN0aXZlRmlzY2FsWWVhcigkY29tcGFueV9pZCk7CiAgICAgICAgICAgICRzeXN0ZW1DdXJyZW5jeSA9IHN5c3RlbUN1cnJlbmN5KCk7CgogICAgICAgICAgICAkcmF0ZSA9IDE7CiAgICAgICAgICAgIGlmKCRzeXN0ZW1DdXJyZW5jeS0+aWQgIT0gJGN1cnJlbmN5X2lkKXsKICAgICAgICAgICAgICAgICRyYXRlcyA9IGdldEV4Y2hhbmdlUmF0ZXMoJHN5c3RlbUN1cnJlbmN5LT5pZCk7CiAgICAgICAgICAgICAgICAkcmF0ZSA9IGlzc2V0KCRyYXRlc1sncmF0ZXMnXVskY3VycmVuY3lfaWRdWydyYXRlJ10pID8gJHJhdGVzWydyYXRlcyddWyRjdXJyZW5jeV9pZF1bJ3JhdGUnXSA6IDE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRkZWJpdEVudHJ5SXRlbXMgPSBFbnRyeUl0ZW06OmpvaW4oJ2VudHJpZXMnLCAnZW50cmllcy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmVudHJ5X2lkJykKICAgICAgICAgICAgLT5qb2luKCdjb3N0X2NlbnRyZXMnLCAnY29zdF9jZW50cmVzLmlkJywgJz0nLCAnZW50cnlfaXRlbXMuY29zdF9jZW50cmVfaWQnKQogICAgICAgICAgICAtPmpvaW4oJ3Byb2ZpdF9jZW50cmVzJywgJ3Byb2ZpdF9jZW50cmVzLmlkJywgJz0nLCAnY29zdF9jZW50cmVzLnByb2ZpdF9jZW50cmVfaWQnKQoKICAgICAgICAgICAgLT5qb2luKCdjaGFydF9vZl9hY2NvdW50cycsICdjaGFydF9vZl9hY2NvdW50cy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmNoYXJ0X29mX2FjY291bnRfaWQnKQogICAgICAgICAgICAtPmpvaW4oJ2FjY291bnRfZ3JvdXBzJywgJ2FjY291bnRfZ3JvdXBzLmlkJywgJz0nLCAnY2hhcnRfb2ZfYWNjb3VudHMuYWNjb3VudF9ncm91cF9pZCcpCgogICAgICAgICAgICAtPndoZXJlKCdlbnRyaWVzLmlzX2FwcHJvdmVkJywgJ2FwcHJvdmVkJykKICAgICAgICAgICAgLT53aGVyZSgnZW50cmllcy5kYXRlJywgJzw9JywgZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJGZyb20uJyAtMSBkYXlzJykpKQogICAgICAgICAgICAtPndoZXJlKCdlbnRyaWVzLmZpc2NhbF95ZWFyX2lkJywgJGFjdGl2ZUZpc2NhbFllYXItPmlkKQogICAgICAgICAgICAtPndoZXJlKCdwcm9maXRfY2VudHJlcy5jb21wYW55X2lkJywgJGNvbXBhbnlfaWQpCgogICAgICAgICAgICAtPndoZW4oJHByb2ZpdF9jZW50cmVfaWQgPiAwLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcHJvZml0X2NlbnRyZV9pZCl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnY29zdF9jZW50cmVzLnByb2ZpdF9jZW50cmVfaWQnLCAkcHJvZml0X2NlbnRyZV9pZCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlbigkY29zdF9jZW50cmVfaWQgPiAwLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkY29zdF9jZW50cmVfaWQpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2VudHJ5X2l0ZW1zLmNvc3RfY2VudHJlX2lkJywgJGNvc3RfY2VudHJlX2lkKTsKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJ5X2l0ZW1zLmRlYml0X2NyZWRpdCcsICdEJykKCiAgICAgICAgICAgIC0+Z3JvdXBCeSgnZW50cnlfaXRlbXMuY2hhcnRfb2ZfYWNjb3VudF9pZCcpCgogICAgICAgICAgICAtPmdldChbCiAgICAgICAgICAgICAgICAnZW50cnlfaXRlbXMuc3ViX2xlZGdlcl9pZCcsCiAgICAgICAgICAgICAgICAnZW50cnlfaXRlbXMuY2hhcnRfb2ZfYWNjb3VudF9pZCcsCiAgICAgICAgICAgICAgICBEQjo6cmF3KCdzdW0oZW50cnlfaXRlbXMucmVwb3J0aW5nX2Ftb3VudCkgYXMgcmVwb3J0aW5nX2Ftb3VudCcpCiAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgJGNyZWRpdEVudHJ5SXRlbXMgPSBFbnRyeUl0ZW06OmpvaW4oJ2VudHJpZXMnLCAnZW50cmllcy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmVudHJ5X2lkJykKICAgICAgICAgICAgLT5qb2luKCdjb3N0X2NlbnRyZXMnLCAnY29zdF9jZW50cmVzLmlkJywgJz0nLCAnZW50cnlfaXRlbXMuY29zdF9jZW50cmVfaWQnKQogICAgICAgICAgICAtPmpvaW4oJ3Byb2ZpdF9jZW50cmVzJywgJ3Byb2ZpdF9jZW50cmVzLmlkJywgJz0nLCAnY29zdF9jZW50cmVzLnByb2ZpdF9jZW50cmVfaWQnKQoKICAgICAgICAgICAgLT5qb2luKCdjaGFydF9vZl9hY2NvdW50cycsICdjaGFydF9vZl9hY2NvdW50cy5pZCcsICc9JywgJ2VudHJ5X2l0ZW1zLmNoYXJ0X29mX2FjY291bnRfaWQnKQogICAgICAgICAgICAtPmpvaW4oJ2FjY291bnRfZ3JvdXBzJywgJ2FjY291bnRfZ3JvdXBzLmlkJywgJz0nLCAnY2hhcnRfb2ZfYWNjb3VudHMuYWNjb3VudF9ncm91cF9pZCcpCgogICAgICAgICAgICAtPndoZXJlKCdlbnRyaWVzLmlzX2FwcHJvdmVkJywgJ2FwcHJvdmVkJykKICAgICAgICAgICAgLT53aGVyZSgnZW50cmllcy5kYXRlJywgJzw9JywgZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJGZyb20uJyAtMSBkYXlzJykpKQogICAgICAgICAgICAtPndoZXJlKCdlbnRyaWVzLmZpc2NhbF95ZWFyX2lkJywgJGFjdGl2ZUZpc2NhbFllYXItPmlkKQogICAgICAgICAgICAtPndoZXJlKCdwcm9maXRfY2VudHJlcy5jb21wYW55X2lkJywgJGNvbXBhbnlfaWQpCgogICAgICAgICAgICAtPndoZW4oJHByb2ZpdF9jZW50cmVfaWQgPiAwLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcHJvZml0X2NlbnRyZV9pZCl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnY29zdF9jZW50cmVzLnByb2ZpdF9jZW50cmVfaWQnLCAkcHJvZml0X2NlbnRyZV9pZCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlbigkY29zdF9jZW50cmVfaWQgPiAwLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkY29zdF9jZW50cmVfaWQpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2VudHJ5X2l0ZW1zLmNvc3RfY2VudHJlX2lkJywgJGNvc3RfY2VudHJlX2lkKTsKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIC0+d2hlcmUoJ2VudHJ5X2l0ZW1zLmRlYml0X2NyZWRpdCcsICdDJykKCiAgICAgICAgICAgIC0+Z3JvdXBCeSgnZW50cnlfaXRlbXMuY2hhcnRfb2ZfYWNjb3VudF9pZCcpCgogICAgICAgICAgICAtPmdldChbCiAgICAgICAgICAgICAgICAnZW50cnlfaXRlbXMuc3ViX2xlZGdlcl9pZCcsCiAgICAgICAgICAgICAgICAnZW50cnlfaXRlbXMuY2hhcnRfb2ZfYWNjb3VudF9pZCcsCiAgICAgICAgICAgICAgICBEQjo6cmF3KCdzdW0oZW50cnlfaXRlbXMucmVwb3J0aW5nX2Ftb3VudCkgYXMgcmVwb3J0aW5nX2Ftb3VudCcpCiAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgJGNhcnJ5Rm9yd2FyZGVkID0gRmlzY2FsWWVhckNsb3NpbmdMZWRnZXI6OmpvaW4oJ2Zpc2NhbF95ZWFyX2Nsb3NpbmdzJywgJ2Zpc2NhbF95ZWFyX2Nsb3NpbmdzLmlkJywgJz0nLCAnZmlzY2FsX3llYXJfY2xvc2luZ19sZWRnZXJzLmZpc2NhbF95ZWFyX2Nsb3NpbmdfaWQnKQoKICAgICAgICAgICAgLT5qb2luKCdjaGFydF9vZl9hY2NvdW50cycsICdjaGFydF9vZl9hY2NvdW50cy5pZCcsICc9JywgJ2Zpc2NhbF95ZWFyX2Nsb3NpbmdfbGVkZ2Vycy5jaGFydF9vZl9hY2NvdW50X2lkJykKICAgICAgICAgICAgLT5qb2luKCdhY2NvdW50X2dyb3VwcycsICdhY2NvdW50X2dyb3Vwcy5pZCcsICc9JywgJ2NoYXJ0X29mX2FjY291bnRzLmFjY291bnRfZ3JvdXBfaWQnKQogICAgICAgICAgICAKICAgICAgICAgICAgLT53aGVyZSgnZmlzY2FsX3llYXJfY2xvc2luZ3MuY29tcGFueV9pZCcsICRjb21wYW55X2lkKQogICAgICAgICAgICAtPndoZXJlKCdmaXNjYWxfeWVhcl9jbG9zaW5ncy50b19maXNjYWxfeWVhcl9pZCcsICRhY3RpdmVGaXNjYWxZZWFyLT5pZCkKICAgICAgICAgICAgCiAgICAgICAgICAgIC0+Z3JvdXBCeSgnZmlzY2FsX3llYXJfY2xvc2luZ19sZWRnZXJzLmNoYXJ0X29mX2FjY291bnRfaWQnKQoKICAgICAgICAgICAgLT5nZXQoWwogICAgICAgICAgICAgICAgJ2Zpc2NhbF95ZWFyX2Nsb3NpbmdfbGVkZ2Vycy5jaGFydF9vZl9hY2NvdW50X2lkJywKICAgICAgICAgICAgICAgIERCOjpyYXcoJ3N1bShmaXNjYWxfeWVhcl9jbG9zaW5nX2xlZGdlcnMuY2FycnlfZm9yd2FyZGluZ19hbW91bnQpIGFzIGNhcnJ5X2ZvcndhcmRpbmdfYW1vdW50JykKICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAkb3BlbmluZ19iYWxhbmNlID0gMDsKICAgICAgICAgICAgaWYoaXNzZXQoJHNlYXJjaEFjY291bnRzWzBdKSl7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkc2VhcmNoQWNjb3VudHMgYXMgJGtleSA9PiAkc2VhcmNoQWNjb3VudCkgewogICAgICAgICAgICAgICAgICAgICRvcGVuaW5nX2JhbGFuY2UgKz0gbGVkZ2VyQ2xvc2luZ0JhbGFuY2UoJHNlYXJjaEFjY291bnQtPmFjY291bnRHcm91cCwgJHNlYXJjaEFjY291bnQsIFsnRCcgPT4gJGRlYml0RW50cnlJdGVtcywgJ0MnID0+ICRjcmVkaXRFbnRyeUl0ZW1zXSwgJGFsbCwgJGNhcnJ5Rm9yd2FyZGVkLCAkcmF0ZSwgW10sICRzdWJfbGVkZ2VyX2lkKVsnYmFsYW5jZSddOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAkZW50cmllcyA9IEVudHJ5Ojp3aXRoKFsKICAgICAgICAgICAgICAgICdlbnRyeVR5cGUnLAogICAgICAgICAgICAgICAgJ2l0ZW1zLmNoYXJ0T2ZBY2NvdW50LmFjY291bnRHcm91cC5hY2NvdW50Q2xhc3MnLAogICAgICAgICAgICAgICAgJ2l0ZW1zLnN1YkxlZGdlcicsCiAgICAgICAgICAgICAgICAnZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JwogICAgICAgICAgICBdKQogICAgICAgICAgICAtPndoZXJlSGFzKCdpdGVtcy5jb3N0Q2VudHJlLnByb2ZpdENlbnRyZScsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRjb21wYW55X2lkKXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdjb21wYW55X2lkJywgJGNvbXBhbnlfaWQpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZXJlKCdpc19hcHByb3ZlZCcsICdhcHByb3ZlZCcpCiAgICAgICAgICAgIC0+d2hlcmVCZXR3ZWVuKCdkYXRlJywgWyRmcm9tLCAkdG9dKQogICAgICAgICAgICAtPndoZXJlSGFzKCdpdGVtcycsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRzZWFyY2hBY2NvdW50cyl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdjaGFydF9vZl9hY2NvdW50X2lkJywgJHNlYXJjaEFjY291bnRzLT5wbHVjaygnaWQnKS0+dG9BcnJheSgpKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKGlzc2V0KCRzdWJfbGVkZ2VyX2lkWzBdKSwgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHN1Yl9sZWRnZXJfaWQpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2l0ZW1zJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHN1Yl9sZWRnZXJfaWQpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ3N1Yl9sZWRnZXJfaWQnLCAkc3ViX2xlZGdlcl9pZCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKCRwcm9maXRfY2VudHJlX2lkID4gMCwgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHByb2ZpdF9jZW50cmVfaWQpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2l0ZW1zLmNvc3RDZW50cmUnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcHJvZml0X2NlbnRyZV9pZCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3Byb2ZpdF9jZW50cmVfaWQnLCAkcHJvZml0X2NlbnRyZV9pZCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKCRjb3N0X2NlbnRyZV9pZCA+IDAsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRjb3N0X2NlbnRyZV9pZCl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnaXRlbXMnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkY29zdF9jZW50cmVfaWQpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdjb3N0X2NlbnRyZV9pZCcsICRjb3N0X2NlbnRyZV9pZCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKCFlbXB0eSgkbmFycmF0aW9uKSwgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJG5hcnJhdGlvbil7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZShmdW5jdGlvbigkcXVlcnkpIHVzZSgkbmFycmF0aW9uKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnbm90ZXMnLCAnTElLRScsICclJy4kbmFycmF0aW9uLiclJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5vcldoZXJlSGFzKCdpdGVtcycsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRuYXJyYXRpb24pewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnbmFycmF0aW9uJywgJ0xJS0UnLCAnJScuJG5hcnJhdGlvbi4nJScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmKHJlcXVlc3QoKS0+aGFzKCdyZXBvcnRfdHlwZScpICYmIGluX2FycmF5KHJlcXVlc3QoKS0+Z2V0KCdyZXBvcnRfdHlwZScpLCBbJ3BkZicsICdleGNlbCddKSl7CiAgICAgICAgICAgICAgICAkZW50cmllcyA9ICRlbnRyaWVzLT5nZXQoKTsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAkZW50cmllcyA9ICRlbnRyaWVzLT5wYWdpbmF0ZSgxMDApLT53aXRoUXVlcnlTdHJpbmcoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJGNvbXBhbmllcyA9IENvbXBhbnk6OmhhcygncHJvZml0Q2VudHJlcy5jb3N0Q2VudHJlcycpCiAgICAgICAgLT53aGVyZUhhcygndXNlcnMnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgndXNlcl9pZCcsIGF1dGgoKS0+dXNlcigpLT5pZCk7CiAgICAgICAgfSkKICAgICAgICAtPmdldCgpOwoKICAgICAgICB0cnkgewogICAgICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJHRpdGxlLAogICAgICAgICAgICAgICAgJ3NlYXJjaEFjY291bnRzJyA9PiAkc2VhcmNoQWNjb3VudHMsCiAgICAgICAgICAgICAgICAnc3ViX2xlZGdlcl9pZCcgPT4gJHN1Yl9sZWRnZXJfaWQsCiAgICAgICAgICAgICAgICAnc3ViTGVkZ2VycycgPT4gU3ViTGVkZ2VyOjp3aGVyZUluKCdpZCcsICRzdWJfbGVkZ2VyX2lkKS0+Z2V0KCksCiAgICAgICAgICAgICAgICAnZnJvbScgPT4gJGZyb20sCiAgICAgICAgICAgICAgICAndG8nID0+ICR0bywKICAgICAgICAgICAgICAgICdhY2NvdW50RGVmYXVsdFNldHRpbmdzJyA9PiBhY2NvdW50RGVmYXVsdFNldHRpbmdzKCksCiAgICAgICAgICAgICAgICAnb3BlbmluZ19iYWxhbmNlJyA9PiAkb3BlbmluZ19iYWxhbmNlLAogICAgICAgICAgICAgICAgJ2N1cnJlbmN5JyA9PiBDdXJyZW5jeTo6ZmluZCgkY3VycmVuY3lfaWQpLAogICAgICAgICAgICAgICAgJ2N1cnJlbmN5VHlwZXMnID0+IEN1cnJlbmN5VHlwZTo6d2l0aChbJ2N1cnJlbmNpZXMnXSktPmdldCgpLAogICAgICAgICAgICAgICAgJ2VudHJpZXMnID0+ICRlbnRyaWVzLAogICAgICAgICAgICAgICAgJ2NvbXBhbmllcycgPT4gJGNvbXBhbmllcywKICAgICAgICAgICAgICAgICdwcm9maXRDZW50cmVzJyA9PiBQcm9maXRDZW50cmU6OndoZXJlKCdjb21wYW55X2lkJywgJGNvbXBhbmllcy0+Zmlyc3QoKS0+aWQpLT5vcmRlckJ5KCdjb2RlJywgJ2FzYycpLT5nZXQoKSwKICAgICAgICAgICAgICAgICd0aGlzX2NvbXBhbnknID0+ICRjb21wYW5pZXMtPndoZXJlKCdpZCcsICRjb21wYW55X2lkKS0+Zmlyc3QoKQogICAgICAgICAgICBdOwoKICAgICAgICAgICAgaWYocmVxdWVzdCgpLT5oYXMoJ3JlcG9ydF90eXBlJykgJiYgcmVxdWVzdCgpLT5nZXQoJ3JlcG9ydF90eXBlJykgPT0gJ3BkZicpewogICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdNUERGKCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMucmVwb3J0cy5sZWRnZXJTdGF0ZW1lbnRzLnBkZicsICRkYXRhLCAkdGl0bGUsICR0aXRsZSwgJ2EzJywgJ0wnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYocmVxdWVzdCgpLT5oYXMoJ3JlcG9ydF90eXBlJykgJiYgcmVxdWVzdCgpLT5nZXQoJ3JlcG9ydF90eXBlJykgPT0gJ2V4Y2VsJyl7CiAgICAgICAgICAgICAgICByZXR1cm4gZG93bmxvYWRFeGNlbCgnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLnJlcG9ydHMubGVkZ2VyU3RhdGVtZW50cy5leGNlbCcsICRkYXRhLCAkdGl0bGUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZihyZXF1ZXN0KCktPmhhcygncmVwb3J0X3R5cGUnKSAmJiByZXF1ZXN0KCktPmdldCgncmVwb3J0X3R5cGUnKSA9PSAncmVwb3J0Jyl7CiAgICAgICAgICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLnJlcG9ydHMubGVkZ2VyU3RhdGVtZW50cy5yZXBvcnQnLCAkZGF0YSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMucmVwb3J0cy5sZWRnZXJTdGF0ZW1lbnRzLmluZGV4JywgJGRhdGEpOwogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICBpZihyZXF1ZXN0KCktPmhhcygncmVwb3J0X3R5cGUnKSAmJiByZXF1ZXN0KCktPmdldCgncmVwb3J0X3R5cGUnKSA9PSAncmVwb3J0Jyl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHRoLT5nZXRNZXNzYWdlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQp9Cg==