<?php
bolt_decrypt( __FILE__ , 'MQxWIJ'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcTXlhY2NvdW50aW5nXEZpeGVkQXNzZXRzOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKCnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQ29tcGFueTsKdXNlIEFwcFxNb2RlbHNcRml4ZWRBc3NldHNcRml4ZWRBc3NldEJhdGNoOwp1c2UgQXBwXE1vZGVsc1xGaXhlZEFzc2V0c1xGaXhlZEFzc2V0QmF0Y2hJdGVtOwp1c2UgQXBwXE1vZGVsc1xGaXhlZEFzc2V0c1xGaXhlZEFzc2V0QmF0Y2hJdGVtRGVwcmVjaWF0aW9uOwp1c2UgQXBwXE1vZGVsc1xGaXhlZEFzc2V0c1xGaXhlZEFzc2V0QmF0Y2hJdGVtVXNlcjsKdXNlIEFwcFxVc2VyOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcQ2F0ZWdvcnk7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQcm9kdWN0Owp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEJhbmtBY2NvdW50Owp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEN1cnJlbmN5VHlwZTsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDdXJyZW5jeTsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDb3N0Q2VudHJlOwoKdXNlIEFwcCxEQjsKdXNlIElsbHVtaW5hdGVcU3VwcG9ydFxGYWNhZGVzXEF1dGg7CgpjbGFzcyBGaXhlZEFzc2V0RGlzcG9zYWxDb250cm9sbGVyIGV4dGVuZHMgQ29udHJvbGxlcgp7CiAgICBwdWJsaWMgZnVuY3Rpb24gaW5kZXgoKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAnRml4ZWQgQXNzZXQgRGlzcG9zYWwnLAogICAgICAgICAgICAgICAgJ2NvbXBhbmllcycgPT4gQ29tcGFueTo6aGFzKCdwcm9maXRDZW50cmVzLmNvc3RDZW50cmVzJykKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3VzZXJzJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgndXNlcl9pZCcsIGF1dGgoKS0+dXNlcigpLT5pZCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5nZXQoKSwKICAgICAgICAgICAgICAgICdjdXJyZW5jeVR5cGVzJyA9PiBDdXJyZW5jeVR5cGU6OndpdGgoWydjdXJyZW5jaWVzJ10pLT5nZXQoKSwKICAgICAgICAgICAgXTsKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5maXhlZEFzc2V0cy5maXhlZEFzc2V0RGlzcG9zYWwuaW5kZXgnLCAkZGF0YSk7CiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBjcmVhdGUoKQogICAgewogICAgICAgIGlmKHJlcXVlc3QoKS0+aGFzKCdnZXQtcHJvZHVjdHMnKSl7CiAgICAgICAgICAgICRjYXRlZ29yaWVzID0gQ2F0ZWdvcnk6OndoZXJlSGFzKCdwcm9kdWN0cy5maXhlZEFzc2V0QmF0Y2hJdGVtcycsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaXNfZGlzcG9zZWQnLCAwKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5nZXQoKTsKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5maXhlZEFzc2V0cy5maXhlZEFzc2V0RGlzcG9zYWwucHJvZHVjdHMnLCBbCiAgICAgICAgICAgICAgICAnY2F0ZWdvcmllcycgPT4gJGNhdGVnb3JpZXMsCiAgICAgICAgICAgICAgICAncHJvZHVjdHMnID0+IFByb2R1Y3Q6OndpdGgoWwogICAgICAgICAgICAgICAgICAgICdhdHRyaWJ1dGVzLmF0dHJpYnV0ZU9wdGlvbi5hdHRyaWJ1dGUnCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVyZUluKCdjYXRlZ29yeV9pZCcsICRjYXRlZ29yaWVzLT5wbHVjaygnaWQnKS0+dG9BcnJheSgpKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygnZml4ZWRBc3NldEJhdGNoSXRlbXMnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19kaXNwb3NlZCcsIDApOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ2ZpeGVkQXNzZXRCYXRjaEl0ZW1zLmJhdGNoLmNvc3RDZW50cmUucHJvZml0Q2VudHJlJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnY29tcGFueV9pZCcsIHJlcXVlc3QoKS0+Z2V0KCdjb21wYW55X2lkJykpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+Z2V0KCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfQoKICAgICAgICBpZihyZXF1ZXN0KCktPmdldCgnYWN0aW9uJykgPT0gJ2JhdGNoZXMnKXsKICAgICAgICAgICAgJGRhdGEgPSBbCiAgICAgICAgICAgICAgICAnYmF0Y2hlcycgPT4gRml4ZWRBc3NldEJhdGNoOjp3aGVyZUhhcygnaXRlbXMnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19kaXNwb3NlZCcsIDApOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbihyZXF1ZXN0KCktPmdldCgncHJvZHVjdF9pZCcpID4gMCwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnZ29vZHNSZWNlaXZlZEl0ZW1zU3RvY2tJbi5yZWxHb29kc1JlY2VpdmVkSXRlbXMnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncHJvZHVjdF9pZCcsIHJlcXVlc3QoKS0+Z2V0KCdwcm9kdWN0X2lkJykpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+Z2V0KCksCiAgICAgICAgICAgIF07CiAgICAgICAgICAgIHJldHVybiB2aWV3KCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMuZml4ZWRBc3NldHMuZml4ZWRBc3NldERpc3Bvc2FsLmJhdGNoZXMnLCAkZGF0YSk7CiAgICAgICAgfWVsc2VpZihyZXF1ZXN0KCktPmdldCgnYWN0aW9uJykgPT0gJ2l0ZW1zJyl7CgogICAgICAgICAgICAkZmluYWxBc3NldHMgPSBGaXhlZEFzc2V0QmF0Y2hJdGVtOjp3aXRoKFsKCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ2JhdGNoLmNvc3RDZW50cmUucHJvZml0Q2VudHJlJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdjb21wYW55X2lkJywgcmVxdWVzdCgpLT5nZXQoJ2NvbXBhbnlfaWQnKSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlbihyZXF1ZXN0KCktPmdldCgncHJvZHVjdF9pZCcpID4gMCwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdmaW5hbF9hc3NldF9pZCcsIHJlcXVlc3QoKS0+Z2V0KCdwcm9kdWN0X2lkJykpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZW4ocmVxdWVzdCgpLT5nZXQoJ2Fzc2V0X2NvZGUnKSA+IDAsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnYXNzZXRfY29kZScsICdMSUtFJywgJyUnLnJlcXVlc3QoKS0+Z2V0KCdhc3NldF9jb2RlJykuJyUnKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZSgnaXNfZGlzcG9zZWQnLCAwKQogICAgICAgICAgICAtPmdyb3VwQnkoJ2Fzc2V0X2NvZGUnKQogICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAgICAgJGl0ZW1zID0gRml4ZWRBc3NldEJhdGNoSXRlbTo6d2l0aChbCgogICAgICAgICAgICBdKQogICAgICAgICAgICAtPndoZXJlSGFzKCdiYXRjaC5jb3N0Q2VudHJlLnByb2ZpdENlbnRyZScsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnY29tcGFueV9pZCcsIHJlcXVlc3QoKS0+Z2V0KCdjb21wYW55X2lkJykpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPndoZW4ocmVxdWVzdCgpLT5nZXQoJ3Byb2R1Y3RfaWQnKSA+IDAsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZmluYWxfYXNzZXRfaWQnLCByZXF1ZXN0KCktPmdldCgncHJvZHVjdF9pZCcpKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKHJlcXVlc3QoKS0+Z2V0KCdhc3NldF9jb2RlJykgPiAwLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2Fzc2V0X2NvZGUnLCAnTElLRScsICclJy5yZXF1ZXN0KCktPmdldCgnYXNzZXRfY29kZScpLiclJyk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmUoJ2lzX2Rpc3Bvc2VkJywgMCkKICAgICAgICAgICAgLT5nZXQoKTsKCiAgICAgICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAgICAgJ3Byb2R1Y3RfaWQnID0+IHJlcXVlc3QoKS0+Z2V0KCdwcm9kdWN0X2lkJyksCiAgICAgICAgICAgICAgICAnY3VycmVuY3lfaWQnID0+IHJlcXVlc3QoKS0+Z2V0KCdjdXJyZW5jeV9pZCcpLAogICAgICAgICAgICAgICAgJ2Fzc2V0X2NvZGUnID0+IHJlcXVlc3QoKS0+Z2V0KCdhc3NldF9jb2RlJyksCiAgICAgICAgICAgICAgICAnZmluYWxBc3NldHMnID0+ICRmaW5hbEFzc2V0cywKICAgICAgICAgICAgICAgICdpdGVtcycgPT4gJGl0ZW1zLAogICAgICAgICAgICBdOwoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5maXhlZEFzc2V0cy5maXhlZEFzc2V0RGlzcG9zYWwuaXRlbXMnLCAkZGF0YSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBzdG9yZShSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRyZXF1ZXN0LT52YWxpZGF0ZShbCiAgICAgICAgICAgICdhc3NldHMnID0+ICdyZXF1aXJlZCcKICAgICAgICBdKTsKICAgICAgICAKICAgICAgICBpZihpbl9hcnJheSgkcmVxdWVzdC0+cGF5bWVudF90eXBlLCBbJ2NoZXF1ZScsICdmdW5kLXRyYW5zZmVyJ10pKXsKICAgICAgICAgICAgJHJlcXVlc3QtPnZhbGlkYXRlKFsKICAgICAgICAgICAgICAgICdwYXltZW50X2RldGFpbHMnID0+ICdyZXF1aXJlZCcKICAgICAgICAgICAgXSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgdHJ5ewogICAgICAgICAgICAkam91cm5hbEVudHJpZXMgPSBbXTsKCiAgICAgICAgICAgICRmaW5hbEFzc2V0cyA9IEZpeGVkQXNzZXRCYXRjaEl0ZW06OndoZXJlKCdpc19kaXNwb3NlZCcsIDApCiAgICAgICAgICAgIC0+d2hlcmVJbignYXNzZXRfY29kZScsICRyZXF1ZXN0LT5hc3NldHMpCiAgICAgICAgICAgIC0+Z3JvdXBCeSgnYXNzZXRfY29kZScpCiAgICAgICAgICAgIC0+Z2V0KCk7CiAgICAgICAgICAgICRkYXRlID0gZGF0ZSgnWS1tLWQnKTsKCiAgICAgICAgICAgIGlmKGlzc2V0KCRmaW5hbEFzc2V0c1swXSkpewogICAgICAgICAgICAgICAgZm9yZWFjaCgkZmluYWxBc3NldHMgYXMgJGtleSA9PiAkZmluYWxBc3NldCl7CiAgICAgICAgICAgICAgICAgICAgJGl0ZW1zID0gRml4ZWRBc3NldEJhdGNoSXRlbTo6d2hlcmUoJ2lzX2Rpc3Bvc2VkJywgMCkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdhc3NldF9jb2RlJywgJGZpbmFsQXNzZXQtPmFzc2V0X2NvZGUpCiAgICAgICAgICAgICAgICAgICAgLT5nZXQoKTsKICAgICAgICAgICAgICAgICAgICAkdG90YWxfYXNzZXRfdmFsdWUgPSAwOwogICAgICAgICAgICAgICAgICAgICR0b3RhbF9kZXByaWNpYXRlZF9hbW91bnQgPSAwOwogICAgICAgICAgICAgICAgICAgICR0b3RhbF9kdWUgPSAwOwogICAgICAgICAgICAgICAgICAgIGlmKGlzc2V0KCRpdGVtc1swXSkpewogICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCRpdGVtcyBhcyAka2V5ID0+ICRpdGVtKXsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXNzZXRWYWx1ZSA9IGFzc2V0VmFsdWUoJGl0ZW0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRvdGFsX2Fzc2V0X3ZhbHVlICs9ICRhc3NldFZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGVwcmljaWF0ZWRBbW91bnQgPSAkaXRlbS0+ZGVwcmVjaWF0aW9ucy0+c3VtKCdhbW91bnQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0b3RhbF9kZXByaWNpYXRlZF9hbW91bnQgKz0gJGRlcHJpY2lhdGVkQW1vdW50OwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkaXNwb3NhbF9hbW91bnQgPSAoJHJlcXVlc3QtPmRpc3Bvc2FsX2Ftb3VudFskaXRlbS0+YXNzZXRfY29kZV0gPiAwICYmICRpdGVtcy0+Y291bnQoKSA+IDAgPyAoJHJlcXVlc3QtPmRpc3Bvc2FsX2Ftb3VudFskaXRlbS0+YXNzZXRfY29kZV0vJGl0ZW1zLT5jb3VudCgpKSA6IDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRpc3Bvc2FsX3RheF9hbW91bnQgPSAoJHJlcXVlc3QtPmRpc3Bvc2FsX3RheF9hbW91bnRbJGl0ZW0tPmFzc2V0X2NvZGVdID4gMCAmJiAkaXRlbXMtPmNvdW50KCkgPiAwID8gKCRyZXF1ZXN0LT5kaXNwb3NhbF90YXhfYW1vdW50WyRpdGVtLT5hc3NldF9jb2RlXS8kaXRlbXMtPmNvdW50KCkpIDogMCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGR1ZSA9IHN5c3RlbURvdWJsZVZhbHVlKCRhc3NldFZhbHVlLSgkZGVwcmljaWF0ZWRBbW91bnQrJGRpc3Bvc2FsX2Ftb3VudCksIDIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRvdGFsX2R1ZSArPSAkZHVlOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRnYWluX2xvc3MgPSAnZXF1YWwnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGR1ZSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRnYWluX2xvc3MgPSAnbG9zcyc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkZHVlIDwgMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGdhaW5fbG9zcyA9ICdnYWluJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaXRlbS0+aXNfZGlzcG9zZWQgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGl0ZW0tPmRpc3Bvc2FsX3R5cGUgPSAkcmVxdWVzdC0+ZGlzcG9zYWxfdHlwZVskaXRlbS0+YXNzZXRfY29kZV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaXRlbS0+ZGlzcG9zYWxfYW1vdW50ID0gc3lzdGVtRG91YmxlVmFsdWUoJGRpc3Bvc2FsX2Ftb3VudCwgMik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaXRlbS0+ZGlzcG9zYWxfdGF4X2Ftb3VudCA9IHN5c3RlbURvdWJsZVZhbHVlKCRkaXNwb3NhbF90YXhfYW1vdW50LCAyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpdGVtLT5nYWluX2xvc3MgPSAkZ2Fpbl9sb3NzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGl0ZW0tPmRpc3Bvc2FsX3JlbWFya3MgPSAkcmVxdWVzdC0+cmVtYXJrc1skaXRlbS0+YXNzZXRfY29kZV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaXRlbS0+ZGlzcG9zZWRfYXQgPSAkcmVxdWVzdC0+ZGlzcG9zZWRfYXRbJGl0ZW0tPmFzc2V0X2NvZGVdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGl0ZW0tPmRpc3Bvc2VkX2J5ID0gYXV0aCgpLT51c2VyKCktPmlkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGl0ZW0tPnNhdmUoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGF0ZSA9ICRyZXF1ZXN0LT5kaXNwb3NlZF9hdFskaXRlbS0+YXNzZXRfY29kZV07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICRhc3NldF9nYWluX2xvc3MgPSAnZXF1YWwnOwogICAgICAgICAgICAgICAgICAgIGlmKCR0b3RhbF9kdWUgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgJGFzc2V0X2dhaW5fbG9zcyA9ICdsb3NzJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoJHRvdGFsX2R1ZSA8IDApewogICAgICAgICAgICAgICAgICAgICAgICAkYXNzZXRfZ2Fpbl9sb3NzID0gJ2dhaW4nOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYoaXNzZXQoJGZpbmFsQXNzZXQtPmJhdGNoLT5nb29kc1JlY2VpdmVkSXRlbXNTdG9ja0luLT5yZWxQdXJjaGFzZU9yZGVyLT5jb3N0X2NlbnRyZV9pZCkpewogICAgICAgICAgICAgICAgICAgICAgICAkY29zdF9jZW50cmVfaWQgPSAkZmluYWxBc3NldC0+YmF0Y2gtPmdvb2RzUmVjZWl2ZWRJdGVtc1N0b2NrSW4tPnJlbFB1cmNoYXNlT3JkZXItPmNvc3RfY2VudHJlX2lkOwogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAkY29zdF9jZW50cmVfaWQgPSBDb3N0Q2VudHJlOjp3aGVyZSgnaHJfdW5pdF9pZCcsICRmaW5hbEFzc2V0LT5iYXRjaC0+Z29vZHNSZWNlaXZlZEl0ZW1zU3RvY2tJbi0+cmVsUHVyY2hhc2VPcmRlci0+aHJfdW5pdF9pZCkKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUluKCdocl9kZXBhcnRtZW50X2lkJywgJGZpbmFsQXNzZXQtPmJhdGNoLT5nb29kc1JlY2VpdmVkSXRlbXNTdG9ja0luLT5yZWxQdXJjaGFzZU9yZGVyLT5wdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zLT5wbHVjaygnaHJfZGVwYXJ0bWVudF9pZCcpLT50b0FycmF5KCkpLT5maXJzdCgpLT5pZDsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICRhY2NvdW50RGVmYXVsdFNldHRpbmdzID0gYWNjb3VudERlZmF1bHRTZXR0aW5ncygpOwoKICAgICAgICAgICAgICAgICAgICAkam91cm5hbEVudHJpZXNbJGZpbmFsQXNzZXQtPmJhdGNoLT5nb29kc1JlY2VpdmVkSXRlbXNTdG9ja0luLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlX3JhdGVfaWRdW10gPSBbCiAgICAgICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJGNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gKGlzc2V0KCRmaW5hbEFzc2V0LT5maW5hbEFzc2V0LT5pbnZlbnRvcnlfYWRqdXN0bWVudHNfYWNjb3VudF9pZCkgJiYgJGZpbmFsQXNzZXQtPmZpbmFsQXNzZXQtPmludmVudG9yeV9hZGp1c3RtZW50c19hY2NvdW50X2lkID4gMCA/ICRmaW5hbEFzc2V0LT5maW5hbEFzc2V0LT5pbnZlbnRvcnlfYWRqdXN0bWVudHNfYWNjb3VudF9pZCA6ICRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydpbnZlbnRvcnlfYWRqdXN0bWVudHNfYWNjb3VudCddKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiBzeXN0ZW1Eb3VibGVWYWx1ZSgkdG90YWxfZGVwcmljaWF0ZWRfYW1vdW50LCAyKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ0ZpeGVkIEFzc2V0IEFjY3VtdWxhdGVkIERlcHJlY2lhdGlvbiBEZWJpdCAnLAogICAgICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJ2Rpc3Bvc2FsJywKICAgICAgICAgICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJGZpbmFsQXNzZXQtPmFzc2V0X2NvZGUKICAgICAgICAgICAgICAgICAgICBdOwoKICAgICAgICAgICAgICAgICAgICAkYXNzZXRfbGVkZ2VyID0gJGFjY291bnREZWZhdWx0U2V0dGluZ3NbJ2N3aXBfYXNzZXRfYWNjb3VudCddOwogICAgICAgICAgICAgICAgICAgIGlmKCRmaW5hbEFzc2V0LT5maW5hbEFzc2V0LT5pc19maXhlZF9hc3NldCA9PSAxKXsKICAgICAgICAgICAgICAgICAgICAgICAgJGFzc2V0X2xlZGdlciA9IChpc3NldCgkZmluYWxBc3NldC0+ZmluYWxBc3NldC0+aW52ZW50b3J5X2FjY291bnRfaWQpICYmICRmaW5hbEFzc2V0LT5maW5hbEFzc2V0LT5pbnZlbnRvcnlfYWNjb3VudF9pZCA+IDAgPyAkZmluYWxBc3NldC0+ZmluYWxBc3NldC0+aW52ZW50b3J5X2FjY291bnRfaWQgOiAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snZml4ZWRfYXNzZXRfYWNjb3VudCddKTsKICAgICAgICAgICAgICAgICAgICB9ZWxzZWlmKCRmaW5hbEFzc2V0LT5maW5hbEFzc2V0LT5pc19jd2lwID09IDEpewogICAgICAgICAgICAgICAgICAgICAgICAkYXNzZXRfbGVkZ2VyID0gKGlzc2V0KCRmaW5hbEFzc2V0LT5maW5hbEFzc2V0LT5jd2lwX2Fzc2V0X2FjY291bnRfaWQpICYmICRmaW5hbEFzc2V0LT5maW5hbEFzc2V0LT5jd2lwX2Fzc2V0X2FjY291bnRfaWQgPiAwID8gJGZpbmFsQXNzZXQtPmZpbmFsQXNzZXQtPmN3aXBfYXNzZXRfYWNjb3VudF9pZCA6ICRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydjd2lwX2Fzc2V0X2FjY291bnQnXSk7CiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgICRhc3NldF9sZWRnZXIgPSAoaXNzZXQoJGZpbmFsQXNzZXQtPmZpbmFsQXNzZXQtPmludmVudG9yeV9hY2NvdW50X2lkKSAmJiAkZmluYWxBc3NldC0+ZmluYWxBc3NldC0+aW52ZW50b3J5X2FjY291bnRfaWQgPiAwID8gJGZpbmFsQXNzZXQtPmZpbmFsQXNzZXQtPmludmVudG9yeV9hY2NvdW50X2lkIDogJGFjY291bnREZWZhdWx0U2V0dGluZ3NbJ2ludmVudG9yeV9hY2NvdW50J10pOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJGpvdXJuYWxFbnRyaWVzWyRmaW5hbEFzc2V0LT5iYXRjaC0+Z29vZHNSZWNlaXZlZEl0ZW1zU3RvY2tJbi0+cmVsUHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZV9yYXRlX2lkXVtdID0gWwogICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRjb3N0X2NlbnRyZV9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICRhc3NldF9sZWRnZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gc3lzdGVtRG91YmxlVmFsdWUoJHRvdGFsX2Fzc2V0X3ZhbHVlLCAyKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ0ZpeGVkIEFzc2V0IERpc3Bvc2FsIENyZWRpdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAnZGlzcG9zYWwnLAogICAgICAgICAgICAgICAgICAgICAgICAnc291cmNlJyA9PiAkZmluYWxBc3NldC0+YXNzZXRfY29kZQogICAgICAgICAgICAgICAgICAgIF07CgogICAgICAgICAgICAgICAgICAgIGlmKCRyZXF1ZXN0LT5kaXNwb3NhbF9hbW91bnRbJGZpbmFsQXNzZXQtPmFzc2V0X2NvZGVdID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICRkZWJpdCA9ICRyZXF1ZXN0LT5jaGFydF9vZl9hY2NvdW50X2lkOwogICAgICAgICAgICAgICAgICAgICAgICBpZigkcmVxdWVzdC0+cGF5bWVudF90eXBlID09ICdjYXNoJyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGViaXQgPSAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snY2FzaF9pbl9oYW5kX2FjY291bnQnXTsKICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2VpZigkcmVxdWVzdC0+cGF5bWVudF90eXBlID09ICdjaGVxdWUnIHx8ICRyZXF1ZXN0LT5wYXltZW50X3R5cGUgPT0gJ2Z1bmQtdHJhbnNmZXInKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRiYW5rQWNjb3VudCA9IEJhbmtBY2NvdW50OjpmaW5kKCRyZXF1ZXN0LT5iYW5rX2FjY291bnRfaWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoaXNzZXQoJGJhbmtBY2NvdW50LT5jaGFydF9vZl9hY2NvdW50X2lkKSAmJiAkYmFua0FjY291bnQtPmNoYXJ0X29mX2FjY291bnRfaWQgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGViaXQgPSAkYmFua0FjY291bnQtPmNoYXJ0X29mX2FjY291bnRfaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGViaXQgPSAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snYmFua19hY2NvdW50J107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICRqb3VybmFsRW50cmllc1skZmluYWxBc3NldC0+YmF0Y2gtPmdvb2RzUmVjZWl2ZWRJdGVtc1N0b2NrSW4tPnJlbFB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VfcmF0ZV9pZF1bXSA9IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJGNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICRkZWJpdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gc3lzdGVtRG91YmxlVmFsdWUoJHJlcXVlc3QtPmRpc3Bvc2FsX2Ftb3VudFskZmluYWxBc3NldC0+YXNzZXRfY29kZV0tJHJlcXVlc3QtPmRpc3Bvc2FsX3RheF9hbW91bnRbJGZpbmFsQXNzZXQtPmFzc2V0X2NvZGVdLCAyKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAnRml4ZWQgQXNzZXQgRGlzcG9zYWwgOjogJy51Y3dvcmRzKHN0cl9yZXBsYWNlKCctJywgJyAnLCAkcmVxdWVzdC0+cGF5bWVudF90eXBlKSkuJyBEZWJpdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJ2Rpc3Bvc2FsJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRmaW5hbEFzc2V0LT5hc3NldF9jb2RlCiAgICAgICAgICAgICAgICAgICAgICAgIF07CgogICAgICAgICAgICAgICAgICAgICAgICAkam91cm5hbEVudHJpZXNbJGZpbmFsQXNzZXQtPmJhdGNoLT5nb29kc1JlY2VpdmVkSXRlbXNTdG9ja0luLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlX3JhdGVfaWRdW10gPSBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRjb3N0X2NlbnRyZV9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1sndGF4X3BheWFibGUnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gc3lzdGVtRG91YmxlVmFsdWUoJHJlcXVlc3QtPmRpc3Bvc2FsX3RheF9hbW91bnRbJGZpbmFsQXNzZXQtPmFzc2V0X2NvZGVdLCAyKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAnRml4ZWQgQXNzZXQgRGlzcG9zYWwgOjogVGF4IHBheWFibGUgRGViaXQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdkaXNwb3NhbCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc291cmNlJyA9PiAkZmluYWxBc3NldC0+YXNzZXRfY29kZQogICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYoJHRvdGFsX2R1ZSAhPSAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgJGpvdXJuYWxFbnRyaWVzWyRmaW5hbEFzc2V0LT5iYXRjaC0+Z29vZHNSZWNlaXZlZEl0ZW1zU3RvY2tJbi0+cmVsUHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZV9yYXRlX2lkXVtdID0gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAkY29zdF9jZW50cmVfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gKGlzc2V0KCRmaW5hbEFzc2V0LT5maW5hbEFzc2V0LT5kZXByZWNpYXRpb25fZGlzcG9zYWxfYWNjb3VudF9pZCkgJiYgJGZpbmFsQXNzZXQtPmZpbmFsQXNzZXQtPmRlcHJlY2lhdGlvbl9kaXNwb3NhbF9hY2NvdW50X2lkID4gMCA/ICRmaW5hbEFzc2V0LT5maW5hbEFzc2V0LT5kZXByZWNpYXRpb25fZGlzcG9zYWxfYWNjb3VudF9pZCA6ICRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydkZXByZWNpYXRpb25fZGlzcG9zYWxfYWNjb3VudCddKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gc3lzdGVtRG91YmxlVmFsdWUoKCR0b3RhbF9kdWUgPiAwID8gJHRvdGFsX2R1ZSA6IDApLCAyKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+IHN5c3RlbURvdWJsZVZhbHVlKCgkdG90YWxfZHVlIDwgMCA/ICR0b3RhbF9kdWUqKC0xKSA6IDApLCAyKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICdGaXhlZCBBc3NldCBEaXNwb3NhbCAnLnVjd29yZHMoJGFzc2V0X2dhaW5fbG9zcykuJyAnLigkdG90YWxfZHVlID4gMCA/ICdEZWJpdCcgOiAnQ3JlZGl0JyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJ2Rpc3Bvc2FsJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRmaW5hbEFzc2V0LT5hc3NldF9jb2RlCiAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmKGlzX2FycmF5KCRqb3VybmFsRW50cmllcykgJiYgY291bnQoJGpvdXJuYWxFbnRyaWVzKSA+IDApewogICAgICAgICAgICAgICAgICAgIGZvcmVhY2goJGpvdXJuYWxFbnRyaWVzIGFzICRleGNoYW5nZV9yYXRlX2lkID0+ICRlbnRyaWVzKXsKICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZUxlZGdlckVudHJpZXMoNSwgZGF0ZSgnWS1tLWQgSDppOnMnLCBzdHJ0b3RpbWUoJGRhdGUuJyAnLmRhdGUoJ0g6aTpzJykpKSwgMSwgJycsICRyZXF1ZXN0LT5uYXJyYXRpb24sICRlbnRyaWVzLCAkZXhjaGFuZ2VfcmF0ZV9pZCwgMCwgMCwgMCwgZ2V0Q29zdENlbnRyZUNvbXBhbnkoJGNvc3RfY2VudHJlX2lkKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIERCOjpjb21taXQoKTsKICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhTdWNjZXNzKCJGaXhlZCBJdGVtcyBoYXMgYmVlbiBkaXNwb3NlZCBTdWNjZXNzZnVsbHkuIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigiUGxlYXNlIGNob29zZSBzb21lIEZpeGVkIEFzc2V0IEl0ZW1zIGZvciBEaXNwb3NhbC4iKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBzaG93KCRpZCkKICAgIHsKICAgICAgICAKICAgIH0KCn0K