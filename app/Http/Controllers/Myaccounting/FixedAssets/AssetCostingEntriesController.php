<?php
bolt_decrypt( __FILE__ , 'vvHBW3'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcTXlhY2NvdW50aW5nXEZpeGVkQXNzZXRzOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKCnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDb21wYW55Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHVyY2hhc2VcUHVyY2hhc2VPcmRlcjsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFB1cmNoYXNlXFB1cmNoYXNlT3JkZXJJdGVtOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHJvZHVjdDsKdXNlIEFwcFxNb2RlbHNcRml4ZWRBc3NldHNcQXNzZXRDb3N0aW5nRW50cnk7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xCYW5rQWNjb3VudDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXENvc3RDZW50cmU7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xHcm5cR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcU3VwcGxpZXJzOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcU3VwcGxpZXJQYXltZW50OwoKdXNlIEFwcCwgREI7CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xBdXRoOwoKY2xhc3MgQXNzZXRDb3N0aW5nRW50cmllc0NvbnRyb2xsZXIgZXh0ZW5kcyBDb250cm9sbGVyCnsKICAgIHB1YmxpYyBmdW5jdGlvbiBpbmRleCgpCiAgICB7CiAgICAgICAgJHRpdGxlID0gJ0Fzc2V0IENvc3RpbmcgRW50cmllcyc7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJGRhdGEgPSBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICR0aXRsZSwKICAgICAgICAgICAgICAgICdjb21wYW5pZXMnID0+IENvbXBhbnk6OmhhcygncHJvZml0Q2VudHJlcy5jb3N0Q2VudHJlcycpCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCd1c2VycycsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3VzZXJfaWQnLCBhdXRoKCktPnVzZXIoKS0+aWQpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+Z2V0KCksCiAgICAgICAgICAgIF07CiAgICAgICAgICAgIHJldHVybiB2aWV3KCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMuZml4ZWRBc3NldHMuYXNzZXRDb3N0aW5nRW50cmllcy5pbmRleCcsICRkYXRhKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGNyZWF0ZSgpCiAgICB7CiAgICAgICAgaWYocmVxdWVzdCgpLT5nZXQoJ2FjdGlvbicpID09ICdwbycpewogICAgICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgICAgICdwdXJjaGFzZU9yZGVycycgPT4gUHVyY2hhc2VPcmRlcjo6d2hlcmUoJ2lzX2Nsb3NlZCcsIDApCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdVbml0JywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnY29tcGFueV9pZCcsIHJlcXVlc3QoKS0+Z2V0KCdjb21wYW55X2lkJykpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC8vIC0+d2hlcmUoZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIC8vICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsUHVyY2hhc2VPcmRlckl0ZW1zLnJlbFByb2R1Y3QuY2F0ZWdvcnknLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgLy8gICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaXNfY3dpcCcsIDEpOwogICAgICAgICAgICAgICAgLy8gICAgIH0pCiAgICAgICAgICAgICAgICAvLyAgICAgLT5vcldoZXJlSGFzKCdwdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zLnJlcXVpc2l0aW9uLnByb2plY3RUYXNrJyk7CiAgICAgICAgICAgICAgICAvLyB9KQogICAgICAgICAgICAgICAgLT5oYXMoJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbicpCiAgICAgICAgICAgICAgICAtPmdldCgpLAogICAgICAgICAgICBdOwogICAgICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLmZpeGVkQXNzZXRzLmFzc2V0Q29zdGluZ0VudHJpZXMucG8nLCAkZGF0YSk7CiAgICAgICAgfWVsc2VpZihyZXF1ZXN0KCktPmdldCgnYWN0aW9uJykgPT0gJ3N0b2NrcycpewogICAgICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgICAgICdzdG9ja3MnID0+IEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbjo6d2hlcmVIYXMoJ3JlbFB1cmNoYXNlT3JkZXIuVW5pdCcsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2NvbXBhbnlfaWQnLCByZXF1ZXN0KCktPmdldCgnY29tcGFueV9pZCcpKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlKCdwdXJjaGFzZV9vcmRlcl9pZCcsIHJlcXVlc3QoKS0+Z2V0KCdwdXJjaGFzZV9vcmRlcl9pZCcpKQogICAgICAgICAgICAgICAgLy8gLT53aGVyZShmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgLy8gICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdyZWxHb29kc1JlY2VpdmVkSXRlbXMucmVsUHJvZHVjdC5jYXRlZ29yeScsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAvLyAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19jd2lwJywgMSk7CiAgICAgICAgICAgICAgICAvLyAgICAgfSk7CiAgICAgICAgICAgICAgICAvLyB9KQogICAgICAgICAgICAgICAgLT5kb2VzbnRIYXZlKCdiYXRjaGVzJykKICAgICAgICAgICAgICAgIC0+Z2V0KCksCiAgICAgICAgICAgIF07CiAgICAgICAgICAgIHJldHVybiB2aWV3KCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMuZml4ZWRBc3NldHMuYXNzZXRDb3N0aW5nRW50cmllcy5zdG9ja3MnLCAkZGF0YSk7CiAgICAgICAgfWVsc2VpZihyZXF1ZXN0KCktPmdldCgnYWN0aW9uJykgPT0gJ2Nvc3RzJyl7CiAgICAgICAgICAgICRwdXJjaGFzZU9yZGVyID0gUHVyY2hhc2VPcmRlcjo6d2l0aChbCiAgICAgICAgICAgICAgICAncmVsUHVyY2hhc2VPcmRlckl0ZW1zJywKICAgICAgICAgICAgICAgICdyZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JwogICAgICAgICAgICBdKQogICAgICAgICAgICAtPmZpbmQocmVxdWVzdCgpLT5nZXQoJ3B1cmNoYXNlX29yZGVyX2lkJykpOwogICAgICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgICAgICdwdXJjaGFzZV9vcmRlcl9pZCcgPT4gcmVxdWVzdCgpLT5nZXQoJ3B1cmNoYXNlX29yZGVyX2lkJyksCiAgICAgICAgICAgICAgICAncHVyY2hhc2VPcmRlcicgPT4gJHB1cmNoYXNlT3JkZXIsCiAgICAgICAgICAgICAgICAnZ29vZHNfcmVjZWl2ZWRfaXRlbXNfc3RvY2tfaW5faWQnID0+IHJlcXVlc3QoKS0+Z2V0KCdnb29kc19yZWNlaXZlZF9pdGVtc19zdG9ja19pbl9pZCcpLAogICAgICAgICAgICAgICAgJ2l0ZW1zJyA9PiBHb29kc1JlY2VpdmVkSXRlbVN0b2NrSW46OndpdGgoWwogICAgICAgICAgICAgICAgICAgICdyZWxHb29kc1JlY2VpdmVkSXRlbXMucmVsUHJvZHVjdC5wcm9kdWN0VW5pdCcsCiAgICAgICAgICAgICAgICAgICAgJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcy5yZWxQcm9kdWN0LmF0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAvLyAtPndoZXJlKGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAvLyAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3JlbEdvb2RzUmVjZWl2ZWRJdGVtcy5yZWxQcm9kdWN0LmNhdGVnb3J5JywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIC8vICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX2N3aXAnLCAxKTsKICAgICAgICAgICAgICAgIC8vICAgICB9KTsKICAgICAgICAgICAgICAgIC8vIH0pCiAgICAgICAgICAgICAgICAtPmRvZXNudEhhdmUoJ2JhdGNoZXMnKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygncmVsR29vZHNSZWNlaXZlZEl0ZW1zJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZ29vZHNfcmVjZWl2ZWRfbm90ZV9pZCcsIHJlcXVlc3QoKS0+Z2V0KCdnb29kc19yZWNlaXZlZF9pdGVtc19zdG9ja19pbl9pZCcpKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlKGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRwdXJjaGFzZU9yZGVyKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncmVsR29vZHNSZWNlaXZlZEl0ZW1zLnJlbFByb2R1Y3QnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcHVyY2hhc2VPcmRlcil7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2lkJywgaXNzZXQoJHB1cmNoYXNlT3JkZXItPmlkKSA/ICRwdXJjaGFzZU9yZGVyLT5yZWxQdXJjaGFzZU9yZGVySXRlbXMtPnBsdWNrKCdwcm9kdWN0X2lkJyktPnRvQXJyYXkoKSA6IFtdKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmdldCgpLAogICAgICAgICAgICAgICAgJ2Nvc3RDZW50cmVzJyA9PiBnZXRDb3N0Q2VudHJlcyh0cnVlLCByZXF1ZXN0KCktPmdldCgnY29tcGFueV9pZCcpKSwKICAgICAgICAgICAgXTsKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5maXhlZEFzc2V0cy5hc3NldENvc3RpbmdFbnRyaWVzLmNvc3RzJywgJGRhdGEpOwogICAgICAgIH1lbHNlaWYocmVxdWVzdCgpLT5nZXQoJ2FjdGlvbicpID09ICdjb3N0LWRldGFpbHMnKXsKICAgICAgICAgICAgJGRhdGEgPSBbCiAgICAgICAgICAgICAgICAnY29zdHMnID0+IEFzc2V0Q29zdGluZ0VudHJ5Ojp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAnY3JlYXRvcicKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAtPndoZXJlKCdwb19pZCcsIHJlcXVlc3QoKS0+Z2V0KCdwdXJjaGFzZV9vcmRlcl9pZCcpKQogICAgICAgICAgICAgICAgLT53aGVyZSgncHJvZHVjdF9pZCcsIHJlcXVlc3QoKS0+Z2V0KCdwcm9kdWN0X2lkJykpCiAgICAgICAgICAgICAgICAtPmdldCgpLAogICAgICAgICAgICBdOwogICAgICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLmZpeGVkQXNzZXRzLmFzc2V0Q29zdGluZ0VudHJpZXMuY29zdC1kZXRhaWxzJywgJGRhdGEpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gc3RvcmUoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkcmVxdWVzdC0+dmFsaWRhdGUoWwogICAgICAgICAgICAncHVyY2hhc2Vfb3JkZXJfaWQnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdwcm9kdWN0cycgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ3Byb2R1Y3RzLionID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdjb3N0cycgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2Nvc3RzLionID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdkYXRldGltZScgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2RhdGV0aW1lLionID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJ3JlcXVpcmVkJywKICAgICAgICBdKTsKCiAgICAgICAgaWYoJHJlcXVlc3QtPmNvc3RfY2VudHJlX2lkIDw9IDApewogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gIlBsZWFzZSBDaG9vc2UgQ29zdCBDZW50cmUiCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KCiAgICAgICAgJHRvdGFsID0gMDsKICAgICAgICBmb3JlYWNoKCRyZXF1ZXN0LT5wcm9kdWN0cyBhcyAka2V5ID0+ICRnb29kc19yZWNlaXZlZF9pdGVtc19zdG9ja19pbl9pZCl7CiAgICAgICAgICAgICR0b3RhbCArPSAkcmVxdWVzdC0+Y29zdHNbJGdvb2RzX3JlY2VpdmVkX2l0ZW1zX3N0b2NrX2luX2lkXTsKICAgICAgICB9CgogICAgICAgIGlmKCR0b3RhbCA8PSAwKXsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJQbGVhc2UgZW50ZXIgc29tZSBjb3N0IGFtb3VudHMuIgogICAgICAgICAgICBdKTsKICAgICAgICB9CgogICAgICAgIGlmKGluX2FycmF5KCRyZXF1ZXN0LT5wYXltZW50X3R5cGUsIFsnY2hlcXVlJywgJ2Z1bmQtdHJhbnNmZXInXSkpewogICAgICAgICAgICAkcmVxdWVzdC0+dmFsaWRhdGUoWwogICAgICAgICAgICAgICAgJ3BheW1lbnRfZGV0YWlscycgPT4gJ3JlcXVpcmVkJwogICAgICAgICAgICBdKTsKICAgICAgICB9CgogICAgICAgICRkYXRldGltZSA9IGRhdGUoJ1ktbS1kIEg6aTpzJyk7CgogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgdHJ5ewoKICAgICAgICAgICAgJHB1cmNoYXNlT3JkZXIgPSBQdXJjaGFzZU9yZGVyOjpmaW5kKCRyZXF1ZXN0LT5wdXJjaGFzZV9vcmRlcl9pZCk7CgogICAgICAgICAgICAkbGVkZ2VyRW50cmllcyA9IFtdOwogICAgICAgICAgICBmb3JlYWNoKCRyZXF1ZXN0LT5wcm9kdWN0cyBhcyAka2V5ID0+ICRnb29kc19yZWNlaXZlZF9pdGVtc19zdG9ja19pbl9pZCl7CiAgICAgICAgICAgICAgICBpZigkcmVxdWVzdC0+Y29zdHNbJGdvb2RzX3JlY2VpdmVkX2l0ZW1zX3N0b2NrX2luX2lkXSA+IDApewogICAgICAgICAgICAgICAgICAgICRzdG9ja0luID0gR29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luOjpmaW5kT3JGYWlsKCRnb29kc19yZWNlaXZlZF9pdGVtc19zdG9ja19pbl9pZCk7CgogICAgICAgICAgICAgICAgICAgICRjb3N0ID0gQXNzZXRDb3N0aW5nRW50cnk6OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICdwdXJjaGFzZV9vcmRlcl9pZCcgPT4gJHJlcXVlc3QtPnB1cmNoYXNlX29yZGVyX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAnc3VwcGxpZXJfaWQnID0+ICgkcmVxdWVzdC0+cGF5bWVudF90eXBlID09ICdzdXBwbGllci1wYXlhYmxlJyA/ICRyZXF1ZXN0LT5wYXltZW50X3N1cHBsaWVyX2lkIDogJHN0b2NrSW4tPnJlbFB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+c3VwcGxpZXJfaWQpLAogICAgICAgICAgICAgICAgICAgICAgICAnZ29vZHNfcmVjZWl2ZWRfaXRlbXNfc3RvY2tfaW5faWQnID0+ICRzdG9ja0luLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2RhdGUnID0+IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRyZXF1ZXN0LT5kYXRldGltZVskZ29vZHNfcmVjZWl2ZWRfaXRlbXNfc3RvY2tfaW5faWRdKSksCiAgICAgICAgICAgICAgICAgICAgICAgICd0aW1lJyA9PiBkYXRlKCdIOmk6cycsIHN0cnRvdGltZSgkcmVxdWVzdC0+ZGF0ZXRpbWVbJGdvb2RzX3JlY2VpdmVkX2l0ZW1zX3N0b2NrX2luX2lkXSkpLAogICAgICAgICAgICAgICAgICAgICAgICAnY29zdCcgPT4gJHJlcXVlc3QtPmNvc3RzWyRnb29kc19yZWNlaXZlZF9pdGVtc19zdG9ja19pbl9pZF0sCiAgICAgICAgICAgICAgICAgICAgICAgICdkZXRhaWxzJyA9PiAkcmVxdWVzdC0+ZGV0YWlsc1skZ29vZHNfcmVjZWl2ZWRfaXRlbXNfc3RvY2tfaW5faWRdLAogICAgICAgICAgICAgICAgICAgICAgICAnYXR0YWNobWVudHMnID0+ICRyZXF1ZXN0LT5oYXNGaWxlKCdhdHRhY2htZW50cy4nLiRnb29kc19yZWNlaXZlZF9pdGVtc19zdG9ja19pbl9pZCkgPyAkdGhpcy0+ZmlsZVVwbG9hZCgkcmVxdWVzdC0+ZmlsZSgnYXR0YWNobWVudHMuJy4kZ29vZHNfcmVjZWl2ZWRfaXRlbXNfc3RvY2tfaW5faWQpLCAndXBsb2FkL2Fzc2V0LWNvc3QtZW50cmllcycpIDogJycsCiAgICAgICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgICAgICRhY2NvdW50RGVmYXVsdFNldHRpbmdzID0gYWNjb3VudERlZmF1bHRTZXR0aW5ncygpOwoKICAgICAgICAgICAgICAgICAgICAkZGViaXRfYWNjb3VudCA9IChpc3NldCgkc3RvY2tJbi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0LT5pbnZlbnRvcnlfYWNjb3VudF9pZCkgJiYgJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+aW52ZW50b3J5X2FjY291bnRfaWQgPiAwID8gJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+aW52ZW50b3J5X2FjY291bnRfaWQgOiAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snaW52ZW50b3J5X2FjY291bnQnXSk7CiAgICAgICAgICAgICAgICAgICAgaWYoaXNzZXQoJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+aWQpICYmICRzdG9ja0luLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmlzX3NlcnZpY2UgPT0gMSl7CiAgICAgICAgICAgICAgICAgICAgICAgICRkZWJpdF9hY2NvdW50ID0gKGlzc2V0KCRzdG9ja0luLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmNvZ3NfYWNjb3VudF9pZCkgJiYgJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+Y29nc19hY2NvdW50X2lkID4gMCA/ICRzdG9ja0luLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmNvZ3NfYWNjb3VudF9pZCA6ICRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydjb2dzX2FjY291bnQnXSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRsZWRnZXJFbnRyaWVzLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJHJlcXVlc3QtPmNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJGRlYml0X2FjY291bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gJHJlcXVlc3QtPmNvc3RzWyRnb29kc19yZWNlaXZlZF9pdGVtc19zdG9ja19pbl9pZF0sCiAgICAgICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICdDb3N0IEVudHJ5IDo6ICcuKCRzdG9ja0luLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbFByb2R1Y3QtPmNhdGVnb3J5LT5pc19jd2lwID09IDEgPyAnQ1dJUCcgOiAoJHN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+aXNfc2VydmljZSA9PSAxID8gJ1NlcnZpY2UgQ29zdGluZycgOiAnSW52ZW50b3J5JykpLicgRGViaXQnLAogICAgICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJ2Fzc2V0LWNvc3QtZW50cnknLAogICAgICAgICAgICAgICAgICAgICAgICAnc291cmNlJyA9PiAkY29zdC0+aWQKICAgICAgICAgICAgICAgICAgICBdKTsKCiAgICAgICAgICAgICAgICAgICAgJGNyZWRpdF9hY2NvdW50ID0gJHJlcXVlc3QtPmNoYXJ0X29mX2FjY291bnRfaWQ7CiAgICAgICAgICAgICAgICAgICAgaWYoJHJlcXVlc3QtPnBheW1lbnRfdHlwZSA9PSAnY2FzaCcpewogICAgICAgICAgICAgICAgICAgICAgICAkY3JlZGl0X2FjY291bnQgPSAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snY2FzaF9pbl9oYW5kX2FjY291bnQnXTsKICAgICAgICAgICAgICAgICAgICB9ZWxzZWlmKCRyZXF1ZXN0LT5wYXltZW50X3R5cGUgPT0gJ2NoZXF1ZScgfHwgJHJlcXVlc3QtPnBheW1lbnRfdHlwZSA9PSAnZnVuZC10cmFuc2ZlcicpewogICAgICAgICAgICAgICAgICAgICAgICAkYmFua0FjY291bnQgPSBCYW5rQWNjb3VudDo6ZmluZCgkcmVxdWVzdC0+YmFua19hY2NvdW50X2lkKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoaXNzZXQoJGJhbmtBY2NvdW50LT5jaGFydF9vZl9hY2NvdW50X2lkKSAmJiAkYmFua0FjY291bnQtPmNoYXJ0X29mX2FjY291bnRfaWQgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjcmVkaXRfYWNjb3VudCA9ICRiYW5rQWNjb3VudC0+Y2hhcnRfb2ZfYWNjb3VudF9pZDsKICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY3JlZGl0X2FjY291bnQgPSAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snYmFua19hY2NvdW50J107CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9ZWxzZWlmKCRyZXF1ZXN0LT5wYXltZW50X3R5cGUgPT0gJ3N1cHBsaWVyLXBheWFibGUnKXsKICAgICAgICAgICAgICAgICAgICAgICAgJHN1cHBsaWVyID0gU3VwcGxpZXJzOjpmaW5kKCRyZXF1ZXN0LT5wYXltZW50X3N1cHBsaWVyX2lkKTsKICAgICAgICAgICAgICAgICAgICAgICAgJGNyZWRpdF9hY2NvdW50ID0gKGlzc2V0KCRzdXBwbGllci0+cGF5YWJsZV9hY2NvdW50X2lkKSAmJiAkc3VwcGxpZXItPnBheWFibGVfYWNjb3VudF9pZCA+IDAgPyAkc3VwcGxpZXItPnBheWFibGVfYWNjb3VudF9pZCA6ICRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydzdXBwbGllcl9wYXlhYmxlX2FjY291bnQnXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGlzc2V0KCRzdXBwbGllci0+aWQpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzdXBwbGllclBheW1lbnQgPSBTdXBwbGllclBheW1lbnQ6OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N1cHBsaWVyX2lkJyA9PiAkc3VwcGxpZXItPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwdXJjaGFzZV9vcmRlcl9pZCcgPT4gJHJlcXVlc3QtPnB1cmNoYXNlX29yZGVyX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0cmFuc2VjdGlvbl9kYXRlJyA9PiBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkcmVxdWVzdC0+ZGF0ZXRpbWVbJGdvb2RzX3JlY2VpdmVkX2l0ZW1zX3N0b2NrX2luX2lkXSkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0cmFuc2VjdGlvbl90eXBlJyA9PiAncHVyY2hhc2UnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdleGNoYW5nZV9yYXRlX2lkJyA9PiAkcHVyY2hhc2VPcmRlci0+cmVsUXVvdGF0aW9uLT5leGNoYW5nZV9yYXRlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdiaWxsX251bWJlcicgPT4gJHJlcXVlc3QtPnBheW1lbnRfZGV0YWlscywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYmlsbF9hbW91bnQnID0+ICRyZXF1ZXN0LT5jb3N0c1skZ29vZHNfcmVjZWl2ZWRfaXRlbXNfc3RvY2tfaW5faWRdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwYXlfYW1vdW50JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwYXlfZGF0ZScgPT4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPmRhdGV0aW1lWyRnb29kc19yZWNlaXZlZF9pdGVtc19zdG9ja19pbl9pZF0pKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYmlsbF90eXBlJyA9PiAnYXNzZXQtY29zdGluZy1lbnRyaWVzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiAnYXVkaXRlZCcgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXZlU3VwcGxpZXJMZWRnZXIoJHN1cHBsaWVyLT5pZCwgZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPmRhdGV0aW1lWyRnb29kc19yZWNlaXZlZF9pdGVtc19zdG9ja19pbl9pZF0pKSwgMCwgJHJlcXVlc3QtPmNvc3RzWyRnb29kc19yZWNlaXZlZF9pdGVtc19zdG9ja19pbl9pZF0sICcnLCAnJywgJ0Fzc2V0IENvc3RpbmcgRW50cmllcyA6OiBTdXBwbGllciBQYXlhYmxlIENyZWRpdCcsIChpc3NldCgkcmVxdWVzdC0+YmFua19hY2NvdW50X2lkKSA/ICRyZXF1ZXN0LT5iYW5rX2FjY291bnRfaWQgOiAwKSwgJHN1cHBsaWVyUGF5bWVudC0+aWQsICRwdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlX3JhdGVfaWQpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRsZWRnZXJFbnRyaWVzLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJHJlcXVlc3QtPmNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJGNyZWRpdF9hY2NvdW50LAogICAgICAgICAgICAgICAgICAgICAgICAnZGViaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+ICRyZXF1ZXN0LT5jb3N0c1skZ29vZHNfcmVjZWl2ZWRfaXRlbXNfc3RvY2tfaW5faWRdLAogICAgICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAnQ29zdCBFbnRyeSA6OiAnLnVjd29yZHMoc3RyX3JlcGxhY2UoJy0nLCAnICcsICRyZXF1ZXN0LT5wYXltZW50X3R5cGUpKS4nIENyZWRpdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAnYXNzZXQtY29zdC1lbnRyeScsCiAgICAgICAgICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRjb3N0LT5pZAogICAgICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgICAgICAkZGF0ZXRpbWUgPSAkcmVxdWVzdC0+ZGF0ZXRpbWVbJGdvb2RzX3JlY2VpdmVkX2l0ZW1zX3N0b2NrX2luX2lkXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoaXNzZXQoJGxlZGdlckVudHJpZXNbMF0pKXsKICAgICAgICAgICAgICAgICRlbnRyeSA9IHNhdmVMZWRnZXJFbnRyaWVzKCgkcmVxdWVzdC0+cGF5bWVudF90eXBlID09ICdzdXBwbGllci1wYXlhYmxlJyA/IDUgOiA0KSwgJGRhdGV0aW1lLCAxLCAnJywgJHJlcXVlc3QtPm5hcmF0aW9uLCAkbGVkZ2VyRW50cmllcywgJHB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VSYXRlLT5pZCwgMCwgMCwgMCwgZ2V0Q29zdENlbnRyZUNvbXBhbnkoJHJlcXVlc3QtPmNvc3RfY2VudHJlX2lkKSk7CiAgICAgICAgICAgICAgICBzYXZlUE9FbnRyeSgkZW50cnksICgkcmVxdWVzdC0+cGF5bWVudF90eXBlID09ICdzdXBwbGllci1wYXlhYmxlJyA/ICRyZXF1ZXN0LT5wYXltZW50X3N1cHBsaWVyX2lkIDogJHB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+c3VwcGxpZXJfaWQpLCAkcmVxdWVzdC0+cHVyY2hhc2Vfb3JkZXJfaWQsICdhc3NldC1jb3N0LWVudHJ5Jyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIERCOjpjb21taXQoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlc3Npb24oKS0+Zmxhc2goJ2FsZXJ0LXR5cGUnLCAnc3VjY2VzcycpOwogICAgICAgICAgICBzZXNzaW9uKCktPmZsYXNoKCdtZXNzYWdlJywgIkFzc2V0IENvc3RpbmcgRW50cmllcyBoYXMgYmVlbiBzYXZlZCBzdWNjZXNzZnVsbHkuIik7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgICAgICAgICBdKTsKICAgICAgICB9Y2F0Y2goXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gc2hvdygkaWQpCiAgICB7CiAgICAgICAgJGdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbiA9IEdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbjo6ZmluZE9yRmFpbCgkaWQpOwoKICAgICAgICAkY29zdHMgPSBBc3NldENvc3RpbmdFbnRyeTo6d2l0aChbCiAgICAgICAgICAgICdjcmVhdG9yJwogICAgICAgIF0pCiAgICAgICAgLT53aGVyZSgnZ29vZHNfcmVjZWl2ZWRfaXRlbXNfc3RvY2tfaW5faWQnLCAkZ29vZHNSZWNlaXZlZEl0ZW1TdG9ja0luLT5pZCkKICAgICAgICAtPmdldCgpOwogICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgJ3RpdGxlJyA9PiAnQXNzZXQgQ29zdGluZyBEZXRhaWxzIGZvciBHUk4gIycuJGdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxHb29kc1JlY2VpdmVkTm90ZS0+Z3JuX3JlZmVyZW5jZV9uby4nLCBJdGVtICMnLiRnb29kc1JlY2VpdmVkSXRlbVN0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsUHJvZHVjdC0+bmFtZS4nICcuZ2V0UHJvZHVjdEF0dHJpYnV0ZXNGYXN0ZXIoJGdvb2RzUmVjZWl2ZWRJdGVtU3RvY2tJbi0+cmVsR29vZHNSZWNlaXZlZEl0ZW1zLT5yZWxQcm9kdWN0KSwKICAgICAgICAgICAgJ2JvZHknID0+IHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5maXhlZEFzc2V0cy5hc3NldENvc3RpbmdFbnRyaWVzLmNvc3QtZGV0YWlscycsIGNvbXBhY3QoJ2Nvc3RzJykpLT5yZW5kZXIoKQogICAgICAgIF0pOwogICAgfQp9Cg==