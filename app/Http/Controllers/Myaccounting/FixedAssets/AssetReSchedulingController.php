<?php
bolt_decrypt( __FILE__ , 'YOROkL'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcTXlhY2NvdW50aW5nXEZpeGVkQXNzZXRzOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKCnVzZSBBcHBcTW9kZWxzXEZpeGVkQXNzZXRzXEZpeGVkQXNzZXRCYXRjaDsKdXNlIEFwcFxNb2RlbHNcRml4ZWRBc3NldHNcRml4ZWRBc3NldEJhdGNoSXRlbTsKdXNlIEFwcFxNb2RlbHNcRml4ZWRBc3NldHNcRml4ZWRBc3NldEJhdGNoSXRlbURlcHJlY2lhdGlvbjsKdXNlIEFwcFxNb2RlbHNcRml4ZWRBc3NldHNcRml4ZWRBc3NldEJhdGNoVXNlcjsKdXNlIEFwcFxNb2RlbHNcRml4ZWRBc3NldHNcRml4ZWRBc3NldEJhdGNoSXRlbVNjaGVkdWxlOwp1c2UgQXBwXE1vZGVsc1xGaXhlZEFzc2V0c1xGaXhlZEFzc2V0QmF0Y2hJdGVtU2NoZWR1bGVFbnRyeTsKdXNlIEFwcFxVc2VyOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcQ2F0ZWdvcnk7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xQcm9kdWN0Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQ29tcGFueTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEN1cnJlbmN5VHlwZTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXENvc3RDZW50cmU7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xCYW5rQWNjb3VudDsKCnVzZSBBcHAsIERCLCBEYXRhVGFibGVzOwp1c2UgSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcQXV0aDsKCmNsYXNzIEFzc2V0UmVTY2hlZHVsaW5nQ29udHJvbGxlciBleHRlbmRzIENvbnRyb2xsZXIKewogICAgcHVibGljIGZ1bmN0aW9uIGFzc3NldFJlZ2lzdGVySGVhZGVyQ29sdW1ucygkdmFsdWU9JycpCiAgICAgewogICAgICAgIHJldHVybiBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgICAgICBbJ2NvbXBhbnknLCAnY29tcGFueScsJ3RleHQtbGVmdCddLAogICAgICAgICAgICBbJ2Fzc2V0X25hbWUnLCAnYXNzZXRfbmFtZScsJ3RleHQtbGVmdCddLAogICAgICAgICAgICBbJ3N1Yl9jYXRlZ29yeScsICdzdWJfY2F0ZWdvcnknLCd0ZXh0LWxlZnQnXSwKICAgICAgICAgICAgWydjYXRlZ29yeScsICdjYXRlZ29yeScsICd0ZXh0LWxlZnQnXSwKICAgICAgICAgICAgWydpZGVudGlmaWNhdGlvbl9tYXJrJywgJ2lkZW50aWZpY2F0aW9uX21hcmsnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydpbml0aWFsX2Nvc3QnLCAnaW5pdGlhbF9jb3N0JywgJ3RleHQtY2VudGVyJ10sIAogICAgICAgICAgICBbJ2luaXRpYWxfbGlmZScsICdpbml0aWFsX2xpZmUnLCAndGV4dC1jZW50ZXInXSwgCiAgICAgICAgICAgIFsnaW5pdGlhbF9yYXRlJywgJ2luaXRpYWxfcmF0ZScsICd0ZXh0LWNlbnRlciddLCAKICAgICAgICAgICAgWydjb25zdW1lZF9saWZlJywgJ2NvbnN1bWVkX2xpZmUnLCAndGV4dC1jZW50ZXInXSwgCiAgICAgICAgICAgIFsnYWNjdW11bGF0ZWRfZGVwcmVjaWF0aW9uJywgJ2FjY3VtdWxhdGVkX2RlcHJlY2lhdGlvbicsICd0ZXh0LWNlbnRlciddLCAKICAgICAgICAgICAgWydjb3N0JywgJ2Nvc3QnLCAndGV4dC1jZW50ZXInXSwgCiAgICAgICAgICAgIFsnbGlmZScsICdsaWZlJywgJ3RleHQtY2VudGVyJ10sIAogICAgICAgICAgICBbJ3JhdGUnLCAncmF0ZScsICd0ZXh0LWNlbnRlciddLCAKICAgICAgICAgICAgWydjcmVhdGVkX2J5JywgJ2NyZWF0ZWRfYnknLCAndGV4dC1jZW50ZXInXSwgCiAgICAgICAgICAgIFsnbG9jYXRpb24nLCAnbG9jYXRpb24nLCAndGV4dC1jZW50ZXInXSwKICAgICAgICApOwogICAgfQogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gaW5kZXgoKQogICAgewogICAgICAgICR0aXRsZSA9ICdBc3NldCBSZS1TY2hlZHVsaW5nJzsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgICAkc2NoZWR1bGVzID0gRml4ZWRBc3NldEJhdGNoSXRlbVNjaGVkdWxlOjp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAnYmF0Y2hJdGVtLmZpbmFsQXNzZXQuYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJywKICAgICAgICAgICAgICAgICAgICAnYmF0Y2hJdGVtLmZpbmFsQXNzZXQucHJvZHVjdFVuaXQnLAogICAgICAgICAgICAgICAgICAgICdiYXRjaEl0ZW0uZmluYWxBc3NldC5jYXRlZ29yeS5jYXRlZ29yeScsCiAgICAgICAgICAgICAgICAgICAgJ2JhdGNoSXRlbS5iYXRjaC5pdGVtcycsCiAgICAgICAgICAgICAgICAgICAgJ2JhdGNoSXRlbS5jdXJyZW50VXNlci5maXhlZEFzc2V0TG9jYXRpb24nLAogICAgICAgICAgICAgICAgICAgICdiYXRjaEl0ZW0uZGVwcmVjaWF0aW9ucycsCgogICAgICAgICAgICAgICAgICAgICdiYXRjaEl0ZW0uYmF0Y2guZ29vZHNSZWNlaXZlZEl0ZW1zU3RvY2tJbi5yZWxQdXJjaGFzZU9yZGVyLnJlbFB1cmNoYXNlT3JkZXJJdGVtcycsCiAgICAgICAgICAgICAgICAgICAgJ2JhdGNoSXRlbS5iYXRjaC5nb29kc1JlY2VpdmVkSXRlbXNTdG9ja0luLnJlbFB1cmNoYXNlT3JkZXIucmVsUXVvdGF0aW9uLnJlbFF1b3RhdGlvbkl0ZW1zJywKICAgICAgICAgICAgICAgICAgICAnYmF0Y2hJdGVtLmJhdGNoLmdvb2RzUmVjZWl2ZWRJdGVtc1N0b2NrSW4uYXNzZXRDb3N0aW5nRW50cmllcycsCgogICAgICAgICAgICAgICAgICAgICdlbnRyaWVzLmVudHJ5LmVudHJ5VHlwZScsCiAgICAgICAgICAgICAgICAgICAgJ2NyZWF0b3InLAoKICAgICAgICAgICAgICAgICAgICAnYmF0Y2hJdGVtLmJhdGNoLmNvc3RDZW50cmUucHJvZml0Q2VudHJlLmNvbXBhbnknCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygnYmF0Y2hJdGVtLmJhdGNoLmNvc3RDZW50cmUucHJvZml0Q2VudHJlJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdjb21wYW55X2lkJywgYXV0aCgpLT51c2VyKCktPmNvbXBhbmllcy0+cGx1Y2soJ2NvbXBhbnlfaWQnKS0+dG9BcnJheSgpKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oIWRhdGF0YWJsZU9yZGVyaW5nKCksIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgnZml4ZWRfYXNzZXRfYmF0Y2hfaXRlbV9zY2hlZHVsZXMuaWQnLCAnZGVzYycpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgJGNvZGVzID0gJHNjaGVkdWxlcy0+Z2V0KCktPnBsdWNrKCdiYXRjaEl0ZW0uYXNzZXRfY29kZScpLT50b0FycmF5KCk7CiAgICAgICAgICAgICAgICAkYWxsQmF0Y2hJdGVtcyA9IEZpeGVkQXNzZXRCYXRjaEl0ZW06OndoZXJlSW4oJ2Fzc2V0X2NvZGUnLCAkY29kZXMpLT5nZXQoKTsKICAgICAgICAgICAgICAgICRhbGxEZXByZWNpYXRpb25zID0gRml4ZWRBc3NldEJhdGNoSXRlbURlcHJlY2lhdGlvbjo6d2l0aChbJ2JhdGNoSXRlbSddKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygnYmF0Y2hJdGVtJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGNvZGVzKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdhc3NldF9jb2RlJywgJGNvZGVzKTsKICAgICAgICAgICAgICAgIH0pLT5nZXQoKTsKCiAgICAgICAgICAgICAgICByZXR1cm4gRGF0YVRhYmxlczo6b2YoCiAgICAgICAgICAgICAgICAgICAgJHNjaGVkdWxlcwogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgLT5hZGRJbmRleENvbHVtbigpCgogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2NvbXBhbnknLCBmdW5jdGlvbigkc2NoZWR1bGUpewogICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkc2NoZWR1bGUtPmJhdGNoSXRlbS0+YmF0Y2gtPmNvc3RDZW50cmUtPnByb2ZpdENlbnRyZS0+Y29tcGFueS0+Y29kZSkgPyAkc2NoZWR1bGUtPmJhdGNoSXRlbS0+YmF0Y2gtPmNvc3RDZW50cmUtPnByb2ZpdENlbnRyZS0+Y29tcGFueS0+Y29kZSA6ICcnOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdjb21wYW55JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnYmF0Y2hJdGVtLmJhdGNoLmNvc3RDZW50cmUucHJvZml0Q2VudHJlLmNvbXBhbnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnY29kZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhc3NldF9uYW1lJywgZnVuY3Rpb24oJHNjaGVkdWxlKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHNjaGVkdWxlLT5iYXRjaEl0ZW0tPmZpbmFsQXNzZXQtPm5hbWUpID8gJHNjaGVkdWxlLT5iYXRjaEl0ZW0tPmZpbmFsQXNzZXQtPm5hbWUuJyAnLmdldFByb2R1Y3RBdHRyaWJ1dGVzRmFzdGVyKCRzY2hlZHVsZS0+YmF0Y2hJdGVtLT5maW5hbEFzc2V0KSA6ICcnOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdhc3NldF9uYW1lJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnYmF0Y2hJdGVtLmZpbmFsQXNzZXQnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3N1Yl9jYXRlZ29yeScsIGZ1bmN0aW9uKCRzY2hlZHVsZSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCRzY2hlZHVsZS0+YmF0Y2hJdGVtLT5maW5hbEFzc2V0LT5jYXRlZ29yeS0+bmFtZSkgPyAkc2NoZWR1bGUtPmJhdGNoSXRlbS0+ZmluYWxBc3NldC0+Y2F0ZWdvcnktPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignc3ViX2NhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnYmF0Y2hJdGVtLmZpbmFsQXNzZXQuY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2NhdGVnb3J5JywgZnVuY3Rpb24oJHNjaGVkdWxlKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHNjaGVkdWxlLT5iYXRjaEl0ZW0tPmZpbmFsQXNzZXQtPmNhdGVnb3J5LT5jYXRlZ29yeS0+bmFtZSkgPyAkc2NoZWR1bGUtPmJhdGNoSXRlbS0+ZmluYWxBc3NldC0+Y2F0ZWdvcnktPmNhdGVnb3J5LT5uYW1lIDogJyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2NhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnYmF0Y2hJdGVtLmZpbmFsQXNzZXQuY2F0ZWdvcnkuY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2xvY2F0aW9uJywgZnVuY3Rpb24oJHNjaGVkdWxlKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHNjaGVkdWxlLT5iYXRjaEl0ZW0tPmN1cnJlbnRVc2VyLT5maXhlZEFzc2V0TG9jYXRpb24tPm5hbWUpID8gJHNjaGVkdWxlLT5iYXRjaEl0ZW0tPmN1cnJlbnRVc2VyLT5maXhlZEFzc2V0TG9jYXRpb24tPm5hbWUgOiAnTm90IERpc3RyaWJ1dGVkJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignbG9jYXRpb24nLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdiYXRjaEl0ZW0uY3VycmVudFVzZXIuZml4ZWRBc3NldExvY2F0aW9uJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdjYXBpdGFsaXphdGlvbl9kYXRlJywgZnVuY3Rpb24oJHNjaGVkdWxlKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHNjaGVkdWxlLT5iYXRjaEl0ZW0tPmJhdGNoLT5jcmVhdGVkX2F0KSA/IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRzY2hlZHVsZS0+YmF0Y2hJdGVtLT5iYXRjaC0+Y3JlYXRlZF9hdCkpIDogJyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2NhcGl0YWxpemF0aW9uX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdiYXRjaEl0ZW0uYmF0Y2gnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnY3JlYXRlZF9hdCcsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2lkZW50aWZpY2F0aW9uX21hcmsnLCBmdW5jdGlvbigkc2NoZWR1bGUpewogICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkc2NoZWR1bGUtPmJhdGNoSXRlbS0+YXNzZXRfY29kZSkgPyAkc2NoZWR1bGUtPmJhdGNoSXRlbS0+YXNzZXRfY29kZSA6ICcnOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdpZGVudGlmaWNhdGlvbl9tYXJrJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnYmF0Y2hJdGVtJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2Fzc2V0X2NvZGUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ2luaXRpYWxfY29zdCcsIGZ1bmN0aW9uKCRzY2hlZHVsZSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN5c3RlbU1vbmV5Rm9ybWF0KCRzY2hlZHVsZS0+aW5pdGlhbF9jb3N0KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ2luaXRpYWxfcmF0ZScsIGZ1bmN0aW9uKCRzY2hlZHVsZSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN5c3RlbU1vbmV5Rm9ybWF0KCRzY2hlZHVsZS0+aW5pdGlhbF9yYXRlKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ2FjY3VtdWxhdGVkX2RlcHJlY2lhdGlvbicsIGZ1bmN0aW9uKCRzY2hlZHVsZSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN5c3RlbU1vbmV5Rm9ybWF0KCRzY2hlZHVsZS0+YWNjdW11bGF0ZWRfZGVwcmVjaWF0aW9uKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ2Nvc3QnLCBmdW5jdGlvbiAoJHNjaGVkdWxlKSB7CiAgICAgICAgICAgICAgICAgICAgJGVudHJ5ID0gJHNjaGVkdWxlLT5lbnRyaWVzLT5maXJzdCgpLT5lbnRyeTsKICAgICAgICAgICAgICAgICAgICBpZihpc3NldCgkZW50cnktPmlkKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGEgY2xhc3M9InRleHQtcHJpbWFyeSIgb25jbGljaz0iZ2V0U2hvcnREZXRhaWxzKCQodGhpcykpIiBkYXRhLWlkPSInIC4gKCRlbnRyeS0+aWQpIC4gJyIgZGF0YS1lbnRyeS10eXBlPSInIC4gKCRlbnRyeS0+ZW50cnlUeXBlLT5uYW1lKSAuICciIGRhdGEtY29kZT0iJyAuICgkZW50cnktPmNvZGUpIC4gJyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBzdHlsZT0id2lkdGg6IDE1MHB4O3doaXRlLXNwYWNlOiBub3JtYWwiPicuc3lzdGVtTW9uZXlGb3JtYXQoJHNjaGVkdWxlLT5jb3N0KS4nPC9wPgogICAgICAgICAgICAgICAgICAgICAgICA8L2E+JzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdyYXRlJywgZnVuY3Rpb24oJHNjaGVkdWxlKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3lzdGVtTW9uZXlGb3JtYXQoJHNjaGVkdWxlLT5yYXRlKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignY3JlYXRlZF9ieScsIGZ1bmN0aW9uKCRzY2hlZHVsZSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY2hlZHVsZS0+Y3JlYXRvciA/ICRzY2hlZHVsZS0+Y3JlYXRvci0+bmFtZSA6ICcnOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdjcmVhdGVkX2J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnY3JlYXRvcicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsnY29zdCddKQogICAgICAgICAgICAgICAgLT5tYWtlKHRydWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJHRpdGxlLAogICAgICAgICAgICAgICAgJ2hlYWRlckNvbHVtbnMnID0+ICR0aGlzLT5hc3NzZXRSZWdpc3RlckhlYWRlckNvbHVtbnMoKQogICAgICAgICAgICBdOwogICAgICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLmZpeGVkQXNzZXRzLmFzc2V0UmVTY2hlZHVsaW5nLmluZGV4JywgJGRhdGEpOwogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gY3JlYXRlKCkKICAgIHsKICAgICAgICBpZihyZXF1ZXN0KCktPmdldCgnYWN0aW9uJykgPT0gJ2JhdGNoZXMnKXsKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5maXhlZEFzc2V0cy5hc3NldFJlU2NoZWR1bGluZy5iYXRjaGVzJywgWwogICAgICAgICAgICAgICAgJ2JhdGNoZXMnID0+IEZpeGVkQXNzZXRCYXRjaDo6d2l0aChbCiAgICAgICAgICAgICAgICAgICAgJ2dvb2RzUmVjZWl2ZWRJdGVtc1N0b2NrSW4ucmVsR29vZHNSZWNlaXZlZEl0ZW1zLnJlbEdvb2RzUmVjZWl2ZWROb3RlLnJlbFB1cmNoYXNlT3JkZXIucHVyY2hhc2VPcmRlclJlcXVpc2l0aW9ucycKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdpdGVtcycsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX2Rpc3Bvc2VkJywgMCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygnaXRlbXMuY3VycmVudFVzZXIuZml4ZWRBc3NldExvY2F0aW9uLnVuaXQnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2NvbXBhbnlfaWQnLCBhdXRoKCktPnVzZXIoKS0+Y29tcGFuaWVzLT5wbHVjaygnY29tcGFueV9pZCcpLT50b0FycmF5KCkpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbihyZXF1ZXN0KCktPmdldCgnY29tcGFueV9pZCcpID4gMCwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnaXRlbXMuY3VycmVudFVzZXIuZml4ZWRBc3NldExvY2F0aW9uLnVuaXQnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnY29tcGFueV9pZCcsIHJlcXVlc3QoKS0+Z2V0KCdjb21wYW55X2lkJykpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbihyZXF1ZXN0KCktPmdldCgncHJvZHVjdF9pZCcpID4gMCwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnaXRlbXMnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZmluYWxfYXNzZXRfaWQnLCByZXF1ZXN0KCktPmdldCgncHJvZHVjdF9pZCcpKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmdldCgpLAogICAgICAgICAgICAgICAgJ3NlbGVjdGVkJyA9PiByZXF1ZXN0KCktPmdldCgnc2VsZWN0ZWQnKQogICAgICAgICAgICBdKTsKICAgICAgICB9ZWxzZWlmKHJlcXVlc3QoKS0+Z2V0KCdhY3Rpb24nKSA9PSAnaXRlbXMnKXsKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5maXhlZEFzc2V0cy5hc3NldFJlU2NoZWR1bGluZy5pdGVtcycsIFsKICAgICAgICAgICAgICAgICdmaW5hbEFzc2V0cycgPT4gRml4ZWRBc3NldEJhdGNoSXRlbTo6d2l0aChbCgogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ2N1cnJlbnRVc2VyLmZpeGVkQXNzZXRMb2NhdGlvbi51bml0JywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdjb21wYW55X2lkJywgYXV0aCgpLT51c2VyKCktPmNvbXBhbmllcy0+cGx1Y2soJ2NvbXBhbnlfaWQnKS0+dG9BcnJheSgpKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4ocmVxdWVzdCgpLT5nZXQoJ2NvbXBhbnlfaWQnKSA+IDAsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2N1cnJlbnRVc2VyLmZpeGVkQXNzZXRMb2NhdGlvbi51bml0JywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2NvbXBhbnlfaWQnLCByZXF1ZXN0KCktPmdldCgnY29tcGFueV9pZCcpKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4ocmVxdWVzdCgpLT5nZXQoJ3Byb2R1Y3RfaWQnKSA+IDAsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2ZpbmFsX2Fzc2V0X2lkJywgcmVxdWVzdCgpLT5nZXQoJ3Byb2R1Y3RfaWQnKSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVyZSgnaXNfZGlzcG9zZWQnLCAwKQogICAgICAgICAgICAgICAgLT5ncm91cEJ5KCdhc3NldF9jb2RlJykKICAgICAgICAgICAgICAgIC0+Z2V0KCksCiAgICAgICAgICAgICAgICAnc2VsZWN0ZWQnID0+IHJlcXVlc3QoKS0+Z2V0KCdzZWxlY3RlZCcpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KCiAgICAgICAgJHRpdGxlID0gJ0Fzc2V0IFJlLVNjaGVkdWxpbmcnOwogICAgICAgICRjYXRlZ29yaWVzID0gQ2F0ZWdvcnk6OndoZXJlSGFzKCdwcm9kdWN0cy5maXhlZEFzc2V0QmF0Y2hJdGVtcycsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19kaXNwb3NlZCcsIDApOwogICAgICAgIH0pCiAgICAgICAgLT5nZXQoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAkaXRlbSA9IEZpeGVkQXNzZXRCYXRjaEl0ZW06OmZpbmQocmVxdWVzdCgpLT5nZXQoJ2ZpeGVkX2Fzc2V0X2JhdGNoX2l0ZW1faWQnKSk7CiAgICAgICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAkdGl0bGUsCiAgICAgICAgICAgICAgICAnY29tcGFuaWVzJyA9PiBDb21wYW55OjpoYXMoJ3Byb2ZpdENlbnRyZXMuY29zdENlbnRyZXMnKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygndXNlcnMnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCd1c2VyX2lkJywgYXV0aCgpLT51c2VyKCktPmlkKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmdldCgpLAogICAgICAgICAgICAgICAgJ2NhdGVnb3JpZXMnID0+ICRjYXRlZ29yaWVzLAogICAgICAgICAgICAgICAgJ3Byb2R1Y3RzJyA9PiBQcm9kdWN0Ojp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAnYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJwogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlcmVJbignY2F0ZWdvcnlfaWQnLCAkY2F0ZWdvcmllcy0+cGx1Y2soJ2lkJyktPnRvQXJyYXkoKSkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ2ZpeGVkQXNzZXRCYXRjaEl0ZW1zJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaXNfZGlzcG9zZWQnLCAwKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmdldCgpLAogICAgICAgICAgICAgICAgJ2N1cnJlbmN5VHlwZXMnID0+IEN1cnJlbmN5VHlwZTo6d2l0aChbJ2N1cnJlbmNpZXMnXSktPmdldCgpLAogICAgICAgICAgICAgICAgJ2l0ZW0nID0+ICRpdGVtLAogICAgICAgICAgICBdOwogICAgICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLmZpeGVkQXNzZXRzLmFzc2V0UmVTY2hlZHVsaW5nLmNyZWF0ZScsICRkYXRhKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHN0b3JlKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJHJlcXVlc3QtPnZhbGlkYXRlKFsKICAgICAgICAgICAgJ2ZpeGVkX2Fzc2V0X2JhdGNoX2l0ZW1faWQnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdjb3N0JyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnbGlmZScgPT4gJ3JlcXVpcmVkJywKICAgICAgICBdKTsKCiAgICAgICAgaWYgKGluX2FycmF5KCRyZXF1ZXN0LT5wYXltZW50X3R5cGUsIFsnY2hlcXVlJywgJ2Z1bmQtdHJhbnNmZXInXSkpIHsKICAgICAgICAgICAgJHJlcXVlc3QtPnZhbGlkYXRlKFsKICAgICAgICAgICAgICAgICdwYXltZW50X2RldGFpbHMnID0+ICdyZXF1aXJlZCcKICAgICAgICAgICAgXSk7CiAgICAgICAgfQoKICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeXsKICAgICAgICAgICAgJGl0ZW0gPSBGaXhlZEFzc2V0QmF0Y2hJdGVtOjp3aXRoKFsKICAgICAgICAgICAgICAgICdmaW5hbEFzc2V0JywKICAgICAgICAgICAgICAgICdkZXByZWNpYXRpb25zJywKICAgICAgICAgICAgICAgICdiYXRjaC5jb3N0Q2VudHJlLnByb2ZpdENlbnRyZS5jb21wYW55JwogICAgICAgICAgICBdKS0+ZmluZE9yRmFpbCgkcmVxdWVzdC0+Zml4ZWRfYXNzZXRfYmF0Y2hfaXRlbV9pZCk7CgogICAgICAgICAgICAkZGVwcmVjaWF0aW9uX2NvdW50ID0gJGl0ZW0tPmRlcHJlY2lhdGlvbnMtPmNvdW50KCk7CiAgICAgICAgICAgICRkZXByZWNpYXRpb25fdG90YWwgPSAkaXRlbS0+ZGVwcmVjaWF0aW9ucy0+c3VtKCdhbW91bnQnKTsKCiAgICAgICAgICAgICRpbml0aWFsX2Nvc3QgPSAkaXRlbS0+YXNzZXRfdmFsdWU7CiAgICAgICAgICAgICRpbml0aWFsX2xpZmUgPSAoMTAwLyRpdGVtLT5kZXByZWNpYXRpb25fcmF0ZSk7CiAgICAgICAgICAgICRpbml0aWFsX3JhdGUgPSAkaXRlbS0+ZGVwcmVjaWF0aW9uX3JhdGU7CiAgICAgICAgICAgICRjb25zdW1lZF9saWZlID0gJGRlcHJlY2lhdGlvbl9jb3VudCA+IDAgPyBzeXN0ZW1Eb3VibGVWYWx1ZSgkZGVwcmVjaWF0aW9uX2NvdW50LzEyLCAyKSA6IDA7CiAgICAgICAgICAgICRzY2hlZHVsZSA9IEZpeGVkQXNzZXRCYXRjaEl0ZW1TY2hlZHVsZTo6Y3JlYXRlKFsKICAgICAgICAgICAgICAgICdmaXhlZF9hc3NldF9iYXRjaF9pdGVtX2lkJyA9PiAkaXRlbS0+aWQsCiAgICAgICAgICAgICAgICAnaW5pdGlhbF9jb3N0JyA9PiAkaW5pdGlhbF9jb3N0LAogICAgICAgICAgICAgICAgJ2luaXRpYWxfbGlmZScgPT4gJGluaXRpYWxfbGlmZSwKICAgICAgICAgICAgICAgICdpbml0aWFsX3JhdGUnID0+ICRpbml0aWFsX3JhdGUsCiAgICAgICAgICAgICAgICAnY29uc3VtZWRfbGlmZScgPT4gJGNvbnN1bWVkX2xpZmUsCiAgICAgICAgICAgICAgICAnYWNjdW11bGF0ZWRfZGVwcmVjaWF0aW9uJyA9PiAkZGVwcmVjaWF0aW9uX3RvdGFsLAogICAgICAgICAgICAgICAgJ2Nvc3QnID0+ICRyZXF1ZXN0LT5jb3N0LAogICAgICAgICAgICAgICAgJ2xpZmUnID0+ICRyZXF1ZXN0LT5saWZlLAogICAgICAgICAgICAgICAgJ3JhdGUnID0+ICRyZXF1ZXN0LT5saWZlID4gMCA/IDEwMC8kcmVxdWVzdC0+bGlmZSA6IDAsCiAgICAgICAgICAgICAgICAnY3JlYXRlZF9ieScgPT4gYXV0aCgpLT51c2VyKCktPmlkLAogICAgICAgICAgICBdKTsKCiAgICAgICAgICAgIGlmKCRzY2hlZHVsZSl7CgogICAgICAgICAgICAgICAgaWYoJHJlcXVlc3QtPmxpZmUgPiAwKXsKICAgICAgICAgICAgICAgICAgICAkYXNzZXRfdmFsdWUgPSAoJGluaXRpYWxfY29zdC0kZGVwcmVjaWF0aW9uX3RvdGFsKSskcmVxdWVzdC0+Y29zdDsKICAgICAgICAgICAgICAgICAgICAkbGlmZSA9ICgkaW5pdGlhbF9saWZlLSRjb25zdW1lZF9saWZlKSskcmVxdWVzdC0+bGlmZTsKICAgICAgICAgICAgICAgICAgICAkcmF0ZSA9ICRsaWZlID4gMCA/IDEwMC8kbGlmZSA6IDA7CgogICAgICAgICAgICAgICAgICAgICRpdGVtLT5hc3NldF92YWx1ZSA9ICRhc3NldF92YWx1ZTsKICAgICAgICAgICAgICAgICAgICAkaXRlbS0+eWVhcnMgPSAkbGlmZTsKICAgICAgICAgICAgICAgICAgICAkaXRlbS0+ZGVwcmVjaWF0aW9uX3JhdGUgPSAkcmF0ZTsKICAgICAgICAgICAgICAgICAgICAkaXRlbS0+c2F2ZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAkYWNjb3VudERlZmF1bHRTZXR0aW5ncyA9IGFjY291bnREZWZhdWx0U2V0dGluZ3MoKTsKICAgICAgICAgICAgICAgICRpdGVtcyA9IFtdOwoKICAgICAgICAgICAgICAgIC8vQXNzZXQgUmUtU2NoZWR1bGluZyBDb3N0IFBheW1lbnQKICAgICAgICAgICAgICAgICRjcmVkaXRfYWNjb3VudCA9ICRyZXF1ZXN0LT5jaGFydF9vZl9hY2NvdW50X2lkOwogICAgICAgICAgICAgICAgaWYgKCRyZXF1ZXN0LT5wYXltZW50X3R5cGUgPT0gJ2Nhc2gnKSB7CiAgICAgICAgICAgICAgICAgICAgJGNyZWRpdF9hY2NvdW50ID0gJGFjY291bnREZWZhdWx0U2V0dGluZ3NbJ2Nhc2hfaW5faGFuZF9hY2NvdW50J107CiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJHJlcXVlc3QtPnBheW1lbnRfdHlwZSA9PSAnY2hlcXVlJyB8fCAkcmVxdWVzdC0+cGF5bWVudF90eXBlID09ICdmdW5kLXRyYW5zZmVyJykgewogICAgICAgICAgICAgICAgICAgICRiYW5rQWNjb3VudCA9IEJhbmtBY2NvdW50OjpmaW5kKCRyZXF1ZXN0LT5iYW5rX2FjY291bnRfaWQpOwogICAgICAgICAgICAgICAgICAgIGlmIChpc3NldCgkYmFua0FjY291bnQtPmNoYXJ0X29mX2FjY291bnRfaWQpICYmICRiYW5rQWNjb3VudC0+Y2hhcnRfb2ZfYWNjb3VudF9pZCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGNyZWRpdF9hY2NvdW50ID0gJGJhbmtBY2NvdW50LT5jaGFydF9vZl9hY2NvdW50X2lkOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRjcmVkaXRfYWNjb3VudCA9ICRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydiYW5rX2FjY291bnQnXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJGNvc3RfY2VudHJlX2lkID0gKGlzc2V0KCRpdGVtLT5jdXJyZW50VXNlci0+Y29zdF9jZW50cmVfaWQpID8gJGl0ZW0tPmN1cnJlbnRVc2VyLT5jb3N0X2NlbnRyZV9pZCA6ICRpdGVtLT5iYXRjaC0+Y29zdF9jZW50cmVfaWQpOwoKICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGl0ZW1zLCBbCiAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAkY29zdF9jZW50cmVfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICRpdGVtLT5iYXRjaC0+Y29zdENlbnRyZS0+cHJvZml0Q2VudHJlLT5jb21wYW55LT5vdmVyaG91bGluZ19leHBlbnNlX2xlZGdlcl9pZCwKICAgICAgICAgICAgICAgICAgICAnZGViaXQnID0+ICRyZXF1ZXN0LT5jb3N0LAogICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ0Fzc2V0IFJlLVNjaGVkdWxpbmcgOjogT3ZlcmhvdWxpbmcgRXhwZW5zZSBQYXltZW50IERlYml0JywKICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJ2Fzc2V0LXJlLXNjaGVkdWxpbmcnLAogICAgICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRzY2hlZHVsZS0+aWQKICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkaXRlbXMsIFsKICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRjb3N0X2NlbnRyZV9pZCwKICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJGNyZWRpdF9hY2NvdW50LAogICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAkcmVxdWVzdC0+Y29zdCwKICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAnQXNzZXQgUmUtU2NoZWR1bGluZyA6OiBPdmVyaG91bGluZyBFeHBlbnNlIFBheW1lbnQgQ3JlZGl0JywKICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJ2Fzc2V0LXJlLXNjaGVkdWxpbmcnLAogICAgICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRzY2hlZHVsZS0+aWQKICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgLy9Bc3NldCBSZS1TY2hlZHVsaW5nIENvc3QgUGF5bWVudAoKICAgICAgICAgICAgICAgIGlmKCRyZXF1ZXN0LT5saWZlID4gMCl7CiAgICAgICAgICAgICAgICAgICAgLy9Bc3NldCBSZS1TY2hlZHVsaW5nIEFzc2V0IEluY2x1c2lvbgogICAgICAgICAgICAgICAgICAgICRhc3NldF9sZWRnZXIgPSAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snY3dpcF9hc3NldF9hY2NvdW50J107CiAgICAgICAgICAgICAgICAgICAgaWYoJGl0ZW0tPmZpbmFsQXNzZXQtPmlzX2ZpeGVkX2Fzc2V0ID09IDEpewogICAgICAgICAgICAgICAgICAgICAgICAkYXNzZXRfbGVkZ2VyID0gKGlzc2V0KCRpdGVtLT5maW5hbEFzc2V0LT5pbnZlbnRvcnlfYWNjb3VudF9pZCkgJiYgJGl0ZW0tPmZpbmFsQXNzZXQtPmludmVudG9yeV9hY2NvdW50X2lkID4gMCA/ICRpdGVtLT5maW5hbEFzc2V0LT5pbnZlbnRvcnlfYWNjb3VudF9pZCA6ICRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydmaXhlZF9hc3NldF9hY2NvdW50J10pOwogICAgICAgICAgICAgICAgICAgIH1lbHNlaWYoJGl0ZW0tPmZpbmFsQXNzZXQtPmlzX2N3aXAgPT0gMSl7CiAgICAgICAgICAgICAgICAgICAgICAgICRhc3NldF9sZWRnZXIgPSAoaXNzZXQoJGl0ZW0tPmZpbmFsQXNzZXQtPmN3aXBfYXNzZXRfYWNjb3VudF9pZCkgJiYgJGl0ZW0tPmZpbmFsQXNzZXQtPmN3aXBfYXNzZXRfYWNjb3VudF9pZCA+IDAgPyAkaXRlbS0+ZmluYWxBc3NldC0+Y3dpcF9hc3NldF9hY2NvdW50X2lkIDogJGFjY291bnREZWZhdWx0U2V0dGluZ3NbJ2N3aXBfYXNzZXRfYWNjb3VudCddKTsKICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgJGFzc2V0X2xlZGdlciA9IChpc3NldCgkaXRlbS0+ZmluYWxBc3NldC0+aW52ZW50b3J5X2FjY291bnRfaWQpICYmICRpdGVtLT5maW5hbEFzc2V0LT5pbnZlbnRvcnlfYWNjb3VudF9pZCA+IDAgPyAkaXRlbS0+ZmluYWxBc3NldC0+aW52ZW50b3J5X2FjY291bnRfaWQgOiAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snaW52ZW50b3J5X2FjY291bnQnXSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRpdGVtcywgWwogICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRjb3N0X2NlbnRyZV9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICRhc3NldF9sZWRnZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gJHJlcXVlc3QtPmNvc3QsCiAgICAgICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICdBc3NldCBSZS1TY2hlZHVsaW5nIDo6IEFzc2V0IFZhbHVlIERlYml0JywKICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdhc3NldC1yZS1zY2hlZHVsaW5nJywKICAgICAgICAgICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJHNjaGVkdWxlLT5pZAogICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGl0ZW1zLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJGNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJGNyZWRpdF9hY2NvdW50LAogICAgICAgICAgICAgICAgICAgICAgICAnZGViaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+ICRyZXF1ZXN0LT5jb3N0LAogICAgICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAnQXNzZXQgUmUtU2NoZWR1bGluZyA6OiBBc3NldCBPdmVyaG91bGluZyBFeHBlbnNlIENyZWRpdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAnYXNzZXQtcmUtc2NoZWR1bGluZycsCiAgICAgICAgICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRzY2hlZHVsZS0+aWQKICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICAvL0Fzc2V0IFJlLVNjaGVkdWxpbmcgQXNzZXQgSW5jbHVzaW9uCgogICAgICAgICAgICAgICAgICAgIC8vQXNzZXQgUmUtU2NoZWR1bGluZyBBc3NldCBDb25zdW1wdGlvbgogICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGl0ZW1zLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJGNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJGl0ZW0tPmJhdGNoLT5jb3N0Q2VudHJlLT5wcm9maXRDZW50cmUtPmNvbXBhbnktPmFjY2lkZW50YWxfbG9zc19sZWRnZXJfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gJGRlcHJlY2lhdGlvbl90b3RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ0Fzc2V0IFJlLVNjaGVkdWxpbmcgOjogQXNzZXQgTG9zcyBEZWJpdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAnYXNzZXQtcmUtc2NoZWR1bGluZycsCiAgICAgICAgICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRzY2hlZHVsZS0+aWQKICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRpdGVtcywgWwogICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRjb3N0X2NlbnRyZV9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICRhc3NldF9sZWRnZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gJGRlcHJlY2lhdGlvbl90b3RhbCwKICAgICAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ0Fzc2V0IFJlLVNjaGVkdWxpbmcgOjogQXNzZXQgQ29uc3VtcHRpb24gQ3JlZGl0JywKICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdhc3NldC1yZS1zY2hlZHVsaW5nJywKICAgICAgICAgICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJHNjaGVkdWxlLT5pZAogICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgIC8vQXNzZXQgUmUtU2NoZWR1bGluZyBBc3NldCBDb25zdW1wdGlvbgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRlbnRyeSA9IHNhdmVMZWRnZXJFbnRyaWVzKDUsIGRhdGUoJ1ktbS1kIEg6aTpzJyksIDEsICcnLCAiQXNzZXQgUmUtU2NoZWR1bGluZyIsICRpdGVtcywgJGl0ZW0tPmJhdGNoLT5nb29kc1JlY2VpdmVkSXRlbXNTdG9ja0luLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlX3JhdGVfaWQsIDAsIDAsIDEsIGdldENvc3RDZW50cmVDb21wYW55KCRjb3N0X2NlbnRyZV9pZCkpOwoKICAgICAgICAgICAgICAgIGlmKGlzc2V0KCRlbnRyeVsnZW50cnknXS0+aWQpKXsKICAgICAgICAgICAgICAgICAgICBGaXhlZEFzc2V0QmF0Y2hJdGVtU2NoZWR1bGVFbnRyeTo6Y3JlYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ2ZpeGVkX2Fzc2V0X2JhdGNoX2l0ZW1fc2NoZWR1bGVfaWQnID0+ICRzY2hlZHVsZS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdlbnRyeV9pZCcgPT4gJGVudHJ5WydlbnRyeSddLT5pZCwKICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgREI6OmNvbW1pdCgpOwogICAgICAgICAgICBzZXNzaW9uKCktPmZsYXNoKCdhbGVydC10eXBlJywgJ3N1Y2Nlc3MnKTsKICAgICAgICAgICAgc2Vzc2lvbigpLT5mbGFzaCgnbWVzc2FnZScsICdBc3NldCBIYXMgYmVlbiBSZS1TY2hlZHVsZWQgU3VjY2Vzc2Z1bGx5LicpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgICAgICAgICAgXSk7CiAgICAgICAgfWNhdGNoKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkdGgtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICB9Cn0K