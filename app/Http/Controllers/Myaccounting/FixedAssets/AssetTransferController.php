<?php
bolt_decrypt( __FILE__ , 'NGMieP'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcTXlhY2NvdW50aW5nXEZpeGVkQXNzZXRzOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKCnVzZSBBcHBcTW9kZWxzXEZpeGVkQXNzZXRzXEZpeGVkQXNzZXRCYXRjaDsKdXNlIEFwcFxNb2RlbHNcRml4ZWRBc3NldHNcRml4ZWRBc3NldEJhdGNoSXRlbTsKdXNlIEFwcFxNb2RlbHNcRml4ZWRBc3NldHNcRml4ZWRBc3NldEJhdGNoSXRlbURlcHJlY2lhdGlvbjsKdXNlIEFwcFxNb2RlbHNcRml4ZWRBc3NldHNcRml4ZWRBc3NldEJhdGNoVXNlcjsKdXNlIEFwcFxNb2RlbHNcRml4ZWRBc3NldHNcRml4ZWRBc3NldEJhdGNoSXRlbVNjaGVkdWxlOwp1c2UgQXBwXE1vZGVsc1xGaXhlZEFzc2V0c1xGaXhlZEFzc2V0QmF0Y2hJdGVtU2NoZWR1bGVFbnRyeTsKdXNlIEFwcFxNb2RlbHNcRml4ZWRBc3NldHNcRml4ZWRBc3NldExvY2F0aW9uOwp1c2UgQXBwXE1vZGVsc1xGaXhlZEFzc2V0c1xBc3NldFRyYW5zZmVyOwp1c2UgQXBwXE1vZGVsc1xGaXhlZEFzc2V0c1xBc3NldFRyYW5zZmVyRW50cnk7CnVzZSBBcHBcTW9kZWxzXEZpeGVkQXNzZXRzXEZpeGVkQXNzZXRCYXRjaEl0ZW1Vc2VyOwp1c2UgQXBwXFVzZXI7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xDYXRlZ29yeTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFByb2R1Y3Q7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDb21wYW55Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQ3VycmVuY3lUeXBlOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQ29zdENlbnRyZTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEJhbmtBY2NvdW50OwoKdXNlIEFwcCwgREIsIERhdGFUYWJsZXM7CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xBdXRoOwoKY2xhc3MgQXNzZXRUcmFuc2ZlckNvbnRyb2xsZXIgZXh0ZW5kcyBDb250cm9sbGVyCnsKICAgIHB1YmxpYyBmdW5jdGlvbiBoZWFkZXJDb2x1bW5zKCR2YWx1ZT0nJykKICAgICB7CiAgICAgICAgcmV0dXJuIGFycmF5KAogICAgICAgICAgICBbJ1NMJywgJ1NMJ10sCiAgICAgICAgICAgIFsnY29tcGFueScsICdjb21wYW55JywndGV4dC1sZWZ0J10sCiAgICAgICAgICAgIFsnYXNzZXRfbmFtZScsICdhc3NldF9uYW1lJywndGV4dC1sZWZ0J10sCiAgICAgICAgICAgIFsnc3ViX2NhdGVnb3J5JywgJ3N1Yl9jYXRlZ29yeScsJ3RleHQtbGVmdCddLAogICAgICAgICAgICBbJ2NhdGVnb3J5JywgJ2NhdGVnb3J5JywgJ3RleHQtbGVmdCddLAogICAgICAgICAgICBbJ2lkZW50aWZpY2F0aW9uX21hcmsnLCAnaWRlbnRpZmljYXRpb25fbWFyaycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2luaXRpYWxfY29zdCcsICdpbml0aWFsX2Nvc3QnLCAndGV4dC1jZW50ZXInXSwgCiAgICAgICAgICAgIFsnaW5pdGlhbF9saWZlJywgJ2luaXRpYWxfbGlmZScsICd0ZXh0LWNlbnRlciddLCAKICAgICAgICAgICAgWydpbml0aWFsX3JhdGUnLCAnaW5pdGlhbF9yYXRlJywgJ3RleHQtY2VudGVyJ10sIAogICAgICAgICAgICBbJ2NvbnN1bWVkX2xpZmUnLCAnY29uc3VtZWRfbGlmZScsICd0ZXh0LWNlbnRlciddLCAKICAgICAgICAgICAgWydhY2N1bXVsYXRlZF9kZXByZWNpYXRpb24nLCAnYWNjdW11bGF0ZWRfZGVwcmVjaWF0aW9uJywgJ3RleHQtY2VudGVyJ10sIAogICAgICAgICAgICBbJ2Nvc3QnLCAnY29zdCcsICd0ZXh0LWNlbnRlciddLCAKICAgICAgICAgICAgWydsaWZlJywgJ2xpZmUnLCAndGV4dC1jZW50ZXInXSwgCiAgICAgICAgICAgIFsncmF0ZScsICdyYXRlJywgJ3RleHQtY2VudGVyJ10sIAogICAgICAgICAgICBbJ2NyZWF0ZWRfYnknLCAnY3JlYXRlZF9ieScsICd0ZXh0LWNlbnRlciddLCAKICAgICAgICAgICAgWydsb2NhdGlvbicsICdsb2NhdGlvbicsICd0ZXh0LWNlbnRlciddLAogICAgICAgICk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiBpbmRleCgpCiAgICB7CiAgICAgICAgJHRpdGxlID0gJ0Fzc2V0IFRyYW5zZmVyJzsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAocmVxdWVzdCgpLT5hamF4KCkpIHsKICAgICAgICAgICAgICAgICAkc2NoZWR1bGVzID0gRml4ZWRBc3NldEJhdGNoSXRlbVNjaGVkdWxlOjp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAnYmF0Y2hJdGVtLmZpbmFsQXNzZXQuYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJywKICAgICAgICAgICAgICAgICAgICAnYmF0Y2hJdGVtLmZpbmFsQXNzZXQucHJvZHVjdFVuaXQnLAogICAgICAgICAgICAgICAgICAgICdiYXRjaEl0ZW0uZmluYWxBc3NldC5jYXRlZ29yeS5jYXRlZ29yeScsCiAgICAgICAgICAgICAgICAgICAgJ2JhdGNoSXRlbS5iYXRjaC5pdGVtcycsCiAgICAgICAgICAgICAgICAgICAgJ2JhdGNoSXRlbS5jdXJyZW50VXNlci5maXhlZEFzc2V0TG9jYXRpb24nLAogICAgICAgICAgICAgICAgICAgICdiYXRjaEl0ZW0uZGVwcmVjaWF0aW9ucycsCgogICAgICAgICAgICAgICAgICAgICdiYXRjaEl0ZW0uYmF0Y2guZ29vZHNSZWNlaXZlZEl0ZW1zU3RvY2tJbi5yZWxQdXJjaGFzZU9yZGVyLnJlbFB1cmNoYXNlT3JkZXJJdGVtcycsCiAgICAgICAgICAgICAgICAgICAgJ2JhdGNoSXRlbS5iYXRjaC5nb29kc1JlY2VpdmVkSXRlbXNTdG9ja0luLnJlbFB1cmNoYXNlT3JkZXIucmVsUXVvdGF0aW9uLnJlbFF1b3RhdGlvbkl0ZW1zJywKICAgICAgICAgICAgICAgICAgICAnYmF0Y2hJdGVtLmJhdGNoLmdvb2RzUmVjZWl2ZWRJdGVtc1N0b2NrSW4uYXNzZXRDb3N0aW5nRW50cmllcycsCgogICAgICAgICAgICAgICAgICAgICdlbnRyaWVzLmVudHJ5LmVudHJ5VHlwZScsCiAgICAgICAgICAgICAgICAgICAgJ2NyZWF0b3InLAoKICAgICAgICAgICAgICAgICAgICAnYmF0Y2hJdGVtLmJhdGNoLmNvc3RDZW50cmUucHJvZml0Q2VudHJlLmNvbXBhbnknCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyYnkoJ2ZpeGVkX2Fzc2V0X2JhdGNoX2l0ZW1fc2NoZWR1bGVzLmlkJywgJ2Rlc2MnKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICRjb2RlcyA9ICRzY2hlZHVsZXMtPmdldCgpLT5wbHVjaygnYmF0Y2hJdGVtLmFzc2V0X2NvZGUnKS0+dG9BcnJheSgpOwogICAgICAgICAgICAgICAgJGFsbEJhdGNoSXRlbXMgPSBGaXhlZEFzc2V0QmF0Y2hJdGVtOjp3aGVyZUluKCdhc3NldF9jb2RlJywgJGNvZGVzKS0+Z2V0KCk7CiAgICAgICAgICAgICAgICAkYWxsRGVwcmVjaWF0aW9ucyA9IEZpeGVkQXNzZXRCYXRjaEl0ZW1EZXByZWNpYXRpb246OndpdGgoWydiYXRjaEl0ZW0nXSkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ2JhdGNoSXRlbScsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRjb2Rlcyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignYXNzZXRfY29kZScsICRjb2Rlcyk7CiAgICAgICAgICAgICAgICB9KS0+Z2V0KCk7CgogICAgICAgICAgICAgICAgcmV0dXJuIERhdGFUYWJsZXM6Om9mKCRzY2hlZHVsZXMpCiAgICAgICAgICAgICAgICAtPmFkZEluZGV4Q29sdW1uKCkKCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignY29tcGFueScsIGZ1bmN0aW9uKCRzY2hlZHVsZSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCRzY2hlZHVsZS0+YmF0Y2hJdGVtLT5iYXRjaC0+Y29zdENlbnRyZS0+cHJvZml0Q2VudHJlLT5jb21wYW55LT5jb2RlKSA/ICRzY2hlZHVsZS0+YmF0Y2hJdGVtLT5iYXRjaC0+Y29zdENlbnRyZS0+cHJvZml0Q2VudHJlLT5jb21wYW55LT5jb2RlIDogJyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2NvbXBhbnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdiYXRjaEl0ZW0uYmF0Y2guY29zdENlbnRyZS5wcm9maXRDZW50cmUuY29tcGFueScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdjb2RlJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhc3NldF9uYW1lJywgZnVuY3Rpb24oJHNjaGVkdWxlKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHNjaGVkdWxlLT5iYXRjaEl0ZW0tPmZpbmFsQXNzZXQtPm5hbWUpID8gJHNjaGVkdWxlLT5iYXRjaEl0ZW0tPmZpbmFsQXNzZXQtPm5hbWUuJyAnLmdldFByb2R1Y3RBdHRyaWJ1dGVzRmFzdGVyKCRzY2hlZHVsZS0+YmF0Y2hJdGVtLT5maW5hbEFzc2V0KSA6ICcnOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdhc3NldF9uYW1lJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnYmF0Y2hJdGVtLmZpbmFsQXNzZXQnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3N1Yl9jYXRlZ29yeScsIGZ1bmN0aW9uKCRzY2hlZHVsZSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCRzY2hlZHVsZS0+YmF0Y2hJdGVtLT5maW5hbEFzc2V0LT5jYXRlZ29yeS0+bmFtZSkgPyAkc2NoZWR1bGUtPmJhdGNoSXRlbS0+ZmluYWxBc3NldC0+Y2F0ZWdvcnktPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignc3ViX2NhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnYmF0Y2hJdGVtLmZpbmFsQXNzZXQuY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2NhdGVnb3J5JywgZnVuY3Rpb24oJHNjaGVkdWxlKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJHNjaGVkdWxlLT5iYXRjaEl0ZW0tPmZpbmFsQXNzZXQtPmNhdGVnb3J5LT5jYXRlZ29yeS0+bmFtZSkgPyAkc2NoZWR1bGUtPmJhdGNoSXRlbS0+ZmluYWxBc3NldC0+Y2F0ZWdvcnktPmNhdGVnb3J5LT5uYW1lIDogJyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2NhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnYmF0Y2hJdGVtLmZpbmFsQXNzZXQuY2F0ZWdvcnkuY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2xvY2F0aW9uJywgZnVuY3Rpb24oJHNjaGVkdWxlKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHNjaGVkdWxlLT5iYXRjaEl0ZW0tPmN1cnJlbnRVc2VyID8gJHNjaGVkdWxlLT5iYXRjaEl0ZW0tPmN1cnJlbnRVc2VyLT5maXhlZEFzc2V0TG9jYXRpb24tPm5hbWUgOiAnTm90IERpc3RyaWJ1dGVkJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignbG9jYXRpb24nLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdiYXRjaEl0ZW0uY3VycmVudFVzZXIuZml4ZWRBc3NldExvY2F0aW9uJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdjYXBpdGFsaXphdGlvbl9kYXRlJywgZnVuY3Rpb24oJHNjaGVkdWxlKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHNjaGVkdWxlLT5iYXRjaEl0ZW0tPmJhdGNoLT5jcmVhdGVkX2F0KSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2NhcGl0YWxpemF0aW9uX2RhdGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdiYXRjaEl0ZW0uYmF0Y2gnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnY3JlYXRlZF9hdCcsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2lkZW50aWZpY2F0aW9uX21hcmsnLCBmdW5jdGlvbigkc2NoZWR1bGUpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NoZWR1bGUtPmJhdGNoSXRlbS0+YXNzZXRfY29kZTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignaWRlbnRpZmljYXRpb25fbWFyaycsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2JhdGNoSXRlbScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdhc3NldF9jb2RlJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdpbml0aWFsX2Nvc3QnLCBmdW5jdGlvbigkc2NoZWR1bGUpewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzeXN0ZW1Nb25leUZvcm1hdCgkc2NoZWR1bGUtPmluaXRpYWxfY29zdCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdpbml0aWFsX3JhdGUnLCBmdW5jdGlvbigkc2NoZWR1bGUpewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzeXN0ZW1Nb25leUZvcm1hdCgkc2NoZWR1bGUtPmluaXRpYWxfcmF0ZSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdhY2N1bXVsYXRlZF9kZXByZWNpYXRpb24nLCBmdW5jdGlvbigkc2NoZWR1bGUpewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzeXN0ZW1Nb25leUZvcm1hdCgkc2NoZWR1bGUtPmFjY3VtdWxhdGVkX2RlcHJlY2lhdGlvbik7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdjb3N0JywgZnVuY3Rpb24gKCRzY2hlZHVsZSkgewogICAgICAgICAgICAgICAgICAgICRlbnRyeSA9ICRzY2hlZHVsZS0+ZW50cmllcy0+Zmlyc3QoKS0+ZW50cnk7CiAgICAgICAgICAgICAgICAgICAgaWYoaXNzZXQoJGVudHJ5LT5pZCkpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGNsYXNzPSJ0ZXh0LXByaW1hcnkiIG9uY2xpY2s9ImdldFNob3J0RGV0YWlscygkKHRoaXMpKSIgZGF0YS1pZD0iJyAuICgkZW50cnktPmlkKSAuICciIGRhdGEtZW50cnktdHlwZT0iJyAuICgkZW50cnktPmVudHJ5VHlwZS0+bmFtZSkgLiAnIiBkYXRhLWNvZGU9IicgLiAoJGVudHJ5LT5jb2RlKSAuICciPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgc3R5bGU9IndpZHRoOiAxNTBweDt3aGl0ZS1zcGFjZTogbm9ybWFsIj4nLnN5c3RlbU1vbmV5Rm9ybWF0KCRzY2hlZHVsZS0+Y29zdCkuJzwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgPC9hPic7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbigncmF0ZScsIGZ1bmN0aW9uKCRzY2hlZHVsZSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN5c3RlbU1vbmV5Rm9ybWF0KCRzY2hlZHVsZS0+cmF0ZSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2NyZWF0ZWRfYnknLCBmdW5jdGlvbigkc2NoZWR1bGUpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NoZWR1bGUtPmNyZWF0b3IgPyAkc2NoZWR1bGUtPmNyZWF0b3ItPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignY3JlYXRlZF9ieScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2NyZWF0b3InLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIC0+cmF3Q29sdW1ucyhbJ2Nvc3QnXSkKICAgICAgICAgICAgICAgIC0+bWFrZSh0cnVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGRhdGEgPSBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICR0aXRsZSwKICAgICAgICAgICAgICAgICdoZWFkZXJDb2x1bW5zJyA9PiAkdGhpcy0+aGVhZGVyQ29sdW1ucygpCiAgICAgICAgICAgIF07CiAgICAgICAgICAgIHJldHVybiB2aWV3KCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMuZml4ZWRBc3NldHMuYXNzZXRUcmFuc2ZlcnMuaW5kZXgnLCAkZGF0YSk7CiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBjcmVhdGUoKQogICAgewogICAgICAgIGlmKHJlcXVlc3QoKS0+Z2V0KCdhY3Rpb24nKSA9PSAnYmF0Y2hlcycpewogICAgICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLmZpeGVkQXNzZXRzLmFzc2V0VHJhbnNmZXJzLmJhdGNoZXMnLCBbCiAgICAgICAgICAgICAgICAnYmF0Y2hlcycgPT4gRml4ZWRBc3NldEJhdGNoOjp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAnZ29vZHNSZWNlaXZlZEl0ZW1zU3RvY2tJbi5yZWxHb29kc1JlY2VpdmVkSXRlbXMucmVsR29vZHNSZWNlaXZlZE5vdGUucmVsUHVyY2hhc2VPcmRlci5wdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zJwogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ2l0ZW1zJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaXNfZGlzcG9zZWQnLCAwKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdpdGVtcy5jdXJyZW50VXNlci5maXhlZEFzc2V0TG9jYXRpb24udW5pdCcsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignY29tcGFueV9pZCcsIGF1dGgoKS0+dXNlcigpLT5jb21wYW5pZXMtPnBsdWNrKCdjb21wYW55X2lkJyktPnRvQXJyYXkoKSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKHJlcXVlc3QoKS0+Z2V0KCdjb21wYW55X2lkJykgPiAwLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdpdGVtcy5jdXJyZW50VXNlci5maXhlZEFzc2V0TG9jYXRpb24udW5pdCcsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdjb21wYW55X2lkJywgcmVxdWVzdCgpLT5nZXQoJ2NvbXBhbnlfaWQnKSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKHJlcXVlc3QoKS0+Z2V0KCdwcm9kdWN0X2lkJykgPiAwLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdpdGVtcycsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdmaW5hbF9hc3NldF9pZCcsIHJlcXVlc3QoKS0+Z2V0KCdwcm9kdWN0X2lkJykpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+Z2V0KCksCiAgICAgICAgICAgICAgICAnc2VsZWN0ZWQnID0+IHJlcXVlc3QoKS0+Z2V0KCdzZWxlY3RlZCcpCiAgICAgICAgICAgIF0pOwogICAgICAgIH1lbHNlaWYocmVxdWVzdCgpLT5nZXQoJ2FjdGlvbicpID09ICdpdGVtcycpewogICAgICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLmZpeGVkQXNzZXRzLmFzc2V0VHJhbnNmZXJzLml0ZW1zJywgWwogICAgICAgICAgICAgICAgJ2ZpbmFsQXNzZXRzJyA9PiBGaXhlZEFzc2V0QmF0Y2hJdGVtOjp3aXRoKFsKCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygnY3VycmVudFVzZXIuZml4ZWRBc3NldExvY2F0aW9uLnVuaXQnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2NvbXBhbnlfaWQnLCBhdXRoKCktPnVzZXIoKS0+Y29tcGFuaWVzLT5wbHVjaygnY29tcGFueV9pZCcpLT50b0FycmF5KCkpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbihyZXF1ZXN0KCktPmdldCgnY29tcGFueV9pZCcpID4gMCwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnY3VycmVudFVzZXIuZml4ZWRBc3NldExvY2F0aW9uLnVuaXQnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnY29tcGFueV9pZCcsIHJlcXVlc3QoKS0+Z2V0KCdjb21wYW55X2lkJykpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbihyZXF1ZXN0KCktPmdldCgncHJvZHVjdF9pZCcpID4gMCwgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZmluYWxfYXNzZXRfaWQnLCByZXF1ZXN0KCktPmdldCgncHJvZHVjdF9pZCcpKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZXJlKCdpc19kaXNwb3NlZCcsIDApCiAgICAgICAgICAgICAgICAtPmdyb3VwQnkoJ2Fzc2V0X2NvZGUnKQogICAgICAgICAgICAgICAgLT5nZXQoKSwKICAgICAgICAgICAgICAgICdzZWxlY3RlZCcgPT4gcmVxdWVzdCgpLT5nZXQoJ3NlbGVjdGVkJykKICAgICAgICAgICAgXSk7CiAgICAgICAgfWVsc2VpZihyZXF1ZXN0KCktPmdldCgnYWN0aW9uJykgPT0gJ2xvY2F0aW9ucycpewogICAgICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLmZpeGVkQXNzZXRzLmFzc2V0VHJhbnNmZXJzLmxvY2F0aW9ucycsIFsKICAgICAgICAgICAgICAgICdsb2NhdGlvbnMnID0+IEZpeGVkQXNzZXRMb2NhdGlvbjo6d2hlcmVIYXMoJ3VuaXQnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAgJHF1ZXJ5LT53aGVyZSgnY29tcGFueV9pZCcsIHJlcXVlc3QoKS0+Z2V0KCdjb21wYW55X2lkJykpOwogICAgICAgICAgICAgICAgfSktPmdldCgpLAogICAgICAgICAgICBdKTsKICAgICAgICB9ZWxzZWlmKHJlcXVlc3QoKS0+Z2V0KCdhY3Rpb24nKSA9PSAnY29zdC1jZW50cmVzJyl7CiAgICAgICAgICAgIHJldHVybiBnZXRDb3N0Q2VudHJlcyh0cnVlLCByZXF1ZXN0KCktPmdldCgnY29tcGFueV9pZCcpLCB0cnVlKTsKICAgICAgICB9ZWxzZWlmKHJlcXVlc3QoKS0+Z2V0KCdhY3Rpb24nKSA9PSAndXNlcnMnKXsKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5maXhlZEFzc2V0cy5hc3NldFRyYW5zZmVycy51c2VycycsIFsKICAgICAgICAgICAgICAgICd1c2VycycgPT4gXEFwcFxVc2VyOjp3aGVyZUhhcygnY29tcGFuaWVzJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gICRxdWVyeS0+d2hlcmUoJ2NvbXBhbnlfaWQnLCByZXF1ZXN0KCktPmdldCgnY29tcGFueV9pZCcpKTsKICAgICAgICAgICAgICAgIH0pLT5nZXQoKSwKICAgICAgICAgICAgXSk7CiAgICAgICAgfQoKICAgICAgICAkdGl0bGUgPSAnQXNzZXQgVHJhbnNmZXInOwogICAgICAgICRjYXRlZ29yaWVzID0gQ2F0ZWdvcnk6OndoZXJlSGFzKCdwcm9kdWN0cy5maXhlZEFzc2V0QmF0Y2hJdGVtcycsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpc19kaXNwb3NlZCcsIDApOwogICAgICAgIH0pCiAgICAgICAgLT5nZXQoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAkaXRlbSA9IEZpeGVkQXNzZXRCYXRjaEl0ZW06OmZpbmQocmVxdWVzdCgpLT5nZXQoJ2ZpeGVkX2Fzc2V0X2JhdGNoX2l0ZW1faWQnKSk7CiAgICAgICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAkdGl0bGUsCiAgICAgICAgICAgICAgICAnY29tcGFuaWVzJyA9PiBDb21wYW55OjpoYXMoJ3Byb2ZpdENlbnRyZXMuY29zdENlbnRyZXMnKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygndXNlcnMnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCd1c2VyX2lkJywgYXV0aCgpLT51c2VyKCktPmlkKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmdldCgpLAogICAgICAgICAgICAgICAgJ2NhdGVnb3JpZXMnID0+ICRjYXRlZ29yaWVzLAogICAgICAgICAgICAgICAgJ3Byb2R1Y3RzJyA9PiBQcm9kdWN0Ojp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAnYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJwogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlcmVJbignY2F0ZWdvcnlfaWQnLCAkY2F0ZWdvcmllcy0+cGx1Y2soJ2lkJyktPnRvQXJyYXkoKSkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ2ZpeGVkQXNzZXRCYXRjaEl0ZW1zJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaXNfZGlzcG9zZWQnLCAwKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmdldCgpLAogICAgICAgICAgICAgICAgJ2N1cnJlbmN5VHlwZXMnID0+IEN1cnJlbmN5VHlwZTo6d2l0aChbJ2N1cnJlbmNpZXMnXSktPmdldCgpLAogICAgICAgICAgICAgICAgJ2l0ZW0nID0+ICRpdGVtLAogICAgICAgICAgICBdOwogICAgICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLmZpeGVkQXNzZXRzLmFzc2V0VHJhbnNmZXJzLmNyZWF0ZScsICRkYXRhKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHN0b3JlKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJHJlcXVlc3QtPnZhbGlkYXRlKFsKICAgICAgICAgICAgJ2ZpeGVkX2Fzc2V0X2JhdGNoX2l0ZW1faWQnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdkZXN0aW5hdGlvbl9jb21wYW55X2lkJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdmaXhlZF9hc3NldF9sb2NhdGlvbl9pZCcgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ3VzZXJfaWQnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgXSk7CgogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgdHJ5ewogICAgICAgICAgICAkaXRlbSA9IEZpeGVkQXNzZXRCYXRjaEl0ZW06OndpdGgoWwogICAgICAgICAgICAgICAgJ2ZpbmFsQXNzZXQnLAogICAgICAgICAgICAgICAgJ2RlcHJlY2lhdGlvbnMnLAogICAgICAgICAgICAgICAgJ2JhdGNoLmNvc3RDZW50cmUucHJvZml0Q2VudHJlLmNvbXBhbnknLAogICAgICAgICAgICAgICAgJ2N1cnJlbnRVc2VyJwogICAgICAgICAgICBdKS0+ZmluZE9yRmFpbCgkcmVxdWVzdC0+Zml4ZWRfYXNzZXRfYmF0Y2hfaXRlbV9pZCk7CgogICAgICAgICAgICAkZGVwcmVjaWF0aW9uX2NvdW50ID0gJGl0ZW0tPmRlcHJlY2lhdGlvbnMtPmNvdW50KCk7CiAgICAgICAgICAgICRkZXByZWNpYXRpb25fdG90YWwgPSAkaXRlbS0+ZGVwcmVjaWF0aW9ucy0+c3VtKCdhbW91bnQnKTsKCiAgICAgICAgICAgICR0cmFuc2ZlciA9IEFzc2V0VHJhbnNmZXI6OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAnZml4ZWRfYXNzZXRfYmF0Y2hfaXRlbV9pZCcgPT4gJGl0ZW0tPmlkLAogICAgICAgICAgICAgICAgJ2Zyb21fbG9jYXRpb25faWQnID0+ICRpdGVtLT5jdXJyZW50VXNlci0+Zml4ZWRfYXNzZXRfbG9jYXRpb25faWQsCiAgICAgICAgICAgICAgICAndG9fbG9jYXRpb25faWQnID0+ICRyZXF1ZXN0LT5maXhlZF9hc3NldF9sb2NhdGlvbl9pZCwKICAgICAgICAgICAgICAgICdkYXRlJyA9PiBkYXRlKCdZLW0tZCcpLAogICAgICAgICAgICAgICAgJ3VucGxhbm5lZF9kZXByZWNpYXRpb24nID0+IDAsCiAgICAgICAgICAgICAgICAnd3JpdHRlbl92YWx1ZScgPT4gJGl0ZW0tPmFzc2V0X3ZhbHVlLSRkZXByZWNpYXRpb25fdG90YWwsCiAgICAgICAgICAgICAgICAncmF0ZScgPT4gJGl0ZW0tPmRlcHJlY2lhdGlvbl9yYXRlLAogICAgICAgICAgICAgICAgJ2xpZmUnID0+ICgxMDAvJGl0ZW0tPmRlcHJlY2lhdGlvbl9yYXRlKS0oJGRlcHJlY2lhdGlvbl9jb3VudCA+IDAgPyBzeXN0ZW1Eb3VibGVWYWx1ZSgkZGVwcmVjaWF0aW9uX2NvdW50LzEyLCAyKSA6IDApLAogICAgICAgICAgICAgICAgJ2NyZWF0ZWRfYnknID0+IGF1dGgoKS0+dXNlcigpLT5pZCwKICAgICAgICAgICAgXSk7CgogICAgICAgICAgICBpZigkdHJhbnNmZXIpewoKICAgICAgICAgICAgICAgIEZpeGVkQXNzZXRCYXRjaEl0ZW1Vc2VyOjpjcmVhdGUoWwogICAgICAgICAgICAgICAgICAgICdmaXhlZF9hc3NldF9iYXRjaF9pdGVtX2lkJyA9PiAkaXRlbS0+aWQsCiAgICAgICAgICAgICAgICAgICAgJ2ZpeGVkX2Fzc2V0X2xvY2F0aW9uX2lkJyA9PiAkcmVxdWVzdC0+Zml4ZWRfYXNzZXRfbG9jYXRpb25faWQsCiAgICAgICAgICAgICAgICAgICAgJ3VzZXJfaWQnID0+ICRyZXF1ZXN0LT51c2VyX2lkLAogICAgICAgICAgICAgICAgICAgICdmcm9tJyA9PiBkYXRlKCdZLW0tZCcpLAogICAgICAgICAgICAgICAgICAgICdjcmVhdGVkX2J5JyA9PiBhdXRoKCktPnVzZXIoKS0+aWQsCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgJGFjY291bnREZWZhdWx0U2V0dGluZ3MgPSBhY2NvdW50RGVmYXVsdFNldHRpbmdzKCk7CiAgICAgICAgICAgICAgICAkYXNzZXRfbGVkZ2VyID0gJGFjY291bnREZWZhdWx0U2V0dGluZ3NbJ2N3aXBfYXNzZXRfYWNjb3VudCddOwogICAgICAgICAgICAgICAgaWYoJGl0ZW0tPmZpbmFsQXNzZXQtPmlzX2ZpeGVkX2Fzc2V0ID09IDEpewogICAgICAgICAgICAgICAgICAgICRhc3NldF9sZWRnZXIgPSAoaXNzZXQoJGl0ZW0tPmZpbmFsQXNzZXQtPmludmVudG9yeV9hY2NvdW50X2lkKSAmJiAkaXRlbS0+ZmluYWxBc3NldC0+aW52ZW50b3J5X2FjY291bnRfaWQgPiAwID8gJGl0ZW0tPmZpbmFsQXNzZXQtPmludmVudG9yeV9hY2NvdW50X2lkIDogJGFjY291bnREZWZhdWx0U2V0dGluZ3NbJ2ZpeGVkX2Fzc2V0X2FjY291bnQnXSk7CiAgICAgICAgICAgICAgICB9ZWxzZWlmKCRpdGVtLT5maW5hbEFzc2V0LT5pc19jd2lwID09IDEpewogICAgICAgICAgICAgICAgICAgICRhc3NldF9sZWRnZXIgPSAoaXNzZXQoJGl0ZW0tPmZpbmFsQXNzZXQtPmN3aXBfYXNzZXRfYWNjb3VudF9pZCkgJiYgJGl0ZW0tPmZpbmFsQXNzZXQtPmN3aXBfYXNzZXRfYWNjb3VudF9pZCA+IDAgPyAkaXRlbS0+ZmluYWxBc3NldC0+Y3dpcF9hc3NldF9hY2NvdW50X2lkIDogJGFjY291bnREZWZhdWx0U2V0dGluZ3NbJ2N3aXBfYXNzZXRfYWNjb3VudCddKTsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICRhc3NldF9sZWRnZXIgPSAoaXNzZXQoJGl0ZW0tPmZpbmFsQXNzZXQtPmludmVudG9yeV9hY2NvdW50X2lkKSAmJiAkaXRlbS0+ZmluYWxBc3NldC0+aW52ZW50b3J5X2FjY291bnRfaWQgPiAwID8gJGl0ZW0tPmZpbmFsQXNzZXQtPmludmVudG9yeV9hY2NvdW50X2lkIDogJGFjY291bnREZWZhdWx0U2V0dGluZ3NbJ2ludmVudG9yeV9hY2NvdW50J10pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vQXNzZXQgVHJhbnNmZXIgU291cmNlIENvbXBhbnkKICAgICAgICAgICAgICAgICRjb3N0X2NlbnRyZV9pZCA9IChpc3NldCgkaXRlbS0+Y3VycmVudFVzZXItPmNvc3RfY2VudHJlX2lkKSA/ICRpdGVtLT5jdXJyZW50VXNlci0+Y29zdF9jZW50cmVfaWQgOiAkaXRlbS0+YmF0Y2gtPmNvc3RfY2VudHJlX2lkKTsKICAgICAgICAgICAgICAgICRjb21wYW55ID0gQ29tcGFueTo6ZmluZE9yRmFpbChnZXRDb3N0Q2VudHJlQ29tcGFueSgkY29zdF9jZW50cmVfaWQpKTsKICAgICAgICAgICAgICAgICRpdGVtcyA9IFtdOwogICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkaXRlbXMsIFsKICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRjb3N0X2NlbnRyZV9pZCwKICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJGNvbXBhbnktPmludGVyY29tcGFueV9kZWJpdF9sZWRnZXJfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAkdHJhbnNmZXItPndyaXR0ZW5fdmFsdWUsCiAgICAgICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAnQXNzZXQgVHJhbnNmZXIgOjogSW50ZXItQ29tcGFueSBEZWJpdCBmb3IgJy4kY29tcGFueS0+Y29kZSwKICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJ2Fzc2V0LXRyYW5zZmVyJywKICAgICAgICAgICAgICAgICAgICAnc291cmNlJyA9PiAkdHJhbnNmZXItPmlkCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGl0ZW1zLCBbCiAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAkY29zdF9jZW50cmVfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICRhc3NldF9sZWRnZXIsCiAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+ICR0cmFuc2Zlci0+d3JpdHRlbl92YWx1ZSwKICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAnQXNzZXQgVHJhbnNmZXIgOjogQXNzZXQgVmFsdWUgQ3JlZGl0JywKICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJ2Fzc2V0LXRyYW5zZmVyJywKICAgICAgICAgICAgICAgICAgICAnc291cmNlJyA9PiAkdHJhbnNmZXItPmlkCiAgICAgICAgICAgICAgICBdKTsKCiAgICAgICAgICAgICAgICAkZW50cnkgPSBzYXZlTGVkZ2VyRW50cmllcyg1LCBkYXRlKCdZLW0tZCBIOmk6cycpLCAxLCAnJywgIkFzc2V0IFRyYW5zZmVyIiwgJGl0ZW1zLCAkaXRlbS0+YmF0Y2gtPmdvb2RzUmVjZWl2ZWRJdGVtc1N0b2NrSW4tPnJlbFB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VfcmF0ZV9pZCwgMCwgMCwgMSwgJGNvbXBhbnktPmlkKTsKICAgICAgICAgICAgICAgIGlmKGlzc2V0KCRlbnRyeVsnZW50cnknXS0+aWQpKXsKICAgICAgICAgICAgICAgICAgICBBc3NldFRyYW5zZmVyRW50cnk6OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICdhc3NldF90cmFuc2Zlcl9pZCcgPT4gJHRyYW5zZmVyLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2VudHJ5X2lkJyA9PiAkZW50cnlbJ2VudHJ5J10tPmlkLAogICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9Bc3NldCBUcmFuc2ZlciBTb3VyY2UgQ29tcGFueQoKICAgICAgICAgICAgICAgIC8vQXNzZXQgVHJhbnNmZXIgRGVzdGluYXRpb24gQ29tcGFueQogICAgICAgICAgICAgICAgJGNvbXBhbnkgPSBDb21wYW55OjpmaW5kT3JGYWlsKGdldENvc3RDZW50cmVDb21wYW55KCRyZXF1ZXN0LT5jb3N0X2NlbnRyZV9pZCkpOwogICAgICAgICAgICAgICAgJGl0ZW1zID0gW107CiAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRpdGVtcywgWwogICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJHJlcXVlc3QtPmNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkYXNzZXRfbGVkZ2VyLAogICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gJHRyYW5zZmVyLT53cml0dGVuX3ZhbHVlLAogICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ0Fzc2V0IFRyYW5zZmVyIDo6IEFzc2V0IFRyYW5zZmVyIERlYml0JywKICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJ2Fzc2V0LXRyYW5zZmVyJywKICAgICAgICAgICAgICAgICAgICAnc291cmNlJyA9PiAkdHJhbnNmZXItPmlkCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGl0ZW1zLCBbCiAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAkcmVxdWVzdC0+Y29zdF9jZW50cmVfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICRjb21wYW55LT5pbnRlcmNvbXBhbnlfY3JlZGl0X2xlZGdlcl9pZCwKICAgICAgICAgICAgICAgICAgICAnZGViaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gJHRyYW5zZmVyLT53cml0dGVuX3ZhbHVlLAogICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICdBc3NldCBUcmFuc2ZlciA6OiBJbnRlci1Db21wYW55IENyZWRpdCBmb3IgJy4kY29tcGFueS0+Y29kZSwKICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJ2Fzc2V0LXRyYW5zZmVyJywKICAgICAgICAgICAgICAgICAgICAnc291cmNlJyA9PiAkdHJhbnNmZXItPmlkCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgJGVudHJ5ID0gc2F2ZUxlZGdlckVudHJpZXMoNSwgZGF0ZSgnWS1tLWQgSDppOnMnKSwgMSwgJycsICJBc3NldCBUcmFuc2ZlciIsICRpdGVtcywgJGl0ZW0tPmJhdGNoLT5nb29kc1JlY2VpdmVkSXRlbXNTdG9ja0luLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlX3JhdGVfaWQsIDAsIDAsIDEsICRjb21wYW55LT5pZCk7CgogICAgICAgICAgICAgICAgaWYoaXNzZXQoJGVudHJ5WydlbnRyeSddLT5pZCkpewogICAgICAgICAgICAgICAgICAgIEFzc2V0VHJhbnNmZXJFbnRyeTo6Y3JlYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ2Fzc2V0X3RyYW5zZmVyX2lkJyA9PiAkdHJhbnNmZXItPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAnZW50cnlfaWQnID0+ICRlbnRyeVsnZW50cnknXS0+aWQsCiAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvL0Fzc2V0IFRyYW5zZmVyIERlc3RpbmF0aW9uIENvbXBhbnkKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgREI6OmNvbW1pdCgpOwogICAgICAgICAgICBzZXNzaW9uKCktPmZsYXNoKCdhbGVydC10eXBlJywgJ3N1Y2Nlc3MnKTsKICAgICAgICAgICAgc2Vzc2lvbigpLT5mbGFzaCgnbWVzc2FnZScsICdBc3NldCBIYXMgYmVlbiBUcmFuc2ZlcnJlZCBTdWNjZXNzZnVsbHkuJyk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgICAgICAgICBdKTsKICAgICAgICB9Y2F0Y2goXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KICAgIH0KfQo=