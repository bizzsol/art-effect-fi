<?php
bolt_decrypt( __FILE__ , 'h3kTNX'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcTXlhY2NvdW50aW5nXEZpeGVkQXNzZXRzOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKCnVzZSBBcHBcTW9kZWxzXEZpeGVkQXNzZXRzXEZpeGVkQXNzZXRCYXRjaDsKdXNlIEFwcFxNb2RlbHNcRml4ZWRBc3NldHNcRml4ZWRBc3NldEJhdGNoSXRlbTsKdXNlIEFwcFxNb2RlbHNcRml4ZWRBc3NldHNcRml4ZWRBc3NldEJhdGNoSXRlbVVzZXI7CnVzZSBBcHBcTW9kZWxzXEZpeGVkQXNzZXRzXEZpeGVkQXNzZXRJdGVtTW92ZW1lbnQ7CnVzZSBBcHBcTW9kZWxzXEZpeGVkQXNzZXRzXEZpeGVkQXNzZXRJdGVtUGh5c2ljYWxTdGF0dXM7CnVzZSBBcHBcTW9kZWxzXEZpeGVkQXNzZXRzXEZpeGVkQXNzZXRCYXRjaEl0ZW1EZXByZWNpYXRpb247CnVzZSBBcHBcVXNlcjsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXENhdGVnb3J5Owp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcUHJvZHVjdDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXENvbXBhbnk7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDb3N0Q2VudHJlOwp1c2UgQXBwXE1vZGVsc1xIclxVbml0Owp1c2UgQXBwXE1vZGVsc1xIclxEZXBhcnRtZW50Owp1c2UgQXBwLERCLCBEYXRhVGFibGVzOwp1c2UgSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcQXV0aDsKCmNsYXNzIEZpeGVkQXNzZXRSZXBvcnRDb250cm9sbGVyIGV4dGVuZHMgQ29udHJvbGxlcgp7CiAgICAvKioKICAgICAqIFNldCBnbG9iYWwgZGF0YSB0YWJsZSBoZWFkZXJzLgogICAgICoKICAgICAqIEByZXR1cm4gaGVhZGVyQ29sdW1ucwogICAgICovCiAgICAgcHVibGljIGZ1bmN0aW9uIGFzc3NldFJlZ2lzdGVySGVhZGVyQ29sdW1ucygkdmFsdWU9JycpCiAgICAgewogICAgICAgICRyb3dzID0gIGFycmF5KAogICAgICAgICAgICBbJ1NMJywgJ1NMJ10sCiAgICAgICAgICAgIFsnYXNzZXRfbmFtZScsICdhc3NldF9uYW1lJywndGV4dC1sZWZ0J10sCiAgICAgICAgICAgIFsnc3ViX2NhdGVnb3J5JywgJ3N1Yl9jYXRlZ29yeScsJ3RleHQtbGVmdCddLAogICAgICAgICAgICBbJ2NhdGVnb3J5JywgJ2NhdGVnb3J5JywgJ3RleHQtbGVmdCddLAogICAgICAgICAgICBbJ2lkZW50aWZpY2F0aW9uX21hcmsnLCAnaWRlbnRpZmljYXRpb25fbWFyaycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2NhcGl0YWxpemF0aW9uX2RhdGUnLCAnY2FwaXRhbGl6YXRpb25fZGF0ZScsICd0ZXh0LWNlbnRlciddLCAKICAgICAgICAgICAgWydvcGVuaW5nX2Nvc3QnLCAnb3BlbmluZ19jb3N0JywgJ3RleHQtcmlnaHQnXSwKICAgICAgICAgICAgWydhZGRpdGlvbicsICdhZGRpdGlvbicsICd0ZXh0LXJpZ2h0J10sCiAgICAgICAgICAgIFsnZGlzcG9zYWwnLCAnZGlzcG9zYWwnLCAndGV4dC1yaWdodCddLAogICAgICAgICAgICBbJ2Nvc3QnLCAnY29zdCcsICd0ZXh0LXJpZ2h0J10sCiAgICAgICAgICAgIFsnZGVwcmVjaWF0aW9uX3JhdGUnLCAnZGVwcmVjaWF0aW9uX3JhdGUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydvcGVuaW5nX2RlcHJlY2lhdGlvbicsICdvcGVuaW5nX2RlcHJlY2lhdGlvbicsICd0ZXh0LXJpZ2h0J10sCiAgICAgICAgICAgIFsnZGVwcmVjaWF0aW9uX2Zvcl9wZXJpb2QnLCAnZGVwcmVjaWF0aW9uX2Zvcl9wZXJpb2QnLCAndGV4dC1yaWdodCddLAogICAgICAgICAgICBbJ2RlcHJlY2lhdGlvbl9kaXNwb3NlZCcsICdkZXByZWNpYXRpb25fZGlzcG9zZWQnLCAndGV4dC1yaWdodCddLCAKICAgICAgICAgICAgWydhY2N1bXVsYXRlZF9kZXByZWNpYXRpb24nLCAnYWNjdW11bGF0ZWRfZGVwcmVjaWF0aW9uJywgJ3RleHQtcmlnaHQnXSwgCiAgICAgICAgICAgIFsnYm9va192YWx1ZScsICdib29rX3ZhbHVlJywgJ3RleHQtcmlnaHQnXSwKICAgICAgICAgICAgWydsb2NhdGlvbicsICdsb2NhdGlvbicsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3N0YXR1cycsICdzdGF0dXMnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICApOwogICAgICAgIHJldHVybiAkcm93czsKICAgIH0KCiAgICAvKioKICAgICAqIEZpeGVkIGFzc2V0cyByZXBvcnQgYmFzZWQgb24gY2F0ZWdvcnkuCiAgICAgKiBzdWJjYXRlZ29yeSwgcHJvZHVjdCwgdXNlcnMgYW5kIGRhdGUKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYXNzZXRSZWdpc3RlcigpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJGNvbXBhbmllcyA9IENvbXBhbnk6OmhhcygncHJvZml0Q2VudHJlcy5jb3N0Q2VudHJlcycpCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3VzZXJzJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCd1c2VyX2lkJywgYXV0aCgpLT51c2VyKCktPmlkKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5nZXQoKTsKICAgICAgICAgICAgJGNvbXBhbnlfaWQgPSByZXF1ZXN0KCktPmdldCgnY29tcGFueV9pZCcpID4gMCA/IHJlcXVlc3QoKS0+Z2V0KCdjb21wYW55X2lkJykgOiAkY29tcGFuaWVzWzBdLT5pZDsKICAgICAgICAgICAgJGZpc2NhbFllYXIgPSBnZXRBY3RpdmVGaXNjYWxZZWFyKCRjb21wYW55X2lkKTsKCiAgICAgICAgICAgICRmcm9tID0gcmVxdWVzdCgpLT5oYXMoJ2Zyb20nKSAmJiBzdHJ0b3RpbWUocmVxdWVzdCgpLT5nZXQoJ2Zyb20nKSkgPiAwID8gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUocmVxdWVzdCgpLT5nZXQoJ2Zyb20nKSkpIDogZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJGZpc2NhbFllYXItPnN0YXJ0KSk7CiAgICAgICAgICAgICR0byA9IHJlcXVlc3QoKS0+aGFzKCd0bycpICYmIHN0cnRvdGltZShyZXF1ZXN0KCktPmdldCgndG8nKSkgPiAwID8gZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUocmVxdWVzdCgpLT5nZXQoJ3RvJykpKSA6IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRmaXNjYWxZZWFyLT5lbmQpKTsKCiAgICAgICAgICAgIGlmIChyZXF1ZXN0KCktPmFqYXgoKSkgewogICAgICAgICAgICAgICAgICRpdGVtcyA9IEZpeGVkQXNzZXRCYXRjaEl0ZW06OndpdGgoWwogICAgICAgICAgICAgICAgICAgICdmaW5hbEFzc2V0LmF0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScsCiAgICAgICAgICAgICAgICAgICAgJ2ZpbmFsQXNzZXQucHJvZHVjdFVuaXQnLAogICAgICAgICAgICAgICAgICAgICdmaW5hbEFzc2V0LmNhdGVnb3J5LmNhdGVnb3J5JywKICAgICAgICAgICAgICAgICAgICAnYmF0Y2guaXRlbXMnLAogICAgICAgICAgICAgICAgICAgICdjdXJyZW50VXNlci5maXhlZEFzc2V0TG9jYXRpb24nLAogICAgICAgICAgICAgICAgICAgICdkZXByZWNpYXRpb25zJywKCiAgICAgICAgICAgICAgICAgICAgJ2JhdGNoLmdvb2RzUmVjZWl2ZWRJdGVtc1N0b2NrSW4ucmVsUHVyY2hhc2VPcmRlci5yZWxQdXJjaGFzZU9yZGVySXRlbXMnLAogICAgICAgICAgICAgICAgICAgICdiYXRjaC5nb29kc1JlY2VpdmVkSXRlbXNTdG9ja0luLnJlbFB1cmNoYXNlT3JkZXIucmVsUXVvdGF0aW9uLnJlbFF1b3RhdGlvbkl0ZW1zJywKICAgICAgICAgICAgICAgICAgICAnYmF0Y2guZ29vZHNSZWNlaXZlZEl0ZW1zU3RvY2tJbi5hc3NldENvc3RpbmdFbnRyaWVzJywKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAtPmdyb3VwQnkoJ2Fzc2V0X2NvZGUnKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygnYmF0Y2guY29zdENlbnRyZS5wcm9maXRDZW50cmUnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkY29tcGFueV9pZCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2NvbXBhbnlfaWQnLCAkY29tcGFueV9pZCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPm9yZGVyYnkoJ2lkJywgJ2Rlc2MnKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICRjb2RlcyA9ICRpdGVtcy0+cGx1Y2soJ2Fzc2V0X2NvZGUnKS0+dG9BcnJheSgpOwogICAgICAgICAgICAgICAgJGFsbEJhdGNoSXRlbXMgPSBGaXhlZEFzc2V0QmF0Y2hJdGVtOjp3aGVyZUluKCdhc3NldF9jb2RlJywgJGNvZGVzKS0+Z2V0KCk7CiAgICAgICAgICAgICAgICAkYWxsRGVwcmVjaWF0aW9ucyA9IEZpeGVkQXNzZXRCYXRjaEl0ZW1EZXByZWNpYXRpb246OndpdGgoWydiYXRjaEl0ZW0nXSkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ2JhdGNoSXRlbScsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRjb2Rlcyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignYXNzZXRfY29kZScsICRjb2Rlcyk7CiAgICAgICAgICAgICAgICB9KS0+Z2V0KCk7CgogICAgICAgICAgICAgICAgcmV0dXJuIERhdGF0YWJsZXM6Om9mKCRpdGVtcykKICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2Fzc2V0X25hbWUnLCBmdW5jdGlvbigkaXRlbSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCRpdGVtLT5maW5hbEFzc2V0LT5uYW1lKSA/ICRpdGVtLT5maW5hbEFzc2V0LT5uYW1lLicgJy5nZXRQcm9kdWN0QXR0cmlidXRlc0Zhc3RlcigkaXRlbS0+ZmluYWxBc3NldCkgOiAnJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignYXNzZXRfbmFtZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2ZpbmFsQXNzZXQnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3N1Yl9jYXRlZ29yeScsIGZ1bmN0aW9uKCRpdGVtKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJGl0ZW0tPmZpbmFsQXNzZXQtPmNhdGVnb3J5LT5uYW1lKSA/ICRpdGVtLT5maW5hbEFzc2V0LT5jYXRlZ29yeS0+bmFtZSA6ICcnOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdzdWJfY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdmaW5hbEFzc2V0LmNhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdjYXRlZ29yeScsIGZ1bmN0aW9uKCRpdGVtKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJGl0ZW0tPmZpbmFsQXNzZXQtPmNhdGVnb3J5LT5jYXRlZ29yeS0+bmFtZSkgPyAkaXRlbS0+ZmluYWxBc3NldC0+Y2F0ZWdvcnktPmNhdGVnb3J5LT5uYW1lIDogJyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2NhdGVnb3J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnZmluYWxBc3NldC5jYXRlZ29yeS5jYXRlZ29yeScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignbG9jYXRpb24nLCBmdW5jdGlvbigkaXRlbSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRpdGVtLT5jdXJyZW50VXNlciA/ICRpdGVtLT5jdXJyZW50VXNlci0+Zml4ZWRBc3NldExvY2F0aW9uLT5uYW1lIDogJ05vdCBEaXN0cmlidXRlZCc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2xvY2F0aW9uJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnY3VycmVudFVzZXIuZml4ZWRBc3NldExvY2F0aW9uJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdjYXBpdGFsaXphdGlvbl9kYXRlJywgZnVuY3Rpb24oJGl0ZW0pewogICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkaXRlbS0+YmF0Y2gtPmNyZWF0ZWRfYXQpKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignY2FwaXRhbGl6YXRpb25fZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2JhdGNoJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2NyZWF0ZWRfYXQnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdvcGVuaW5nX2Nvc3QnLCBmdW5jdGlvbigkaXRlbSkgdXNlKCRmcm9tLCAkdG8sICRhbGxCYXRjaEl0ZW1zLCAkYWxsRGVwcmVjaWF0aW9ucyl7CiAgICAgICAgICAgICAgICAgICAgJG9wZW5pbmdfYWRkaXRpb24gPSAkYWxsQmF0Y2hJdGVtcy0+d2hlcmUoJ2Fzc2V0X2NvZGUnLCAkaXRlbS0+YXNzZXRfY29kZSktPndoZXJlKCdjcmVhdGVkX2F0JywgJzwnLCAkZnJvbSktPnN1bSgnYXNzZXRfdmFsdWUnKTsKICAgICAgICAgICAgICAgICAgICAkb3BlbmluZ19kZXByZWNpYXRlZCA9ICRhbGxEZXByZWNpYXRpb25zLT53aGVyZSgndG8nLCAnPCcsICRmcm9tKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2JhdGNoSXRlbS5hc3NldF9jb2RlJywgJGl0ZW0tPmFzc2V0X2NvZGUpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnYmF0Y2hJdGVtLmlzX2Rpc3Bvc2VkJywgMCkKICAgICAgICAgICAgICAgICAgICAtPnN1bSgnYW1vdW50Jyk7CiAgICAgICAgICAgICAgICAgICAgJG9wZW5pbmdfZGlzcG9zYWwgPSAkYWxsQmF0Y2hJdGVtcy0+d2hlcmUoJ2Fzc2V0X2NvZGUnLCAkaXRlbS0+YXNzZXRfY29kZSkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdpc19kaXNwb3NlZCcsIDEpLT53aGVyZSgnZGlzcG9zZWRfYXQnLCAnPCcsICRmcm9tKS0+c3VtKCdhc3NldF92YWx1ZScpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBzeXN0ZW1Nb25leUZvcm1hdCgoJG9wZW5pbmdfYWRkaXRpb24tJG9wZW5pbmdfZGlzcG9zYWwpLSRvcGVuaW5nX2RlcHJlY2lhdGVkKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYWRkaXRpb24nLCBmdW5jdGlvbigkaXRlbSkgdXNlKCRmcm9tLCAkdG8sICRhbGxCYXRjaEl0ZW1zKXsKICAgICAgICAgICAgICAgICAgICAkYWRkaXRpb24gPSAkYWxsQmF0Y2hJdGVtcy0+d2hlcmUoJ2Fzc2V0X2NvZGUnLCAkaXRlbS0+YXNzZXRfY29kZSkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdjcmVhdGVkX2F0JywgJz49JywgJGZyb20pCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnY3JlYXRlZF9hdCcsICc8PScsICR0bykKICAgICAgICAgICAgICAgICAgICAtPnN1bSgnYXNzZXRfdmFsdWUnKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3lzdGVtTW9uZXlGb3JtYXQoJGFkZGl0aW9uKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZGlzcG9zYWwnLCBmdW5jdGlvbigkaXRlbSkgdXNlKCRmcm9tLCAkdG8sICRhbGxCYXRjaEl0ZW1zKXsKICAgICAgICAgICAgICAgICAgICAkZGlzcG9zYWwgPSAkYWxsQmF0Y2hJdGVtcy0+d2hlcmUoJ2Fzc2V0X2NvZGUnLCAkaXRlbS0+YXNzZXRfY29kZSkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdpc19kaXNwb3NlZCcsIDEpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnZGlzcG9zZWRfYXQnLCAnPj0nLCAkZnJvbSkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdkaXNwb3NlZF9hdCcsICc8PScsICR0bykKICAgICAgICAgICAgICAgICAgICAtPnN1bSgnYXNzZXRfdmFsdWUnKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3lzdGVtTW9uZXlGb3JtYXQoJGRpc3Bvc2FsKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignY29zdCcsIGZ1bmN0aW9uKCRpdGVtKSB1c2UoJGZyb20sICR0bywgJGFsbEJhdGNoSXRlbXMsICRhbGxEZXByZWNpYXRpb25zKXsKICAgICAgICAgICAgICAgICAgICAkb3BlbmluZ19hZGRpdGlvbiA9ICRhbGxCYXRjaEl0ZW1zLT53aGVyZSgnYXNzZXRfY29kZScsICRpdGVtLT5hc3NldF9jb2RlKS0+d2hlcmUoJ2NyZWF0ZWRfYXQnLCAnPCcsICRmcm9tKS0+c3VtKCdhc3NldF92YWx1ZScpOwogICAgICAgICAgICAgICAgICAgICRvcGVuaW5nX2RlcHJlY2lhdGVkID0gJGFsbERlcHJlY2lhdGlvbnMtPndoZXJlKCd0bycsICc8JywgJGZyb20pCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnYmF0Y2hJdGVtLmFzc2V0X2NvZGUnLCAkaXRlbS0+YXNzZXRfY29kZSkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdiYXRjaEl0ZW0uaXNfZGlzcG9zZWQnLCAwKQogICAgICAgICAgICAgICAgICAgIC0+c3VtKCdhbW91bnQnKTsKICAgICAgICAgICAgICAgICAgICAkb3BlbmluZ19kaXNwb3NhbCA9ICRhbGxCYXRjaEl0ZW1zLT53aGVyZSgnYXNzZXRfY29kZScsICRpdGVtLT5hc3NldF9jb2RlKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2lzX2Rpc3Bvc2VkJywgMSktPndoZXJlKCdkaXNwb3NlZF9hdCcsICc8JywgJGZyb20pLT5zdW0oJ2Fzc2V0X3ZhbHVlJyk7CgogICAgICAgICAgICAgICAgICAgICRhZGRpdGlvbiA9ICRhbGxCYXRjaEl0ZW1zLT53aGVyZSgnYXNzZXRfY29kZScsICRpdGVtLT5hc3NldF9jb2RlKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2NyZWF0ZWRfYXQnLCAnPj0nLCAkZnJvbSkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdjcmVhdGVkX2F0JywgJzw9JywgJHRvKQogICAgICAgICAgICAgICAgICAgIC0+c3VtKCdhc3NldF92YWx1ZScpOwoKICAgICAgICAgICAgICAgICAgICAkZGlzcG9zYWwgPSAkYWxsQmF0Y2hJdGVtcy0+d2hlcmUoJ2Fzc2V0X2NvZGUnLCAkaXRlbS0+YXNzZXRfY29kZSkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdpc19kaXNwb3NlZCcsIDEpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnZGlzcG9zZWRfYXQnLCAnPj0nLCAkZnJvbSkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdkaXNwb3NlZF9hdCcsICc8PScsICR0bykKICAgICAgICAgICAgICAgICAgICAtPnN1bSgnYXNzZXRfdmFsdWUnKTsKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN5c3RlbU1vbmV5Rm9ybWF0KCgoJG9wZW5pbmdfYWRkaXRpb24tJG9wZW5pbmdfZGlzcG9zYWwpLSRvcGVuaW5nX2RlcHJlY2lhdGVkKSskYWRkaXRpb24tJGRpc3Bvc2FsKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignZGVwcmVjaWF0aW9uX3JhdGUnLCBmdW5jdGlvbigkaXRlbSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRpdGVtLT5kZXByZWNpYXRpb25fcmF0ZS4nJSc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2RlcHJlY2lhdGlvbl9yYXRlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZGVwcmVjaWF0aW9uX3JhdGUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdvcGVuaW5nX2RlcHJlY2lhdGlvbicsIGZ1bmN0aW9uKCRpdGVtKSB1c2UoJGZyb20sICR0bywgJGFsbERlcHJlY2lhdGlvbnMpewogICAgICAgICAgICAgICAgICAgICRvcGVuaW5nX2RlcHJlY2lhdGlvbiA9ICRhbGxEZXByZWNpYXRpb25zLT53aGVyZSgnYmF0Y2hJdGVtLmFzc2V0X2NvZGUnLCAkaXRlbS0+YXNzZXRfY29kZSktPndoZXJlKCd0bycsICc8JywgJGZyb20pCiAgICAgICAgICAgICAgICAgICAgLT5zdW0oJ2Ftb3VudCcpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBzeXN0ZW1Nb25leUZvcm1hdCgkb3BlbmluZ19kZXByZWNpYXRpb24pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdkZXByZWNpYXRpb25fZm9yX3BlcmlvZCcsIGZ1bmN0aW9uKCRpdGVtKSB1c2UoJGZyb20sICR0bywgJGFsbERlcHJlY2lhdGlvbnMpewogICAgICAgICAgICAgICAgICAgICRvcGVuaW5nX2RlcHJlY2lhdGlvbiA9ICRhbGxEZXByZWNpYXRpb25zLT53aGVyZSgnYmF0Y2hJdGVtLmFzc2V0X2NvZGUnLCAkaXRlbS0+YXNzZXRfY29kZSktPndoZXJlKCd0bycsICc8JywgJGZyb20pLT5zdW0oJ2Ftb3VudCcpOwogICAgICAgICAgICAgICAgICAgICRhY2N1bXVsYXRlZF9kZXByZWNpYXRpb24gPSAkYWxsRGVwcmVjaWF0aW9ucy0+d2hlcmUoJ3RvJywgJzw9JywgJHRvKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2JhdGNoSXRlbS5hc3NldF9jb2RlJywgJGl0ZW0tPmFzc2V0X2NvZGUpCiAgICAgICAgICAgICAgICAgICAgLT5zdW0oJ2Ftb3VudCcpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBzeXN0ZW1Nb25leUZvcm1hdCgkYWNjdW11bGF0ZWRfZGVwcmVjaWF0aW9uLSRvcGVuaW5nX2RlcHJlY2lhdGlvbik7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2RlcHJlY2lhdGlvbl9kaXNwb3NlZCcsIGZ1bmN0aW9uKCRpdGVtKSB1c2UoJGZyb20sICR0bywgJGFsbERlcHJlY2lhdGlvbnMpewogICAgICAgICAgICAgICAgICAgICRhY2N1bXVsYXRlZF9kZXByZWNpYXRpb24gPSAkYWxsRGVwcmVjaWF0aW9ucy0+d2hlcmUoJ3RvJywgJzw9JywgJHRvKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2JhdGNoSXRlbS5hc3NldF9jb2RlJywgJGl0ZW0tPmFzc2V0X2NvZGUpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnYmF0Y2hJdGVtLmlzX2Rpc3Bvc2VkJywgMSkKICAgICAgICAgICAgICAgICAgICAtPnN1bSgnYW1vdW50Jyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN5c3RlbU1vbmV5Rm9ybWF0KCRhY2N1bXVsYXRlZF9kZXByZWNpYXRpb24pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhY2N1bXVsYXRlZF9kZXByZWNpYXRpb24nLCBmdW5jdGlvbigkaXRlbSkgdXNlKCR0bywgJGFsbERlcHJlY2lhdGlvbnMpewogICAgICAgICAgICAgICAgICAgICRhY2N1bXVsYXRlZF9kZXByZWNpYXRpb24gPSAkYWxsRGVwcmVjaWF0aW9ucy0+d2hlcmUoJ3RvJywgJzw9JywgJHRvKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2JhdGNoSXRlbS5hc3NldF9jb2RlJywgJGl0ZW0tPmFzc2V0X2NvZGUpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnYmF0Y2hJdGVtLmlzX2Rpc3Bvc2VkJywgMCkKICAgICAgICAgICAgICAgICAgICAtPnN1bSgnYW1vdW50Jyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN5c3RlbU1vbmV5Rm9ybWF0KCRhY2N1bXVsYXRlZF9kZXByZWNpYXRpb24pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdib29rX3ZhbHVlJywgZnVuY3Rpb24oJGl0ZW0pIHVzZSgkdG8sICRhbGxCYXRjaEl0ZW1zLCAkYWxsRGVwcmVjaWF0aW9ucyl7CiAgICAgICAgICAgICAgICAgICAgJGFzc2V0X3ZhbHVlID0gJGFsbEJhdGNoSXRlbXMtPndoZXJlKCdhc3NldF9jb2RlJywgJGl0ZW0tPmFzc2V0X2NvZGUpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnaXNfZGlzcG9zZWQnLCAwKQogICAgICAgICAgICAgICAgICAgIC0+c3VtKCdhc3NldF92YWx1ZScpOwogICAgICAgICAgICAgICAgICAgICRhY2N1bXVsYXRlZF9kZXByZWNpYXRpb24gPSAkYWxsRGVwcmVjaWF0aW9ucy0+d2hlcmUoJ3RvJywgJzw9JywgJHRvKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2JhdGNoSXRlbS5hc3NldF9jb2RlJywgJGl0ZW0tPmFzc2V0X2NvZGUpCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnYmF0Y2hJdGVtLmlzX2Rpc3Bvc2VkJywgMCkKICAgICAgICAgICAgICAgICAgICAtPnN1bSgnYW1vdW50Jyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN5c3RlbU1vbmV5Rm9ybWF0KCRhc3NldF92YWx1ZS0kYWNjdW11bGF0ZWRfZGVwcmVjaWF0aW9uKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignaWRlbnRpZmljYXRpb25fbWFyaycsIGZ1bmN0aW9uKCRpdGVtKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGl0ZW0tPmFzc2V0X2NvZGU7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2lkZW50aWZpY2F0aW9uX21hcmsnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdhc3NldF9jb2RlJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignc3RhdHVzJywgZnVuY3Rpb24oJGl0ZW0pewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkaXRlbS0+aXNfZGlzcG9zZWQgPT0gMCA/ICdBY3RpdmUnIDogdWN3b3JkcygkaXRlbS0+ZGlzcG9zYWxfdHlwZSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5za2lwVG90YWxSZWNvcmRzKCkKICAgICAgICAgICAgICAgIC0+cmF3Q29sdW1ucyhbXSkKICAgICAgICAgICAgICAgIC0+dG9Kc29uKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAnRml4ZWQgQXNzZXQgUmVnaXN0ZXInLAogICAgICAgICAgICAgICAgJ2NvbXBhbmllcycgPT4gJGNvbXBhbmllcywKICAgICAgICAgICAgICAgICdjb21wYW55X2lkJyA9PiAkY29tcGFueV9pZCwKICAgICAgICAgICAgICAgICdmcm9tJyA9PiAkZnJvbSwKICAgICAgICAgICAgICAgICd0bycgPT4gJHRvLAogICAgICAgICAgICAgICAgJ2hlYWRlckNvbHVtbnMnID0+ICR0aGlzLT5hc3NzZXRSZWdpc3RlckhlYWRlckNvbHVtbnMoKQogICAgICAgICAgICBdOwogICAgICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLmZpeGVkQXNzZXRzLmZpeGVkQXNzZXRSZXBvcnRzLmFzc2V0UmVnaXN0ZXInLCAkZGF0YSk7CiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRml4ZWQgYXNzZXRzIHJlcG9ydCBiYXNlZCBvbiBjYXRlZ29yeS4KICAgICAqIHN1YmNhdGVnb3J5LCBwcm9kdWN0LCB1c2VycyBhbmQgZGF0ZQogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhc3NldENvc3RCcmVha2Rvd24oKQogICAgewogICAgICAgICR0aXRsZSA9ICdBc3NldCBDb3N0IEJyZWFrZG93bic7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJGZpc2NhbFllYXIgPSBnZXRBY3RpdmVGaXNjYWxZZWFyKGF1dGgoKS0+dXNlcigpLT5jb3N0Q2VudHJlLT5wcm9maXRDZW50cmUtPmNvbXBhbnlfaWQpOwogICAgICAgICAgICAkZnJvbSA9IHJlcXVlc3QoKS0+aGFzKCdmcm9tJykgJiYgc3RydG90aW1lKHJlcXVlc3QoKS0+Z2V0KCdmcm9tJykpID4gMCA/IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKHJlcXVlc3QoKS0+Z2V0KCdmcm9tJykpKSA6IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRmaXNjYWxZZWFyLT5zdGFydCkpOwogICAgICAgICAgICAkdG8gPSByZXF1ZXN0KCktPmhhcygndG8nKSAmJiBzdHJ0b3RpbWUocmVxdWVzdCgpLT5nZXQoJ3RvJykpID4gMCA/IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKHJlcXVlc3QoKS0+Z2V0KCd0bycpKSkgOiBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkZmlzY2FsWWVhci0+ZW5kKSk7CgogICAgICAgICAgICAkaXRlbXMgPSBGaXhlZEFzc2V0QmF0Y2hJdGVtOjp3aXRoKFsKICAgICAgICAgICAgICAgICdmaW5hbEFzc2V0LmF0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScsCiAgICAgICAgICAgICAgICAnZmluYWxBc3NldC5wcm9kdWN0VW5pdCcsCiAgICAgICAgICAgICAgICAnZmluYWxBc3NldC5jYXRlZ29yeS5jYXRlZ29yeScsCiAgICAgICAgICAgICAgICAnYmF0Y2guaXRlbXMnLAogICAgICAgICAgICAgICAgJ2N1cnJlbnRVc2VyLmZpeGVkQXNzZXRMb2NhdGlvbicsCiAgICAgICAgICAgICAgICAnZGVwcmVjaWF0aW9ucycsCgogICAgICAgICAgICAgICAgJ2JhdGNoLmdvb2RzUmVjZWl2ZWRJdGVtc1N0b2NrSW4ucmVsUHVyY2hhc2VPcmRlci5yZWxQdXJjaGFzZU9yZGVySXRlbXMnLAogICAgICAgICAgICAgICAgJ2JhdGNoLmdvb2RzUmVjZWl2ZWRJdGVtc1N0b2NrSW4ucmVsUHVyY2hhc2VPcmRlci5yZWxRdW90YXRpb24ucmVsUXVvdGF0aW9uSXRlbXMnLAogICAgICAgICAgICAgICAgJ2JhdGNoLmdvb2RzUmVjZWl2ZWRJdGVtc1N0b2NrSW4uYXNzZXRDb3N0aW5nRW50cmllcycsCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ2JhdGNoLmNvc3RDZW50cmUucHJvZml0Q2VudHJlJywgZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2NvbXBhbnlfaWQnLCBhdXRoKCktPnVzZXIoKS0+Y29tcGFuaWVzLT5wbHVjaygnY29tcGFueV9pZCcpLT50b0FycmF5KCkpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPmdyb3VwQnkoJ2Fzc2V0X2NvZGUnKQogICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAgICAgJGNvZGVzID0gJGl0ZW1zLT5wbHVjaygnYXNzZXRfY29kZScpLT50b0FycmF5KCk7CiAgICAgICAgICAgICRhbGxCYXRjaEl0ZW1zID0gRml4ZWRBc3NldEJhdGNoSXRlbTo6d2hlcmVJbignYXNzZXRfY29kZScsICRjb2RlcyktPmdldCgpOwogICAgICAgICAgICAkYWxsRGVwcmVjaWF0aW9ucyA9IEZpeGVkQXNzZXRCYXRjaEl0ZW1EZXByZWNpYXRpb246OndpdGgoWydiYXRjaEl0ZW0nXSkKICAgICAgICAgICAgLT53aGVyZUhhcygnYmF0Y2hJdGVtJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGNvZGVzKXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2Fzc2V0X2NvZGUnLCAkY29kZXMpOwogICAgICAgICAgICB9KS0+Z2V0KCk7CgogICAgICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJHRpdGxlLicgKCcuJGZyb20uJyB0byAnLiR0by4nKScsCiAgICAgICAgICAgICAgICAnZnJvbScgPT4gJGZyb20sCiAgICAgICAgICAgICAgICAndG8nID0+ICR0bywKICAgICAgICAgICAgICAgICdpdGVtcycgPT4gJGl0ZW1zLAogICAgICAgICAgICAgICAgJ2FsbEJhdGNoSXRlbXMnID0+ICRhbGxCYXRjaEl0ZW1zLAogICAgICAgICAgICAgICAgJ2FsbERlcHJlY2lhdGlvbnMnID0+ICRhbGxEZXByZWNpYXRpb25zLAogICAgICAgICAgICBdOwoKICAgICAgICAgICAgaWYocmVxdWVzdCgpLT5oYXMoJ3JlcG9ydF90eXBlJykgJiYgcmVxdWVzdCgpLT5nZXQoJ3JlcG9ydF90eXBlJykgPT0gJ3BkZicpewogICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdNUERGKCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMuZml4ZWRBc3NldHMuZml4ZWRBc3NldFJlcG9ydHMuYXNzZXRDb3N0QnJlYWtkb3duUERGJywgJGRhdGEsICR0aXRsZSwgJHRpdGxlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYocmVxdWVzdCgpLT5oYXMoJ3JlcG9ydF90eXBlJykgJiYgcmVxdWVzdCgpLT5nZXQoJ3JlcG9ydF90eXBlJykgPT0gJ3JlcG9ydCcpewogICAgICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5maXhlZEFzc2V0cy5maXhlZEFzc2V0UmVwb3J0cy5hc3NldENvc3RCcmVha2Rvd25SZXBvcnQnLCAkZGF0YSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMuZml4ZWRBc3NldHMuZml4ZWRBc3NldFJlcG9ydHMuYXNzZXRDb3N0QnJlYWtkb3duJywgJGRhdGEpOwogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gY2F0ZWdvcnlXaXNlQXNzZXRSZWdpc3RlcigpCiAgICB7CiAgICAgICAgdHJ5ewogICAgICAgICAgICAkY2F0ZWdvcnlfaWQgPSByZXF1ZXN0KCktPmhhcygnY2F0ZWdvcnlfaWQnKSA/IHJlcXVlc3QoKS0+Z2V0KCdjYXRlZ29yeV9pZCcpIDogMDsKICAgICAgICAgICAgJGZpc2NhbFllYXIgPSBnZXRBY3RpdmVGaXNjYWxZZWFyKGF1dGgoKS0+dXNlcigpLT5jb3N0Q2VudHJlLT5wcm9maXRDZW50cmUtPmNvbXBhbnlfaWQpOwogICAgICAgICAgICAkZnJvbSA9IHJlcXVlc3QoKS0+aGFzKCdmcm9tJykgJiYgc3RydG90aW1lKHJlcXVlc3QoKS0+Z2V0KCdmcm9tJykpID4gMCA/IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKHJlcXVlc3QoKS0+Z2V0KCdmcm9tJykpKSA6IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRmaXNjYWxZZWFyLT5zdGFydCkpOwogICAgICAgICAgICAkdG8gPSByZXF1ZXN0KCktPmhhcygndG8nKSAmJiBzdHJ0b3RpbWUocmVxdWVzdCgpLT5nZXQoJ3RvJykpID4gMCA/IGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKHJlcXVlc3QoKS0+Z2V0KCd0bycpKSkgOiBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkZmlzY2FsWWVhci0+ZW5kKSk7CgogICAgICAgICAgICAkY2F0ZWdvcnkgPSBDYXRlZ29yeTo6ZmluZCgkY2F0ZWdvcnlfaWQpOwoKICAgICAgICAgICAgJGRhdGEgPSBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICdDYXRlZ29yeSB3aXNlIEFzc2V0IFJlZ2lzdGVyICcuKGlzc2V0KCRjYXRlZ29yeS0+aWQpID8gJyMnLiRjYXRlZ29yeS0+bmFtZS4nICgnLiRjYXRlZ29yeS0+Y29kZS4nKScgOiAnJykuJyAoJy4oJGZyb20uJyB0byAnLiR0bykuJyknLAogICAgICAgICAgICAgICAgJ2NhdGVnb3JpZXMnID0+IENhdGVnb3J5OjpoYXMoJ3N1YkNhdGVnb3J5LnByb2R1Y3RzLmZpeGVkQXNzZXRCYXRjaEl0ZW1zLmZpbmFsQXNzZXQnKS0+Z2V0KCksCiAgICAgICAgICAgICAgICAnY2F0ZWdvcnlfaWQnID0+ICRjYXRlZ29yeV9pZCwKICAgICAgICAgICAgICAgICdmcm9tJyA9PiAkZnJvbSwKICAgICAgICAgICAgICAgICd0bycgPT4gJHRvLAogICAgICAgICAgICBdOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYoJGNhdGVnb3J5X2lkID4gMCl7CiAgICAgICAgICAgICAgICAkaXRlbXMgPSBGaXhlZEFzc2V0QmF0Y2hJdGVtOjp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAnZmluYWxBc3NldC5hdHRyaWJ1dGVzLmF0dHJpYnV0ZU9wdGlvbi5hdHRyaWJ1dGUnLAogICAgICAgICAgICAgICAgICAgICdmaW5hbEFzc2V0LnByb2R1Y3RVbml0JywKICAgICAgICAgICAgICAgICAgICAnZmluYWxBc3NldC5jYXRlZ29yeS5jYXRlZ29yeScsCiAgICAgICAgICAgICAgICAgICAgJ2JhdGNoLml0ZW1zJywKICAgICAgICAgICAgICAgICAgICAnY3VycmVudFVzZXIuZml4ZWRBc3NldExvY2F0aW9uJywKICAgICAgICAgICAgICAgICAgICAnZGVwcmVjaWF0aW9ucycsCgogICAgICAgICAgICAgICAgICAgICdiYXRjaC5nb29kc1JlY2VpdmVkSXRlbXNTdG9ja0luLnJlbFB1cmNoYXNlT3JkZXIucmVsUHVyY2hhc2VPcmRlckl0ZW1zJywKICAgICAgICAgICAgICAgICAgICAnYmF0Y2guZ29vZHNSZWNlaXZlZEl0ZW1zU3RvY2tJbi5yZWxQdXJjaGFzZU9yZGVyLnJlbFF1b3RhdGlvbi5yZWxRdW90YXRpb25JdGVtcycsCiAgICAgICAgICAgICAgICAgICAgJ2JhdGNoLmdvb2RzUmVjZWl2ZWRJdGVtc1N0b2NrSW4uYXNzZXRDb3N0aW5nRW50cmllcycsCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygnYmF0Y2guY29zdENlbnRyZS5wcm9maXRDZW50cmUnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSW4oJ2NvbXBhbnlfaWQnLCBhdXRoKCktPnVzZXIoKS0+Y29tcGFuaWVzLT5wbHVjaygnY29tcGFueV9pZCcpLT50b0FycmF5KCkpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ2ZpbmFsQXNzZXQuY2F0ZWdvcnkuY2F0ZWdvcnknLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkY2F0ZWdvcnlfaWQpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpZCcsICRjYXRlZ29yeV9pZCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5ncm91cEJ5KCdhc3NldF9jb2RlJykKICAgICAgICAgICAgICAgIC8vIC0+d2hlcmVIYXMoJ2JhdGNoJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGZyb20pewogICAgICAgICAgICAgICAgLy8gICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdjcmVhdGVkX2F0JywgJz49JywgJGZyb20pOwogICAgICAgICAgICAgICAgLy8gfSkKICAgICAgICAgICAgICAgIC0+Z2V0KCk7CgogICAgICAgICAgICAgICAgJGNvZGVzID0gJGl0ZW1zLT5wbHVjaygnYXNzZXRfY29kZScpLT50b0FycmF5KCk7CiAgICAgICAgICAgICAgICAkYWxsQmF0Y2hJdGVtcyA9IEZpeGVkQXNzZXRCYXRjaEl0ZW06OndoZXJlSW4oJ2Fzc2V0X2NvZGUnLCAkY29kZXMpLT5nZXQoKTsKICAgICAgICAgICAgICAgICRhbGxEZXByZWNpYXRpb25zID0gRml4ZWRBc3NldEJhdGNoSXRlbURlcHJlY2lhdGlvbjo6d2l0aChbJ2JhdGNoSXRlbSddKQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygnYmF0Y2hJdGVtJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGNvZGVzKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdhc3NldF9jb2RlJywgJGNvZGVzKTsKICAgICAgICAgICAgICAgIH0pLT5nZXQoKTsKCiAgICAgICAgICAgICAgICAkZGF0YVsnaXRlbXMnXSA9ICRpdGVtczsKICAgICAgICAgICAgICAgICRkYXRhWydhbGxCYXRjaEl0ZW1zJ10gPSAkYWxsQmF0Y2hJdGVtczsKICAgICAgICAgICAgICAgICRkYXRhWydhbGxEZXByZWNpYXRpb25zJ10gPSAkYWxsRGVwcmVjaWF0aW9uczsKCiAgICAgICAgICAgICAgICByZXR1cm4gdmlld01QREYoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5maXhlZEFzc2V0cy5maXhlZEFzc2V0UmVwb3J0cy5jYXRlZ29yeVdpc2VBc3NldFJlZ2lzdGVyUERGJywgJGRhdGEsICRkYXRhWyd0aXRsZSddLCAkZGF0YVsndGl0bGUnXSwgJ2E0JywgJ0wnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5maXhlZEFzc2V0cy5maXhlZEFzc2V0UmVwb3J0cy5jYXRlZ29yeVdpc2VBc3NldFJlZ2lzdGVyJywgJGRhdGEpOwogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gc3ViQ2F0ZWdvcnlXaXNlQXNzZXRSZWdpc3RlcigpCiAgICB7CiAgICAgICAgdHJ5ewogICAgICAgICAgICAkc3ViX2NhdGVnb3J5X2lkID0gcmVxdWVzdCgpLT5oYXMoJ2NhdGVnb3J5X2lkJykgPyByZXF1ZXN0KCktPmdldCgnY2F0ZWdvcnlfaWQnKSA6IDA7CiAgICAgICAgICAgICRmaXNjYWxZZWFyID0gZ2V0QWN0aXZlRmlzY2FsWWVhcihhdXRoKCktPnVzZXIoKS0+Y29zdENlbnRyZS0+cHJvZml0Q2VudHJlLT5jb21wYW55X2lkKTsKICAgICAgICAgICAgJGZyb20gPSByZXF1ZXN0KCktPmhhcygnZnJvbScpICYmIHN0cnRvdGltZShyZXF1ZXN0KCktPmdldCgnZnJvbScpKSA+IDAgPyBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZShyZXF1ZXN0KCktPmdldCgnZnJvbScpKSkgOiBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkZmlzY2FsWWVhci0+c3RhcnQpKTsKICAgICAgICAgICAgJHRvID0gcmVxdWVzdCgpLT5oYXMoJ3RvJykgJiYgc3RydG90aW1lKHJlcXVlc3QoKS0+Z2V0KCd0bycpKSA+IDAgPyBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZShyZXF1ZXN0KCktPmdldCgndG8nKSkpIDogZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJGZpc2NhbFllYXItPmVuZCkpOwoKICAgICAgICAgICAgJGNhdGVnb3J5ID0gQ2F0ZWdvcnk6OmZpbmQoJHN1Yl9jYXRlZ29yeV9pZCk7CgogICAgICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJ1N1YiBDYXRlZ29yeSB3aXNlIEFzc2V0IFJlZ2lzdGVyICcuKGlzc2V0KCRjYXRlZ29yeS0+aWQpID8gJyMnLiRjYXRlZ29yeS0+bmFtZS4nICgnLiRjYXRlZ29yeS0+Y29kZS4nKScgOiAnJykuKChpc3NldCgkY2F0ZWdvcnktPmlkKSA/ICcgIycuJGNhdGVnb3J5LT5jYXRlZ29yeS0+bmFtZS4nICgnLiRjYXRlZ29yeS0+Y2F0ZWdvcnktPmNvZGUuJyknIDogJycpKS4nICgnLigkZnJvbS4nIHRvICcuJHRvKS4nKScsCiAgICAgICAgICAgICAgICAnY2F0ZWdvcmllcycgPT4gQ2F0ZWdvcnk6OmhhcygncHJvZHVjdHMuZml4ZWRBc3NldEJhdGNoSXRlbXMuZmluYWxBc3NldCcpLT5nZXQoKSwKICAgICAgICAgICAgICAgICdzdWJfY2F0ZWdvcnlfaWQnID0+ICRzdWJfY2F0ZWdvcnlfaWQsCiAgICAgICAgICAgICAgICAnZnJvbScgPT4gJGZyb20sCiAgICAgICAgICAgICAgICAndG8nID0+ICR0bywKICAgICAgICAgICAgXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmKCRzdWJfY2F0ZWdvcnlfaWQgPiAwKXsKICAgICAgICAgICAgICAgICRpdGVtcyA9IEZpeGVkQXNzZXRCYXRjaEl0ZW06OndpdGgoWwogICAgICAgICAgICAgICAgICAgICdmaW5hbEFzc2V0LmF0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScsCiAgICAgICAgICAgICAgICAgICAgJ2ZpbmFsQXNzZXQucHJvZHVjdFVuaXQnLAogICAgICAgICAgICAgICAgICAgICdmaW5hbEFzc2V0LmNhdGVnb3J5LmNhdGVnb3J5JywKICAgICAgICAgICAgICAgICAgICAnYmF0Y2guaXRlbXMnLAogICAgICAgICAgICAgICAgICAgICdjdXJyZW50VXNlci5maXhlZEFzc2V0TG9jYXRpb24nLAogICAgICAgICAgICAgICAgICAgICdkZXByZWNpYXRpb25zJywKCiAgICAgICAgICAgICAgICAgICAgJ2JhdGNoLmdvb2RzUmVjZWl2ZWRJdGVtc1N0b2NrSW4ucmVsUHVyY2hhc2VPcmRlci5yZWxQdXJjaGFzZU9yZGVySXRlbXMnLAogICAgICAgICAgICAgICAgICAgICdiYXRjaC5nb29kc1JlY2VpdmVkSXRlbXNTdG9ja0luLnJlbFB1cmNoYXNlT3JkZXIucmVsUXVvdGF0aW9uLnJlbFF1b3RhdGlvbkl0ZW1zJywKICAgICAgICAgICAgICAgICAgICAnYmF0Y2guZ29vZHNSZWNlaXZlZEl0ZW1zU3RvY2tJbi5hc3NldENvc3RpbmdFbnRyaWVzJywKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdiYXRjaC5jb3N0Q2VudHJlLnByb2ZpdENlbnRyZScsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignY29tcGFueV9pZCcsIGF1dGgoKS0+dXNlcigpLT5jb21wYW5pZXMtPnBsdWNrKCdjb21wYW55X2lkJyktPnRvQXJyYXkoKSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVyZUhhcygnZmluYWxBc3NldC5jYXRlZ29yeScsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRzdWJfY2F0ZWdvcnlfaWQpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpZCcsICRzdWJfY2F0ZWdvcnlfaWQpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+Z3JvdXBCeSgnYXNzZXRfY29kZScpCiAgICAgICAgICAgICAgICAvLyAtPndoZXJlSGFzKCdiYXRjaCcsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRmcm9tKXsKICAgICAgICAgICAgICAgIC8vICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnY3JlYXRlZF9hdCcsICc+PScsICRmcm9tKTsKICAgICAgICAgICAgICAgIC8vIH0pCiAgICAgICAgICAgICAgICAtPmdldCgpOwoKICAgICAgICAgICAgICAgICRjb2RlcyA9ICRpdGVtcy0+cGx1Y2soJ2Fzc2V0X2NvZGUnKS0+dG9BcnJheSgpOwogICAgICAgICAgICAgICAgJGFsbEJhdGNoSXRlbXMgPSBGaXhlZEFzc2V0QmF0Y2hJdGVtOjp3aGVyZUluKCdhc3NldF9jb2RlJywgJGNvZGVzKS0+Z2V0KCk7CiAgICAgICAgICAgICAgICAkYWxsRGVwcmVjaWF0aW9ucyA9IEZpeGVkQXNzZXRCYXRjaEl0ZW1EZXByZWNpYXRpb246OndpdGgoWydiYXRjaEl0ZW0nXSkKICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ2JhdGNoSXRlbScsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRjb2Rlcyl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVJbignYXNzZXRfY29kZScsICRjb2Rlcyk7CiAgICAgICAgICAgICAgICB9KS0+Z2V0KCk7CgogICAgICAgICAgICAgICAgJGRhdGFbJ2l0ZW1zJ10gPSAkaXRlbXM7CiAgICAgICAgICAgICAgICAkZGF0YVsnYWxsQmF0Y2hJdGVtcyddID0gJGFsbEJhdGNoSXRlbXM7CiAgICAgICAgICAgICAgICAkZGF0YVsnYWxsRGVwcmVjaWF0aW9ucyddID0gJGFsbERlcHJlY2lhdGlvbnM7CgogICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdNUERGKCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMuZml4ZWRBc3NldHMuZml4ZWRBc3NldFJlcG9ydHMuc3ViQ2F0ZWdvcnlXaXNlQXNzZXRSZWdpc3RlclBERicsICRkYXRhLCAkZGF0YVsndGl0bGUnXSwgJGRhdGFbJ3RpdGxlJ10sICdhNCcsICdMJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMuZml4ZWRBc3NldHMuZml4ZWRBc3NldFJlcG9ydHMuc3ViQ2F0ZWdvcnlXaXNlQXNzZXRSZWdpc3RlcicsICRkYXRhKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgZ2xvYmFsIGRhdGEgdGFibGUgaGVhZGVycy4KICAgICAqCiAgICAgKiBAcmV0dXJuIGhlYWRlckNvbHVtbnMKICAgICAqLwogICAgIHB1YmxpYyBmdW5jdGlvbiBoZWFkZXJDb2x1bW5zKCR2YWx1ZT0nJykKICAgICB7CiAgICAgICAgJHJvd3MgPSAgYXJyYXkoCiAgICAgICAgICAgIFsnU0wnLCAnU0wnXSwKICAgICAgICAgICAgWydhc3NldCcsICdhc3NldCcsJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnR1JOJywgJ0dSTicsJ3RleHQtbGVmdCddLAogICAgICAgICAgICBbJ2JhdGNoX2lkJywgJ2JhdGNoX2lkJywgJ3RleHQtbGVmdCddLCAKICAgICAgICAgICAgWydhc3NldF9jb2RlJywgJ2Fzc2V0X2NvZGUnLCAndGV4dC1sZWZ0J10sIAogICAgICAgICAgICBbJ2xvY2F0aW9uJywgJ2xvY2F0aW9uJywgJ3RleHQtbGVmdCddLAogICAgICAgICAgICBbJ3VzZXInLCAndXNlcicsICd0ZXh0LWxlZnQnXSwKICAgICAgICAgICAgWyd1c2luZ19mcm9tJywgJ3VzaW5nX2Zyb20nLCAndGV4dC1sZWZ0J10sIAogICAgICAgICAgICBbJ3JlbWFya3MnLCAncmVtYXJrcycsICd0ZXh0LWxlZnQnXSwKICAgICAgICAgICAgWydhY3Rpb25zJywgJ2FjdGlvbnMnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICApOwogICAgICAgIHJldHVybiAkcm93czsKICAgIH0KCiAgICAvKioKICAgICAqIEZpeGVkIGFzc2V0cyByZXBvcnQgYmFzZWQgb24gY2F0ZWdvcnkuCiAgICAgKiBzdWJjYXRlZ29yeSwgcHJvZHVjdCwgdXNlcnMgYW5kIGRhdGUKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYXNzZXRSZXBvcnQoKQogICAgewogICAgICAgICR0aXRsZSA9ICdSZXBvcnQgLSBGaXhlZCBBc3NldCc7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJGl0ZW1zID0gRml4ZWRBc3NldEJhdGNoSXRlbTo6d2l0aChbCiAgICAgICAgICAgICAgICAnZmluYWxBc3NldC5hdHRyaWJ1dGVzLmF0dHJpYnV0ZU9wdGlvbi5hdHRyaWJ1dGUnLAogICAgICAgICAgICAgICAgJ2JhdGNoLnJlcXVpc2l0aW9uRGVsaXZlcnlJdGVtLnJlbFJlcXVpc2l0aW9uRGVsaXZlcnkucmVsUmVxdWlzaXRpb24nLAogICAgICAgICAgICAgICAgJ3VzZXJzJywKICAgICAgICAgICAgICAgICdjdXJyZW50VXNlci5maXhlZEFzc2V0TG9jYXRpb24nLAogICAgICAgICAgICAgICAgJ2N1cnJlbnRVc2VyLnVzZXInLAogICAgICAgICAgICBdKQogICAgICAgICAgICAtPndoZXJlSGFzKCdiYXRjaC5jb3N0Q2VudHJlLnByb2ZpdENlbnRyZScsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdjb21wYW55X2lkJywgYXV0aCgpLT51c2VyKCktPmNvbXBhbmllcy0+cGx1Y2soJ2NvbXBhbnlfaWQnKS0+dG9BcnJheSgpKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5ncm91cEJ5KCdhc3NldF9jb2RlJykKICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgnaWQnLCAnZGVzYycpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChyZXF1ZXN0KCktPmFqYXgoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIERhdGF0YWJsZXM6Om9mKCRpdGVtcykKICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2Fzc2V0JywgZnVuY3Rpb24oJGl0ZW0pewogICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkaXRlbS0+ZmluYWxBc3NldC0+bmFtZSkgPyAkaXRlbS0+ZmluYWxBc3NldC0+bmFtZS4nICcuZ2V0UHJvZHVjdEF0dHJpYnV0ZXNGYXN0ZXIoJGl0ZW0tPmZpbmFsQXNzZXQpIDogJyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2Fzc2V0JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnZmluYWxBc3NldCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignR1JOJywgZnVuY3Rpb24oJGl0ZW0pewogICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkaXRlbS0+YmF0Y2gtPmdvb2RzUmVjZWl2ZWRJdGVtc1N0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsR29vZHNSZWNlaXZlZE5vdGUtPmdybl9yZWZlcmVuY2Vfbm8pID8gJGl0ZW0tPmJhdGNoLT5nb29kc1JlY2VpdmVkSXRlbXNTdG9ja0luLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbEdvb2RzUmVjZWl2ZWROb3RlLT5ncm5fcmVmZXJlbmNlX25vIDogJyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ0dSTicsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2JhdGNoLmdvb2RzUmVjZWl2ZWRJdGVtc1N0b2NrSW4ucmVsR29vZHNSZWNlaXZlZEl0ZW1zLnJlbEdvb2RzUmVjZWl2ZWROb3RlJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2dybl9yZWZlcmVuY2Vfbm8nLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdiYXRjaF9pZCcsIGZ1bmN0aW9uKCRpdGVtKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJGl0ZW0tPmJhdGNoLT5iYXRjaCk/JGl0ZW0tPmJhdGNoLT5iYXRjaDonJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignYmF0Y2hfaWQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdiYXRjaCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdiYXRjaCcsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2xvY2F0aW9uJywgZnVuY3Rpb24oJGl0ZW0pewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkaXRlbS0+Y3VycmVudFVzZXIgPyAkaXRlbS0+Y3VycmVudFVzZXItPmZpeGVkQXNzZXRMb2NhdGlvbi0+bmFtZSA6ICdOb3QgRGlzdHJpYnV0ZWQnOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdsb2NhdGlvbicsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2N1cnJlbnRVc2VyLmZpeGVkQXNzZXRMb2NhdGlvbicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigndXNlcicsIGZ1bmN0aW9uKCRpdGVtKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGl0ZW0tPmN1cnJlbnRVc2VyID8gKCRpdGVtLT5jdXJyZW50VXNlci0+dXNlciA/ICRpdGVtLT5jdXJyZW50VXNlci0+dXNlci0+bmFtZSA6ICcnKSA6ICdOb3QgRGlzdHJpYnV0ZWQnOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCd1c2VyJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnY3VycmVudFVzZXIudXNlcicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigndXNpbmdfZnJvbScsIGZ1bmN0aW9uKCRpdGVtKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGl0ZW0tPmN1cnJlbnRVc2VyID8gJGl0ZW0tPmN1cnJlbnRVc2VyLT5mcm9tIC4nIC0gJy4oc3RydG90aW1lKCRpdGVtLT5jdXJyZW50VXNlci0+dG8pID4gMCA/ICRpdGVtLT5jdXJyZW50VXNlci0+dG8gOiAnTm93JykgOiAnTm90IERpc3RyaWJ1dGVkJyA7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3VzaW5nX2Zyb20nLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdjdXJyZW50VXNlcicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdmcm9tJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKS0+b3JXaGVyZSgndG8nLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdyZW1hcmtzJywgZnVuY3Rpb24oJGl0ZW0pewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkaXRlbS0+Y3VycmVudFVzZXIgPyAkaXRlbS0+Y3VycmVudFVzZXItPmdpdmluZ19yZW1hcmtzIDogJyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3JlbWFya3MnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCd1c2VycycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnZ2l2aW5nX3JlbWFya3MnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhY3Rpb25zJywgZnVuY3Rpb24oJGl0ZW0pewogICAgICAgICAgICAgICAgICAgICRhY3Rpb25zPScnOwogICAgICAgICAgICAgICAgICAgIGlmKCRpdGVtLT51c2Vycy0+Y291bnQoKSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICAkYWN0aW9ucy49JzxhIGNsYXNzPSJidG4gYnRuLXhzIGJ0bi1zdWNjZXNzIiBvbmNsaWNrPSJsb2FkSGlzdG9yeSgnLiRpdGVtLT5pZCAuJywgJy4gJGl0ZW0tPmFzc2V0X2NvZGUgLicpIj48aSBjbGFzcz0ibGFzIGxhLWZpbGUtYWx0Ij48L2k+Jm5ic3A7SGlzdG9yeTwvYT4nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGFjdGlvbnM7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsndXNpbmdfZnJvbScsJ2FjdGlvbnMnXSkKICAgICAgICAgICAgICAgIC0+bWFrZSh0cnVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGRhdGEgPSBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICR0aXRsZSwKICAgICAgICAgICAgICAgICdoZWFkZXJDb2x1bW5zJz0+JHRoaXMtPmhlYWRlckNvbHVtbnMoKQogICAgICAgICAgICBdOwogICAgICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLmZpeGVkQXNzZXRzLmZpeGVkQXNzZXRSZXBvcnRzLmZ4UmVwb3J0JywgJGRhdGEpOwogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEdldCBzdWJjYXRlZ29yeSBiYXNlZCBvbiBjYXRlZ29yeS4KICAgICAqCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwoKICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRTdWJDYXRlZ29yaWVzKCRpZCkKICAgIHsKICAgICAgICAkcmVzcG9uc2UgPSAnJzsKICAgICAgICAkc3ViQ2F0ZWdvcnk9Q2F0ZWdvcnk6OndoZW4oJGlkID4gMCwgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGlkKXsKICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3BhcmVudF9pZCcsJGlkKTsKICAgICAgICB9KQogICAgICAgIC8vIC0+d2hlcmUoZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAvLyAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX2ZpeGVkX2Fzc2V0JywgMSktPm9yV2hlcmUoJ2lzX2N3aXAnLCAxKTsKICAgICAgICAvLyB9KQogICAgICAgIC0+aGFzKCdwcm9kdWN0cy5yZXF1aXNpdGlvbkRlbGl2ZXJ5SXRlbS5iYXRjaGVzLml0ZW1zJykKICAgICAgICAtPmdldCgpOwoKICAgICAgICAkcmVzcG9uc2UgLj0gIjxvcHRpb24gdmFsdWU9JzAnPi1BbGwgQ2F0ZWdvcnktPC9vcHRpb24+IjsKICAgICAgICBpZiAoaXNzZXQoJHN1YkNhdGVnb3J5KSAmJiBjb3VudCgoYXJyYXkpJHN1YkNhdGVnb3J5KT4wKSB7CiAgICAgICAgICAgIGZvcmVhY2ggKCRzdWJDYXRlZ29yeSBhcyAkZGF0YSkgewogICAgICAgICAgICAgICAgJHJlc3BvbnNlLj0gJzxvcHRpb24gdmFsdWU9IicuJGRhdGEtPmlkLiciICcuKHJlcXVlc3QoKS0+Z2V0KCdzZWxlY3RlZCcpID09ICRkYXRhLT5pZCA/ICdzZWxlY3RlZCcgOiAnJykuJz4nLiRkYXRhLT5uYW1lLicoJy4kZGF0YS0+Y29kZS4nKScuJzwvb3B0aW9uPic7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuICRyZXNwb25zZTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBwcm9kdWN0IGJhc2VkIG9uIGNhdGVnb3J5LgogICAgICoKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCgogICAgcHVibGljIGZ1bmN0aW9uIGdldFByb2R1Y3RzKCRpZCkKICAgIHsKICAgICAgICAkcmVzcG9uc2UgPSAnJzsKICAgICAgICAkcHJvZHVjdHMgPSBQcm9kdWN0Ojp3aXRoKFsKICAgICAgICAgICAgJ2F0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScKICAgICAgICBdKQogICAgICAgIC0+d2hlbigkaWQ+MCwgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGlkKXsKICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2NhdGVnb3J5X2lkJywkaWQpOwogICAgICAgIH0pLT5oYXMoJ3JlcXVpc2l0aW9uRGVsaXZlcnlJdGVtLmJhdGNoZXMuaXRlbXMnKS0+Z2V0KCk7CgogICAgICAgICRyZXNwb25zZSAuPSAiPG9wdGlvbiB2YWx1ZT0nMCc+LUFsbCBQcm9kdWN0LTwvb3B0aW9uPiI7CiAgICAgICAgaWYgKCRwcm9kdWN0cy0+Y291bnQoKSA+IDApIHsKICAgICAgICAgICAgZm9yZWFjaCAoJHByb2R1Y3RzIGFzICRwcm9kdWN0KSB7CiAgICAgICAgICAgICAgICAkcmVzcG9uc2UuPSAnPG9wdGlvbiB2YWx1ZT0iJy4kcHJvZHVjdC0+aWQuJyIgJy4ocmVxdWVzdCgpLT5nZXQoJ3NlbGVjdGVkJykgPT0gJHByb2R1Y3QtPmlkID8gJ3NlbGVjdGVkJyA6ICcnKS4nPicuJHByb2R1Y3QtPm5hbWUuJyAnLmdldFByb2R1Y3RBdHRyaWJ1dGVzRmFzdGVyKCRwcm9kdWN0KS4nPC9vcHRpb24+JzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gJHJlc3BvbnNlOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IGJhdGNoZXMgYmFzZWQgb24gcHJvZHVjdCBpZC4KICAgICAqCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwoKICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRCYXRjaGVzKCRpZCkKICAgIHsKICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgJ2JhdGNoZXMnID0+IEZpeGVkQXNzZXRCYXRjaDo6aGFzKCdpdGVtcycpCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ3JlcXVpc2l0aW9uRGVsaXZlcnlJdGVtJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJGlkKXsKICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdwcm9kdWN0X2lkJywgJGlkKTsKICAgICAgICAgICAgfSktPmdldCgpLAogICAgICAgICAgICAnc2VsZWN0ZWQnID0+IHJlcXVlc3QoKS0+aGFzKCdzZWxlY3RlZCcpP3JlcXVlc3QoKS0+Z2V0KCdzZWxlY3RlZCcpOicnLAogICAgICAgIF07CiAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5maXhlZEFzc2V0cy5maXhlZEFzc2V0UmVwb3J0cy5iYXRjaGVzJywgJGRhdGEpOwogICAgfQoKICAgIC8qKgogICAgICogQ29zdCBjZW50ZXIgd2lzZSByZXBvcnQuCiAgICAgKgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAqLwoKICAgIHB1YmxpYyBmdW5jdGlvbiBDQ1JoZWFkZXJDb2x1bW5zKCkKICAgIHsKICAgICAgICAkcm93cyA9ICBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgICAgICBbJ2Fzc2V0JywgJ2Fzc2V0JywndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydHUk4nLCAnR1JOJywndGV4dC1sZWZ0J10sCiAgICAgICAgICAgIFsnYmF0Y2hfaWQnLCAnYmF0Y2hfaWQnLCAndGV4dC1sZWZ0J10sIAogICAgICAgICAgICBbJ2Fzc2V0X2NvZGUnLCAnYXNzZXRfY29kZScsICd0ZXh0LWxlZnQnXSwgCiAgICAgICAgICAgIFsnY29zdF9jZW50cmUnLCAnY29zdF9jZW50cmUnLCAndGV4dC1sZWZ0J10sCiAgICAgICAgICAgIFsnbG9jYXRpb24nLCAnbG9jYXRpb24nLCAndGV4dC1sZWZ0J10sCiAgICAgICAgICAgIFsndXNlcicsICd1c2VyJywgJ3RleHQtbGVmdCddLAogICAgICAgICAgICBbJ3VzaW5nX2Zyb20nLCAndXNpbmdfZnJvbScsICd0ZXh0LWxlZnQnXSwgCiAgICAgICAgICAgIFsncmVtYXJrcycsICdyZW1hcmtzJywgJ3RleHQtbGVmdCddLAogICAgICAgICAgICBbJ2FjdGlvbnMnLCAnYWN0aW9ucycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuICRyb3dzOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBjb3N0Q2VudGVyV2lzZVJlcG9ydCgpCiAgICB7CiAgICAgICAgJHRpdGxlID0gJ1JlcG9ydCAtIENvc3QgQ2VudHJlIFdpc2UnOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgICRpdGVtcyA9IEZpeGVkQXNzZXRCYXRjaEl0ZW06OndpdGgoWwogICAgICAgICAgICAgICAgJ2ZpbmFsQXNzZXQuYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJywKICAgICAgICAgICAgICAgICdiYXRjaC5yZXF1aXNpdGlvbkRlbGl2ZXJ5SXRlbS5yZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LnJlbFJlcXVpc2l0aW9uJywKICAgICAgICAgICAgICAgICd1c2VycycsCiAgICAgICAgICAgICAgICAnY3VycmVudFVzZXIudXNlci5jb3N0Q2VudHJlJwogICAgICAgICAgICBdKQogICAgICAgICAgICAtPndoZXJlSGFzKCdiYXRjaC5jb3N0Q2VudHJlLnByb2ZpdENlbnRyZScsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdjb21wYW55X2lkJywgYXV0aCgpLT51c2VyKCktPmNvbXBhbmllcy0+cGx1Y2soJ2NvbXBhbnlfaWQnKS0+dG9BcnJheSgpKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT5ncm91cEJ5KCdhc3NldF9jb2RlJykKICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgnaWQnLCAnZGVzYycpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChyZXF1ZXN0KCktPmFqYXgoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIERhdGF0YWJsZXM6Om9mKCRpdGVtcykKICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2Fzc2V0JywgZnVuY3Rpb24oJGl0ZW0pewogICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkaXRlbS0+ZmluYWxBc3NldC0+bmFtZSkgPyAkaXRlbS0+ZmluYWxBc3NldC0+bmFtZS4nICcuZ2V0UHJvZHVjdEF0dHJpYnV0ZXNGYXN0ZXIoJGl0ZW0tPmZpbmFsQXNzZXQpIDogJyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2Fzc2V0JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnZmluYWxBc3NldCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignR1JOJywgZnVuY3Rpb24oJGl0ZW0pewogICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkaXRlbS0+YmF0Y2gtPmdvb2RzUmVjZWl2ZWRJdGVtc1N0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsR29vZHNSZWNlaXZlZE5vdGUtPmdybl9yZWZlcmVuY2Vfbm8pID8gJGl0ZW0tPmJhdGNoLT5nb29kc1JlY2VpdmVkSXRlbXNTdG9ja0luLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbEdvb2RzUmVjZWl2ZWROb3RlLT5ncm5fcmVmZXJlbmNlX25vIDogJyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ0dSTicsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2JhdGNoLmdvb2RzUmVjZWl2ZWRJdGVtc1N0b2NrSW4ucmVsR29vZHNSZWNlaXZlZEl0ZW1zLnJlbEdvb2RzUmVjZWl2ZWROb3RlJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2dybl9yZWZlcmVuY2Vfbm8nLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdiYXRjaF9pZCcsIGZ1bmN0aW9uKCRpdGVtKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJGl0ZW0tPmJhdGNoLT5iYXRjaCk/JGl0ZW0tPmJhdGNoLT5iYXRjaDonJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignYmF0Y2hfaWQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdiYXRjaCcsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdiYXRjaCcsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2Nvc3RfY2VudHJlJywgZnVuY3Rpb24oJGl0ZW0pewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkaXRlbS0+Y3VycmVudFVzZXIgJiYgJGl0ZW0tPmN1cnJlbnRVc2VyLT51c2VyICYmICRpdGVtLT5jdXJyZW50VXNlci0+dXNlci0+Y29zdENlbnRyZSA/ICRpdGVtLT5jdXJyZW50VXNlci0+dXNlci0+Y29zdENlbnRyZS0+bmFtZSA6ICdOb3QgRGlzdHJpYnV0ZWQnOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdjb3N0X2NlbnRyZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2N1cnJlbnRVc2VyLnVzZXIuY29zdENlbnRyZScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignbG9jYXRpb24nLCBmdW5jdGlvbigkaXRlbSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRpdGVtLT5jdXJyZW50VXNlciA/ICRpdGVtLT5jdXJyZW50VXNlci0+Zml4ZWRBc3NldExvY2F0aW9uLT5uYW1lIDogJ05vdCBEaXN0cmlidXRlZCc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2xvY2F0aW9uJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnY3VycmVudFVzZXIuZml4ZWRBc3NldExvY2F0aW9uJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCd1c2VyJywgZnVuY3Rpb24oJGl0ZW0pewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkaXRlbS0+Y3VycmVudFVzZXIgPyAoJGl0ZW0tPmN1cnJlbnRVc2VyLT51c2VyID8gJGl0ZW0tPmN1cnJlbnRVc2VyLT51c2VyLT5uYW1lIDogJycpIDogJ05vdCBEaXN0cmlidXRlZCc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3VzZXInLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdjdXJyZW50VXNlci51c2VyJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCd1c2luZ19mcm9tJywgZnVuY3Rpb24oJGl0ZW0pewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkaXRlbS0+Y3VycmVudFVzZXIgPyAkaXRlbS0+Y3VycmVudFVzZXItPmZyb20gLicgLSAnLihzdHJ0b3RpbWUoJGl0ZW0tPmN1cnJlbnRVc2VyLT50bykgPiAwID8gJGl0ZW0tPmN1cnJlbnRVc2VyLT50byA6ICdOb3cnKSA6ICdOb3QgRGlzdHJpYnV0ZWQnIDsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigndXNpbmdfZnJvbScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2N1cnJlbnRVc2VyJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2Zyb20nLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpLT5vcldoZXJlKCd0bycsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3JlbWFya3MnLCBmdW5jdGlvbigkaXRlbSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRpdGVtLT5jdXJyZW50VXNlciA/ICRpdGVtLT5jdXJyZW50VXNlci0+Z2l2aW5nX3JlbWFya3MgOiAnJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigncmVtYXJrcycsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3VzZXJzJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdnaXZpbmdfcmVtYXJrcycsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FjdGlvbnMnLCBmdW5jdGlvbigkaXRlbSl7CiAgICAgICAgICAgICAgICAgICAgJGFjdGlvbnM9Jyc7CiAgICAgICAgICAgICAgICAgICAgaWYoJGl0ZW0tPnVzZXJzLT5jb3VudCgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb25zLj0nPGEgY2xhc3M9ImJ0biBidG4teHMgYnRuLXN1Y2Nlc3MiIG9uY2xpY2s9ImxvYWRIaXN0b3J5KCcuJGl0ZW0tPmlkIC4nLCAnLiAkaXRlbS0+YXNzZXRfY29kZSAuJykiPjxpIGNsYXNzPSJsYXMgbGEtZmlsZS1hbHQiPjwvaT4mbmJzcDtIaXN0b3J5PC9hPic7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHJldHVybiAkYWN0aW9uczsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPnJhd0NvbHVtbnMoWyd1c2luZ19mcm9tJywnYWN0aW9ucyddKQogICAgICAgICAgICAgICAgLT5tYWtlKHRydWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJHRpdGxlLAogICAgICAgICAgICAgICAgJ2hlYWRlckNvbHVtbnMnPT4kdGhpcy0+Q0NSaGVhZGVyQ29sdW1ucygpCiAgICAgICAgICAgIF07CiAgICAgICAgICAgIHJldHVybiB2aWV3KCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMuZml4ZWRBc3NldHMuZml4ZWRBc3NldFJlcG9ydHMuY29zdENlbnRlclJlcG9ydCcsICRkYXRhKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogU2V0IGdsb2JhbCBkYXRhIHRhYmxlIGhlYWRlcnMuCiAgICAgKgogICAgICogQHJldHVybiBoZWFkZXJDb2x1bW5zCiAgICAgKi8KICAgICBwdWJsaWMgZnVuY3Rpb24gUEhlYWRlckNvbHVtbnMoJHZhbHVlPScnKQogICAgIHsKICAgICAgICAkcm93cyA9ICBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgICAgICBbJ2Fzc2V0JywgJ2Fzc2V0JywndGV4dC1sZWZ0J10sCiAgICAgICAgICAgIFsnR1JOJywgJ0dSTicsJ3RleHQtbGVmdCddLAogICAgICAgICAgICBbJ2JhdGNoX2lkJywgJ2JhdGNoX2lkJywgJ3RleHQtY2VudGVyJ10sIAogICAgICAgICAgICBbJ2Fzc2V0X2NvZGUnLCAnYXNzZXRfY29kZScsICd0ZXh0LWNlbnRlciddLCAKICAgICAgICAgICAgWydsb2NhdGlvbicsICdsb2NhdGlvbicsICd0ZXh0LWxlZnQnXSwKICAgICAgICAgICAgWyd1c2VyJywgJ3VzZXInLCAndGV4dC1sZWZ0J10sCiAgICAgICAgICAgIFsnaW5zcGVjdG9yJywgJ2luc3BlY3RvcicsICd0ZXh0LWxlZnQnXSwgCiAgICAgICAgICAgIFsnZGF0ZScsICdkYXRlJywgJ3RleHQtbGVmdCddLAogICAgICAgICAgICBbJ3RpbWUnLCAndGltZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3JlbWFya3MnLCAncmVtYXJrcycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3JhdGluZ3MnLCAncmF0aW5ncycsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2ltYWdlJywgJ2ltYWdlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gJHJvd3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBGaXhlZCBhc3NldCBwaHlzaWNhbCBzdGF0dXMgcmVwb3J0LgogICAgICoKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgKi8KCiAgICBwdWJsaWMgZnVuY3Rpb24gcGh5c2ljYWxTdGF0dXNSZXBvcnQoKQogICAgewogICAgICAgICR0aXRsZSA9ICdGaXhlZCBBc3NldCBQaHlzaWNhbCBTdGF0dXMgUmVwb3J0JzsKICAgICAgICB0cnkgewogICAgICAgICAgICAkaW5zcGVjdGlvbnMgPSBGaXhlZEFzc2V0SXRlbVBoeXNpY2FsU3RhdHVzOjp3aXRoKFsKICAgICAgICAgICAgICAgICdiYXRjaEl0ZW0uZmluYWxBc3NldC5hdHRyaWJ1dGVzLmF0dHJpYnV0ZU9wdGlvbi5hdHRyaWJ1dGUnLAogICAgICAgICAgICAgICAgJ2JhdGNoSXRlbS5iYXRjaC5yZXF1aXNpdGlvbkRlbGl2ZXJ5SXRlbS5yZWxSZXF1aXNpdGlvbkRlbGl2ZXJ5LnJlbFJlcXVpc2l0aW9uJywKICAgICAgICAgICAgICAgICd1c2VyJywKICAgICAgICAgICAgICAgICdpbnNwZWN0b3InCiAgICAgICAgICAgIF0pCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ2JhdGNoSXRlbS5iYXRjaC5jb3N0Q2VudHJlLnByb2ZpdENlbnRyZScsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdjb21wYW55X2lkJywgYXV0aCgpLT51c2VyKCktPmNvbXBhbmllcy0+cGx1Y2soJ2NvbXBhbnlfaWQnKS0+dG9BcnJheSgpKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgnaWQnLCAnZGVzYycpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChyZXF1ZXN0KCktPmFqYXgoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIERhdGF0YWJsZXM6Om9mKCRpbnNwZWN0aW9ucykKICAgICAgICAgICAgICAgIC0+YWRkSW5kZXhDb2x1bW4oKQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2Fzc2V0JywgZnVuY3Rpb24oJGluc3BlY3Rpb24pewogICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkaW5zcGVjdGlvbi0+YmF0Y2hJdGVtLT5maW5hbEFzc2V0LT5uYW1lKSA/ICRpbnNwZWN0aW9uLT5iYXRjaEl0ZW0tPmZpbmFsQXNzZXQtPm5hbWUuJyAnLmdldFByb2R1Y3RBdHRyaWJ1dGVzRmFzdGVyKCRpbnNwZWN0aW9uLT5iYXRjaEl0ZW0tPmZpbmFsQXNzZXQpIDogJyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2Fzc2V0JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnYmF0Y2hJdGVtLmZpbmFsQXNzZXQnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ0dSTicsIGZ1bmN0aW9uKCRpbnNwZWN0aW9uKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJGluc3BlY3Rpb24tPmJhdGNoSXRlbS0+YmF0Y2gtPmdvb2RzUmVjZWl2ZWRJdGVtc1N0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsR29vZHNSZWNlaXZlZE5vdGUtPmdybl9yZWZlcmVuY2Vfbm8pID8gJGluc3BlY3Rpb24tPmJhdGNoSXRlbS0+YmF0Y2gtPmdvb2RzUmVjZWl2ZWRJdGVtc1N0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsR29vZHNSZWNlaXZlZE5vdGUtPmdybl9yZWZlcmVuY2Vfbm8gOiAnJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignR1JOJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnYmF0Y2hJdGVtLmJhdGNoLmdvb2RzUmVjZWl2ZWRJdGVtc1N0b2NrSW4ucmVsR29vZHNSZWNlaXZlZEl0ZW1zLnJlbEdvb2RzUmVjZWl2ZWROb3RlJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2dybl9yZWZlcmVuY2Vfbm8nLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdiYXRjaF9pZCcsIGZ1bmN0aW9uKCRpbnNwZWN0aW9uKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJGluc3BlY3Rpb24tPmJhdGNoSXRlbS0+YmF0Y2gtPmJhdGNoKT8kaW5zcGVjdGlvbi0+YmF0Y2hJdGVtLT5iYXRjaC0+YmF0Y2g6Jyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2JhdGNoX2lkJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnYmF0Y2hJdGVtLmJhdGNoJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2JhdGNoJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYXNzZXRfY29kZScsIGZ1bmN0aW9uKCRpbnNwZWN0aW9uKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJGluc3BlY3Rpb24tPmJhdGNoSXRlbS0+YXNzZXRfY29kZSk/JGluc3BlY3Rpb24tPmJhdGNoSXRlbS0+YXNzZXRfY29kZTonJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignYXNzZXRfY29kZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2JhdGNoSXRlbScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdhc3NldF9jb2RlJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignbG9jYXRpb24nLCBmdW5jdGlvbigkaW5zcGVjdGlvbil7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRpbnNwZWN0aW9uLT5maXhlZEFzc2V0TG9jYXRpb24gPyAkaW5zcGVjdGlvbi0+Zml4ZWRBc3NldExvY2F0aW9uLT5uYW1lIDogJ05vdCBEaXN0cmlidXRlZCc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2xvY2F0aW9uJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnZml4ZWRBc3NldExvY2F0aW9uJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCd1c2VyJywgZnVuY3Rpb24oJGluc3BlY3Rpb24pewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkaW5zcGVjdGlvbi0+dXNlciA/ICRpbnNwZWN0aW9uLT51c2VyLT5uYW1lIDogJ05vdCBEaXN0cmlidXRlZCc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ3VzZXInLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCd1c2VyJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigndXNlcicsIGZ1bmN0aW9uKCRpbnNwZWN0aW9uKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGluc3BlY3Rpb24tPnVzZXIgPyAkaW5zcGVjdGlvbi0+dXNlci0+bmFtZSA6ICcnOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCd1c2VyJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygndXNlcicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignaW5zcGVjdG9yJywgZnVuY3Rpb24oJGluc3BlY3Rpb24pewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkaW5zcGVjdGlvbi0+aW5zcGVjdG9yID8gJGluc3BlY3Rpb24tPmluc3BlY3Rvci0+bmFtZSA6ICcnOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdpbnNwZWN0b3InLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdpbnNwZWN0b3InLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCd0aW1lJywgZnVuY3Rpb24oJGluc3BlY3Rpb24pewogICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlKCdnOmkgYScsIHN0cnRvdGltZSgkaW5zcGVjdGlvbi0+dGltZSkpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbignaW1hZ2UnLCBmdW5jdGlvbigkaW5zcGVjdGlvbil7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICFlbXB0eSgkaW5zcGVjdGlvbi0+aW1hZ2UpICYmIGZpbGVfZXhpc3RzKCRpbnNwZWN0aW9uLT5pbWFnZSkgPyAnPGEgY2xhc3M9ImJ0biBidG4teHMgYnRuLXByaW1hcnkiIGhyZWY9IicudXJsKCRpbnNwZWN0aW9uLT5pbWFnZSkuJyIgdGFyZ2V0PSJfYmxhbmsiPjxpIGNsYXNzPSJsYSBsYS1pbWFnZSI+PC9pPjwvYT4nIDogJyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsnaW1hZ2UnXSkKICAgICAgICAgICAgICAgIC0+bWFrZSh0cnVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGRhdGEgPSBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICR0aXRsZSwKICAgICAgICAgICAgICAgICdoZWFkZXJDb2x1bW5zJyA9PiAkdGhpcy0+UEhlYWRlckNvbHVtbnMoKSwKICAgICAgICAgICAgXTsKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5maXhlZEFzc2V0cy5maXhlZEFzc2V0UmVwb3J0cy5waHlzaWNhbFN0YXR1c1JlcG9ydCcsICRkYXRhKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aEVycm9yKCR0aC0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQb3N0ZWQgRml4ZWQgYXNzZXQgbW92ZW1lbnQgc3RhdHVzIHJlcG9ydC4KICAgICAqCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICovCgogICAgcHVibGljIGZ1bmN0aW9uIFBGQU1IZWFkZXJDb2x1bW5zKCR2YWx1ZT0nJykKICAgICB7CiAgICAgICAgJHJvd3MgPSAgYXJyYXkoCiAgICAgICAgICAgIFsnU0wnLCAnU0wnXSwKICAgICAgICAgICAgWydhc3NldCcsICdhc3NldCcsJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnR1JOJywgJ0dSTicsJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnYmF0Y2hfaWQnLCAnYmF0Y2hfaWQnLCAndGV4dC1jZW50ZXInXSwgCiAgICAgICAgICAgIFsnYXNzZXRfY29kZScsICdhc3NldF9jb2RlJywgJ3RleHQtY2VudGVyJ10sIAogICAgICAgICAgICBbJ3JlcXVlc3RlZF9ieScsICdyZXF1ZXN0ZWRfYnknLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydsb2NhdGlvbicsICdsb2NhdGlvbicsICd0ZXh0LWNlbnRlciddLCAKICAgICAgICAgICAgWydtb3ZlX3RvJywgJ21vdmVfdG8nLCAndGV4dC1jZW50ZXInXSwgCiAgICAgICAgICAgIFsnYWN0aW9ucycsICdhY3Rpb25zJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gJHJvd3M7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHBvc3RlZEZBTW92ZW1lbnRTdGF0dXNSZXBvcnQoKQogICAgewogICAgICAgICR0aXRsZSA9ICdQb3N0ZWQgRml4ZWQgQXNzZXQgTW92ZW1lbnQgU3RhdHVzIFJlcG9ydCc7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJG1vdmVtZW50cyA9IEZpeGVkQXNzZXRJdGVtTW92ZW1lbnQ6OndpdGgoWwogICAgICAgICAgICAgICAgJ2JhdGNoSXRlbVVzZXIuYmF0Y2hJdGVtLmZpbmFsQXNzZXQuYXR0cmlidXRlcy5hdHRyaWJ1dGVPcHRpb24uYXR0cmlidXRlJywKICAgICAgICAgICAgICAgICdiYXRjaEl0ZW1Vc2VyLmJhdGNoSXRlbS5iYXRjaC5nb29kc1JlY2VpdmVkSXRlbXNTdG9ja0luLnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy5yZWxHb29kc1JlY2VpdmVkTm90ZScsCiAgICAgICAgICAgICAgICAnYmF0Y2hJdGVtVXNlci51c2VyJywKICAgICAgICAgICAgICAgICd1c2VyJwogICAgICAgICAgICBdKQogICAgICAgICAgICAtPndoZXJlSGFzKCdiYXRjaEl0ZW1Vc2VyLmJhdGNoSXRlbS5iYXRjaC5jb3N0Q2VudHJlLnByb2ZpdENlbnRyZScsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUluKCdjb21wYW55X2lkJywgYXV0aCgpLT51c2VyKCktPmNvbXBhbmllcy0+cGx1Y2soJ2NvbXBhbnlfaWQnKS0+dG9BcnJheSgpKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKCFkYXRhdGFibGVPcmRlcmluZygpLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgnaWQnLCAnZGVzYycpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChyZXF1ZXN0KCktPmFqYXgoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIERhdGF0YWJsZXM6Om9mKCRtb3ZlbWVudHMpCiAgICAgICAgICAgICAgICAtPmFkZEluZGV4Q29sdW1uKCkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhc3NldCcsIGZ1bmN0aW9uKCRtb3ZlbWVudCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCRtb3ZlbWVudC0+YmF0Y2hJdGVtVXNlci0+YmF0Y2hJdGVtLT5maW5hbEFzc2V0LT5uYW1lKSA/ICRtb3ZlbWVudC0+YmF0Y2hJdGVtVXNlci0+YmF0Y2hJdGVtLT5maW5hbEFzc2V0LT5uYW1lLicgJy5nZXRQcm9kdWN0QXR0cmlidXRlc0Zhc3RlcigkbW92ZW1lbnQtPmJhdGNoSXRlbVVzZXItPmJhdGNoSXRlbS0+ZmluYWxBc3NldCkgOiAnJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignYXNzZXQnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdiYXRjaEl0ZW1Vc2VyLmJhdGNoSXRlbS5maW5hbEFzc2V0JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdHUk4nLCBmdW5jdGlvbigkbW92ZW1lbnQpewogICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkbW92ZW1lbnQtPmJhdGNoSXRlbVVzZXItPmJhdGNoSXRlbS0+YmF0Y2gtPmdvb2RzUmVjZWl2ZWRJdGVtc1N0b2NrSW4tPnJlbEdvb2RzUmVjZWl2ZWRJdGVtcy0+cmVsR29vZHNSZWNlaXZlZE5vdGUtPmdybl9yZWZlcmVuY2Vfbm8pID8gJG1vdmVtZW50LT5iYXRjaEl0ZW1Vc2VyLT5iYXRjaEl0ZW0tPmJhdGNoLT5nb29kc1JlY2VpdmVkSXRlbXNTdG9ja0luLT5yZWxHb29kc1JlY2VpdmVkSXRlbXMtPnJlbEdvb2RzUmVjZWl2ZWROb3RlLT5ncm5fcmVmZXJlbmNlX25vIDogJyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ0dSTicsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2JhdGNoSXRlbVVzZXIuYmF0Y2hJdGVtLmJhdGNoLmdvb2RzUmVjZWl2ZWRJdGVtc1N0b2NrSW4ucmVsR29vZHNSZWNlaXZlZEl0ZW1zLnJlbEdvb2RzUmVjZWl2ZWROb3RlJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2dybl9yZWZlcmVuY2Vfbm8nLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdiYXRjaF9pZCcsIGZ1bmN0aW9uKCRtb3ZlbWVudCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCRtb3ZlbWVudC0+YmF0Y2hJdGVtVXNlci0+YmF0Y2hJdGVtLT5iYXRjaC0+YmF0Y2gpPyRtb3ZlbWVudC0+YmF0Y2hJdGVtVXNlci0+YmF0Y2hJdGVtLT5iYXRjaC0+YmF0Y2g6Jyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2JhdGNoX2lkJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnYmF0Y2hJdGVtVXNlci5iYXRjaEl0ZW0uYmF0Y2gnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnYmF0Y2gnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhc3NldF9jb2RlJywgZnVuY3Rpb24oJG1vdmVtZW50KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXNzZXQoJG1vdmVtZW50LT5iYXRjaEl0ZW1Vc2VyLT5iYXRjaEl0ZW0tPmFzc2V0X2NvZGUpPyRtb3ZlbWVudC0+YmF0Y2hJdGVtVXNlci0+YmF0Y2hJdGVtLT5hc3NldF9jb2RlOicnOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdhc3NldF9jb2RlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnYmF0Y2hJdGVtVXNlci5iYXRjaEl0ZW0nLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnYXNzZXRfY29kZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ3JlcXVlc3RlZF9ieScsIGZ1bmN0aW9uKCRtb3ZlbWVudCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRtb3ZlbWVudC0+YmF0Y2hJdGVtVXNlci0+dXNlci0+bmFtZS4nICgnLiRtb3ZlbWVudC0+YmF0Y2hJdGVtVXNlci0+dXNlci0+cGhvbmUuJyknOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdyZXF1ZXN0ZWRfYnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdiYXRjaEl0ZW1Vc2VyLnVzZXInLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdsb2NhdGlvbicsIGZ1bmN0aW9uKCRtb3ZlbWVudCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRtb3ZlbWVudC0+Zml4ZWRBc3NldExvY2F0aW9uLT5uYW1lLicgKCcuJG1vdmVtZW50LT5maXhlZEFzc2V0TG9jYXRpb24tPnBob25lLicpJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignbG9jYXRpb24nLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdmaXhlZEFzc2V0TG9jYXRpb24nLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdtb3ZlX3RvJywgZnVuY3Rpb24oJG1vdmVtZW50KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJG1vdmVtZW50LT51c2VyID8gJG1vdmVtZW50LT51c2VyLT5uYW1lLicgKCcuJG1vdmVtZW50LT51c2VyLT5waG9uZS4nKScgOiAnJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignbW92ZV90bycsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ3VzZXInLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdhY3Rpb25zJywgZnVuY3Rpb24oJG1vdmVtZW50KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGNsYXNzPSJtYi0xIGJ0biBidG4teHMgYnRuLWRhcmsiPk1vdmVtZW50ICcuIHVjd29yZHMoJG1vdmVtZW50LT5zdGF0dXMpLic8L2E+JzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPnJhd0NvbHVtbnMoWydyZXF1ZXN0ZWRfYnknLCAnbW92ZV90bycsICdhY3Rpb25zJ10pCiAgICAgICAgICAgICAgICAtPm1ha2UodHJ1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAkdGl0bGUsCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucyc9PiR0aGlzLT5QRkFNSGVhZGVyQ29sdW1ucygpLAogICAgICAgICAgICBdOwogICAgICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLmZpeGVkQXNzZXRzLmZpeGVkQXNzZXRSZXBvcnRzLnBvc3RlZEZBTW92ZW1lbnRTdGF0dXNSZXBvcnQnLCAkZGF0YSk7CiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQoKICAgIH0KCn0K