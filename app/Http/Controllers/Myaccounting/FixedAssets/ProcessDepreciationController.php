<?php
bolt_decrypt( __FILE__ , 'eJkV7Y'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcTXlhY2NvdW50aW5nXEZpeGVkQXNzZXRzOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKCnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQ29tcGFueTsKdXNlIEFwcFxNb2RlbHNcRml4ZWRBc3NldHNcRml4ZWRBc3NldEJhdGNoOwp1c2UgQXBwXE1vZGVsc1xGaXhlZEFzc2V0c1xGaXhlZEFzc2V0QmF0Y2hJdGVtOwp1c2UgQXBwXE1vZGVsc1xGaXhlZEFzc2V0c1xGaXhlZEFzc2V0QmF0Y2hJdGVtRGVwcmVjaWF0aW9uOwp1c2UgQXBwXE1vZGVsc1xGaXhlZEFzc2V0c1xGaXhlZEFzc2V0QmF0Y2hVc2VyOwp1c2UgQXBwXFVzZXI7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xDYXRlZ29yeTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXFByb2R1Y3Q7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDb3N0Q2VudHJlOwoKdXNlIEFwcCwgREI7CnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xBdXRoOwoKY2xhc3MgUHJvY2Vzc0RlcHJlY2lhdGlvbkNvbnRyb2xsZXIgZXh0ZW5kcyBDb250cm9sbGVyCnsKICAgIHB1YmxpYyBmdW5jdGlvbiBpbmRleCgpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJHVzZXJJZCA9IGF1dGgoKS0+dXNlcigpLT5pZDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEZldGNoIGNvbW1vbiBjb21wYW55IGRhdGEgZm9yIGJvdGggY2FzZXMKICAgICAgICAgICAgJGNvbXBhbmllcyA9IENvbXBhbnk6OmhhcygncHJvZml0Q2VudHJlcy5jb3N0Q2VudHJlcycpCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCd1c2VycycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHVzZXJJZCkgewogICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ3VzZXJfaWQnLCAkdXNlcklkKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmdldCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHJlcXVlc3QoKS0+Z2V0KCdhY3Rpb24nKSA9PT0gJ2l0ZW1zJykgewogICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBkZXByZWNpYXRpb24gZGF0ZSByYW5nZQogICAgICAgICAgICAgICAgJGZyb20gPSBkYXRlKCdZLW0tMDEnLCBzdHJ0b3RpbWUocmVxdWVzdCgpLT5nZXQoJ3llYXInKSAuICctJyAuIHJlcXVlc3QoKS0+Z2V0KCdtb250aCcpKSk7CiAgICAgICAgICAgICAgICAkdG8gPSBkYXRlKCdZLW0tdCcsIHN0cnRvdGltZShyZXF1ZXN0KCktPmdldCgneWVhcicpIC4gJy0nIC4gcmVxdWVzdCgpLT5nZXQoJ21vbnRoJykpKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gQmFzZSBxdWVyeSBjb25kaXRpb25zCiAgICAgICAgICAgICAgICAkYmFzZVF1ZXJ5ID0gRml4ZWRBc3NldEJhdGNoSXRlbTo6d2l0aChbCiAgICAgICAgICAgICAgICAgICAgJ2JhdGNoLmNvc3RDZW50cmUucHJvZml0Q2VudHJlJywKICAgICAgICAgICAgICAgICAgICAnYmF0Y2guZ29vZHNSZWNlaXZlZEl0ZW1zU3RvY2tJbi5yZWxQdXJjaGFzZU9yZGVyLnJlbFF1b3RhdGlvbi5leGNoYW5nZVJhdGUuY3VycmVuY3knLAogICAgICAgICAgICAgICAgICAgICdmaW5hbEFzc2V0JwogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdiYXRjaC5jb3N0Q2VudHJlLnByb2ZpdENlbnRyZScsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnY29tcGFueV9pZCcsIHJlcXVlc3QoKS0+Z2V0KCdjb21wYW55X2lkJykpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT53aGVuKHJlcXVlc3QoKS0+Z2V0KCdwcm9kdWN0X2lkJykgPiAwLCBmdW5jdGlvbiAoJHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2ZpbmFsX2Fzc2V0X2lkJywgcmVxdWVzdCgpLT5nZXQoJ3Byb2R1Y3RfaWQnKSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlRG9lc250SGF2ZSgnZGVwcmVjaWF0aW9ucycsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGZyb20sICR0bykgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdmcm9tJywgJGZyb20pLT53aGVyZSgndG8nLCAkdG8pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZUhhcygnYmF0Y2gnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCR0bykgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdkZXByZWNpYXRpb25fc3RhcnRfZGF0ZScsICc8PScsICR0byk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlKCdpc19kaXNwb3NlZCcsIDApOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBQYWdpbmF0ZWQgZmluYWwgYXNzZXRzCiAgICAgICAgICAgICAgICAkZmluYWxBc3NldHMgPSAkYmFzZVF1ZXJ5LT5ncm91cEJ5KCdhc3NldF9jb2RlJyktPnBhZ2luYXRlKDIwMCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIE5vbi1wYWdpbmF0ZWQgaXRlbXMgZm9yIG90aGVyIHByb2Nlc3NpbmcKICAgICAgICAgICAgICAgICRpdGVtcyA9ICRiYXNlUXVlcnktPmdldCgpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBEYXRhIGZvciB0aGUgdmlldwogICAgICAgICAgICAgICAgJGRhdGEgPSBbCiAgICAgICAgICAgICAgICAgICAgJ2Zyb20nID0+ICRmcm9tLAogICAgICAgICAgICAgICAgICAgICd0bycgPT4gJHRvLAogICAgICAgICAgICAgICAgICAgICdmaW5hbEFzc2V0cycgPT4gJGZpbmFsQXNzZXRzLAogICAgICAgICAgICAgICAgICAgICdpdGVtcycgPT4gJGl0ZW1zLAogICAgICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJ1Byb2Nlc3MgRGVwcmVjaWF0aW9uJywKICAgICAgICAgICAgICAgICAgICAnY29tcGFuaWVzJyA9PiAkY29tcGFuaWVzLAogICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5maXhlZEFzc2V0cy5wcm9jZXNzRGVwcmVjaWF0aW9uLmluZGV4JywgJGRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBEZWZhdWx0IHZpZXcgZGF0YQogICAgICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLmZpeGVkQXNzZXRzLnByb2Nlc3NEZXByZWNpYXRpb24uaW5kZXgnLCBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICdQcm9jZXNzIERlcHJlY2lhdGlvbicsCiAgICAgICAgICAgICAgICAnY29tcGFuaWVzJyA9PiAkY29tcGFuaWVzLAogICAgICAgICAgICBdKTsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICAvLyBSZXR1cm4gd2l0aCBhIG1lYW5pbmdmdWwgZXJyb3IgbWVzc2FnZQogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmJhY2tXaXRoRXJyb3IoJHRoLT5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcHVibGljIGZ1bmN0aW9uIHBhZ2luYXRlTG9hZERhdGEoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAKICAgICAgICAkZnJvbSA9IGRhdGUoJ1ktbS0wMScsIHN0cnRvdGltZSgkcmVxdWVzdC0+Z2V0KCd5ZWFyJykgLiAnLScgLiAkcmVxdWVzdC0+Z2V0KCdtb250aCcpKSk7CiAgICAgICAgJHRvID0gZGF0ZSgnWS1tLXQnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPmdldCgneWVhcicpIC4gJy0nIC4gJHJlcXVlc3QtPmdldCgnbW9udGgnKSkpOwogICAgICAgIAogICAgICAgICRiYXNlUXVlcnkgPSBGaXhlZEFzc2V0QmF0Y2hJdGVtOjp3aXRoKFsKICAgICAgICAgICAgJ2JhdGNoLmNvc3RDZW50cmUucHJvZml0Q2VudHJlJywKICAgICAgICAgICAgJ2JhdGNoLmdvb2RzUmVjZWl2ZWRJdGVtc1N0b2NrSW4ucmVsUHVyY2hhc2VPcmRlci5yZWxRdW90YXRpb24uZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywKICAgICAgICAgICAgJ2ZpbmFsQXNzZXQnCiAgICAgICAgXSkKICAgICAgICAgICAgLT53aGVyZUhhcygnYmF0Y2guY29zdENlbnRyZS5wcm9maXRDZW50cmUnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRyZXF1ZXN0KSB7CiAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdjb21wYW55X2lkJywgJHJlcXVlc3QtPmdldCgnY29tcGFueV9pZCcpKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVuKCRyZXF1ZXN0LT5nZXQoJ3Byb2R1Y3RfaWQnKSA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHJlcXVlc3QpIHsKICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2ZpbmFsX2Fzc2V0X2lkJywgJHJlcXVlc3QtPmdldCgncHJvZHVjdF9pZCcpKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZURvZXNudEhhdmUoJ2RlcHJlY2lhdGlvbnMnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRmcm9tLCAkdG8pIHsKICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2Zyb20nLCAkZnJvbSktPndoZXJlKCd0bycsICR0byk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+d2hlcmVIYXMoJ2JhdGNoJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgkdG8pIHsKICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ2RlcHJlY2lhdGlvbl9zdGFydF9kYXRlJywgJzw9JywgJHRvKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLT53aGVyZSgnaXNfZGlzcG9zZWQnLCAwKTsKICAgICAgICAKICAgICAgICBpZiAoJHJlcXVlc3QtPmFqYXgoKSkgewogICAgICAgICAgICAkcGFnZSA9ICRyZXF1ZXN0LT5pbnB1dCgncGFnZScsIDEpOwogICAgICAgICAgICAkZmluYWxBc3NldHMgPSAoY2xvbmUgJGJhc2VRdWVyeSkKICAgICAgICAgICAgICAgIC0+Z3JvdXBCeSgnYXNzZXRfY29kZScpCiAgICAgICAgICAgICAgICAtPnBhZ2luYXRlKDIwMCwgWycqJ10sICdwYWdlJywgJHBhZ2UpOwogICAgICAgICAgICAKICAgICAgICAgICAgJGl0ZW1zID0gJGJhc2VRdWVyeS0+Z2V0KCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAkYXNzZXRzRGF0YSA9IFtdOwogICAgICAgICAgICAkcGFnZVRvdGFsQW1vdW50ID0gMDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvcmVhY2ggKCRmaW5hbEFzc2V0cyBhcyAkYXNzZXQpIHsKICAgICAgICAgICAgICAgICRhbW91bnQgPSAwOwogICAgICAgICAgICAgICAgZm9yZWFjaCAoJGl0ZW1zLT53aGVyZSgnYXNzZXRfY29kZScsICRhc3NldC0+YXNzZXRfY29kZSkgYXMgJGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAkYW1vdW50ICs9IGNhbGN1bGF0ZURlcHJlY2lhdGlvbkFtb3VudCgkaXRlbSwgJGZyb20sICR0byk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkcGFnZVRvdGFsQW1vdW50ICs9ICRhbW91bnQ7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICRhc3NldHNEYXRhW10gPSBbCiAgICAgICAgICAgICAgICAgICAgJ2Fzc2V0X2NvZGUnID0+ICRhc3NldC0+YXNzZXRfY29kZSwKICAgICAgICAgICAgICAgICAgICAnZmluYWxfYXNzZXQnID0+IFsKICAgICAgICAgICAgICAgICAgICAgICAgJ25hbWUnID0+ICRhc3NldC0+ZmluYWxBc3NldC0+bmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2F0dHJpYnV0ZXMnID0+IGdldFByb2R1Y3RBdHRyaWJ1dGVzRmFzdGVyKCRhc3NldC0+ZmluYWxBc3NldCksCiAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICAgICAnYmF0Y2gnID0+IFsKICAgICAgICAgICAgICAgICAgICAgICAgJ2JhdGNoJyA9PiAkYXNzZXQtPmJhdGNoLT5iYXRjaCwKICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgICAgICdjdXJyZW5jeV9jb2RlJyA9PiAkYXNzZXQtPmJhdGNoLT5nb29kc1JlY2VpdmVkSXRlbXNTdG9ja0luLT5yZWxQdXJjaGFzZU9yZGVyLT5yZWxRdW90YXRpb24tPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPmNvZGUsCiAgICAgICAgICAgICAgICAgICAgJ2RlcHJlY2lhdGlvbl9yYXRlJyA9PiBzeXN0ZW1Nb25leUZvcm1hdCgkYXNzZXQtPmRlcHJlY2lhdGlvbl9yYXRlKSAuICclJywKICAgICAgICAgICAgICAgICAgICAnYW1vdW50JyA9PiBzeXN0ZW1Nb25leUZvcm1hdCgkYW1vdW50KSwKICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdhc3NldHMnID0+ICRhc3NldHNEYXRhLAogICAgICAgICAgICAgICAgJ25leHRfcGFnZScgPT4gJGZpbmFsQXNzZXRzLT5oYXNNb3JlUGFnZXMoKSA/ICRmaW5hbEFzc2V0cy0+Y3VycmVudFBhZ2UoKSArIDEgOiBudWxsLAogICAgICAgICAgICAgICAgJ3BhZ2VfdG90YWxfYW1vdW50JyA9PiAkcGFnZVRvdGFsQW1vdW50LAogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHB1YmxpYyBmdW5jdGlvbiBjcmVhdGUoKQogICAgewogICAgICAgIGlmIChyZXF1ZXN0KCktPmhhcygnZ2V0LXByb2R1Y3RzJykpIHsKICAgICAgICAgICAgJGNhdGVnb3JpZXMgPSBDYXRlZ29yeTo6d2hlcmVIYXMoJ3Byb2R1Y3RzLmZpeGVkQXNzZXRCYXRjaEl0ZW1zJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX2Rpc3Bvc2VkJywgMCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmdldCgpOwogICAgICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLmZpeGVkQXNzZXRzLnByb2Nlc3NEZXByZWNpYXRpb24ucHJvZHVjdHMnLCBbCiAgICAgICAgICAgICAgICAnc2VsZWN0ZWQnID0+IHJlcXVlc3QoKS0+aGFzKCdzZWxlY3RlZCcpID8gcmVxdWVzdCgpLT5nZXQoJ3NlbGVjdGVkJykgOiAnJywKICAgICAgICAgICAgICAgICdjYXRlZ29yaWVzJyA9PiAkY2F0ZWdvcmllcywKICAgICAgICAgICAgICAgICdwcm9kdWN0cycgPT4gUHJvZHVjdDo6d2l0aChbCiAgICAgICAgICAgICAgICAgICAgJ2F0dHJpYnV0ZXMuYXR0cmlidXRlT3B0aW9uLmF0dHJpYnV0ZScKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAgICAgLT53aGVyZUluKCdjYXRlZ29yeV9pZCcsICRjYXRlZ29yaWVzLT5wbHVjaygnaWQnKS0+dG9BcnJheSgpKQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ2ZpeGVkQXNzZXRCYXRjaEl0ZW1zJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaXNfZGlzcG9zZWQnLCAwKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+d2hlcmVIYXMoJ2ZpeGVkQXNzZXRCYXRjaEl0ZW1zLmJhdGNoLmNvc3RDZW50cmUucHJvZml0Q2VudHJlJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnY29tcGFueV9pZCcsIHJlcXVlc3QoKS0+Z2V0KCdjb21wYW55X2lkJykpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5nZXQoKQogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKHJlcXVlc3QoKS0+Z2V0KCdhY3Rpb24nKSA9PSAnYmF0Y2hlcycpIHsKICAgICAgICAgICAgJGRhdGEgPSBbCiAgICAgICAgICAgICAgICAnYmF0Y2hlcycgPT4gRml4ZWRBc3NldEJhdGNoOjp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAnZ29vZHNSZWNlaXZlZEl0ZW1zU3RvY2tJbi5yZWxHb29kc1JlY2VpdmVkSXRlbXMucmVsR29vZHNSZWNlaXZlZE5vdGUucmVsUHVyY2hhc2VPcmRlci5wdXJjaGFzZU9yZGVyUmVxdWlzaXRpb25zJwogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCdpdGVtcycsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lzX2Rpc3Bvc2VkJywgMCk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPndoZW4ocmVxdWVzdCgpLT5nZXQoJ3Byb2R1Y3RfaWQnKSA+IDAsIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2l0ZW1zJywgZnVuY3Rpb24gKCRxdWVyeSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2ZpbmFsX2Fzc2V0X2lkJywgcmVxdWVzdCgpLT5nZXQoJ3Byb2R1Y3RfaWQnKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5nZXQoKSwKICAgICAgICAgICAgXTsKICAgICAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5maXhlZEFzc2V0cy5wcm9jZXNzRGVwcmVjaWF0aW9uLmJhdGNoZXMnLCAkZGF0YSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBwdWJsaWMgZnVuY3Rpb24gc3RvcmUoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkcmVxdWVzdC0+dmFsaWRhdGUoWwogICAgICAgICAgICAnZnJvbScgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ3RvJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnYXNzZXRzJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnYXNzZXRzLionID0+ICdyZXF1aXJlZCcsCiAgICAgICAgXSk7CiAgICAgICAgCiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAkam91cm5hbEVudHJpZXMgPSBbXTsKICAgICAgICAgICAgJGNvdW50ID0gMDsKICAgICAgICAgICAgJGFtb3VudHMgPSBbXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChpc3NldCgkcmVxdWVzdC0+YXNzZXRzWzBdKSkgewogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHJlcXVlc3QtPmFzc2V0cyBhcyAka2V5ID0+ICRhc3NldF9jb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgJGl0ZW1zID0gRml4ZWRBc3NldEJhdGNoSXRlbTo6d2hlcmUoJ2Fzc2V0X2NvZGUnLCAkYXNzZXRfY29kZSktPndoZXJlKCdpc19kaXNwb3NlZCcsIDApLT5nZXQoKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAoJGl0ZW1zLT5jb3VudCgpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkaXRlbXMgYXMgJGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhbW91bnQgPSBzeXN0ZW1Eb3VibGVWYWx1ZShjYWxjdWxhdGVEZXByZWNpYXRpb25BbW91bnQoJGl0ZW0sICRyZXF1ZXN0LT5mcm9tLCAkcmVxdWVzdC0+dG8pLCAyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRkZXByZWNpYXRpb24gPSBGaXhlZEFzc2V0QmF0Y2hJdGVtRGVwcmVjaWF0aW9uOjpjcmVhdGUoWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdmaXhlZF9hc3NldF9iYXRjaF9pdGVtX2lkJyA9PiAkaXRlbS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhdGUnID0+IGRhdGUoJ1ktbS1kJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Zyb20nID0+ICRyZXF1ZXN0LT5mcm9tLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0bycgPT4gJHJlcXVlc3QtPnRvLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhbW91bnQnID0+ICRhbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JlbWFya3MnID0+ICRyZXF1ZXN0LT5yZW1hcmtzWyRpdGVtLT5hc3NldF9jb2RlXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWFycmF5X2tleV9leGlzdHMoJGl0ZW0tPmJhdGNoLT5jb3N0X2NlbnRyZV9pZCwgJGFtb3VudHMpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFtb3VudHNbJGl0ZW0tPmJhdGNoLT5jb3N0X2NlbnRyZV9pZF0gPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFtb3VudHNbJGl0ZW0tPmJhdGNoLT5jb3N0X2NlbnRyZV9pZF0gKz0gJGFtb3VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGV4Y2hhbmdlX3JhdGVfaWQgPSAkaXRlbS0+YmF0Y2gtPmdvb2RzUmVjZWl2ZWRJdGVtc1N0b2NrSW4tPnJlbFB1cmNoYXNlT3JkZXItPnJlbFF1b3RhdGlvbi0+ZXhjaGFuZ2VfcmF0ZV9pZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGZpbmFsQXNzZXQgPSAkaXRlbTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJGFtb3VudHMgYXMgJGNvc3RfY2VudHJlX2lkID0+ICRhbW91bnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRqb3VybmFsRW50cmllc1tdID0gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJGNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAoaXNzZXQoJGZpbmFsQXNzZXQtPmZpbmFsQXNzZXQtPmRlcHJlY2lhdGlvbl9jb3N0X2FjY291bnRfaWQpICYmICRmaW5hbEFzc2V0LT5maW5hbEFzc2V0LT5kZXByZWNpYXRpb25fY29zdF9hY2NvdW50X2lkID4gMCA/ICRmaW5hbEFzc2V0LT5maW5hbEFzc2V0LT5kZXByZWNpYXRpb25fY29zdF9hY2NvdW50X2lkIDogYWNjb3VudERlZmF1bHRTZXR0aW5ncygpWydkZXByZWNpYXRpb25fY29zdF9hY2NvdW50J10pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gJGFtb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICdGaXhlZCBBc3NldCBEZXByZWNpYXRpb24gQ29zdCBEZWJpdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdkZXByZWNpYXRpb24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzb3VyY2UnID0+IGpzb25fZW5jb2RlKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Fzc2V0X2NvZGUnID0+ICRhc3NldF9jb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZnJvbScgPT4gJHJlcXVlc3QtPmZyb20sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0bycgPT4gJHJlcXVlc3QtPnRvLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkam91cm5hbEVudHJpZXNbXSA9IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRjb3N0X2NlbnRyZV9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gKGlzc2V0KCRmaW5hbEFzc2V0LT5maW5hbEFzc2V0LT5pbnZlbnRvcnlfYWRqdXN0bWVudHNfYWNjb3VudF9pZCkgJiYgJGZpbmFsQXNzZXQtPmZpbmFsQXNzZXQtPmludmVudG9yeV9hZGp1c3RtZW50c19hY2NvdW50X2lkID4gMCA/ICRmaW5hbEFzc2V0LT5maW5hbEFzc2V0LT5pbnZlbnRvcnlfYWRqdXN0bWVudHNfYWNjb3VudF9pZCA6IGFjY291bnREZWZhdWx0U2V0dGluZ3MoKVsnaW52ZW50b3J5X2FkanVzdG1lbnRzX2FjY291bnQnXSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+ICRhbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJ0ZpeGVkIEFzc2V0IEFkanVzdG1lbnQgQ3JlZGl0ICcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdkZXByZWNpYXRpb24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzb3VyY2UnID0+IGpzb25fZW5jb2RlKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Fzc2V0X2NvZGUnID0+ICRhc3NldF9jb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZnJvbScgPT4gJHJlcXVlc3QtPmZyb20sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0bycgPT4gJHJlcXVlc3QtPnRvLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAkY291bnQrKzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICgkY291bnQgPiAwKSB7CiAgICAgICAgICAgICAgICBzYXZlTGVkZ2VyRW50cmllcyg1LCBkYXRlKCdZLW0tZCBIOmk6cycsIHN0cnRvdGltZSgkcmVxdWVzdC0+dG8gLiAnICcgLiBkYXRlKCdIOmk6cycpKSksIDEsICcnLCAnTW9udGhseSBEZXByZWNpYXRpb24gb2YgRml4ZWQgQXNzZXQnLCAkam91cm5hbEVudHJpZXMsICRleGNoYW5nZV9yYXRlX2lkLCAwLCAwLCAwLCBnZXRDb3N0Q2VudHJlQ29tcGFueSgkY29zdF9jZW50cmVfaWQpKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgREI6OmNvbW1pdCgpOwogICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5iYWNrV2l0aFN1Y2Nlc3MoJGNvdW50IC4gIiBhc3NldHMgaGF2ZSBiZWVuIGRlcHJpY2lhdGVkLiIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigiU29tZXRoaW5nIHdlbnQgd3JvbmchIik7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQp9Cg==