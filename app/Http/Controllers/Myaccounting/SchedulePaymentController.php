<?php
bolt_decrypt( __FILE__ , 'os68Dl'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcTXlhY2NvdW50aW5nOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKdXNlIERCLCBEYXRhVGFibGVzOwoKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXENvbXBhbnk7CnVzZSBBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDaGFydE9mQWNjb3VudDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXFNjaGVkdWxlUGF5bWVudDsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXFNjaGVkdWxlUGF5bWVudExlZGdlcjsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXFNjaGVkdWxlOwp1c2UgQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcU2NoZWR1bGVFbnRyeTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEN1cnJlbmN5VHlwZTsKdXNlIEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEZpc2NhbFllYXI7CgoKY2xhc3MgU2NoZWR1bGVQYXltZW50Q29udHJvbGxlciBleHRlbmRzIENvbnRyb2xsZXIKeyAgIAoKICAgIHB1YmxpYyBmdW5jdGlvbiBoZWFkZXJDb2x1bW5zKCR2YWx1ZT0nJykKICAgIHsKICAgICAgICByZXR1cm4gYXJyYXkoCiAgICAgICAgICAgIFsnU0wnLCAnU0wnXSwKICAgICAgICAgICAgWydjb21wYW55JywgJ2NvbXBhbnknLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydwYXltZW50X3NjaGVkdWxlJywgJ3BheW1lbnRfc2NoZWR1bGUnLCd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2NvZGUnLCAnY29kZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3B1cnBvc2UnLCAncHVycG9zZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2RhdGUnLCAnZGF0ZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2Rlc2NyaXB0aW9uJywgJ2Rlc2NyaXB0aW9uJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsndHJhbnNhY3Rpb25zJywgJ3RyYW5zYWN0aW9ucycsJ3RleHQtY2VudGVyJ10sCiAgICAgICAgKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gaW5kZXgoKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChyZXF1ZXN0KCktPmFqYXgoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIERhdGF0YWJsZXM6Om9mKAogICAgICAgICAgICAgICAgICAgIFNjaGVkdWxlOjp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3NjaGVkdWxlUGF5bWVudC5jb21wYW55JywKICAgICAgICAgICAgICAgICAgICAgICAgJ2VudHJpZXMuZW50cnkuZW50cnlUeXBlJywKICAgICAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgLT5hZGRJbmRleENvbHVtbigpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdjb21wYW55JywgZnVuY3Rpb24oJHNjaGVkdWxlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2V0KCRzY2hlZHVsZS0+c2NoZWR1bGVQYXltZW50LT5jb21wYW55LT5jb2RlKSA/ICdbJy4kc2NoZWR1bGUtPnNjaGVkdWxlUGF5bWVudC0+Y29tcGFueS0+Y29kZS4nXSAnLiRzY2hlZHVsZS0+c2NoZWR1bGVQYXltZW50LT5jb21wYW55LT5uYW1lIDogJyc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2NvbXBhbnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdzY2hlZHVsZVBheW1lbnQuY29tcGFueScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPm9yd2hlcmUoJ2NvZGUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2NvbXBhbnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBTY2hlZHVsZVBheW1lbnQ6OnNlbGVjdCgnY29tcGFuaWVzLmNvZGUnKQogICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2NvbXBhbmllcycsICdjb21wYW5pZXMuaWQnLCAnPScsICdzY2hlZHVsZV9wYXltZW50cy5jb21wYW55X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbignc2NoZWR1bGVfcGF5bWVudHMuaWQnLCAnc2NoZWR1bGVzLnNjaGVkdWxlX3BheW1lbnRfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigncGF5bWVudF9zY2hlZHVsZScsIGZ1bmN0aW9uKCRzY2hlZHVsZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkc2NoZWR1bGUtPnNjaGVkdWxlUGF5bWVudC0+bmFtZSkgPyAkc2NoZWR1bGUtPnNjaGVkdWxlUGF5bWVudC0+bmFtZSA6ICcnOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdwYXltZW50X3NjaGVkdWxlJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnc2NoZWR1bGVQYXltZW50JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJy4ka2V5d29yZC4nJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3BheW1lbnRfc2NoZWR1bGUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBTY2hlZHVsZVBheW1lbnQ6OnNlbGVjdCgnc2NoZWR1bGVfcGF5bWVudHMubmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3NjaGVkdWxlX3BheW1lbnRzLmlkJywgJ3NjaGVkdWxlcy5zY2hlZHVsZV9wYXltZW50X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2RhdGUnLCBmdW5jdGlvbigkc2NoZWR1bGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHNjaGVkdWxlLT5lbnRyaWVzLT5jb3VudCgpID4gMCA/ICRzY2hlZHVsZS0+ZW50cmllcy0+Zmlyc3QoKS0+ZW50cnktPmRhdGUgOiAnJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2VudHJpZXMuZW50cnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnZGF0ZScsICdMSUtFJywgJyUnLiRrZXl3b3JkLiclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignZGF0ZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFNjaGVkdWxlRW50cnk6OnNlbGVjdCgnZW50cmllcy5kYXRlJykKICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdlbnRyaWVzJywgJ2VudHJpZXMuaWQnLCAnPScsICdzY2hlZHVsZV9lbnRyaWVzLmVudHJ5X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbignc2NoZWR1bGVfZW50cmllcy5pZCcsICdzY2hlZHVsZXMuaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbigndHJhbnNhY3Rpb25zJywgZnVuY3Rpb24oJHNjaGVkdWxlKSB7CiAgICAgICAgICAgICAgICAgICAgJHRyYW5zYWN0aW9ucyA9ICcnOwogICAgICAgICAgICAgICAgICAgIGlmKCRzY2hlZHVsZS0+ZW50cmllcy0+Y291bnQoKSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCRzY2hlZHVsZS0+ZW50cmllcyBhcyAka2V5ID0+ICRlbnRyeSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdHJhbnNhY3Rpb25zIC49ICc8YSBjbGFzcz0iYnRuIGJ0bi14cyBidG4tcHJpbWFyeSBtci0xIG1iLTEiIG9uY2xpY2s9ImdldFNob3J0RGV0YWlscygkKHRoaXMpKSIgZGF0YS1pZD0iJyAuICgkZW50cnktPmVudHJ5X2lkKSAuICciIGRhdGEtZW50cnktdHlwZT0iJyAuICgkZW50cnktPmVudHJ5LT5lbnRyeVR5cGUtPm5hbWUpIC4gJyIgZGF0YS1jb2RlPSInIC4gKCRlbnRyeS0+ZW50cnktPmNvZGUpIC4gJyI+Jy4kZW50cnktPmVudHJ5LT5jb2RlLic8L2E+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRyYW5zYWN0aW9uczsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbigndHJhbnNhY3Rpb25zJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnZW50cmllcy5lbnRyeScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdjb2RlJywgJ0xJS0UnLCAnJScuJGtleXdvcmQuJyUnKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCd0cmFuc2FjdGlvbnMnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBTY2hlZHVsZUVudHJ5OjpzZWxlY3QoJ2VudHJpZXMuY29kZScpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbignZW50cmllcycsICdlbnRyaWVzLmlkJywgJz0nLCAnc2NoZWR1bGVfZW50cmllcy5lbnRyeV9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3NjaGVkdWxlX2VudHJpZXMuaWQnLCAnc2NoZWR1bGVzLmlkJykKICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgLT5yYXdDb2x1bW5zKFsndHJhbnNhY3Rpb25zJ10pCiAgICAgICAgICAgICAgICAtPm1ha2UodHJ1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAgICAgJ3RpdGxlJyA9PiAiU2NoZWR1bGVkIFBheW1lbnRzIiwKICAgICAgICAgICAgICAgICdjb21wYW5pZXMnID0+IENvbXBhbnk6OmhhcygncHJvZml0Q2VudHJlcy5jb3N0Q2VudHJlcycpCiAgICAgICAgICAgICAgICAtPndoZXJlSGFzKCd1c2VycycsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3VzZXJfaWQnLCBhdXRoKCktPnVzZXIoKS0+aWQpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+Z2V0KCksCiAgICAgICAgICAgICAgICAnaGVhZGVyQ29sdW1ucycgPT4gJHRoaXMtPmhlYWRlckNvbHVtbnMoKSwKICAgICAgICAgICAgXTsKCiAgICAgICAgICAgIHJldHVybiB2aWV3KCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMuc2NoZWR1bGVkUGF5bWVudHMuaW5kZXgnLCAkZGF0YSk7CiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBjcmVhdGUoKQogICAgewogICAgICAgICRjb21wYW55ID0gQ29tcGFueTo6aGFzKCdwcm9maXRDZW50cmVzLmNvc3RDZW50cmVzJykKICAgICAgICAtPndpdGgoWwogICAgICAgICAgICAnc2NoZWR1bGVQYXltZW50cycKICAgICAgICBdKQogICAgICAgIC0+d2hlcmUoJ2lkJywgcmVxdWVzdCgpLT5nZXQoJ2NvbXBhbnknKSkKICAgICAgICAtPndoZXJlSGFzKCd1c2VycycsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCd1c2VyX2lkJywgYXV0aCgpLT51c2VyKCktPmlkKTsKICAgICAgICB9KS0+Zmlyc3QoKTsKICAgICAgICBpZiAoIWlzc2V0KCRjb21wYW55LT5pZCkpIHsKICAgICAgICAgICAgcmV0dXJuIHJlZGlyZWN0KCdhY2NvdW50aW5nL2VudHJpZXMnKTsKICAgICAgICB9CgogICAgICAgICRhY2NvdW50RGVmYXVsdFNldHRpbmdzID0gYWNjb3VudERlZmF1bHRTZXR0aW5ncygpOwoKICAgICAgICAkc2NoZWR1bGUgPSBTY2hlZHVsZVBheW1lbnQ6OndpdGgoWwogICAgICAgICAgICAnbGVkZ2VycycKICAgICAgICBdKS0+ZmluZChyZXF1ZXN0KCktPmdldCgnc2NoZWR1bGUnKSk7CgogICAgICAgICRkYXRhID0gWwogICAgICAgICAgICAndGl0bGUnID0+ICdOZXcgUGF5bWVudCBTY2hlZHVsZScsCiAgICAgICAgICAgICdhY2NvdW50RGVmYXVsdFNldHRpbmdzJyA9PiAkYWNjb3VudERlZmF1bHRTZXR0aW5ncywKICAgICAgICAgICAgJ3N5c3RlbUN1cnJlbmN5JyA9PiBzeXN0ZW1DdXJyZW5jeSgkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snY3VycmVuY3lfaWQnXSwgJGFjY291bnREZWZhdWx0U2V0dGluZ3MpLAogICAgICAgICAgICAnY29tcGFueScgPT4gJGNvbXBhbnksCiAgICAgICAgICAgICdzY2hlZHVsZScgPT4gJHNjaGVkdWxlLAogICAgICAgICAgICAnZmlzY2FsWWVhcicgPT4gZ2V0QWN0aXZlRmlzY2FsWWVhcigkY29tcGFueS0+aWQpLAogICAgICAgICAgICAnZmlzY2FsWWVhcnMnID0+IEZpc2NhbFllYXI6OndoZXJlSGFzKCdmaXNjYWxZZWFyT3BlbmluZ3MnLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkY29tcGFueSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnc3RhdHVzJywgJ29wZW5lZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZSgnaXNfYXBwcm92ZWQnLCAnYXBwcm92ZWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmUoJ2NvbXBhbnlfaWQnLCAkY29tcGFueS0+aWQpOwogICAgICAgICAgICB9KS0+Z2V0KCksCiAgICAgICAgICAgICdjdXJyZW5jeVR5cGVzJyA9PiBDdXJyZW5jeVR5cGU6OndpdGgoWydjdXJyZW5jaWVzJ10pLT5nZXQoKSwKICAgICAgICAgICAgJ2Nvc3RDZW50cmVzJyA9PiBnZXRDb3N0Q2VudHJlcyh0cnVlLCAkY29tcGFueS0+aWQpLAogICAgICAgICAgICAnY2hhcnRPZkFjY291bnRzT3B0aW9ucycgPT4gY2hhcnRPZkFjY291bnRzT3B0aW9ucyhbXSwgMCwgMCwgZ2V0QWxsR3JvdXBBbmRMZWRnZXJzKCksIGZhbHNlLCAneWVzJyksCiAgICAgICAgXTsKCiAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5zY2hlZHVsZWRQYXltZW50cy5jcmVhdGUnLCAkZGF0YSk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHN0b3JlKFJlcXVlc3QgJHJlcXVlc3QpCiAgICB7CiAgICAgICAgJHJlcXVlc3QtPnZhbGlkYXRlKFsKICAgICAgICAgICAgJ3NjaGVkdWxlX3BheW1lbnRfaWQnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdwdXJwb3NlJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnZmlzY2FsX3llYXJfaWQnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkLionID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZC4qJyA9PiAncmVxdWlyZWQnLAogICAgICAgIF0pOwoKICAgICAgICBpZiAoJHRoaXMtPmFtb3VudCgkcmVxdWVzdClbJ2RlYml0J10gPD0gMCB8fCAkdGhpcy0+YW1vdW50KCRyZXF1ZXN0KVsnY3JlZGl0J10gPD0gMCkgewogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gIlBsZWFzZSBhZGQgc29tZSBEZWJpdCBvciBDcmVkaXQgYW1vdW50IgogICAgICAgICAgICBdKTsKICAgICAgICB9CgogICAgICAgIGlmICgkdGhpcy0+YW1vdW50KCRyZXF1ZXN0KVsnZGViaXQnXSAhPSAkdGhpcy0+YW1vdW50KCRyZXF1ZXN0KVsnY3JlZGl0J10pIHsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJEZWJpdCAmIENyZWRpdCBhbW91bnQgbXVzdCBiZSBzYW1lIgogICAgICAgICAgICBdKTsKICAgICAgICB9CgogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJGZpc2NhbFllYXIgPSBGaXNjYWxZZWFyOjp3aXRoKFsKICAgICAgICAgICAgICAgICdmaXNjYWxZZWFyT3BlbmluZ3MnCiAgICAgICAgICAgIF0pLT5maW5kT3JGYWlsKCRyZXF1ZXN0LT5maXNjYWxfeWVhcl9pZCk7CiAgICAgICAgICAgIGlmKChzdHJ0b3RpbWUoZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPmRhdGV0aW1lKSkpIDwgc3RydG90aW1lKCRmaXNjYWxZZWFyLT5zdGFydCkpIHx8IChzdHJ0b3RpbWUoZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPmRhdGV0aW1lKSkpID4gc3RydG90aW1lKCRmaXNjYWxZZWFyLT5lbmQpKSl7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiRGF0ZXRpbWUgaXMgbm90IGluIHRoZSByYW5nZSBvZiB0aGUgZmlzY2FsIHllYXIgcGVyaW9kLiIKICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkaXRlbXMgPSBbXTsKICAgICAgICAgICAgaWYgKGlzc2V0KCRyZXF1ZXN0LT5jaGFydF9vZl9hY2NvdW50X2lkWzBdKSkgewogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHJlcXVlc3QtPmNoYXJ0X29mX2FjY291bnRfaWQgYXMgJGtleSA9PiAkY2hhcnRfb2ZfYWNjb3VudF9pZCkgewogICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGl0ZW1zLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJHJlcXVlc3QtPmNvc3RfY2VudHJlX2lkWyRrZXldLAogICAgICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJHJlcXVlc3QtPmNoYXJ0X29mX2FjY291bnRfaWRbJGtleV0sCiAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gJHJlcXVlc3QtPmRlYml0WyRrZXldLAogICAgICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAkcmVxdWVzdC0+Y3JlZGl0WyRrZXldLAogICAgICAgICAgICAgICAgICAgICAgICAnYW1vdW50JyA9PiAoJHJlcXVlc3QtPmRlYml0WyRrZXldID4gMCA/ICRyZXF1ZXN0LT5kZWJpdFska2V5XSA6ICRyZXF1ZXN0LT5jcmVkaXRbJGtleV0pLAogICAgICAgICAgICAgICAgICAgICAgICAnZGViaXRfY3JlZGl0JyA9PiAoJHJlcXVlc3QtPmRlYml0WyRrZXldID4gMCA/ICdEJyA6ICdDJyksCiAgICAgICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICRyZXF1ZXN0LT5uYXJyYXRpb25bJGtleV0sCiAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRzY2hlZHVsZVBheW1lbnQgPSBTY2hlZHVsZVBheW1lbnQ6OmZpbmRPckZhaWwoJHJlcXVlc3QtPnNjaGVkdWxlX3BheW1lbnRfaWQpOwogICAgICAgICAgICAkZW50cnkgPSBzYXZlTGVkZ2VyRW50cmllcyg0LCAkcmVxdWVzdC0+ZGF0ZXRpbWUsIDEsICRyZXF1ZXN0LT5udW1iZXIsICRyZXF1ZXN0LT5ub3RlcywgJGl0ZW1zLCBnZXRFeGNoYW5nZVJhdGVzKCRyZXF1ZXN0LT5jdXJyZW5jeV9pZCwgZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPmRhdGV0aW1lKSksIGRhdGUoJ0g6aTpzJywgc3RydG90aW1lKCRyZXF1ZXN0LT5kYXRldGltZSkpKVsncmF0ZSddLT5pZCwgMSwgMCwgMSwgJHNjaGVkdWxlUGF5bWVudC0+Y29tcGFueV9pZCwgJGZpc2NhbFllYXIpOwoKICAgICAgICAgICAgaWYgKGlzc2V0KCRlbnRyeVsnc3VjY2VzcyddKSAmJiAkZW50cnlbJ3N1Y2Nlc3MnXSkgewoKICAgICAgICAgICAgICAgICRzY2hlZHVsZSA9IFNjaGVkdWxlOjpjcmVhdGUoWwogICAgICAgICAgICAgICAgICAgICdzY2hlZHVsZV9wYXltZW50X2lkJyA9PiAkc2NoZWR1bGVQYXltZW50LT5pZCwKICAgICAgICAgICAgICAgICAgICAnY29kZScgPT4gXFN0cjo6cmFuZG9tKDgpLAogICAgICAgICAgICAgICAgICAgICdwdXJwb3NlJyA9PiAkcmVxdWVzdC0+cHVycG9zZSwKICAgICAgICAgICAgICAgICAgICAnZGVzY3JpcHRpb24nID0+ICRyZXF1ZXN0LT5ub3RlcywKICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgIGlmKCRzY2hlZHVsZSl7CiAgICAgICAgICAgICAgICAgICAgU2NoZWR1bGVFbnRyeTo6Y3JlYXRlKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3NjaGVkdWxlX2lkJyA9PiAkc2NoZWR1bGUtPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAnZW50cnlfaWQnID0+ICRlbnRyeVsnZW50cnknXS0+aWQsCiAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgREI6OmNvbW1pdCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkZW50cnlbJ21lc3NhZ2UnXSwKICAgICAgICAgICAgICAgICAgICAnaWQnID0+ICRlbnRyeVsnZW50cnknXS0+aWQsCiAgICAgICAgICAgICAgICAgICAgJ2NvZGUnID0+ICRlbnRyeVsnZW50cnknXS0+Y29kZSwKICAgICAgICAgICAgICAgICAgICAnZW50cnlfdHlwZScgPT4gJGVudHJ5WydlbnRyeSddLT5lbnRyeVR5cGUtPm5hbWUsCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIERCOjpyb2xsYmFjaygpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJGVudHJ5WydtZXNzYWdlJ10KICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkdGgtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGFtb3VudCgkcmVxdWVzdCkKICAgIHsKICAgICAgICByZXR1cm4gWwogICAgICAgICAgICAnZGViaXQnID0+IGFycmF5X3N1bSgkcmVxdWVzdC0+ZGViaXQpLAogICAgICAgICAgICAnY3JlZGl0JyA9PiBhcnJheV9zdW0oJHJlcXVlc3QtPmNyZWRpdCksCiAgICAgICAgXTsKICAgIH0KfQo=