<?php
bolt_decrypt( __FILE__ , 'M6paTX'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcTXlhY2NvdW50aW5nXFNoYXJlZENvc3RSYXRpbzsKCnVzZSBBcHBcSHR0cFxDb250cm9sbGVyc1xDb250cm9sbGVyOwp1c2UgSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3Q7Cgp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXENvbXBhbnk7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQ29zdENlbnRyZTsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDb3N0Q2VudHJlQWxsb2NhdGlvbjsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDb3N0Q2VudHJlQWxsb2NhdGlvblRhcmdldDsKdXNlIFxBcHBcVXNlcjsKdXNlIERCLCBEYXRhVGFibGVzOwoKY2xhc3MgQ29zdENlbnRyZUFsbG9jYXRpb25zQ29udHJvbGxlciBleHRlbmRzIENvbnRyb2xsZXIKewogICAgcHVibGljIGZ1bmN0aW9uIGhlYWRlckNvbHVtbnMoJHZhbHVlID0gJycpCiAgICB7CiAgICAgICAgcmV0dXJuIGFycmF5KAogICAgICAgICAgICBbJ1NMJywgJ1NMJ10sCiAgICAgICAgICAgIFsnbmFtZScsICduYW1lJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnY29tcGFueScsICdjb21wYW55JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnY29zdF9jZW50cmUnLCAnY29zdF9jZW50cmUnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydjaGFydF9vZl9hY2NvdW50JywgJ2NoYXJ0X29mX2FjY291bnQnLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydjb3VudGVyX2NoYXJ0X29mX2FjY291bnQnLCAnY291bnRlcl9jaGFydF9vZl9hY2NvdW50JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnY3JlYXRvcicsICdjcmVhdG9yJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnZWRpdG9yJywgJ2VkaXRvcicsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2FjdGlvbnMnLCAnYWN0aW9ucycsICd0ZXh0LWNlbnRlciddCiAgICAgICAgKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gaW5kZXgoKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChyZXF1ZXN0KCktPmFqYXgoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIERhdGFUYWJsZXM6Om9mKAogICAgICAgICAgICAgICAgICAgICAgICBDb3N0Q2VudHJlQWxsb2NhdGlvbjo6d2l0aChbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29zdENlbnRyZS5wcm9maXRDZW50cmUuY29tcGFueScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2hhcnRPZkFjY291bnQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NvdW50ZXJDaGFydE9mQWNjb3VudCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY3JlYXRvcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZWRpdG9yJwogICAgICAgICAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAtPmFkZEluZGV4Q29sdW1uKCkKCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2NvbXBhbnknLCBmdW5jdGlvbiAoJGFsbG9jYXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdbJy4kYWxsb2NhdGlvbi0+Y29zdENlbnRyZS0+cHJvZml0Q2VudHJlLT5jb21wYW55LT5jb2RlLiddICcuJGFsbG9jYXRpb24tPmNvc3RDZW50cmUtPnByb2ZpdENlbnRyZS0+Y29tcGFueS0+bmFtZTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdjb21wYW55JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2Nvc3RDZW50cmUucHJvZml0Q2VudHJlLmNvbXBhbnknLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+b3JXaGVyZSgnY29kZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2NvbXBhbnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgQ29zdENlbnRyZTo6c2VsZWN0KCdjb21wYW5pZXMuY29kZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPmpvaW4oJ2NvbXBhbmllcycsICdjb21wYW5pZXMuaWQnLCAnPScsICdwcm9maXRfY2VudHJlcy5jb21wYW55X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbigncHJvZml0X2NlbnRyZXMnLCAncHJvZml0X2NlbnRyZXMuaWQnLCAnPScsICdjb3N0X2NlbnRyZXMucHJvZml0X2NlbnRyZV9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCdjb3N0X2NlbnRyZXMuaWQnLCAnY29zdF9jZW50cmVfYWxsb2NhdGlvbnMuY29zdF9jZW50cmVfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2Nvc3RfY2VudHJlJywgZnVuY3Rpb24gKCRhbGxvY2F0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnWycuJGFsbG9jYXRpb24tPmNvc3RDZW50cmUtPmNvZGUuJ10gJy4kYWxsb2NhdGlvbi0+Y29zdENlbnRyZS0+bmFtZTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdjb3N0X2NlbnRyZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdjb3N0Q2VudHJlJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPm9yV2hlcmUoJ2NvZGUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdjb3N0X2NlbnRyZScsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBDb3N0Q2VudHJlOjpzZWxlY3QoJ2Nvc3RfY2VudHJlcy5jb2RlJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ2Nvc3RfY2VudHJlcy5pZCcsICdjb3N0X2NlbnRyZV9hbGxvY2F0aW9ucy5jb3N0X2NlbnRyZV9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignY2hhcnRfb2ZfYWNjb3VudCcsIGZ1bmN0aW9uICgkYWxsb2NhdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ1snLiRhbGxvY2F0aW9uLT5jaGFydE9mQWNjb3VudC0+Y29kZS4nXSAnLiRhbGxvY2F0aW9uLT5jaGFydE9mQWNjb3VudC0+bmFtZTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdjaGFydF9vZl9hY2NvdW50JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2NoYXJ0T2ZBY2NvdW50JywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPm9yV2hlcmUoJ2NvZGUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdjaGFydF9vZl9hY2NvdW50JywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIENoYXJ0T2ZBY2NvdW50OjpzZWxlY3QoJ2NoYXJ0X29mX2FjY291bnRzLmNvZGUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbignY2hhcnRfb2ZfYWNjb3VudHMuaWQnLCAnY29zdF9jZW50cmVfYWxsb2NhdGlvbnMuY2hhcnRfb2ZfYWNjb3VudF9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignY291bnRlcl9jaGFydF9vZl9hY2NvdW50JywgZnVuY3Rpb24gKCRhbGxvY2F0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpc3NldCgkYWxsb2NhdGlvbi0+Y291bnRlckNoYXJ0T2ZBY2NvdW50LT5jb2RlKSA/ICdbJy4kYWxsb2NhdGlvbi0+Y291bnRlckNoYXJ0T2ZBY2NvdW50LT5jb2RlLiddICcuJGFsbG9jYXRpb24tPmNvdW50ZXJDaGFydE9mQWNjb3VudC0+bmFtZSA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2NvdW50ZXJfY2hhcnRfb2ZfYWNjb3VudCcsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdjb3VudGVyQ2hhcnRPZkFjY291bnQnLCBmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+b3JXaGVyZSgnY29kZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2NvdW50ZXJfY2hhcnRfb2ZfYWNjb3VudCcsIGZ1bmN0aW9uICgkcXVlcnksICRvcmRlcikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBDaGFydE9mQWNjb3VudDo6c2VsZWN0KCdjaGFydF9vZl9hY2NvdW50cy5jb2RlJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ2NoYXJ0X29mX2FjY291bnRzLmlkJywgJ2Nvc3RfY2VudHJlX2FsbG9jYXRpb25zLmNvdW50ZXJfY2hhcnRfb2ZfYWNjb3VudF9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignY3JlYXRvcicsIGZ1bmN0aW9uICgkYWxsb2NhdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGFsbG9jYXRpb24tPmNyZWF0b3IgPyAkYWxsb2NhdGlvbi0+Y3JlYXRvci0+bmFtZSA6ICcnOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgLT5maWx0ZXJDb2x1bW4oJ2NyZWF0b3InLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnY3JlYXRvcicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdjcmVhdG9yJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGVhc2VTb3J0TWUoJHF1ZXJ5LCAkb3JkZXIsIFVzZXI6OnNlbGVjdCgndXNlcnMubmFtZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCd1c2Vycy5pZCcsICdjb3N0X2NlbnRyZV9hbGxvY2F0aW9ucy5jcmVhdGVkX2J5JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdlZGl0b3InLCBmdW5jdGlvbiAoJGFsbG9jYXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRhbGxvY2F0aW9uLT5lZGl0b3IgPyAkYWxsb2NhdGlvbi0+ZWRpdG9yLT5uYW1lIDogJyc7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignZWRpdG9yJywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmVIYXMoJ2VkaXRvcicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRxdWVyeS0+d2hlcmUoJ25hbWUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdlZGl0b3InLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgVXNlcjo6c2VsZWN0KCd1c2Vycy5uYW1lJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ3VzZXJzLmlkJywgJ2Nvc3RfY2VudHJlX2FsbG9jYXRpb25zLnVwZGF0ZWRfYnknKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT50YWtlKDEpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAgICAgLT5hZGRDb2x1bW4oJ2FjdGlvbnMnLCBmdW5jdGlvbiAoJGFsbG9jYXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBjbGFzcz0iYnRuIGJ0bi14cyBidG4tcHJpbWFyeSIgaHJlZj0iJyAuIHVybCgnYWNjb3VudGluZy9jb3N0LWNlbnRyZS1hbGxvY2F0aW9ucy8nIC4gJGFsbG9jYXRpb24tPmlkKSAuICciPjxpIGNsYXNzPSJsYSBsYS1leWUiPjwvaT48L2E+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJm5ic3A7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgY2xhc3M9ImJ0biBidG4teHMgYnRuLXN1Y2Nlc3MiIGhyZWY9IicgLiB1cmwoJ2FjY291bnRpbmcvY29zdC1jZW50cmUtYWxsb2NhdGlvbnMvJyAuICRhbGxvY2F0aW9uLT5pZCAuICcvZWRpdCcpIC4gJyI+PGkgY2xhc3M9ImxhIGxhLWVkaXQiPjwvaT48L2E+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJm5ic3A7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgY2xhc3M9ImJ0biBidG4teHMgYnRuLWRhbmdlciIgb25jbGljaz0iZGVsZXRlRnJvbUNSVUQoJCh0aGlzKSkiIGRhdGEtc3JjPSInIC4gcm91dGUoJ2FjY291bnRpbmcuY29zdC1jZW50cmUtYWxsb2NhdGlvbnMuZGVzdHJveScsICRhbGxvY2F0aW9uLT5pZCkgLiAnIj48aSBjbGFzcz0ibGEgbGEtdHJhc2giPjwvaT48L2E+JzsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC0+cmF3Q29sdW1ucyhbJ2FjdGlvbnMnXSkKICAgICAgICAgICAgICAgICAgICAtPnRvSnNvbigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLnNoYXJlZENvc3RSYXRpby5jb3N0Q2VudHJlQWxsb2NhdGlvbnMuaW5kZXgnLCBbCiAgICAgICAgICAgICAgICAndGl0bGUnID0+ICdDb3N0IENlbnRyZSBBbGxvY2F0aW9uJywKICAgICAgICAgICAgICAgICdoZWFkZXJDb2x1bW5zJyA9PiAkdGhpcy0+aGVhZGVyQ29sdW1ucygpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBjcmVhdGUoKQogICAgewogICAgICAgIGlmKHJlcXVlc3QoKS0+aGFzKCdnZXQtY29tcGFueS1pbmZvcm1hdGlvbicpKXsKICAgICAgICAgICAgJGFsbCA9IGdldEFsbEdyb3VwQW5kTGVkZ2VycyhmYWxzZSwgdHJ1ZSk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZXMnID0+IGdldENvc3RDZW50cmVzKGZhbHNlLCByZXF1ZXN0KCktPmdldCgnY29tcGFueV9pZCcpLCB0cnVlKSwKICAgICAgICAgICAgICAgICdsZWRnZXJzJyA9PiBjaGFydE9mQWNjb3VudHNPcHRpb25zKFtdLCAwLCAwLCAkYWxsLCBmYWxzZSwgJ3llcycsIGZhbHNlLCBbcmVxdWVzdCgpLT5nZXQoJ2NvbXBhbnlfaWQnKV0sIHRydWUsIGdldExlZGdlckJhbGFuY2VzKCRhbGwsIHJlcXVlc3QoKS0+Z2V0KCdjb21wYW55X2lkJyksIGdldEFjdGl2ZUZpc2NhbFllYXIocmVxdWVzdCgpLT5nZXQoJ2NvbXBhbnlfaWQnKSktPmlkKSkKICAgICAgICAgICAgXSk7CiAgICAgICAgfQoKICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgJ3RpdGxlJyA9PiAnTmV3IENvc3QgQ2VudHJlIEFsbG9jYXRpb24nLAogICAgICAgICAgICAnY29tcGFuaWVzJyA9PiBDb21wYW55OjpoYXMoJ3Byb2ZpdENlbnRyZXMuY29zdENlbnRyZXMnKQogICAgICAgICAgICAtPndoZXJlSGFzKCd1c2VycycsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgndXNlcl9pZCcsIGF1dGgoKS0+dXNlcigpLT5pZCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+Z2V0KCksCiAgICAgICAgXTsKCiAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5zaGFyZWRDb3N0UmF0aW8uY29zdENlbnRyZUFsbG9jYXRpb25zLmNyZWF0ZScsICRkYXRhKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gc3RvcmUoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkcmVxdWVzdC0+dmFsaWRhdGUoWwogICAgICAgICAgICAnbmFtZScgPT4gJ3JlcXVpcmVkfHVuaXF1ZTpjb3N0X2NlbnRyZV9hbGxvY2F0aW9ucycsCiAgICAgICAgICAgICd0eXBlcycgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ3R5cGVzLionID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdjb21wYW5pZXMnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdjb21wYW5pZXMuKicgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2Nvc3RfY2VudHJlcycgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2Nvc3RfY2VudHJlcy4qJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnbGVkZ2VycycgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2xlZGdlcnMuKicgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2NvdW50ZXJfbGVkZ2VycycgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2NvdW50ZXJfbGVkZ2Vycy4qJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnYWxsb2NhdGlvbnMnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdhbGxvY2F0aW9ucy4qJyA9PiAncmVxdWlyZWQnLAogICAgICAgIF0pOwoKICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIAogICAgICAgICAgICAkYXJyYXkgPSBbXTsKCiAgICAgICAgICAgICRzb3VyY2VzID0gMDsKICAgICAgICAgICAgJHNvdXJjZV90b3RhbHMgPSAwOwogICAgICAgICAgICAkZGVzdGluYXRpb25fdG90YWxzID0gMDsKICAgICAgICAgICAgZm9yZWFjaCgkcmVxdWVzdC0+dHlwZXMgYXMgJGtleSA9PiAkdHlwZSl7CiAgICAgICAgICAgICAgICBpZigkdHlwZSA9PSAnc291cmNlJyl7CiAgICAgICAgICAgICAgICAgICAgJHNvdXJjZXMrKzsKICAgICAgICAgICAgICAgICAgICAkc291cmNlX3RvdGFscyArPSAkcmVxdWVzdC0+YWxsb2NhdGlvbnNbJGtleV07CiAgICAgICAgICAgICAgICB9ZWxzZWlmKCR0eXBlID09ICdkZXN0aW5hdGlvbicpewogICAgICAgICAgICAgICAgICAgICRkZXN0aW5hdGlvbl90b3RhbHMgKz0gJHJlcXVlc3QtPmFsbG9jYXRpb25zWyRrZXldOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGFycmF5LCBbCiAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICRyZXF1ZXN0LT50eXBlc1ska2V5XSwKICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRyZXF1ZXN0LT5jb3N0X2NlbnRyZXNbJGtleV0sCiAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICRyZXF1ZXN0LT5sZWRnZXJzWyRrZXldLAogICAgICAgICAgICAgICAgICAgICdjb3VudGVyX2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICRyZXF1ZXN0LT5jb3VudGVyX2xlZGdlcnNbJGtleV0sCiAgICAgICAgICAgICAgICAgICAgJ2FsbG9jYXRpb24nID0+ICRyZXF1ZXN0LT5hbGxvY2F0aW9uc1ska2V5XSwKICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZigkc291cmNlcyA+IDEpewogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gIlBsZWFzZSBDaG9vc2UgbWF4aW11bSBvZiBPbmUgU291cmNlIgogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKCRzb3VyY2VfdG90YWxzIDwgMCl7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiTWluaW11bSBTb3VyY2UgQWxsb2NhdGlvbiBDYW5ub3QgbWUgWmVybyIKICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZigkc291cmNlX3RvdGFscyA+IDEwMCl7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiTWF4aW11bSBTb3VyY2UgQWxsb2NhdGlvbiBMaW1pdCgxMDAlKSBFeGNlZWRlZCIKICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZigkZGVzdGluYXRpb25fdG90YWxzICE9IDEwMCl7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiRGVzdGluYXRpb24gQWxsb2NhdGlvbiBNdXN0IGJlIDEwMCBpbiBUb3RhbCIKICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkYWxsb2NhdGlvbiA9IENvc3RDZW50cmVBbGxvY2F0aW9uOjpjcmVhdGUoWwogICAgICAgICAgICAgICAgJ25hbWUnID0+ICRyZXF1ZXN0LT5uYW1lLAogICAgICAgICAgICAgICAgJ2Rlc2NyaXB0aW9uJyA9PiAkcmVxdWVzdC0+ZGVzY3JpcHRpb24sCiAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+IGNvbGxlY3QoJGFycmF5KS0+d2hlcmUoJ3R5cGUnLCAnc291cmNlJyktPmZpcnN0KClbJ2Nvc3RfY2VudHJlX2lkJ10sCiAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gY29sbGVjdCgkYXJyYXkpLT53aGVyZSgndHlwZScsICdzb3VyY2UnKS0+Zmlyc3QoKVsnY2hhcnRfb2ZfYWNjb3VudF9pZCddLAogICAgICAgICAgICAgICAgJ2NvdW50ZXJfY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gY29sbGVjdCgkYXJyYXkpLT53aGVyZSgndHlwZScsICdzb3VyY2UnKS0+Zmlyc3QoKVsnY291bnRlcl9jaGFydF9vZl9hY2NvdW50X2lkJ10sCiAgICAgICAgICAgICAgICAnYWxsb2NhdGlvbicgPT4gY29sbGVjdCgkYXJyYXkpLT53aGVyZSgndHlwZScsICdzb3VyY2UnKS0+Zmlyc3QoKVsnYWxsb2NhdGlvbiddLAogICAgICAgICAgICAgICAgJ2NyZWF0ZWRfYnknID0+IGF1dGgoKS0+dXNlcigpLT5pZCwKICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIGlmKCRhbGxvY2F0aW9uKXsKICAgICAgICAgICAgICAgICRkZXN0aW5hdGlvbnMgPSBbXTsKICAgICAgICAgICAgICAgIGZvcmVhY2goY29sbGVjdCgkYXJyYXkpLT53aGVyZSgndHlwZScsICdkZXN0aW5hdGlvbicpIGFzICRrZXkgPT4gJGRlc3RpbmF0aW9uKXsKICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRkZXN0aW5hdGlvbnMsIFsKICAgICAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2FsbG9jYXRpb25faWQnID0+ICRhbGxvY2F0aW9uLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAkZGVzdGluYXRpb25bJ2Nvc3RfY2VudHJlX2lkJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkZGVzdGluYXRpb25bJ2NoYXJ0X29mX2FjY291bnRfaWQnXSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2NvdW50ZXJfY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJGRlc3RpbmF0aW9uWydjb3VudGVyX2NoYXJ0X29mX2FjY291bnRfaWQnXSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2FsbG9jYXRpb24nID0+ICRkZXN0aW5hdGlvblsnYWxsb2NhdGlvbiddLAogICAgICAgICAgICAgICAgICAgICAgICAnY3JlYXRlZF9ieScgPT4gYXV0aCgpLT51c2VyKCktPmlkLAogICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgQ29zdENlbnRyZUFsbG9jYXRpb25UYXJnZXQ6Omluc2VydCgkZGVzdGluYXRpb25zKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgREI6OmNvbW1pdCgpOwogICAgICAgICAgICBzZXNzaW9uKCktPmZsYXNoKCdhbGVydC10eXBlJywgJ3N1Y2Nlc3MnKTsKICAgICAgICAgICAgc2Vzc2lvbigpLT5mbGFzaCgnbWVzc2FnZScsICJDb3N0IENlbnRyZSBBbGxvY2F0aW9uIFNhdmVkIFN1Y2Nlc3NmdWxseSIpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZQogICAgICAgICAgICBdKTsKICAgICAgICB9IGNhdGNoIChcVGhyb3dhYmxlICR0aCkgewogICAgICAgICAgICBEQjo6cm9sbEJhY2soKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gc2hvdygkaWQpCiAgICB7CiAgICAgICAgJGFsbG9jYXRpb24gPSBDb3N0Q2VudHJlQWxsb2NhdGlvbjo6d2l0aChbCiAgICAgICAgICAgICdjb3N0Q2VudHJlLnByb2ZpdENlbnRyZS5jb21wYW55JywKICAgICAgICAgICAgJ2NoYXJ0T2ZBY2NvdW50JywKICAgICAgICAgICAgJ3RhcmdldHMuY29zdENlbnRyZS5wcm9maXRDZW50cmUuY29tcGFueScsCiAgICAgICAgICAgICd0YXJnZXRzLmNoYXJ0T2ZBY2NvdW50JywKICAgICAgICBdKS0+ZmluZE9yRmFpbCgkaWQpOwoKICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgJ3RpdGxlJyA9PiAnQ29zdCBDZW50cmUgQWxsb2NhdGlvbicsCiAgICAgICAgICAgICdhbGxvY2F0aW9uJyA9PiAkYWxsb2NhdGlvbiwKICAgICAgICBdOwoKICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLnNoYXJlZENvc3RSYXRpby5jb3N0Q2VudHJlQWxsb2NhdGlvbnMuYWxsb2NhdGlvbicsICRkYXRhKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gZWRpdCgkaWQpCiAgICB7CiAgICAgICAgJGFsbG9jYXRpb24gPSBDb3N0Q2VudHJlQWxsb2NhdGlvbjo6d2l0aChbCiAgICAgICAgICAgICdjb3N0Q2VudHJlLnByb2ZpdENlbnRyZS5jb21wYW55JywKICAgICAgICAgICAgJ2NoYXJ0T2ZBY2NvdW50JywKICAgICAgICAgICAgJ3RhcmdldHMuY29zdENlbnRyZS5wcm9maXRDZW50cmUuY29tcGFueScsCiAgICAgICAgICAgICd0YXJnZXRzLmNoYXJ0T2ZBY2NvdW50JywKICAgICAgICBdKS0+ZmluZE9yRmFpbCgkaWQpOwoKICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgJ3RpdGxlJyA9PiAnRWRpdCBDb3N0IENlbnRyZSBBbGxvY2F0aW9uJywKICAgICAgICAgICAgJ2FsbG9jYXRpb24nID0+ICRhbGxvY2F0aW9uLAogICAgICAgICAgICAnYWxsJyA9PiBnZXRBbGxHcm91cEFuZExlZGdlcnMoZmFsc2UsIHRydWUpLAogICAgICAgICAgICAnY29tcGFuaWVzJyA9PiBDb21wYW55OjpoYXMoJ3Byb2ZpdENlbnRyZXMuY29zdENlbnRyZXMnKQogICAgICAgICAgICAtPndoZXJlSGFzKCd1c2VycycsIGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgndXNlcl9pZCcsIGF1dGgoKS0+dXNlcigpLT5pZCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC0+Z2V0KCksCiAgICAgICAgXTsKCiAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5zaGFyZWRDb3N0UmF0aW8uY29zdENlbnRyZUFsbG9jYXRpb25zLmVkaXQnLCAkZGF0YSk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHVwZGF0ZShSZXF1ZXN0ICRyZXF1ZXN0LCAkaWQpCiAgICB7CiAgICAgICAgJHJlcXVlc3QtPnZhbGlkYXRlKFsKICAgICAgICAgICAgJ25hbWUnID0+ICdyZXF1aXJlZHx1bmlxdWU6Y29zdF9jZW50cmVfYWxsb2NhdGlvbnMsbmFtZSwnLiRpZCwKICAgICAgICAgICAgJ3R5cGVzJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAndHlwZXMuKicgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2NvbXBhbmllcycgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2NvbXBhbmllcy4qJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnY29zdF9jZW50cmVzJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnY29zdF9jZW50cmVzLionID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdsZWRnZXJzJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnbGVkZ2Vycy4qJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnY291bnRlcl9sZWRnZXJzJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnY291bnRlcl9sZWRnZXJzLionID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdhbGxvY2F0aW9ucycgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2FsbG9jYXRpb25zLionID0+ICdyZXF1aXJlZCcsCiAgICAgICAgXSk7CgogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgCiAgICAgICAgICAgICRhcnJheSA9IFtdOwoKICAgICAgICAgICAgJHNvdXJjZXMgPSAwOwogICAgICAgICAgICAkc291cmNlX3RvdGFscyA9IDA7CiAgICAgICAgICAgICRkZXN0aW5hdGlvbl90b3RhbHMgPSAwOwogICAgICAgICAgICBmb3JlYWNoKCRyZXF1ZXN0LT50eXBlcyBhcyAka2V5ID0+ICR0eXBlKXsKICAgICAgICAgICAgICAgIGlmKCR0eXBlID09ICdzb3VyY2UnKXsKICAgICAgICAgICAgICAgICAgICAkc291cmNlcysrOwogICAgICAgICAgICAgICAgICAgICRzb3VyY2VfdG90YWxzICs9ICRyZXF1ZXN0LT5hbGxvY2F0aW9uc1ska2V5XTsKICAgICAgICAgICAgICAgIH1lbHNlaWYoJHR5cGUgPT0gJ2Rlc3RpbmF0aW9uJyl7CiAgICAgICAgICAgICAgICAgICAgJGRlc3RpbmF0aW9uX3RvdGFscyArPSAkcmVxdWVzdC0+YWxsb2NhdGlvbnNbJGtleV07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkYXJyYXksIFsKICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJHJlcXVlc3QtPnR5cGVzWyRrZXldLAogICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJHJlcXVlc3QtPmNvc3RfY2VudHJlc1ska2V5XSwKICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJHJlcXVlc3QtPmxlZGdlcnNbJGtleV0sCiAgICAgICAgICAgICAgICAgICAgJ2NvdW50ZXJfY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJHJlcXVlc3QtPmNvdW50ZXJfbGVkZ2Vyc1ska2V5XSwKICAgICAgICAgICAgICAgICAgICAnYWxsb2NhdGlvbicgPT4gJHJlcXVlc3QtPmFsbG9jYXRpb25zWyRrZXldLAogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKCRzb3VyY2VzID4gMSl7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiUGxlYXNlIENob29zZSBtYXhpbXVtIG9mIE9uZSBTb3VyY2UiCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoJHNvdXJjZV90b3RhbHMgPCAwKXsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJNaW5pbXVtIFNvdXJjZSBBbGxvY2F0aW9uIENhbm5vdCBtZSBaZXJvIgogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKCRzb3VyY2VfdG90YWxzID4gMTAwKXsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJNYXhpbXVtIFNvdXJjZSBBbGxvY2F0aW9uIExpbWl0KDEwMCUpIEV4Y2VlZGVkIgogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmKCRkZXN0aW5hdGlvbl90b3RhbHMgIT0gMTAwKXsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJEZXN0aW5hdGlvbiBBbGxvY2F0aW9uIE11c3QgYmUgMTAwIGluIFRvdGFsIgogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRhbGxvY2F0aW9uID0gQ29zdENlbnRyZUFsbG9jYXRpb246OmZpbmRPckZhaWwoJGlkKTsKICAgICAgICAgICAgJGFsbG9jYXRpb24tPm5hbWUgPSAkcmVxdWVzdC0+bmFtZTsKICAgICAgICAgICAgJGFsbG9jYXRpb24tPmRlc2NyaXB0aW9uID0gJHJlcXVlc3QtPmRlc2NyaXB0aW9uOwogICAgICAgICAgICAkYWxsb2NhdGlvbi0+Y29zdF9jZW50cmVfaWQgPSBjb2xsZWN0KCRhcnJheSktPndoZXJlKCd0eXBlJywgJ3NvdXJjZScpLT5maXJzdCgpWydjb3N0X2NlbnRyZV9pZCddOwogICAgICAgICAgICAkYWxsb2NhdGlvbi0+Y2hhcnRfb2ZfYWNjb3VudF9pZCA9IGNvbGxlY3QoJGFycmF5KS0+d2hlcmUoJ3R5cGUnLCAnc291cmNlJyktPmZpcnN0KClbJ2NoYXJ0X29mX2FjY291bnRfaWQnXTsKICAgICAgICAgICAgJGFsbG9jYXRpb24tPmNvdW50ZXJfY2hhcnRfb2ZfYWNjb3VudF9pZCA9IGNvbGxlY3QoJGFycmF5KS0+d2hlcmUoJ3R5cGUnLCAnc291cmNlJyktPmZpcnN0KClbJ2NvdW50ZXJfY2hhcnRfb2ZfYWNjb3VudF9pZCddOwogICAgICAgICAgICAkYWxsb2NhdGlvbi0+YWxsb2NhdGlvbiA9IGNvbGxlY3QoJGFycmF5KS0+d2hlcmUoJ3R5cGUnLCAnc291cmNlJyktPmZpcnN0KClbJ2FsbG9jYXRpb24nXTsKICAgICAgICAgICAgJGFsbG9jYXRpb24tPnVwZGF0ZWRfYnkgPSBhdXRoKCktPnVzZXIoKS0+aWQ7CiAgICAgICAgICAgICRhbGxvY2F0aW9uLT5zYXZlKCk7CgogICAgICAgICAgICBpZigkYWxsb2NhdGlvbil7CiAgICAgICAgICAgICAgICAkZGVzdGluYXRpb25zID0gW107CiAgICAgICAgICAgICAgICBDb3N0Q2VudHJlQWxsb2NhdGlvblRhcmdldDo6d2hlcmUoJ2Nvc3RfY2VudHJlX2FsbG9jYXRpb25faWQnLCAkYWxsb2NhdGlvbi0+aWQpLT5mb3JjZURlbGV0ZSgpOwogICAgICAgICAgICAgICAgZm9yZWFjaChjb2xsZWN0KCRhcnJheSktPndoZXJlKCd0eXBlJywgJ2Rlc3RpbmF0aW9uJykgYXMgJGtleSA9PiAkZGVzdGluYXRpb24pewogICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGRlc3RpbmF0aW9ucywgWwogICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfYWxsb2NhdGlvbl9pZCcgPT4gJGFsbG9jYXRpb24tPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRkZXN0aW5hdGlvblsnY29zdF9jZW50cmVfaWQnXSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICRkZXN0aW5hdGlvblsnY2hhcnRfb2ZfYWNjb3VudF9pZCddLAogICAgICAgICAgICAgICAgICAgICAgICAnY291bnRlcl9jaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkZGVzdGluYXRpb25bJ2NvdW50ZXJfY2hhcnRfb2ZfYWNjb3VudF9pZCddLAogICAgICAgICAgICAgICAgICAgICAgICAnYWxsb2NhdGlvbicgPT4gJGRlc3RpbmF0aW9uWydhbGxvY2F0aW9uJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICdjcmVhdGVkX2J5JyA9PiBhdXRoKCktPnVzZXIoKS0+aWQsCiAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBDb3N0Q2VudHJlQWxsb2NhdGlvblRhcmdldDo6aW5zZXJ0KCRkZXN0aW5hdGlvbnMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBEQjo6Y29tbWl0KCk7CiAgICAgICAgICAgIHNlc3Npb24oKS0+Zmxhc2goJ2FsZXJ0LXR5cGUnLCAnc3VjY2VzcycpOwogICAgICAgICAgICBzZXNzaW9uKCktPmZsYXNoKCdtZXNzYWdlJywgIkNvc3QgQ2VudHJlIEFsbG9jYXRpb24gVXBkYXRlZCBTdWNjZXNzZnVsbHkiKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUKICAgICAgICAgICAgXSk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgREI6OnJvbGxCYWNrKCk7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkdGgtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICBdKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGRlc3Ryb3koJGlkKQogICAgewogICAgICAgIFxEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIENvc3RDZW50cmVBbGxvY2F0aW9uOjpmaW5kKCRpZCktPmRlbGV0ZSgpOwogICAgICAgICAgICBcREI6OmNvbW1pdCgpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiQ29zdCBDZW50cmUgQWxsb2NhdGlvbiBoYXMgYmVlbiBEZWxldGVkISIKICAgICAgICAgICAgXSk7CiAgICAgICAgfSBjYXRjaCAoXFRocm93YWJsZSAkdGgpIHsKICAgICAgICAgICAgXERCOjpyb2xsQmFjaygpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJHRoLT5nZXRNZXNzYWdlKCkKICAgICAgICAgICAgXSk7CiAgICAgICAgfQogICAgfQp9Cg==