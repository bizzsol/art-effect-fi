<?php
bolt_decrypt( __FILE__ , 'YZDaCe'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcTXlhY2NvdW50aW5nOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKdXNlIEFwcCwgREIsIERhdGFUYWJsZXM7Cgp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXFN1cHBsaWVyczsKCnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQ3VycmVuY3k7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcRXhjaGFuZ2VSYXRlOwp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXENvbXBhbnk7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQmFua0FjY291bnQ7Cgp1c2UgXEFwcFxNb2RlbHNcTGVhc2VcTGVhc2U7CnVzZSBcQXBwXE1vZGVsc1xMZWFzZVxMZWFzZVNjaGVkdWxlOwp1c2UgXEFwcFxNb2RlbHNcTGVhc2VcTGVhc2VEZXByZWNpYXRpb247CnVzZSBcQXBwXE1vZGVsc1xMZWFzZVxMZWFzZUVudHJ5OwoKdXNlIFxBcHBcVXNlcjsKCgpjbGFzcyBMZWFzZUNvbnRyb2xsZXIgZXh0ZW5kcyBDb250cm9sbGVyCnsKICAgIHB1YmxpYyBmdW5jdGlvbiBoZWFkZXJDb2x1bW5zKCR2YWx1ZSA9ICcnKQogICAgewogICAgICAgIHJldHVybiBhcnJheSgKICAgICAgICAgICAgWydTTCcsICdTTCddLAogICAgICAgICAgICBbJ2xlYXNlX2NvZGUnLCAnbGVhc2VfY29kZScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2NvbXBhbnknLCAnY29tcGFueScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2Nvc3RfY2VudHJlJywgJ2Nvc3RfY2VudHJlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnc3VwcGxpZXInLCAnc3VwcGxpZXInLCAndGV4dC1jZW50ZXInXSwKICAgICAgICAgICAgWydhbW91bnQnLCAnYW1vdW50JywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsncmF0ZScsICdyYXRlJywgJ3RleHQtY2VudGVyJ10sCiAgICAgICAgICAgIFsnaW5zdGFsbG1lbnRfYW1vdW50JywgJ2luc3RhbGxtZW50X2Ftb3VudCcsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ3llYXInLCAneWVhcicsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2NyZWF0ZWRfYnknLCAnY3JlYXRlZF9ieScsICd0ZXh0LWNlbnRlciddLAogICAgICAgICAgICBbJ2FjdGlvbnMnLCAnYWN0aW9ucycsICd0ZXh0LWNlbnRlciddCiAgICAgICAgKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gaW5kZXgoKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChyZXF1ZXN0KCktPmFqYXgoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIERhdGFUYWJsZXM6Om9mKAogICAgICAgICAgICAgICAgICAgIExlYXNlOjp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ2Nvc3RDZW50cmUucHJvZml0Q2VudHJlLmNvbXBhbnknLAogICAgICAgICAgICAgICAgICAgICAgICAnc3VwcGxpZXInLAogICAgICAgICAgICAgICAgICAgICAgICAnZXhjaGFuZ2VSYXRlLmN1cnJlbmN5JywKICAgICAgICAgICAgICAgICAgICAgICAgJ2VudHJpZXMuZW50cnkuZXhjaGFuZ2VSYXRlJywKICAgICAgICAgICAgICAgICAgICAgICAgJ2VudHJpZXMuZW50cnkuZW50cnlUeXBlJywKICAgICAgICAgICAgICAgICAgICAgICAgJ3NjaGVkdWxlcy5lbnRyaWVzLmVudHJ5LmV4Y2hhbmdlUmF0ZScsCiAgICAgICAgICAgICAgICAgICAgICAgICdzY2hlZHVsZXMuZW50cmllcy5lbnRyeS5lbnRyeVR5cGUnLAogICAgICAgICAgICAgICAgICAgICAgICAnY3JlYXRvcicsCiAgICAgICAgICAgICAgICAgICAgICAgICdlZGl0b3InCiAgICAgICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgICAgICAtPndoZW4oIWRhdGF0YWJsZU9yZGVyaW5nKCksIGZ1bmN0aW9uICgkcXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJieSgnaWQnLCAnZGVzYycpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAtPmFkZEluZGV4Q29sdW1uKCkKCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignbGVhc2VfY29kZScsIGZ1bmN0aW9uICgkbGVhc2UpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIGNsYXNzPSJ0ZXh0LXByaW1hcnkiIG9uY2xpY2s9ImxlYXNlRGV0YWlscygkKHRoaXMpKSIgZGF0YS1pZD0iJyAuICgkbGVhc2UtPmlkKSAuICciPicuJGxlYXNlLT5jb2RlLic8L2E+JzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignbGVhc2VfY29kZScsIGZ1bmN0aW9uICgkcXVlcnksICRrZXl3b3JkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2NvZGUnLCAnTElLRScsICclJyAuICRrZXl3b3JkIC4gJyUnKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPm9yZGVyQ29sdW1uKCdsZWFzZV9jb2RlJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+b3JkZXJCeSgnY29kZScsICRvcmRlcik7CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdjb21wYW55JywgZnVuY3Rpb24gKCRsZWFzZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkbGVhc2UtPmNvc3RDZW50cmUgPyAkbGVhc2UtPmNvc3RDZW50cmUtPnByb2ZpdENlbnRyZS0+Y29tcGFueS0+Y29kZSA6ICcnOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdjb21wYW55JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnY29zdENlbnRyZS5wcm9maXRDZW50cmUuY29tcGFueScsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnY29kZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2NvbXBhbnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBDb3N0Q2VudHJlOjpzZWxlY3QoJ2NvbXBhbmllcy5jb2RlJykKICAgICAgICAgICAgICAgICAgICAgICAgLT5qb2luKCdjb21wYW5pZXMnLCAnY29tcGFuaWVzLmlkJywgJz0nLCAncHJvZml0X2NlbnRyZXMuY29tcGFueV9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+am9pbigncHJvZml0X2NlbnRyZXMnLCAncHJvZml0X2NlbnRyZXMuaWQnLCAnPScsICdjb3N0X2NlbnRyZXMucHJvZml0X2NlbnRyZV9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+d2hlcmVDb2x1bW4oJ2Nvc3RfY2VudHJlcy5pZCcsICdsZWFzZXMuY29zdF9jZW50cmVfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAtPnRha2UoMSkKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignY29zdF9jZW50cmUnLCBmdW5jdGlvbiAoJGxlYXNlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRsZWFzZS0+Y29zdENlbnRyZSA/ICdbJy4kbGVhc2UtPmNvc3RDZW50cmUtPmNvZGUuJ10gJy4kbGVhc2UtPmNvc3RDZW50cmUtPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignY29zdF9jZW50cmUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdjb3N0Q2VudHJlJywgZnVuY3Rpb24gKCRxdWVyeSkgdXNlICgka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkcXVlcnktPndoZXJlKCdjb2RlJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5vcldoZXJlKCduYW1lJywgJ0xJS0UnLCAnJScgLiAka2V5d29yZCAuICclJyk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5vcmRlckNvbHVtbignY29zdF9jZW50cmUnLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBDb3N0Q2VudHJlOjpzZWxlY3QoJ2Nvc3RfY2VudHJlcy5jb2RlJykKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbignY29zdF9jZW50cmVzLmlkJywgJ2xlYXNlcy5jb3N0X2NlbnRyZV9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIC0+YWRkQ29sdW1uKCdzdXBwbGllcicsIGZ1bmN0aW9uICgkbGVhc2UpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGxlYXNlLT5zdXBwbGllciA/ICRsZWFzZS0+c3VwcGxpZXItPm5hbWUgOiAnJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmZpbHRlckNvbHVtbignc3VwcGxpZXInLCBmdW5jdGlvbiAoJHF1ZXJ5LCAka2V5d29yZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlSGFzKCdzdXBwbGllcicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ3N1cHBsaWVyJywgZnVuY3Rpb24gKCRxdWVyeSwgJG9yZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBsZWFzZVNvcnRNZSgkcXVlcnksICRvcmRlciwgU3VwcGxpZXJzOjpzZWxlY3QoJ3N1cHBsaWVycy5uYW1lJykKICAgICAgICAgICAgICAgICAgICAgICAgLT53aGVyZUNvbHVtbignc3VwcGxpZXJzLmlkJywgJ2xlYXNlcy5zdXBwbGllcl9pZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIC0+ZWRpdENvbHVtbignYW1vdW50JywgZnVuY3Rpb24gKCRsZWFzZSkgewogICAgICAgICAgICAgICAgICAgICRlbnRyeSA9ICRsZWFzZS0+ZW50cmllcy0+Zmlyc3QoKS0+ZW50cnk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8YSBjbGFzcz0idGV4dC1wcmltYXJ5IiBvbmNsaWNrPSJnZXRTaG9ydERldGFpbHMoJCh0aGlzKSkiIGRhdGEtaWQ9IicgLiAoJGVudHJ5LT5pZCkgLiAnIiBkYXRhLWVudHJ5LXR5cGU9IicgLiAoJGVudHJ5LT5lbnRyeVR5cGUtPm5hbWUpIC4gJyIgZGF0YS1jb2RlPSInIC4gKCRlbnRyeS0+Y29kZSkgLiAnIj4nLigkbGVhc2UtPmV4Y2hhbmdlUmF0ZS0+Y3VycmVuY3ktPnN5bWJvbC5zeXN0ZW1Nb25leUZvcm1hdCgkbGVhc2UtPmFtb3VudCkpLic8L2E+JzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ3JhdGUnLCBmdW5jdGlvbiAoJGxlYXNlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRsZWFzZS0+cmF0ZS4nJSc7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdpbnN0YWxsbWVudF9hbW91bnQnLCBmdW5jdGlvbiAoJGxlYXNlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRsZWFzZS0+ZXhjaGFuZ2VSYXRlLT5jdXJyZW5jeS0+c3ltYm9sLnN5c3RlbU1vbmV5Rm9ybWF0KCRsZWFzZS0+aW5zdGFsbG1lbnRfYW1vdW50KTsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgLT5lZGl0Q29sdW1uKCdwYXlfaW50ZXJ2YWwnLCBmdW5jdGlvbiAoJGxlYXNlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVjd29yZHMoJGxlYXNlLT5wYXlfaW50ZXJ2YWwpOwogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAtPmVkaXRDb2x1bW4oJ2NyZWF0ZWRfYnknLCBmdW5jdGlvbiAoJGxlYXNlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRsZWFzZS0+Y3JlYXRvciA/ICRsZWFzZS0+Y3JlYXRvci0+bmFtZSA6ICcnOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+ZmlsdGVyQ29sdW1uKCdjcmVhdGVkX2J5JywgZnVuY3Rpb24gKCRxdWVyeSwgJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygnY3JlYXRvcicsIGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJGtleXdvcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHF1ZXJ5LT53aGVyZSgnbmFtZScsICdMSUtFJywgJyUnIC4gJGtleXdvcmQgLiAnJScpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+b3JkZXJDb2x1bW4oJ2NyZWF0ZWRfYnknLCBmdW5jdGlvbiAoJHF1ZXJ5LCAkb3JkZXIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGxlYXNlU29ydE1lKCRxdWVyeSwgJG9yZGVyLCBVc2VyOjpzZWxlY3QoJ3VzZXJzLm5hbWUnKQogICAgICAgICAgICAgICAgICAgICAgICAtPndoZXJlQ29sdW1uKCd1c2Vycy5pZCcsICdsZWFzZXMuY3JlYXRlZF9ieScpCiAgICAgICAgICAgICAgICAgICAgICAgIC0+dGFrZSgxKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAtPmFkZENvbHVtbignYWN0aW9ucycsIGZ1bmN0aW9uICgkbGVhc2UpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLmxlYXNlcy5idXR0b25zJywgWwogICAgICAgICAgICAgICAgICAgICAgICAnbGVhc2UnID0+ICRsZWFzZQogICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICAtPnJhd0NvbHVtbnMoWydsZWFzZV9jb2RlJywgJ2Ftb3VudCcsICdhY3Rpb25zJ10pCiAgICAgICAgICAgICAgICAtPnRvSnNvbigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLmxlYXNlcy5pbmRleCcsIFsKICAgICAgICAgICAgICAgICd0aXRsZScgPT4gJ0xpc3Qgb2YgTGVhc2VzJywKICAgICAgICAgICAgICAgICdoZWFkZXJDb2x1bW5zJyA9PiAkdGhpcy0+aGVhZGVyQ29sdW1ucygpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0gY2F0Y2ggKFxUaHJvd2FibGUgJHRoKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YmFja1dpdGhFcnJvcigkdGgtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBjcmVhdGUoKQogICAgewogICAgICAgIGlmKHJlcXVlc3QoKS0+aGFzKCdnZXQtY29zdC1jZW50cmVzJykpewogICAgICAgICAgICByZXR1cm4gZ2V0Q29zdENlbnRyZXModHJ1ZSwgcmVxdWVzdCgpLT5nZXQoJ2NvbXBhbnlfaWQnKSwgdHJ1ZSk7CiAgICAgICAgfQoKICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgJ3RpdGxlJyA9PiAnTmV3IExlYXNlJywKICAgICAgICAgICAgJ2NvbXBhbmllcycgPT4gQ29tcGFueTo6aGFzKCdwcm9maXRDZW50cmVzLmNvc3RDZW50cmVzJykKICAgICAgICAgICAgLT53aGVyZUhhcygndXNlcnMnLCBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ3VzZXJfaWQnLCBhdXRoKCktPnVzZXIoKS0+aWQpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAtPmdldCgpLAogICAgICAgICAgICAnc3VwcGxpZXJzJyA9PiBTdXBwbGllcnM6OndoZXJlKCdzdGF0dXMnLCAnQWN0aXZlJyktPmdldCgpLAogICAgICAgICAgICAnY3VycmVuY2llcycgPT4gQ3VycmVuY3k6OmFsbCgpLAogICAgICAgIF07CgogICAgICAgIHJldHVybiB2aWV3KCdhY2NvdW50aW5nLmJhY2tlbmQucGFnZXMubGVhc2VzLmNyZWF0ZScsICRkYXRhKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gc3RvcmUoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAkcmVxdWVzdC0+dmFsaWRhdGUoWwogICAgICAgICAgICAnY29tcGFueV9pZCcgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnc3VwcGxpZXJfaWQnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdjdXJyZW5jeV9pZCcgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2NvbnRyYWN0X3JlZmVyZW5jZScgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2Ftb3VudCcgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ3JhdGUnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICd5ZWFyJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnc3RhcnRfZGF0ZScgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ3BheV9pbnRlcnZhbCcgPT4gJ3JlcXVpcmVkJywKICAgICAgICBdKTsKCiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICB0cnl7CiAgICAgICAgICAgICRleGNoYW5nZVJhdGUgPSBnZXRFeGNoYW5nZVJhdGVzKCRyZXF1ZXN0LT5jdXJyZW5jeV9pZCwgZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPnN0YXJ0X2RhdGUpKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAkcG10ID0gY2FsY3VsYXRlUE1UKCRyZXF1ZXN0LT5hbW91bnQsICRyZXF1ZXN0LT5yYXRlLCAkcmVxdWVzdC0+eWVhcik7CiAgICAgICAgICAgIAogICAgICAgICAgICAkbGVhc2UgPSBMZWFzZTo6Y3JlYXRlKFsKICAgICAgICAgICAgICAgICdjb2RlJyA9PiBlbnRyeVVuaXF1ZUNvZGUoc3RybGVuKCdTU0wnKSsxMCwgJ1NTTC1MLScuZGF0ZSgneScsIHN0cnRvdGltZSgkcmVxdWVzdC0+c3RhcnRfZGF0ZSkpLictJywgJ2xlYXNlcycsICdjb2RlJyksCiAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRyZXF1ZXN0LT5jb3N0X2NlbnRyZV9pZCwKICAgICAgICAgICAgICAgICdzdXBwbGllcl9pZCcgPT4gJHJlcXVlc3QtPnN1cHBsaWVyX2lkLAogICAgICAgICAgICAgICAgJ2V4Y2hhbmdlX3JhdGVfaWQnID0+ICRleGNoYW5nZVJhdGVbJ3JhdGUnXS0+aWQsCiAgICAgICAgICAgICAgICAnY29udHJhY3RfaWQnID0+ICRyZXF1ZXN0LT5jb250cmFjdF9pZCwKICAgICAgICAgICAgICAgICdjb250cmFjdF9yZWZlcmVuY2UnID0+ICRyZXF1ZXN0LT5jb250cmFjdF9yZWZlcmVuY2UsCiAgICAgICAgICAgICAgICAnYW1vdW50JyA9PiAkcmVxdWVzdC0+YW1vdW50LAogICAgICAgICAgICAgICAgJ3JhdGUnID0+ICRyZXF1ZXN0LT5yYXRlLAogICAgICAgICAgICAgICAgJ2luc3RhbGxtZW50X2Ftb3VudCcgPT4gJHBtdFsnaW5zdGFsbG1lbnQnXSwKICAgICAgICAgICAgICAgICd0b3RhbF9wYXlhYmxlX2Ftb3VudCcgPT4gJHBtdFsndG90YWwnXSwKICAgICAgICAgICAgICAgICd5ZWFyJyA9PiAkcmVxdWVzdC0+eWVhciwKICAgICAgICAgICAgICAgICdzdGFydF9kYXRlJyA9PiAkcmVxdWVzdC0+c3RhcnRfZGF0ZSwKICAgICAgICAgICAgICAgICdwYXlfaW50ZXJ2YWwnID0+ICRyZXF1ZXN0LT5wYXlfaW50ZXJ2YWwsCiAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgaWYoJGxlYXNlKXsKICAgICAgICAgICAgICAgICRjb21wYW55ID0gQ29tcGFueTo6ZmluZE9yRmFpbCgkcmVxdWVzdC0+Y29tcGFueV9pZCk7CiAgICAgICAgICAgICAgICAkaXRlbXMgPSBbXTsKICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGl0ZW1zLCBbCiAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAkcmVxdWVzdC0+Y29zdF9jZW50cmVfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICRjb21wYW55LT5sZWFzZV9hc3NldF9sZWRnZXJfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAkbGVhc2UtPmFtb3VudCwKICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICJMZWFzZSBBc3NldCBEZWJpdCIsCiAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdsZWFzZScsCiAgICAgICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJGxlYXNlLT5pZAogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRpdGVtcywgWwogICAgICAgICAgICAgICAgICAgICdjb3N0X2NlbnRyZV9pZCcgPT4gJHJlcXVlc3QtPmNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkY29tcGFueS0+bGVhc2VfbGlhYmlsaXR5X2xlZGdlcl9pZCwKICAgICAgICAgICAgICAgICAgICAnZGViaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gJGxlYXNlLT5hbW91bnQsCiAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gIkxlYXNlIExpYWJpbGl0eSBDcmVkaXQiLAogICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAnbGVhc2UnLAogICAgICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRsZWFzZS0+aWQKICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgICRlbnRyeSA9IHNhdmVMZWRnZXJFbnRyaWVzKDUsIGRhdGUoJ1ktbS1kIEg6aTpzJywgc3RydG90aW1lKCRsZWFzZS0+c3RhcnRfZGF0ZSkpLCAxLCAkbGVhc2UtPmNvZGUsICJMZWFzZSB2ZW5kb3I6ICIuJGxlYXNlLT5zdXBwbGllci0+bmFtZS4iLCBDb250cmFjdCBJRDogIi4kbGVhc2UtPmNvbnRyYWN0X2lkLiIsIFJlZmVyZW5jZTogIi4kbGVhc2UtPmNvbnRyYWN0X3JlZmVyZW5jZSwgJGl0ZW1zLCAkbGVhc2UtPmV4Y2hhbmdlX3JhdGVfaWQsIDEsIGZhbHNlLCAxLCAkY29tcGFueS0+aWQpOwoKICAgICAgICAgICAgICAgIGlmIChpc3NldCgkZW50cnlbJ3N1Y2Nlc3MnXSkgJiYgJGVudHJ5WydzdWNjZXNzJ10pIHsKICAgICAgICAgICAgICAgICAgICBMZWFzZUVudHJ5OjpjcmVhdGUoWwogICAgICAgICAgICAgICAgICAgICAgICAnbGVhc2VfaWQnID0+ICRsZWFzZS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdlbnRyeV9pZCcgPT4gJGVudHJ5WydlbnRyeSddLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2xvZycgPT4gImxlYXNlLWluaXRpYXRlZCIsCiAgICAgICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgICAgICRzY2hlZHVsZXMgPSBbXTsKICAgICAgICAgICAgICAgICAgICAkZGVwcmVjaWF0aW9ucyA9IFtdOwoKICAgICAgICAgICAgICAgICAgICAkYmFsYW5jZSA9ICRyZXF1ZXN0LT5hbW91bnQ7CiAgICAgICAgICAgICAgICAgICAgJGRhdGUgPSBkYXRlKCdZLW0tMDEnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPnN0YXJ0X2RhdGUuJyAnLmxlYXNlUGF5SW50ZXJ2YWxzKClbJHJlcXVlc3QtPnBheV9pbnRlcnZhbF1bJ2ludGVydmFsJ10pKTsKICAgICAgICAgICAgICAgICAgICAkc2wgPSAwOwogICAgICAgICAgICAgICAgICAgIHdoaWxlKCRiYWxhbmNlID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICRiZWdpbiA9ICRiYWxhbmNlOwogICAgICAgICAgICAgICAgICAgICAgICAkaW50ZXJlc3QgPSAoJGJhbGFuY2UqKCRyZXF1ZXN0LT5yYXRlLzEwMCkpL2xlYXNlUGF5SW50ZXJ2YWxzKClbJHJlcXVlc3QtPnBheV9pbnRlcnZhbF1bJ2Rpdmlzb3InXTsKICAgICAgICAgICAgICAgICAgICAgICAgJHByaW5jaXBsZSA9ICRwbXRbJ2luc3RhbGxtZW50J10tJGludGVyZXN0OwogICAgICAgICAgICAgICAgICAgICAgICAkYmFsYW5jZSA9ICRiZWdpbi0kcHJpbmNpcGxlOwoKICAgICAgICAgICAgICAgICAgICAgICAgJHNsKys7CgogICAgICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRzY2hlZHVsZXMsIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsZWFzZV9pZCcgPT4gJGxlYXNlLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzZXJpYWwnID0+ICRzbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkYXRlJyA9PiAkZGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdiYWxhbmNlJyA9PiAkYmVnaW4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncHJpbmNpcGxlJyA9PiAkcHJpbmNpcGxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2ludGVyZXN0JyA9PiAkaW50ZXJlc3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY3JlYXRlZF9ieScgPT4gYXV0aCgpLT51c2VyKCktPmlkCiAgICAgICAgICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkZGVwcmVjaWF0aW9ucywgWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xlYXNlX2lkJyA9PiAkbGVhc2UtPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhdGUnID0+ICRkYXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Zyb20nID0+IGRhdGUoJ1ktbS0wMScsIHN0cnRvdGltZSgkZGF0ZSkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RvJyA9PiBkYXRlKCdZLW0tdCcsIHN0cnRvdGltZSgkZGF0ZSkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Ftb3VudCcgPT4gJGxlYXNlLT5hbW91bnQvKCRsZWFzZS0+eWVhcioxMiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiAncGVuZGluZycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY3JlYXRlZF9ieScgPT4gYXV0aCgpLT51c2VyKCktPmlkLAogICAgICAgICAgICAgICAgICAgICAgICBdKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICRkYXRlID0gZGF0ZSgnWS1tLTAxJywgc3RydG90aW1lKCRkYXRlLicgJy5sZWFzZVBheUludGVydmFscygpWyRyZXF1ZXN0LT5wYXlfaW50ZXJ2YWxdWydpbnRlcnZhbCddKSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBMZWFzZVNjaGVkdWxlOjppbnNlcnQoJHNjaGVkdWxlcyk7CiAgICAgICAgICAgICAgICAgICAgTGVhc2VEZXByZWNpYXRpb246Omluc2VydCgkZGVwcmVjaWF0aW9ucyk7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICRlbnRyeVsnbWVzc2FnZSddCiAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIERCOjpjb21taXQoKTsKICAgICAgICAgICAgc2Vzc2lvbigpLT5mbGFzaCgnYWxlcnQtdHlwZScsICdzdWNjZXNzJyk7CiAgICAgICAgICAgIHNlc3Npb24oKS0+Zmxhc2goJ21lc3NhZ2UnLCAiTGVhc2UgaGFzIGJlZW4gUG9zdGVkIFN1Y2Nlc3NmdWxseS4iKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICAgICAgICAgIF0pOwogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gc2hvdygkaWQpCiAgICB7CiAgICAgICAgJGxlYXNlID0gTGVhc2U6OndpdGgoWwogICAgICAgICAgICAnY29zdENlbnRyZS5wcm9maXRDZW50cmUuY29tcGFueScsCiAgICAgICAgICAgICdzdXBwbGllcicsCiAgICAgICAgICAgICdleGNoYW5nZVJhdGUuY3VycmVuY3knLAogICAgICAgICAgICAnZW50cmllcy5lbnRyeS5leGNoYW5nZVJhdGUnLAogICAgICAgICAgICAnc2NoZWR1bGVzLmVudHJpZXMuZW50cnkuZXhjaGFuZ2VSYXRlJywKICAgICAgICAgICAgJ2RlcHJlY2lhdGlvbnMnLAogICAgICAgICAgICAnY3JlYXRvcicsCiAgICAgICAgICAgICdlZGl0b3InCiAgICAgICAgXSktPmZpbmRPckZhaWwoJGlkKTsKICAgICAgICAkZGF0YSA9IFsKICAgICAgICAgICAgJ3RpdGxlJyA9PiAnTGVhc2UgIycuJGxlYXNlLT5jb2RlLAogICAgICAgICAgICAnbGVhc2UnID0+ICRsZWFzZQogICAgICAgIF07CgogICAgICAgIGlmKHJlcXVlc3QoKS0+aGFzKCdkZXRhaWxzJykpewogICAgICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLmxlYXNlcy5sZWFzZS1kZXRhaWxzJywgJGRhdGEpOwogICAgICAgIH0KCiAgICAgICAgaWYocmVxdWVzdCgpLT5oYXMoJ3BkZicpKXsKICAgICAgICAgICAgcmV0dXJuIGRvd25sb2FkTVBERignYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLmxlYXNlcy5sZWFzZS1wZGYnLCAkZGF0YSwgJGRhdGFbJ3RpdGxlJ10sICRkYXRhWyd0aXRsZSddLCAnYTQnLCAnTCcpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHZpZXcoJ2FjY291bnRpbmcuYmFja2VuZC5wYWdlcy5sZWFzZXMubGVhc2UnLCAkZGF0YSk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGVkaXQoJGlkKQogICAgewogICAgICAgICRzY2hlZHVsZSA9IExlYXNlU2NoZWR1bGU6OndpdGgoWwogICAgICAgICAgICAnZW50cmllcy5lbnRyeS5leGNoYW5nZVJhdGUnLAogICAgICAgICAgICAnbGVhc2UuY29zdENlbnRyZS5wcm9maXRDZW50cmUuY29tcGFueScsCiAgICAgICAgICAgICdsZWFzZS5zdXBwbGllcicsCiAgICAgICAgICAgICdsZWFzZS5leGNoYW5nZVJhdGUuY3VycmVuY3knLAogICAgICAgICAgICAnbGVhc2UuZW50cmllcy5lbnRyeS5leGNoYW5nZVJhdGUnLAogICAgICAgICAgICAnbGVhc2UuY3JlYXRvcicsCiAgICAgICAgICAgICdsZWFzZS5lZGl0b3InCiAgICAgICAgXSktPmZpbmRPckZhaWwoJGlkKTsKICAgICAgICByZXR1cm4gdmlldygnYWNjb3VudGluZy5iYWNrZW5kLnBhZ2VzLmxlYXNlcy5wYXknLCBbCiAgICAgICAgICAgICdzY2hlZHVsZScgPT4gJHNjaGVkdWxlCiAgICAgICAgXSk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHVwZGF0ZShSZXF1ZXN0ICRyZXF1ZXN0LCAkaWQpCiAgICB7CiAgICAgICAgaWYoJHJlcXVlc3QtPmhhcygncG9zdCcpKXsKICAgICAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgdHJ5ewogICAgICAgICAgICAgICAgJGFjY291bnREZWZhdWx0U2V0dGluZ3MgPSBhY2NvdW50RGVmYXVsdFNldHRpbmdzKCk7CiAgICAgICAgICAgICAgICAkc2NoZWR1bGUgPSBMZWFzZVNjaGVkdWxlOjp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAnbGVhc2UuY29zdENlbnRyZS5wcm9maXRDZW50cmUnLAogICAgICAgICAgICAgICAgICAgICdsZWFzZS5zdXBwbGllcicsCiAgICAgICAgICAgICAgICBdKS0+ZmluZE9yRmFpbCgkaWQpOwogICAgICAgICAgICAgICAgJHNjaGVkdWxlLT5zdGF0dXMgPSAncG9zdGVkJzsKICAgICAgICAgICAgICAgICRzY2hlZHVsZS0+c2F2ZSgpOwogICAgICAgICAgICAgICAgaWYoJHNjaGVkdWxlKXsKICAgICAgICAgICAgICAgICAgICAkY29tcGFueSA9IENvbXBhbnk6OmZpbmRPckZhaWwoJHNjaGVkdWxlLT5sZWFzZS0+Y29zdENlbnRyZS0+cHJvZml0Q2VudHJlLT5jb21wYW55X2lkKTsKICAgICAgICAgICAgICAgICAgICAkaXRlbXMgPSBbXTsKICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRpdGVtcywgWwogICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRzY2hlZHVsZS0+bGVhc2UtPmNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJGNvbXBhbnktPmxlYXNlX2V4cGVuc2VfbGVkZ2VyX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAnZGViaXQnID0+ICRzY2hlZHVsZS0+aW50ZXJlc3QsCiAgICAgICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICJJbnRlcmVzdCBFeHBlbnNlIERlYml0IiwKICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdsZWFzZS1zY2hlZHVsZScsCiAgICAgICAgICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRzY2hlZHVsZS0+aWQKICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRpdGVtcywgWwogICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRzY2hlZHVsZS0+bGVhc2UtPmNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJGNvbXBhbnktPmxlYXNlX2xpYWJpbGl0eV9sZWRnZXJfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gJHNjaGVkdWxlLT5wcmluY2lwbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICJMZWFzZSBQcmluY2lwbGUgTGlhYmlsaXR5IERlYml0IiwKICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdsZWFzZS1zY2hlZHVsZScsCiAgICAgICAgICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRzY2hlZHVsZS0+aWQKICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRpdGVtcywgWwogICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRzY2hlZHVsZS0+bGVhc2UtPmNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gKGlzc2V0KCRzY2hlZHVsZS0+bGVhc2UtPnN1cHBsaWVyLT5wYXlhYmxlX2FjY291bnRfaWQpICYmICRzY2hlZHVsZS0+bGVhc2UtPnN1cHBsaWVyLT5wYXlhYmxlX2FjY291bnRfaWQgPiAwID8gJHNjaGVkdWxlLT5sZWFzZS0+c3VwcGxpZXItPnBheWFibGVfYWNjb3VudF9pZCA6ICRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydzdXBwbGllcl9wYXlhYmxlX2FjY291bnQnXSksCiAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gJHNjaGVkdWxlLT5pbnRlcmVzdCskc2NoZWR1bGUtPnByaW5jaXBsZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gIlBheWFibGUgdG8gTGVhc29yIFZlbmRvciBDcmVkaXQiLAogICAgICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJ2xlYXNlLXNjaGVkdWxlJywKICAgICAgICAgICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJHNjaGVkdWxlLT5pZAogICAgICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgICAgICAkZW50cnkgPSBzYXZlTGVkZ2VyRW50cmllcyg1LCBkYXRlKCdZLW0tZCBIOmk6cycsIHN0cnRvdGltZSgkc2NoZWR1bGUtPmRhdGUpKSwgMSwgJHNjaGVkdWxlLT5pZCwgIkxlYXNlIHZlbmRvcjogIi4kc2NoZWR1bGUtPmxlYXNlLT5zdXBwbGllci0+bmFtZS4iLCBDb250cmFjdCBJRDogIi4kc2NoZWR1bGUtPmxlYXNlLT5jb250cmFjdF9pZC4iLCBSZWZlcmVuY2U6ICIuJHNjaGVkdWxlLT5sZWFzZS0+Y29udHJhY3RfcmVmZXJlbmNlLiIsIEluc3RhbGxtZW50OiAiLiRzY2hlZHVsZS0+c2VyaWFsLCAkaXRlbXMsICRzY2hlZHVsZS0+bGVhc2UtPmV4Y2hhbmdlX3JhdGVfaWQsIDEsIGZhbHNlLCAxLCAkY29tcGFueS0+aWQpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNzZXQoJGVudHJ5WydzdWNjZXNzJ10pICYmICRlbnRyeVsnc3VjY2VzcyddKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExlYXNlRW50cnk6OmNyZWF0ZShbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbGVhc2VfaWQnID0+ICRzY2hlZHVsZS0+bGVhc2VfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbGVhc2Vfc2NoZWR1bGVfaWQnID0+ICRzY2hlZHVsZS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZW50cnlfaWQnID0+ICRlbnRyeVsnZW50cnknXS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbG9nJyA9PiAiaW5zdGFsbG1lbnQtcG9zdGVkIiwKICAgICAgICAgICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uKCktPmZsYXNoKCdhbGVydC10eXBlJywgJ3N1Y2Nlc3MnKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbigpLT5mbGFzaCgnbWVzc2FnZScsICJJbnN0YWxsbWVudCBoYXMgYmVlbiBQb3N0ZWQuIik7CiAgICAgICAgICAgICAgICAgICAgICAgIERCOjpjb21taXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkZW50cnlbJ21lc3NhZ2UnXQogICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJTb21ldGhpbmcgd2VudCB3cm9uZyEiCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJHJlcXVlc3QtPnZhbGlkYXRlKFsKICAgICAgICAgICAgJ2RhdGV0aW1lJyA9PiAncmVxdWlyZWQnLAogICAgICAgIF0pOwoKICAgICAgICBpZiAoaW5fYXJyYXkoJHJlcXVlc3QtPnBheW1lbnRfdHlwZSwgWydjaGVxdWUnLCAnZnVuZC10cmFuc2ZlciddKSkgewogICAgICAgICAgICAkcmVxdWVzdC0+dmFsaWRhdGUoWwogICAgICAgICAgICAgICAgJ3BheW1lbnRfZGV0YWlscycgPT4gJ3JlcXVpcmVkJwogICAgICAgICAgICBdKTsKICAgICAgICB9CgogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7CiAgICAgICAgdHJ5ewogICAgICAgICAgICAkYWNjb3VudERlZmF1bHRTZXR0aW5ncyA9IGFjY291bnREZWZhdWx0U2V0dGluZ3MoKTsKICAgICAgICAgICAgJHNjaGVkdWxlID0gTGVhc2VTY2hlZHVsZTo6d2l0aChbCiAgICAgICAgICAgICAgICAnbGVhc2UuY29zdENlbnRyZS5wcm9maXRDZW50cmUnLAogICAgICAgICAgICAgICAgJ2xlYXNlLnN1cHBsaWVyJywKICAgICAgICAgICAgXSktPmZpbmRPckZhaWwoJGlkKTsKICAgICAgICAgICAgJHNjaGVkdWxlLT5zdGF0dXMgPSAncGFpZCc7CiAgICAgICAgICAgICRzY2hlZHVsZS0+c2F2ZSgpOwogICAgICAgICAgICBpZigkc2NoZWR1bGUpewogICAgICAgICAgICAgICAgJGNvbXBhbnkgPSBDb21wYW55OjpmaW5kT3JGYWlsKCRzY2hlZHVsZS0+bGVhc2UtPmNvc3RDZW50cmUtPnByb2ZpdENlbnRyZS0+Y29tcGFueV9pZCk7CiAgICAgICAgICAgICAgICAkaXRlbXMgPSBbXTsKICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGl0ZW1zLCBbCiAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAkc2NoZWR1bGUtPmxlYXNlLT5jb3N0X2NlbnRyZV9pZCwKICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gKGlzc2V0KCRzY2hlZHVsZS0+bGVhc2UtPnN1cHBsaWVyLT5wYXlhYmxlX2FjY291bnRfaWQpICYmICRzY2hlZHVsZS0+bGVhc2UtPnN1cHBsaWVyLT5wYXlhYmxlX2FjY291bnRfaWQgPiAwID8gJHNjaGVkdWxlLT5sZWFzZS0+c3VwcGxpZXItPnBheWFibGVfYWNjb3VudF9pZCA6ICRhY2NvdW50RGVmYXVsdFNldHRpbmdzWydzdXBwbGllcl9wYXlhYmxlX2FjY291bnQnXSksCiAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAkc2NoZWR1bGUtPmludGVyZXN0KyRzY2hlZHVsZS0+cHJpbmNpcGxlLAogICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gIlBheWFibGUgdG8gTGVhc29yIFZlbmRvciBEZWJpdCIsCiAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdsZWFzZS1zY2hlZHVsZScsCiAgICAgICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJHNjaGVkdWxlLT5pZAogICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgJGNyZWRpdF9ub3RlID0gIkNhc2giOwogICAgICAgICAgICAgICAgJGNyZWRpdF9hY2NvdW50ID0gJHJlcXVlc3QtPmNoYXJ0X29mX2FjY291bnRfaWQ7CiAgICAgICAgICAgICAgICBpZiAoJHJlcXVlc3QtPnBheW1lbnRfdHlwZSA9PSAnY2FzaCcpIHsKICAgICAgICAgICAgICAgICAgICAkY3JlZGl0X2FjY291bnQgPSAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snY2FzaF9pbl9oYW5kX2FjY291bnQnXTsKICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkcmVxdWVzdC0+cGF5bWVudF90eXBlID09ICdjaGVxdWUnIHx8ICRyZXF1ZXN0LT5wYXltZW50X3R5cGUgPT0gJ2Z1bmQtdHJhbnNmZXInKSB7CiAgICAgICAgICAgICAgICAgICAgJGJhbmtBY2NvdW50ID0gQmFua0FjY291bnQ6OmZpbmQoJHJlcXVlc3QtPmJhbmtfYWNjb3VudF9pZCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRiYW5rQWNjb3VudC0+Y2hhcnRfb2ZfYWNjb3VudF9pZCkgJiYgJGJhbmtBY2NvdW50LT5jaGFydF9vZl9hY2NvdW50X2lkID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAkY3JlZGl0X2FjY291bnQgPSAkYmFua0FjY291bnQtPmNoYXJ0X29mX2FjY291bnRfaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICRjcmVkaXRfbm90ZSA9ICRiYW5rQWNjb3VudC0+YmFua0JyYW5jaC0+YmFuay0+bmFtZTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkY3JlZGl0X2FjY291bnQgPSAkYWNjb3VudERlZmF1bHRTZXR0aW5nc1snYmFua19hY2NvdW50J107CiAgICAgICAgICAgICAgICAgICAgICAgICRjcmVkaXRfbm90ZSA9ICJCYW5rIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkaXRlbXMsIFsKICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRzY2hlZHVsZS0+bGVhc2UtPmNvc3RfY2VudHJlX2lkLAogICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkY3JlZGl0X2FjY291bnQsCiAgICAgICAgICAgICAgICAgICAgJ2RlYml0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+ICRzY2hlZHVsZS0+aW50ZXJlc3QrJHNjaGVkdWxlLT5wcmluY2lwbGUsCiAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJGNyZWRpdF9ub3RlLiIgQ3JlZGl0IiwKICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJ2xlYXNlLXNjaGVkdWxlJywKICAgICAgICAgICAgICAgICAgICAnc291cmNlJyA9PiAkc2NoZWR1bGUtPmlkCiAgICAgICAgICAgICAgICBdKTsKCiAgICAgICAgICAgICAgICAkZW50cnkgPSBzYXZlTGVkZ2VyRW50cmllcyg0LCBkYXRlKCdZLW0tZCBIOmk6cycsIHN0cnRvdGltZSgkcmVxdWVzdC0+ZGF0ZXRpbWUpKSwgMSwgJHNjaGVkdWxlLT5pZCwgIkxlYXNlIHZlbmRvcjogIi4kc2NoZWR1bGUtPmxlYXNlLT5zdXBwbGllci0+bmFtZS4iLCBDb250cmFjdCBJRDogIi4kc2NoZWR1bGUtPmxlYXNlLT5jb250cmFjdF9pZC4iLCBSZWZlcmVuY2U6ICIuJHNjaGVkdWxlLT5sZWFzZS0+Y29udHJhY3RfcmVmZXJlbmNlLiIsIEluc3RhbGxtZW50OiAiLiRzY2hlZHVsZS0+c2VyaWFsLCAkaXRlbXMsICRzY2hlZHVsZS0+bGVhc2UtPmV4Y2hhbmdlX3JhdGVfaWQsIDEsIGZhbHNlLCAxLCAkY29tcGFueS0+aWQpOwoKICAgICAgICAgICAgICAgIGlmIChpc3NldCgkZW50cnlbJ3N1Y2Nlc3MnXSkgJiYgJGVudHJ5WydzdWNjZXNzJ10pIHsKICAgICAgICAgICAgICAgICAgICBMZWFzZUVudHJ5OjpjcmVhdGUoWwogICAgICAgICAgICAgICAgICAgICAgICAnbGVhc2VfaWQnID0+ICRzY2hlZHVsZS0+bGVhc2VfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdsZWFzZV9zY2hlZHVsZV9pZCcgPT4gJHNjaGVkdWxlLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2VudHJ5X2lkJyA9PiAkZW50cnlbJ2VudHJ5J10tPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAnbG9nJyA9PiAiaW5zdGFsbG1lbnQtcGFpZCIsCiAgICAgICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgICAgIHNlc3Npb24oKS0+Zmxhc2goJ2FsZXJ0LXR5cGUnLCAnc3VjY2VzcycpOwogICAgICAgICAgICAgICAgICAgIHNlc3Npb24oKS0+Zmxhc2goJ21lc3NhZ2UnLCAiSW5zdGFsbG1lbnQgaGFzIGJlZW4gUGFpZC4iKTsKICAgICAgICAgICAgICAgICAgICBEQjo6Y29tbWl0KCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICRlbnRyeVsnbWVzc2FnZSddCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJTb21ldGhpbmcgd2VudCB3cm9uZyEiCiAgICAgICAgICAgIF0pOwogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICBEQjo6cm9sbGJhY2soKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgIF0pOwogICAgICAgIH0KICAgIH0KfQo=