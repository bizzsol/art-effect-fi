<?php
bolt_decrypt( __FILE__ , 'etT1HZ'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcQVBJOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKdXNlIERCOwoKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xBY2NvdW50Q2xhc3M7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQWNjb3VudEdyb3VwOwp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXENoYXJ0T2ZBY2NvdW50OwoKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDb21wYW55Owp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXFByb2ZpdENlbnRyZTsKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDb3N0Q2VudHJlOwp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEVudHJ5VHlwZTsKCnVzZSBcQXBwXE1vZGVsc1xGaXhlZEFzc2V0c1xGaXhlZEFzc2V0TG9jYXRpb247Cgp1c2UgXEFwcFxNb2RlbHNcRml4ZWRBc3NldHNcRGVwcmVjaWF0aW9uTWV0aG9kOwoKY2xhc3MgU2V0dGluZ3NDb250cm9sbGVyIGV4dGVuZHMgQ29udHJvbGxlcgp7CiAgICAvKioKICAgICAqIEFjY291bnRzIFNldHRpbmdzCiAgICAgKiAKICAgICAqIEdldCBMaXN0IG9mIGFsbCBBY2NvdW50cyBTZXR0aW5ncy4KICAgICAqIAogICAgICogQHF1ZXJ5UGFyYW0gdG9rZW4gc3RyaW5nIHJlcXVpcmVkIEF1dGhlbnRpY2F0aW9uIFRva2VuIExpc3Qgd291bGQgYmUgcHJvdmlkZWQgYnkgQklaWlNPTCBFeGFtcGxlOiBhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5emFiY2RlZgogICAgICogCiAgICAgKiBAZ3JvdXAgQWNjb3VudHMgU2V0dGluZ3MKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0dGluZ3MoUmVxdWVzdCAkcmVxdWVzdCl7CiAgICAgICAgdHJ5ewogICAgICAgICAgICAkc2V0dGluZ3MgPSBhY2NvdW50RGVmYXVsdFNldHRpbmdzKCk7CgogICAgICAgICAgICAkc2V0dGluZ3NbJ2JhbGFuY2Vfc2hlZXRfaXRlbXMnXSA9IEFjY291bnRDbGFzczo6d2hlcmVJbignaWQnLCBqc29uX2RlY29kZSgkc2V0dGluZ3NbJ2JhbGFuY2Vfc2hlZXRfaXRlbXMnXSwgdHJ1ZSkpLT5nZXQoWwogICAgICAgICAgICAgICAgJ2lkJywgJ25hbWUnLCAnZGVzYycKICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAkc2V0dGluZ3NbJ3Byb2ZpdF9sb3NzX2l0ZW1zJ10gPSBBY2NvdW50Q2xhc3M6OndoZXJlSW4oJ2lkJywganNvbl9kZWNvZGUoJHNldHRpbmdzWydwcm9maXRfbG9zc19pdGVtcyddLCB0cnVlKSktPmdldChbCiAgICAgICAgICAgICAgICAnaWQnLCAnbmFtZScsICdkZXNjJwogICAgICAgICAgICBdKTsKCiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICdzdGF0dXNfY29kZScgPT4gMjAwLAogICAgICAgICAgICAgICAgJ2RhdGEnID0+ICRzZXR0aW5ncywKICAgICAgICAgICAgXSwgMjAwKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnc3RhdHVzX2NvZGUnID0+IDUwMCwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkdGgtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICBdLCA1MDApOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENvbXBhbmllcwogICAgICogCiAgICAgKiBHZXQgTGlzdCBvZiBDb21wYW5pZXMuCiAgICAgKiAKICAgICAqIEBxdWVyeVBhcmFtIHRva2VuIHN0cmluZyByZXF1aXJlZCBBdXRoZW50aWNhdGlvbiBUb2tlbiBMaXN0IHdvdWxkIGJlIHByb3ZpZGVkIGJ5IEJJWlpTT0wgRXhhbXBsZTogYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXphYmNkZWYKICAgICAqIEBxdWVyeVBhcmFtIGlkIGludGVnZXIgQ29tcGFueSBJRCAgRXhhbXBsZTogMAogICAgICogCiAgICAgKiBAZ3JvdXAgQ29tcGFuaWVzCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNvbXBhbmllcyhSZXF1ZXN0ICRyZXF1ZXN0KXsKICAgICAgICB0cnl7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICdzdGF0dXNfY29kZScgPT4gMjAwLAogICAgICAgICAgICAgICAgJ2RhdGEnID0+IENvbXBhbnk6OmhhcygncHJvZml0Q2VudHJlcy5jb3N0Q2VudHJlcycpCiAgICAgICAgICAgICAgICAtPndpdGgoWwogICAgICAgICAgICAgICAgICAgICdwcm9maXRDZW50cmVzLmNvc3RDZW50cmVzLmNoYXJ0T2ZBY2NvdW50JwogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+d2hlbihpc3NldCgkcmVxdWVzdC0+aWQpICYmICRyZXF1ZXN0LT5pZCA+IDAsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRyZXF1ZXN0KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaWQnLCAkcmVxdWVzdC0+aWQpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+Z2V0KCkKICAgICAgICAgICAgXSwgMjAwKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnc3RhdHVzX2NvZGUnID0+IDUwMCwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkdGgtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICBdLCA1MDApOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFByb2ZpdCBDZW50cmVzCiAgICAgKiAKICAgICAqIEdldCBMaXN0IG9mIFByb2ZpdCBDZW50cmVzLgogICAgICogCiAgICAgKiBAcXVlcnlQYXJhbSB0b2tlbiBzdHJpbmcgcmVxdWlyZWQgQXV0aGVudGljYXRpb24gVG9rZW4gTGlzdCB3b3VsZCBiZSBwcm92aWRlZCBieSBCSVpaU09MIEV4YW1wbGU6IGFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6YWJjZGVmCiAgICAgKiBAcXVlcnlQYXJhbSBpZCBpbnRlZ2VyIENvc3QgQ2VudHJlIElEICBFeGFtcGxlOiAwCiAgICAgKiBAcXVlcnlQYXJhbSBjb21wYW55X2lkIGludGVnZXIgQ29tcGFueSBJRCAgRXhhbXBsZTogMAogICAgICogQHF1ZXJ5UGFyYW0gaHJfdW5pdF9pZCBpbnRlZ2VyIFVuaXQgSUQgIEV4YW1wbGU6IDAKICAgICAqIEBxdWVyeVBhcmFtIGhyX2RlcGFydG1lbnRfaWQgaW50ZWdlciBEZXBhcnRtZW50IElEICBFeGFtcGxlOiAwCiAgICAgKiAKICAgICAqIEBncm91cCBQcm9maXQgQ2VudHJlcwogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBwcm9maXRDZW50cmVzKFJlcXVlc3QgJHJlcXVlc3QpewogICAgICAgIHRyeXsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ3N0YXR1c19jb2RlJyA9PiAyMDAsCiAgICAgICAgICAgICAgICAnZGF0YScgPT4gUHJvZml0Q2VudHJlOjp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAnY29tcGFueScgPT4gZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+c2VsZWN0KCdpZCcsICdjb2RlJywgJ25hbWUnLCAnb3duZXJfbmFtZScsICdwaG9uZScsICdlbWFpbCcsICdhZGRyZXNzJywgJ2xvZ28nLCAnYmFubmVyJyk7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAtPndoZW4oaXNzZXQoJHJlcXVlc3QtPmlkKSAmJiAkcmVxdWVzdC0+aWQgPiAwLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcmVxdWVzdCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lkJywgJHJlcXVlc3QtPmlkKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oaXNzZXQoJHJlcXVlc3QtPmNvbXBhbnlfaWQpICYmICRyZXF1ZXN0LT5jb21wYW55X2lkID4gMCwgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHJlcXVlc3QpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdjb21wYW55X2lkJywgJHJlcXVlc3QtPmNvbXBhbnlfaWQpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+Z2V0KCkKICAgICAgICAgICAgXSwgMjAwKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnc3RhdHVzX2NvZGUnID0+IDUwMCwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkdGgtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICBdLCA1MDApOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENvc3QgQ2VudHJlcwogICAgICogCiAgICAgKiBHZXQgTGlzdCBvZiBDb3N0IENlbnRyZXMuCiAgICAgKiAKICAgICAqIEBxdWVyeVBhcmFtIHRva2VuIHN0cmluZyByZXF1aXJlZCBBdXRoZW50aWNhdGlvbiBUb2tlbiBMaXN0IHdvdWxkIGJlIHByb3ZpZGVkIGJ5IEJJWlpTT0wgRXhhbXBsZTogYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXphYmNkZWYKICAgICAqIEBxdWVyeVBhcmFtIGlkIGludGVnZXIgQ29zdCBDZW50cmUgSUQgIEV4YW1wbGU6IDAKICAgICAqIEBxdWVyeVBhcmFtIGNvbXBhbnlfaWQgaW50ZWdlciBDb21wYW55IElEICBFeGFtcGxlOiAwCiAgICAgKiBAcXVlcnlQYXJhbSBwcm9maXRfY2VudHJlX2lkIGludGVnZXIgUHJvZml0IENlbnRyZSBJRCAgRXhhbXBsZTogMAogICAgICogQHF1ZXJ5UGFyYW0gaHJfdW5pdF9pZCBpbnRlZ2VyIFVuaXQgSUQgIEV4YW1wbGU6IDAKICAgICAqIEBxdWVyeVBhcmFtIGhyX2RlcGFydG1lbnRfaWQgaW50ZWdlciBEZXBhcnRtZW50IElEICBFeGFtcGxlOiAwCiAgICAgKiAKICAgICAqIEBncm91cCBDb3N0IENlbnRyZXMKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY29zdENlbnRyZXMoUmVxdWVzdCAkcmVxdWVzdCl7CiAgICAgICAgdHJ5ewogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICdzdGF0dXMnID0+IHRydWUsCiAgICAgICAgICAgICAgICAnc3RhdHVzX2NvZGUnID0+IDIwMCwKICAgICAgICAgICAgICAgICdkYXRhJyA9PiBDb3N0Q2VudHJlOjp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAnY2hhcnRPZkFjY291bnQnLAogICAgICAgICAgICAgICAgICAgICdwcm9maXRDZW50cmUuY29tcGFueScgPT4gZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+c2VsZWN0KCdpZCcsICdjb2RlJywgJ25hbWUnLCAnb3duZXJfbmFtZScsICdwaG9uZScsICdlbWFpbCcsICdhZGRyZXNzJywgJ2xvZ28nLCAnYmFubmVyJyk7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAndW5pdCcgPT4gZnVuY3Rpb24oJHF1ZXJ5KXsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+c2VsZWN0KCdocl91bml0X2lkJywgJ2hyX3VuaXRfc2hvcnRfbmFtZScsICdocl91bml0X25hbWUnKTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICdkZXBhcnRtZW50JyA9PiBmdW5jdGlvbigkcXVlcnkpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT5zZWxlY3QoJ2hyX2RlcGFydG1lbnRfaWQnLCAnaHJfZGVwYXJ0bWVudF9jb2RlJywgJ2hyX2RlcGFydG1lbnRfbmFtZScpOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVuKGlzc2V0KCRyZXF1ZXN0LT5pZCkgJiYgJHJlcXVlc3QtPmlkID4gMCwgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHJlcXVlc3QpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdpZCcsICRyZXF1ZXN0LT5pZCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKGlzc2V0KCRyZXF1ZXN0LT5jb21wYW55X2lkKSAmJiAkcmVxdWVzdC0+Y29tcGFueV9pZCA+IDAsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRyZXF1ZXN0KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZUhhcygncHJvZml0Q2VudHJlJywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHJlcXVlc3QpewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnY29tcGFueV9pZCcsICRyZXF1ZXN0LT5jb21wYW55X2lkKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oaXNzZXQoJHJlcXVlc3QtPnByb2ZpdF9jZW50cmVfaWQpICYmICRyZXF1ZXN0LT5wcm9maXRfY2VudHJlX2lkID4gMCwgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHJlcXVlc3QpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdwcm9maXRfY2VudHJlX2lkJywgJHJlcXVlc3QtPnByb2ZpdF9jZW50cmVfaWQpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbihpc3NldCgkcmVxdWVzdC0+aHJfdW5pdF9pZCkgJiYgJHJlcXVlc3QtPmhyX3VuaXRfaWQgPiAwLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcmVxdWVzdCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2hyX3VuaXRfaWQnLCAkcmVxdWVzdC0+aHJfdW5pdF9pZCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT53aGVuKGlzc2V0KCRyZXF1ZXN0LT5ocl9kZXBhcnRtZW50X2lkKSAmJiAkcmVxdWVzdC0+aHJfZGVwYXJ0bWVudF9pZCA+IDAsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRyZXF1ZXN0KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaHJfZGVwYXJ0bWVudF9pZCcsICRyZXF1ZXN0LT5ocl9kZXBhcnRtZW50X2lkKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPmdldCgpCiAgICAgICAgICAgIF0sIDIwMCk7CiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdzdGF0dXMnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ3N0YXR1c19jb2RlJyA9PiA1MDAsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJHRoLT5nZXRNZXNzYWdlKCkKICAgICAgICAgICAgXSwgNTAwKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGdldENvc3RDZW50cmVzKFJlcXVlc3QgJHJlcXVlc3QpewogICAgICAgIHRyeXsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ3N0YXR1c19jb2RlJyA9PiAyMDAsCiAgICAgICAgICAgICAgICAnZGF0YScgPT4gZ2V0Q29zdENlbnRyZXMoJHJlcXVlc3QtPmxlZGdlciwgJHJlcXVlc3QtPmlkKQogICAgICAgICAgICBdLCAyMDApOwogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdzdGF0dXNfY29kZScgPT4gNTAwLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgIF0sIDUwMCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRBbGxHcm91cEFuZExlZGdlcnMoUmVxdWVzdCAkcmVxdWVzdCl7CiAgICAgICAgdHJ5ewogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICdzdGF0dXMnID0+IHRydWUsCiAgICAgICAgICAgICAgICAnc3RhdHVzX2NvZGUnID0+IDIwMCwKICAgICAgICAgICAgICAgICdkYXRhJyA9PiBnZXRBbGxHcm91cEFuZExlZGdlcnMoKQogICAgICAgICAgICBdLCAyMDApOwogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdzdGF0dXNfY29kZScgPT4gNTAwLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgIF0sIDUwMCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBjaGFydE9mQWNjb3VudHNPcHRpb25zKFJlcXVlc3QgJHJlcXVlc3QpewogICAgICAgIHRyeXsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ3N0YXR1c19jb2RlJyA9PiAyMDAsCiAgICAgICAgICAgICAgICAnZGF0YScgPT4gY2hhcnRPZkFjY291bnRzT3B0aW9ucygkcmVxdWVzdC0+Z3JvdXBzLCAkcmVxdWVzdC0+Y2hvc2VuLCAkcmVxdWVzdC0+c3RlcCwgJHJlcXVlc3QtPmFsbCwgZmFsc2UsICcnLCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICBdLCAyMDApOwogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdzdGF0dXNfY29kZScgPT4gNTAwLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgIF0sIDUwMCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRW50cnkgVHlwZXMKICAgICAqIAogICAgICogR2V0IExpc3Qgb2YgRW50cnkgVHlwZXMuCiAgICAgKiAKICAgICAqIEBxdWVyeVBhcmFtIHRva2VuIHN0cmluZyByZXF1aXJlZCBBdXRoZW50aWNhdGlvbiBUb2tlbiBMaXN0IHdvdWxkIGJlIHByb3ZpZGVkIGJ5IEJJWlpTT0wgRXhhbXBsZTogYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXphYmNkZWYKICAgICAqIEBxdWVyeVBhcmFtIGlkIGludGVnZXIgRW50cnkgVHlwZSBJRCAgRXhhbXBsZTogMAogICAgICogCiAgICAgKiBAZ3JvdXAgRW50cnkgVHlwZXMKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZW50cnlUeXBlcyhSZXF1ZXN0ICRyZXF1ZXN0KXsKICAgICAgICB0cnl7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICdzdGF0dXNfY29kZScgPT4gMjAwLAogICAgICAgICAgICAgICAgJ2RhdGEnID0+IEVudHJ5VHlwZTo6d2hlbihpc3NldCgkcmVxdWVzdC0+aWQpICYmICRyZXF1ZXN0LT5pZCA+IDAsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRyZXF1ZXN0KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnaWQnLCAkcmVxdWVzdC0+aWQpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+Z2V0KFsKICAgICAgICAgICAgICAgICAgICAnaWQnLCAnbGFiZWwnLCAnbmFtZScsICdkZXNjcmlwdGlvbicsICdwcmVmaXgnLCAnc3VmZml4JywKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgIF0sIDIwMCk7CiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdzdGF0dXMnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ3N0YXR1c19jb2RlJyA9PiA1MDAsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJHRoLT5nZXRNZXNzYWdlKCkKICAgICAgICAgICAgXSwgNTAwKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBGaXhlZCBBc3NldCBMb2NhdGlvbnMKICAgICAqIAogICAgICogR2V0IExpc3Qgb2YgRml4ZWQgQXNzZXQgTG9jYXRpb25zLgogICAgICogCiAgICAgKiBAcXVlcnlQYXJhbSB0b2tlbiBzdHJpbmcgcmVxdWlyZWQgQXV0aGVudGljYXRpb24gVG9rZW4gTGlzdCB3b3VsZCBiZSBwcm92aWRlZCBieSBCSVpaU09MIEV4YW1wbGU6IGFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6YWJjZGVmCiAgICAgKiBAcXVlcnlQYXJhbSBpZCBpbnRlZ2VyIEVudHJ5IFR5cGUgSUQgIEV4YW1wbGU6IDAKICAgICAqIEBxdWVyeVBhcmFtIHVuaXRfaWQgaW50ZWdlciBVbml0IElEICBFeGFtcGxlOiAwCiAgICAgKiBAcXVlcnlQYXJhbSBjYXRlZ29yeV9pZCBpbnRlZ2VyIENhdGVnb3J5IElEICBFeGFtcGxlOiAwCiAgICAgKiAKICAgICAqIEBncm91cCBGaXhlZCBBc3NldCBMb2NhdGlvbnMKICAgICAqIEByZXR1cm4gXElsbHVtaW5hdGVcSHR0cFxSZXNwb25zZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZml4ZWRBc3NldExvY2F0aW9ucyhSZXF1ZXN0ICRyZXF1ZXN0KXsKICAgICAgICB0cnl7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICdzdGF0dXNfY29kZScgPT4gMjAwLAogICAgICAgICAgICAgICAgJ2RhdGEnID0+IEZpeGVkQXNzZXRMb2NhdGlvbjo6d2l0aChbCiAgICAgICAgICAgICAgICAgICAgJ3VuaXQnID0+IGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPnNlbGVjdCgnaHJfdW5pdF9pZCcsICdocl91bml0X3Nob3J0X25hbWUnLCAnaHJfdW5pdF9uYW1lJyk7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAnY2F0ZWdvcnknID0+IGZ1bmN0aW9uKCRxdWVyeSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPnNlbGVjdCgnaWQnLCAnY29kZScsICduYW1lJywgJ3BhcmVudF9pZCcsICd0eXBlJyk7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAtPndoZW4oaXNzZXQoJHJlcXVlc3QtPmlkKSAmJiAkcmVxdWVzdC0+aWQgPiAwLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcmVxdWVzdCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2lkJywgJHJlcXVlc3QtPmlkKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oaXNzZXQoJHJlcXVlc3QtPnVuaXRfaWQpICYmICRyZXF1ZXN0LT51bml0X2lkID4gMCwgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHJlcXVlc3QpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCd1bml0X2lkJywgJHJlcXVlc3QtPnVuaXRfaWQpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbihpc3NldCgkcmVxdWVzdC0+Y2F0ZWdvcnlfaWQpICYmICRyZXF1ZXN0LT5jYXRlZ29yeV9pZCA+IDAsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRyZXF1ZXN0KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnY2F0ZWdvcnlfaWQnLCAkcmVxdWVzdC0+Y2F0ZWdvcnlfaWQpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+Z2V0KCkKICAgICAgICAgICAgXSwgMjAwKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnc3RhdHVzX2NvZGUnID0+IDUwMCwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkdGgtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICBdLCA1MDApOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIERlcHJlY2lhdGlvbiBNZXRob2RzCiAgICAgKiAKICAgICAqIEdldCBMaXN0IG9mIERlcHJlY2lhdGlvbiBNZXRob2RzLgogICAgICogCiAgICAgKiBAcXVlcnlQYXJhbSB0b2tlbiBzdHJpbmcgcmVxdWlyZWQgQXV0aGVudGljYXRpb24gVG9rZW4gTGlzdCB3b3VsZCBiZSBwcm92aWRlZCBieSBCSVpaU09MIEV4YW1wbGU6IGFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6YWJjZGVmCiAgICAgKiAKICAgICAqIEBncm91cCBEZXByZWNpYXRpb24gTWV0aG9kcwogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBkZXByZWNpYXRpb25NZXRob2RzKFJlcXVlc3QgJHJlcXVlc3QpewogICAgICAgIHRyeXsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ3N0YXR1c19jb2RlJyA9PiAyMDAsCiAgICAgICAgICAgICAgICAnZGF0YScgPT4gRGVwcmVjaWF0aW9uTWV0aG9kOjp3aGVyZSgnc3RhdHVzJywgMSktPmdldCgpCiAgICAgICAgICAgIF0sIDIwMCk7CiAgICAgICAgfWNhdGNoIChcVGhyb3dhYmxlICR0aCl7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdzdGF0dXMnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ3N0YXR1c19jb2RlJyA9PiA1MDAsCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJHRoLT5nZXRNZXNzYWdlKCkKICAgICAgICAgICAgXSwgNTAwKTsKICAgICAgICB9CiAgICB9Cn0K