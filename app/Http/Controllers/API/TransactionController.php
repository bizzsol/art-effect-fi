<?php
bolt_decrypt( __FILE__ , 'OKqEkE'); return 0;
##!!!##CgpuYW1lc3BhY2UgQXBwXEh0dHBcQ29udHJvbGxlcnNcQVBJOwoKdXNlIEFwcFxIdHRwXENvbnRyb2xsZXJzXENvbnRyb2xsZXI7CnVzZSBJbGx1bWluYXRlXEh0dHBcUmVxdWVzdDsKdXNlIERCOwoKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xBY2NvdW50Q2xhc3M7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQWNjb3VudEdyb3VwOwp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXENoYXJ0T2ZBY2NvdW50OwoKdXNlIFxBcHBcTW9kZWxzXFBtc01vZGVsc1xBY2NvdW50c1xDb21wYW55Owp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXENvc3RDZW50cmU7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcRW50cnlUeXBlOwp1c2UgXEFwcFxNb2RlbHNcUG1zTW9kZWxzXEFjY291bnRzXEZpc2NhbFllYXI7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcRW50cnk7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcRW50cnlMb2c7CnVzZSBcQXBwXE1vZGVsc1xQbXNNb2RlbHNcQWNjb3VudHNcQ3VycmVuY3k7Cgp1c2UgXEFwcFxNb2RlbHNcSW50ZWdyYXRpb25cUHJvY2VzczsKdXNlIFxBcHBcTW9kZWxzXEludGVncmF0aW9uXFN1YlByb2Nlc3M7CnVzZSBcQXBwXE1vZGVsc1xJbnRlZ3JhdGlvblxFbnRyeVBvaW50Owp1c2UgXEFwcFxNb2RlbHNcSW50ZWdyYXRpb25cVHJhbnNhY3Rpb247CnVzZSBcQXBwXE1vZGVsc1xJbnRlZ3JhdGlvblxUcmFuc2FjdGlvbkVudHJ5Owp1c2UgXEFwcFxNb2RlbHNcSW50ZWdyYXRpb25cVHJhbnNhY3Rpb25Mb2c7CgoKY2xhc3MgVHJhbnNhY3Rpb25Db250cm9sbGVyIGV4dGVuZHMgQ29udHJvbGxlcgp7CiAgICAvKioKICAgICAqIEVudHJ5IFBvaW50cwogICAgICogCiAgICAgKiBHZXQgTGlzdCBvZiBFbnRyeSBQb2ludHMuCiAgICAgKiAKICAgICAqIEBxdWVyeVBhcmFtIHRva2VuIHN0cmluZyByZXF1aXJlZCBBdXRoZW50aWNhdGlvbiBUb2tlbiBMaXN0IHdvdWxkIGJlIHByb3ZpZGVkIGJ5IEJJWlpTT0wgRXhhbXBsZTogYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXphYmNkZWYKICAgICAqIAogICAgICogQGdyb3VwIEVudHJ5IFBvaW50cwogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBlbnRyeVBvaW50cyhSZXF1ZXN0ICRyZXF1ZXN0KXsKICAgICAgICB0cnl7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICdzdGF0dXNfY29kZScgPT4gMjAwLAogICAgICAgICAgICAgICAgJ2RhdGEnID0+IEVudHJ5UG9pbnQ6OndpdGgoWwogICAgICAgICAgICAgICAgICAgICdzdWJQcm9jZXNzZXMnLAogICAgICAgICAgICAgICAgICAgICdsZWRnZXJzLmNoYXJ0T2ZBY2NvdW50JwogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgIC0+Z2V0KCkKICAgICAgICAgICAgXSwgMjAwKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnc3RhdHVzX2NvZGUnID0+IDUwMCwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkdGgtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICBdLCA1MDApOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFByb2Nlc3MKICAgICAqIAogICAgICogR2V0IExpc3Qgb2YgUHJvY2Vzcy4KICAgICAqIAogICAgICogQHF1ZXJ5UGFyYW0gdG9rZW4gc3RyaW5nIHJlcXVpcmVkIEF1dGhlbnRpY2F0aW9uIFRva2VuIExpc3Qgd291bGQgYmUgcHJvdmlkZWQgYnkgQklaWlNPTCBFeGFtcGxlOiBhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5emFiY2RlZgogICAgICogCiAgICAgKiBAZ3JvdXAgUHJvY2VzcwogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBwcm9jZXNzKFJlcXVlc3QgJHJlcXVlc3QpewogICAgICAgIHRyeXsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IHRydWUsCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgJ3N0YXR1c19jb2RlJyA9PiAyMDAsCiAgICAgICAgICAgICAgICAnZGF0YScgPT4gUHJvY2Vzczo6d2l0aChbCiAgICAgICAgICAgICAgICAgICAgJ3N1YlByb2Nlc3NlcycsCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT5nZXQoKQogICAgICAgICAgICBdLCAyMDApOwogICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICdzdGF0dXNfY29kZScgPT4gNTAwLAogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICR0aC0+Z2V0TWVzc2FnZSgpCiAgICAgICAgICAgIF0sIDUwMCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU3ViIFByb2Nlc3MKICAgICAqIAogICAgICogR2V0IExpc3Qgb2YgU3ViIFByb2Nlc3MuCiAgICAgKiAKICAgICAqIEBxdWVyeVBhcmFtIHRva2VuIHN0cmluZyByZXF1aXJlZCBBdXRoZW50aWNhdGlvbiBUb2tlbiBMaXN0IHdvdWxkIGJlIHByb3ZpZGVkIGJ5IEJJWlpTT0wgRXhhbXBsZTogYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXphYmNkZWYKICAgICAqIEBib2R5UGFyYW0gcHJvY2Vzc19pZCBpbnRlZ2VyIFByb2Nlc3MgSUQgRXhhbXBsZTogMQogICAgICogQGJvZHlQYXJhbSBjb2RlIHN0cmluZyBTdWIgUHJvY2VzcyBDb2RlIEV4YW1wbGU6IDAwMQogICAgICogQGJvZHlQYXJhbSBlbnRyeV9wb2ludF9pZCBpbnRlZ2VyIFByb2Nlc3MgSUQgRXhhbXBsZTogMQogICAgIAogICAgICogQGdyb3VwIFN1YiBQcm9jZXNzCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHN1YlByb2Nlc3MoUmVxdWVzdCAkcmVxdWVzdCl7CiAgICAgICAgdHJ5ewogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gdHJ1ZSwKICAgICAgICAgICAgICAgICdzdGF0dXMnID0+IHRydWUsCiAgICAgICAgICAgICAgICAnc3RhdHVzX2NvZGUnID0+IDIwMCwKICAgICAgICAgICAgICAgICdkYXRhJyA9PiBTdWJQcm9jZXNzOjp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAncHJvY2VzcycsCiAgICAgICAgICAgICAgICAgICAgJ2xlZGdlcnMuY2hhcnRPZkFjY291bnQnCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgLT53aGVuKGlzc2V0KCRyZXF1ZXN0LT5wcm9jZXNzX2lkKSAmJiAkcmVxdWVzdC0+cHJvY2Vzc19pZCA+IDAsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRyZXF1ZXN0KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgncHJvY2Vzc19pZCcsICRyZXF1ZXN0LT5wcm9jZXNzX2lkKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAtPndoZW4oaXNzZXQoJHJlcXVlc3QtPmNvZGUpICYmICRyZXF1ZXN0LT5jb2RlID4gMCwgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHJlcXVlc3QpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdjb2RlJywgJHJlcXVlc3QtPmNvZGUpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+d2hlbihpc3NldCgkcmVxdWVzdC0+ZW50cnlfcG9pbnRfaWQpICYmICRyZXF1ZXN0LT5lbnRyeV9wb2ludF9pZCA+IDAsIGZ1bmN0aW9uKCRxdWVyeSkgdXNlKCRyZXF1ZXN0KXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZW50cnlfcG9pbnRfaWQnLCAkcmVxdWVzdC0+ZW50cnlfcG9pbnRfaWQpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC0+Z2V0KCkKICAgICAgICAgICAgXSwgMjAwKTsKICAgICAgICB9Y2F0Y2ggKFxUaHJvd2FibGUgJHRoKXsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAnc3RhdHVzX2NvZGUnID0+IDUwMCwKICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkdGgtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICBdLCA1MDApOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRyYW5zYWN0aW9uCiAgICAgKiAKICAgICAqIEFQSSBJbnRlZ3JhdGlvbiBvZiBUcmFuc2FjdGlvbnMKICAgICAqIAogICAgICogQHF1ZXJ5UGFyYW0gdG9rZW4gc3RyaW5nIHJlcXVpcmVkIEF1dGhlbnRpY2F0aW9uIFRva2VuIExpc3Qgd291bGQgYmUgcHJvdmlkZWQgYnkgQklaWlNPTCBFeGFtcGxlOiBhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5emFiY2RlZgogICAgICogCiAgICAgKiBAYm9keVBhcmFtIGNvbXBhbnlfY29kZSBzdHJpbmcgcmVxdWlyZWQgQ29tcGFueSBDb2RlIEV4YW1wbGU6IFNTTAogICAgICogQGJvZHlQYXJhbSBjb3N0X2NlbnRyZV9jb2RlIHN0cmluZyByZXF1aXJlZCBDb3N0IENlbnRyZSBDb2RlIEV4YW1wbGU6IFNTTEJVMTAwMFNGMTAwMAogICAgICogQGJvZHlQYXJhbSBlbnRyeV90eXBlX2xhYmVsIHN0cmluZyByZXF1aXJlZCBFbnRyeSBUeXBlIExhYmVsIEV4YW1wbGU6IGpvdXJuYWwKICAgICAqIEBib2R5UGFyYW0gbnVtYmVyIHRleHQgUmVmZXJlbmNlIEV4YW1wbGU6IDEyMzQ1Njc4CiAgICAgKiBAYm9keVBhcmFtIGRhdGV0aW1lIGRhdGV0aW1lIHJlcXVpcmVkIERhdGUgJiBUaW1lIEV4YW1wbGU6IDIwMjQtMDEtMDEgMTA6MDA6MDAKICAgICAqIEBib2R5UGFyYW0gY3VycmVuY3lfY29kZSBzdHJpbmcgcmVxdWlyZWQgQ3VycmVuY3kgQ29kZSBFeGFtcGxlOiBCRFQKICAgICAqIEBib2R5UGFyYW0gbm90ZXMgdGV4dCByZXF1aXJlZCBOb3RlcyBFeGFtcGxlOiBMb3JlbSBJbXN1bSBEb2xsZXIgc2l0IGVtZXQuLi4KICAgICAqIEBib2R5UGFyYW0gc3ViX3Byb2Nlc3NfY29kZSB0ZXh0IHJlcXVpcmVkIFN1Yi1Qcm9jZXNzIENvZGUgRXhhbXBsZTogMDAxCiAgICAgKiBAYm9keVBhcmFtIGFtb3VudCBkb3VibGUgcmVxdWlyZWQgQW1vdW50IG9mIFRyYW5zYWN0aW9uIEV4YW1wbGU6IDUwMDAKICAgICAqIEBib2R5UGFyYW0gZGViaXRfbGVkZ2VycyBPYmplY3QgSlNPTiBPYmplY3Qgb2YgUEhQIEFycmF5IEV4YW1wbGU6IFt7ImNoYXJ0X29mX2FjY291bnRfY29kZSI6IDEwMjAyMDMwMDEsImFtb3VudCI6IDUwMDB9XQogICAgICogQGJvZHlQYXJhbSBjcmVkaXRfbGVkZ2VycyBPYmplY3QgSlNPTiBPYmplY3Qgb2YgUEhQIEFycmF5IEV4YW1wbGU6IFt7ImNoYXJ0X29mX2FjY291bnRfY29kZSI6IDEwMTAxMDAyMDAsImFtb3VudCI6IDUwMDB9XQogICAgICogQGJvZHlQYXJhbSBsb2dzIE9iamVjdCBKU09OIE9iamVjdCBvZiBQSFAgQXJyYXkgRXhhbXBsZTogeyJwcm9kdWN0IjogImJLYXNoIiwgImFnZW50IjogIkt1ZGR1cyBNaWEifQogICAgICogCiAgICAgKiBAcmVzcG9uc2UgewogICAgICogICAgICAgInN1Y2Nlc3MiOiB0cnVlLAogICAgICogICAgICAgInN0YXR1cyI6IHRydWUsCiAgICAgKiAgICAgICAic3RhdHVzX2NvZGUiOiAyMDAsCiAgICAgKiAgICAgICAiZGF0YSI6IHsKICAgICAqICAgICAgICAgICAiY29kZSI6ICJKTkwtMjQwMTAxLTAwMDIiLAogICAgICogICAgICAgICAgICJmaXNjYWxfeWVhcl9pZCI6IDUsCiAgICAgKiAgICAgICAgICAgImVudHJ5X3R5cGVfaWQiOiA1LAogICAgICogICAgICAgICAgICJ0YWdfaWQiOiAxLAogICAgICogICAgICAgICAgICJudW1iZXIiOiAiMTIzNDU2NzgiLAogICAgICogICAgICAgICAgICJkYXRlIjogIjIwMjQtMDEtMDEiLAogICAgICogICAgICAgICAgICJ0aW1lIjogIjEwOjAwOjAwIiwKICAgICAqICAgICAgICAgICAiZXhjaGFuZ2VfcmF0ZV9pZCI6ICIzIiwKICAgICAqICAgICAgICAgICAiZGViaXQiOiAxMDAwLAogICAgICogICAgICAgICAgICJjcmVkaXQiOiAxMDAwLAogICAgICogICAgICAgICAgICJpc19hZHZhbmNlIjogMCwKICAgICAqICAgICAgICAgICAiYWR2YW5jZV9jYXRlZ29yeV9pZCI6IDAsCiAgICAgKiAgICAgICAgICAgIm5vdGVzIjogIkxvcmVtIEltc3VtIERvbGxlciBzaXQgZW1ldC4uLiIsCiAgICAgKiAgICAgICAgICAgImlzX21hbnVhbCI6IDAsCiAgICAgKiAgICAgICAgICAgImNyZWF0ZWRfYnkiOiAxLAogICAgICogICAgICAgICAgICJ1cGRhdGVkX2F0IjogIjIwMjQtMDEtMjlUMTA6NDE6MDkuMDAwMDAwWiIsCiAgICAgKiAgICAgICAgICAgImNyZWF0ZWRfYXQiOiAiMjAyNC0wMS0yOVQxMDo0MTowOS4wMDAwMDBaIiwKICAgICAqICAgICAgICAgICAiaWQiOiAxMiwKICAgICAqICAgICAgICAgICAicHJlcGFyZWRfYnkiOiAxLAogICAgICogICAgICAgICAgICJyZXZpZXdlZF9ieSI6IDEsCiAgICAgKiAgICAgICAgICAgImFzc2Vzc2VkX2J5IjogMSwKICAgICAqICAgICAgICAgICAiYXBwcm92ZWRfYnkiOiAxLAogICAgICogICAgICAgICAgICJpc19yZXZpZXdlZCI6ICJhcHByb3ZlZCIsCiAgICAgKiAgICAgICAgICAgImlzX2Fzc2Vzc2VkIjogImFwcHJvdmVkIiwKICAgICAqICAgICAgICAgICAiaXNfYXBwcm92ZWQiOiAiYXBwcm92ZWQiLAogICAgICogICAgICAgICAgICJ1cGRhdGVkX2J5IjogMQogICAgICogICAgICAgfQogICAgICogICB9CiAgICAgKiAKICAgICAqIEBncm91cCBUcmFuc2FjdGlvbgogICAgICogQHJldHVybiBcSWxsdW1pbmF0ZVxIdHRwXFJlc3BvbnNlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiB0cmFuc2FjdGlvbihSZXF1ZXN0ICRyZXF1ZXN0KXsKICAgICAgICAkdmFsaWRhdG9yID0gXFZhbGlkYXRvcjo6bWFrZSgkcmVxdWVzdC0+YWxsKCksIFsKICAgICAgICAgICAgJ2NvbXBhbnlfY29kZScgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2NvZGUnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdlbnRyeV90eXBlX2xhYmVsJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnY3VycmVuY3lfY29kZScgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ251bWJlcicgPT4gJ3JlcXVpcmVkJywKICAgICAgICAgICAgJ2RhdGV0aW1lJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnbm90ZXMnID0+ICdyZXF1aXJlZCcsCiAgICAgICAgICAgICdzdWJfcHJvY2Vzc19jb2RlJyA9PiAncmVxdWlyZWQnLAogICAgICAgICAgICAnYW1vdW50JyA9PiAncmVxdWlyZWQnLAogICAgICAgIF0pOwoKICAgICAgICBpZigkcmVxdWVzdC0+aGFzKCdkZWJpdF9sZWRnZXJzJykpewogICAgICAgICAgICBpZighaXNzZXQoY29sbGVjdCgkcmVxdWVzdC0+ZGViaXRfbGVkZ2VycyktPmZpcnN0KClbJ2NoYXJ0X29mX2FjY291bnRfY29kZSddKSl7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICdzdGF0dXMnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICdzdGF0dXNfY29kZScgPT4gNDIyLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiRGViaXQgTGVkZ2VycyBhcmUgcmVxdWlyZWQuIgogICAgICAgICAgICAgICAgXSwgNDIyKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoIWlzc2V0KGNvbGxlY3QoJHJlcXVlc3QtPmRlYml0X2xlZGdlcnMpLT5maXJzdCgpWydhbW91bnQnXSkpewogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAnc3RhdHVzX2NvZGUnID0+IDQyMiwKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gIkRlYml0IExlZGdlciBBbW91bnRzIGFyZSByZXF1aXJlZC4iCiAgICAgICAgICAgICAgICBdLCA0MjIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZigkcmVxdWVzdC0+aGFzKCdjcmVkaXRfbGVkZ2VycycpKXsKICAgICAgICAgICAgaWYoIWlzc2V0KGNvbGxlY3QoJHJlcXVlc3QtPmNyZWRpdF9sZWRnZXJzKS0+Zmlyc3QoKVsnY2hhcnRfb2ZfYWNjb3VudF9jb2RlJ10pKXsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgJ3N0YXR1c19jb2RlJyA9PiA0MjIsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJDcmVkaXQgTGVkZ2VycyBhcmUgcmVxdWlyZWQuIgogICAgICAgICAgICAgICAgXSwgNDIyKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYoIWlzc2V0KGNvbGxlY3QoJHJlcXVlc3QtPmNyZWRpdF9sZWRnZXJzKS0+Zmlyc3QoKVsnYW1vdW50J10pKXsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgJ3N0YXR1c19jb2RlJyA9PiA0MjIsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJDcmVkaXQgTGVkZ2VyIEFtb3VudHMgYXJlIHJlcXVpcmVkLiIKICAgICAgICAgICAgICAgIF0sIDQyMik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmKChpc3NldCgkcmVxdWVzdC0+ZGViaXRfbGVkZ2VycykgJiYgaXNfYXJyYXkoJHJlcXVlc3QtPmRlYml0X2xlZGdlcnMpICYmIGNvdW50KCRyZXF1ZXN0LT5kZWJpdF9sZWRnZXJzKSA+IDApKXsKICAgICAgICAgICAgaWYoY29sbGVjdCgkcmVxdWVzdC0+ZGViaXRfbGVkZ2VycyktPnN1bSgnYW1vdW50JykgPD0gMCl7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICdzdGF0dXMnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICdzdGF0dXNfY29kZScgPT4gNDIyLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiVG90YWwgRGViaXQgQW1vdW50IGNhbiBub3QgYmUgWmVybywgUGxlYXNlIGVudGVyIFNvbWUgRGViaXQgQW1vdW50IgogICAgICAgICAgICAgICAgXSwgNDIyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYoKGlzc2V0KCRyZXF1ZXN0LT5jcmVkaXRfbGVkZ2VycykgJiYgaXNfYXJyYXkoJHJlcXVlc3QtPmNyZWRpdF9sZWRnZXJzKSAmJiBjb3VudCgkcmVxdWVzdC0+Y3JlZGl0X2xlZGdlcnMpID4gMCkpewogICAgICAgICAgICBpZihjb2xsZWN0KCRyZXF1ZXN0LT5jcmVkaXRfbGVkZ2VycyktPnN1bSgnYW1vdW50JykgPD0gMCl7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICdzdGF0dXMnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICdzdGF0dXNfY29kZScgPT4gNDIyLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiVG90YWwgQ3JlZGl0IEFtb3VudCBjYW4gbm90IGJlIFplcm8sIFBsZWFzZSBlbnRlciBTb21lIENyZWRpdCBBbW91bnQiCiAgICAgICAgICAgICAgICBdLCA0MjIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZigoaXNzZXQoJHJlcXVlc3QtPmRlYml0X2xlZGdlcnMpICYmIGlzX2FycmF5KCRyZXF1ZXN0LT5kZWJpdF9sZWRnZXJzKSAmJiBjb3VudCgkcmVxdWVzdC0+ZGViaXRfbGVkZ2VycykgPiAwKSAmJiAoaXNzZXQoJHJlcXVlc3QtPmNyZWRpdF9sZWRnZXJzKSAmJiBpc19hcnJheSgkcmVxdWVzdC0+Y3JlZGl0X2xlZGdlcnMpICYmIGNvdW50KCRyZXF1ZXN0LT5jcmVkaXRfbGVkZ2VycykgPiAwKSl7CiAgICAgICAgICAgIGlmKHN5c3RlbURvdWJsZVZhbHVlKGNvbGxlY3QoJHJlcXVlc3QtPmRlYml0X2xlZGdlcnMpLT5zdW0oJ2Ftb3VudCcpLCAyKSAhPSBzeXN0ZW1Eb3VibGVWYWx1ZShjb2xsZWN0KCRyZXF1ZXN0LT5jcmVkaXRfbGVkZ2VycyktPnN1bSgnYW1vdW50JyksIDIpKXsKICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgJ3N0YXR1c19jb2RlJyA9PiA0MjIsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJEZWJpdCAmIENyZWRpdCBBbW91bnQgaXMgbm90IGVxdWFsISIKICAgICAgICAgICAgICAgIF0sIDQyMik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICgkdmFsaWRhdG9yLT5wYXNzZXMoKSkgewogICAgICAgICAgICBEQjo6YmVnaW5UcmFuc2FjdGlvbigpOwogICAgICAgICAgICB0cnl7CgogICAgICAgICAgICAgICAgJGNvbXBhbnkgPSBDb21wYW55Ojp3aGVyZSgnY29kZScsICRyZXF1ZXN0LT5jb21wYW55X2NvZGUpLT5maXJzdCgpOwogICAgICAgICAgICAgICAgaWYoIWlzc2V0KCRjb21wYW55LT5pZCkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3N0YXR1c19jb2RlJyA9PiA0MjIsCiAgICAgICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiQ29tcGFueSBDb2RlIGlzIEludmFsaWQhIgogICAgICAgICAgICAgICAgICAgIF0sIDQyMik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJGZpc2NhbFllYXIgPSBnZXRBY3RpdmVGaXNjYWxZZWFyKCRjb21wYW55LT5pZCk7CiAgICAgICAgICAgICAgICBpZigoc3RydG90aW1lKGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRyZXF1ZXN0LT5kYXRldGltZSkpKSA8IHN0cnRvdGltZShkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkZmlzY2FsWWVhci0+c3RhcnQpKSkpIHx8IChzdHJ0b3RpbWUoZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPmRhdGV0aW1lKSkpID4gc3RydG90aW1lKGRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRmaXNjYWxZZWFyLT5lbmQpKSkpKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICdzdGF0dXNfY29kZScgPT4gNDIyLAogICAgICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gIkRhdGUgU2VsZWN0aW9uICgiLmRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRyZXF1ZXN0LT5kYXRldGltZSkpLiIpIGlzIGludmFsaWQuIERhdGUgbXVzdCBiZSBiZXR3ZWVuICIuZGF0ZSgnWS1tLWQnLCBzdHJ0b3RpbWUoJGZpc2NhbFllYXItPnN0YXJ0KSkuIiB0byAiLmRhdGUoJ1ktbS1kJywgc3RydG90aW1lKCRmaXNjYWxZZWFyLT5lbmQpKQogICAgICAgICAgICAgICAgICAgIF0sIDQyMik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJGNvc3RDZW50cmUgPSBDb3N0Q2VudHJlOjp3aGVyZUhhcygncHJvZml0Q2VudHJlLmNvbXBhbnknLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcmVxdWVzdCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2NvZGUnLCAkcmVxdWVzdC0+Y29tcGFueV9jb2RlKTsKICAgICAgICAgICAgICAgIH0pLT53aGVyZSgnY29kZScsICRyZXF1ZXN0LT5jb3N0X2NlbnRyZV9jb2RlKS0+Zmlyc3QoKTsKICAgICAgICAgICAgICAgIGlmKCFpc3NldCgkY29zdENlbnRyZS0+aWQpKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICdzdGF0dXNfY29kZScgPT4gNDIyLAogICAgICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gIkNvc3QgQ2VudHJlIENvZGUgaXMgSW52YWxpZCEiCiAgICAgICAgICAgICAgICAgICAgXSwgNDIyKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkZW50cnlUeXBlID0gRW50cnlUeXBlOjp3aGVyZSgnbGFiZWwnLCAkcmVxdWVzdC0+ZW50cnlfdHlwZV9sYWJlbCktPmZpcnN0KCk7CiAgICAgICAgICAgICAgICBpZighaXNzZXQoJGVudHJ5VHlwZS0+aWQpKXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICdzdGF0dXNfY29kZScgPT4gNDIyLAogICAgICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gIkVudHJ5IFR5cGUgTGFiZWwgaXMgSW52YWxpZCEiCiAgICAgICAgICAgICAgICAgICAgXSwgNDIyKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkY3VycmVuY3kgPSBDdXJyZW5jeTo6d2hlcmUoJ2NvZGUnLCAkcmVxdWVzdC0+Y3VycmVuY3lfY29kZSktPmZpcnN0KCk7CiAgICAgICAgICAgICAgICBpZighaXNzZXQoJGN1cnJlbmN5LT5pZCkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3N0YXR1c19jb2RlJyA9PiA0MjIsCiAgICAgICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiQ3VycmVuY3kgQ29kZSBpcyBJbnZhbGlkISIKICAgICAgICAgICAgICAgICAgICBdLCA0MjIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRhY2NvdW50cyA9IENoYXJ0T2ZBY2NvdW50Ojp3aGVyZUhhcygnY29tcGFuaWVzLmNvbXBhbnknLCBmdW5jdGlvbigkcXVlcnkpIHVzZSgkcmVxdWVzdCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRxdWVyeS0+d2hlcmUoJ2NvZGUnLCAkcmVxdWVzdC0+Y29tcGFueV9jb2RlKTsKICAgICAgICAgICAgICAgIH0pLT5wbHVjaygnY29kZScpLT50b0FycmF5KCk7CgogICAgICAgICAgICAgICAgJGFjY291bnRXaXRoSUQgPSBDaGFydE9mQWNjb3VudDo6d2hlcmVIYXMoJ2NvbXBhbmllcy5jb21wYW55JywgZnVuY3Rpb24oJHF1ZXJ5KSB1c2UoJHJlcXVlc3QpewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdjb2RlJywgJHJlcXVlc3QtPmNvbXBhbnlfY29kZSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLT5nZXQoWwogICAgICAgICAgICAgICAgICAgICdpZCcsICdjb2RlJwogICAgICAgICAgICAgICAgXSk7CgogICAgICAgICAgICAgICAgJGl0ZW1zID0gW107CiAgICAgICAgICAgICAgICAkc3ViUHJvY2VzcyA9IFN1YlByb2Nlc3M6OndpdGgoWwogICAgICAgICAgICAgICAgICAgICdsZWRnZXJzJwogICAgICAgICAgICAgICAgXSktPndoZXJlKCdjb2RlJywgJHJlcXVlc3QtPnN1Yl9wcm9jZXNzX2NvZGUpLT5maXJzdCgpOwogICAgICAgICAgICAgICAgaWYoIWlzc2V0KCRzdWJQcm9jZXNzLT5pZCkpewogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3N0YXR1c19jb2RlJyA9PiA0MjIsCiAgICAgICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiU3ViIFByb2Nlc3MgQ29kZSBpcyBJbnZhbGlkISIKICAgICAgICAgICAgICAgICAgICBdLCA0MjIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmKGlzc2V0KCRzdWJQcm9jZXNzLT5pZCkpewogICAgICAgICAgICAgICAgICAgIGlmKGlzc2V0KCRyZXF1ZXN0LT5kZWJpdF9sZWRnZXJzKSAmJiBpc19hcnJheSgkcmVxdWVzdC0+ZGViaXRfbGVkZ2VycykgJiYgY291bnQoJHJlcXVlc3QtPmRlYml0X2xlZGdlcnMpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRyZXF1ZXN0LT5kZWJpdF9sZWRnZXJzIGFzICRrZXkgPT4gJHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZighaW5fYXJyYXkoJHZhbHVlWydjaGFydF9vZl9hY2NvdW50X2NvZGUnXSwgJGFjY291bnRzKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzdGF0dXMnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3RhdHVzX2NvZGUnID0+IDQyMiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+ICJMZWRnZXIgQ29kZSAjIi4kdmFsdWVbJ2NoYXJ0X29mX2FjY291bnRfY29kZSddLicgbm90IGF2YWlsYWJsZSBmb3IgdGhpcyBDb21wYW55JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0sIDQyMik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkaXRlbXMsIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRjb3N0Q2VudHJlLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2hhcnRfb2ZfYWNjb3VudF9pZCcgPT4gJGFjY291bnRXaXRoSUQtPndoZXJlKCdjb2RlJywgJHZhbHVlWydjaGFydF9vZl9hY2NvdW50X2NvZGUnXSktPmZpcnN0KCktPmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gJHZhbHVlWydhbW91bnQnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY3JlZGl0JyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICRzdWJQcm9jZXNzLT5uYW1lLicgOjogJy4kcmVxdWVzdC0+bm90ZXMuJyA6OiBEZWJpdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnID0+ICdhcGktaW50ZWdyYXRpb24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzb3VyY2UnID0+ICRzdWJQcm9jZXNzLT5pZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJHN1YlByb2Nlc3MtPmxlZGdlcnMtPndoZXJlKCd0eXBlJywgJ0QnKS0+Y291bnQoKSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJHN1YlByb2Nlc3MtPmxlZGdlcnMtPndoZXJlKCd0eXBlJywgJ0QnKSBhcyAka2V5ID0+ICRsZWRnZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYW1vdW50ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkcmVxdWVzdC0+YW1vdW50ID4gMCAmJiAkbGVkZ2VyLT5wZXJjZW50YWdlID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhbW91bnQgPSBmbG9vcigkcmVxdWVzdC0+YW1vdW50KigkbGVkZ2VyLT5wZXJjZW50YWdlLzEwMCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkaXRlbXMsIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAkY29zdENlbnRyZS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkbGVkZ2VyLT5jaGFydF9vZl9hY2NvdW50X2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGViaXQnID0+ICRhbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjcmVkaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYXJyYXRpb24nID0+ICRzdWJQcm9jZXNzLT5uYW1lLicgOjogJy4kcmVxdWVzdC0+bm90ZXMuJyA6OiBEZWJpdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAnYXBpLWludGVncmF0aW9uJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJHN1YlByb2Nlc3MtPmlkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmKGlzc2V0KCRyZXF1ZXN0LT5jcmVkaXRfbGVkZ2VycykgJiYgaXNfYXJyYXkoJHJlcXVlc3QtPmNyZWRpdF9sZWRnZXJzKSAmJiBjb3VudCgkcmVxdWVzdC0+Y3JlZGl0X2xlZGdlcnMpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRyZXF1ZXN0LT5jcmVkaXRfbGVkZ2VycyBhcyAka2V5ID0+ICR2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoIWluX2FycmF5KCR2YWx1ZVsnY2hhcnRfb2ZfYWNjb3VudF9jb2RlJ10sICRhY2NvdW50cykpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N0YXR1c19jb2RlJyA9PiA0MjIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiTGVkZ2VyIENvZGUgIyIuJHZhbHVlWydjaGFydF9vZl9hY2NvdW50X2NvZGUnXS4nIG5vdCBhdmFpbGFibGUgZm9yIHRoaXMgQ29tcGFueScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLCA0MjIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGl0ZW1zLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Nvc3RfY2VudHJlX2lkJyA9PiAkY29zdENlbnRyZS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICRhY2NvdW50V2l0aElELT53aGVyZSgnY29kZScsICR2YWx1ZVsnY2hhcnRfb2ZfYWNjb3VudF9jb2RlJ10pLT5maXJzdCgpLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGViaXQnID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gJHZhbHVlWydhbW91bnQnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAkc3ViUHJvY2Vzcy0+bmFtZS4nIDo6ICcuJHJlcXVlc3QtPm5vdGVzLicgOjogQ3JlZGl0JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndHlwZScgPT4gJ2FwaS1pbnRlZ3JhdGlvbicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJHN1YlByb2Nlc3MtPmlkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICBpZigkc3ViUHJvY2Vzcy0+bGVkZ2Vycy0+d2hlcmUoJ3R5cGUnLCAnQycpLT5jb3VudCgpID4gMCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICgkc3ViUHJvY2Vzcy0+bGVkZ2Vycy0+d2hlcmUoJ3R5cGUnLCAnQycpIGFzICRrZXkgPT4gJGxlZGdlcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhbW91bnQgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRyZXF1ZXN0LT5hbW91bnQgPiAwICYmICRsZWRnZXItPnBlcmNlbnRhZ2UgPiAwKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGFtb3VudCA9IGZsb29yKCRyZXF1ZXN0LT5hbW91bnQqKCRsZWRnZXItPnBlcmNlbnRhZ2UvMTAwKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJheV9wdXNoKCRpdGVtcywgWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRjb3N0Q2VudHJlLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYXJ0X29mX2FjY291bnRfaWQnID0+ICRsZWRnZXItPmNoYXJ0X29mX2FjY291bnRfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gJGFtb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hcnJhdGlvbicgPT4gJHN1YlByb2Nlc3MtPm5hbWUuJyA6OiAnLiRyZXF1ZXN0LT5ub3Rlcy4nIDo6IENyZWRpdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0eXBlJyA9PiAnYXBpLWludGVncmF0aW9uJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3NvdXJjZScgPT4gJHN1YlByb2Nlc3MtPmlkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYoc3lzdGVtRG91YmxlVmFsdWUoY29sbGVjdCgkaXRlbXMpLT5zdW0oJ2RlYml0JyksIDIpICE9IHN5c3RlbURvdWJsZVZhbHVlKGNvbGxlY3QoJGl0ZW1zKS0+c3VtKCdjcmVkaXQnKSwgMikpewogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3N0YXR1c19jb2RlJyA9PiA0MjIsCiAgICAgICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiRGViaXQgJiBDcmVkaXQgQW1vdW50IGlzIG5vdCBlcXVhbCEiCiAgICAgICAgICAgICAgICAgICAgXSwgNDIyKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkZXhjaGFuZ2VSYXRlID0gZ2V0RXhjaGFuZ2VSYXRlcygkY3VycmVuY3ktPmlkLCBkYXRlKCdZLW0tZCcsIHN0cnRvdGltZSgkcmVxdWVzdC0+ZGF0ZXRpbWUpKSwgZGF0ZSgnSDppOnMnLCBzdHJ0b3RpbWUoJHJlcXVlc3QtPmRhdGV0aW1lKSkpWydyYXRlJ107CiAgICAgICAgICAgICAgICBpZihpc3NldCgkZXhjaGFuZ2VSYXRlLT5pZCkpewogICAgICAgICAgICAgICAgICAgICRleGNoYW5nZV9yYXRlX2lkID0gJGV4Y2hhbmdlUmF0ZS0+aWQ7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgICAgICdzdWNjZXNzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICdzdGF0dXNfY29kZScgPT4gNDIyLAogICAgICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gIk5vIEV4Y2hhbmdlIFJhdGUgZm91bmQgb24gdGhpcyB0aW1lbGluZSAjIi5kYXRlKCdZLW0tZCBnOmkgYScsIHN0cnRvdGltZSgkcmVxdWVzdC0+ZGF0ZXRpbWUpKQogICAgICAgICAgICAgICAgICAgIF0sIDQyMik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJGVudHJ5ID0gc2F2ZUxlZGdlckVudHJpZXMoJGVudHJ5VHlwZS0+aWQsICRyZXF1ZXN0LT5kYXRldGltZSwgaXNzZXQoJHJlcXVlc3QtPnRhZ19pZCkgPyAkcmVxdWVzdC0+dGFnX2lkIDogMSwgJHJlcXVlc3QtPm51bWJlciwgJHJlcXVlc3QtPm5vdGVzLCAkaXRlbXMsICRleGNoYW5nZV9yYXRlX2lkLCBpc3NldCgkcmVxdWVzdC0+aXNfYWR2YW5jZSkgPyAkcmVxdWVzdC0+aXNfYWR2YW5jZSA6IDAsIGlzc2V0KCRyZXF1ZXN0LT5hZHZhbmNlX2NhdGVnb3J5X2lkKSA/ICRyZXF1ZXN0LT5hZHZhbmNlX2NhdGVnb3J5X2lkIDogMCwgMCwgJGNvbXBhbnktPmlkKTsKCiAgICAgICAgICAgICAgICAkcmVzcG9uc2UgPSBbCiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+ICRlbnRyeVsnc3VjY2VzcyddLAogICAgICAgICAgICAgICAgICAgICdzdGF0dXNfY29kZScgPT4gJGVudHJ5WydzdWNjZXNzJ10gPyAyMDAgOiA0MjIsCiAgICAgICAgICAgICAgICAgICAgJ2RhdGEnID0+IGlzc2V0KCRlbnRyeVsnZW50cnknXSkgPyAkZW50cnlbJ2VudHJ5J10gOiBbXSwKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gaXNzZXQoJGVudHJ5WydtZXNzYWdlJ10pID8gJGVudHJ5WydtZXNzYWdlJ10gOiAnJywKICAgICAgICAgICAgICAgIF07CgogICAgICAgICAgICAgICAgaWYoaXNzZXQoJGVudHJ5WydlbnRyeSddKSAmJiBpc3NldCgkcmVxdWVzdC0+bG9ncykpewogICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgICAgICRsb2dzID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2goJHJlcXVlc3QtPmxvZ3MgYXMgJGtleSA9PiAkdmFsdWUpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlfcHVzaCgkbG9ncywgWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdlbnRyeV9pZCcgPT4gJGVudHJ5WydlbnRyeSddLT5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAna2V5JyA9PiAka2V5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2YWx1ZScgPT4gJHJlcXVlc3QtPmxvZ3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICovCgogICAgICAgICAgICAgICAgICAgIEVudHJ5TG9nOjppbnNlcnQoWwogICAgICAgICAgICAgICAgICAgICAgICAnZW50cnlfaWQnID0+ICRlbnRyeVsnZW50cnknXS0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdrZXknID0+ICdsb2dzJywKICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJyA9PiAkcmVxdWVzdC0+bG9ncywKICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkdHJhbnNhY3Rpb24gPSBUcmFuc2FjdGlvbjo6Y3JlYXRlKFsKICAgICAgICAgICAgICAgICAgICAnc3ViX3Byb2Nlc3NfaWQnID0+ICRzdWJQcm9jZXNzLT5pZCwKICAgICAgICAgICAgICAgICAgICAnZGF0ZXRpbWUnID0+ICRyZXF1ZXN0LT5kYXRldGltZSwKICAgICAgICAgICAgICAgICAgICAnZXhjaGFuZ2VfcmF0ZV9pZCcgPT4gJGV4Y2hhbmdlX3JhdGVfaWQsCiAgICAgICAgICAgICAgICAgICAgJ2Ftb3VudCcgPT4gJHJlcXVlc3QtPmFtb3VudCwKICAgICAgICAgICAgICAgIF0pOwoKICAgICAgICAgICAgICAgIGlmKGlzc2V0KCRlbnRyeVsnZW50cnknXS0+aWQpKXsKICAgICAgICAgICAgICAgICAgICBUcmFuc2FjdGlvbkVudHJ5OjpjcmVhdGUoWwogICAgICAgICAgICAgICAgICAgICAgICAndHJhbnNhY3Rpb25faWQnID0+ICR0cmFuc2FjdGlvbi0+aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdlbnRyeV9pZCcgPT4gJGVudHJ5WydlbnRyeSddLT5pZCwKICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBUcmFuc2FjdGlvbkxvZzo6Y3JlYXRlKFsKICAgICAgICAgICAgICAgICAgICAndHJhbnNhY3Rpb25faWQnID0+ICR0cmFuc2FjdGlvbi0+aWQsCiAgICAgICAgICAgICAgICAgICAgJ3JlcXVlc3QnID0+IGpzb25fZW5jb2RlKCRyZXF1ZXN0LT5hbGwoKSksCiAgICAgICAgICAgICAgICAgICAgJ3Jlc3BvbnNlJyA9PiBqc29uX2VuY29kZSgkcmVzcG9uc2UpLAogICAgICAgICAgICAgICAgICAgICdsb2dzJyA9PiAiUG9zdGVkIGJ5ICIuYXV0aCgpLT51c2VyKCktPm5hbWUsCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgREI6OmNvbW1pdCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oJHJlc3BvbnNlLCAkZW50cnlbJ3N1Y2Nlc3MnXSA/IDIwMCA6IDQyMik7CiAgICAgICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICdzdGF0dXMnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICdzdGF0dXNfY29kZScgPT4gNTAwLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkdGgtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICAgICAgXSwgNTAwKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICdzdGF0dXMnID0+IGZhbHNlLAogICAgICAgICAgICAnc3RhdHVzX2NvZGUnID0+IDQyMiwKICAgICAgICAgICAgJ21lc3NhZ2UnID0+IGltcGxvZGUoJywgJywgJHZhbGlkYXRvci0+ZXJyb3JzKCktPmFsbCgpKQogICAgICAgIF0sIDQyMik7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXZlcnNhbAogICAgICogCiAgICAgKiBBUEkgSW50ZWdyYXRpb24gb2YgVHJhbnNhY3Rpb24gUmV2ZXJzYWwKICAgICAqIAogICAgICogQHF1ZXJ5UGFyYW0gdG9rZW4gc3RyaW5nIHJlcXVpcmVkIEF1dGhlbnRpY2F0aW9uIFRva2VuIExpc3Qgd291bGQgYmUgcHJvdmlkZWQgYnkgQklaWlNPTCBFeGFtcGxlOiBhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5emFiY2RlZgogICAgICogCiAgICAgKiBAYm9keVBhcmFtIHRyYW5zYWN0aW9uX2NvZGUgc3RyaW5nIHJlcXVpcmVkIFRyYW5zYWN0aW9uIENvZGUgRXhhbXBsZTogSk5MLTI0MDEwMS0wMDAyCiAgICAgKiBAYm9keVBhcmFtIG5vdGVzIHRleHQgcmVxdWlyZWQgTm90ZXMgRXhhbXBsZTogTG9yZW0gSW1zdW0gRG9sbGVyIHNpdCBlbWV0Li4uCiAgICAgKiAKICAgICAqIEByZXNwb25zZSB7CiAgICAgKiAgICAgICAic3VjY2VzcyI6IHRydWUsCiAgICAgKiAgICAgICAic3RhdHVzIjogdHJ1ZSwKICAgICAqICAgICAgICJzdGF0dXNfY29kZSI6IDIwMCwKICAgICAqICAgICAgICJkYXRhIjogewogICAgICogICAgICAgICAgICJjb2RlIjogIkpOTC0yNDAxMDEtMDAwMiIsCiAgICAgKiAgICAgICAgICAgImZpc2NhbF95ZWFyX2lkIjogNSwKICAgICAqICAgICAgICAgICAiZW50cnlfdHlwZV9pZCI6IDUsCiAgICAgKiAgICAgICAgICAgInRhZ19pZCI6IDEsCiAgICAgKiAgICAgICAgICAgIm51bWJlciI6ICIxMjM0NTY3OCIsCiAgICAgKiAgICAgICAgICAgImRhdGUiOiAiMjAyNC0wMS0wMSIsCiAgICAgKiAgICAgICAgICAgInRpbWUiOiAiMTA6MDA6MDAiLAogICAgICogICAgICAgICAgICJleGNoYW5nZV9yYXRlX2lkIjogIjMiLAogICAgICogICAgICAgICAgICJkZWJpdCI6IDEwMDAsCiAgICAgKiAgICAgICAgICAgImNyZWRpdCI6IDEwMDAsCiAgICAgKiAgICAgICAgICAgImlzX2FkdmFuY2UiOiAwLAogICAgICogICAgICAgICAgICJhZHZhbmNlX2NhdGVnb3J5X2lkIjogMCwKICAgICAqICAgICAgICAgICAibm90ZXMiOiAiTG9yZW0gSW1zdW0gRG9sbGVyIHNpdCBlbWV0Li4uIiwKICAgICAqICAgICAgICAgICAiaXNfbWFudWFsIjogMCwKICAgICAqICAgICAgICAgICAiY3JlYXRlZF9ieSI6IDEsCiAgICAgKiAgICAgICAgICAgInVwZGF0ZWRfYXQiOiAiMjAyNC0wMS0yOVQxMDo0MTowOS4wMDAwMDBaIiwKICAgICAqICAgICAgICAgICAiY3JlYXRlZF9hdCI6ICIyMDI0LTAxLTI5VDEwOjQxOjA5LjAwMDAwMFoiLAogICAgICogICAgICAgICAgICJpZCI6IDEyLAogICAgICogICAgICAgICAgICJwcmVwYXJlZF9ieSI6IDEsCiAgICAgKiAgICAgICAgICAgInJldmlld2VkX2J5IjogMSwKICAgICAqICAgICAgICAgICAiYXNzZXNzZWRfYnkiOiAxLAogICAgICogICAgICAgICAgICJhcHByb3ZlZF9ieSI6IDEsCiAgICAgKiAgICAgICAgICAgImlzX3Jldmlld2VkIjogImFwcHJvdmVkIiwKICAgICAqICAgICAgICAgICAiaXNfYXNzZXNzZWQiOiAiYXBwcm92ZWQiLAogICAgICogICAgICAgICAgICJpc19hcHByb3ZlZCI6ICJhcHByb3ZlZCIsCiAgICAgKiAgICAgICAgICAgInVwZGF0ZWRfYnkiOiAxCiAgICAgKiAgICAgICB9CiAgICAgKiAgIH0KICAgICAqIAogICAgICogQGdyb3VwIFRyYW5zYWN0aW9uCiAgICAgKiBAcmV0dXJuIFxJbGx1bWluYXRlXEh0dHBcUmVzcG9uc2UKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHJldmVyc2UoUmVxdWVzdCAkcmVxdWVzdCl7CiAgICAgICAgJHZhbGlkYXRvciA9IFxWYWxpZGF0b3I6Om1ha2UoJHJlcXVlc3QtPmFsbCgpLCBbCiAgICAgICAgICAgICd0cmFuc2FjdGlvbl9jb2RlJyA9PiAncmVxdWlyZWQnLAogICAgICAgIF0pOwoKICAgICAgICBpZiAoJHZhbGlkYXRvci0+cGFzc2VzKCkpIHsKICAgICAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsKICAgICAgICAgICAgdHJ5ewogICAgICAgICAgICAgICAgJGVudHJ5ID0gRW50cnk6OndoZXJlKCdjb2RlJywgJHJlcXVlc3QtPnRyYW5zYWN0aW9uX2NvZGUpLT5maXJzdCgpOwogICAgICAgICAgICAgICAgaWYgKCFpc3NldCgkZW50cnktPmlkKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3N0YXR1c19jb2RlJyA9PiA0MjIsCiAgICAgICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiTm8gVHJhbnNhY3Rpb24gZm91bmQgd2l0aCBjb2RlICMiLiRyZXF1ZXN0LT50cmFuc2FjdGlvbl9jb2RlCiAgICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCRlbnRyeS0+aXNfcmV2ZXJzZWQgPT0gMSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsKICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3N0YXR1c19jb2RlJyA9PiA0MjIsCiAgICAgICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAiVGhpcyBUcmFuc2FjdGlvbiBjYW5ub3QgYmUgcmV2ZXJzZWQhIgogICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRpdGVtcyA9IFtdOwogICAgICAgICAgICAgICAgaWYgKCRlbnRyeS0+aXRlbXMtPmNvdW50KCkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAoJGVudHJ5LT5pdGVtcyBhcyAka2V5ID0+ICRpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5X3B1c2goJGl0ZW1zLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY29zdF9jZW50cmVfaWQnID0+ICRpdGVtLT5jb3N0X2NlbnRyZV9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGFydF9vZl9hY2NvdW50X2lkJyA9PiAkaXRlbS0+Y2hhcnRfb2ZfYWNjb3VudF9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdCcgPT4gKCRpdGVtLT5kZWJpdF9jcmVkaXQgPT0gJ0MnID8gJGl0ZW0tPmFtb3VudCA6IDApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NyZWRpdCcgPT4gKCRpdGVtLT5kZWJpdF9jcmVkaXQgPT0gJ0QnID8gJGl0ZW0tPmFtb3VudCA6IDApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Ftb3VudCcgPT4gJGl0ZW0tPmFtb3VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZWJpdF9jcmVkaXQnID0+ICgkaXRlbS0+ZGViaXRfY3JlZGl0ID09ICdDJyA/ICdEJyA6ICdDJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFycmF0aW9uJyA9PiAkaXRlbS0+bmFycmF0aW9uLicgOjogcmV2ZXJzZWQnLAogICAgICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJGZpc2NhbFllYXIgPSBGaXNjYWxZZWFyOjp3aXRoKFsKICAgICAgICAgICAgICAgICAgICAnZmlzY2FsWWVhck9wZW5pbmdzJwogICAgICAgICAgICAgICAgXSktPmZpbmRPckZhaWwoJGVudHJ5LT5maXNjYWxfeWVhcl9pZCk7CgogICAgICAgICAgICAgICAgJG5ld0VudHJ5ID0gc2F2ZUxlZGdlckVudHJpZXMoJGVudHJ5LT5lbnRyeV90eXBlX2lkLCAkZW50cnktPmRhdGUgLiAnICcgLiAkZW50cnktPnRpbWUsIDEsICRlbnRyeS0+bnVtYmVyLCAkcmVxdWVzdC0+bm90ZXMsICRpdGVtcywgJGVudHJ5LT5leGNoYW5nZV9yYXRlX2lkLCAkZW50cnktPmlzX2FkdmFuY2UsICRlbnRyeS0+YWR2YW5jZV9jYXRlZ29yeV9pZCwgJGVudHJ5LT5pc19tYW51YWwsICRlbnRyeS0+aXRlbXNbMF0tPmNvc3RDZW50cmUtPnByb2ZpdENlbnRyZS0+Y29tcGFueV9pZCwgJGZpc2NhbFllYXIpOwoKICAgICAgICAgICAgICAgIGlmKCRuZXdFbnRyeVsnc3VjY2VzcyddKXsKICAgICAgICAgICAgICAgICAgICAkZW50cnktPmlzX3JldmVyc2VkID0gMTsKICAgICAgICAgICAgICAgICAgICAkZW50cnktPnNhdmUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAoKICAgICAgICAgICAgICAgICRyZXNwb25zZSA9IFsKICAgICAgICAgICAgICAgICAgICAnc3VjY2VzcycgPT4gJG5ld0VudHJ5WydzdWNjZXNzJ10sCiAgICAgICAgICAgICAgICAgICAgJ3N0YXR1c19jb2RlJyA9PiAkbmV3RW50cnlbJ3N1Y2Nlc3MnXSA/IDIwMCA6IDQyMiwKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gJG5ld0VudHJ5WydzdWNjZXNzJ10gPyAiVHJhbnNhY3Rpb24gIyIuJHJlcXVlc3QtPnRyYW5zYWN0aW9uX2NvZGUuIiBoYXMgYmVlbiByZXZlcnNlZCBzdWNjZXNzZnVsbHkuIiA6IChpc3NldCgkbmV3RW50cnlbJ21lc3NhZ2UnXSkgPyAkbmV3RW50cnlbJ21lc3NhZ2UnXSA6ICcnKSwKICAgICAgICAgICAgICAgICAgICAnZGF0YScgPT4gaXNzZXQoJG5ld0VudHJ5WydlbnRyeSddKSA/ICRuZXdFbnRyeVsnZW50cnknXSA6IFtdLAogICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgREI6OmNvbW1pdCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oJHJlc3BvbnNlLCAkbmV3RW50cnlbJ3N1Y2Nlc3MnXSA/IDIwMCA6IDQyMik7CiAgICAgICAgICAgIH1jYXRjaCAoXFRocm93YWJsZSAkdGgpewogICAgICAgICAgICAgICAgREI6OnJvbGxiYWNrKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbCiAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICdzdGF0dXMnID0+IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICdzdGF0dXNfY29kZScgPT4gNTAwLAogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkdGgtPmdldE1lc3NhZ2UoKQogICAgICAgICAgICAgICAgXSwgNTAwKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWwogICAgICAgICAgICAnc3VjY2VzcycgPT4gZmFsc2UsCiAgICAgICAgICAgICdzdGF0dXMnID0+IGZhbHNlLAogICAgICAgICAgICAnc3RhdHVzX2NvZGUnID0+IDQyMiwKICAgICAgICAgICAgJ21lc3NhZ2UnID0+IGltcGxvZGUoJywgJywgJHZhbGlkYXRvci0+ZXJyb3JzKCktPmFsbCgpKQogICAgICAgIF0sIDQyMik7CiAgICB9Cn0K